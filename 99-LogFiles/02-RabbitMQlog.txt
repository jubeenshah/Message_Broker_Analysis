commit ee1f21168baa52e6bbd74201be54131640361e5e
Merge: 981edb986 4b58515e3
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 25 19:24:16 2018 +0300

    Merge pull request #1701 from rabbitmq/get-empty-stats
    
    Add basic.get_empty stats as a new counter

commit 981edb986c805ebee77473810558055e4ad24b45
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Sep 19 10:38:08 2018 +0200

    Update rabbitmq-components.mk

commit 9920cea9693d467c31838fed82fbb81adda7bf77
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Sep 19 10:37:00 2018 +0200

    tcp_listener_sup: Switch to ranch:child_spec/5
    
    ranch:child_spec/6 is deprecated.

commit 4b58515e31e02fc0cbd566d758cc3cd30a878463
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 17 10:58:24 2018 +0100

    Add get empty stats as a new counter
    
    Basic.get requests that return ok_empty used to be unaccounted for
    [#160280626]

commit 8f71523f001aa484fa514724dee15ed9ace87adc
Merge: 3d08081d8 7a0c8b6f9
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 17 10:41:36 2018 +0200

    Merge pull request #1700 from rabbitmq/rabbitmq-server-1699
    
    Make pg_local:member_died/2 more resilient

commit 7a0c8b6f95067446c51b9e1d2eba21d655e41503
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 17 10:31:10 2018 +0200

    Clarify

commit d6e126564d97221cf8c0158eb4406b09852c459f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 17 10:27:01 2018 +0200

    Combine two clauses here

commit dc894579c8497c645f55ab925e77c5b8824f8425
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Sep 15 01:57:07 2018 +0200

    Make pg_local:member_died/2 more resilient
    
    See #1699 for background.
    
    [#160530707]

commit 3d08081d8f4b0ef8220bceadc7f3db2e6d8a7b03
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Sep 11 14:22:21 2018 +0200

    Update rabbitmq-components.mk

commit a52de96a046f02c755b68d1d70c7e219189271eb
Merge: 7ef3b27c7 11915db3b
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Sep 8 06:59:34 2018 +0300

    Merge pull request #1695 from rabbitmq/lrb-error-text-formatting
    
    Format errors and warnings with regard to config files in a manner si…

commit 11915db3bad8f9d226e4a1c443d4e971e624389d
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Sep 6 07:49:19 2018 -0700

    Format errors and warnings with regard to config files in a manner similar to lager
    
    Use exit code 64 when configuration is invalid
    
    Correctly deal with RABBITMQ_PID_FILE
    
    Fix bug in setting up RABBITMQ_PID_FILE as well as printing multi-line warnings and errors
    
    Calculate indent

commit 7ef3b27c78673a94ef157bb1158bc321db146a2e
Merge: b21eacf62 e0eaae0a2
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Sep 5 17:20:29 2018 +0200

    Merge pull request #1694 from rabbitmq/lrb-fix-badmatch-file-extension
    
    Fix a potential badmatch error

commit e0eaae0a25145aea260e225616a254bd1b2ed6ab
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Sep 5 06:27:44 2018 -0700

    Fix a potential badmatch error
    
    You can get `badmatch` if you run the broker with arguments like this:
    
    ```
    make RABBITMQ_ALLOW_INPUT=true RABBITMQ_ADVANCED_CONFIG_FILE=/Users/lbakken/issues/pt/159000315-conf-format-check/test3/rabbitmq.conf RABBITMQ_CONFIG_FILE=/Users/lbakken/issues/pt/159000315-conf-format-check/test3/advanced.config run-broke
    ```
    
    With this change, the following message is printed:
    
    ```
    ERROR: RABBITMQ_ADVANCED_CONFIG_FILE: Expected extension .config, got extension .conf for file /Users/lbakken/issues/pt/159000315-conf-format-check/test3/rabbitmq.conf
    ```

commit b21eacf62975bc18250dece13bb5f24c2bd147d8
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Aug 31 14:17:13 2018 +0100

    Move schema dir creation to the point it's going to be used.
    
    On startup some environments do not expect schema dir if they
    use the old config. The script might fail with an error, while
    there is no reason to.

commit f0a68adcd1c79a3020ab324ef59026d3d54d379d
Merge: 25a3fe486 98040f6e8
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 30 20:31:38 2018 +0300

    Merge pull request #1691 from rabbitmq/remove-bindings
    
    Idempotent binding removal

commit 98040f6e8b9142baae025cf904289e61d7e6d7af
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 30 19:56:52 2018 +0300

    Remove a couple of sentences that may be slightly misleading now
    
    ...that we've concluded we cannot use dirty deletes in at least some areas.
    The sentence left is pretty to the point.

commit 495ead38956b2d1bcde5db071118ca4b50ab2812
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 30 14:18:10 2018 +0100

    Idempotent binding removal
    
    Optimizations introduced in #1589 caused the removal of bindings to
    be non-idempotent, as the removal of routing information with dirty
    deletes did not allow for full transaction rollback. This commit
    reverts that change, losing some of the performance improvements in
    favour of data correctness.
    
    [#160100569]

commit 25a3fe486a39d42c13680cf8f8e6990c0f13a511
Merge: 46ca0db8b 62b40f7e0
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 30 13:21:17 2018 +0300

    Merge pull request #1689 from rabbitmq/forgiving-binding-removal-on-queue-deletion
    
    Don't error when a queue that's being deleted has no bindings left to remove on transaction retries

commit 62b40f7e03f9a176f5de8bd27b5795085da741c7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 30 11:22:15 2018 +0300

    Don't error when a queue that's being deleted has no bindings to remove
    
    It can happen due to retries of (currently not guaranteed to be idempotent,
    which is a separate issue in the works) binding removal. Since both
    the queue and its bindings are undergoing removal, don't fail when
    there's nothing left to be removed for the current transaction [attempt].
    
    This avoids obscure and non-actionable errors in the log ({error, not_found}).
    Note that the error is also not handled by the callers and ignoring them
    is the only reasonable course of action that I can think of.
    
    Per discussion with @dumbbell @dcorbacho @hairyhum.

commit 46ca0db8b09cd8e7f3d73da6b0695ce8832ce083
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Aug 28 16:18:20 2018 -0700

    Update git-commit-msgs link

commit 606b101d1e2d8988200d013999a5348169bfd7b2
Merge: 526ec377a dbd3586c7
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 28 03:32:44 2018 +0300

    Merge pull request #1686 from rabbitmq/lrb-set_parameter-docs
    
    Change example to use parameter that exists

commit dbd3586c794728bc29bc7999179fb1ff3c0db506
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Aug 27 15:47:41 2018 -0700

    Change example to use parameter that exists
    
    "federation local_username" does not exist anymore

commit 526ec377a74008633e10c9e71e20e103a9fd93e7
Merge: 79f943a7f 34bba9bce
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Aug 25 00:39:46 2018 +0300

    Merge pull request #1671 from rabbitmq/config_files_check
    
    Config files check

commit 79f943a7fedd7617f52a19f1734d1d3246a86ecf
Merge: ee77a09eb 5967eab26
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 23 18:00:39 2018 +0300

    Merge pull request #1681 from rabbitmq/topology-recovery-in-status
    
    Use process status to pass the auto_delete flag

commit 5967eab265d4de0c703ea5c5cfc90e88c81f9047
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 23 10:15:45 2018 +0100

    Use process status to pass the auto_delete flag
    
    Using a terminate reason makes the channel crash
    [#159483364]

commit ee77a09eb44447bbc9c3d75a9e1c07f44b0248a2
Merge: c7dea5809 98b1c890a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 17 14:09:31 2018 +0300

    Merge pull request #1675 from rabbitmq/topology-recovery
    
    Increase performance of auto_delete queues deletion on channel down

commit 98b1c890af3d76c722341ce9abe1573be99f3533
Merge: f3b999549 c7dea5809
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 16 19:55:10 2018 +0300

    Merge branch 'master' into topology-recovery

commit f3b99954936897c2d4705bb3b46d6c03ca32983d
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 16 13:04:40 2018 +0100

    Increase performance of auto_delete queues deletion on channel down
    
    Re-introduce previous delete guard for auto_delete queues.
    Undo performance enhancement introduced by #1513 for this use case.
    All other bulk deletions remain the same.
    
    [#159483364]

commit c7dea5809f5588ae6b0e91110e52d4007d6f5071
Merge: 7747cb45e 0302a0c8a
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Aug 15 11:23:11 2018 -0700

    Merge pull request #1673 from rabbitmq/lrb-add-channel_max-detail
    
    Add detail for channel_max 0 value

commit 0302a0c8afbc810e41effd4d532d8c40b24577e0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 15 20:30:40 2018 +0300

    A typo

commit 274426ae9af286bfdd59d920565f96f459b7fe44
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 15 20:08:59 2018 +0300

    A more precise comment

commit 4f18eb728588651d616a19f2cedaaf861aab3a5b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 15 19:58:49 2018 +0300

    Log errors as, well, errors

commit e0a47e7aa7d1423e51fa115b8c4e7e46496418a5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 15 19:58:13 2018 +0300

    Improve formatting of logged connection.tune errors/exceptions

commit d5f2eb68e747bcff01ac14756f85afd86806e641
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Aug 15 07:55:47 2018 -0700

    Add detail for channel_max 0 value
    
    It is not immediately obvious that a 0 value for channel_max means infinite or "no limit". This change will result in the following message being logged:
    
    "negotiated channel_max = 0 (no limit) is higher than the maximum allowed value (2047)"

commit 34bba9bcece3070ab0c92c259e3ee37b1d7e7224
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Aug 14 12:16:30 2018 -0700

    Remove typo

commit 721fef6d807facb78c66cfed1a0f92de8ae86ef6
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Aug 14 12:28:41 2018 +0100

    Add extension to default advanced config file name on windows

commit 220ec77639236717bd1ce5367df0ce1851afb021
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 16:37:55 2018 +0100

    Batch file syntax errors. Config check error format

commit 56a372cf045975426a13bc7e52d9ff00079af2a2
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 15:17:44 2018 +0100

    Use file:consult to check if .conf is of the old format. Add more errors to the .config check

commit 61f7e9c9c3eb32441b102dbd12beb7e49a49ad0c
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 14:54:10 2018 +0100

    Improve the error message when a config file is not in the correct format

commit bcdd78881966ea2b06503e36d27438f5db2a2293
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 13:47:07 2018 +0100

    Move file with no extension variable assignment before it's used

commit f1db86a816dd439aad39cbfd95b80ec7e17dc773
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 13:46:39 2018 +0100

    Do not add ./ to NOEX files if the file is in the current dir

commit 80b22cd658165a55f0d6a3bcaf31f6ec5d942325
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 13:45:36 2018 +0100

    Do not show non-existent .conf file as a configuration file in logs

commit 38dc94b774ad93e50bad0f60653080800ba00d53
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 11:49:09 2018 +0100

    Better warning and error messages in scripts.
    
    If advanced config file has a wrong extension and is to be used as
    a -config argument - the script should fail with an error.

commit b8606a2ee50b643bdad7bf505aba7b8e5e3133c8
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Aug 13 11:43:54 2018 +0100

    Fix function removing extension.
    
    The ${FOO%.*} expression removes everything after the last dot,
    which returns wrong results for paths like /foo/bar.baz/bar.
    Make it use basename and dirname intead.

commit d296e80b521c1f0ae39cea0440104046884d58b0
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Aug 10 11:37:08 2018 +0100

    Simple validation for config file content and extension.

commit 67620efffaf46a2622e0774fef1f18e27bdc2550
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Aug 9 17:18:08 2018 +0100

    Expect extensions in config filename arguments

commit 005d3f2f923f0bc6b0b7ad58ceff7db1e623f0fe
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Aug 9 15:23:16 2018 +0100

    Refactor config file discovery. Make advanced config load if no old format config is used

commit 7747cb45e337115fc74466c5ef5730c156411482
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 14 15:59:36 2018 +0300

    Update rabbitmq.conf.example

commit d35fe7cdc0f60182a92358835c3bdb7ec3005e69
Merge: 7af8fd244 000cc324c
Author: Luke Bakken <luke@bakken.io>
Date:   Mon Aug 13 11:48:55 2018 -0700

    Merge pull request #1669 from noxdafox/priority-info
    
    Handle generic data structures in priority queue info callback

commit 000cc324c651ed019ed6ccb5ddcaabb5648a5721
Author: Matteo Cafasso <noxdafox@gmail.com>
Date:   Sun Aug 12 22:53:12 2018 +0300

    Handle generic data structures in priority queue info callback
    
    The priority queue implementation makes assumptions over the
    data format returned by the underlying backing queue
    `info` callback.
    
    This causes priority queues to crash if used together with other
    modules implementing the `rabbit_backing_queue` behaviour and
    returning additional data with the `info` callback.
    
    As we cannot predict the format of the data the backing queue
    `info` callback could return, we just replace it with the undefined
    keyword.
    
    Signed-off-by: Matteo Cafasso <noxdafox@gmail.com>

commit 7af8fd244c5d5059ac0b3d2931dcbc7210754d55
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 9 17:44:08 2018 +0200

    Update rabbitmq-components.mk

commit 0813bb6e623ec9df2f61f663d91e45bbb091bdb2
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 9 12:16:54 2018 +0200

    Update rabbitmq-components.mk

commit f5bab5484b54887156b0d736568e98f9d02a2ad2
Merge: ca55dc9b2 01a6a0882
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 8 23:11:18 2018 +0200

    Merge pull request #1666 from rabbitmq/lrb-ssl_dist_optfile-windows-159602360
    
    Set two environment variables in the same manner as on Unix systems

commit 01a6a08824f5a42d38515a6db40b06968e033be2
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Aug 8 13:37:35 2018 -0700

    Set two environment variables in the same manner as on Unix systems
    
    SERVER_START_ARGS and SERVER_ADDITIONAL_ERL_ARGS from the rabbitmq-env-conf.bat file need to be honored here.
    
    [159602360]

commit ca55dc9b25b895b8c6cbbdc6fd8402179fed5733
Merge: b211e2882 033339aa2
Author: Luke Bakken <luke@bakken.io>
Date:   Thu Aug 2 15:16:09 2018 -0700

    Merge pull request #1658 from rabbitmq/lrb-add-hostname-syslog-support
    
    Add support for syslog server hostname

commit 033339aa2044b8b21534ece3e8b4a4d8cbd0ef7c
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Aug 2 15:07:57 2018 -0700

    Remove requirement that ip or host be set, since the default is 127.0.0.1

commit a81883223674dcf6d69dba2c4580a5600ef61ac2
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Aug 2 14:39:47 2018 -0700

    Add translation to support .host and .ip setting syslog.dest_host

commit b211e288263f09b9eba08638651a3ff96f1e89d4
Merge: 08c6675a9 1c125283d
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 2 23:20:19 2018 +0300

    Merge pull request #1660 from rabbitmq/rabbitmq-server-1659
    
    Correct resource limit defaults

commit 1c125283dca34c8307c9e63b4f72fc99430dcbd1
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 2 23:10:23 2018 +0300

    Max number of atoms hasn't changed in 118b448631a699736f1380d7990989c7e61f94ff, back out my changes

commit 594dc1000ea3c63fd7b9c37bcb1503aea6f14636
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 2 22:08:59 2018 +0300

    Correct resource limit defaults: Erlang distribution buffer size and others
    
    They were bumped to x10 the values in 118b448631a699736f1380d7990989c7e61f94ff
    by mistake.
    
    Kudos to Chris Friesen for reporting this.
    
    Closes #1659.

commit f4cf1c19fba5d0c24c3e06eae4a8b355bfd87781
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Aug 2 11:55:20 2018 -0700

    Add support for syslog server hostname
    
    schlagert/syslog version 3.4.3 adds support for specifying a host name for `dest_host`, this PR supports it as well
    
    See this gist for my test procedure:
    
    git@gist.github.com:7ab6348839c3dc7b18b6662f024e089c.git

commit 08c6675a979856d2444a249079268d1f494e7748
Merge: 4da1431d2 051f7f3a8
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 25 05:08:06 2018 +0300

    Merge pull request #1650 from rabbitmq/binding-global-recover
    
    Prepare semi-durable binding table once instead of each time a virtual host is recovered

commit 4da1431d27336f31d5f04c23c8326680e6d25d5c
Merge: ddbc8642b 4f762b9ef
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 25 00:32:35 2018 +0300

    Merge pull request #1647 from rabbitmq/cancel-sync-slaves
    
    Cancel synchronisation when memory alarm is triggered

commit 051f7f3a8a31c8178630e0b10b950b82c4ac094c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 24 23:34:08 2018 +0300

    Cosmetics

commit 4f762b9ef5db8f3050fb03a076badf3ab575d7f9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 24 17:42:42 2018 +0300

    Compile from scratch
    
    [#158828073]

commit e5f4cbd2348270a66e508023d76ad9578276d476
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Jul 24 14:36:51 2018 +0100

    Prepare bindings table in a separate recover function.
    
    Before #567 all binding recover functions were executed once on
    node restart.
    Executing table_filter can be expensive with high number of vhosts
    and bindings and effectively should be called only once.
    Moved to a separate function, which should be called from the global
    recovery function (`rabbit_vhost:recover/0`)

commit ddbc8642b83897d5389104a32740377c049bd3cb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jul 23 17:54:52 2018 +0300

    Ninja fix: correct a type spec typo

commit 0b2d8d7a778f201fd2345266b6bbfb92cb076209
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Jul 23 11:47:54 2018 +0100

    Cancel synchronisation when memory alarm is triggered
    
    The cancellation used to block if the memory alarm was set on any of the
    slaves during sync. This patch solves it.
    [#158828073]

commit 7c941aff893c44355e3e892a43b80d20de171ac3
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jul 19 10:17:02 2018 +0200

    rabbitmqctl.8: Wrap a long line
    
    ... to keep it under the 80-column limit.
    
    References #1641.

commit ac5db6f67859385b4e0aa4049b93e3dbdc0e19a7
Merge: f1c720f7c 49ed422ef
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jul 19 10:15:16 2018 +0200

    Merge pull request #1641 from blgm/rename_node_docs_improvement
    
    Additional info for `rabbitmqctl rename_cluster_node` man page

commit 49ed422eff547752d0f4ef790eaff594aaf16f3c
Author: George Blue <gblue@pivotal.io>
Date:   Tue Jul 17 11:56:13 2018 +0100

    Updates based on feedback in PR #1641

commit f1c720f7cabec25f571e5bb4e5c5c79683123f43
Merge: ff0fd235c 21a757312
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jul 16 23:40:26 2018 +0300

    Merge pull request #1643 from rabbitmq/rabbitmq-server-1642
    
    Correctly call rabbitmq-env.bat

commit 21a757312a92c8d59bc89bf9e8960fc3a91ab929
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jul 16 11:37:42 2018 -0700

    Correctly call rabbitmq-env.bat
    
    Fixes #1642

commit ff0fd235cabf492356aa55bce0290fad86744af4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jul 14 01:05:10 2018 +0300

    This test requires code_server_cache to be started
    
    References rabbitmq/rabbitmq-server#1640.

commit f6decb7df3844192f5b5cb1cd511ca64a1b6c4b0
Author: George Blue <gblue@pivotal.io>
Date:   Thu Jul 12 13:52:06 2018 +0100

    Additional info for `rabbitmqctl rename_cluster_node` man page
    
    The man page currently explains that it only changes the local database.
    I have added information about the other steps required to successfully
    rename a node.

commit 4b2be400838c417a308bcfbdf27dd281761fde0f
Merge: 1c75310b2 2371531cb
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 12 04:46:16 2018 +0300

    Merge pull request #1640 from rabbitmq/lrb-vesc-888
    
    Add code_server cache to prevent code:get_object_code abuse

commit 2371531cb9148ba785137492bd39b4f84ca69cc3
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Jul 11 15:45:29 2018 -0700

    Add code_server cache to prevent code:get_object_code abuse
    
    In the case of high connection churn, code:get_object_code is called multiple times to find the Module:additional_authn_params method for the direct connection type. In the case of a missing module, the code_server process can be overrun with messages while checking the code path. This change caches the result so that future calls to a missing or bad module are not as time consuming
    
    Fixes VESC-888

commit 1c75310b23c401ae014230aacb38f0a07929a012
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jul 8 17:38:51 2018 +0300

    Log which module in the chain successfully authenticated the user
    
    At debug level; there already are info messages about accepted and successfully
    authenticated and authorized connections.
    
    [#158782152]
    [#158782156]

commit 77fcb2c09fb3142d6c3cc26153f5d4d543da15cd
Merge: 184ff0ca1 ddb88163e
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Jul 4 11:08:46 2018 +0200

    Merge pull request #1634 from rabbitmq/rabbitmq-server-1633
    
    Pass authentication context to Mod:user_login_authorization/2

commit ddb88163e476c54a4b96ab10b74a470d3ae7e0e7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 3 23:28:52 2018 +0300

    Pass authentication context to Mod:user_login_authorization/2
    
    Part of rabbitmq/rabbitmq-server#1633.
    
    [#158805410]

commit 184ff0ca164d5084f94ab0414189de6115bf78eb
Merge: 1604a0328 28f14e08d
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 20 13:19:45 2018 +0300

    Merge pull request #1626 from Duske/patch-1
    
    (doc) fix typo in mqtt vhost section

commit 28f14e08d10c6d80a8f0b89a33b244578a8e5f9b
Author: Dustin <dustin.duske@gmail.com>
Date:   Wed Jun 20 12:02:37 2018 +0200

    (doc) fix typo in mqtt vhost section

commit 1604a03285f8605856aa77f9b7ab2f5873ccbfd1
Merge: 37075b6fd dae785ab3
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jun 7 16:23:25 2018 +0200

    Merge pull request #1615 from rabbitmq/erlang-otp-21-compatibility
    
    Compile on Erlang/OTP 21

commit dae785ab345c4102bf5ddf6a1a733025a84191fd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 4 15:28:17 2018 +0300

    Be more defensive about what output rabbitmqctl eval produces here
    
    OTP 21 has a new logging subsystem and extra logging added to the kernel app
    to accompany the asynchronous automatic node connection feature. This breaks
    this eval command that asks the node for some of its effective paths (e.g.
    the plugin dir).
    
    Since we know the set of lines we are interested in, we can filter out
    everything else.
    
    Pair: @dumbbell.
    
    Part of #1616.
    
    [#157964874]

commit e3b2830647caa29add5df77438335294baa99e2d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 30 14:09:54 2018 +0300

    Compile Erlang/OTP 21
    
    OTP 21 deprecated erlang:get_stacktrace/0 in favor of a new
    try/catch syntax. Unfortunately that's not realistic for projects
    that support multiple Erlang versions (like us) until OTP 21 can be
    the minimum version requirement. In order to compile we have to ignore
    the warning. The broad compiler option seems to be the most common
    way to support compilation on multiple OTP versions with warnings_as_errors.
    
    [#157964874]

commit 37075b6fd6779aeb5b76a3c3deb6d171b0256368
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jun 7 11:31:29 2018 +0200

    Update rabbitmq-components.mk

commit ac50a38ea8ef9fcdcaf49aca5c711ccdd4ad3c1f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 6 15:35:54 2018 +0300

    Use rabbit_data_coercion:to_list/1 to coerce discovered node name to a string
    
    Previous implementation breaks on OTP 21.
    
    [#157964874]
    
    (cherry picked from commit da011eb94ed79463daf912756dd866f2d777c0c3)

commit a210d82f54a133eae167da036302c1c63b3d4d9a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 5 19:06:38 2018 +0300

    Don't await for error_logger handlers to initialise
    
    It will never be started on OTP 21.
    
    The problem this piece of code originally was added to solve
    is not very relevant now that we use Lager. Arguably connection
    rate throttling should be enforced elsewhere, be it Ranch or a proxy/load balancer.
    
    In any case, this particular implementation worked around an error_logger
    issue that is no longer problematic for us, and eventually won't be problematic
    for the entire ecosystem because OTP 21 introduced a completely new logger.
    
    Cherry-picked per discussion with @dumbbell and @lukebakken.
    
    [#157964874]
    
    (cherry picked from commit a54b44fd8d24af90d8df301658fba4775f957bc8)

commit ed40ab692930349c04d42df370e9b6a5681dd711
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 5 15:06:19 2018 +0300

    Minor README updates

commit e8a847dc5ddf7cb07a6dc335b81dfb4cfc5a0375
Merge: 438ffcec3 19337af36
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jun 2 02:26:32 2018 +0300

    Merge pull request #1617 from notque/patch-1
    
    fix default heartbeat in example conf file to 60

commit 19337af368b53c85a3f739cbb178a2b33fbb899c
Author: Nathan Oyler <notque@gmail.com>
Date:   Fri Jun 1 13:14:21 2018 -0700

    fix default heartbeat in example conf file to 60
    
    listed as 600, not the true default of 60

commit 438ffcec3bca3e87862c7cfff1a7a670a06c98cb
Merge: 4e4624208 ced1c0333
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu May 31 22:44:55 2018 +0300

    Merge pull request #1604 from essen/better-default-allocs
    
    Use more optimal default memory allocators where available (Erlang 20.2.3 or later)

commit 4e4624208fd30bac46c280caca7c0f12a2c4aa6b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 30 15:52:05 2018 +0300

    Erlang/OTP 19.3 compatibility
    
    `erlang:floor/1` is not available in 19.3.
    
    [#156729133]

commit 00c56e68ecefec7c7b6160d0ad17e0eee58ed8cd
Merge: ce59b43f8 7462d83b2
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 30 14:23:24 2018 +0300

    Merge pull request #1611 from rabbitmq/rabbitmq-cli-235
    
    Introduce rabbit_nodes:await_running_count/2

commit 7462d83b2417fae9b2182c734c384fb8e7d289ff
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 30 05:11:08 2018 +0300

    An integration test for rabbit_nodes:await_running_count/2
    
    [#156729133]

commit a604fa6668fc5bcb2fbc67fdf3cd6920741a9b87
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 29 15:44:09 2018 +0300

    rabbit_nodes:await_running_count_with_retries/2: correct type spec and base clause return value
    
    [#156729133]

commit ced1c03338dbb0e19a7ceccd1874432d4235e15f
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Mon May 21 13:26:01 2018 +0200

    Use better default memory allocators
    
    We have settled on the following configuration for memory
    allocators after testing many different combinations:
    
    +MBas ageffcbf +MHas ageffcbf +MBlmbcs 512 +MHlmbcs 512 +MMmcs 30
    
    They reduce the memory usage and help RabbitMQ reclaim memory,
    at the cost of a slight decrease in performance due to an
    increased number of memory operations.
    
    We need to start Erlang with these values in order to figure
    out whether they are supported. The allocator strategies we
    recommend were introduced in Erlang/OTP 20.2.3. The values
    can be overriden using RABBITMQ_SERVER_ERL_ARGS.
    
    cc @gerhard

commit ce59b43f8a2842f228080181f1cd6dec056a7621
Merge: 1e97bce7c e48ac193d
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 28 19:26:57 2018 +0300

    Merge pull request #1601 from rabbitmq/rabbitmq-server-1596-connection-name-to-connection-closed-event
    
    Add client properties to connection.closed events

commit e48ac193d7cd2d6968c90431b5f408b403150fe6
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon May 28 14:28:38 2018 +0200

    Add connection name to connection created/closed events if necessary
    
    Fixes #1596
    
    [#157500358]

commit 2df7b4cfad562dedaefa4bca908b04aef013e7c2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 22 04:18:11 2018 +0100

    Introduce rabbit_nodes:await_running_count/2
    
    It will wait until the cluster has N members, up to so many seconds.
    The function will return immediately for the value of 1.
    
    Part of rabbitmq/rabbitmq-cli#235.

commit 1e97bce7cdf0b7e55198ebddaf910207c9bbf158
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 26 16:59:05 2018 +0300

    Restore Erlang/OTP 19.3 compatibility
    
    erlang:ceil/1 is not available in 19.3.
    
    Part of rabbitmq/rabbitmq-management#575.
    
    [#157817330]

commit 0becb6bf46facd60705c4697e0f59ef71d0d0f1a
Merge: dd186dbf5 f7fc5b1f2
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri May 25 21:26:34 2018 +0100

    Merge pull request #1608 from rabbitmq/rabbitmq-management-575
    
    Introduce rabbit_vhost:await_running_on_all_nodes/2

commit dd186dbf5e8cfa9b6b3efe4902fb27a07463b751
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 25 07:27:09 2018 +0100

    Clarify what MPL version is used, references #1609

commit f7fc5b1f28d2bf6f02d20a20042e4d75e5b2247f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu May 24 07:51:06 2018 +0100

    Introduce rabbit_vhost:await_running_on_all_nodes/2
    
    Part of rabbitmq/rabbitmq-management#575.
    
    [#157817330]

commit e73d8caa01a2c2636d6bc03f61babdf0eaba5396
Merge: d0423f958 e8920ec0c
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 22 12:08:32 2018 +0100

    Merge pull request #1600 from rabbitmq/syslog
    
    Syslog integration

commit e8920ec0c59639c325f18ec7a9b9aa2999aa2c80
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 22 12:03:11 2018 +0100

    Syslog formatter is different from e.g. the file one now, update the tests

commit 8b062c4fdea4b5df7d897d52e04c6a46f84cdc8f
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon May 21 17:39:52 2018 +0100

    Add connection_user_provided_name to connection created/closed events
    
    Fixes #1596
    
    [#157500358]

commit c526e453d3749f8d3b91601aa3376d867eb5c3b4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon May 21 16:53:53 2018 +0100

    Make syslog a proper dependency of rabbit application, just like lager.

commit 66c1179d2c6e74e25481397de3c6e251904c0110
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon May 21 16:01:07 2018 +0100

    Remove date and time from lager formatter when logging to syslog.

commit 9eb0dfd6727a1737b2844c105b05e17e13abae2e
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon May 21 14:12:46 2018 +0100

    Pin syslog library version to 3.4.2

commit 1b38416a20f7b078aefd8defabf40bcaed5aa79a
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri May 18 15:19:32 2018 +0100

    Fix syslog config translation tests.
    
    Syslog backend is no longer configured via lager handler,
    facility and identity options are in the syslog application
    config now.

commit d0423f958599cba5148864997aa8446c873dad00
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri May 18 12:31:28 2018 +0100

    Bring back transactional match_object for bindings cleanup.
    
    Follow up to 5cdee1530d5002b316b80f488a5d87417e1d0db0
    dirty_match_object does not provide much performance improvement
    while it's breaking auto-delete exchanges cleanup.
    A transaction with a binding deletion will call auto-delete
    exchange removal, which will call a cleanup. On this cleanup
    the deleted binding should not be dirty-deleted again.
    
    Follow-up to #1589
    [#156352963]

commit 99ea452490a8bed98a8840c604759e189edf0f15
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri May 18 11:02:05 2018 +0200

    Add client properties to connection.closed events
    
    This commit adds client properties to connection.closed events. The
    original need was to have only the optional user-provided connection
    name added to correlate connections between created and closed events,
    but all the client properties are finally added for the sake of
    consistency between the 2 events.
    
    This commit uses the process dictionary to convey the client properties,
    as they're not yet available in the connection state when the call to
    send the closed event is made (in the after block, just after the
    network connection has been established).
    
    Fixes #1596
    
    [#157500358]

commit 0f626e08eb4a70d1674668c82c2a55fdcf59c17d
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu May 17 17:07:16 2018 +0100

    Do not parse syslog IP in schema transformer. String IPs are supported anyway.

commit 0fe2422741d1c726de1564b8c4aa9a909191b8b0
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu May 17 15:35:41 2018 +0100

    Cuttlefish schema to configure syslog application.
    
    Configure the syslog application directly instead of relying on
    rabbit_lager module.

commit c39524625d0f3dc3cb46b9737093144ee6b21114
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 16 16:30:16 2018 -0300

    Typo/weird wording
    
    (cherry picked from commit ad5abba68c3c335a856ade2a2a38ba2c1de871fa)

commit 88d51fae8929fbb8a9634825b6342c4aba237b55
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 16 16:02:19 2018 -0300

    Remove two files that were not meant to be committed in ee9a02429
    
    They are no longer used in 3.7.x.
    
    (cherry picked from commit 20de46c1df013874147835ac8bdc1e707ac95030)

commit b89f9cb4d8f42187581a46a4f9a650b9a11ed36e
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed May 16 18:17:49 2018 +0100

    Integrate syslog library into rabbitmq logging

commit c8cda76044bab948ced4897828d2e22a3179cd98
Merge: 92261a466 1709368d2
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 15 20:23:07 2018 -0300

    Merge pull request #1589 from rabbitmq/exclusive-queues-cleanup-optimisation
    
    Do not set table-wide and partial locks when deleting bindings.

commit 92261a466039f80a219f3c41e82c17be93eadc1d
Merge: 117eb9bd2 75cee2c11
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue May 15 15:52:57 2018 +0200

    Merge pull request #1597 from rabbitmq/rabbitmq-server-1590
    
    Hard cap for maximum priorities

commit 75cee2c119fe257cf70e876955c9bb201a9d2b38
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue May 15 15:51:20 2018 +0200

    Use MAX_SUPPORTED_PRIORITY constant for argument validation
    
    Part of #1590.

commit 1709368d2aa2d6aa3e70339cd391dad1c1858e47
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue May 15 12:41:03 2018 +0100

    Ignore lock kind argument when dirty-deleting a route

commit 9f9a414bef538f86f64b79eb46f60cd5d2c0483a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 14 15:44:25 2018 -0300

    Follow-up to 08168de6b0c3c4d7f6429f2c3d098e5080ff7b1a
    
    References #1590.
    
    [#157380396]

commit 08168de6b0c3c4d7f6429f2c3d098e5080ff7b1a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 14 15:06:52 2018 -0300

    Revert "Take policy-configured max-priority into account"
    
    This reverts commit f5aa1fbe043395806d9b9ed8780892924431466c.
    
    This feature wasn't available in the original implementation for a reason:
    policies are dynamic and can change after a queue's been declared. However,
    queue priorities are (at least currently) set in stone from the moment of
    queue creation. This was mentioned in the docs but not explicitly enough and got overlooked.
    
    Credit for the [re-]discovery goes to @acogoluegnes :)
    
    References #1590.
    
    [#157380396]

commit 7705d4e682b780575b6697d30781e0a9493b0db6
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon May 14 17:49:12 2018 +0100

    Do dirty deletes when cleaning up bindings.
    
    Dirty deletes are faster and idempotent, which means
    that it can be run in transaction as long as it's locked
    in the begining of transaction, which is done in
    `lock_resource`.
    Speed improvement is aquired by not setting record locks
    for each record, since we already have a record lock
    
    Addresses #1566
    [#156352963]

commit 44500061d465a8552a07af5a3a519d2263f94f8a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 14 12:37:39 2018 -0300

    Use the constant across the board
    
    Part of #1590.

commit 5cdee1530d5002b316b80f488a5d87417e1d0db0
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon May 14 16:03:08 2018 +0100

    Do not lock entire routing table when cleaning up bindings.
    
    Instead of locking entire table we can use a custom global lock on
    the affected resource (source or destination).
    This can improve performance when multiple records deleted at the
    same time, for example when connection with exclusive queues closes.
    Resource lock also aquired when adding or removing a binding, so it
    won't conflict with bulk removal.
    
    Addresses #1566
    [#156352963]

commit f5aa1fbe043395806d9b9ed8780892924431466c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun May 13 01:32:39 2018 -0500

    Take policy-configured max-priority into account
    
    Part of #1590.

commit 08636f98cef491c62bf67d6b865333d65f0d3b9f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 11 00:05:07 2018 -0500

    Reject max-priority arguments >= 256
    
    This is the value we advertise in the docs
    and it should be enforced to avoid process explosion
    e.g. when an overflow value is provided.
    
    Part of #1590.
    
    [#157380396]

commit 54c9b85836199597fb3b633fdeb2d725ab9d45ad
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu May 10 13:43:39 2018 -0500

    Make policy validation aware of the max-priority argument
    
    References #1590.
    
    [#157380396]

commit 117eb9bd268b8b8a47fb1e3478575a2a380227c4
Merge: 400530888 7a3898110
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 9 13:05:40 2018 -0500

    Merge pull request #1594 from rabbitmq/rabbitmq-server-1593
    
    Change channel_max default to 2047

commit 7a3898110e9bd76fc42f51c3e7eba78135ac9e0f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 9 12:39:19 2018 -0500

    Use 2047
    
    Since channel 0 exists on every connection for negotiation and error
    communication. 655365 = (1 << 16) - 1, so 2047 = (1 << 11) - 1.

commit 1eb80a11bd13dc79f0a27af4de6a14e31093b1b8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 9 10:06:20 2018 -0500

    Change channel_max default to 2048
    
    Closes #1593.

commit 4005308884aabbcf426c17f8e72f459211e96dcd
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Apr 27 11:32:56 2018 +0100

    Unused variable.

commit ca8dee1ec41083f6abfe59b92a707221f5f65ed8
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Apr 27 10:12:17 2018 +0100

    Do not try to stop all slaves from slave process. Stop it and let another be promoted
    
    There can be a race condition when a master queue is briefly restarted.
    If master rejoins a stopping GM it is also stopped.
    In that case it sould be sefier to stop the slave and let another be
    promoted and also stopped. If master return it will either rejoin
    slaves or create a new GM.

commit a273ab0107ddf630ef8fe7c9af7056a1bc913277
Merge: 8aea4b848 178889950
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Apr 25 17:04:02 2018 +0200

    Merge pull request #1586 from rabbitmq/rabbitmq-management-565
    
    One more place where a map definition must be converted to proplist before validation

commit 8aea4b8484c7e787cd6b8cc8841609e573cfccd7
Merge: 6429f808e c3af3ff14
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 25 13:37:59 2018 +0200

    Merge pull request #1578 from rabbitmq/queue-not-promote-on-crash
    
    Policy key to not promote unsynchronised queues.

commit 178889950703434a337464d6ef08bcb6eeee31b5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Apr 24 14:17:23 2018 +0200

    One more place where a map definition must be converted to proplist before validation
    
    Fixes rabbitmq/rabbitmq-management#565.
    
    References rabbitmq/rabbitmq-server#1493, rabbitmq/rabbitmq-federation#70,
               rabbitmq/rabbitmq-shovel#38, rabbitmq/rabbitmq-federation#73.
    
    [#157045132]

commit 6429f808ec2cce74c2ad1ee1094807cd9b983e54
Merge: c92eb7ad5 f2a7479a7
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 24 19:10:15 2018 +0900

    Merge pull request #1583 from rabbitmq/rabbitmq-server-1582
    
    Handle bump_reduce_memory_use non-true case

commit c92eb7ad540fa43f10612ea8c97e72a6f2128c4f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Apr 23 19:37:57 2018 +0300

    Fix a typo
    
    [ci skip]

commit f2a7479a71fb1cc0cbfeb5c1849976db9410f523
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Apr 23 08:26:23 2018 -0700

    Handle bump_reduce_memory_use non-true case
    
    Fixes #1582

commit a6a546f0186402da152149b108bee5d1b2c7f9d9
Merge: 3b4af50b8 d7c04865a
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Apr 21 02:30:50 2018 +0900

    Merge pull request #1580 from rabbitmq/lrb-more-forgiving-hostname-lookup
    
    Use rabbit_net:hostname

commit d7c04865a0d8aa533dc6b9dd154976afd49cd528
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Apr 19 12:28:15 2018 -0700

    Use rabbit_net:hostname
    
    This will take into account error conditions which will default to the value returned by inet:gethostname()

commit c3af3ff1453206a5979fcca8a4cca9336f6bbbae
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Apr 19 10:58:44 2018 +0100

    Do not mention gm_deaths in error message.

commit ae7bf1ffa4af2158d8b70239451915d50e77c49d
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Apr 18 18:02:51 2018 +0100

    Test that ha-promote-on-failure takes precedence over ha-promote-on-shutdown

commit 0c6a4dc64b61f40d0cb50bfa0dd32b41e783a4fe
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Apr 18 17:38:21 2018 +0100

    Test for ha-promote-on-failure policy key

commit 5f06ff470fcd4e395f4c66da4376f1f660172451
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Apr 18 16:02:26 2018 +0100

    Introduce a new policy: ha-promote-on-failure (always by default)
    
    This new policy controls if unsynchronised slaves should be promoted
    after master crash. If set to `when-synced`, unsynchronised slaves
    will not be promoted, keeping the state of the queue, but making it
    unavailable until master node returns.
    
    This change is supposed to make the cluster shutdown safier,
    because queues can fail or be killed on shutdown.
    
    The queues without master will be available from the management UI
    and can be deleted and redeclared, but will not automatically loose
    messages.
    
    Trying to declare or passively declare the queue will result in a
    timeout error. Same way as if the master was gracefully stopped with
    ha-promote-on-shutdown: when-synced
    
    [#156811690]

commit 3b4af50b8886cf11a2d39b2cd0d92c0745dc9d84
Merge: a267d6bc0 e840323bc
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Apr 11 08:44:02 2018 -0700

    Merge pull request #1577 from rabbitmq/rabbitmq-peer-discovery-k8s-23
    
    Make it possible for peer discovery backends to provide their own RSD range

commit e840323bc49db4e4e378cf7b95bacabe2f40d1c8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 11 11:50:59 2018 +0300

    Make it possible for peer discovery backends to provide their own RSD range
    
    References rabbitmq/rabbitmq-peer-discovery-k8s#23.

commit a267d6bc0b02eff60efed677027c6db392be726b
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Apr 11 10:52:21 2018 +0200

    Update erlang.mk

commit 5a6dc70cde54566bafc630b4febf3627d0adf725
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Apr 11 10:51:14 2018 +0200

    Update rabbitmq-components.mk

commit 7eccd86db8481c4e71bc74973ece982ff392ec28
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Apr 11 10:09:56 2018 +0200

    Update rabbitmq-components.mk

commit 3d2970a3a470ab55cd4669d48141d79a0f95cbcf
Merge: 678397fd8 a6438a003
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Apr 9 15:47:57 2018 +0200

    Merge pull request #1575 from rabbitmq/rabbitmq-federation-73
    
    rabbit_parameter_validation: support maps in proplist validator

commit a6438a0030fde6424e8b5022b31bf37bf127bb7c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Apr 9 16:36:52 2018 +0800

    rabbit_parameter_validation: support maps in proplist validator
    
    Part of rabbitmq/rabbitmq-federation#73, references rabbitmq/rabbitmq-federation#70,
    rabbitmq/rabbitmq-federation#67.

commit 678397fd8b502dd135f21faf93105486bb998161
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Apr 9 14:30:28 2018 +0200

    Travis CI: Update config from rabbitmq-common

commit fb375b8753e0f9de9dc2ec10bbdf594ae32b737b
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Apr 9 11:56:11 2018 +0200

    Travis CI: Update config from rabbitmq-common

commit 4c394846140030a0a5f04765f46c066b18f41f41
Merge: 16e52f5d6 9aaf311cc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Apr 6 10:37:08 2018 +0800

    Merge branch 'reduce-mnesia-contention-when-nodes-restart-master'

commit 9aaf311ccc624883898c9c0f8c63061e9d64df77
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Apr 5 14:26:21 2018 +0800

    Re-apply f2ab0b40f034cda6bca4294735b493f20550b93c

commit c5d656a74abc14a699886eaf2e3278695e7a550e
Merge: 16e52f5d6 dfa270677
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Apr 5 14:11:00 2018 +0800

    Merge branch 'reduce-mnesia-contention-when-nodes-restart-v3.7.x' into reduce-mnesia-contention-when-nodes-restart-master

commit 16e52f5d635951bbfe49ef40562c6f01f4288e9d
Merge: 2d28cb459 d04b7f180
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 28 21:33:50 2018 +0300

    Merge pull request #1567 from rabbitmq/revert-1527-reduce-mnesia-contention-when-nodes-restart-master
    
    Revert "Reduce lock contention when nodes restart (master)"

commit d04b7f180c4707f8f0b670a48a1b493f362305c6
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 28 21:33:34 2018 +0300

    Revert "Reduce lock contention when nodes restart (master)"

commit 2d28cb459e5bf30e7c72a4fffb889fbdb6ffbc77
Merge: f2ab0b40f 876cd3117
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 28 21:09:09 2018 +0300

    Merge pull request #1527 from rabbitmq/reduce-mnesia-contention-when-nodes-restart-master
    
    Reduce lock contention when nodes restart (master)

commit 876cd3117ff755caf9ed52a1b96f76d3276e7bf5
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Mar 20 17:21:31 2018 +0000

    Run binding deletions in a Mnesia transaction
    
    Otherwise, if there is more than 1 node that runs
    rabbit_node_monitor:on_node_down/1, there will be
    `{aborted,no_transaction` errors.
    
        {{aborted,no_transaction},
         [{mnesia,abort,1,[{file,"mnesia.erl"},{line,351}]},
          {rabbit_exchange_type_topic,'-remove_bindings/3-lc$^0/1-0-',1,
                                      [{file,"src/rabbit_exchange_type_topic.erl"},
                                       {line,78}]},
          {rabbit_exchange_type_topic,remove_bindings,3,
                                      [{file,"src/rabbit_exchange_type_topic.erl"},
                                       {line,78}]},
          {rabbit_binding,x_callback,4,[{file,"src/rabbit_binding.erl"},{line,570}]},
          {rabbit_binding,'-process_deletions/2-fun-0-',2,
                          [{file,"src/rabbit_binding.erl"},{line,547}]},
          {dict,map_bucket,2,[{file,"dict.erl"},{line,481}]},
          {dict,map_bkt_list,2,[{file,"dict.erl"},{line,477}]},
          {dict,map_bkt_list,2,[{file,"dict.erl"},{line,477}]}]}
    
    Partner-in-crime: @essen

commit 37ef9722bdf11905300b9684a03f97d8d7c04d25
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Mar 6 20:08:19 2018 +0000

    Delete metrics for all deleted queues in a single operation
    
    Rather than calling `rabbit_core_metrics:delete_queue/1` for every
    queue, collect all deleted queues and delete all their metrics in a
    single operation.
    
    We don't use a single Mnesia transaction to delete all objects related
    to a queue and this may be a problem, but we haven't run this version of
    the code long enough to know for sure. What should we be looking out for
    @michaelklishin?
    
    For initial context, see #1513
    
    Partner-in-crime: @essen

commit 3c5d57f35e81c4c84aeae5b0f06edeb68b2ff50b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Feb 27 17:03:06 2018 +0000

    Group queue deletions on_node_down into 10 operations per transaction
    
    When many queues are being deleted, we believe that it's faster to have
    fewer Mnesia transactions and therefore group 10 queue deletions into a
    single Mnesia transaction. This number (10) is arbitrary, we didn't try
    with a different number. Creating 1 Mnesia transaction for every queue
    deletion feels too many transaction, and having a single Mnesia
    transaction for all queue deletions is too few transactions. This felt
    like a sensible option.
    
    We cannot determine if this is a good change because
    rabbit_core_metrics:queue_deleted/1 takes the most time and obscures all
    observations. According to qcachegrind,
    rabbit_misc:execute_mnesia_transaction/1 takes 1.8s while
    rabbit_core_metrics:queue_deleted/1 takes 132s out of which ets:select/2
    takes 131s.
    
    How can we optimise rabbit_core_metrics:queue_deleted/1 ? We are
    thinking that rather than calling ets:select/2 twice for every queue, we
    should call it twice for all queues that need to be deleted. We don't
    know whether this is possible. Alternatively, we might look into
    ets:first/1 & ets:next/2 to iterate over the entire table ONCE with all
    the queues that have been deleted. Thoughts @dcorbacho @michaelklishin ?
    
    For initial context, see #1513
    
    Partner-in-crime: @essen

commit b7a3fb6923f540cea7947a93014deb5331ad8650
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 10:01:14 2018 +0000

    Add back INTERNAL_USER info to on_node_down function

commit cf78ed57dc542cbee0422b9f2b3c078b0cac177d
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 16:33:46 2018 +0000

    Split single Mnesia transaction that runs on_node_down
    
    Rather than using a single Mnesia transaction to clean queues when a
    node goes down, split it into many transactions so that other Mnesia
    operations can make progress. This is especially important when nodes
    join the cluster, since Mnesia on the newly started node will not be
    able to synchronise if there is a long-running Mnesia transaction.
    
    This commit is not complete, we need feedback on the comments left in
    the code before we can settle on a final version that can be merged.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit c9843f9a561da2a1ddce55c821d6877108cfd0d6
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 15:07:59 2018 +0000

    Wait at most 5 secs for a node to reply to rabbit_node_monitor:partitions/0
    
    When rabbit_node_monitor that runs on an alive node is busy cleaning
    after another node goes down, the process might not respond for a long
    time.
    
    Since the Management API calls rabbit_node_monitor:partitions/0 and
    blocks until this function returns, the Management UI will fail to load
    for a really long time - clients will timeout before this function
    returns.
    
    This change will make rabbit_node_monitor:partitions/0 timeout after 5
    seconds so that the Management API returns in a timely manner and the
    Management UI blocks for an extra 5 seconds at most. The implications of
    this will result in node metrics being outdated, which is not ideal, but
    at least the users will have some feedback and will be able to perform
    action via the Management UI / API.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit 11e8070f83b7a04c90a40b6cbd7c576bf67ca4e5
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 14:35:55 2018 +0000

    Do not read exchange & queue before deleting, simply delete
    
    Doing a wread operation requires a table write lock. Since a delete
    requires a table write lock as well, we have 2 write locks instead of 1.
    When Mnesia is under load, this can result in many lock collisions and
    slow down the entire set of operations. We think that it's better to
    leverage fast SSDs / NVMEs and defer the Mnesia disk log write
    optimisation to the filesystem.
    
    For more context, see #1513
    
    Partner-in-crime @essen

commit 88945e3814e43431f0dfebb76398412ec484d765
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 14:25:37 2018 +0000

    Delete bindings from mnesia without full table scan
    
    mnesia:match_object/3 scans the entire table and can take many seconds
    on a loaded node. This is especially bad when there are many bindings
    which need to be deleted. If the object is in the table then delete it,
    otherwise carry on.
    
    Prior to this change, it was observed that there is a high % of
    lock collisions in rabbit_topic_trie_binding table:
    
    ```
      lock                                 id   #tries  #collisions  collisions [%]  time [us]  duration [%] histogram [log2(us)]
     -----                                ---  ------- ------------ --------------- ---------- ------------- ---------------------
    db_tab          rabbit_topic_trie_binding   258465        13627          5.2723    1389904        0.0370 |      ...XXxxXx..........     |
    ```
    
    mnesia:match_object/3 uses a table index if it exists, but in the case
    of rabbit_topic_trie_binding, there is no table index, so a full table
    scan used to be performed.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit f2ab0b40f034cda6bca4294735b493f20550b93c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Mar 27 21:50:40 2018 +0300

    Remove a test that need reworking to be more predictable
    
    It always passes locally and almost never in CI. We should consider
    testing the key code path used to seed the database in more isolation.

commit dfa270677f6b5191f0dc994a571728a8bf93957f
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Mar 20 17:21:31 2018 +0000

    Run binding deletions in a Mnesia transaction
    
    Otherwise, if there is more than 1 node that runs
    rabbit_node_monitor:on_node_down/1, there will be
    `{aborted,no_transaction` errors.
    
        {{aborted,no_transaction},
         [{mnesia,abort,1,[{file,"mnesia.erl"},{line,351}]},
          {rabbit_exchange_type_topic,'-remove_bindings/3-lc$^0/1-0-',1,
                                      [{file,"src/rabbit_exchange_type_topic.erl"},
                                       {line,78}]},
          {rabbit_exchange_type_topic,remove_bindings,3,
                                      [{file,"src/rabbit_exchange_type_topic.erl"},
                                       {line,78}]},
          {rabbit_binding,x_callback,4,[{file,"src/rabbit_binding.erl"},{line,570}]},
          {rabbit_binding,'-process_deletions/2-fun-0-',2,
                          [{file,"src/rabbit_binding.erl"},{line,547}]},
          {dict,map_bucket,2,[{file,"dict.erl"},{line,481}]},
          {dict,map_bkt_list,2,[{file,"dict.erl"},{line,477}]},
          {dict,map_bkt_list,2,[{file,"dict.erl"},{line,477}]}]}
    
    Partner-in-crime: @essen

commit eab08df1ffd3ba21174fa688469b547649bc9db2
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Mar 6 20:08:19 2018 +0000

    Delete metrics for all deleted queues in a single operation
    
    Rather than calling `rabbit_core_metrics:delete_queue/1` for every
    queue, collect all deleted queues and delete all their metrics in a
    single operation.
    
    We don't use a single Mnesia transaction to delete all objects related
    to a queue and this may be a problem, but we haven't run this version of
    the code long enough to know for sure. What should we be looking out for
    @michaelklishin?
    
    For initial context, see #1513
    
    Partner-in-crime: @essen

commit 4927aeb648be6ced9185d62f63ce1db58308bac6
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Feb 27 17:03:06 2018 +0000

    Group queue deletions on_node_down into 10 operations per transaction
    
    When many queues are being deleted, we believe that it's faster to have
    fewer Mnesia transactions and therefore group 10 queue deletions into a
    single Mnesia transaction. This number (10) is arbitrary, we didn't try
    with a different number. Creating 1 Mnesia transaction for every queue
    deletion feels too many transaction, and having a single Mnesia
    transaction for all queue deletions is too few transactions. This felt
    like a sensible option.
    
    We cannot determine if this is a good change because
    rabbit_core_metrics:queue_deleted/1 takes the most time and obscures all
    observations. According to qcachegrind,
    rabbit_misc:execute_mnesia_transaction/1 takes 1.8s while
    rabbit_core_metrics:queue_deleted/1 takes 132s out of which ets:select/2
    takes 131s.
    
    How can we optimise rabbit_core_metrics:queue_deleted/1 ? We are
    thinking that rather than calling ets:select/2 twice for every queue, we
    should call it twice for all queues that need to be deleted. We don't
    know whether this is possible. Alternatively, we might look into
    ets:first/1 & ets:next/2 to iterate over the entire table ONCE with all
    the queues that have been deleted. Thoughts @dcorbacho @michaelklishin ?
    
    For initial context, see #1513
    
    Partner-in-crime: @essen

commit a94faecc98f4f40fe7a649d564b9025cbe5736b6
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 10:01:14 2018 +0000

    Add back INTERNAL_USER info to on_node_down function

commit 52dba0346cf092d9f6160ab7776487ed24df408a
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 16:33:46 2018 +0000

    Split single Mnesia transaction that runs on_node_down
    
    Rather than using a single Mnesia transaction to clean queues when a
    node goes down, split it into many transactions so that other Mnesia
    operations can make progress. This is especially important when nodes
    join the cluster, since Mnesia on the newly started node will not be
    able to synchronise if there is a long-running Mnesia transaction.
    
    This commit is not complete, we need feedback on the comments left in
    the code before we can settle on a final version that can be merged.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit 30a1a2f76bb21b598e1f3ce5e67725032cb38701
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 15:07:59 2018 +0000

    Wait at most 5 secs for a node to reply to rabbit_node_monitor:partitions/0
    
    When rabbit_node_monitor that runs on an alive node is busy cleaning
    after another node goes down, the process might not respond for a long
    time.
    
    Since the Management API calls rabbit_node_monitor:partitions/0 and
    blocks until this function returns, the Management UI will fail to load
    for a really long time - clients will timeout before this function
    returns.
    
    This change will make rabbit_node_monitor:partitions/0 timeout after 5
    seconds so that the Management API returns in a timely manner and the
    Management UI blocks for an extra 5 seconds at most. The implications of
    this will result in node metrics being outdated, which is not ideal, but
    at least the users will have some feedback and will be able to perform
    action via the Management UI / API.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit 034003932683f8669be0c743de2a3654adac78d2
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 14:35:55 2018 +0000

    Do not read exchange & queue before deleting, simply delete
    
    Doing a wread operation requires a table write lock. Since a delete
    requires a table write lock as well, we have 2 write locks instead of 1.
    When Mnesia is under load, this can result in many lock collisions and
    slow down the entire set of operations. We think that it's better to
    leverage fast SSDs / NVMEs and defer the Mnesia disk log write
    optimisation to the filesystem.
    
    For more context, see #1513
    
    Partner-in-crime @essen

commit 0752ddb4dc5f78673605616a038057616c08cc6c
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Feb 22 14:25:37 2018 +0000

    Delete bindings from mnesia without full table scan
    
    mnesia:match_object/3 scans the entire table and can take many seconds
    on a loaded node. This is especially bad when there are many bindings
    which need to be deleted. If the object is in the table then delete it,
    otherwise carry on.
    
    Prior to this change, it was observed that there is a high % of
    lock collisions in rabbit_topic_trie_binding table:
    
    ```
      lock                                 id   #tries  #collisions  collisions [%]  time [us]  duration [%] histogram [log2(us)]
     -----                                ---  ------- ------------ --------------- ---------- ------------- ---------------------
    db_tab          rabbit_topic_trie_binding   258465        13627          5.2723    1389904        0.0370 |      ...XXxxXx..........     |
    ```
    
    mnesia:match_object/3 uses a table index if it exists, but in the case
    of rabbit_topic_trie_binding, there is no table index, so a full table
    scan used to be performed.
    
    For more context, see #1513
    
    Partner-in-crime: @essen

commit b127e4310844aaf09287a0217a74f207e4993113
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 21 11:26:40 2018 +0300

    Cuttlefish schema: wording
    
    [ci skip]

commit 5f7b7cd66b9c0274e7b0b52494f320da7b5798fb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 21 10:07:07 2018 +0300

    Improve background_gc docs in example config files
    
    To make it clearer that memory breakdown analysis must
    be done formed. "Don't guess, collect data".
    
    (cherry picked from commit bb36e18a0ab25117ca8ccf3aecd58bdd3985006b)

commit bb36e18a0ab25117ca8ccf3aecd58bdd3985006b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 21 10:07:07 2018 +0300

    Improve background_gc docs in example config files
    
    To make it clearer that memory breakdown analysis must
    be done formed. "Don't guess, collect data".

commit 4f3131053eb80d11787c4772e421507a653354cc
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Mar 16 10:36:22 2018 +0000

    Make is_booted function compatible with pre-3.7.4 remote nodes
    
    (cherry picked from commit fc8abae47427eb9ae4347177cc23dd9d4e10ba35)

commit 5d88f5a4064d310333f2a1df6253a76dd2aaee04
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Mar 16 10:24:01 2018 +0000

    Check that default vhost is started on all nodes after restart
    
    (cherry picked from commit 92df428dd6f46aaf6ed69ffa9f79da37ed8aefe5)

commit 539ed2d9708d70dd299d4e5cab4d61b7cb3157e9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 09:29:51 2018 +0300

    Compile from scratch
    
    (cherry picked from commit 117ad73be2557e93bb9cc9bbe123337aaa98c192)

commit fb0f71b3e5523e7a0f0e4348d44cc14f0bc1ebdc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 08:20:21 2018 +0300

    Include current node to the to-start list
    
    (cherry picked from commit 1ef32474b0bd414e157411df17744f5fc7e3e5a6)

commit 06afc7fe367e2635221b96ec5081b811c5883211
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 06:48:53 2018 +0300

    Wording
    
    (cherry picked from commit a4cb92a27dd93903417e2de59abb9bb9dff77571)

commit b7a756c5ec573c88582a8a713920b762b1cb2d4c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 06:48:14 2018 +0300

    Clarify
    
    (cherry picked from commit f14bf763ebdff5524d43e214ef9ced817939e088)

commit 854c89049219d5c1cc954b952dd0f1305583f239
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Mar 15 18:31:42 2018 +0000

    Test concurrent application start with no data.
    
    (cherry picked from commit 8b6d0ef7450754d47335e6fd5267236b957a0870)

commit 1aa737b714595f219baf86bd2ddfe9bbf6730134
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Mar 15 17:16:07 2018 +0000

    Do not try to start a vhost supervisors on not fully booted nodes.
    
    Sometimes when several nodes are started at the same time, add_vhost
    can try to start a remote vhost supervisor on a node, which does
    not have a rabbit_vhost_sup_sup process yet, resulting in `{error,rabbit_vhost_sup_sup_not_running}`
    error.
    
    Filter only fully booted nodes to start remote vhost supervisors.
    
    (cherry picked from commit 52d0c1aed0d5b532765d6efd0ed92b393d821322)

commit 2ae6ba6578baaef95657d1b90470f848d464eeb7
Merge: e431a622c fc8abae47
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 16 16:37:30 2018 +0300

    Merge pull request #1556 from rabbitmq/vhost-sup-race
    
    Do not try to start a vhost supervisors on not fully booted nodes.

commit fc8abae47427eb9ae4347177cc23dd9d4e10ba35
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Mar 16 10:36:22 2018 +0000

    Make is_booted function compatible with pre-3.7.4 remote nodes

commit 92df428dd6f46aaf6ed69ffa9f79da37ed8aefe5
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Mar 16 10:24:01 2018 +0000

    Check that default vhost is started on all nodes after restart

commit 117ad73be2557e93bb9cc9bbe123337aaa98c192
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 09:29:51 2018 +0300

    Compile from scratch

commit fbddd66e964eaca136b8e3f147df7b9f3790fdce
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Mar 13 09:00:50 2018 -0700

    Add special case in handle_other for normal TCP port exit
    
    Handle noport at epmd monitor startup
    
    Handle EXIT from TCP port more gracefully
    
    Ensure that Parent pid is matched
    
    (cherry picked from commit e8d492b75e5c5f6c70f9ea8290a0c8a06362181a)

commit 1ef32474b0bd414e157411df17744f5fc7e3e5a6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 08:20:21 2018 +0300

    Include current node to the to-start list

commit e431a622cd1b018aa2f1eb83d6dba18fbd53b365
Merge: e7d173c6c e8d492b75
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 16 07:59:02 2018 +0300

    Merge pull request #1550 from rabbitmq/rabbitmq-server-544
    
    Add special case in handle_other for normal TCP port exit

commit a4cb92a27dd93903417e2de59abb9bb9dff77571
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 06:48:53 2018 +0300

    Wording

commit f14bf763ebdff5524d43e214ef9ced817939e088
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 16 06:48:14 2018 +0300

    Clarify

commit 0e57c034e31fe7f5ad6f05f144afa38f24a0676d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 15 04:00:35 2018 +0300

    Wording, compile from scratch
    
    (cherry picked from commit b30ae2f90c27c52c4e9db5f3845d37e441c6e371)

commit e06da65ff3f25ad622fcf777b0a8a146d2bcddbd
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Mar 14 12:25:41 2018 +0000

    Make error message when refusing to delete non-empty message less radical.
    
    (cherry picked from commit a82bdadc031bab0f607e5182a5b7325107386202)

commit 97db801ae37b610b69c232e2333daa3f6ce75b61
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Mar 14 11:56:12 2018 +0000

    Force-delete queues, which have no live master or slave processes.
    
    Fixes #1501
    [#155801556]
    If a queue is configured to not be promoted (via ha-promote-on-shutdown: when-synced)
    queue.delete can hang. Make it check for process existense first and
    force-delete if no master of slave processes are running.
    Do not force-delete if if_empty is set, since there is no
    way to check that the queue is empty.
    
    (cherry picked from commit 3e7bd564bda36c1bbb9e3b59b61509d0982a88ec)

commit 8b6d0ef7450754d47335e6fd5267236b957a0870
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Mar 15 18:31:42 2018 +0000

    Test concurrent application start with no data.

commit 52d0c1aed0d5b532765d6efd0ed92b393d821322
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Thu Mar 15 17:16:07 2018 +0000

    Do not try to start a vhost supervisors on not fully booted nodes.
    
    Sometimes when several nodes are started at the same time, add_vhost
    can try to start a remote vhost supervisor on a node, which does
    not have a rabbit_vhost_sup_sup process yet, resulting in `{error,rabbit_vhost_sup_sup_not_running}`
    error.
    
    Filter only fully booted nodes to start remote vhost supervisors.

commit e8d492b75e5c5f6c70f9ea8290a0c8a06362181a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Mar 13 09:00:50 2018 -0700

    Add special case in handle_other for normal TCP port exit
    
    Handle noport at epmd monitor startup
    
    Handle EXIT from TCP port more gracefully
    
    Ensure that Parent pid is matched

commit e7d173c6c9d3ed94dfa0047f439864f111459936
Merge: 6c03f0b2b b30ae2f90
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Mar 15 16:23:12 2018 +0300

    Merge pull request #1549 from rabbitmq/delete-dead-queue
    
    Force-delete queues that have no promotable master (or candidates)

commit b30ae2f90c27c52c4e9db5f3845d37e441c6e371
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 15 04:00:35 2018 +0300

    Wording, compile from scratch

commit 6c03f0b2b206a7b8749470e7c1c430ae86a787dd
Merge: 500d31679 0c1a2feb4
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Mar 14 15:36:43 2018 +0100

    Merge pull request #1544 from rabbitmq/rabbitmq-server-1538-master
    
    Merge rabbitmq-server-1538 to master

commit 39f446e0ce40b93949214ae20e9b1a9fbbb2df25
Merge: cb77f6737 5b5b06be3
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Mar 14 15:36:06 2018 +0100

    Merge pull request #1539 from rabbitmq/rabbitmq-server-1538
    
    Check process before getting amqp_params

commit a82bdadc031bab0f607e5182a5b7325107386202
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Mar 14 12:25:41 2018 +0000

    Make error message when refusing to delete non-empty message less radical.

commit 3e7bd564bda36c1bbb9e3b59b61509d0982a88ec
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Mar 14 11:56:12 2018 +0000

    Force-delete queues, which have no live master or slave processes.
    
    Fixes #1501
    [#155801556]
    If a queue is configured to not be promoted (via ha-promote-on-shutdown: when-synced)
    queue.delete can hang. Make it check for process existense first and
    force-delete if no master of slave processes are running.
    Do not force-delete if if_empty is set, since there is no
    way to check that the queue is empty.

commit 500d31679603b6eaf9f70ad5237e7ec2070b30b8
Merge: 13d0b0191 cb77f6737
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 8 04:16:11 2018 +0300

    Merge branch 'v3.7.x'

commit cb77f6737304946b2a006274eb171901dd369a3f
Merge: 9b02e69ef 5a0e47143
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Mar 6 23:07:50 2018 +0300

    Merge pull request #1542 from rabbitmq/master-locator-min-masters-group-bindings-3.7
    
    Make min-masters locator count uniqueue queue names instead of bindings 3.7

commit 5a0e47143b18b6ae52326ae40bb9b0b4f6ce1cd1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 6 19:38:59 2018 +0300

    Wording
    
    (cherry picked from commit d87d2bd6105b89d8c7904e5a8e5ffd85e7abba23)

commit 13d0b0191e30b122d876d5e21631363fb5ebc002
Merge: e3ba0b51b 660c2c414
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Mar 6 22:23:26 2018 +0300

    Merge pull request #1541 from rabbitmq/master-locator-min-masters-group-bindings
    
    Make min-masters locator count uniqueue queue names instead of bindings.

commit 0c1a2feb4dc8bec660c6613fb1a32bd849f2cbab
Merge: e3ba0b51b 5b5b06be3
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Mar 6 10:21:18 2018 -0800

    Merge branch 'rabbitmq-server-1538' into rabbitmq-server-1538-master

commit 00958e638574c9dca189fe5ae8d9def5bf4cf9c3
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Mar 6 13:53:54 2018 +0000

    Test that min-masters counts bound queues but not bindings

commit 660c2c414f0697355d16a068b96fa0284a5ff927
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Mar 6 13:53:54 2018 +0000

    Test that min-masters counts bound queues but not bindings

commit 40f49fa4cee917b95eb0f154a6b41a4c40d4c856
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Mar 6 12:14:04 2018 +0000

    Make min-masters locator count uniqueue queue names instead of bindings.
    
    Fixes #1519
    Min-masters locator was counting bindings instead of bound queues, which
    caused #1519
    Unique queue name counting is what documentation implies.

commit 1d413eac80c2adb6844b82c8ce57e21a04a55b04
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Mar 6 12:14:04 2018 +0000

    Make min-masters locator count uniqueue queue names instead of bindings.
    
    Fixes #1519
    Min-masters locator was counting bindings instead of bound queues, which
    caused #1519
    Unique queue name counting is what documentation implies.

commit 5b5b06be3b9dde1032d366744da653acbb444b61
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Mar 5 19:22:02 2018 -0800

    Check process before getting amqp_params
    
    Fixes #1538

commit 9b02e69ef5a6b7687e8bd0c7fbce9508bd1c6ee2
Merge: 7eab12c93 b47a77256
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Mar 3 14:56:14 2018 +0300

    Merge pull request #1536 from rabbitmq/rabbitmq-server-1535
    
    Handle bump_reduce_memory_use info message

commit e3ba0b51b1754427594cc0b0e6c2064b6efc280f
Merge: 3c5b279fc 9b018c277
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Mar 3 09:41:54 2018 +0300

    Merge pull request #1537 from rabbitmq/rabbitmq-server-1535-master
    
    Merge rabbitmq-server-1535 to master

commit 9b018c2772eb16ad70c6947a9093e63ba744cf7a
Merge: 3c5b279fc b47a77256
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Mar 2 12:23:39 2018 -0800

    Merge remote-tracking branch 'origin/rabbitmq-server-1535' into rabbitmq-server-1535-master

commit b47a77256d49b1eff4e72219b7d5e59b82815496
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Mar 2 11:52:10 2018 -0800

    Handle bump_reduce_memory_use info message
    
    Fixes #1535

commit 3c5b279fcf5943e60efac551c9f0ee297d614d07
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 2 19:03:03 2018 +0100

    Update erlang.mk

commit 7eab12c93e0c04000a4cfcac327fb492d26a9a71
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 2 18:35:10 2018 +0100

    Update erlang.mk

commit 884003da8d6fd4406b65114512aee94d3d5defe5
Merge: 631f822f7 668425ee1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 27 07:05:12 2018 +0300

    Merge pull request #1533 from rabbitmq/rabbitmq-server-1531
    
    Correct generated randomized startup delay range key

commit 13229c94a08e294c65cc1b0a88f18e4b4e2658f7
Merge: c364f9e55 92b1de663
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 27 05:51:35 2018 +0300

    Merge pull request #1532 from rabbitmq/rabbitmq-server-1531-master
    
    Correct generated randomized startup delay range key (master)

commit 92b1de6630d299415feb4fe863d5db0b06142e8d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 27 04:03:41 2018 +0300

    Log a message when we fall back to randomized startup delay
    
    (cherry picked from commit 668425ee1796db2310e0761ee09d85923606905c)

commit 668425ee1796db2310e0761ee09d85923606905c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 27 04:03:41 2018 +0300

    Log a message when we fall back to randomized startup delay

commit 6e9b3d1ba4ada577a370b7cdebfcf699aef07f65
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 27 03:39:14 2018 +0300

    Correct generated randomized startup delay range key
    
    Closes #1531.
    References rabbitmq/rabbitmq-peer-discovery-aws#17.
    
    [#155538515]
    
    (cherry picked from commit a92f15030b7a5c8fd70fa4eb1da64ef23cc8f575)

commit a92f15030b7a5c8fd70fa4eb1da64ef23cc8f575
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 27 03:39:14 2018 +0300

    Correct generated randomized startup delay range key
    
    Closes #1531.
    References rabbitmq/rabbitmq-peer-discovery-aws#17.
    
    [#155538515]

commit c364f9e5539c5c1a9a89f2968e6100934171e076
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Feb 26 12:05:20 2018 +0000

    Test RABBITMQ_var vs var behaviour when using rabbitmq-env.conf
    
    Covers the following variables:
    
    * RABBITMQ_SCHEDULER_BIND_TYPE & SCHEDULER_BIND_TYPE
    * RABBITMQ_DISTRIBUTION_BUFFER_SIZE & DISTRIBUTION_BUFFER_SIZE
    * RABBITMQ_MAX_NUMBER_OF_PROCESSES & MAX_NUMBER_OF_PROCESSES
    * RABBITMQ_MAX_NUMBER_OF_ATOMS & MAX_NUMBER_OF_ATOMS
    
    (cherry picked from commit 118b448631a699736f1380d7990989c7e61f94ff)

commit 631f822f7dd7688d437fa7324827c5ff795756d6
Merge: 179f22909 512a57bc6
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 26 15:35:25 2018 +0300

    Merge pull request #1528 from rabbitmq/configurable-max-procs-max-atoms
    
    Maximum number of Erlang processes and atoms can be configured via environment variables

commit 512a57bc6173ca9ceb49ed2c86a14d39dd54ccfd
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Feb 26 12:20:30 2018 +0000

    Fix default maximum number of Erlang processes

commit 118b448631a699736f1380d7990989c7e61f94ff
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Feb 26 12:05:20 2018 +0000

    Test RABBITMQ_var vs var behaviour when using rabbitmq-env.conf
    
    Covers the following variables:
    
    * RABBITMQ_SCHEDULER_BIND_TYPE & SCHEDULER_BIND_TYPE
    * RABBITMQ_DISTRIBUTION_BUFFER_SIZE & DISTRIBUTION_BUFFER_SIZE
    * RABBITMQ_MAX_NUMBER_OF_PROCESSES & MAX_NUMBER_OF_PROCESSES
    * RABBITMQ_MAX_NUMBER_OF_ATOMS & MAX_NUMBER_OF_ATOMS

commit 846984d36e529ff8d04dfcb1404bd56f41dfb0b1
Merge: 0f023e97e f38e9c4f4
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 26 13:28:14 2018 +0300

    Merge pull request #1529 from rabbitmq/configurable-max-procs-max-atoms-master
    
    Configurable max procs max atoms master

commit f38e9c4f44892ee6fb4c78d51e7124e20a6de61a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 23 12:49:51 2018 -0800

    Remove merge artifact

commit 394d02876c54db356441a666ef40eaab42da1654
Merge: 7910814ba ff5d55a21
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 23 12:42:47 2018 -0800

    Merge branch 'configurable-max-procs-max-atoms' into configurable-max-procs-max-atoms-master

commit ff5d55a21b5f2d94e56b0e50c36233211b0dc93d
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 23 12:42:30 2018 -0800

    Ensure SERVER_ERL_ARGS are set on Windows

commit 7910814ba648ba747004455be02e869de8e68141
Merge: c182d5129 c4b1f36ec
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 23 12:30:48 2018 -0800

    Merge branch 'configurable-max-procs-max-atoms' into configurable-max-procs-max-atoms-master

commit c4b1f36ecc57bb3bdb7d319d35abfb95e92c3b7d
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 23 11:49:25 2018 -0800

    Variables in rabbitmq-env.conf and rabbitmq-env-conf.bat do not begin with RABBITMQ_, adjust Unix and Windows files accordingly

commit c182d51294dd560877ad98a250015869b8f8015b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 17:58:47 2018 +0000

    Make maximum number of Erlang atoms configurable via env
    
    This was the only property in SERVER_ERL_ARGS that was not configurable.
    Even though it's unlikely that this will need to be increased above the
    existing 5 million default, we are consistent in allowing all properties
    in SERVER_ERL_ARGS to be cofigured.
    
    (cherry picked from commit b1e163fd6f385af03c65dbe421def3597ce01df2)

commit 3e7f271a2f6c49e37170a1169d2c495f4983029b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 17:53:33 2018 +0000

    Make maximum number of Erlang processes configurable via env
    
    This property is essential for nodes that need to handle many
    connections / channels / queues.
    
    Related to #1513
    
    (cherry picked from commit 2739b400a4500369b1762b0f82b68cf64047e451)

commit b1e163fd6f385af03c65dbe421def3597ce01df2
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 17:58:47 2018 +0000

    Make maximum number of Erlang atoms configurable via env
    
    This was the only property in SERVER_ERL_ARGS that was not configurable.
    Even though it's unlikely that this will need to be increased above the
    existing 5 million default, we are consistent in allowing all properties
    in SERVER_ERL_ARGS to be cofigured.

commit 2739b400a4500369b1762b0f82b68cf64047e451
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Feb 23 17:53:33 2018 +0000

    Make maximum number of Erlang processes configurable via env
    
    This property is essential for nodes that need to handle many
    connections / channels / queues.
    
    Related to #1513

commit 179f229094dc631b95ae595447bf2c3ee5dad3ef
Merge: da988060c 7bb8c758a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 23 02:18:14 2018 +0300

    Merge pull request #1523 from rabbitmq/rabbitmq-server-1522-net-ticktime-in-new-config-format
    
    Support kernel.net_ticktime in Cuttlefish configuration

commit 0f023e97eb712e4989b47cb201a6a4838c985c63
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 23 00:03:06 2018 +0300

    Address minor issues discovered in rabbit_config
    
     * Handle more responses
     * Don't emit confusing suggestions that rabbit (or plugin) setting should be set in the advanced.config file
       as that won't change a thing (but it will for kernel)
    
    (cherry picked from commit 7bb8c758a3eb4631b14caa8d637d7a1af8770281)

commit 4cb22988960d73524f3bc71da340e4a3b066f3a1
Merge: 54d856115 714078f35
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 23 00:30:24 2018 +0300

    Merge pull request #1524 from rabbitmq/rabbitmq-server-1522-net-ticktime-in-new-config-format-master
    
    Support kernel.net_ticktime in Cuttlefish configuration (master)

commit 7bb8c758a3eb4631b14caa8d637d7a1af8770281
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 23 00:03:06 2018 +0300

    Address minor issues discovered in rabbit_config
    
     * Handle more responses
     * Don't emit confusing suggestions that rabbit (or plugin) setting should be set in the advanced.config file
       as that won't change a thing (but it will for kernel)

commit 714078f358579eb2f639f31a4257866db84756f7
Merge: be6aedf52 4793d6fe0
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 22 08:36:29 2018 -0800

    Merge branch 'rabbitmq-server-1522-net-ticktime-in-new-config-format' into rabbitmq-server-1522-net-ticktime-in-new-config-format-master

commit 4793d6fe02adcf850b5e80e83238d355fd670926
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 22 08:35:43 2018 -0800

    Add 1 or greater validator, since tick time can not be zero

commit 2830a7ded7ddb99aa2e53c7f23904f0f7d98e12e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 22 18:10:26 2018 +0300

    Add a validator for net_ticktime

commit be6aedf52a96644345626bfc84e09ff9532a0383
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Feb 22 11:25:45 2018 +0100

    Support kernel.net_ticktime in Cuttlefish configuration
    
    net_ticktime, if present in the .conf file, is set up with
    net_kernel:set_net_ticktime/1 before the configuration
    of the .conf is applied to the other applications. The kernel
    is already running when the configuration is applied, so net_ticktime
    is set in a specific way.
    
    [#155393098]
    
    Fixes #1522
    
    (cherry picked from commit fdb3e7528431491e5d8718ef65e28c82efeb898b)

commit fdb3e7528431491e5d8718ef65e28c82efeb898b
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Feb 22 11:25:45 2018 +0100

    Support kernel.net_ticktime in Cuttlefish configuration
    
    net_ticktime, if present in the .conf file, is set up with
    net_kernel:set_net_ticktime/1 before the configuration
    of the .conf is applied to the other applications. The kernel
    is already running when the configuration is applied, so net_ticktime
    is set in a specific way.
    
    [#155393098]
    
    Fixes #1522

commit da988060c5557d453dd3de99a2e2f48f7f31fdfc
Merge: 41ec73b88 717dfeea6
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 21 12:29:28 2018 +0300

    Merge pull request #1514 from rabbitmq/rabbitmq-server-1508
    
    RABBITMQ_NAME_TYPE should be correctly set in Windows batch files

commit 54d856115ce767e9a993e6520a85cb058b86bc02
Merge: 20f02c877 d8b32130b
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 21 05:07:56 2018 +0300

    Merge pull request #1521 from rabbitmq/rabbitmq-server-1508-master
    
    Merge rabbitmq-server-1508 branch to master

commit d8b32130b8d386121ba953ef1487a3b2e67b7f44
Merge: 1675ca9b3 20f02c877
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 21 05:06:58 2018 +0300

    Merge branch 'master' into rabbitmq-server-1508-master
    
    Conflicts:
            scripts/rabbitmq-env
            scripts/rabbitmq-service.bat

commit 1675ca9b3430335b44cc194f707b779fde773cc6
Merge: 2a9b16d6e 717dfeea6
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Feb 20 15:27:29 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit 717dfeea6e40c597c3dd083e9bf8da205a810352
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Feb 20 15:07:15 2018 -0800

    Ensure RABBITMQ_USE_LONGNAME is set as that is what rabbitmqctl escript reads from the env

commit 5874369cd5b8726447a033e1c1e3b262abad1e9a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Feb 20 08:24:20 2018 -0800

    Set node name for rabbit_prelaunch step in Windows scripts
    
    Fixes #1508

commit 20f02c877b4e5dfdba4cdcc1849f1437b53eaadb
Merge: d9c3ed478 3464acd33
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 16 03:09:06 2018 +0300

    Merge pull request #1518 from rabbitmq/revert-1516-rabbitmq-server-1508-master
    
    Revert "Final merge of rabbitmq-server-1508 to master"

commit d9c3ed478dbf374d40350973bc845a210cb54873
Merge: 6b26e67b1 1ccb20e33
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 16 03:08:55 2018 +0300

    Merge pull request #1517 from rabbitmq/revert-1515-rabbitmq-server-1508-master
    
    Revert "Merge rabbitmq-server-1508 to master"

commit 3464acd336bad5b1ed869bddd0c1e610ee96712a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 16 03:08:31 2018 +0300

    Revert "Final merge of rabbitmq-server-1508 to master"

commit 1ccb20e33c1e30a25e70392a45ec2da6ab0e6078
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 16 03:08:28 2018 +0300

    Revert "Merge rabbitmq-server-1508 to master"

commit 6b26e67b116b9428445ff48c38105b504354cc3c
Merge: a47c23d19 2a9b16d6e
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 16 00:31:41 2018 +0300

    Merge pull request #1516 from rabbitmq/rabbitmq-server-1508-master
    
    Final merge of rabbitmq-server-1508 to master

commit 2a9b16d6e61243c239ddede5741550fc40e44062
Merge: a47c23d19 3c82673d9
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 13:02:14 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit 3c82673d9bf4d143f475ed37632fc44a6c8680b4
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 08:30:59 2018 -0800

    Remove unused -nodename argument to erl, ensure that RABBITMQ_NAME_TYPE is used correctly in Windows batch files

commit a47c23d193e872105b1c2a2fa9176fe4c056cc7f
Merge: 37d63af75 05288c4fa
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 15 23:16:22 2018 +0300

    Merge pull request #1515 from rabbitmq/rabbitmq-server-1508-master
    
    Merge rabbitmq-server-1508 to master

commit 05288c4faf6db17a90d041fff54e58f9a50ea5f3
Merge: d8edb8a43 847b118e5
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 11:40:42 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit 847b118e5355277d25b219fe033d471162d43247
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 11:40:28 2018 -0800

    Fix line continuation

commit d8edb8a43ad2d286f229960c11cb15f195f52bdb
Merge: c33dc4bab ae7799ab0
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 11:39:22 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit ae7799ab03060bcb666955835f6346e1be79ad45
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 11:39:04 2018 -0800

    Add line continuation

commit c33dc4baba0dcfaa47c827608077f6fb7b8d333d
Merge: 8dd853fd3 6bfe5393a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 08:32:04 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit 6bfe5393ae252d06511599b3e6753d8767af00ab
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Feb 15 08:30:59 2018 -0800

    Remove unused -nodename argument to erl, ensure that RABBITMQ_NAME_TYPE is used correctly in Windows batch files

commit 41ec73b886a23c80f40960137d8a11de6454e50c
Merge: 2254c8fa3 a7bf9cb0a
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 13 16:53:31 2018 +0000

    Merge pull request #1509 from rabbitmq/rabbitmq-server-1508
    
    Fix batch file issues with env variables

commit 2254c8fa377fb891d7c3c6e2e2e44152eab9fdcf
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Sun Feb 11 12:05:08 2018 -0800

    rabbit_router:match_bindings/2 optimize (uses ets:select directly); improves rabbit_exchange_type_headers, should improves rabbitmq_jms_topic_exchange too
    
    (cherry picked from commit 6ff1fb788a795a08dd98b5c925e44422886691ad)

commit 37d63af754aea9d0475242c7d2ef3160aaafadef
Merge: f1bacf2ba 8dd853fd3
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 13 13:10:46 2018 +0000

    Merge pull request #1510 from rabbitmq/rabbitmq-server-1508-master
    
    Merge rabbitmq-server-1508 to master

commit 8dd853fd3ae3e80a59c9b373ab345b8ff1620ac9
Merge: f1bacf2ba a7bf9cb0a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Feb 12 19:20:33 2018 -0800

    Merge branch 'rabbitmq-server-1508' into rabbitmq-server-1508-master

commit a7bf9cb0abfc55f2190c5f04d3a73625b025dc8b
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Feb 12 19:15:03 2018 -0800

    Fix batch file issues with env variables
    
    Fixes #1508

commit e6e34651d220f45eb49e66a4017ef15a1e8f6799
Merge: 1a743bd0a 633881838
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 12 20:34:17 2018 +0000

    Merge pull request #1506 from rabbitmq/rabbitmq-website-495-v3.7.x
    
    RABBITMQ_BASE is Windows only

commit f1bacf2ba5856612362417d12153afe79fe35e87
Merge: 2ea133b5a abdcaeb9e
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 12 19:01:15 2018 +0000

    Merge pull request #1507 from rabbitmq/rabbitmq-website-495-master
    
    RABBITMQ_BASE is Windows only

commit abdcaeb9eacdc424e3b5eb7a6a791d334322b960
Merge: 2ea133b5a 633881838
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Feb 12 10:56:03 2018 -0800

    Merge branch 'rabbitmq-website-495-v3.7.x' into rabbitmq-website-495-master

commit 633881838302e9b2d6f50287a613b8d9abd3d780
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Feb 12 10:55:38 2018 -0800

    RABBITMQ_BASE is Windows only
    
    See rabbitmq/rabbitmq-website#495

commit 2ea133b5ac38abc430283fd163dade9faaa8c4e2
Merge: f6745afa8 457caeee2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 12 12:30:26 2018 +0000

    Merge branch 'sylvainhubsch-rabbitmq-server-match-bindings-optimize'

commit 457caeee2a7ed231eb8322454d14577c813f1d17
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 12 12:30:09 2018 +0000

    Cosmetics

commit c3ad61e37bd571ab13963f6b9c7da3468b2141c4
Merge: f6745afa8 6ff1fb788
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 12 10:17:44 2018 +0000

    Merge branch 'rabbitmq-server-match-bindings-optimize' of https://github.com/sylvainhubsch/rabbitmq-server into sylvainhubsch-rabbitmq-server-match-bindings-optimize

commit 6ff1fb788a795a08dd98b5c925e44422886691ad
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Sun Feb 11 12:05:08 2018 -0800

    rabbit_router:match_bindings/2 optimize (uses ets:select directly); improves rabbit_exchange_type_headers, should improves rabbitmq_jms_topic_exchange too

commit 1a743bd0a7ccc4b9ded1624d7a1b10eb1928dce0
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Fri Feb 9 17:40:51 2018 +0100

    Example file does not match the correct syntax
    
    According to the new version of the documentation and most recent version of RabbitMQ (https://www.rabbitmq.com/cluster-formation.html), the example file did not reflect the changes (autocluster => cluster_formation)
    
    (cherry picked from commit 5b7615cb7ecfa93856391cdc747a9005b863d0d5)

commit f6745afa857f10cd199a390902d15984c9bba7f7
Merge: a9a0a4646 5b7615cb7
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 9 16:48:34 2018 +0000

    Merge pull request #1502 from almorelle/patch-3
    
    Example file uses some incorrect key prefixes for cluster formation keys

commit 5b7615cb7ecfa93856391cdc747a9005b863d0d5
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Fri Feb 9 17:40:51 2018 +0100

    Example file does not match the correct syntax
    
    According to the new version of the documentation and most recent version of RabbitMQ (https://www.rabbitmq.com/cluster-formation.html), the example file did not reflect the changes (autocluster => cluster_formation)

commit 566f41298ce72e1f8709ad182d46b36b6abbae0e
Merge: 5f7d62113 b10c633d6
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Feb 7 09:33:31 2018 -0800

    Merge pull request #1499 from rabbitmq/rabbitmq-server-1497
    
    Add delegate_count to Cuttlefish schema

commit a9a0a4646b261793f8f01e9ffd7436ec59840196
Merge: 6fc148471 fd35b2838
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Feb 7 09:25:47 2018 -0800

    Merge pull request #1498 from rabbitmq/rabbitmq-server-1497-master
    
    Add delegate_count to Cuttlefish schema (master)

commit 6fc148471dc382ace10e84c69a280cb6004d3f96
Merge: a8b9585f7 b8bbdd8d2
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 7 09:00:12 2018 +0100

    Merge pull request #1495 from rabbitmq/rabbitmq-server-1187-master
    
    Merge #1494 to master

commit 5f7d62113b312af732c1db98089ab5888db960dd
Merge: 46cf04ba7 0715e8f45
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 7 08:59:38 2018 +0100

    Merge pull request #1494 from rabbitmq/rabbitmq-server-1187
    
    Find systemd unit via ps

commit fd35b2838cd32af8a0a914666b6418db4283d2bd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 6 23:40:33 2018 +0100

    Add delegate_count to Cuttlefish schema
    
    Closes #1497.
    
    [#154982180]
    
    (cherry picked from commit b10c633d63872f5fb51508252a5bfab0383df847)

commit b10c633d63872f5fb51508252a5bfab0383df847
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 6 23:40:33 2018 +0100

    Add delegate_count to Cuttlefish schema
    
    Closes #1497.
    
    [#154982180]

commit 46cf04ba7ee1c4b3f9cdcbebb889de557c248882
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 5 21:36:24 2018 +0100

    rabbitmq.conf.example: add more tcp_listen_options examples

commit b8bbdd8d266b327e898b616c50a448e39b65205d
Merge: a8b9585f7 0715e8f45
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 2 13:04:04 2018 -0800

    Merge branch 'rabbitmq-server-1187' into rabbitmq-server-1187-master

commit 0715e8f45e7e58b5f02b9d9cddd852d29861de14
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Feb 2 13:00:51 2018 -0800

    Find systemd unit via ps
    
    Also terminate systemctl args with `--` in case the unit name starts with a dash
    
    Fixes #1187

commit 15a7641efc54989cf258587481b8cbf91543c490
Merge: 7de6eabb0 3f093e20e
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 30 22:42:14 2018 +0300

    Merge pull request #1489 from rabbitmq/rabbitmq-server-154674858
    
    Set distribution port range for run_escript

commit a8b9585f76e23a52edc4d134fa2534c7f6e91ac3
Merge: fd6d0e1bd 9bd43f543
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 30 19:10:38 2018 +0300

    Merge pull request #1491 from rabbitmq/rabbitmq-server-154674858-master
    
    Add DIST_PORT settings to Windows batch files

commit 9bd43f543bdc43ca50d04a75b594a59f9e50c6fe
Merge: 0cd2fbdda 3f093e20e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 30 08:02:15 2018 -0800

    Merge branch 'rabbitmq-server-154674858' into rabbitmq-server-154674858-master

commit 3f093e20e133aadf342a431ffb17fc7f299b22f1
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 30 08:01:41 2018 -0800

    Set defaults

commit 8b203b3a8f252bf92edb428b67e63563b5d7410b
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 30 07:56:12 2018 -0800

    Add DIST_PORT settings to Windows batch files
    
    (cherry picked from commit 0cd2fbdda7e9dea7cd651020478d5981e714ad44)

commit 0cd2fbdda7e9dea7cd651020478d5981e714ad44
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 30 07:56:12 2018 -0800

    Add DIST_PORT settings to Windows batch files

commit 7de6eabb0664adaa571de782fe0abe8479bf3052
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 30 16:37:15 2018 +0100

    Update rabbitmq-components.mk

commit fd6d0e1bd60ad23c3e7fed651b751135c73b5c43
Merge: 2fbece4d3 ff263dc5c
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 30 18:32:58 2018 +0300

    Merge pull request #1490 from rabbitmq/rabbitmq-server-154674858-master
    
    Merge #1489 to master

commit 2fbece4d3c0ebc539ff5adf193dcdf06dbc35df0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 30 15:23:25 2018 +0100

    Update rabbitmq-components.mk

commit 556d5093b5f654c276f3b40cacdaabe10864dd42
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jan 29 16:22:07 2018 -0800

    Update rabbitmq-components.mk

commit ff263dc5cd7794c8edeb83f8e2a1ea98f332cd85
Merge: f9ba64142 1e88e56e0
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jan 29 12:50:11 2018 -0800

    Merge branch 'rabbitmq-server-154674858' into rabbitmq-server-154674858-master

commit 1e88e56e07e8d42608e7006c8487a8624ba19999
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jan 29 10:56:30 2018 -0800

    Set distribution port range for run_escript
    
    Fixes rabbitmq/rabbitmq-cli#237

commit f9ba6414299ab56840097de6c77c997240e85e50
Merge: f27c33611 30e221dcd
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jan 29 16:56:04 2018 +0300

    Merge pull request #1488 from rabbitmq/revert-1487-rabbitmq-cli-237-master
    
    Revert "Merge rabbitmq/rabbitmq-server#1486 to master"

commit 30e221dcdde35ade51ec5ad6b3542cc65f6937c5
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jan 29 16:54:52 2018 +0300

    Revert "Merge rabbitmq/rabbitmq-server#1486 to master"

commit f27c33611d5e4e9c6327e84b6bf32c1020f3e003
Merge: 2a83799a1 eb1a45f1b
Author: Luke Bakken <luke@bakken.io>
Date:   Sat Jan 27 07:22:33 2018 -0800

    Merge pull request #1487 from rabbitmq/rabbitmq-cli-237-master
    
    Merge rabbitmq/rabbitmq-server#1486 to master

commit eb1a45f1bc5b84aa6940a3105a8cc4906d9b4e3b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jan 27 07:45:11 2018 +0300

    Use port 35672 instead of 55672
    
    Management plugin used to use 55672 and it's still mentioned
    on rabbitmq.com/management.html.

commit 1e6bb9d65b632ebc924b56314cdd6a4ec544dc84
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jan 27 07:28:35 2018 +0300

    Add a missing line continuation

commit f08beedab24fc31ab9f6cba000c0c12d29d96dc0
Merge: 2a83799a1 1930b7215
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jan 26 14:26:43 2018 -0800

    Merge branch 'rabbitmq-cli-237' into rabbitmq-cli-237-master

commit 1930b72158235e0c7354ab60202a7cf97a2cbb76
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jan 26 14:26:20 2018 -0800

    Specify dist port range
    
    Part of rabbitmq/rabbitmq-cli#237

commit 2a83799a1d92676e9afe7085dbeba9aa88216736
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 26 16:14:58 2018 +0300

    README updates
    
    [ci skip]
    
    (cherry picked from commit 62ff453b05317c0f8834976d44f8b95593c39bdf)

commit 3d9c660798499d80dc46603502bf160f69521f72
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 26 16:14:58 2018 +0300

    README updates
    
    [ci skip]
    
    (cherry picked from commit 62ff453b05317c0f8834976d44f8b95593c39bdf)

commit 7429f0c854eb7f5245246b0748aa70457754ef6d
Merge: 5b2c9bebf 8a6020700
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 25 03:29:53 2018 +0300

    Merge pull request #1482 from rabbitmq/rabbitmq-server-vhost-sup-sup-badarg
    
    Only call vhost status for fully started nodes

commit 5b2c9bebf06c877bc07656be18dfec85dcf68166
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Wed Jan 24 18:39:53 2018 +0100

    Quick typo fix
    
    (cherry picked from commit cbc41fc54c2e0809e4783fd7fba70b8b11f1002f)

commit d872adc9d4adf63889574ce86685488db201695c
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Tue Jan 23 10:11:53 2018 +0100

    typo
    
    (cherry picked from commit 8fb6e542b2f53035220a1bef4e7c85db2caaea39)

commit 4a3ee3a336bc82f2e56ec5d2292c80458ccc2974
Merge: 8ff28b08e 8a6020700
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 25 01:12:38 2018 +0300

    Merge branch 'rabbitmq-server-vhost-sup-sup-badarg'

commit 8ff28b08eab9756cc3d0ea943a5488fd00e10401
Merge: 2b8a105fe cbc41fc54
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 24 20:54:16 2018 +0300

    Merge pull request #1484 from almorelle/patch-2
    
    Quick typo fix in example conf file

commit cbc41fc54c2e0809e4783fd7fba70b8b11f1002f
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Wed Jan 24 18:39:53 2018 +0100

    Quick typo fix

commit 8a602070022c414366ef1ecba1cc23481b6643bd
Merge: 3dee917b9 cef9d18ee
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 24 19:07:45 2018 +0300

    Merge branch 'v3.7.x' into rabbitmq-server-vhost-sup-sup-badarg

commit cef9d18ee171b1b15bb77dcf7f4793c3c043eece
Merge: affb941c9 5570b18f5
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 24 17:26:12 2018 +0300

    Merge pull request #1477 from rabbitmq/rabbitmq-server-channel-interceptor-hang
    
    Make sure rabbit_misc:pmap callbacks do not throw.

commit 3dee917b941aa7db267b099e2fbd63267b6b77c0
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Jan 24 13:24:21 2018 +0000

    Revert "Change rabbit_nodes:all_running/0 behaviour."
    
    This reverts commit 85dcb4986b855f381fdc3f6e106a4e8fd2a1bb11.

commit 2b8a105fe65ed62d1fcb40b578dec70e04cb5ab5
Merge: 0c8c45f6c 5570b18f5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jan 24 16:13:58 2018 +0300

    Merge branch 'rabbitmq-server-channel-interceptor-hang' (again)

commit 5570b18f5e26096927adffd0c6f2cbcc747ed346
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Jan 24 12:44:40 2018 +0000

    Add a test to check channel interceptor hang.
    
    The test can hang without channel interceptor fix
    and will fail with timetrap timeout
    
    [#153846585]

commit 0c8c45f6c09d2d955112527a47cd138033e20010
Merge: d92c1959a 04f0b1359
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 24 14:45:38 2018 +0300

    Merge branch 'rabbitmq-server-channel-interceptor-hang'

commit 189a452d61eae952f86ae0c8a03857730d6b7f87
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Jan 19 16:50:19 2018 +0000

    Make sure rabbit_misc:pmap callbacks do not throw.
    
    rabbit_misc:pmap/2 can hang if a callback throws an error.
    This can cause plugin startup to hang when enabling channel
    interceptors.
    Made it log errors and continue.
    
    [#153846585]

commit 85dcb4986b855f381fdc3f6e106a4e8fd2a1bb11
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Jan 23 18:28:40 2018 +0000

    Change rabbit_nodes:all_running/0 behaviour.
    
    Make it return only nodes which are fully started
    instead of what mnesia thinks is started.
    In all places we use them, we assume they should
    be started.
    
    [#154569776]

commit b54e6018eccc72dfa4eb1bb68bd65e64ed382e18
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Jan 23 18:28:03 2018 +0000

    Make it safier to call RPCs if a supervisor is not started yet.
    
    [#154569776]

commit affb941c94de205c304b8e4ea2dc3270896fe9bc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 23 17:56:55 2018 +0100

    Update rabbitmq-components.mk

commit d92c1959a6fe7797861c8783465660c4e46bcae8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 23 17:21:17 2018 +0100

    Update rabbitmq-components.mk

commit 7ea758a7c70be78975b39ec09e3fd20f32bee300
Merge: 08c53a4cd b61c1913a
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Tue Jan 23 15:27:41 2018 +0000

    Merge pull request #1481 from rabbitmq/revert-1478-rabbitmq-server-story-154472130
    
    Revert "Declare a quorum queue using the queue.declare method"

commit b61c1913a65eb73b04a1c535a5deacac73bed33f
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Tue Jan 23 15:27:11 2018 +0000

    Revert "Declare a quorum queue using the queue.declare method"

commit 08c53a4cd1d1c4074004631b046bbbaba9acec3d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 23 15:31:07 2018 +0100

    Update rabbitmq-components.mk

commit 44aa4c3c570b07f6e726b36fe9506637687b2485
Merge: e74df9f8d 8fb6e542b
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 23 12:50:06 2018 +0300

    Merge pull request #1479 from almorelle/patch-1
    
    quick typo edit in rabbitmq.conf.example

commit 8fb6e542b2f53035220a1bef4e7c85db2caaea39
Author: Alexis Morelle <alexis.morelle@gmail.com>
Date:   Tue Jan 23 10:11:53 2018 +0100

    typo

commit e74df9f8d6009543088da5096f6ba97e49cc417e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Jan 22 22:13:15 2018 +0000

    Update rabbitmq-components.mk

commit 829e149f05a9e01b70909446b722f5817cf0bc39
Merge: 0b1417dfe 838656c35
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Mon Jan 22 16:44:00 2018 +0000

    Merge pull request #1478 from rabbitmq/rabbitmq-server-story-154472130
    
    Declare a quorum queue using the queue.declare method

commit 838656c351f7259feac79f73545d96f04cc5c2c2
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Jan 22 13:57:33 2018 +0000

    Declare a quorum queue using the queue.declare method
    
    Uses the x-queue-type argument to introduce the type: quorum/classic
    Defaults to classic
    
    [#154472130]

commit 04f0b135931ae699d9fbd7a26ee928347df945c6
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Jan 19 16:50:19 2018 +0000

    Make sure rabbit_misc:pmap callbacks do not throw.
    
    rabbit_misc:pmap/2 can hang if a callback throws an error.
    This can cause plugin startup to hang when enabling channel
    interceptors.
    Made it log errors and continue.
    
    [#153846585]

commit 0b1417dfe70ef92121077507d6508a5c7d757bc2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 19 06:55:53 2018 +0300

    Add a README for ./docs
    
    [ci skip]
    
    (cherry picked from commit 132d2b0fd0e2d150a00e25c59b119fa35ab11de6)

commit 132d2b0fd0e2d150a00e25c59b119fa35ab11de6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 19 06:55:53 2018 +0300

    Add a README for ./docs
    
    [ci skip]

commit f5024534f36924a8a4756372760c8a1615dfc456
Merge: dca0ff11f b33701345
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 12 03:29:58 2018 +0300

    Merge pull request #1472 from rabbitmq/rabbitmq-server-1471
    
    Temporarily raise log high water mark when node boots

commit 257414bc618551533305eab6a9f10f901acf0226
Merge: 8cf634344 6117d5c14
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 12 03:10:00 2018 +0300

    Merge pull request #1473 from rabbitmq/rabbitmq-server-1471-master
    
    Merge #1472 to master

commit 6117d5c1476073c63b36ecb49fe1a3b9637ce778
Merge: 8cf634344 b33701345
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Jan 11 11:32:37 2018 -0800

    Merge branch 'rabbitmq-server-1471' into rabbitmq-server-1471-master

commit b33701345218207454191afe2242107372a9cace
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Jan 11 11:29:52 2018 -0800

    Temporarily raise log high water mack when node boots
    
    Fixes #1471
    
    [154254409]

commit dca0ff11f89017663c1db0f49d09b011f9b27c9a
Merge: bef969eab 43c59a2f0
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 11 19:31:16 2018 +0300

    Merge pull request #1469 from rabbitmq/rabbitmq-server-story-153436163-v3.7.x
    
    Improve test coverage for rabbit_auth_backend_internal:set_tags/3 (v3.7.x)

commit 8cf6343449277402580c64c703cb5314754936b7
Merge: e65d425c4 ee4e68759
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 11 17:30:47 2018 +0300

    Merge pull request #1468 from rabbitmq/rabbitmq-server-story-153436163
    
    Improve test coverage for rabbit_auth_backend_internal:set_tags/3 (master)

commit 43c59a2f05b692e21d4ab6821b04ff6bfce79d23
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 10 22:12:28 2018 +0300

    Make sure this user is actually passwordless
    
    (cherry picked from commit ee4e6875904bd0f643880c0de34e6c80a082445f)

commit ee4e6875904bd0f643880c0de34e6c80a082445f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 10 22:12:28 2018 +0300

    Make sure this user is actually passwordless

commit 8068b5cbcfe1d790abd2a0dc58f324736aa0df2f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 18:56:36 2018 +0300

    Improve test coverage for rabbit_auth_backend_internal:set_tags/3
    
    [#153436163]
    
    (cherry picked from commit f5107fb3f973a7384c0c716f47b55607fc18a602)

commit bef969eabcd44b5acf358bb67d78cea882fa5f3f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 22:05:48 2018 +0300

    rabbitmq.conf.example: 3.7.x uses 10 TLS acceptors by default
    
    It used to be 1 to work around an issue in an older Ranch release.

commit e65d425c45fabc0642405fdd578e99d2c9708405
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 22:05:48 2018 +0300

    rabbitmq.conf.example: 3.7.x uses 10 TLS acceptors by default
    
    It used to be 1 to work around an issue in an older Ranch release.

commit 790c45323f9de3273896cf5a74eccf5ca3e1180c
Merge: e47387cc1 e091696e1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 9 21:50:40 2018 +0300

    Merge pull request #1465 from rabbitmq/rabbitmq-server-story-153435857-37x
    
    Internal authN backend: make it impossible to successfully log in with a blank password (for 3.7.x)

commit e47387cc1d34ca9948dcffce8eff76aac15aa309
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 21:45:14 2018 +0300

    rabbitmq.conf.example: update MQTT keys related to anonymous connections

commit 382e588e9fcee030e75dd147be7798a94ceb8360
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 21:45:14 2018 +0300

    rabbitmq.conf.example: update MQTT keys related to anonymous connections

commit a16362a75af07dcb75eecf783448d8f85cb0b7f8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 19:50:22 2018 +0300

    rabbitmq.conf.example: re-arrange and edit logging configuration

commit d3da6544595f953652f9765c2879fb1c2339ec5c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 19:50:22 2018 +0300

    rabbitmq.conf.example: re-arrange and edit logging configuration

commit f5107fb3f973a7384c0c716f47b55607fc18a602
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 9 18:56:36 2018 +0300

    Improve test coverage for rabbit_auth_backend_internal:set_tags/3
    
    [#153436163]

commit 3e6ae43b40f1704f7e4a2f29197b59e3811329e0
Merge: d1e52956b ce827cf68
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 9 16:57:23 2018 +0300

    Merge pull request #1467 from rabbitmq/rabbitmq-server-story-153435857-master
    
    Internal authN backend: make it impossible to successfully log in with a blank password (master)

commit e091696e1e73b5d04efe4d71e0a29b5bd45a9f49
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jan 8 16:22:19 2018 +0300

    Log message typos

commit 0845abb5ae95fc080bf29b10d91cd3027970749e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jan 8 15:27:13 2018 +0300

    Cosmetics

commit ce827cf68fcbfa845677d1ba0f2c4e0150e1f3bb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jan 8 16:22:19 2018 +0300

    Log message typos

commit 9df8a101b3d677fc99c9580a185191f13cc94a5e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jan 8 15:27:13 2018 +0300

    Cosmetics

commit 1aa3065cf8ad1c7ddbd870e3d362b649a652028b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 5 16:22:43 2018 +0300

    Prevent internal authN backend from accepting blank passwords
    
    Passwordless users were never meant to be used this way. Since
    the EXTERNAL authentication mechanism won't use this backend at all,
    this is a reasonable safeguard to put in place.
    
    [#153435857]
    
    (cherry picked from commit bd40475057446c841c9531515d452df532841ec0)

commit bd40475057446c841c9531515d452df532841ec0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 5 16:22:43 2018 +0300

    Prevent internal authN backend from accepting blank passwords
    
    Passwordless users were never meant to be used this way. Since
    the EXTERNAL authentication mechanism won't use this backend at all,
    this is a reasonable safeguard to put in place.
    
    [#153435857]

commit d1e52956bb415fd79ee19347504a10640213d829
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 3 18:07:15 2018 +0800

    Explain the heads in rabbit_auth_backend_internal:user_login_authentication/2.
    
    [#153435857]
    
    (cherry picked from commit 20945a9ba27d4ab35e431bc9552962b92c54ed71)

commit 82ed78914bf0c121f1ba367c15966b51219e142e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 3 18:07:15 2018 +0800

    Explain the heads in rabbit_auth_backend_internal:user_login_authentication/2.
    
    [#153435857]

commit eed0d39554e78af942512f3027d259645ba6305e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 2 11:53:24 2018 -0800

    Do not quote RABBITMQ_CTL_ERL_ARGS and ignore shellcheck warning
    
    (cherry picked from commit 9c79348ed61d2c803ec4e6aa8153177fed282a18)

commit 9c79348ed61d2c803ec4e6aa8153177fed282a18
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jan 2 11:53:24 2018 -0800

    Do not quote RABBITMQ_CTL_ERL_ARGS and ignore shellcheck warning

commit a8301fbfa03beb0cb4f411eab89af0e404ee8a9f
Merge: 9b82020e2 f2960e445
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 2 15:00:55 2018 +0800

    Merge pull request #1462 from rabbitmq/rabbitmq-server-1461
    
    Run escript and use RABBITMQ_CTL_ERL_ARGS env variable

commit 239f8334b5a7705b64e293b5c8bc6afa40b58ecf
Merge: c452eb8c5 401a0b9f3
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 2 03:25:28 2018 +0800

    Merge pull request #1463 from rabbitmq/rabbitmq-server-1461-master
    
    Merge rabbitmq-server-1461 to master

commit 401a0b9f374b1bd60b4257ce9c2278b35fd4f4d4
Merge: c452eb8c5 f2960e445
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Dec 29 13:58:18 2017 -0800

    Merge branch 'rabbitmq-server-1461' into rabbitmq-server-1461-master

commit f2960e4452b75cda5763d7b33ffb4013c04f815d
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Dec 29 13:56:23 2017 -0800

    Run escript and use RABBITMQ_CTL_ERL_ARGS env variable
    
    Fixes #1461

commit 9b82020e2cf4b081311bcbfe6ac06ac37547d00d
Merge: e56392f60 6bd51a015
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Dec 30 03:36:43 2017 +0800

    Merge pull request #1459 from rabbitmq/rabbitmq-server-1456
    
    Add lager backend that logs to amq.rabbitmq.log

commit c452eb8c54e6d7b4857c047b53a1d6bb2b3252c3
Merge: 01687e5ce ccfc92d1d
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Dec 30 00:41:23 2017 +0800

    Merge pull request #1460 from rabbitmq/rabbitmq-server-1456-master
    
    Merge rabbitmq-server-1456 (#1459) to master

commit 6bd51a0153660d21c1ed9d573ce40d58f7d90af4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Dec 30 00:23:01 2017 +0800

    log.rabbit => log.exchange
    
    We already have log.file, log.syslog. "rabbit" is not really
    a logging mechanism.
    
    (cherry picked from commit ccfc92d1da51672c354cebc91e5fea31db16c57e)

commit ccfc92d1da51672c354cebc91e5fea31db16c57e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Dec 30 00:23:01 2017 +0800

    log.rabbit => log.exchange
    
    We already have log.file, log.syslog. "rabbit" is not really
    a logging mechanism.

commit 698e6da31c41f17d45086265a53ae62d07e4670d
Merge: d6fea890a 946893151
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 12:02:17 2017 -0800

    Merge branch 'rabbitmq-server-1456' into rabbitmq-server-1456-master

commit 9468931517d9e51fc9167d35432f37744c195908
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 09:42:17 2017 -0800

    Add lager backend that logs to amq.rabbitmq.log
    
    Fixes #1456
    
    I used the `lager_console_backend` as a model for creating `lager_rabbit_backend`
    
    Only try to declare amq.rabbitmq.log exchange once every five seconds as vhost will not be available immediately

commit d6fea890a83e7be656fe55baf166f1d19a4db4a4
Merge: 4feb62864 8c829b2ad
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 11:59:06 2017 -0800

    Merge branch 'rabbitmq-server-1456' into rabbitmq-server-1456-master

commit 8c829b2ad8441d15ff2b11ab6008be49ec221318
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 09:42:17 2017 -0800

    Add lager backend that logs to amq.rabbitmq.log
    
    Fixes #1456
    
    I used the `lager_console_backend` as a model for creating `lager_rabbit_backend`
    
    Only try to declare amq.rabbitmq.log exchange once every five seconds as vhost will not be available immediately

commit 4feb628646ad6d9195a0e8275f20b009db4b252c
Merge: 01687e5ce 2dc428f86
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 11:53:16 2017 -0800

    Merge branch 'rabbitmq-server-1456' into rabbitmq-server-1456-master

commit 2dc428f86f6fe1b73ac75a7f60b601eda68aa012
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Dec 28 09:42:17 2017 -0800

    Add lager backend that logs to amq.rabbitmq.log
    
    Fixes #1456
    
    I used the `lager_console_backend` as a model for creating `lager_rabbit_backend`
    
    Only try to declare amq.rabbitmq.log exchange once every five seconds as vhost will not be available immediately

commit 01687e5ce85369338987824e95e733f0cd525cb7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 15 15:08:57 2017 +0100

    Travis CI: Update config from rabbitmq-common

commit e56392f60544ba7c26f1bc18feee493861b8855b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 15 14:45:57 2017 +0100

    Travis CI: Update config from rabbitmq-common

commit d44c477b2dd040cfdc8586624ff1157fa4ccfd60
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 15 11:07:44 2017 +0300

    Fix a typo spotted by xref/Concourse
    
    (cherry picked from commit 3d8c973e2821d04641fb54c08105ff8e13857f62)

commit d04986222815f9345c0e47de14924699ab0a000f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 14 18:37:46 2017 +0300

    Add an optional init step for peer discovery mechanisms
    
    Sometimes they need to perform some initialisation very early on,
    e.g. to configure HTTP client proxy settings or similar.
    
    Part of rabbitmq/rabbitmq-peer-discovery-common#5.
    
    [#153615554]
    
    (cherry picked from commit e08895d07c87bd0ba0879d1a23c856c233f29191)

commit 3d8c973e2821d04641fb54c08105ff8e13857f62
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 15 11:07:44 2017 +0300

    Fix a typo spotted by xref/Concourse

commit 4f9f87baa316418feb64d76f84bc3cf3b8b2c82d
Merge: ee7ffd2e2 e08895d07
Author: D Corbacho <diana@rabbitmq.com>
Date:   Thu Dec 14 17:30:18 2017 +0100

    Merge pull request #1451 from rabbitmq/rabbitmq-peer-discovery-common-5
    
    Add an optional init step for peer discovery mechanisms

commit e08895d07c87bd0ba0879d1a23c856c233f29191
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 14 18:37:46 2017 +0300

    Add an optional init step for peer discovery mechanisms
    
    Sometimes they need to perform some initialisation very early on,
    e.g. to configure HTTP client proxy settings or similar.
    
    Part of rabbitmq/rabbitmq-peer-discovery-common#5.
    
    [#153615554]

commit ee7ffd2e2cad1c748954245788842d77153e5434
Merge: 314f68b56 4657a73ac
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Dec 12 19:16:44 2017 +0300

    Merge pull request #1436 from rabbitmq/looking-glass-id-processes
    
    ID processes in Looking Glass and trace more by default

commit 4657a73ac48d83505c29ce185ef5db83e5fefd1e
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Nov 29 11:08:57 2017 +0100

    Enable the process_dump option in Looking Glass by default
    
    This option generates a lot more data (like the send option)
    but the resulting file, by default, can be used to produce
    all the different outputs that Looking Glass supports. This
    time it is necessary to produce flame graphs.

commit 3a7e5430eac26c72c44df506558eb03f22ba6a14
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Nov 29 11:03:16 2017 +0100

    Trace all modules by default in Looking Glass

commit f0c2ffa768df8be093bf2aa4654b03a17f8751b0
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Nov 29 11:03:04 2017 +0100

    Add a macro to identify processes in Looking Glass

commit b1a4874722c7f53010856eb3653ad4724e23f454
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 7 20:17:48 2017 -0800

    Add config schema entry for total_memory_available_override_value
    
    Closes #1445.
    
    [#153501620]
    
    (cherry picked from commit 314f68b56fb93333e392c5e49b0745f5a83f03ad)

commit 314f68b56fb93333e392c5e49b0745f5a83f03ad
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 7 20:17:48 2017 -0800

    Add config schema entry for total_memory_available_override_value
    
    Closes #1445.
    
    [#153501620]

commit ce6c81257753117c8c8653984a7c41bd29546ca4
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Sat Nov 11 22:45:08 2017 +0000

    Add test for the application of message-ttl policy retroactively

commit cbb34bbc93b8353a30739cc5f04a5cda20b727f6
Merge: 680d75316 88257b60c
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Dec 5 11:36:35 2017 -0800

    Merge pull request #1425 from rabbitmq/retroactive-operator-policy
    
    Add test for the application of message-ttl policy retroactively

commit 9fd6620a58e3c51eeb6d2c3369242fbb2823bb2e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 1 15:16:11 2017 +0100

    Update rabbitmq-components.mk

commit 680d753164ab7cc8caa6df7b2a0fe9bc551df961
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 1 10:37:07 2017 +0100

    Update rabbitmq-components.mk

commit 29c4192f65e052072a18885af88376e223ff9731
Merge: b8c9fa258 d0dcf9e8d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Nov 28 17:47:55 2017 +0000

    Merge branch 'rabbitmq-server-1434' into v3.7.x

commit ce5cc9e0c2e4b80df322342d6af55f96247232ba
Merge: b8c9fa258 d0dcf9e8d
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Nov 28 17:45:20 2017 +0000

    Merge pull request #1435 from rabbitmq/rabbitmq-server-1434
    
    Change application environment variable names for logs in windows scripts

commit d0dcf9e8dcc887c7c71d4a1de748f483729873b7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Nov 28 15:45:11 2017 +0000

    Change application environment variable names for logs in windows scripts.
    
    Follow up to #1335
    Fixes #1434
    [#153216683]

commit b8c9fa258ddbdca9b06bd064ed2fb4f8fe07c047
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 28 14:00:31 2017 +0100

    Update rabbitmq-components.mk

commit 17d284fe478e8aad8dc62c3ffd48f49bd603cf82
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 28 13:06:54 2017 +0100

    Update rabbitmq-components.mk

commit 91813d45d5acba3575793a8121c2d140c0c5be88
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 28 12:59:23 2017 +0100

    Update rabbitmq-components.mk
    
    [ci skip]

commit ed1b37a4f0756009c195ac03b2d22351df5a79a6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 28 12:46:43 2017 +0100

    Update rabbitmq-components.mk

commit d440aaf25743b3305ac4dacfd7e8f0c3881c3941
Merge: ff8f76dfa 53d4c82a2
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 28 00:04:17 2017 +0300

    Merge pull request #1433 from rabbitmq/rabbitmq-cli-226
    
    Check that rabbit application is running when trying to enable plugins.

commit 53d4c82a2493f424ec71ceb5a49956397daef99f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 27 18:54:45 2017 +0000

    Check that rabbit application is running when trying to enable plugins.
    
    If the node is started, but rabbit application is not running,
    plugins can fail to start when enabled.
    
    Check for rabbit application and return an error.
    
    Part of #rabbitmq/rabbimq-cli#226
    [#153184802]

commit ff8f76dfa17d4e7e862d06caa96523f021de7b83
Merge: 51586b343 85fcede2b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 23 15:37:58 2017 +0300

    Merge branch 'stable'

commit 85fcede2b42713eb682b5e7968636f909b264aa4
Merge: d704c5501 5977c1a0b
Author: D Corbacho <diana@rabbitmq.com>
Date:   Thu Nov 23 12:06:09 2017 +0000

    Merge pull request #1431 from rabbitmq/rabbitmq-server-gm-avoid-infinite-loop
    
    Avoid infinite loop when dropping gm queue entries.

commit 5977c1a0ba6bded40b4a20a5317c4f62489743cf
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Nov 22 17:27:48 2017 +0000

    Avoid infinite loop when dropping gm queue entries.
    
    Since `out` operation on empty queue is idempotent `queue:out(B) = {empty, B}`,
    there can be a potential infinite loop when dropping messages.
    Matching that there is a value to drop.
    Empty A queue should be handled by second clause.
    Related to #779

commit 51586b343bcd3b9bb2e3138e9f3a35d997d6fc1d
Merge: 0d576e23b f10b71c14
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Nov 22 17:37:29 2017 +0000

    Merge pull request #1428 from rabbitmq/rabbitmq-server-1427
    
    gm: adapt has_pending_messages/1 for maps

commit f10b71c140ceed8af9fbe43a1d4b8222a889bd88
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Nov 22 19:35:26 2017 +0300

    gm: adapt has_pending_messages/1 for maps
    
    Closes #1427.
    
    [#153094258]

commit 0d576e23bc83d8c8047ed7d90737fc5e720bf6e3
Merge: df25c1301 635c518f0
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Nov 15 14:52:46 2017 +0000

    Merge pull request #1374 from rabbitmq/rabbitmq-server-995
    
    An option to discard messages if queue is full.

commit 88257b60c84080dd7818a39ea77e5ee930eecf8f
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Sat Nov 11 22:45:08 2017 +0000

    Add test for the application of message-ttl policy retroactively

commit 635c518f0c4a94f46ebd309da5baf0b6f78b00d1
Merge: 2f8190bfa df25c1301
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 9 14:24:15 2017 +0300

    Merge branch 'master' into rabbitmq-server-995

commit df25c1301da8d3d25503f5bdfa15fad6b1433eb8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 8 15:49:04 2017 +0100

    Travis CI: Update config from rabbitmq-common

commit a7bb375e8aec501b7746f1422e7cc8f21e846d3c
Merge: c26f0b567 d704c5501
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 8 15:48:37 2017 +0100

    Merge branch 'stable'

commit d704c5501b423244bf63e458f1192518915150bb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 8 14:58:22 2017 +0100

    Travis CI: Only run fast testsuites
    
    We could run all testsuites, each in dedicated jobs, because separately,
    they should take less than 50 minutes. However, this would bloat the
    build page and blocks other jobs for a significant time. Using `ct-fast`
    should be enough in Travis CI. All testsuites are still running in
    Concourse anyway.
    
    [#152509619]

commit 2b7cee714c28faffd6ad80bce3d66918cae47fc7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 8 14:20:10 2017 +0100

    Travis CI: Update config from rabbitmq-common

commit 2f8190bfac303f853554014423f081324690491e
Merge: 9257d5e7b c26f0b567
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Nov 8 08:56:28 2017 +0300

    Merge branch 'master' into rabbitmq-server-995

commit c26f0b567b09bfc4403198339cd0f2d207b83215
Merge: e811e30ff 7258aa4d7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 7 07:18:14 2017 +0200

    Merge branch 'stable'

commit 7258aa4d70ca8092c025a1f95571a940654c408b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 7 07:17:10 2017 +0200

    Remove inline comments from example systemd service file
    
    References #1422.

commit 9257d5e7b53ed3bb65dee09d42e3f570e090b55a
Merge: da2b0ccda e811e30ff
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Nov 3 13:49:50 2017 +0200

    Merge branch 'master' into rabbitmq-server-995

commit e811e30fff3ff9170c8103d100e24b4c0469f5ff
Merge: 27bf1d686 dff1d2072
Author: Luke Bakken <luke@bakken.io>
Date:   Thu Nov 2 11:22:46 2017 -0700

    Merge pull request #1393 from rabbitmq/rabbitmq-server-batch-betas-lrb
    
    Don't use process dictionary for bump_reduce_memory_use message

commit dff1d2072279ae5fbf237af9073cddee4fcdcb88
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 12 06:20:44 2017 -0700

    Use rabbit_queue_behaviour and callback
    
    Alternative for #1388 that does not use process dictionary.
    
    Requires rabbitmq/rabbitmq-common#228
    
    Fix waiting_bump values

commit da2b0ccda34e85048b35d2633836d2ec708dd488
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Nov 2 10:43:13 2017 +0000

    Move cleanup to end_per_testcase

commit bb608f437bd800d88cf6fbdb9018752662221c04
Merge: 67c9b9ce4 27bf1d686
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Nov 1 17:00:07 2017 -0700

    Merge branch 'master' into rabbitmq-server-995

commit 27bf1d6869cba44122e595655a5c0d612152a3f4
Merge: e1c92ec36 627339a62
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Nov 1 05:45:04 2017 +0300

    Merge pull request #1414 from rabbitmq/rabbitmq-management-499-followup
    
    Report strategy, erlang total, rss and allocated memory

commit 627339a62e0c063ed07afe347c19c08ff24253fc
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Oct 31 15:31:27 2017 +0000

    Use strategy as key
    
    [#152311595]

commit e1c92ec363a17746199773e6e9a22a323ccb6c7e
Merge: afe052f5c de5bc6ef8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 31 14:51:07 2017 +0300

    Merge branch 'stable'

commit de5bc6ef8fe782a5bb1901bf44a68d889418bf9b
Merge: b822e85b9 533d2df5d
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 31 14:48:32 2017 +0300

    Merge pull request #1413 from rabbitmq/mk-dont-throw-when-connection-pid-is-non-local
    
    Make rabbit_networking:close_connection/2 more benign

commit 9b6593a0711f0a83c03637c56861d46cbbaebf2a
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Oct 31 11:41:06 2017 +0000

    Report strategy, erlang total, rss and allocated memory
    
    [#152311595]

commit 67c9b9ce4f9e185baa89af0df7b11c8d8b1b8056
Merge: e65e740b2 afe052f5c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 31 01:30:08 2017 +0300

    Merge branch 'master' into rabbitmq-server-995

commit 533d2df5dd1fbce2eb2a32799f78b785e476bd08
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Oct 30 19:47:53 2017 +0300

    Make rabbit_networking:close_connection/2 more benign
    
    The function relies on a fanout to all running cluster nodes
    which in turn check their local connection process group.
    All errors that might arise are ignored.
    
    There are at least two scenarios where the current behavior makes
    little sense:
    
     * A connection process has just terminated (but is still present in the stats DB)
     * A node could not respond (or respond in time) to the fanout
    
    In both cases claiming that connection pid is "not a connection pid"
    is misleading and likely will leave the user puzzled. This change
    makes connection_close/2 more benign: it simply logs a warning and returns
    instead of throwing.
    
    There are only two call sites that use it: rabbitmqctl and an HTTP API
    handler, so the chances of non-connection pids passed in are pretty slim.
    
    Per discussion with @gerhard.

commit afe052f5cdd8535c7d4eaec2d7c10435ca7925e7
Merge: 3e6d1ad20 b822e85b9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Oct 30 18:37:20 2017 +0300

    Merge branch 'stable'

commit 3e6d1ad207b5dc5b5ab5fff39d0d82f0d45915c0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Oct 30 15:33:35 2017 +0000

    Replace orddicts with maps

commit b822e85b94278282ed014cfc61afc836df132108
Merge: d687bf0be b8878e777
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 30 18:31:58 2017 +0300

    Merge pull request #1412 from rabbitmq/rabbitmq-server-1411
    
    Accept strings and atoms for queue_master_locator setting

commit b8878e777ce82e5f1406d7ac0c6beea94d984d52
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Oct 30 08:13:03 2017 -0700

    Accept strings and atoms for queue_master_locator setting
    
    Fixes #1411

commit c0dcb2b3ee4386258a8e3e278ebdd7a95b2fde2f
Merge: 64830ba73 d687bf0be
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Oct 29 16:25:36 2017 +0300

    Merge branch 'stable'

commit d687bf0be3a23fdb63c1c0b36db967285a112c74
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Oct 29 16:19:30 2017 +0300

    Bump rabbit.num_ssl_acceptors default to 10
    
    Previously the value was limited to 1 due to a bug in Ranch 1.0:
    it didn't depend on the ssl app, which means Ranch/ssl shut down order
    was not guaranteed. This led to scary but entirely harmless exception traces
    in the log, one per TLS acceptor.
    
    The issue is no longer present in Ranch 1.3.x and 1.4.0.
    
    Per discussion with @essen.

commit 64830ba736486add12c6faff437a05fd1ce9cb15
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 28 02:31:06 2017 +0300

    Don't assert on node start success
    
    Nodes fail to start and log that a node with such name is already running.
    The rest of the test is functional, however.
    
    This is a workaround to get the pipeline going, it could be that the
    VM does not terminate in some cases we expect in this long test. In certain
    parts I don't see why it would.

commit 1972f8922d21bed1a6ad4f2ebc9236cbaae0d6f5
Merge: 32c48cd76 2879048ad
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Oct 28 01:42:16 2017 +0300

    Merge pull request #1408 from rabbitmq/rabbitmq-server-1367
    
    Configurable default consumer prefetch for new channels

commit 2879048ad6df40b64624f366f72009778fcbcaa8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 28 01:41:30 2017 +0300

    Explain

commit 4bac30db6037f8c7f51cb0c759310186cd416ad4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 28 01:32:29 2017 +0300

    Compile from scratch

commit 32c48cd7636885f27c24c60e648fd911ff8acd31
Merge: 21879a91b 7da27f3d3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Oct 27 19:39:18 2017 +0100

    Merge branch 'stable'

commit 7da27f3d3b80beddc1ac503c388df78972153ea0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Oct 27 18:00:50 2017 +0100

    Update clustering management test to support transient rabbit app

commit 30864d2a57a4d475eef672885c509c28301165fe
Merge: 7e1f4238c b60775ed0
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Fri Oct 27 12:26:43 2017 +0100

    Merge pull request #1406 from rabbitmq/rabbitmq-server-1216-backport
    
    Start `rabbit` application as temporary in tests.

commit 50495d6e8cae33e362d7063b5b57aaa3686b2612
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Oct 27 10:30:29 2017 +0100

    Configurable default consumer prefetch for new channels
    
    rabbitmq-server#1367
    [#151216783]

commit 7e1f4238cf9f9d6e91ecc260de3166db7d11e218
Merge: c06a1f11c 710733e4c
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Fri Oct 27 11:57:00 2017 +0100

    Merge pull request #1407 from rabbitmq/rabbitmq-server-1378-revert
    
    Re-introduce consumer bias & set to 2.0

commit 710733e4c727a8135951ec75ee3c818e6a710e70
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 26 17:06:02 2017 +0100

    Set consumer bias to 2 to prioritise consumers
    
    [#152235655]

commit dde69cae9523a9a221d44df1c6b501ff6057a0d6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 26 17:01:19 2017 +0100

    Revert "Remove consumer bias & allow queues under max load to drain quickly"
    
    This reverts commit 155eb6b0bffe3126ab18ab228296821ce0dc1f8c.

commit b60775ed006f5f621b0ce4a1e71a7c97d8ee2ff6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 26 16:43:14 2017 +0100

    Start `rabbit` application as temporary in tests.
    
    Some tests output can break when `rabbit` application failure
    stops the node. Make it possible to configure restart type.

commit 21879a91b19b4c959d7b66d73a31b638cb4f4dcf
Merge: cb8de07db c06a1f11c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 26 17:06:55 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_vm.erl

commit c06a1f11c81e13d6b420ecec0d1e69f36865d7d7
Merge: 2545c1b13 d8f2852c6
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 26 16:46:16 2017 +0300

    Merge pull request #1404 from rabbitmq/rabbitmq-management-499
    
    Add more sections to the memory breakdown.

commit cb8de07dbb357edd1202baa0bdc487d80a861285
Merge: e9d1588e5 2545c1b13
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 25 21:28:25 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_channel.erl
            src/rabbit_control_main.erl

commit 2545c1b136f4993019bf8368057def2a546ed9f8
Merge: 47f168b7a 079cb2af1
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 25 21:05:39 2017 +0300

    Merge pull request #1403 from rabbitmq/performance
    
    Performance enhancements

commit 47f168b7a8326b0cc859a91e8089c965af85c061
Merge: b55f79da5 1711dd0bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 25 20:09:51 2017 +0300

    Merge pull request #1402 from rabbitmq/lrb-qa-152075395
    
    Handle errors returned via RPC during shutdown

commit 1711dd0bcaedd7a1b34f05e9d2f40285f621941a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Oct 25 09:07:36 2017 -0700

    Review changes

commit 17a4876ac410abe6ba306ef568fa5838010fc7a8
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Oct 25 08:57:01 2017 -0700

    Make error processing a bit smarter and add comments as to why

commit d8f2852c6df9346b13168e554a29b21c118b60bd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 25 16:29:55 2017 +0100

    Add more sections to the memory breakdown.
    
    If a node memory is measured using `allocator` or `rss`
    strategies, we can calculate unused memory and report it
    separately in the memory breakdown.

commit 079cb2af15d2ab72b1ce30d258087919c2030627
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Oct 25 14:54:24 2017 +0100

    Avoid lists when generating channel stats
    
    [#152240490]

commit 60487ec7a2c6ab1f5c90504272bad277c49e7053
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Oct 25 07:08:10 2017 -0700

    Handle catch all (error) case

commit accd6aaf6bbbac378a8acafdfeeef0af539a9f41
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Oct 25 08:36:09 2017 +0100

    Comment optimisation in format channel stats
    
    [#152240490]

commit a05d60f2cd93c94f0f0d9376ff3c25f34f82b62a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Oct 24 17:16:46 2017 -0700

    Trigger error in shutdown
    
    Added an exit() statement to trigger an error and then some case statements to handle it.
    
    QA of commit 51aca8851eba66445ad5b164fc92b2ffa0692fc2

commit e9d1588e5b3e9fa767f6665cbbe70997e98332d9
Merge: 4c5ebd99f b55f79da5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Oct 24 11:21:52 2017 +0100

    Merge branch 'stable'

commit b55f79da5fd50ead74308d8ad3bcf7121dac38c4
Merge: 88485d9d9 dc915bac0
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Mon Oct 23 18:42:56 2017 +0100

    Merge pull request #1388 from rabbitmq/rabbitmq-server-batch-betas
    
    Flush messages to disk in batches.

commit 4c5ebd99fc3cae32e71d06a761518fe0e221a536
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 21 23:48:08 2017 +0300

    Support rabbit.connection_max in Cuttlefish schema

commit 08700282b7176d62cb262a66eceb576610d66c4d
Merge: 18cb88ee2 88485d9d9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 20 21:26:30 2017 +0300

    Merge branch 'stable'

commit 88485d9d9e5586394fe3bb162181c0e723152a53
Merge: 1409ce20c 7db615949
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 20 21:25:29 2017 +0300

    Merge branch 'cloudamqp-max_connections' into stable

commit 7db615949f34162f9b283b63cae528cd25d21317
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 20 21:25:06 2017 +0300

    Add rabbit.connection_max to rabbitmq.config.example

commit e6448b2170fcc48cc6275f917ac025e13c43ddf2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 20 19:30:56 2017 +0300

    rabbit.max_connections => rabbit.connection_max
    
    We already have rabbit.channel_max, frame_max.

commit ae15f7127938c6844acaac9740e7aef83338c793
Merge: 1409ce20c a609f291b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 20 19:20:37 2017 +0300

    Merge branch 'max_connections' of https://github.com/cloudamqp/rabbitmq-server into cloudamqp-max_connections

commit a609f291bab1e76cad7b043ab70ce33e7815ce6a
Author: Carl Hörberg <carl.hoerberg@gmail.com>
Date:   Fri Oct 20 17:08:33 2017 +0200

    use rabbit_misc:get_env/3 for backward compability

commit 18cb88ee282b359987b42a36db2670ad76787464
Merge: f61f043d4 1409ce20c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 20:07:02 2017 +0300

    Merge branch 'stable'

commit 1409ce20c40bfeeb3d82065119a2caf5f9b7e54e
Merge: be796e0c6 51aca8851
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 20:06:12 2017 +0300

    Merge branch 'rabbitmqctl-shutdown-custom-exit-code-to-indicate-server-reported-failure' into stable

commit 51aca8851eba66445ad5b164fc92b2ffa0692fc2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 20:04:23 2017 +0300

    Use a special exit code when server reports an error on shutdown
    
    This way tools that manage RabbitMQ nodes can detect this condition
    among a bunch of fairly generic exit codes.
    
    Note that when a timeout occurs, we still use a "temporary failure" code.
    
    See rabbitmq/rabbitmq-server#1396 for context.

commit f61f043d4b488e74983642f519521e90ffa77755
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 19 07:03:03 2017 -0700

    Ensure "rss" is the default in cuttlefish configuration example

commit e7ca399a9f310de2cfe86e9bfe335f32fed19bf5
Merge: 75d626aec be796e0c6
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 19 07:02:14 2017 -0700

    Merge branch 'stable'

commit be796e0c6fe9237ab5e9b1bae86b0de2f7b0a19a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 19 07:01:44 2017 -0700

    Ensure "rss" is the default in configuration example

commit dc915bac01ab09614ab055818f7b2a5e13200fd5
Merge: c574fc5c5 9361e2d39
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 14:53:22 2017 +0300

    Merge branch 'stable' into rabbitmq-server-batch-betas

commit 75d626aeca02c664ab4071f31fbbd4484c2c5603
Merge: 4c7c5cf61 e0164ec63
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 03:39:28 2017 +0300

    Merge branch 'default-to-rss-152081051-master'

commit e0164ec636dfdc144113dbe807cd6cf6510052fd
Merge: 5e711cecd 4c7c5cf61
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 03:01:25 2017 +0300

    Merge branch 'master' into default-to-rss-152081051-master

commit 4c7c5cf6114f3b0ed327923812ca7202e5ac093b
Merge: 1cbfd896d 9361e2d39
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 19 02:59:48 2017 +0300

    Merge branch 'stable'

commit 9361e2d3936bac21d6b28c73dc431bb41d387b50
Merge: 8d8246b6a 5b16c4e08
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 19 02:59:33 2017 +0300

    Merge pull request #1397 from rabbitmq/default-to-rss-152081051
    
    Default mem calc strategy should be "rss"

commit 5e711cecdaee61c503e72a2abc7437cf2db26d53
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Oct 18 14:46:04 2017 -0700

    Default mem calc strategy should be "rss"
    
    This is due to a scenario in which the Erlang VM allocator stats report a huge increase in memory consumption which is only reflected in VSS increase, not RSS
    
    PT #152081051

commit 53072b2909dfba8a9a7c8d096ff45b9b812d6427
Author: Carl Hörberg <carl.hoerberg@gmail.com>
Date:   Wed Oct 18 23:36:12 2017 +0200

    Allow configuring max connections through config

commit 5b16c4e08813dae10aac12f925ab79265d0626b5
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Oct 18 14:33:39 2017 -0700

    Default mem calc strategy should be "rss"
    
    This is due to a scenario in which the Erlang VM allocator stats report a huge increase in memory consumption which is only reflected in VSS increase, not RSS
    
    PT #152081051

commit c574fc5c528be505f846ff51cf8cb6f9325c694e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 12 18:02:15 2017 +0100

    Fix the flag value for queue waiting message paging continuation

commit f1de592af35903d542ee387bcc7d7a6d592728db
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Oct 10 17:59:53 2017 +0100

    Flush messages to disk in batches.
    
    If messages should be embedded to a queue index, there will
    be no credit flow limit, so message batches can be too big
    and block the queue process.
    Limiting the batch size allows consumer to make progress while
    publishers are blocked by the paging-out process.
    
    [#151614048]

commit 1cbfd896d184f6f9cf7af0cca9ae63f77b2504dd
Merge: 84612273b 8d8246b6a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 18 02:18:27 2017 +0300

    Merge branch 'stable'

commit 8d8246b6ac249956125d082de057ae8f74725f0f
Merge: 904744d2c ca3be6c1e
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 18 02:17:33 2017 +0300

    Merge pull request #1396 from rabbitmq/lrb-fix-shutdown-tests
    
    Shutdown cannot fail

commit ca3be6c1e267565780c12d6755a291c8e1594ece
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 18 10:28:53 2017 +0100

    Shutdown cannot fail

commit 904744d2c3e039105e2c3aeba4c2bb3ceff27fb2
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Tue Dec 20 17:22:12 2016 +0000

    Ignore indirect dependencies of rabbit in rabbit_plugins
    
    The goal of maybe_keep_required_deps() is still the same: we don't want
    to list applications from $RABBITMQ_PLUGINS_DIR the rabbit application
    depends on. Now, the function handles indirect dependencies.
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#136346167]
    
    This commit is cherry-picked from `master` because rabbit_common now
    depends on recon: having rabbit_common depend on 3rd-party applications
    didn't happen so far in stable and wasn't supported. This broke the
    creation of the standalone package.
    
    (cherry picked from commit cbbcc3e32f97b6047b4f82f0776717dd3e85430c)

commit 84612273b63c4bb24aa49573e4184c23a45ce1a7
Merge: f327e556e a2640d196
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 02:18:43 2017 +0300

    Merge branch 'stable'

commit f327e556e319a491584b5fd89d4d5822a819e10e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 02:17:04 2017 +0300

    Reduce delta between rabbitmq.conf.example and rabbitmq.config.example

commit a2640d1968b0c6f85392abbe9d537971ce4c0123
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 02:15:46 2017 +0300

    Typo

commit d3b9889daeeae1daf5c12e1c7c219ec242d1fc0e
Merge: 4998adab4 95c180d50
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 01:57:57 2017 +0300

    Merge branch 'stable'

commit 95c180d5083ae781ce410a2cf4961fe1822ac848
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 01:54:09 2017 +0300

    Wording

commit a031e3e26fdeba06629d3caeb78cc50d20608aa3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 01:52:42 2017 +0300

    Corrections

commit 4998adab4008ac67c5f62b7466a14275ae213097
Merge: 7fe1ff19e 567047d44
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 01:47:41 2017 +0300

    Merge branch 'stable'

commit 567047d44a43093660101aa6146716ec2bb98e49
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 17 01:47:25 2017 +0300

    Edits, links

commit 7fe1ff19e2d1b01ed23fc4eb2b9edbe2a436cf8f
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 17 01:40:01 2017 +0300

    Update rabbitmq.conf.example

commit 7c40f64b899e90b955d022afabf056784ec22a58
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 17 01:36:15 2017 +0300

    Update rabbitmq.conf.example

commit 35eeab058ce30f6ac83adc4cd965038670adaf63
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 16 21:46:23 2017 +0300

    Wording

commit f75021818e2962f94566842fea4a28536015d7d5
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 16 21:40:15 2017 +0300

    Updates to management plugin section

commit 64014f1d6ff80a8f4f0a898f0e2b48483f682e49
Merge: d6bab9957 36a6a6890
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 13 14:57:50 2017 +0200

    Merge branch 'stable'

commit 36a6a6890c2963a8c9780824b6b1b79903098ecf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 13 14:33:02 2017 +0200

    Update rabbitmq-components.mk

commit d6bab9957009634b3215abbef7384204341f8792
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 13 13:11:38 2017 +0200

    Update rabbitmq-components.mk

commit 20f71248893e356e6a00ff47ab3acef9acb6cd1b
Merge: b54a3ddf9 fac9e4f75
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 13 12:52:40 2017 +0200

    Merge branch 'stable'

commit fac9e4f75fdcadeae2162dd06d2cc178079bf037
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 13 12:15:38 2017 +0200

    Update rabbitmq-components.mk

commit b54a3ddf91ba72ffe71f6629941b57556cdda1af
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 12 20:48:28 2017 +0100

    Revert updating cuttlefish script

commit c2e8d8476a2e3e696a3845c71edf9f062d920436
Merge: c779305e4 7a37407b3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 12 20:19:00 2017 +0300

    Merge branch 'stable'

commit c779305e448c542278144666365e85016e2abe24
Merge: 7e727be95 46074fa3e
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 12 17:52:27 2017 +0100

    Merge pull request #1394 from rabbitmq/rabbitmq-common-224-master-lrb
    
    Update cuttlefish schema for rabbitmq/rabbitmq-common#224 changes

commit 7e727be95f1c15111547c3f713f3985d8015c2cb
Merge: 2fee330fb 9a7e4e61e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Oct 12 19:43:25 2017 +0300

    Merge branch 'rabbitmq-common-224-master-lrb'

commit 9a7e4e61ec625f6cd7919eb36d76dae2b73ea927
Merge: 78e88ed8b 2fee330fb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Oct 12 19:31:52 2017 +0300

    Merge branch 'master' into rabbitmq-common-224-master-lrb

commit 2fee330fb67ab2de2582298c407cd66ed4319dfb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 11 07:06:57 2017 +0100

    Update default allocator strategy to match rabbitmq/rabbitmq-common#224

commit 3f1a4c6fae7dcd97a96f6aa9670cc66bc0651dd3
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:51:34 2017 +0100

    Ignore maps:from_list in xref
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit 8fb5c665036283d545bf42414657fd88bdaa3ef1
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:15:20 2017 +0100

    Use maps:from_list so that it compiles on R16B03
    
    Since looking_glass requires Erlang 19, maps:from_list will not be
    called if it's not defined in earlier Erlang versions.
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit f61b60f882d0f736224a5911d050f044bcfd6aa4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 12 17:23:41 2017 +0100

    Update cuttlefish script. Built with OTP-19.2

commit 46074fa3e65ec939c124775c2c55b0a86f6eff8e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 12 09:05:14 2017 -0700

    whitespace

commit 78e88ed8b1d477ddb3eeec5f33a8f398af4cb5ab
Merge: 4a1c169d3 e32c7d3f2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Oct 12 18:59:05 2017 +0300

    Merge branch 'master' into rabbitmq-common-224-master-lrb

commit e32c7d3f281456bad0ee1a47214007668175f6fa
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 11 07:06:57 2017 +0100

    Update default allocator strategy to match rabbitmq/rabbitmq-common#224

commit 828a978ec6f426a5e6af0798d21317f07a7c6695
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:51:34 2017 +0100

    Ignore maps:from_list in xref
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit 0a08082d978b418dcfdf4d62f9133eb1b3f33fdf
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:15:20 2017 +0100

    Use maps:from_list so that it compiles on R16B03
    
    Since looking_glass requires Erlang 19, maps:from_list will not be
    called if it's not defined in earlier Erlang versions.
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit 4a1c169d3148669b6290e27dbd6bc4829a912395
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 12 08:22:19 2017 -0700

    Update Makefile

commit f678d1ba15375b56689d10c6eee4e09177cc5ac4
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Oct 12 08:11:03 2017 -0700

    Add additional vm_memory_calculation_strategy values to cuttlefish conf
    
    Requires rabbitmq/rabbitmq-common#224

commit 7a37407b3f0ee6f53052ba3e40d698dd631471fb
Merge: 2a57ce402 b7840cf5e
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 12 14:15:49 2017 +0100

    Merge pull request #1389 from rabbitmq/rabbitmq-common-224
    
    Update default node memory calculation strategy to match rabbitmq/rabbitmq-common#224

commit 50b978f411e514d6fb41eb6e87020da1498e25d7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 11 20:24:52 2017 +0100

    Update cuttlefish script

commit b7840cf5ef6a0e92afd44fd8a651f8f948505a44
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 11 07:06:57 2017 +0100

    Update default allocator strategy to match rabbitmq/rabbitmq-common#224

commit 52670cba53d3f90ba03f8fd19c0faf768327a17d
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Sun Oct 8 11:09:41 2017 -0700

    Add GitHub issue and pull request templates, update CONTRIBUTING.md

commit 2a57ce402353f643b340e01c44d66a34255275c9
Merge: 3f96e9b69 0f98949c0
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Oct 4 17:56:45 2017 +0200

    Merge pull request #1384 from rabbitmq/integrate-looking_glass
    
    Integrate `looking_glass`

commit 0f98949c03ca5a6f18ffcd8a8725b870f8541aac
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:51:34 2017 +0100

    Ignore maps:from_list in xref
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit 79c1c2f7993e6df0556ac71474ed72a7c0bb925b
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:15:20 2017 +0100

    Use maps:from_list so that it compiles on R16B03
    
    Since looking_glass requires Erlang 19, maps:from_list will not be
    called if it's not defined in earlier Erlang versions.
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit b50cf0f3cc5468b9d1064cbb916ae9afda3a469b
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Oct 4 16:01:59 2017 +0100

    Integrate looking_glass
    
    An Erlang/Elixir/BEAM profiler tool:
    https://github.com/rabbitmq/looking_glass
    
    Signed-off-by: Loïc Hoguin <loic@rabbitmq.com>

commit 5269729a57b8b0b2a74e03d561a8ea6818b38d0c
Merge: 7e64d485e 3f96e9b69
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 3 15:03:55 2017 +0300

    Merge branch 'stable'

commit 3f96e9b69191f7c08bfa0b6f22cf30b82de9a006
Merge: 9e7cea3ae 89a54cd7f
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 3 15:02:51 2017 +0300

    Merge pull request #1382 from rabbitmq/rabbitmq-server-1379
    
    Do not limit paging to disk if hibernated or resumed after credit

commit 89a54cd7f20952875417d5cb16b772abfaaec341
Merge: d1299f42e 9e7cea3ae
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 3 10:29:33 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1379

commit e65e740b2a4d800bafd6d2f7e35ec5a9622a86b4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Oct 2 14:34:39 2017 +0100

    Drop head after changing a policy to drop-head. Clarify TODOs

commit 4e87deff41daee0f79f7b3f92f27539292f45a65
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Sep 28 14:25:02 2017 -0700

    Ensure the new tests are run as part of the cluster_size_3 group

commit 79a00a6f74383543f4ade05b2210bc93ce7d7ecd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Sep 27 10:22:16 2017 +0100

    Rename overflow values to use dashes instead of underscores

commit bf531fd017cbec756ee979299723adce76828c96
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Sep 12 13:34:16 2017 +0100

    Add configurable queue overflow strategy
    
    If a queue is to be overflowed by a delivery it can reject
    the delivery or drop messages from the head.
    To reject delivery overflow can be configured to `reject_publish`,
    to drop head it's `drop_head` (default setting).
    
    Messages which will be rejected should still confirm being routed,
    so mandatory expectations are not accumulated on the channel side.
    
    Slave nodes will only confirm if a message was published or discarded.
    To drop confirms from slaves, all confirms for a message are cleared
    when the message is rejected.
    
    When promoting a new master, left-behind deliveries should
    be rejected if the queue is full, just like normal deliveries.
    
    Fixes #995
    [#151294447]

commit 7e64d485e196c1791df6eff07940a6c5f368a7a0
Merge: f2286b22f 9e7cea3ae
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 2 09:34:56 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_amqqueue_process.erl

commit 9e7cea3ae6dfb89bc14e562812420ee846486220
Merge: 2ccd9717c 43edeb93d
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 2 00:48:31 2017 +0300

    Merge pull request #1378 from rabbitmq/always-prioritise-consumers
    
    Remove consumer bias & allow queues under max load to drain quickly

commit 43edeb93dbef0f0f1e6f66f98da43bf908f0933a
Merge: 155eb6b0b 2ccd9717c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Sep 30 13:09:05 2017 +0300

    Merge branch 'stable' into always-prioritise-consumers

commit f2286b22f929d6b499964b95ad311cf1f634090b
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Sep 29 11:39:42 2017 -0700

    Bump Travis CI Erlang to 20.1

commit 3313372eaee9a6d44e3cd73d616c4012c585ae81
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 29 12:06:28 2017 +0300

    Move name_type/0 to rabbit_nodes

commit 08942e7dcb06ad79e3bc0559e2acacabc6e9c985
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Sep 29 10:04:24 2017 +0100

    Remove rabbit_cli module

commit f9ce80bac08680a8651acec46747084410acfee6
Merge: 62be8a048 2ccd9717c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 28 16:39:47 2017 +0300

    Merge branch 'stable'

commit 2ccd9717cd2d8ce1d51d42913b0c26894ddca535
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 28 16:18:31 2017 +0300

    Revert "Revert "Ensure that exit code 0 is used for "stop" command""
    
    This reverts commit 547be437426163fcd2655857e34f4d24b4994c3a.
    
    The change in 1518b601036351e3f8686bab9c8ae87a8d5af0a3 is in line with the expected
    stop behavior in 3.6.x.
    
    For 3.7.0 we are still contemplating what it should be.

commit 62be8a048e0c52b33e94bf6ab1d639583f03c4cd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 28 14:36:49 2017 +0200

    Makefile: Remove a stale definition of $(dep_rabbitmq_cli)
    
    It was still referring to an old development branch.

commit d1299f42e8e66413039407f7b97670e35bcdbb78
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Sep 28 13:08:34 2017 +0100

    Do not limit paging to disk if hibernated or resumed after credit
    
    Paging of messages to disk is limited by lazy_queue_explicit_gc_run_operation_threshold
    This is required to avoid GC on every publish. But for big messages the
    process can get hibernated or blocked by the message store credit-flow,
    leaving the process with a lot of memory taken.
    When hibernating or unblocking we should try to page messages to disk
    regardless of the threshold, because we know that memory reduction is
    required at this moment.
    
    Fixes #1379
    [#150916864]

commit f2af2f3eaf64e9ab3ad0b8bf4496fa338be2b266
Merge: 2cb1e427c 547be4374
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 28 12:33:04 2017 +0300

    Merge branch 'stable'

commit 547be437426163fcd2655857e34f4d24b4994c3a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 28 12:28:57 2017 +0300

    Revert "Ensure that exit code 0 is used for "stop" command"
    
    This reverts commit 1518b601036351e3f8686bab9c8ae87a8d5af0a3.
    
    There is no consensus on how it should work. In general it is impossible
    to tell a stopped node from a node we could not contact (with some
    specific exceptions reported by modern net_kernel version such as
    the Erlang cookie mismatch), so some believe stop should be
    idempotent and others believe it should not.

commit 155eb6b0bffe3126ab18ab228296821ce0dc1f8c
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 27 16:29:20 2017 +0100

    Remove consumer bias & allow queues under max load to drain quickly
    
    Given a queue process under max load, with both publishers & consumers,
    if consumers are not **always** prioritised over publishers, a queue
    can take 1 day (or more) to fully drain.
    
    Even without consumer bias, queues can drain fast (i.e. 10
    minutes in our case), or slow (i.e. 1 hour or more). To put it
    differently, this is what a slow drain looks like:
    
    ```
         ___ <- 2,000,000 messages
        /   \__
       /       \___     _       _
      /            \___/ \_____/ \___
     /                               \
    |-------------- 1h --------------|
    
    ```
    
    And this is what a fast drain looks like:
    
    ```
        _ <- 1,500,000 messages
       / \_
      /    \___
     /         \
    |- 10 min -|
    ```
    
    We are still trying to understand the reason behind different drain
    rates, but without removing consumer bias, this would **always** happen:
    
    ```
         ______________ <- 2,000,000 messages
        /              \_______________
       /                               \______________    ________
      /                                               \__/        \______
     /                                                                   \
    |----------------------------- 1 day ---------------------------------|
    ```
    
    Other observations worth capturing:
    
    ```
    | PUBLISHERS | CONSUMERS | READY MESSAGES | PUBLISH MSG/S   | CONSUME ACK MSG/S |
    | ---------- | --------- | -------------- | --------------- | ----------------- |
    | 3          | 3         | 0              | 22,000 - 23,000 | 22,000 - 23,000   |
    | 3          | 3         | 1 - 2,000,000  |  5,000 -  8,000 |  7,000 - 11,000   |
    | 3          | 0         | 1 - 2,000,000  | 21,000 - 25,000 | 0                 |
    | 3          | 0         | 2,000,000      |  5,000 - 15,000 | 0                 |
    ```
    
    * Empty queues are the fastest since messages are delivered straight to
      consuming channels
    
    * With 3 publishing channels, a single queue process gets saturated at
      22,000 msg/s. The client that we used for this benchmark would max at
      10,000 msg/s, meaning that we needed 3 clients, each with 1 connection
      & 1 channel to max the queue process. It is possible that a single
      fast client using 1 connection & 1 channel would achieve a slightly
      higher throughput, but we didn't measure on this occasion. It's
      highly unrealistic for a production, high-throughput RabbitMQ
      deployment to use 1 publishers running 1 connection & 1 channel. If
      anything, there would be many more publishers with many connections &
      channels.
    
    * When a queue process gets saturated, publishing channels & their
      connections will enter flow state, meaning that the publishing rates
      will be throttled. This allows the consuming channels to keep up with
      the publishing ones. This is a good thing! A message backlog slows
      both publishers & consumers, as the above table captures.
    
    * Adding more publishers or consumers slow down publishinig & consuming.
      The queue process, and ultimately the Erlang VMs (typically 1 per
      CPU), have more work to do, so it's expected for message throughput to
      decrease.
    
    Most relevant properties that we used for this benchmark:
    
    ```
    | ERLANG               | 19.3.6.2      |
    | RABBITMQ             | 3.6.12        |
    | GCP INSTANCE TYPE    | n1-standard-4 |
    | -------------------- | ------------  |
    | QUEUE                | non-durable   |
    | MAX-LENGTH           | 2,000,000     |
    | -------------------- | ------------  |
    | PUBLISHERS           | 3             |
    | PUBLISHER RATE MSG/S | 10,000        |
    | MSG SIZE             | 1KB           |
    | -------------------- | ------------  |
    | CONSUMERS            | 3             |
    | PREFETCH             | 100           |
    | MULTI-ACK            | every 10 msg  |
    ```
    
    Worth mentioning, `vm_memory_high_watermark_paging_ratio` was set to a
    really high value so that messages would not be paged to disc. When
    messages are paged out, all other queue operations are blocked,
    including all publishes and consumes.
    
    Artefacts attached to rabbitmq/rabbitmq-server#1378 :
    
    - [ ] RabbitMQ management screenshots
    - [ ] Observer Load Chars
    - [ ] OS metrics
    - [ ] RabbitMQ definitions
    - [ ] BOSH manifest with all RabbitMQ deployment properties
    - [ ] benchmark app CloudFoundry manifests.yml
    
    [#151499632]

commit 2cb1e427c7d63c844b3c22335b17baee04e81762
Merge: edc5d9632 644c9afd1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 28 11:00:37 2017 +0300

    Merge branch 'stable'

commit 644c9afd151dc963b4d6a47a5e3a1d28896499ca
Merge: 1c8109548 1518b6010
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 28 10:59:51 2017 +0300

    Merge pull request #1376 from rabbitmq/rabbitmq-server-1362
    
    Ensure that exit code 0 is used for "stop" command

commit 1518b601036351e3f8686bab9c8ae87a8d5af0a3
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Sep 26 16:08:49 2017 -0700

    Ensure that exit code 0 is used for "stop" command
    
    Part of the fix to #1362

commit edc5d9632725b58f94fd94b4a6ba3a2ffbfbc8fc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 25 14:45:37 2017 +0300

    Wording

commit 065c849786dfa916f3b1d06513636398d06ecb47
Merge: 2fd5c7e9f 1c8109548
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Sep 23 22:37:07 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_queue_location_random.erl
            test/queue_master_location_SUITE.erl

commit 1c81095486f56ca9dcfa19177594d6e5be1fbe0a
Merge: 879d1837e 6b1b2f212
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Sep 23 15:27:29 2017 -0400

    Merge pull request #1372 from rabbitmq/rabbitmq-server-1371
    
    Take ha-mode into account in choosing queue master

commit 6b1b2f212fa6768f712b606196002e741f56afb6
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Sep 22 10:09:13 2017 -0700

    Be smarter about when to use all cluster nodes vs just those specified by ha-mode:nodes when picking initial queue master node

commit 686d90c088e72ac9e2cc831c6e5bc43b028aa805
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Sep 21 14:14:55 2017 -0700

    Fix test for ha-mode exactly. Requires sync-ing the queues to ensure slave pids are started

commit c9578d010c1dbfc39ad0baeb776a777cf883a890
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 21 12:35:23 2017 -0600

    Squash a warning => compiles from scratch

commit 774689cf9806518b1d7c3a07da493c14879e1348
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Sep 21 09:40:54 2017 -0700

    Add three tests for different ha-mode scenarios with min-masters

commit cfec7c2d0fc009a40d2b545daa4fd70d636e087f
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Sep 21 08:20:37 2017 -0700

    Handle suggested_queue_nodes output when slave nodes are empty

commit ba1df05f1c2361ba9983b9775d7b5fb51508e7a5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 20 20:56:24 2017 -0600

    Use EUnit assertions here
    
    They produce more informative match failure reports.

commit ece1c99c2d53c8efd03bfde949ce1c2b13234c05
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 20 19:35:30 2017 -0600

    Cosmetics

commit 225063f5607ddcf4a8e2ddc0805fc8991b675ca7
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Sep 20 15:41:16 2017 -0700

    Take ha-mode into account in choosing queue master
    
    Fixes #1371

commit 2fd5c7e9f21011e61117282807247b7cf074f474
Merge: 3aeb47f7f 879d1837e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 22 14:40:53 2017 +0200

    Merge branch 'stable'
    
    Conflicts:
            docs/rabbitmq.config.example

commit 879d1837e74d987b23c337d98978f4311bc34222
Merge: b339f72fa 87b51a684
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 22 06:37:41 2017 -0600

    Merge pull request #1366 from rabbitmq/sync-rabbitmq-config-example-with-configure-page
    
    Sync rabbitmq.config.example with PROJECT_ENV

commit 87b51a684f417869e88f3e81246b4197aefd6327
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 22 14:37:15 2017 +0200

    Edits, more links

commit 4398ab1baf8f0bf160d9668ac3ae5493cdecfd0b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Sep 22 13:07:25 2017 +0100

    Additions & changes to example config as per rabbitmq-server#1366

commit b68a37b8cfb6cb2c57371ec13dcb7614658e00a5
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 21:58:31 2017 +0100

    Replace commented line with empty line

commit 83e6c2372746eb46d4a76dadc1a4eaa6c2b61df0
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 21:50:29 2017 +0100

    Remove redundant for

commit 19c4dd92e7e386b9635de118a7921b6724853130
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 21:40:19 2017 +0100

    Fix typo: SSH -> SSFix typo: SSH -> SSL

commit a521119a07aaf4d70f19ad7d3fd02f721f571ce1
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 21:36:48 2017 +0100

    Add last missing config properties to example config
    
    This was the last pass, there are no more left in PROJECT_ENV, promise.

commit e4b2fe7b44edfe74affdd2c4865d312a381bc311
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 18:32:48 2017 +0100

    Add a few extra missing properties & correct defaults in example config

commit 78d2e8922dac0be2b976a5dac68827a70c9098bd
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 18:15:49 2017 +0100

    Add other missing config properties from PROJECT_ENV to example config

commit 45f8143dbd441cf34ae362d8889669078bf4835e
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 17:35:06 2017 +0100

    Remove extra details from new config properties added to example config
    
    Add links instead, as per discussion with @michaelklishin & @hairyhum

commit 33d2b98c4495935ced6ef3889718e5230ee10c4b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 17:28:25 2017 +0100

    Add msg_store_io_batch_size to example config

commit f54d02da54e92f6fe5bb271d43dd661a0e296549
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 17:26:19 2017 +0100

    Remove extra details from msg_store_credit_disc_bound from example config
    
    Having discussed with @michaelklishin & @hairyhum, it was agreed that
    these details belong in http://www.rabbitmq.com/persistence-conf.html

commit 2f34158103d4e71c421fbd25952a5b066104a6c6
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 11:23:06 2017 +0100

    Explain the IoBatchSize role in push_betas_to_deltas

commit 07b85f64adab8d6f0ca979973435adb0470b5d03
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Sep 20 11:22:20 2017 +0100

    Clarify IO_BATCH_SIZE in betas -> deltas (not gammas!) comment

commit 605eb85eebb59abe622e4278cd72dd58a401d079
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Sep 19 16:22:14 2017 +0100

    Add msg_store_credit_disc_bound to example config

commit 1bf1f352ba4172e0a1c4bc5eab2edae3b7afb01c
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Sep 19 11:00:34 2017 +0100

    Add mirroring_sync_batch_size to example config

commit 131843b54fef5580f4384ae5e662eb36ee082f14
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Sep 19 10:55:08 2017 +0100

    Add delegate_count to example config

commit 9ab70278256f39b07f42d826b4a088defa803a77
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Sep 19 10:17:27 2017 +0100

    Add queue_master_locator to example config

commit b339f72fa544df8b297629c43d659f6777aacd18
Merge: 2c94fa7bd 5d1db21ec
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 19 17:07:05 2017 -0600

    Merge pull request #1369 from rabbitmq/lrb-add-exec-stop
    
    Add additional ExecStop line from rabbitmq-server-release

commit 5d1db21ec1234d9c0641f85bffa3d66726831e8e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Sep 19 15:59:45 2017 -0700

    Add additional ExecStop line from rabbitmq-server-release
    
    This line is part of the release but not included here
    
    https://github.com/rabbitmq/rabbitmq-server-release/blob/stable/packaging/debs/Debian/debian/rabbitmq-server.service#L16

commit 3aeb47f7f0fd5c9b83202cf89f230e7210014184
Merge: 049330ec1 2c94fa7bd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 19 16:03:40 2017 -0600

    Merge branch 'stable'

commit 2c94fa7bdebde032d268ea18bb553cb9b1e3bc54
Merge: 833a9da25 3ed695851
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 19 16:00:29 2017 -0600

    Merge pull request #1368 from rabbitmq/rabbitmq-server-1359
    
    Add optional Restart and RestartSec configuration

commit 3ed69585142c817cbc44492dc7ffe16d67020711
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Sep 19 14:41:48 2017 -0700

    wording

commit 4e87dbefa06626f91d74801873a5f9a5f5b797c5
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Sep 19 14:14:12 2017 -0700

    Add optional Restart and RestartSec configuration
    
    Fixes #1359
    
    This gives guidances for those users who wish to automatically restart RabbitMQ in the event of a failure. Tested by using the `Restart=on-failure` setting, then running `rabbitmqctl eval "erlang:halt(abort)."`

commit 31694c50fa5205347d82944e7c14922dd96672b7
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Sep 19 09:30:59 2017 +0100

    Add all log categories to example config mentioned on the configure page

commit 049330ec13764d6acc729ee4905049e28efa8200
Merge: 827836d14 833a9da25
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 15 20:21:45 2017 -0600

    Merge branch 'stable'

commit 833a9da2567867775833e19973c31f732a459464
Merge: 8e61c4fbd bbaf45f2a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 15 20:21:21 2017 -0600

    Merge pull request #1365 from rabbitmq/rabbitmq-server-1364
    
    Do not log anything when list of apps to stop is empty

commit bbaf45f2a80ebd7033ee429826ed2deca6f07929
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 15 18:21:26 2017 -0600

    Further improve logging around enable plugin set changes

commit de295ee77faa87a1b5d0663556bd915867b884ed
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Sep 15 15:42:30 2017 -0700

    Do not log anything when list of apps to stop is empty

commit 827836d14f7ad2c37e2957db8f29100d62c335e9
Merge: 4b9adc7fd 8e61c4fbd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 13 18:01:30 2017 -0400

    Merge branch 'stable'

commit 4b9adc7fd291b0f7f726fd73008de16c35cc6e56
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 13 17:54:00 2017 -0400

    Update rabbitmq-components.mk

commit 8e61c4fbd5eb04313d1a77c42c30fde80f8a7edf
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 13 17:45:21 2017 -0400

    Update rabbitmq-components.mk

commit 80633bae8ca2d990dc632fc15ab78e0ae80cee17
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 12 19:52:54 2017 -0400

    Update rabbitmq-components.mk

commit a8ede34d6efb633e50966b3c66424effff8bffe5
Merge: 7860f99e7 abc8d33c4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 12 12:50:59 2017 -0400

    Merge branch 'stable'

commit abc8d33c49f3abf633963da2d3a747980b505ae5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 12 12:41:42 2017 -0400

    Update rabbitmq-components.mk

commit a85db6fae56673619e77bf45d32bc3274e28cfdc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 12 12:39:44 2017 -0400

    Wording

commit 7860f99e74991a5b999c98aaca570d2eed77ead8
Merge: 10ad5468a 780e0a373
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Sep 12 17:35:04 2017 +0100

    Merge branch 'stable'

commit 780e0a373a05737f574561f87696fa27764fb80c
Merge: 0527df375 a80dac74d
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 12 10:06:11 2017 -0400

    Merge pull request #1358 from rabbitmq/rabbitmq-server-1348
    
    Fix typo in RABBITMQ_LOGS environment setup

commit a80dac74dfd037c19877e9c24fb151f316a9f367
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Sep 12 11:15:06 2017 +0100

    Fix typo in RABBITMQ_LOGS environment setup
    
    The typo caused `-` configuration to be treated as
    a file name, not tty logging, like it should be.
    
    Fixes #1348
    [#150808117]

commit 10ad5468a345a7ea0dace97b147da7cbba6bbcce
Merge: 52ab32e5f 0527df375
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 11 22:40:26 2017 -0400

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_direct.erl

commit 0527df37562453b20227ebafd2b49770f1f26eb4
Merge: bee9a4238 920c12443
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 11 21:29:45 2017 -0400

    Merge pull request #1357 from rabbitmq/rabbitmq-server-1356
    
    Do not start direct connections if the direct connection supervisor is not started

commit 920c12443f6353bc63703497ae438ef30950aded
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Sep 11 16:53:05 2017 +0100

    Do not start direct connections if the direct connection supervisor is not started
    
    Starting a direct connection when the supervisor is not started
    will result in connection termination right after start,
    the client will have a pid at this moment, which can cause
    a confusing error.
    Return error if it's clear that the connection cannot be started.

commit 52ab32e5fb9c4465091a9b6e7305f66942607687
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 11 00:31:25 2017 -0400

    Make it possible to configure randomized startup delay range via new style config

commit f34890e89c51d21a3fc3714d63d8ad1b15fc9352
Merge: cfc5bde7d d901ecbfa
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 8 20:52:15 2017 -0400

    Merge pull request #1352 from rabbitmq/rabbitmq-server-1332
    
    Introduce x-first-death-{queue,reason,exchange}

commit d901ecbfacde2f37b5b8a68aa8ca563f286afbea
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 7 13:59:30 2017 -0700

    Handle cases where the headers table is undefined

commit 96cd56a9d040ffeeeb62c95b84826c1f021a3ebc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 7 06:51:31 2017 -0700

    Introduce x-first-death-{exchange,queue,reason}
    
    They can be used to route dead lettered messages using a headers exchange.
    
    Part of #1332.

commit cfc5bde7d40c40a96a094ed0f849ef4f98ff6406
Merge: 282bf5521 bee9a4238
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 4 17:44:39 2017 -0700

    Merge branch 'stable'

commit bee9a4238e2731a6bf371481056f02a940c1beb4
Merge: b14868e96 cc2f91949
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 4 17:44:19 2017 -0700

    Merge pull request #1347 from rabbitmq/autoheal-deadlock
    
    Link process responsible of restart during autoheal, and abort if needed

commit cc2f91949ca0ccbb6c478be40a1ae5c2bb7f6531
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 4 11:15:48 2017 +0100

    Trap exits on spawned process so it's not killed on monitor restart
    
     rabbitmq-server#1346

commit 2a4ac91127c36fa6c5558f5fddd1dd980b69760f
Merge: f1f8e8f6a b14868e96
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 1 10:27:38 2017 -0700

    Merge branch 'stable' into autoheal-deadlock

commit f1f8e8f6a1b2bc5342d4a77db2f10cf947cf8ab2
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Sep 1 09:27:49 2017 +0100

    Effectively link the spawned process
    
    rabbitmq-server#1346

commit a04658d53ecb375e43dd2e18c7b74fae9b3039fe
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 31 11:24:11 2017 +0100

    Link process responsible of restart during autoheal, and abort if needed
    
    If the process crashes unexpectedly, the autoheal process gets into a
    deadlock in the 'restarting' state, ignoring any new request from the winner.
    If the crash happens before the process is registered, no logs are generated.
    Thus, we need to link that process and abort the autoheal if the process finishes
    with a reason different from normal.
    
    rabbitmq-server#1346
    [#150707017]

commit 282bf55214fa5ed7c445d9215416c6d37fb7986a
Merge: 54fc8f113 b14868e96
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 30 19:20:03 2017 +0100

    Merge branch 'stable'

commit b14868e96c8347feac91de09aa4c52a4686a14ac
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 30 18:46:43 2017 +0100

    Update erlang.mk

commit 54fc8f1130da071f703cd7dfe0d2459facd536e3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 30 18:29:40 2017 +0100

    Update default category loglevel to `inherit`
    
    Change default level for categories to make them log
    `debug` messages if there is a handler to output them.

commit 9fd03786657f9ea411a10150e37443254cdf7fd1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 30 15:08:05 2017 +0100

    Snippets to test log config.

commit fd7cd65678597e94e34033dd0dc5148646877e9a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Aug 25 13:49:20 2017 -0600

    Add vm_memory_calculation_strategy to rabbitmq.conf.example

commit d86f10c66d9bfc61a21f957e0cfc2b092a336bb8
Merge: ef1a5a059 f2afe31fc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Aug 25 13:47:35 2017 -0600

    Merge branch 'stable'

commit f2afe31fcca09a24c17debac1c07b4bba6de13c4
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 25 11:39:27 2017 -0600

    Add rabbit.vm_memory_calculation_strategy to config example

commit ef1a5a0596e022cae8310d6e04c667c28b6902cc
Merge: 1bc84822a 677f22a87
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 24 05:31:34 2017 -0400

    Merge branch 'stable'

commit 677f22a87560d83745f5bd4d5df0c60ee550a38d
Merge: 4e94918a9 249cf662c
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 24 04:41:14 2017 -0400

    Merge pull request #1341 from rabbitmq/rabbitmq-server-1340
    
    Do not GC channel-queue metrics on mirror migration

commit 249cf662ccb1914633e0493b8356420b6a3ec726
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Aug 23 11:56:16 2017 +0100

    Do not GC channel-queue metrics on mirror migration
    
    rabbitmq-server#1340
    [#150442817]

commit 1bc84822a10255319be6170d74355f20cef5fa5f
Merge: 559848820 4e94918a9
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Aug 22 19:19:02 2017 +0100

    Merge branch 'stable'

commit 4e94918a957bfee5905e75c89c14e2e7e9b74600
Merge: b02a53eeb c89e694ab
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Tue Aug 22 20:17:30 2017 +0200

    Merge pull request #1339 from rabbitmq/rabbitmq-server-1338
    
    Read rabbitmq-env.conf a bit earlier to pick up two variables

commit c89e694abddc7df23ec1da180ddfbfe4909e97ab
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Tue Aug 22 10:18:05 2017 -0700

    Add target to run bats tests to Makefile
    
    The `bats` target will clone and install the bats command in a
    manner similar to `kerl` or `hex.pm`, i.e. to ERLANG_MK_TMP
    
    [#150452491]
    
    Signed-off-by: Luke Bakken <lbakken@pivotal.io>

commit 42b8137f316a887c07a7d711b2f08534fc5d414c
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Tue Aug 22 09:52:24 2017 -0700

    Read rabbitmq-env.conf a bit earlier to pick up two variables
    
    Prior to this change, setting RABBITMQ_DISTRIBUTION_BUFFER_SIZE
    and/or RABBITMQ_SCHEDULER_BIND_TYPE would not be added to
    SERVER_ERL_ARGS because the latter variable was built prior to
    reading rabbitmq-env.conf
    
    Fixes #1338
    
    [#150452491]
    
    Signed-off-by: Luke Bakken <lbakken@pivotal.io>

commit 5598488204c7c762bd007e2732ca8e984b8a7302
Merge: 8034de012 f3f09fb02
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Aug 21 20:44:43 2017 -0400

    Merge pull request #1335 from rabbitmq/rabbitmq-website-418
    
    Refactor log configuration to be consistent with log doc guide

commit f3f09fb028bcdb2b28fa51840b28862ede54ecac
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Aug 21 19:34:54 2017 -0400

    Use ?assertEquals where possible

commit c4619d8298ef0b3341713045cf3099aac59f8f4a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Aug 21 15:31:26 2017 -0400

    Wording

commit 57825b776711e64c5815b87346dcf3679523bd90
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Aug 21 16:10:13 2017 +0100

    Log configuration tests

commit 0c6255e368ffb6000d403568c0ed0f6d125d25b0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Aug 18 11:14:56 2017 +0100

    Refactor log configuration to be consistent with log doc guide

commit 8034de0125e56ce575c1e8a93cff164bcd33f96e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Aug 14 15:56:30 2017 +0100

    Remove timeout swithch from the node_health_check command.
    
    The timeout switch is already a default switch, the command should
    not redefine it.

commit 60e8f879bbb8635c64e224223c69d5198a4d3401
Merge: 433c3ce8d b02a53eeb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Aug 11 02:25:16 2017 +0300

    Merge branch 'stable'

commit 433c3ce8d1564825e503b1338838e3bcb7900517
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 11 01:15:06 2017 +0300

    Closes #1330
    
    Current management plugin config schema uses `day` instead of
    `24hours`: https://github.com/rabbitmq/rabbitmq-management/blob/master/priv/schema/rabbitmq_management.schema.

commit b02a53eebde065e51e0dc9c4041756950003b0a2
Merge: fd50fd7d2 514ae5830
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 10 20:25:53 2017 +0300

    Merge pull request #1326 from rabbitmq/rabbitmq-server-1324
    
    Start/stop windows service using `net` utility instead of `erlsrv`

commit c8de5f78d736a952b7bd620570a21c95e4277fda
Merge: 60cbe625c fd50fd7d2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 10 04:23:12 2017 +0300

    Merge branch 'stable'

commit fd50fd7d260393c7dee795a24b86ff82682aec1f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 10 04:22:25 2017 +0300

    Move delays to the test where they belong

commit 60cbe625c37f88a0a6592a2cc81b8898e2636e93
Merge: 9e5599b3b ae11d9a84
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 10 04:16:13 2017 +0300

    Merge branch 'stable'

commit ae11d9a843b6236f045f81e6ee90392707e6d5ad
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 10 04:15:27 2017 +0300

    Inject a delay after killing node
    
    Like we do in partition_SUITE.
    
    References #1323.

commit 9e5599b3b9f7dc3887287bab487b21fa170b7fad
Merge: b9a09c712 ec5ffe729
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 10 03:36:30 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_amqqueue.erl

commit ec5ffe7296fbb883dccb35802d4bbcf8f2473e0d
Merge: 2a01b6c6d af397dd1b
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 10 02:57:55 2017 +0300

    Merge pull request #1325 from rabbitmq/rabbitmq-server-1323
    
    Clean up orphaned exclusive queues

commit af397dd1b42eaf44f7213f847fed6c0135812e20
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Aug 9 09:14:15 2017 -0700

    Add test for cleaning up dead exclusive queues

commit b9a09c712baa07ff85a9c954ffb4e36b95a1fc37
Merge: 70fabf3ea ad9f941f9
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Aug 9 17:52:53 2017 +0400

    Merge pull request #1313 from rabbitmq/rabbitmq-cli-207
    
    Functions to list unresponsive queues

commit ad9f941f95718e5cef9ee544d20a66e8c3b0b88c
Merge: e7a67da88 70fabf3ea
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 9 14:41:01 2017 +0100

    Merge branch 'master' into rabbitmq-cli-207

commit 23884dd83be137c356d4ae3ec19c7bc686118573
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Aug 9 06:32:06 2017 -0700

    Begin adding test for #1323

commit 0c30c18031a20eff72fc85bddb41d5545eda925f
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Aug 8 08:36:53 2017 -0700

    Correctly check for exclusive queue

commit 70fabf3eae712ee5e13f5131b5d8443b7147203c
Merge: e24220800 2a245fec1
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Aug 8 19:21:13 2017 +0400

    Merge pull request #1322 from rabbitmq/rabbitmq-server-1255
    
    Set ERL_CRASH_DUMP location to rabbitmq log directory

commit 514ae583081db55228a3a433a25b81167255e897
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Aug 8 15:28:20 2017 +0100

    Start/stop windows service using `net` utility instead of `erlsrv`
    
    `erlsrv` doc suggests to use windows system control tools to control
    services. It prints weird error when error is occured
    (for example access is denied), so using `net` is prefered.

commit 793b1af1902450feb462f9cf44c98e01ed9eedbf
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Aug 8 06:53:46 2017 -0700

    Add is_exclusive to queue deletion clause

commit e24220800789e07f6c9d7eb6988210d342d59352
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Aug 7 14:52:39 2017 +0100

    Use lager sink API for logs.
    
    Lager sink parse-transform allows us to use a fake module name
    to select sinks.
    It's more convenient that to use a helper function for every module.
    Get rif of `rabbit_log_connection` as a sink qualifier.
    Qualifiers should be compatible with pre-3.7 qualifiers for plugin developers.
    
    [#149634975]

commit e7a67da88293ebe5d8baf2f73eeb04d7d235a2dc
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Aug 7 15:06:55 2017 +0200

    Use info items to list unresponsive queues
    
    rabbitmq-cli#207
    [#149059849]

commit 1c63b80ae46aebec3f90803439aeb79a41ffe56b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Aug 4 14:50:41 2017 +0100

    Do not run a message store migration if there are no durable queues.
    
    If there are no queues to migrate, we should not spend time
    starting old message store and doing an empty migration.
    Log that there is no migration.
    Delete the old message store which can cintain transient queues data.

commit 1711a6ca84056a4e28aefdbbbb142493e56fb5b8
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Aug 4 10:32:33 2017 +0100

    Add upgrade log sink to windows scripts.
    
    Upgrade sink is used for logging queue data upgrades.
    It should be configured in the start arguments of rabbitmq server.

commit f96ab7e419b17bc02ddc9c1b38bc7f861a4b52e1
Merge: ac687666a 454a26b35
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 3 22:59:35 2017 +0300

    Merge pull request #1318 from rabbitmq/rabbitmq-management-460
    
    Change the `state` field in vhost info to `cluster_state`.

commit 2a245fec110d90fe5e5df97e49fab387e08e7bae
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Aug 3 16:03:58 2017 +0100

    Set ERL_CRASH_DUMP location to rabbitmq log directory

commit 454a26b359b050d62bb745d11e7bc3677aab29bf
Merge: ba218a735 ac687666a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 3 16:16:09 2017 +0300

    Merge branch 'master' into rabbitmq-management-460

commit ac687666a1cc4fb0619792d44cad5f10dd869629
Merge: 5fc28e4b0 82af2d4a7
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 3 16:05:57 2017 +0300

    Merge pull request #1316 from rabbitmq/rabbitmq-server-1314
    
    Start queue mirrors after vhost recovery instead of node start

commit 5fc28e4b0f18fbbaa33b9b20b6f84d57435b73b3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Aug 3 12:25:25 2017 +0100

    Make already_started error explicit in start_vhost. Export start_vhost/2
    
    Already started status can be used by CLI tools and should
    be returned from `start_vhost` function.
    `start_vhost/2` is used in the management API

commit 82af2d4a7497ccb70c668d6698f7ae2abb6040f2
Merge: 167575bf2 b753442da
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 3 02:07:23 2017 +0300

    Merge branch 'master' into rabbitmq-server-1314

commit b753442da578029d49478f2511e647fe29af9b63
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 2 16:21:40 2017 +0100

    Raise a protocol error when declaring a queue on a stopped vhost

commit ba218a735477744f7740fb4325868276dd99ea6e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 2 15:40:09 2017 +0100

    Change vhost status from down to stopped

commit 18346099708db694f010a964953e137d2e8dd490
Merge: c58a15e78 7c76ca3a9
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 2 16:50:27 2017 +0300

    Merge pull request #1320 from rabbitmq/rabbitmq-server-1319
    
    Repeat `rabbit_amqqueue:with` operation for a stopped queue.

commit 7c76ca3a965d54197d51af339bbda5877c7b4974
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 2 14:24:58 2017 +0100

    Repeat `rabbit_amqqueue:with` operation for a stopped queue.
    
    A stopped queue can migrate to a synchronized slave if it's mirrored,
    so we should retry an operation if it has mirrors to migrate to.
    
    Fixes #1319

commit 167575bf29fb83f692be8b779cc7d751308702fd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Aug 1 15:11:25 2017 +0100

    After-merge test fix. Restart vhost supervisor with start_vhost

commit 97abfaccbefbbb2a97d37696aed3ef2a6ffbdd3c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Aug 1 14:54:11 2017 +0100

    Change the `state` field in vhost info to `cluster_state`.
    
    Vhost supervisor status can be different on different nodes.
    Reporting just the current node state doesn't make much sense for
    both management and the CLI.

commit 7c3a12dc9f61583611a3d1179308b8b16627bdb8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 1 04:22:19 2017 +0300

    Test suite updates

commit 733d5ef8b27318f923ec4966fd84e32d83464ecb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 1 03:44:52 2017 +0300

    Wording

commit 1342b04a177207c66d562e4d33610efcd3eac216
Merge: 7bca93c7f c58a15e78
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 1 03:44:22 2017 +0300

    Merge branch 'master' into rabbitmq-server-1314
    
    Conflicts:
            test/dynamic_ha_SUITE.erl

commit c58a15e7893bae019418c486d971046e879e0385
Merge: 843199f62 a65b6d7e1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 1 03:10:38 2017 +0300

    Merge pull request #1315 from rabbitmq/rabbitmq-server-1310
    
    Check if vhost supervisor is running when starting mirrors

commit a65b6d7e10e7880d909fff7214c39165f56d64c4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 1 02:55:35 2017 +0300

    Restore delays used earlier

commit 613b2a8846fd7b031823f325e01337766a9cbdd5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 1 02:46:51 2017 +0300

    Make connection tracking handler more defensive
    
    When a vhost is deleted, both vhost_deleted and vhost_down will
    be emitted, resulting in double deletion. rabbit_networking:close_connection/1
    therefore can throw an exception about an unknown connection pid.
    The handler needs to account for that.
    
    While at it, change log messages to be less alarming and simply
    mention vhost shutdown as opposed to "a database failure".
    
    References 7a82b43bf12b737250957081d0b0d84b21b3bf72.
    
    Signed-off-by: Luke Bakken <lbakken@pivotal.io>

commit 7bca93c7f931fbff8862077ea07b710004a4f12a
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jul 31 14:57:21 2017 -0700

    Fix compile warning

commit 5f549efa29403a3e4e351c363e53aa900de320dc
Merge: 5bcf9ab6e 843199f62
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jul 31 21:42:03 2017 +0300

    Merge branch 'master' into rabbitmq-server-1310
    
    Conflicts:
            test/vhost_SUITE.erl

commit 843199f62259bea5a27793cd2ded68804f30c1a6
Merge: 98566cdd9 1df9b98f3
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jul 31 19:16:53 2017 +0300

    Merge pull request #1309 from rabbitmq/rabbitmq-server-1303
    
    Set queue state to 'stopped' when terminating.

commit d39d7e09b2deca27a774da18540f07afb79ded01
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jul 31 11:23:22 2017 +0100

    Start slave queues after vhost recover, instead of node start.
    
    Vhost supervisors can crash and restart without crashing the
    node, so the slave queues on this vhosts should be started
    after the vhsot recovery instead of node boot process.
    
    Fixes #1314
    [#149484151]

commit 5bcf9ab6ebcfaa5383965710f0e2cb7ebd8cba66
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jul 31 16:38:42 2017 +0300

    Wording

commit 98566cdd9c22f556c732b8c91059ca44f5a5ed34
Merge: 77101e7fa 4b40581fe
Author: Luke Bakken <luke@bakken.io>
Date:   Mon Jul 31 06:17:20 2017 -0700

    Merge pull request #1287 from rabbitmq/fix-travis-ci-build
    
    Travis CI build

commit d16e1582dd3809ed0a91f2a4c18cf12a8a2bc1b7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jul 31 13:32:11 2017 +0100

    Do not start multiple vhost supervisors for a single vhost

commit 0cf39584f19ffd69d69c9065e3411193e8abc2b3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 28 15:38:14 2017 +0100

    Test that a node can start with a dead vhost and potential slaves on it

commit 636a1d8fb2e2c1722a4dda11cad481d4f8e02c51
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 28 15:35:18 2017 +0100

    Consider vhost can be deleted when cleaning vhost limits.
    
    During the vhost delete operation runtime parameters cleanup
    happens after vhost is deleted, so `notify_clear` should not
    fail if vhost does not exist anymore.

commit e9fb778418ebb58e02079d78b41185fc05df61bd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 28 15:32:02 2017 +0100

    Delete vhost data even if the vhost supervisor is not running.
    
    Of a vhost supervisor is down it can still be deleted and with
    all the data. This is useful if an operator wants to delete a
    bad vhost.

commit 7db2b7f7310248f229d91ccd31fa583c254bc380
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 28 10:33:37 2017 +0100

    Test that a queue master do not fail when adding a dead-vhost node

commit 4f6574b258168b26775e7764ca23de2eee32bc85
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jul 27 13:16:41 2017 +0100

    Check if vhost supervisor is running when starting slaves.
    
    We should not fail a node boot process if cannot create slaves on
    down vhosts.

commit c36ad89fe024ec2ae450c6fafd61771a6e6ecc06
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jul 27 13:13:11 2017 +0100

    Refactor vhost supervisor access functions.
    
    Do not start a vhost supervisor when accessing it.
    Rename functions to be more descriptive.

commit 1df9b98f35fddf5d6af47d79fbd015980b71cf8e
Merge: d43bc0e40 d15c03f1e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 28 14:03:23 2017 -0700

    Merge branch 'master' into rabbitmq-server-1303

commit 4b40581fe8181795f13dedfe68a98cc5fcd5075a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 28 21:39:16 2017 +0300

    Bump Elixir, only test against one OTP version on Travis

commit e84ba4ca9329243879f51bf147f079519171c81f
Merge: 118666d7c 77101e7fa
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 28 21:37:42 2017 +0300

    Merge branch 'master' into fix-travis-ci-build

commit 77101e7fadaac0bf12b862c6c6cf48e08eb97e4b
Merge: de4f09faf 2a01b6c6d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 28 00:27:13 2017 +0300

    Merge branch 'stable'

commit 2a01b6c6d18c2f29abbfa5fbf88d5de1ac9c43c3
Merge: 4c9d7492f 75b2473d4
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Thu Jul 27 22:14:25 2017 +0100

    Merge pull request #1312 from rabbitmq/rabbitmq-server-1306
    
    Bump DEFAULT_DISTRIBUTION_BUFFER_SIZE to 128 MB

commit de4f09faf36310b1fc7e927833e780fc72d10068
Merge: d15c03f1e 200f8eb90
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 27 20:16:59 2017 +0300

    Merge pull request #1311 from rabbitmq/rabbitmq-server-1307
    
    Log a more sensible error message when running on an outdated Erlang version

commit 75228f4e000c9a0087f103b2e1e91e3b4b5b0a10
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Jul 27 17:48:06 2017 +0200

    Functions to list unresponsive queues
    
    rabbitmq-cli#207
    [#149059849]

commit 75b2473d4fbe5827e561ac01742257099b4713d8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 27 18:28:02 2017 +0300

    Bump DEFAULT_DISTRIBUTION_BUFFER_SIZE to 128 MB
    
    After 24 hours of testing we haven't observed any anomalities or
    regressions. With this change multicast (mirroring) processes
    should be suspended less frequently, resulting in less variable
    throughput for mirroring (with link throughput of 1 GBit/s or greater).
    
    Closes #1306.
    [#149220393]

commit 200f8eb908ae1c02336862e821978887fab431b4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 27 17:35:43 2017 +0300

    Correct comment

commit 06e518638484bc786819cfbd29e9e98f3ba34954
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 27 17:24:28 2017 +0300

    Log this to stderr
    
    Per suggestion from @lukebakken.
    
    References #1307.
    [Finishes #149635897]

commit d43bc0e408d1c2a89df399840e072fc427176c2c
Author: Daniil Fedotov <fedotov.danil@gmail.com>
Date:   Thu Jul 27 14:36:46 2017 +0100

    Do not try to perform a queue operation in `rabbit_amqqueue:with` if the queue is stopped.
    
    The only operation in `with` which can be performed on a stopped queue
    is `delete`. It will call `delete_crashed` based on the `{absent, Q, stopped}`
    result from `with`.

commit 9d8957bceed6560ba52a61854b80b327bf6104c3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 27 15:19:01 2017 +0300

    Log a more sensible error message when running on an Erlang version that's too old
    
    Closes #1307.
    [#149635897#]

commit d15c03f1e1467198c7cb9649e0bd7ec900b744f0
Author: kjnilsson <knilsson@pivotal.io>
Date:   Thu Jul 27 09:59:15 2017 +0100

    Naming + export type
    
    rabbit_types:connection_name() is used elsewhere but was not exported.

commit 354148c14cc79771af17acf305e41b9cdc965a7c
Merge: 2b2ea1173 47d2b281c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jul 27 09:44:57 2017 +0200

    Merge pull request #1308 from rabbitmq/rabbitmq-server-1305
    
    Bump Erlang versions in .travis.yml

commit 8e05c4dbf362f61d2e4c12de59ae1e3997f2fcd2
Merge: 1f5240617 2b2ea1173
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 26 22:24:24 2017 +0300

    Merge branch 'master' into rabbitmq-server-1303

commit 2b2ea1173bafb01349b180c76f1e52fef5856dd0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Jul 26 18:46:12 2017 +0100

    Cleanup test variable queue for channel operation timeout test.
    
    The file included all variable queue code, which was changed
    several times. It doesn't make sense to maintain two identical
    files, so now all the callbacks are called from rabbit_variable_queue.

commit 7f30e61770ce6ff1e1105915e6bd012b388aaaa8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 26 19:59:32 2017 +0300

    Update new style config example as well

commit 32d7797fa19885d42d2afd3d0de184863af34051
Merge: 574111eb0 4c9d7492f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 26 19:58:43 2017 +0300

    Merge branch 'stable'

commit 4c9d7492fe31b6e96708661aea51f06183419cab
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 26 19:58:28 2017 +0300

    Improve docs

commit 1f5240617b424b0d36e56f2d6608ed529b723184
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Jul 26 14:21:24 2017 +0100

    Test that list_queues return stopped state for queues taken down by vhost supervisors

commit fab1dcdf9ace49e01a1556cd6f3038075fbc3b66
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 25 17:50:58 2017 +0100

    Set queue state to 'stopped' when terminating.
    
    If a queue process is stopped by a vhsot supervision tree, it should
    be visible in the management UI and the `list_queues` command output.
    Setting the queue state to `stopped` is easier to reason about than
    checking the vhost aliveness status on a remote node.
    If queue will be restarted or migrated to a different node, the status
    will be set to `live`.
    If a node was not stopped normally the queues will have `live`
    state. If we cannot recover the queues thay should be marked
    `stopped` to be reported to rabbitmqctl and management UI
    
    Fixes #1303
    [#148409695]

commit 47d2b281ce5c4df4cdc8779fcdf053fdd5698835
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 26 17:55:08 2017 +0300

    Bump Erlang versions in .travis.yml
    
    Part of #1305.
    [#149563549]

commit 574111eb0c0fe0c01cc0481df6c1f23de6871688
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 26 03:48:12 2017 +0300

    Update rabbitmq-components.mk

commit 7918216b4a36d493179fcdbe7a32c1d21876cf20
Merge: 1850481df fac9eaedf
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 26 03:16:23 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            rabbitmq-components.mk

commit fac9eaedf42d10c634fb17b6a100e0e3ad50ddd6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 26 02:26:58 2017 +0300

    Update rabbitmq-components.mk

commit 1850481df68fa456ff1eb3f7ecbc06c88050eaa2
Merge: 481dd67c6 762e7b000
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Tue Jul 25 18:37:45 2017 +0100

    Merge pull request #1304 from rabbitmq/rabbitmq-management-446
    
    Report vhost status on vhost info

commit 762e7b0006118a2017dce03cfd0fd2ddc2f5b940
Merge: e8a8d90c0 481dd67c6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 25 18:16:46 2017 +0100

    Merge branch 'master' into rabbitmq-management-446

commit 481dd67c6c068d1e3740c6b48fb87c161f483e67
Merge: 88b516541 82fb30be1
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 25 19:50:18 2017 +0300

    Merge branch 'stable'

commit 88b516541b865a20fb1639bc95864bb0a7438c24
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 25 17:45:05 2017 +0100

    Fix unused variable

commit 1d3392fb02e297d0ee606cf6d41daeb92c2c953f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 25 19:21:40 2017 +0300

    Spelling

commit 6115475719cc01b582d8fa2440df23467e52bbe6
Merge: e66809bbc dc82c258e
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Tue Jul 25 17:15:38 2017 +0100

    Merge pull request #1293 from rabbitmq/rabbitmq-server-close-connection-on-vhost-down
    
    Close connections when vhost is unavailable (supervision tree is down)

commit 82fb30be1aaf736265822d42c0bd0b38bb48a9ee
Merge: 46eb2e540 7d0e49c63
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jul 25 17:04:46 2017 +0300

    Merge pull request #1302 from rabbitmq/stable-gm-mem-usage-during-constant-redelivery
    
    Stable GM memory usage during constant redelivery

commit dc82c258e9a51a7b7a2f9fa45e31e09c4c614fa3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 25 14:37:02 2017 +0100

    Remove debug log

commit e8a8d90c0e5737503a547431d6ec847a569c7b8c
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Jul 25 11:50:23 2017 +0100

    Report vhost status on vhost info
    
    rabbitmq-management#446
    [#149398495]

commit 7d0e49c6391fce19d651ad4658923d4b3d415aa6
Author: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 20 18:37:19 2017 +0100

    Run garbage collection in GM every 250ms
    
    In high throughput scenarios, e.g. `basic.reject` or `basic.nack`,
    messages which belong to a mirrored queue and are replicated within a GM
    group, are quickly promoted to the old heap. This means that garbage
    collection happens only when the Erlang VM is under memory pressure,
    which might be too late. When a process is under pressure, garbage
    collection slows it down even further, to the point of RabbitMQ nodes
    running out of memory and crashing. To avoid this scenario, We want the
    GM process to garbage collect binaries regularly, i.e. every 250ms. The
    variable queue does the same for a similar reason:
    rabbitmq/rabbitmq-server#289
    
    Initially, we wanted to use the number of messages as the trigger for
    garbage collection, but we soon discovered that different workloads
    (e.g. small vs large messages) would result in unpredictable and
    sub-optimal GC schedules.
    
    Before setting `fullsweep_after` to 0, memory usage was 2x higher (400MB
    vs 200MB) and throughput was 0.1x lower (18k vs 20k). With this
    `spawn_opt` setting, the general collection algorithm is disabled,
    meaning that all live data is copied at every garbage collection:
    http://erlang.org/doc/man/erlang.html#spawn_opt-3
    
    The RabbitMQ deployment used for testing this change:
    
    * AWS, c4.2xlarge, bosh-aws-xen-hvm-ubuntu-trusty-go_agent 3421.11
    * 3 RabbitMQ nodes running OTP 20.0.1
    * 3 durable & auto-delete queues with 3 replicas each
    * each queue master was defined on a different RabbitMQ node
    * every RabbitMQ node was running 1 queue master & 2 queue slaves
    * 1 consumer per queue with QOS 100
    * 100 durable messages @ 1KiB each
    * `basic.reject` operations
    
    ```
    | Node   | Message throughput   | Memory usage   |
    | ------ | -------------------- | -------------- |
    | rmq0   | 12K - 20K msg/s      | 400 - 900 MB   |
    | rmq1   | 12K - 20K msg/s      | 500 - 1000 MB  |
    | rmq2   | 12K - 20K msg/s      | 500 - 800 MB   |
    ```
    
    [#148892851]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit 5f03dcc56cd77e6474aab10663860d34c2a8e462
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 18 17:21:00 2017 +0200

    Remove hibernate from GM
    
    We don't want to use the backoff/hibernate feature because we have
    observed that the GM process is suspended half of the time.
    
    We really wanted to replace gen_server2 with gen_server, but it was more
    important to keep changes in 3.6 to a minimum. GM will eventually be
    replaced, so switching it from gen_server2 to gen_server will be soon
    redundant. We simply do not understand some of the gen_server2
    trade-offs well enough to feel strongly about this change.
    
    [#148892851]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit 5705d8b5a5f3697c85dc9aa1de6481303691267a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jul 24 11:54:05 2017 +0100

    Cleanup test groups

commit 47949a5970603f20d9227484b5839e37101ce642
Merge: 7fa82b3d9 e66809bbc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jul 22 22:02:26 2017 +0300

    Merge branch 'master' into rabbitmq-server-close-connection-on-vhost-down

commit e66809bbcd33593de73866dac6718726ef9053d8
Merge: a36c7f3d2 46eb2e540
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jul 22 05:01:22 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_amqqueue.erl
            src/rabbit_vm.erl

commit 46eb2e540332ffd727e513e2e12ba25d88737faa
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 21 16:38:34 2017 +0100

    Remove the debug message about deleting queues without vhosts

commit 823d3b063a4893ca53d344a06b87322e297bb82a
Merge: 6cf6d4d91 37174bd66
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 21 18:32:31 2017 +0300

    Merge pull request #1301 from rabbitmq/rabbitmq-server-1300
    
    Do not show queues with deleted vhost.

commit 37174bd66fdf237c5c1dcf3c28e15fbacb634a1a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 21 15:29:06 2017 +0100

    Do not show queues with deleted vhost.
    
    When vhost does not exist for a queue, which reside on
    a stopped node, the queue will not be displayed in the 'list_queues'
    command output.
    When a node goes back up, queues without vhost will be deleted.
    [Fixes #1300]
    [#149292743]

commit 7fa82b3d923a2c1179fb0ae460dde46e89414a5a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 21 08:07:33 2017 +0100

    Fix return type of start_vhost

commit 6cf6d4d91099c3a8c71356d8a485b1214fc48117
Merge: 1532037fe 2cab2d9b9
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 20 17:53:03 2017 +0300

    Merge pull request #1295 from rabbitmq/rabbitmq-server-1294
    
    Report a difference between RSS and erlang total memory only if RSS is bigger.

commit 0b8449036fa4340be769a988c107b67a55c9ad3c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jul 20 11:42:27 2017 +0100

    Do not crash on vhost recovery failure if vhost strategy is `continue`
    
    When a node is starting or restarting it can fail to recover a vhost.
    The `continue` vhost recovery strategy means that vhosts can ba down if cannot
    be recovered. This behaviour should also work for node startup and it should
    skip failing vhosts.

commit a36c7f3d21cb6ac64ed87b7406847e04392b313c
Merge: 49a6cff7e 17d5ab074
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 20 02:26:15 2017 +0300

    Merge pull request #1282 from rabbitmq/rabbitmq-management-423
    
    Add function to check if adding queues would exceed limit

commit 17d5ab0746e94822a868a2f445dca838965d55ea
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 30 09:30:09 2017 -0700

    Add would_exceed_queue_limit function

commit 049c9023a24ae70e9489ae081965430d8c6aebab
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 18 09:36:05 2017 +0100

    Test connection closures when vhost supervisor fails.
    
    Move non-limit tests from vhost limits suite to vhost suite.
    Add tests for connection closure and refuse when vhost
    supervisor is down.
    
    [#145106713]

commit 5f7e229aa37999d426f066133ab37575fec39a22
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 18 09:32:35 2017 +0100

    Refuse connections to dead vhosts.
    
    If a vhost supervision tree is not active, which can be
    a result of an error in message store, refuse connections
    to this vhost on the node.
    This is a follow-up to [#140841611] [#1158]
    
    [#145106713]

commit 7a82b43bf12b737250957081d0b0d84b21b3bf72
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jul 7 16:05:07 2017 +0100

    Change vhost supervision recovery process.
    
    In order to be aware if vhost is alive or not, introduce
    a rabbit_vhost_process gen_server, which manages recovery and
    teardown of a vhost.
    Also aliveness of the process can be used to determine a vhost state.
    Vhost process termination emits an event to close all the vhost connections.
    Addresses [#145106713]

commit 49a6cff7e04172e252d958026fd787443227ba71
Merge: 272a5c944 9bc33e0a8
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jul 18 19:40:04 2017 +0300

    Merge pull request #1298 from rabbitmq/rabbitmq-server-1297
    
    Enable tracing of messages sent by default when using LG

commit 9bc33e0a8beb40ce828ae43090e21443549e6032
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Jul 18 18:21:34 2017 +0200

    Enable tracing of messages sent by default when using LG

commit 2cab2d9b9a6dd58a632a76a567acdc086052c374
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 18 12:26:26 2017 +0100

    Report a difference between RSS and erlang total memory only if RSS is bigger.
    
    RSS can be either bigger than memory reported by `erlang:memory(total)`
    or smaller. Make sure we only add positive difference to "other" fraction
    in memory breakdown.
    
    Related to 0872a15a050176ab7598bc3d1b21a2d5c5af3052
    [addresses #1294]
    [#149066379]

commit 272a5c9442e48e6dab9a6768c28171b6907a8fbe
Merge: 2a4ff1936 1532037fe
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 12 11:29:18 2017 +0200

    Merge branch 'stable'

commit 1532037fec1291641d55f460046070902081b5e3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 12 11:27:24 2017 +0200

    rabbit_core_metrics_gc_SUITE: Wait for condition in a loop
    
    This hopefully further improves commit
    6f374fb48a5cc9972ce0bfcf747faa380e1d1e4d.

commit c7c3f921163f539dc30758f1ef1bd67e8a473144
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 11 17:14:21 2017 +0300

    Add vm_memory_calculation_strategy to ctl status
    
    How total amount of memory is computed is an important
    piece of information: what the runtime reports and what tools
    such as 'ps' report will differ.
    
    http://erlang.org/pipermail/erlang-questions/2012-September/069337.html is
    a good source of information on some of the discrepancies.

commit 2a4ff1936ce0d0a47bc9ea65356a2a1c8c9f8794
Merge: b8780f9b2 6f374fb48
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 11 10:35:32 2017 +0100

    Merge remote-tracking branch 'origin/stable'

commit 6f374fb48a5cc9972ce0bfcf747faa380e1d1e4d
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 11 10:26:05 2017 +0100

    Replace timer:sleep with a loop waiting on a predicate.
    
    To make it more likely to pass on resource constrained
    environments.

commit b8780f9b2b6fe601232d22e69ce61232a766080e
Merge: 9aad266b8 26a1ade4b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 11 04:35:13 2017 +0300

    Merge branch 'stable'

commit 26a1ade4bfff245a00936c4e74953c45bb54e784
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 11 04:34:32 2017 +0300

    Simplify
    
    This code runs on server nodes, we can avoid
    using ctl commands.

commit 9aad266b813f12cf9e2dd31f48c02433eec1431c
Merge: 36ef3ab70 6967bb30c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 11 04:30:53 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            test/unit_inbroker_parallel_SUITE.erl

commit 36ef3ab70f56938e14f7ed0d65f8fa5ff2171219
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 11 03:40:22 2017 +0300

    Fix a merge

commit 6967bb30cec8af59e76bcbe098dd0e959c09eacc
Merge: 0872a15a0 8335658c3
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jul 11 03:39:25 2017 +0300

    Merge pull request #1290 from rabbitmq/rabbitmq-server-1285
    
    Add test for set_vm_memory_high_watermark

commit 0872a15a050176ab7598bc3d1b21a2d5c5af3052
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Jul 10 20:55:07 2017 +0100

    Remove OsTotal - ErlangTotal mem calculation from other_system mem
    
    As discussed with @michaelklishin:
    
        We discovered that `erlang:memory(system).` can be almost as large
        as OsTotal when swapping is in effect. This means that total
        (processes + system) will be larger than the OsTotal, therefore
        OsTotal - ErlangTotal cannot be assumed to be non-negative. I think
        having some "unaccounted" memory is better than having it
        "accounted" as negative.
    
    re #1223
    
    [finishes #148435813]

commit 976d4a3406511daa674d85a9af4a2d3b43fda82f
Merge: a451a4b11 e5fea8d17
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jul 10 21:43:10 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_amqqueue.erl

commit e5fea8d1735f7de245afc9132f71f94ef03b8b13
Merge: 39c1bd199 6a77b6dbe
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jul 10 21:38:49 2017 +0300

    Merge pull request #1278 from rabbitmq/rabbitmq-management-427
    
    Only preserve stats for local queues

commit 8335658c358b56a40c91c64ea18f8a81c52c5c1e
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Jul 10 17:00:11 2017 +0100

    Add test for set_vm_memory_high_watermark
    
    This is meant to add a missing integration test that wraps up #1285
    
    It's not a unit test and it can't run in paralle, but
    set_disk_free_limit does the same wrong thing. We should either remove
    them both or leave them as they are.
    
    [#148470947]

commit 6a77b6dbebd49c0c4205d3debaa14eb8db0debb2
Merge: 3afc67b46 39c1bd199
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jul 10 07:22:24 2017 -0700

    Merge branch 'stable' into rabbitmq-management-427

commit a451a4b1158682d5931d59f00dfdfc411eadaef4
Merge: 99b3b0a29 caac1a65d
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jul 10 14:55:04 2017 +0300

    Merge pull request #1286 from rabbitmq/rabbitmq-management-421
    
    Extract common parts of handle_method to be used directly from HTTP API

commit caac1a65deb143a8750821174bfbb8a66a45d7c7
Merge: b5e0206c7 99b3b0a29
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 7 16:08:09 2017 -0700

    Merge branch 'master' into rabbitmq-management-421

commit 99b3b0a290dc32c29887ea6b7ed880ce68bfd4e4
Merge: 5fa999bbf aa1496bb1
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jul 8 01:49:28 2017 +0300

    Merge pull request #1283 from rabbitmq/rabbitmq-server-1280
    
    Handle concurrent vhost creation and deletion better

commit 5fa999bbf6e319fa250007fe3b5f5c09c3d70691
Merge: a82b85e7d d5041a191
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jul 8 01:47:43 2017 +0300

    Merge pull request #1288 from rabbitmq/fix-parseInt-usage
    
    Fix verbiage to read a little better

commit d5041a1912b49cb36e330e891312f12b6681797a
Author: Luke Bakken <luke@bakken.io>
Date:   Fri Jul 7 15:07:52 2017 -0700

    Fix verbiage to read a little better

commit 118666d7caba0e494ec3f8144c0a35e12130a9a1
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 15:54:07 2017 -0700

    Use Travis config from rabbitmq-erlang-client
    
    Only run "make app" for testing purposes
    
    Change to "make tests" and pray :-)
    
    Try running a subset of tests
    
    Run several suites at once
    
    Add function per test group, shellcheck changes
    
    Just do 0 - 5 for TEST_SUITE
    
    every test group only runs 5 suites
    
    only run four or fewer tests per group, with 12 groups
    
    Comment out partitions test suite as it fails frequently on Travis CI

commit aa1496bb198900355291617038d40592998c4a1c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 7 18:38:35 2017 +0300

    Wording, correct a type spec

commit b5e0206c7ba8cac637088e30427cfaecd520ca35
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Jul 4 09:55:04 2017 +0100

    Extract common parts of handle_method to be used directly from HTTP API
    
    Avoids the usage of connections from the HTTP API - management plugin -
     which could hit the connections limit.
    
    rabbitmq-management#421
    [#147429221]

commit c71fcffcb0b7d4967a611beb605de4d0df2a370c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:20:18 2017 +0300

    Wording

commit 9c4590ec7837250a97eb572399dcd418005499b1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:12:06 2017 +0300

    Rename function

commit ae34b344e4ebc904094be518c988098eed66ba62
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:11:56 2017 +0300

    Wording

commit 4893d43ebf26841cdd90076d2968f62bf1e8835c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:11:42 2017 +0300

    It can be any error, log it as such

commit 300eee597b83b430805e24cb878019c2d8cd1c74
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:11:13 2017 +0300

    Wording

commit 22eb5ab38b01b3d93134b0e9ebd464d7e77d24d8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 6 15:10:56 2017 +0300

    Return an error here

commit 3afc67b465be39cddf6dc992cb3f448d11e9c746
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Jul 5 15:46:52 2017 -0700

    Revert unnecessary function addition

commit 2143e256a0e529c84a4366118701420897e85771
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 22:06:55 2017 +0300

    Emit vhost_deleted first, like before
    
    It wasn't an intended change and it breaks per-vhost connection
    limit test suite.

commit 1d3c3c43de2cd1973f8f079d781c0e5361ba6f65
Merge: b269f7606 a82b85e7d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 5 18:33:18 2017 +0300

    Merge branch 'master' into rabbitmq-server-1280

commit b269f760662f264dcb482b58c832b93d4ae31a2c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 15:54:15 2017 +0300

    if rabbit_amqqueue_sup_sup:start_for_vhost/1 fails, log the reason and throw

commit dbc504d2e02ec0220365dde53b194969fa9b7910
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:55:18 2017 +0300

    rabbit_vhost_sup_watcher: log a warning
    
    The watcher can discover that a vhost does not exits but
    the process tree is still there in normal operation
    (concurrent vhost setup and deletion), so a warning
    makes more sense here.

commit 20a0316717478e1c6ade89d6a7ea490db4ca88ef
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:54:38 2017 +0300

    Make this message up-to-date

commit 46aa5b973645e1ab802006cab1c8af3d77eaf2c9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:49:20 2017 +0300

    rabbit_vhost:delete/2: reduce log noise when vhost is already deleted
    
    Some of these errors are a consequence of the current
    implementation where queues, exchanges, etc are deleted
    in multiple transactions instead of one.

commit f5bb52d66f8d2bb76bda13827d1155c90627c54c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:48:03 2017 +0300

    Make rabbit_vhost:add/2 return an error when it fails
    
    This propagates the error the caller, e.g. the CLI command or HTTP API handler.

commit 30f929375211909ec98faa16eeb7071b67488647
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:34:28 2017 +0300

    Log before throwing here

commit edad23196d7f0454d7409786071321a19262b3a6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 14:05:50 2017 +0300

    Virtual host watcher: stop vhost's top level supervisor instead of exiting
    
    Per suggestion from @hairyhum. This should be a safer option
    when rabbit.vhost_restart_strategy is set to stop_node.

commit d97d2ef0d0e769268b4cf624753dad27c2bcc8d5
Merge: f30f56c32 c07b7cacc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 5 12:35:59 2017 +0300

    Merge branch 'master' into rabbitmq-server-1280

commit a82b85e7dfefd07e22f3185df89aa26b85031edc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 5 09:49:45 2017 +0200

    sync_detection_SUITE: Wait for sync status for 30 seconds
    
    ... instead of the previous 10 seconds. This helps eager_sync_SUITE
    which times out quite often with Erlang 20.

commit c07b7cacc326cbec273b04d0d3eb1a351223d73a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 21:19:57 2017 +0300

    rabbit_nodes: move a few more functions to rabbit_nodes_common
    
    they are required by or can be useful to CLI tools.

commit f30f56c323b0db63020d9513931d0947d703bb4e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 19:01:14 2017 +0300

    A typo

commit a6cae1a2e9bc762f651b9a5ddc21f64f366244d2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 19:00:11 2017 +0300

    Terminate when message stores fail to start
    
    This makes rabbit.vhost_restart_strategy work as expected:
    higher up supervisors should decide whether the node should
    stop or keep going.
    
    Per discussion with @hairyhum.

commit b9cc246f1d08f1f43943b1f51a16b793b05fef61
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 18:34:49 2017 +0300

    Drop the "ignore" clause
    
    It was never a part of a GA release.

commit f8194a8407ade85bd3616ae7a7844786334ea860
Merge: 2ca2000d7 5d45fc999
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 17:22:46 2017 +0300

    Merge branch 'master' into rabbitmq-server-1280

commit 2ca2000d7524c6d837db82172981e6695288fe90
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 17:22:43 2017 +0300

    Correct a typo

commit 5d45fc999335451eeee3f9dd4c6f87b9fbfe4f3f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 4 17:05:55 2017 +0300

    term_to_binary_compat:queue_name_to_binary/1 was superseded

commit 0e9b333b64928ec17b5054ad4c9aece1539f0037
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 4 11:55:37 2017 +0100

    Clean up queue metrics on queue termination.
    
    This change handles all non-crash termination cases. The assumption here
    is that once an amqqueue_process terminates the master is no longer on
    the current node.
    
    [#147753285]

commit fe0e846631004d8d3661e7fa3c2b7958fdaa3f8f
Merge: 3eb114eb2 39c1bd199
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 4 10:15:31 2017 +0100

    Merge branch 'stable'

commit 3eb114eb20019e57ba02f4c3160158cc8413fd4a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 4 09:53:30 2017 +0100

    Update man entries for encode and decode commands correspond to commands API.

commit 39c1bd19965dc31688413afad8cb13c454346a57
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 4 09:46:17 2017 +0100

    Do not require a node to be running to execute decode, list_ciphers and list_hashes commands

commit 0b5aa421fff76c8b3b301bc1206ad31b39b57136
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jul 4 09:44:40 2017 +0100

    Mention ctl decode arguments on manpage.

commit b7f3904d2612b6527837e2786d245fe57c5121e8
Merge: 269a2c12e 7dfdec854
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jul 4 07:50:35 2017 +0300

    Merge pull request #1250 from rabbitmq/rabbitmq-server-1246-master
    
    Change directory name generation function for queue indexes and vhosts

commit 7dfdec854817ccc7fe979fa0da4b6d8aa5a357bf
Merge: 5a9c1af55 269a2c12e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jul 3 16:12:58 2017 +0300

    Merge branch 'master' into rabbitmq-server-1246-master

commit 269a2c12ea20e2a5170ded7c3ce21d3fc73b76e4
Merge: 572475e91 1b6063692
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jul 3 15:27:39 2017 +0300

    Merge pull request #1281 from rabbitmq/rabbitmq-common-208-master
    
    Use delegate:invoke and delegate:invoke_no_result

commit 572475e91da5193f1aa3e55b8c97bf4191766193
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jul 3 12:41:14 2017 +0200

    rabbit_looking_glass: Tell xref to ignore call to lg:trace/4
    
    [#140125673]

commit 882dd42af06b02dbad8b57217fba72133e378d25
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jul 1 06:39:03 2017 +0300

    Handle concurrent vhost creation and deletion better
    
    In the case of a vhost creation and immediate deletion those
    operations can end up executing concurrently. This changes
    a number of things to be more resilient:
    
     * Default vhost restart strategy changes to "continue" (previosly "ignore").
       It's a tough default to pick but we believe the damage of a single vhost terminating
       the entire node that may have a lot of users is greater than the need to set up an alternative
       strategy for environments where only one vhost is used. Note that the event of
       message store or vhost supervision tree termination should be very rare.
    
       Per discussion with @kjnilsson.
    
     * For vhost [message store] recovery, we now log "no_such_vhost" errors
       in a sensible way instead of a bunch of process terminations.
    
     * Max restart intensity settings for rabbit_vhost_sup_wrapper are
       changed to accommodate integration test suites that rapidly set up
       temporary vhost and delete them. In most failure message store scenarios
       the new value is still low enough to lead to vhost supervision tree
       termination when recovery is impossible.
    
    There are also drive by doc changes.
    
    Fixes #1280.

commit 1b6063692b842195c101fe9eafad70da5e33af4b
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Jun 30 16:53:31 2017 +0100

    Use delegate:invoke and delegate:invoke_no_result
    
    Further simplifications to rabbitmq-server#208 which where too large
    to apply in 3.6.11. Now invoke and invoke_no_result are called directly

commit 042122db18179f4cbac6b8805e5f024dd0079bc6
Merge: c3b77fd46 f7a16e930
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 15:06:11 2017 +0200

    Merge branch 'stable'

commit f7a16e930c888ede46b8d42fdc998c7cfabd8ded
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 15:03:14 2017 +0200

    unit_SUITE: Adapt rabbitmqctl_encode testcase to the new rabbit_control_pbe API

commit c3b77fd466111244dba820e7c993436d18588467
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 11:48:02 2017 +0200

    rabbit_runtime_parameters: Pass `ActingUser` to clear_component()
    
    In rabbit_exchange_parameters, use ?INTERNAL_USER when calling
    clear_component().
    
    This fixes the call to clear() which expects this `ActingUser`. This
    went unnoticed because the function was called as M:F() instead of F()
    even though the function is local.
    
    Reported by xref.
    
    [#140125673]

commit a18fc50def42eca56bff4bd9143a07e5557eb7cc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 11:47:30 2017 +0200

    rabbit_exchange_parameters, rabbit_runtime_parameters: Remove unused imports

commit e3c5c5068a9b8915682e4ca346f47052d4a5f6df
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 11:33:13 2017 +0200

    docs/rabbitmqctl.8: Add list_hashes, list_ciphers and decode commands
    
    This changes are ported from the following commits to rabbitmqctl.1.xml
    in `stable`:
        - commit 020fa730ce65e2e19ba6bb483bfc5c458580c533
        - commit 6b65e41330a40060919b0cc19b895a57348493a5

commit 5f5a808d883e521b2c53aa51cc267ba3f562c3be
Merge: a5cfa9dba 87bd5eccd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 11:33:04 2017 +0200

    Merge branch 'stable'

commit 87bd5eccdf96af0f416fe9d27037deceef8a11e3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 29 11:30:38 2017 +0200

    docs/rabbitmqctl.1.xml: Fix quoting of {encrypted, <<"...">>}
    
    There was three single quotes, so one extra.

commit 5a9c1af55537c1f42f120bf410c09c7331164e3e
Merge: c599c190b a5cfa9dba
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 29 01:09:05 2017 +0300

    Merge branch 'master' into rabbitmq-server-1246-master

commit 744e6991d226e87904672b227230732de59cc322
Author: Luke Bakken <luke@bakken.io>
Date:   Wed Jun 28 09:19:16 2017 -0700

    Add list_local_names function

commit a5cfa9dba58ae6d31c1444ad535ba6e3d256d236
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 28 17:29:06 2017 +0200

    rabbit_vhost: Pass ActingUser to rabbit_auth_backend_internal:clear_topic_permissions()
    
    The clause without this argument doesn't exist anymore.
    
    Reported by xref.
    
    [#140125673]

commit dbeb08a20446d72ff69e1c7b49095f2d27d12b45
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jun 26 09:27:43 2017 -0700

    Only GC local queue metrics
    
    Previously, GC would not clear out metrics for non-local queues,
    so stale data remained in the metrics tables.

commit b5d85b581fd45eb4bf36a367fd106cbbf521a1b3
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jun 26 08:20:03 2017 -0700

    Filter queue list by local pid

commit 09805ae0a4d6ddb35459c619351c13158e9f7938
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Mon Jun 26 06:52:35 2017 -0700

    Force some GC

commit 5864443b10b26b7f6b7eec652ffa1e1f43c26bcb
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 18:37:07 2017 -0700

    Add sleep to ensure sync_mirrors settles

commit 1c48e50d6613f658917ef029ff865b2899120066
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 15:48:36 2017 -0700

    Check rpc return values
    
    Simplifies code formatting by using intermediate variables in test suite setup.

commit e6c7b787e22e03066549a3b91de995e47c27144e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 14:52:45 2017 -0700

    Issue is reproduced

commit 8eddcfed59b74aafc336321c8f92cf364b43b148
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 14:28:26 2017 -0700

    Use rpc to synchronize queues

commit e092c285e753de60ae91f3e5a61268b9988bfb18
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 10:41:33 2017 -0700

    Fixes setting ha policy

commit 20e0080aa3f1f4c3ee86054bfb71f4aacb9af714
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Fri Jun 23 10:03:57 2017 -0700

    Add test skel to repro gh-427 in rabbitmq-management

commit 439cbf1389079d695e7b6e846b0f54a3892409ce
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 28 17:15:41 2017 +0200

    rabbit_runtime_parameters: Remove module name for local calls

commit 0cad86e34ee6144df8c62fde3f9113b39808ded1
Merge: 63503f124 6b65e4133
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 28 18:13:02 2017 +0300

    Merge pull request #1276 from rabbitmq/rabbitmq-server-ctl-decode
    
    Add CTL commands to decode encoded value and list ciphers and hashes

commit 6b65e41330a40060919b0cc19b895a57348493a5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 28 18:12:21 2017 +0300

    CLI: ditto for decode

commit 020fa730ce65e2e19ba6bb483bfc5c458580c533
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 28 18:07:58 2017 +0300

    CLI: add list_hashes and list_ciphers in rabbitmqctl(1)

commit 2c2a1c73afa3ae75fd219da5956019de06adab4e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 28 17:05:32 2017 +0200

    rabbit_plugins_main: Remove unused module
    
    Now everything is in the new CLI (rabbitmq-cli). Tests are calling
    rabbitm-plugins(8) instead of doing direct calls to the broker.
    
    Reported by xref.
    
    [#140125673]

commit b3a95727f91c139fbb99f9f1b316c050e58d260f
Merge: 07d98c351 63503f124
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 28 17:50:03 2017 +0300

    Merge branch 'stable' into rabbitmq-server-ctl-decode

commit 2746bc1e919affd64bac85fbaf4e8f9f0cdf5e48
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 28 16:22:21 2017 +0200

    rabbit_cli: Remove all rpc_call() clauses
    
    They seem to be unused and rpc_call/7 calls rabbit_misc:rpc_call/7 which
    doesn't exist.
    
    Reported by xref.
    
    [#140125673]

commit 4913aa0d9e149652e5a2a174ece1ddc6869f1735
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 28 15:22:29 2017 +0200

    docs/rabbitmqctl.8: Fix various syntax errors
    
    Some common mistakes such as:
        - no newline after a final `.`;
        - mdoc commands in the middle of a paragraph;
        - `Op` used even though it shouldn't enclose remaining content on
          this line
    
    I also changed variants (e.g. -t and --timeout) so they are separated by
    comas, not pipes, because this is the conventions for them: they are the
    same thing, not different options you have to pick.
    
    Finally, a few typos were also fixed.
    
    [#144034507]

commit 063b44f1fb31af9ad3df8e7d6978dfa10b104ada
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Jun 28 10:45:27 2017 +0100

    rabbitmqctl man page grammar

commit 07d98c35116c305050659294f950c16f81b9038e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Jun 28 10:35:36 2017 +0100

    Add CTL commands to decode encoded value and list ciphers and hashes
    
    `rabbitmqctl encode --decode` and `rabbitmqctl encode --list-ciphers`
    is a bit weird API, which makes every argument in the encode command
    optional.
    `rabbitmqctl decode` is not equal to `rabbitmqctl encode --decode`
    same for `rabbitmqctl list_ciphers` and `rabbitmqctl list_hashes`

commit 71ca3594b11996e7f7cb0465d7d6a89069ec9251
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 27 17:24:10 2017 +0100

    Added command manuals for commands provided by plugins.

commit 31a81e3779dc68e2c661233a60212b6555ffc305
Merge: f74855c1e 13bd0be01
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 27 18:49:01 2017 +0300

    Merge pull request #1225 from rabbitmq/rabbitmq-common-198
    
    Add rabbit_tracer boot step for running Looking Glass

commit 13bd0be01c28137c97ff187e2dcc6ada8023eeab
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 27 18:43:54 2017 +0300

    Ignore callgraph.dot*

commit f74855c1e3b0d5dfb2f723bdbfd6ceec6913442c
Merge: 1b2aeacbf b1c86ad28
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 27 17:37:54 2017 +0300

    Merge pull request #1274 from rabbitmq/rabbitmq-mqtt-139
    
    Pass in extra arguments to authentication backend

commit 1b2aeacbf9d84a40c9f7d7786f03450df3bdb7d3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 27 12:16:55 2017 +0100

    Improve options section in rabbitmqctl man page

commit 724bce652b5e015ebfb8ffd8f6e4b42bd95d9962
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 27 11:50:33 2017 +0100

    Add 3.7 commands to rabbitmqctl man page.

commit b1c86ad2896ba24df9ea69a5b0f68fc5124d80ae
Merge: 5f2ef64a7 2e99c66d7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 27 11:54:54 2017 +0300

    Merge branch 'master' into rabbitmq-mqtt-139

commit 36406cbf4b4a3cbd3907ae1f71043851fbde9721
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 27 11:28:17 2017 +0300

    Log when Looking Glass is enabled

commit fcc9879f56941ce004c50965dabae934b4103ab1
Merge: 10fd03dbf 2e99c66d7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 27 10:18:01 2017 +0300

    Merge branch 'master' into rabbitmq-common-198

commit 2e99c66d76be0fe77af51b66deb79e9ee347b208
Merge: 6381a2ed7 63503f124
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 27 09:17:39 2017 +0300

    Merge branch 'stable'

commit 63503f124d50c7585c535d24d064eb10f7f4278a
Merge: 004710e8f 24c4a6656
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 27 09:13:55 2017 +0300

    Merge pull request #1275 from rabbitmq/add-otp-version-to-server-properties
    
    Add OTP version to server properties

commit 24c4a6656e7f77eb117bd9844480f15c3dd797ae
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Jun 26 21:53:27 2017 +0100

    Add OTP version to server properties during connection negotiation
    
    I wanted to know which Erlang & RabbitMQ version I am benchmarking
    against. Whilst RabbitMQ version was already exposed via server
    properties, Erlang version wasn't.
    
    Since otp_release/0 is in rabbit_misc, it felt natural to add this
    functionality there, especially since testing it via rabbit_reader felt
    awkward.

commit 004710e8fa870ea9e10591622a0f0f4d2f0a4e19
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Mon Jun 26 21:45:58 2017 +0100

    Remove dead tests

commit 5f2ef64a751ee18f4e3d4b115f0a4331e453b733
Merge: 9d7b14e49 6381a2ed7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 26 22:01:24 2017 +0300

    Merge branch 'master' into rabbitmq-mqtt-139

commit 9d7b14e491443292196af87d3c4dcd2491c20ac5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 26 21:32:56 2017 +0300

    Compile

commit 39b7ae4699abab21f94f354d27f9ca158834839c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 26 21:28:36 2017 +0300

    Log this as an error, provide more details

commit fde61ade726bb61679b9b49826c86f969ce0b335
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 26 21:28:10 2017 +0300

    Simplify

commit 6381a2ed76c510329fabd0510d78018a93403097
Merge: 3c7bebf06 dce3829a9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 19:22:32 2017 +0200

    Merge branch 'stable'

commit dce3829a9c116f566554aaf1f2772b27333529b4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 19:19:00 2017 +0200

    rabbit_nodes_common: Move ensure_epmd() from rabbitmq-server
    
    In `master`, it is used by the new CLI.
    
    [#147436507]

commit 3c7bebf067c6e39b56becabef1432db62bdf3a3d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 18:42:05 2017 +0200

    unit_SUITE: Move auth_backend_internal_expand_topic_permission() from rabbitmq-common
    
    The module it tests was already moved.
    
    [#147436507]

commit 2115942b607ded3d75d9d6ebb93ee31ffacb5bc3
Merge: abbdbba06 e1a032742
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 18:31:45 2017 +0200

    Merge branch 'stable'

commit abbdbba062bcbbd1be457a4320f95890e5da8c8b
Merge: 93b965c5a 64b96cd17
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 18:30:19 2017 +0200

    Merge branch 'resolve-deps-circles-in-master'

commit d472412571bc10a1809bfd5ad3115f9d53ace883
Merge: 9b25c146c 93b965c5a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 26 19:20:27 2017 +0300

    Merge branch 'master' into rabbitmq-mqtt-139

commit 64b96cd17d0e33a256beafdb252e2ecc1d6a9a1e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 15:34:57 2017 +0200

    Move rabbit_net:accept_ack() to rabbit_networking
    
    ... in rabbitmq-server.
    
    This resolves a reverse dependency of rabbitmq-common on
    rabbitmq-server. However, this breaks the API because we can't keep a
    compatibility function.
    
    [#118490793]
    
    (cherry picked from commit 3d09dc5fa2ea67eab355d82292fd026e475277a2)

commit 7d60ecd6393856d8a611edbdb259eb7468af729e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 18:57:08 2017 +0200

    rabbit_auth_backend_internal: with_user_and_vhost() was moved
    
    ... to rabbit_vhost.
    
    [#118490793]
    
    (cherry picked from commit d5b5b8089b249eb36d074b296b13f753e24b932f)

commit e1a032742e8759bed01be88ce6275796680c2914
Merge: 2bddf88c8 3d09dc5fa
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 15:50:19 2017 +0200

    Merge branch 'resolve-deps-circles' into stable

commit 9013870415e3c887a107134c035af0f74f3f4f93
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 18:54:42 2017 +0200

    Move modules which don't belong to rabbitmq-common here
    
    Those modules depend on rabbitmq-server but they are used neither by the
    Erlang client nor by rabbitmq-common itself.
    
    They are imported as-is. Some may need further changes after the import.
    
    This resolves the dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit 9cf0cfea9eb087b9df1c0e6ab636601be6c9a7cb)

commit df5f0607d37fbff29157db647f3b5dde8d3ebd15
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:39:04 2017 +0200

    rabbit_vhost: Move with_user_and_vhost/3 from rabbit_misc in rabbitmq-common
    
    This is a breaking change and we'll need to update users of this API.
    
    This resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit 3ad84520cb23e4bf05662e43384870de529d21a6)

commit 0994b6bad44a706dac0ac118ed4f47c7e9c9cb87
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:38:00 2017 +0200

    mnesia_sync: Move to rabbitmq-common
    
    Thi resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit ef5fc31c6eb8033895a7f4b29ab715f4ce313651)

commit b5467360bc38a57611a7e8c911510a60faa0e2e0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:37:05 2017 +0200

    worker_pool: Move to rabbitmq-common
    
    Thi resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit b634a84851505535d9e8ecb7eb96584dfa371f58)

commit 6a6b91cf9e6aa7a466099cf20918bd283ca01b3b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 14:04:15 2017 +0200

    Move rabbit_networking and rabbit_reader from rabbitmq-common
    
    They are not used by rabbitmq-common or rabbitmq-erlang-client anymore.
    This solves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit 7d470b84f004cbcddefa960df0c65bbcb95d9a83)

commit 5ebd97af63779d581803847b519cad6ebac2b871
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 13:21:27 2017 +0200

    rabbit_log: Move it from rabbitmq-server to rabbitmq-common
    
    It obviously depends on a running broker, but some modules in
    rabbitmq-common call it. This resolves a dependency of rabbitmq-common
    on rabbitmq-server.
    
    `master` branch only:
        Also move rabbit_log.hrl from rabbitmq-server to rabbitmq-common.
    
    [#118490793]
    
    (cherry picked from commit 5f2c1152890f44e60af92b8ca97b922f0d0e9bed)

commit 8dc4ce30413417770c5b474b8e6a7c8469d29dba
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 13:20:23 2017 +0200

    vm_memory_monitor, rabbit_resource_monitor_misc: Move to rabbitmq-common
    
    vm_memory_monitor is used by file_handle_cache which was previously
    moved here (see commit c36be242a58863be872b08b9bc0ec79c6d23b1db).
    
    rabbit_resource_monitor_misc is used by vm_memory_monitor.
    
    They are generic enough to be moved to rabbitmq-common. This resolves a
    dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]
    
    (cherry picked from commit 95c993dc848c679da0a130965920eb31e104104f)

commit 93b965c5ab96b81f71bc64e3b43097e4a8f97b96
Merge: 5aa080b96 2bddf88c8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 26 14:38:46 2017 +0200

    Merge branch 'stable'

commit 3d09dc5fa2ea67eab355d82292fd026e475277a2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 15:34:57 2017 +0200

    Move rabbit_net:accept_ack() to rabbit_networking
    
    ... in rabbitmq-server.
    
    This resolves a reverse dependency of rabbitmq-common on
    rabbitmq-server. However, this breaks the API because we can't keep a
    compatibility function.
    
    [#118490793]

commit d5b5b8089b249eb36d074b296b13f753e24b932f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 18:57:08 2017 +0200

    rabbit_auth_backend_internal: with_user_and_vhost() was moved
    
    ... to rabbit_vhost.
    
    [#118490793]

commit 9cf0cfea9eb087b9df1c0e6ab636601be6c9a7cb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 18:54:42 2017 +0200

    Move modules which don't belong to rabbitmq-common here
    
    Those modules depend on rabbitmq-server but they are used neither by the
    Erlang client nor by rabbitmq-common itself.
    
    They are imported as-is. Some may need further changes after the import.
    
    This resolves the dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit 3ad84520cb23e4bf05662e43384870de529d21a6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:39:04 2017 +0200

    rabbit_vhost: Move with_user_and_vhost/3 from rabbit_misc in rabbitmq-common
    
    This is a breaking change and we'll need to update users of this API.
    
    This resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit ef5fc31c6eb8033895a7f4b29ab715f4ce313651
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:38:00 2017 +0200

    mnesia_sync: Move to rabbitmq-common
    
    Thi resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit b634a84851505535d9e8ecb7eb96584dfa371f58
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 16:37:05 2017 +0200

    worker_pool: Move to rabbitmq-common
    
    Thi resolves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit 7d470b84f004cbcddefa960df0c65bbcb95d9a83
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 14:04:15 2017 +0200

    Move rabbit_networking and rabbit_reader from rabbitmq-common
    
    They are not used by rabbitmq-common or rabbitmq-erlang-client anymore.
    This solves a dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit 5f2c1152890f44e60af92b8ca97b922f0d0e9bed
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 13:21:27 2017 +0200

    rabbit_log: Move it from rabbitmq-server to rabbitmq-common
    
    It obviously depends on a running broker, but some modules in
    rabbitmq-common call it. This resolves a dependency of rabbitmq-common
    on rabbitmq-server.
    
    [#118490793]

commit 95c993dc848c679da0a130965920eb31e104104f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 2 13:20:23 2017 +0200

    vm_memory_monitor, rabbit_resource_monitor_misc: Move to rabbitmq-common
    
    vm_memory_monitor is used by file_handle_cache which was previously
    moved here (see commit c36be242a58863be872b08b9bc0ec79c6d23b1db).
    
    rabbit_resource_monitor_misc is used by vm_memory_monitor.
    
    They are generic enough to be moved to rabbitmq-common. This resolves a
    dependency of rabbitmq-common on rabbitmq-server.
    
    [#118490793]

commit c599c190bfe936e25ec3e93e6e53fe77ee075893
Merge: 59ce657ab 5aa080b96
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 24 00:07:55 2017 +0300

    Merge branch 'master' into rabbitmq-server-1246-master

commit 5aa080b9695e341784272268bf90927914f1ce7a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 23 23:51:16 2017 +0300

    Add a mapping for ssl_options.honor_ecc_order

commit 371ebdba64b630182a8750345d4b44ddd0fd1dff
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 23 15:26:20 2017 +0300

    Don't use export_all
    
    It emits a warning and breaks compilation on OTP 20.
    Originally introduced in 492e23bf188820756e07076c4539692376cfcbc6,
    likely unintentionally.
    
    Fixes #1272, references #567, #766.

commit 9b25c146c39910787a0c0862f7c73b0b7c35f607
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Jun 22 15:53:48 2017 +0200

    Pass in extra arguments to authentication backend
    
    Those extra arguments are extracted from an external module,
    the convention being "rabbit_%protocol%_connection_info" for the module name.
    This allows to pass in plugin-specific authentication arguments,
    e.g. client ID in the case of MQTT.
    
    Part of rabbitmq/rabbitmq-mqtt#139

commit 2bddf88c8ee0b247e105d32371b74c769e16043c
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Thu Jun 22 10:35:26 2017 +0100

    Fix log_management test in OTP 20
    
    The Format structure for error_logger:error_report(Type, Report) is
    different in OTP 20, otherwise nothing will get logged in the SASL log
    file.

commit 5432d05d2f2651c4389e9fc1351d4d624dd44b1e
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Jun 21 17:37:57 2017 +0100

    Remove duplicate README
    
    README.md is the one that we want to keep & distribute, surely
    
    To be honest, I was looking for a tiny change that would trigger the
    entire pipeline. This felt minor and helpful, but feel free to revert if
    it's not.

commit 6d20b774a3acc4e05728aa993e7bf78cef0d6b58
Merge: ed00c84c4 b5b529d2d
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 21 18:08:41 2017 +0300

    Merge pull request #1270 from rabbitmq/rabbitmq-server-1223-fix
    
    Use wmic instead of tasklist to get Windows process memory

commit b5b529d2df4bd9ebb74a97e3dc616812d589d857
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Jun 21 06:57:19 2017 -0700

    Use wmic instead of tasklist to get Windows process memory

commit ed00c84c43705a95f5ee4941a58f49673a1d5979
Author: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 12:47:36 2017 +0100

    Fix term_to_binary_compat tests in R16B03
    
    For realz this time
    
    R16B03 defaults term_to_binary version to 0, this test would always fail
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit ce98122454f6897be0753e2938e8f59a533dbc93
Merge: 72415b1c9 c253b4201
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 11:56:51 2017 +0200

    Merge branch 'stable'

commit c253b4201c5d65a4346cc95ef3636d334ad7d87b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 09:10:23 2017 +0200

    rabbit_vm, vm_memory_monitor: Use spaces to indent

commit fed1732ddc7a801586afbc0bc74b621e036fa475
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 21 09:07:49 2017 +0200

    Move total_memory() from rabbit_vm to vm_memory_monitor
    
    This resolves a reverse dependency of a generic module on a
    RabbitMQ-specific module. This is required because the vm_memory_monitor
    module is about to be moved to rabbitmq-common.
    
    [#118490793, #145451399]

commit 59ce657abcdbbed66799f466792657709baae37d
Merge: dd18cf354 72415b1c9
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Tue Jun 20 15:01:58 2017 -0700

    Merge branch 'master' into rabbitmq-server-1246-master

commit 74c3758b1faff3d7421466ecf4e8885d831edefe
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Jun 20 12:41:33 2017 +0100

    Improve naming for test iterations & properties which are tested
    
    [#146794925]

commit 085bacfe5a843eba507b927c9c616212f3e5487e
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Jun 20 12:38:06 2017 +0100

    Fix binary comparison in OTP R16B03
    
    Binaries are not equal in OTP R16B03 & 20-rc.1, converting binary back
    to term passes in R16B03.
    
    Would have tested OTP 20-rc.1 as well, but it's not available via kerl
    
    [#146794925]

commit 72415b1c9446db5ad38b7d70a45fec6942682ec0
Merge: bc5048b89 d81736602
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 19 22:21:05 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_vm.erl
            src/term_to_binary_compat.erl

commit bc5048b89ddda79fd12e68247bda58a5691f7f28
Merge: 22cc2ae68 8e3d3ab47
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jun 19 21:31:54 2017 +0300

    Merge pull request #1265 from rabbitmq/rabbitmq-server-1264
    
    Add vm_memory_calculation_strategy to cuttlefish schema

commit d81736602e67eca0b83bcb72b8fce805b328a2e0
Merge: 1c8798a9f bbc69fe5c
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jun 19 21:31:17 2017 +0300

    Merge pull request #1259 from rabbitmq/rabbitmq-server-1223
    
    Use system process rss memory when reporting vm memory

commit 8e3d3ab47ff01c3c0dd17d424850001bd4f7d13c
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Jun 14 07:31:40 2017 -0700

    add memory_monitor_interval test
    
    fix memory_monitor_interval test
    
    Add vm_memory_use_process_rss setting and tests
    
    Use vm_memory_calculation_strategy

commit bbc69fe5ccdf4443a0b5dbe60c2bfe9d2d5533ae
Merge: a0151e487 ce85ac7bb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 19 18:45:41 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1223

commit 1c8798a9fb841ec67bbfecee2703d40db65e93cd
Merge: 2c6edde9b 0e148dac5
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Jun 18 12:01:12 2017 +0300

    Merge pull request #1268 from rabbitmq/rabbitmq-server-1243
    
    Make term_to_binary_compat generate binaries using minor_version 1.

commit 0e148dac5956c7123546da7aca460693aea2c30b
Merge: a5aac7736 2c6edde9b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 05:43:42 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1243

commit 22cc2ae68aa1724f51e7e471db0f624b9d5195dd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 05:38:19 2017 +0300

    Revert "Revert "Using square brackets could cause an error""
    
    This reverts commit 836ae267e6a959a0243de38ce0ae4200f935b446.
    
    This revert was only necessary in stable.

commit 0a6d3e1cb1e0f69c0c94470c674edadfe0521c88
Merge: f1362318a 2c6edde9b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 05:37:59 2017 +0300

    Merge branch 'stable'

commit 2c6edde9bfa44f55d1bda038b854194c9b552364
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 05:36:46 2017 +0300

    Manually re-apply #1269

commit 836ae267e6a959a0243de38ce0ae4200f935b446
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 05:35:21 2017 +0300

    Revert "Using square brackets could cause an error"
    
    This reverts commit ce85ac7bb66203b19630317cc52fec81f3299cda.
    
    This includes some master-specific bits.

commit f1362318af23e07b72a59a58e643abe9a2574c76
Merge: 23514b549 1e000575e
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jun 17 05:17:35 2017 +0300

    Merge pull request #1232 from rabbitmq/rabbitmq-server-1229
    
    Add tests for variables expansion in topic authz

commit 1e000575ec245435f4b7119ef26f3cbc1ba4e05d
Merge: 2fde6d074 23514b549
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 04:20:27 2017 +0300

    Merge branch 'master' into rabbitmq-server-1229

commit 23514b549879b329fe87070d30d8d2df6394904e
Merge: fc1d2fac7 ce85ac7bb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jun 17 04:00:40 2017 +0300

    Merge branch 'stable'

commit ce85ac7bb66203b19630317cc52fec81f3299cda
Author: Luke Bakken <luke@bakken.io>
Date:   Fri Jun 16 11:47:03 2017 -0700

    Using square brackets could cause an error
    
    Conflicts:
            scripts/rabbitmq-env.bat

commit fc1d2fac70045df813520e893d94df80925b9d4a
Merge: 201455836 715156799
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jun 17 03:58:20 2017 +0300

    Merge pull request #1269 from rabbitmq/fix-windows-empty-string
    
    Using square brackets could cause an error

commit 7151567997f688a7a82ceafd192743c8242518ea
Author: Luke Bakken <luke@bakken.io>
Date:   Fri Jun 16 11:47:03 2017 -0700

    Using square brackets could cause an error

commit 2014558366e10e07860659ed639f0a4cb7bcad81
Merge: 1de9c89d3 63c2637d4
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Jun 16 15:42:55 2017 +0100

    Merge pull request #1267 from rabbitmq/rename-schema-file
    
    Rename schema file to match application name.

commit a5aac7736361e8841b8b6938f372c3876c51518f
Author: Daniil Fedotov <fedotov.danil@gmail.com>
Date:   Fri Jun 16 12:28:07 2017 +0100

    Make term_to_binary_compat generate binaries using minor_version 1.
    
    term_to_binary now has `minor_version:2` to always generate utf-8 atoms,
    while default is `1`, so binaries generated in OTP-20 should be
    the same as in OTP-19 for non-unicode atoms.

commit 2fde6d0743796da1550a4ec10a95392c1c310825
Merge: d026b0377 1de9c89d3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 15 20:20:49 2017 +0300

    Merge branch 'master' into rabbitmq-server-1229

commit 63c2637d49b43a5662113d303efb7df4a5298350
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Thu Jun 15 09:25:43 2017 -0700

    Rename rabbitmq.schema to rabbit.schema so that the name matches the application name

commit 1de9c89d34c65145cad487ef3daeaf6aff84930d
Merge: 41a396e26 c512b9256
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 15 16:10:18 2017 +0300

    Merge pull request #1266 from rabbitmq/cluster_formation
    
    Depend on inets to ensure it is started when peer discovery begins

commit c512b9256f6657cbdb4838222806463b8232c47e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Jun 14 16:36:24 2017 +0100

    Depend on inets to ensure it is started when peer discovery begins
    
    Sometimes the boot sequence of the dependencies changes, and inets is
    not started before rabbit. However, it is needed by some of the
    peer discovery backends to perform discovery (i.e. etcd).
    
    rabbitmq-server#1257

commit a0151e487b84f7159ca99b5efe1175de4faba791
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Jun 15 10:30:47 2017 +0100

    Move function that reports total used memory
    
    Tests were failing because they required vm_memory_monitor process to be running
    
    re #1259
    
    [#145451399]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit bc0309d9218be7786eb80f96e1065c97042905c9
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Wed Jun 14 17:44:42 2017 +0100

    Change vm_memory_use_process_rss config to vm_memory_calculation_strategy
    
    [#145451399]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit b6efa2dd3c0adea4212d28e43524fab7bc2a91af
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Wed Jun 14 12:05:26 2017 +0100

    Use OS memory total when reporting memory usage
    
    Account for extra memory that was reported in other_ets
    
    [#145451399]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit d026b03778dadd7d6362666918b308b18474750f
Merge: 8dcf621db 91e3fc076
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Jun 14 11:01:32 2017 +0200

    Merge branch 'rabbitmq-server-1229' of github.com:rabbitmq/rabbitmq-server into rabbitmq-server-1229

commit 8dcf621dba2f12b0a54f01591ccd430a0e8122ff
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Jun 14 10:57:22 2017 +0200

    Change wording for topic authz variable expansion
    
    Part of rabbitmq/rabbitmq-server#1229

commit 32b9c88d1eba112d721c720dd1c80c981b1e5972
Merge: b077d47e7 41a396e26
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Jun 14 10:18:52 2017 +0200

    Merge branch 'master' into rabbitmq-server-1229

commit 91e3fc0764fb210c6d7aa24fc2b206653c7bc47c
Merge: b077d47e7 35f43082a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 13 23:56:08 2017 +0300

    Merge branch 'master' into rabbitmq-server-1229

commit 41a396e26e3d5fea88ee3e9e375a2ef791bf1b21
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 13 17:23:10 2017 +0100

    Do not assume `#resource` is a 4-element tuple.
    
    The queue_name_to_binary compat function is used in migration
    functions, so `resource` record can change.
    Still in the old version, from which we are upgrading it will be
    a 4-element tuple.

commit 10da251c856468e4690b37d33bb2fd81e2b37a58
Merge: 35f43082a 66b831d3a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 13 17:18:41 2017 +0200

    Merge branch 'stable'

commit 6a84ef415d5b493f5ee4008883e5cd34cdc923af
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 13 14:59:07 2017 +0100

    Current process system memory functions for various OSes.
    
    According to AIX, SunOS and BSD docs, ps command can have rss format,
    so get_ps_memory should work.
    We already requiring tasklist for wait command, so we can use it here.

commit 66b831d3ab635d111841fb6b07cc284974e028e4
Merge: 910446f54 699c45508
Author: D Corbacho <diana@rabbitmq.com>
Date:   Tue Jun 13 13:15:39 2017 +0100

    Merge pull request #1260 from rabbitmq/improve-partitions_SUITE
    
    Improve `partitions_SUITE`

commit dd18cf3540bc4e87b4a5d586a6c88a4bf8b88874
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 13 12:09:42 2017 +0100

    Remove debug commands in clustering management test

commit 5c69639b5d15556fe3271640fcfba1688d4984f7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Jun 7 11:28:46 2017 +0100

    Change directory name generation function for queue indexes and vhosts.
    
    It was a mistake to relate on md5(term_to_binary(..)) to generate
    vhost and queue directory name, since term_to_binary format can
    change.
    Migration functions take care of renaming directories.

commit 699c45508a95ea568eef9fe3f1e9c9e912669c8a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 8 16:57:49 2017 +0200

    partitions_SUITE: Try to improve partial_pause_minority
    
    The testcase simulates a partial partition which should be detected by
    the two nodes on each side of the partition. They should both decide
    there is a partial partition and stop.
    
    However, sometimes one of the node is faster than the other one: it sees
    the partial partition and stops before the second node even sees the
    partition. When this happens, the second node doesn't even bother to
    stop (because the partition is full now). Thus the testcase fails
    because it expects both nodes to stop.
    
    This patch tries to sync partial partition checks so both A and B
    decide there is a partial partition.
    
    [#146911969]

commit 0bd9368048704de5464605896a6c09befd173221
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 8 16:50:02 2017 +0200

    partitions_SUITE: Try to improve partial_false_positive
    
    The testcase simulates a small delay between the times B sees A down
    and C sees A down too. Because A is effectively down for both, B's
    rabbit_node_monitor shouldn't see a partial partition.
    
    When B sees A down first, it asks C about A. In the scenario the
    testcase simulates, C tries to contact A, fails and reports to B that A
    is down.
    
    However, because of the way we simulate that delay, sometimes, C still
    sees A when B asks about it, because the link between A and C isn't
    blocked yet. When this happens, B decides there is a partial partition.
    Therefore, the testcase fails because it tests that this shouldn't
    happen.
    
    To try to be closer to a real-world situation (where A would be really
    down for B and C), we suspend C's rabbit_node_monitor until we block the
    link between A and C. Thus B still asks C about A, but C only processes
    the request when the link is indeed down.
    
    [#146911969]

commit 085820636c5c52c0b61900ae1597e9f2ecd740b4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 8 16:49:13 2017 +0200

    rabbit_node_monitor: Normalize indent and remove trailing spaces

commit 910446f548cea92c563904e3ecd39199355444da
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 13 12:12:25 2017 +0200

    rabbit: Remove trailing space in log message

commit b077d47e7596973b9b8ec01d48233f42a0eb097e
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Jun 13 10:40:07 2017 +0200

    Document topic permissions in rabbitmqctl man page
    
    Part of #505, #1085, #1229

commit 35f43082a1ab0d3ce49ab8958e980fb81b55f159
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 12 18:35:32 2017 +0300

    Update rabbitmq-components.mk

commit 69d2517e8d0e65147f38856c6d3fbcb79bc42cbc
Merge: 681ee865e c8e3210bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jun 12 19:44:40 2017 +0300

    Merge pull request #1258 from rabbitmq/rabbitmq-server-1257
    
    Locking support in cluster formation

commit c8e3210bc5c9604a8759ab3ea28dc76d1a00d0c2
Merge: b52796379 245e3c730
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 12 19:26:13 2017 +0300

    Merge branch 'master' into rabbitmq-server-1257

commit 681ee865ec5f8ee57e1bbc2a8b1d5bcaa6f55288
Merge: 245e3c730 a23338ad6
Author: Daniil Fedotov <fedotov.danil@gmail.com>
Date:   Mon Jun 12 16:35:46 2017 +0100

    Merge branch 'stable'

commit 9058f32fab12d6fce953e12ed423b9af34762d90
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 12 18:35:32 2017 +0300

    Update rabbitmq-components.mk

commit a83efdf60c4d90f1b2f37beecac1af0c05861c5b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jun 12 13:03:15 2017 +0100

    Use system process rss memory when reporting vm memory
    
    Memory reported by erlang:memory(total) is not supposed to
    be equal to the total size of all pages mapped to the emulator,
    according to http://erlang.org/doc/man/erlang.html#memory-0
    erlang:memory(total) under-reports memory usage by around 20%
    
    [#1223]
    [#145451399]

commit b52796379ac465f35f5d92b901514b3cff3040c1
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Jun 9 14:56:39 2017 +0100

    Rename test suite

commit 981cfc359547ba80c2d9b2d8c1c3d8639cff6742
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Jun 8 17:22:38 2017 +0100

    Locking support in cluster formation
    
    Adapted from autocluster to avoid race conditions on startup
    
    rabbitmq-server#125
    [#146871615]

commit 245e3c73031f2a7c27d32daa802dd03ec5b8aec2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 9 00:36:36 2017 +0300

    More peer discovery backend shortcuts

commit a23338ad6fa3d0b7b2e9613ba0e84fff12078d82
Merge: d6d9e9824 a674f9b08
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 8 22:46:17 2017 +0300

    Merge pull request #1246 from rabbitmq/rabbitmq-server-1243
    
    OTP-20 compatibility workaround for queue directory names. 3.6 only!

commit 04cadbc100a1634a65235dc4c7dbaecb0c8244d5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 8 18:13:15 2017 +0100

    Add an API to await for node startup from a remote node.
    
    rabbitmqctl wait will have more flexibility if the rabbitmqctl node
    will do the waiting. For example when net_ticktime is lower than
    startup time wait would not fail.

commit fb82e4bca6aa4423cb068f5f5c5f41fdad6d2ab6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 8 14:58:45 2017 +0100

    APi to start_apps with different modes. Required by tests to not stop the common_test node

commit a674f9b08280a2ec3c323df50e58a61b00ae038f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 8 13:02:34 2017 +0100

    Use binaries as queue names in tests

commit bca99be7e265528b8bdbc6b5c2c51c6e178bfda4
Merge: 7bc277098 d6d9e9824
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 8 00:59:54 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1243

commit d6fedd2329c2561f73e7b59bb6e3434d1504971d
Merge: cdc8746f4 d6d9e9824
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 7 19:34:19 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            docs/rabbitmq.config.example

commit d6d9e9824c3284efb9fd9b166686dc0e84fe4451
Merge: 915475013 7cd2ca4fc
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 7 19:33:08 2017 +0300

    Merge pull request #1253 from FabianPonce/fix-gc-docs-stable
    
    Improve documentation around new default for background garbage collection

commit cdc8746f4a3f29ab5649f5c9a110a3b46a0c23fe
Merge: 2da358c3e 4360293bb
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 7 19:31:52 2017 +0300

    Merge pull request #1254 from rabbitmq/lrb-remove-stale-comment
    
    Remove stale comment

commit 4360293bbd883bcfd119ae9329edabaaa973ef3e
Author: Luke Bakken <lbakken@pivotal.io>
Date:   Wed Jun 7 09:22:23 2017 -0700

    Remove stale comment

commit 2da358c3e662f002774a23a5feae400a0b60fe87
Merge: 00b48b8b7 8d52a0915
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 7 19:13:15 2017 +0300

    Merge pull request #1252 from FabianPonce/fix-gc-docs
    
    Improve documentation around new default for background garbage collection

commit 7cd2ca4fcd72e472bf582b45aa9380795aa28d94
Author: Fabian Ponce <fponce@toasttab.com>
Date:   Wed Jun 7 10:56:39 2017 -0400

    Modify the documentation and background_gc.erl default value for background_gc_enabled to false to match the behavior of the Makefile.

commit 8d52a09154fe4a63690eb022aa1a3ba79388f551
Author: Fabian Ponce <fponce@toasttab.com>
Date:   Wed Jun 7 10:56:39 2017 -0400

    Modify the documentation and background_gc.erl default value for background_gc_enabled to false to match the behavior of the Makefile.

commit 00b48b8b78c9bb596708a3cff080a9e3f3ad4132
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Jun 7 10:42:07 2017 +0100

    Typo

commit 14765d868d53f1ca749b8862452daa6eb2781c28
Merge: 5fad38ef9 915475013
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 6 23:55:00 2017 +0300

    Merge branch 'stable'

commit 915475013ecf5e3ed7f8ec53b77a75cb9b7514a1
Merge: f3a2b1ff1 6574b971a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 6 23:54:26 2017 +0300

    Merge branch 'rabbitmq-server-1233-v2' into stable

commit 6574b971a48fa21c1f9482d431d414097f022bc6
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Jun 6 16:25:11 2017 +0100

    Log MiB instead of MB and report total of bytes
    
    rabbitmq-server#1233
    [#146160779]

commit 5fad38ef9f86549c4b1a32d064bc307f8115aa1a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 6 16:21:49 2017 +0100

    Update clustering management test to support new CLI output.
    Already joined node message.
    Changing disk node to disk should not fail

commit 7bc2770983345eb110015f03244720be78c9ba64
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 6 15:43:48 2017 +0100

    Comment on binary format values

commit 6ad1cd16f0352a75446fcf94eb2fce2d50d69889
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 6 15:27:37 2017 +0100

    OTP-20 compatibility workaround for queue directory names.
    
    OTP-20 has different binary format for atoms (since OTP-14337)
    So term_to_binary generates different value.
    testm_to_binary_compat now have a function to generate a binary
    identical to pre-20 versions.

commit 2fda08f9e17440a965cb70037b892ac8e7edb2ff
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 6 11:56:11 2017 +0200

    clustering_management_SUITE: join_cluster returns `ok` if successful
    
    ... even if the node is already a member.
    
    This fixes a failure in the `join_and_part_cluster` testcase.

commit 3000c66caebb456228030e03c2eb845c90b57d94
Merge: cfcef54b0 5f9752ca8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Jun 6 11:54:01 2017 +0200

    Merge remote-tracking branch 'origin' into rabbitmq-server-1229

commit 5f9752ca8bbda64a3dff46afe9ea6043cce47006
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 6 03:57:08 2017 +0300

    Support short peer_discovery_backend values
    
    The list of backends that will be available when 3.7.0 ships
    is shaping up.
    
    Still to port: etcd and Kubernetes.

commit b8562582146bb145a030e2066fedddc40eb45b0e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 5 16:12:23 2017 +0300

    autocluster => cluster_formation in Cuttlefish schema

commit 20a58d57319526b26c829cf124fe009ff32146d9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 5 15:54:41 2017 +0300

    rabbit.autocluster => rabbit.cluster_formation
    
    This name is both more descriptive and helps us avoid any possible
    conflicts with rabbitmq-autocluster, in particular in the new config
    format (Cuttlefish) that we will introduce for both soon.
    
    Per discussion with @dcorbacho.

commit 71db1fe3f6d459b05525e0537e907e54f11d0019
Merge: 2c8e68ee5 f3a2b1ff1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 2 19:05:11 2017 +0300

    Merge branch 'stable'

commit f3a2b1ff1722220f5800a974fdd8fdc5faadebce
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 2 17:51:20 2017 +0300

    Update rabbitmq-components.mk

commit 2c8e68ee58592435621552b44876554e0daba55a
Merge: 301f70512 c7416a0c8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 2 13:18:56 2017 +0300

    Sync with upstream

commit 301f70512020e7321cfb6b96aac25cf75e785d8e
Merge: cf580219a bd32bac51
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 2 13:17:33 2017 +0300

    Merge branch 'stable'

commit c7416a0c8d49a2f8f33221e01364106a6ea9ac98
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 19 11:44:04 2017 +0200

    crashing_queues_SUITE: Remove an unused variable

commit bd32bac51d2531b2ea861279ab0246d0c78bdaa1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jun 2 00:43:14 2017 +0300

    Update rabbitmq-components.mk

commit cf580219a59f1baae8ce1ba1ea3268fe0a207c55
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 1 18:01:26 2017 +0300

    Update rabbitmq-components.mk

commit 37ac807665ddca4a3a477f2685baffd2a8a41456
Merge: 0d8528a20 d22ceb83a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 1 03:22:00 2017 +0300

    Merge branch 'stable'

commit 0d8528a208b3600079bd6b64cd5999d73d0a7354
Merge: 2641939e5 d9e2c27f7
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 31 00:34:43 2017 +0300

    Merge pull request #1239 from rabbitmq/rabbitmq-server-1221
    
    Configure MNESIA_BASE and MNESIA_DIR on dev environment

commit d22ceb83a0f5eda78ee21f8e795ccce93d5851d7
Merge: 9084194f3 6ea51670a
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 30 14:20:06 2017 +0300

    Merge pull request #1241 from rabbitmq/rabbitmq-server-1238-stable
    
    Update sup_delayed_restart_SUITE for rabbitmq-common#202

commit 2641939e59ec9356b6228f89627b0ea32d2dd57d
Merge: 8bf65e52f c37370877
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 30 14:19:46 2017 +0300

    Merge pull request #1238 from aartamonau/master
    
    Update sup_delayed_restart_SUITE for rabbitmq/rabbitmq-common#201

commit 6ea51670aa1fd85f287c4e5dfbbec446208f07a5
Author: Aliaksey Artamonau <aliaksiej.artamonau@gmail.com>
Date:   Mon May 29 12:39:17 2017 -0700

    Fix sup_delayed_restart_SUITE.
    
    To accommodate changes made in rabbitmq/rabbitmq-common#201.

commit d9e2c27f70c3c9dcae48f5b1b910c45383094279
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue May 30 10:23:29 2017 +0100

    Configure MNESIA_BASE and MNESIA_DIR on dev environment
    
    rabbitmq-server#1221
    [#145264225]

commit c37370877c4232d2c247be99f321aa7c87e4b80f
Author: Aliaksey Artamonau <aliaksiej.artamonau@gmail.com>
Date:   Mon May 29 12:39:17 2017 -0700

    Fix sup_delayed_restart_SUITE.
    
    To accommodate changes made in rabbitmq/rabbitmq-common#201.

commit 10fd03dbf2168aed1cb7e96da7c3603444f1e449
Merge: f8dbf368b 8bf65e52f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 27 00:46:01 2017 +0300

    Merge branch 'master' into rabbitmq-common-198

commit 8bf65e52fc2e5a6242197f8364d2ec0dd3b60145
Merge: 91fc8a182 9084194f3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 27 00:45:47 2017 +0300

    Merge branch 'stable'

commit 9084194f327275b268e64e5f9928eb1e91a50219
Merge: 904e5274b 7c8ccae3b
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat May 27 00:44:51 2017 +0300

    Merge pull request #1226 from binarin/dont-expand-dir-plugins-stable
    
    Don't expand plugins that are already unpacked

commit 904e5274b09eb55dfbad67de0a48e0f09410e134
Merge: 92702e4c5 1b976358b
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri May 26 22:45:16 2017 +0300

    Merge pull request #1234 from rabbitmq/rabbitmq-server-1224
    
    Introduce a new config parameter, total_memory_available_override_value, to override total amount of memory available to the node

commit 1b976358b62db552f70a0f6c273431895e3cddb0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri May 26 17:26:28 2017 +0300

    Missing comma in config example

commit eb7e6afd06f6e3c415d0350d295e097540bfd9cf
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri May 26 13:52:03 2017 +0100

    Use new config parameter total_memory_available_override_value to set total memory
    
    rabbitmq-server#1224
    [#145450413]

commit cfcef54b08c0d86b01d28dc4d7f284e44c6bf4dc
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri May 26 11:03:27 2017 +0200

    Change variable map key in context for topic authz
    
    References #1229

commit f8dbf368bc358ad0ac889354f4fc2cfd1942d96f
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu May 25 20:18:46 2017 +0200

    Rename rabbit_tracer to rabbit_looking_glass

commit 91fc8a18225ae72e104d9fab2578f7fe56bf8e96
Merge: f85e73334 92702e4c5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu May 25 03:07:10 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/file_handle_cache.erl
            src/file_handle_cache_stats.erl
            src/rabbit_runtime_parameters.erl

commit f85e7333461717af78437c6dfec91be33953501e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 24 19:53:52 2017 +0300

    Ditto

commit 47c3793003628d7922cab91e7c1c548a5f0b2973
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 24 19:18:57 2017 +0300

    Avoid double quotes in this log entry
    
    ~p will enclose node name (an atom) in single quotes, which our message
    already has

commit 032d3c8511a4e99dd91c5bab731367b8ee4bf4a0
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed May 24 15:57:55 2017 +0200

    Add tests for variables expansion in topic authz
    
    References #1229

commit a440bc6c95a1a368f072877a6d1507a32e4776f7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed May 24 13:26:16 2017 +0100

    Format runtime parameters using info items
    
    Runtime parameters list functions do not accept info items
    as arguments. To return correct number and items order in the new CLI
    parameters should be sorted by info items order.

commit 993abe90bbc625e655d1d2e748b5af8559097db4
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed May 24 11:03:05 2017 +0100

    Use autocluster tag around peer_discovery_backend in Makefile

commit 7c8ccae3b3821740dd66cf61b307e9682b132c65
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue May 23 16:19:00 2017 +0300

    Naming, wording

commit da982ef3391a3034b88a35bcdc505f652c0be9bf
Merge: 915f1e944 fb17eed76
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue May 23 16:19:08 2017 +0300

    Merge branch 'binarin-dont-expand-dir-plugins-master'

commit fb17eed76e872b240f1f30a3bdaac7f7a8d7945f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue May 23 16:19:00 2017 +0300

    Naming, wording

commit 92702e4c5093ecb4ad911603c2357ccadebc52e9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue May 23 12:31:28 2017 +0100

    Fix runtime parameter formatting.
    
    rabbit_misc:json_encode can return a list or a binary.

commit 2811aabc56e9d425a32d42444a54f189255f64db
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu May 18 19:48:30 2017 +0300

    Use plugins dist dir as primary source of truth about presen plugins
    
    This is a 'master' counterpart for #1226

commit 63ca704621855cc27d27c3615b1a9b0650fcabf9
Merge: 915f1e944 ab6615780
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon May 22 18:38:01 2017 +0300

    Merge 'dont-expand-dir-plugins-stable'

commit ab66157805aecdc07675418229511154ecb423e7
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu May 18 19:48:30 2017 +0300

    Don't expand plugins that are already unpacked
    
    This prevents creating unnecessary files when running in embedded
    mode, and in development mode it keeps code path clean and compatible
    with different interactive tools.
    
    Also some new error conditions are properly handled and logged:
    - Failure to unpack an .ez-file
    - Missing .app file in plugin directory

commit e118297eab361ff3fbb023f49c2131e4a617a253
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 21 12:18:04 2017 +0300

    Ignore more tracing tool artifacts

commit c36be242a58863be872b08b9bc0ec79c6d23b1db
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 19 17:17:32 2017 +0200

    file_handle_cache: Move it from rabbitmq-server to rabbitmq-common
    
    This module is generic enough and is used by the Erlang client. Moving
    it is the last step to resolve the interdependency between the Erlang
    client and the broker: with this change, the client only depends on
    rabbitmq-common!
    
    [#118490793]

commit 5e0b977d0d5847821f35e07d10697e33ffd5a69a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 19 17:08:09 2017 +0200

    rabbit_upgrade_functions: Turn off `export_all` warning
    
    Erlang 20.x warns if `export_all` is set in a module by default. We need
    to turn the warning off.

commit d34d403e360d9d5c15c607a307fb49d1c0992d14
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 9 11:50:50 2017 +0200

    file_handle_cache: Move RabbitMQ-specific functions to rabbit_fhc_helpers
    
    Those are the functions to clear the read buffer cache in various
    internal RabbitMQ processes. file_handle_cache still reads the
    `fhc_read_buffering` and `fhc_write_buffering` rabbit application
    variables, though.
    
    Thus, this change almost removes a dependency of file_handle_cache on
    the broker. Reading the configuration variable is acceptable for now so
    this will allow us to move file_handle_cache to rabbitmq-common.
    
    [#118490793]

commit 58d7abdd8b1634f6c839ac4cc3846f6e59a365f2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 9 11:32:20 2017 +0200

    Move rabbit_memory_monitor:memory_use/1 to vm_memory_monitor
    
    The function is renamed to get_memory_use/1 in the process, to match
    other functions in the vm_memory_monitor module.
    
    The file_handle_cache uses that function. By moving it to
    vm_memory_monitor, we remove a dependency of file_handle_cache on a
    rabbit_* module. This will allow us to move both file_handle_cache and
    vm_memory_monitor to rabbitmq-common and help remove a dependency in the
    Erlang client on the broker because the former calls
    file_handle_cache:obtain/0.
    
    To sum up the situation before this commit with a graph:
    
      amqp_network_connection --[depends on]--> file_handle_cache
                (amqp_client)                   (rabbit)
    
            file_handle_cache --[depends on]--> rabbit_memory_monitor
                     (rabbit)                   (rabbit)
    
    And the situation we want to reach after the move:
    
      amqp_network_connection --[depends on]--> file_handle_cache
                (amqp_client)                   (rabbit_common)
    
            file_handle_cache --[depends on]--> vm_memory_monitor
              (rabbit_common)                   (rabbit_common)
    
        rabbit_memory_monitor --[depends on]--> vm_memory_monitor
                     (rabbit)                   (rabbit_common)
    
    [#118490793]

commit 3c132447af478e6ff3fd6552383c2f3d9f13fd95
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu May 18 13:26:23 2017 +0200

    Add rabbit_tracer boot step for running Looking Glass
    
    It will run only if RABBITMQ_TRACER is defined. It contain a
    list of M:F (for example RABBITMQ_TRACER="abc:def,ghi:jkl")
    that are functions returning Looking Glass trace specifications.
    
    This commit comes with one such function, rabbit_tracer:connections.
    It will trace all existing and future connection processes across
    all rabbit and rabbit_common applications.
    
    More functions will need to be added to trace specific parts of
    RabbitMQ, or to trace plugins. For example there could be functions
    for tracing channels, or data collection for management. Trace
    specifications can be combined to get the target you need.

commit 915f1e944f5cca8f64893a0017e2606f157917c7
Merge: 5cff71319 ced829081
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 16 17:54:01 2017 +0200

    Merge branch 'stable'

commit ced8290812301cb2101b429d0cf1a6d7916daba2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 16 16:58:03 2017 +0200

    Makefile: Load the new `rabbitmq-early-test.mk` early-stage plugin
    
    See the corresponding commit in rabbitmq-common for an explanation.
    
    [#144697185]

commit 3b643e1ceedce8e61cfc0c065534dee9524671e7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 16 16:57:17 2017 +0200

    Update erlang.mk

commit 5cff7131902f6e6a857c0174a635f939a8860f6c
Merge: 2f4c27f19 6d5298700
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri May 12 17:52:57 2017 +0300

    Merge pull request #1220 from rabbitmq/rabbitmq-server-1216
    
    Revert "Use new supervisor2:prep_stop to stop rabbit dependencies on shutdown"

commit 6d52987004bec91d0203ca2f27b2c8d22134af17
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri May 12 10:05:10 2017 +0100

    Start/stop test node after VM stops because of rabbit app failures
    
    rabbitmq-server-1216
    [#145106709]

commit 2f4c27f193b6fc149c12087359994daa832e3fee
Author: Daniil Fedotov <fedotov.danil@gmail.com>
Date:   Thu May 11 16:01:56 2017 +0100

    Rebuilt the cuttlefish escript to support OTP-20.0 smp flags

commit 286e1d080bd265ecca0f256ac3fa4fcef5e61bc9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu May 11 18:03:46 2017 +0100

    Link Gatherer when rebuilding a message store index.
    
    If index rebuilding worker fails, the failure never reported
    to a starting message store process.
    This can cause a deadlock, when a message store process waits for gatherer,
    and gatherer waits for a worker, which is dead.

commit 53d71dfa948ce0db940c8a72e7d5e18c64b2a024
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu May 11 09:54:34 2017 +0100

    Revert "Use new supervisor2:prep_stop to stop rabbit dependencies on shutdown"
    
    This reverts commit dcf15e7d894e536cc09bc065310d97fcee6c7d12.
    Unnecessary when making rabbit application transient
    
    rabbitmq-server-1216
    [#145106709]

commit 886f1999b8da58859eb9d1242a5a2a518586358e
Merge: 6719f476a 139d515fd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 10 18:30:33 2017 +0300

    Merge branch 'stable'

commit 139d515fd44aa0bef036556ce267d7f399f8ae05
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 10 18:29:11 2017 +0300

    Naming
    
    per discussion with @gerhard.

commit 6719f476a76a49e9c25a2fcfc73528a6eecc9ef2
Merge: b25935c1a de2843dc2
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed May 10 15:29:25 2017 +0100

    Merge remote-tracking branch 'origin/stable'

commit de2843dc2aa0d6a047e5aa2ca2dd6b9bc3a01900
Merge: 9e1235c9e 61a1c883c
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed May 10 15:24:05 2017 +0100

    Merge pull request #1217 from rabbitmq/improve-wait-when-clustering-1214
    
    Check rabbit is running after the boot process finishes

commit 61a1c883cfecb0bcdde6fed529b88eb969b2f8ff
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Wed May 10 14:57:10 2017 +0100

    Replace await_startup with new implementation
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#145043957]

commit ddcdf46729a0b354159044b2fc0027e32796f33f
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Wed May 10 14:51:06 2017 +0100

    Add test for rabbitmqctl wait when node fails to cluster
    
    Lower mnesia_table_loading_retry_timeout so test suite will be faster.
    
    Add mnesia_table_loading_retry_limit so that we test retries.
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    re #1214
    
    [Finishes #145043957]

commit b25935c1ac0ccbc178e4df909c3945b040a8f7db
Merge: 77d8c6598 9e1235c9e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 10 02:34:41 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            docs/rabbitmq.config.example

commit 77d8c6598a2211803fe2c404ad742749439e8af6
Merge: d1eecf2f4 c0af14ba3
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 10 00:21:09 2017 +0300

    Merge pull request #1201 from rabbitmq/convert-manpages-to-mdoc
    
    docs: Convert manpages from DocBook to mdoc(7)

commit 20a576bcc4eb436fd4fa8041f452ee8bafe8ca3b
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Tue May 9 18:24:38 2017 +0100

    Ensure rabbit is running after the boot process finishes
    
    Boot process can exit if boot fails. It can result in
    rabbit:await_startup/0 returning ok & rabbitmqctl wait exiting with exit
    status 0.
    
    WIP, still need to add some tests.
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    re #1214
    
    [#145043957]

commit d1eecf2f4ba0f49899e44cb490e620df84990149
Merge: 2ee4ef2ea 4cdad4b2a
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 9 19:20:34 2017 +0300

    Merge pull request #1158 from rabbitmq/rabbitmq-server-1146-full
    
    Per-vhost supervisors.

commit 9e1235c9ed1855d705150c7b38c62242282b6127
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Tue May 9 16:48:42 2017 +0100

    Fix mnesia_table_loading_retry_timeout example config & add retry limit
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit 4cdad4b2a2a29355a1cb02d8798c9c6eaf4c0b67
Merge: d89a50a4e 2ee4ef2ea
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 9 12:46:49 2017 +0300

    Merge branch 'master' into rabbitmq-server-1146-full

commit 2ee4ef2eab559ea1341019e514e9db3eacc99ba0
Merge: 629f128d3 789f0ba93
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 9 12:44:04 2017 +0300

    Merge branch 'stable'

commit d89a50a4e395808ab8eb00005f731ae214ba31ff
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue May 9 10:27:00 2017 +0100

    Schema mapping for vhost_restart_strategy

commit 789f0ba932f0d3ff3f9b23354a8df5d5f033b0e2
Merge: d3542a400 407a349a2
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 9 12:20:49 2017 +0300

    Merge pull request #1215 from rabbitmq/rabbitmq-server-1213
    
    Test single slave restart after forget_cluster_nodes in offline mode

commit 407a349a2007812c76f8f7b588b4b42b1f1a8415
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 9 12:13:49 2017 +0300

    Minor naming improvement
    
    While "Removee" is clear and to the point, some may conclude
    that it is a typo (supposed to be "Remove").

commit 503cc9f7f19f05de77d412517aab61301eb93a4e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon May 8 23:43:07 2017 +0100

    Test single slave restart after forget_cluster_nodes in offline mode
    
    rabbitmq-server#1213
    [#145084865]

commit f8adbe976485f5fa7846a8fef711d95caad97f94
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 8 18:28:37 2017 +0300

    Rename rabbit.vhost_restart_strategy options

commit 629f128d30b8bde238c4b6ab5cacef8cb1e263e1
Merge: 0bd4b78b3 f35e23599
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 8 18:05:18 2017 +0300

    Merge pull request #1210 from binarin/more-defaulting-for-plugins-expand-dir-master
    
    Use plugins expand dir with default fallback value

commit d3542a400c7f50ad25179aee600b30a80ac2695d
Merge: 8cedd3f53 aee6e38f5
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 8 18:03:23 2017 +0300

    Merge pull request #1209 from binarin/more-defaulting-for-plugins-expand-dir-stable
    
    Use plugins expand dir with default fallback value

commit 7132664520b09cf6e15dc95e91ce73eedd4407e4
Merge: d6fa20933 0bd4b78b3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 8 18:01:10 2017 +0300

    Merge branch 'master' into rabbitmq-server-1146-full
    
    Conflicts:
            Makefile

commit d6fa2093375ac295b765261e34213de4a61960b9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon May 8 12:58:01 2017 +0100

    Add vhost_restart_strategy to default app config.

commit 69bb7b8c3a5f7a53d0d9c6a2a7eef71f5aaba9d4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon May 8 12:54:27 2017 +0100

    Allow 2 restarts per hour for vhost msg stores

commit f35e2359929a301618dfb85e173859c0d7b76955
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri May 5 16:58:46 2017 +0300

    Use plugins expand dir with default fallback value
    
    In addition to #1134

commit aee6e38f5a45b3d6eff07254080729965f6c9ff2
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri May 5 16:57:18 2017 +0300

    Use plugins expand dir with default fallback value
    
    In addition to #1134

commit 0bd4b78b3540c65648563714239d2a270c9816a4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu May 4 13:46:19 2017 +0100

    Reload apps on config update.
    
    Configuration update requires applications to be unloaded.
    Some of the rabbit dependencies are loaded on VM boot, so they
    should be unloaded before config update.
    Applications which are already running during config update cannot be
    unloaded (e.g. kernel) and warning should be reported that config
    cannot be applied to these applications

commit 02669ff2978349fbc4accb34e69d8c3fd689e94c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu May 4 10:48:23 2017 +0200

    Pick a random value over the range in ms
    
    Per suggestion from @binarin. This way the chance of two
    or more nodes ending up with the same delay value is lower
    than when a random value is picked from the range in seconds.
    
    Think 1 in 10 vs. 1 in 10000.

commit 6b13679b725ec12aee2569f07ac15618eb99a34b
Merge: f580a7652 8cedd3f53
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed May 3 12:29:52 2017 +0100

    Merge remote-tracking branch 'origin/stable'

commit f580a7652166a4836b0fbbe881c3f6e6a5b49f36
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 2 23:19:39 2017 +0200

    Log at info level by default
    
    The change in bda6b290c60910f9a1b6106aaedb80a372ca3208 wasn't intentional.

commit 02bb2e2fa93a8c272da76f5e18449aec8959f05b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 2 19:22:01 2017 +0200

    Compile

commit bda6b290c60910f9a1b6106aaedb80a372ca3208
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 2 19:19:47 2017 +0200

    A no-op implementation of post_registration/0 for core backends

commit 4ca58835cf227703a9fc8953d8d089571fbf6461
Merge: 311473f36 a2f09b861
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 2 13:27:32 2017 +0200

    Merge pull request #1205 from rabbitmq/rabbitmq-server-1202
    
    Inject a randomized startup delay

commit 8cedd3f53a14e45ccc68868bbc6401bb321ee50f
Author: Eris Belew <erisrenee+github@gmail.com>
Date:   Sun Apr 30 13:44:29 2017 -0700

    Ensure ERL_LIBS starts with a valid path

commit 311473f36e9a07909c52693b9c66d7f73bd3a1c6
Merge: 775a41579 36ecc87de
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 2 13:25:25 2017 +0200

    Merge pull request #1204 from ebelew/erl_libs_windows_fix
    
    Ensure ERL_LIBS starts with a valid path

commit a2f09b8611cdfc62f9c635fa758827061cd5f3c9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 1 21:22:02 2017 +0200

    Inject a randomized startup delay for peer discovery backends that support registration
    
    Fixes #1202.
    
    [#144517745]

commit 36ecc87deb53f46b329684e733936b345b822134
Author: Eris Belew <erisrenee+github@gmail.com>
Date:   Sun Apr 30 13:44:29 2017 -0700

    Ensure ERL_LIBS starts with a valid path

commit 4ee90ff1bba383ce74d068c2540820456714b15f
Author: Patrick Sodré <sodre@sodre.co>
Date:   Thu Apr 27 02:04:28 2017 +0000

    scripts/rabbitmq-server: Work around signal handling issue with Dash
    
    On Debian-like distributions, `/bin/sh` defaults to `/bin/dash` which
    has a bug with signal handlers.
    
    In the case of Dash, it looks like `set -e` (set at the beginning of
    this script) gets precedence over signal handling. Therefore, when
    `wait` is interrupted, its exit code is non-zero and because of `set
    -e`, the script terminates immediately without running the signal
    handler. To work around this issue, we use `|| true` to force that
    statement to succeed and the signal handler to properly execute.
    
    Replace the use of `-e` on the shebang line by a standalone `set -e`,
    like other scripts. This way, the script behavior remains the same if
    the script is started as an argument to a shell. For instance:
        bash ./rabbitmq-server
    
    Bump the copyright year to 2017.
    
    Signed-off-by: Patrick Sodré <sodre@sodre.co>
    
    Fixes #1192.

commit c0af14ba3b98d4e028274fa326144223cb508b5c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 25 10:50:00 2017 +0200

    docs: Convert manpages from DocBook to mdoc(7)
    
    Writing those manpages directly in the target markup language allows to
    use its full expressiveness, unlike the generated output from DocBook.
    
    To create their HTML versions, we use mandoc(1), plus a small awk script
    to adapt the generated HTML to our needs. I tried groff(1) and
    man2html(1) but the former transforms nearly everything to simple <p>
    and the later tries to reproduce the rendering of a manpage in a
    terminal.
    
    Manpages in section 1 are moved to section 8 because they are commands
    to manage a system service, not general purpose commands.
    
    This commits requires a change in the website to integrate the new
    generated HTML manpages.
    
    [#143563295]

commit 12d73ad7c11f3fdf6c3e28c3a35c0ba45429a2f1
Merge: e5ece8786 1b51bb0ad
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 25 20:36:30 2017 +0200

    Merge pull request #1196 from rabbitmq/rabbitmq-server-1194
    
    Support integers in memory relative free disk space limits

commit 1b51bb0ad8ed5e4add43dc59302bd676c2b11233
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 25 20:31:52 2017 +0200

    Update type spec

commit c080fdc9ff3e545ab75c02065bc7c5759ebad751
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 25 20:29:41 2017 +0200

    Revert "Minor doc improvement"
    
    This reverts commit d58b61335591d1dafc7e2adabf85f09fbce9168e.
    
    Actually, 1.0+ values should be fine since the value is relative to the
    total amount of available RAM.

commit d58b61335591d1dafc7e2adabf85f09fbce9168e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 25 19:52:16 2017 +0200

    Minor doc improvement

commit 775a41579c6ed5dd046aaed0eb5eacf8a48460f7
Merge: b03a14fc1 e5ece8786
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 25 18:00:28 2017 +0200

    Merge branch 'stable'

commit e5ece87867366158c38bb09baf1d35a43f110847
Merge: f3346e82c d393e390f
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Tue Apr 25 16:36:07 2017 +0100

    Merge pull request #1195 from rabbitmq/rabbitmq-server-1180
    
    Makefile: Fix malformed manpages with GNU sed

commit 43fe62ef15465ad01c73dd7f591c7659b5d2d307
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Apr 25 16:33:01 2017 +0100

    Support integers in memory relative free disk space limits
    
    rabbitmq-server#1194
    [#144271963]

commit d393e390ff48b98176fd8d9a20b4c0ccd49f0e13
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 20 15:11:16 2017 +0200

    Makefile: Fix malformed manpages
    
    The generated manpage contains malformed .HP directives:
        .HP \w'\fBstop\fR\ 'u \fBstop\fR [\fIpid_file\fR]
    
    The .HP directive takes one argument, the indentation. Thus, the first
    line (which is not indented) should be on the next line:
        .HP \w'\fBstop\fR\ 'u
        \fBstop\fR [\fIpid_file\fR]
    
    Manpages will be converted to mdoc(7) in master so we are sure of
    the formatting. The DocBook versions will be dropped. This will also
    simplify the build process.
    
    References #1180.
    [#143563295]

commit b03a14fc1649d2d79ec01c55d39884dce7c2d748
Merge: 261efd945 0bb59f8df
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 25 13:09:06 2017 +0200

    Merge pull request #1189 from rabbitmq/rabbitmq-server-1171
    
    Add IPv6 support for DNS discovery

commit 0bb59f8df0a5c8dffa2677db3fb46c719c85eb6a
Merge: a3e6909a8 261efd945
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Apr 25 13:00:22 2017 +0200

    Merge branch 'master' into rabbitmq-server-1171

commit 261efd9458afb7c1f2eb6c23405415afd4e73740
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Apr 25 00:39:28 2017 +0200

    Log all discovered peers, too

commit 6a239c4a9d9c9cd7b6a72237537276371ffd8e33
Merge: e07ca0eac f22376ee9
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Apr 24 21:26:40 2017 +0200

    Merge pull request #1175 from rabbitmq/rabbitmq-server-1143
    
    Register with peer discovery backend on start and stop

commit a3e6909a8d4c5c174366b632762c77802671fbc1
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Apr 24 17:47:55 2017 +0200

    Add unit test for AAAA record.

commit 61414f95d26a201c270d8c3dcde77c815ec86acd
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Apr 24 11:51:52 2017 +0200

    Change the IPv6 support

commit 585e43b628905c97a58d8d0d832e16328ae27db1
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Apr 24 10:35:37 2017 +0100

    Typo

commit 875c327c6b99cdc7d6811d0aa8b6ac0f944493b3
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Apr 21 18:09:04 2017 +0200

    Add support for IPv6

commit e07ca0eacc0f2db77685a48253b3457a22c0e269
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 21 17:04:48 2017 +0100

    Replace dicts with maps for queue mirroring logic.

commit dcf15e7d894e536cc09bc065310d97fcee6c7d12
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Apr 21 11:23:57 2017 +0100

    Use new supervisor2:prep_stop to stop rabbit dependencies on shutdown
    
    Only for when the top supervisor reaches its max restart intensity,
    as stopping applications from application:stop/1 will block

commit d8c66d10c495a9119a114f80a38b144a00f2b325
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Apr 19 14:10:44 2017 +0100

    Make rabbit_vhost_sup permanent so it can be restarted once without
    bringing down the whole supervision tree and rabbit app

commit 9bb3636e654e693a24183ab6eaeb0698c1b62a13
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Apr 19 14:03:24 2017 +0100

    Ignore exceptions on the msg store while terminating a client on
    queue shutdown.
    
    When the msg store has crashed and the supervisor is trying to stop
    all its sibilings, the variable queue termination might crash as the store
    is not available. This would prevent the supervisor to restart the vhost,
    as it stops at the second crash.

commit b5a07fa724a9d31ebd8d42891518addcf1dd09d6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 21 10:11:17 2017 +0100

    Replace dicts with maps for queue index segments

commit ae6e4227f48339fd10f44252532e3de774871d0d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 19 15:36:43 2017 +0100

    Replace dicts with maps in message store GC

commit 0ee51b1bbb44800edd7b3c2e0b7204fab54f96b4
Merge: 79fa87f76 f3346e82c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 19 12:36:50 2017 +0200

    Merge branch 'stable'

commit f3346e82c401e31ab3ff72fa82d1a7c2b7095b03
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 19 11:59:27 2017 +0200

    Update erlang.mk

commit 79fa87f762c299ec5f023012501843a2821cfb49
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 18 10:28:53 2017 +0100

    Shutdown cannot fail

commit e0336d9abb93c22361c40f5452c908d5da1c5c5a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 13 16:25:47 2017 +0100

    Replace update_with with find and put
    
    update_with is not defined in OTP-18.3

commit bedbb035ebfae084f5efca97e072e2ae013d13ac
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 12 14:10:11 2017 +0100

    Remove debug logs

commit f22376ee9da053f1a739103a7a5392781ba6e312
Merge: 8ce0f0826 c4519ddf4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Apr 12 14:30:07 2017 +0300

    Merge branch 'master' into rabbitmq-server-1143

commit c4519ddf4baf8af772b8b1a79945eef02cda17f4
Merge: 536674232 bafb80126
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 12 14:29:25 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            Makefile

commit 68a40af5e3f0182986f646d44e6246c4b181b555
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 23 11:50:07 2017 +0000

    Ignore pid from supervisor:start_child

commit baef781654b93034ed48062a342abd4783d1f9c8
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 23 10:41:58 2017 +0000

    Configurable vhost restart strategy

commit 5c0cf89749571b36754a39b5bc9fea94c5463f37
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 22 18:30:08 2017 +0000

    Move test fixes from unit_inbroker to backing_queue

commit 3716131a9285b1a6ee07017d9028203d84a6c5b6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 21 17:26:53 2017 +0000

    Use wrapper supervisor one level above vhost supervisors
    
    Wrapper supervisor makes it possible to make vhosts restartable
    exactly N times without interfering with each other.
    Because vhost should call recovery every time it's restarted,
    and recovery includes dynamically adding message stores,
    it's impossible to restart it using one_for_all.
    So vhost supervisor will just fail if it's child fails
    and vhost supervisor wrapper will restart it with recovery.

commit dd2a79da74e7fa1d02b4e277ec119a69dbb5c3b7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 21 17:25:56 2017 +0000

    Create default vhost after rabbit recovery, so vhosts supervisor will be started

commit 256caaeb3e69294c5ff1c2a3d29cb3957d021f87
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Mar 20 09:50:55 2017 +0000

    Migrating to per-vhost supervisor message store.
    
    Support reading/saving recovery terms from global storage to per-vhost storages.

commit 6a95535314def537e564a34c15733c1a20eff20d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Mar 20 09:50:42 2017 +0000

    Queue and msg store supervisor locations

commit c464fdefa9c451d25c42573190f72f24a227ed4a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 17 13:03:03 2017 +0000

    Per-vhost supervision trees for queues and message stores.
    
    Per-vhost message stores can be restarted, but queues contain
    references for old message stores in message store client data,
    also queues rely on message store process to report confirms for
    messages on disk.
    Because after message store restart queues will not get any confirms and
    will fail with badarg error trying to access message store with an old client,
    queue processes should be restarted together with message stores.
    Queue process cannot monitor message store because of backing_queue mechanism,
    so they should be controlled by a supervision tree. One tree will contain
    queues supervisor and message store proecesses.
    Per-vhost supervisor will restart if any of it's children dies.
    Per-vhost supervisor restart process will do queue and message store data recovery
    the same way as pre-3.7 global message store did, just with VHost as an argument and
    in a vhost data directory.

commit bafb80126c539e8d3c745622fbc5bebe8197439c
Merge: f0da42683 c340c0d92
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 12 14:13:25 2017 +0300

    Merge pull request #1179 from rabbitmq/rabbitmq-server-1178
    
    Re-enable disk_monitor in case of parser failures

commit c340c0d92aeba9f4b89f0e0e81e774393d3677c0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Apr 12 13:28:25 2017 +0300

    Naming

commit 730fb6d6a5f853f01f56c7636a682e862d54dbff
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Apr 12 13:22:45 2017 +0300

    Wording

commit c256d4ebdc1f0edbb17bc24e8bd45825d32867be
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Apr 12 12:10:56 2017 +0300

    Log message wording

commit 186c32700b52de68cb3ba71e445844d236519603
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Apr 12 08:27:29 2017 +0100

    Re-enable disk_monitor in case of parser failures
    
    Parser failures could be transient on start-up, so retry a few times
    before giving up.
    
    rabbitmq-server#1178
    [#143558437]

commit 536674232015587befed5be325bc89aeca3c17ff
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 11 18:23:11 2017 +0100

    Make file_handle_cache a map instead of dict in message store internal structures.
    
    Maps have better performance and readability in dumps.

commit 0b70736943cc34c842f3fe13be96127e8251ad3f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 11 17:24:05 2017 +0100

    Move clients and cref_to_msg_ids from dicts to maps
    
    Maps have better performance and readability then dicts.

commit 8dc4a182ee7cfbb2e560cbc3d93653fbdf240449
Merge: 4b69f48b7 f0da42683
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 10 17:20:20 2017 +0100

    Merge branch 'stable'

commit f0da42683f491b527cd3358c91c9370d8be3d5fd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 10 17:09:25 2017 +0100

    Call init:stop() during rabbitmqctl stop even if logging fails.
    
    This makes sure that we try to stop an erlang app even if an exception
    is thrown during logging in the "after" block.
    Otherwise there is an inconsistency between "failed and the erlang node will stop"
    and "failed, but the erlang node will not stop"

commit 8ce0f08268df289ce9bf8d7d4096d3db4816fcf0
Merge: 03f4894af 4b69f48b7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Apr 6 07:47:56 2017 +0300

    Merge branch 'master' into rabbitmq-server-1143

commit 4b69f48b772590af7b75699c60f7bef4fbeac4c8
Merge: beac74171 0b0308829
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Apr 6 07:12:16 2017 +0300

    Merge branch 'stable'

commit 0b0308829c716d3226c4d71efefe4d0b5f57473c
Merge: fe56987d5 432f46df0
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Apr 6 06:54:13 2017 +0300

    Merge pull request #1176 from rabbitmq/rabbitmq-server-1172
    
    Make queue master locator treat queue args as AMQP table.

commit 432f46df0f19322318b686446181f3d44d3998d6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 5 17:23:43 2017 +0100

    Make queue master locator treat queue args as AMQP table.
    
    Fixes #1172
    Tests were using incorrect format for queue args as well as the code.

commit 03f4894afde146f933f70acce58bac23367bba6b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 16:08:47 2017 +0300

    Avoid duplicate unregistration

commit 522a83caaba58d2094c421d5c00b0fc2bb09ce8b
Merge: 0b73c1d3a beac74171
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:54:34 2017 +0300

    Merge branch 'master' into rabbitmq-server-1143

commit beac7417153408cbbfa957d6b1ad0ca85dd948a7
Merge: e61b424a0 fe56987d5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:53:07 2017 +0300

    Merge branch 'stable'

commit fe56987d5b8ccf6b8ad073f240c9bf8a330e532d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:52:33 2017 +0300

    (c) year

commit 0b73c1d3a548b48e62208fcafed8a1cc7240cca5
Merge: 32e4955c5 e61b424a0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:45:19 2017 +0300

    Merge branch 'master' into rabbitmq-server-1143

commit e61b424a0345eb4c9cd0bc815193f7f93528814d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:45:03 2017 +0300

    (c) year

commit 32e4955c5a6cdd829795c69e1fbfff9901eeb01e
Merge: 14e2906bf a706a2ba0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 5 15:17:48 2017 +0300

    Merge branch 'master' into rabbitmq-server-1143

commit 10983341be45cbf9ccee3bf61ca882d63a668bb4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 5 13:02:16 2017 +0100

    Change rabbitmqctl integration tests for shutdown command to support the new CLI

commit 81ab2e77250073688175b6d058f15da02be4806a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 5 13:01:40 2017 +0100

    Unused obsolete functions

commit c8efc41ae880a1429daf0e4b1c36520ba383c1f4
Merge: 0e3e451ac 4041dd828
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 4 09:43:07 2017 +0200

    Merge branch 'stable'

commit 4041dd828eea10ed69ff76260dc41ebf42ddd7c3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Apr 3 12:16:27 2017 +0200

    rabbit_control_main: Indicate node name in the "successfully shut down" line
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#142699191]

commit 0e3e451ac73b35ed405bdfa276bddeccea5b229b
Merge: a706a2ba0 de7ef8611
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Apr 3 13:08:56 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_control_main.erl

commit de7ef86119761bd151e02f13ca0ec37310c67073
Merge: 7741b37b1 48182dee4
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Apr 3 13:08:19 2017 +0300

    Merge pull request #1169 from rabbitmq/more-info-during-shutdown
    
    Add more info during rabbitmqctl shutdown

commit 48182dee4dfb4feead04a60dd90e99202a4eca0b
Merge: 78617ab28 7741b37b1
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Apr 3 13:02:30 2017 +0300

    Merge branch 'stable' into more-info-during-shutdown

commit a706a2ba08c16ba518a49844114e15bb41119846
Merge: d969c12b0 7741b37b1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 2 21:52:52 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_control_main.erl
            src/rabbit_error_logger_file_h.erl
            src/rabbit_registry.erl
            src/rabbit_sasl_report_file_h.erl

commit 7741b37b1efa97ac9b17685cc626bd35ee52ca16
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 2 21:46:42 2017 +0300

    (c) year

commit e1f8ae2f2448406d1c3159f9d7af4067758551a6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 2 21:35:43 2017 +0300

    (c) year

commit 53c050a8d9e7472d6be74f158abc79b866c52229
Author: Stephan Renatus <srenatus@chef.io>
Date:   Fri Mar 31 14:10:18 2017 +0200

    rabbit_epmd_monitor: call register_node on Mod, not its default
    
    trivial change

commit d969c12b09770fb1f473b40af7c07258aa188588
Merge: 5cf4889af d098ec771
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 31 16:44:57 2017 +0300

    Merge pull request #1170 from srenatus/sr/better-call-Mod
    
    rabbit_epmd_monitor: call register_node on Mod, not its default

commit d098ec7715e4f7add9977c239cd99e5adb07784d
Author: Stephan Renatus <srenatus@chef.io>
Date:   Fri Mar 31 14:10:18 2017 +0200

    rabbit_epmd_monitor: call register_node on Mod, not its default
    
    trivial change

commit 78617ab28b0f53b7912245614650fe9fa1e32d1c
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Mar 31 12:21:11 2017 +0100

    Keep all shutdown print statements together

commit b529c77862bd2ddcd8c29a2540819f935f3ea65d
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Fri Mar 31 12:05:49 2017 +0100

    Add more info during rabbitmqctl shutdown
    
    We want to know at which shutdown stage the command is at, and get
    confirmation of successful shutdown.
    
    Inform is used all over the place, is it OK to remove " ..." from all
    rabbitmqctl commands that use it?
    
    [#142699191]

commit d2eb76a52c913b6f181f24ba13b7c315e4e0af83
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 17:51:24 2017 +0100

    Remove remote node shutdown behaviour from rabbitmqctl man
    
    It's not accurate, we didn't play the story
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#142699191]

commit f9f5b6a7a04bfe9dedaebdcfd2acf474055d641d
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 14:40:13 2017 +0100

    Add shutdown test for non-running node
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [finishes #142699247]

commit 8b916e764013295370a4509fc84cb4c5b12dea1d
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 12:03:18 2017 +0100

    Add tests to check for errors during node shutdown
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [finishes #142701219]

commit bf9cb65478d7601e4990f70e76d7963e948b2c7e
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 11:34:46 2017 +0100

    Re-throw exception when stopping RabbitMQ
    
    This is a potential regression in 3.6.7 - 3.6.9 when running
    rabbitmqctl stop
    
    [#142701219]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit df45db77ee90c136bf95714acbb852ceb0a65d6f
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 11:32:40 2017 +0100

    Ignore tmp generated docs
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit 0f47ca0424e0b80f7c33b6a92c5fd6c7ccff9c45
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Thu Mar 30 11:31:22 2017 +0100

    Add shutdown command to rabbitmqctl documentation
    
    [#142699191]
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>

commit e607e57f6675298486c10c621fc88661146fbf79
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 29 18:08:05 2017 +0100

    Add shutdown to a list of rabbitmqctl commands [#142699191]

commit d2b155e0d3f8313905797a4e56a576e79d30c2fc
Merge: 3c19685dc 6c00bf574
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Wed Mar 29 17:58:26 2017 +0100

    Merge pull request #1166 from rabbitmq/rabbitmq-server-1162
    
    Introduce rabbitmqctl shutdown command.

commit 6c00bf57485c42ec641f83d095d3daacc605b585
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 29 17:44:45 2017 +0100

    Introduce rabbitmqctl shutdown command.
    
    rabbitmqctl shutdown command will wait for erlang vm to terminate,
    the same way as rabbitmqctl stop PIDFILE, but without a pidfile.
    
    [finishes #142699191]

commit 5cf4889af65471ff7e4910d3730d469da108458d
Merge: 6fa3ee4cc 4c553f713
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 24 17:21:50 2017 +0300

    Merge branch 'binarin-embed-friendly-lager-init'

commit 4c553f713194caed7843f5161c3650c10e4245c5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 24 14:42:42 2017 +0300

    Naming

commit 727d2278c9dc6243ed8b857ebaf675abb3fac746
Merge: 6fa3ee4cc 8c2baca1e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 24 02:12:28 2017 +0300

    Merge branch 'embed-friendly-lager-init' of https://github.com/binarin/rabbitmq-server into binarin-embed-friendly-lager-init

commit 8c2baca1eaa71053bf3da759ec3e91f8f6d52924
Author: Alexey Lebedeff <binarin@gmail.com>
Date:   Thu Mar 23 19:39:17 2017 +0300

    Use proper version of get_env during init

commit 6fa3ee4ccc71ae117492968fb89e217666deea37
Merge: 49eba46c9 3c19685dc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 23 01:44:31 2017 +0300

    Merge branch 'stable'

commit 3c19685dcdeecbf64a67612627ac2208afaa3d38
Merge: 0220389f0 28fac0f98
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 23 00:52:38 2017 +0300

    Merge branch 'binarin-embed-friendly' into stable

commit 0220389f09fd15194cc93726cdbff64b46c43293
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Mar 16 18:13:20 2017 +0300

    Add back mnesia dir reset/restore
    
    Use a more descriptive variable name, which explains why this can't be
    actually squashed into a single call to rabbit_mnesia:dir/0.

commit 7fc24e63ccba2348d15b129223b63a17bf1f034f
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Mar 3 13:54:17 2017 +0300

    Provide some defaults for embedding
    
    This commit provides defaults for some paths (similar to the thing the
    mnesia does with its `dir` parameter) that will allow us to start
    broker in embedded mode without any additional configuration. The
    minimal test-case is to issue the following commands from
    `rabbitmq-server` checkout:
    
        make shell "SHELL_OPTS=-sname embed-friendly@localhost"
        > rabbit:start().

commit 28fac0f984a75e435e6c0ca2ae19de4f0734010a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 23 00:30:52 2017 +0300

    Naming

commit a4820b286a7d81ca06d6de738046021368a57b79
Merge: 89b049eb9 87ba6316f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 23 00:12:49 2017 +0300

    Merge branch 'stable' into binarin-embed-friendly
    
    Conflicts:
            test/unit_inbroker_SUITE.erl

commit 89b049eb9e41c605e6d33fcc1f818c3c0a0d049d
Merge: cb5659c23 f6da25c25
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 22 23:38:25 2017 +0300

    Merge branch 'embed-friendly' of https://github.com/binarin/rabbitmq-server into binarin-embed-friendly

commit 87ba6316f585885a9c2ebcfa93867069026d6709
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Mar 11 11:24:24 2017 +0300

    Mention make tests

commit b3340215f7a0ca1ca6d4207a10a18bf28bf2c469
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Mar 11 11:22:55 2017 +0300

    Document new make targets that run tests

commit 98a118e54f1c02512e99e06716a97af5fcef4e78
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 9 09:55:15 2017 +0100

    test: A few minor style fixes
    
    References #1136
    [#136613953]

commit 29178a63e027723ac2f11cfafac188ba52e19c4f
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 8 14:46:25 2017 +0000

    Rename suites and run testscases in parallel
    
    References #1136
    [#136613953]

commit 81bbc9f76fe0e13f6933f599cb837440042b3b0f
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 12:06:59 2017 +0000

    Update copyright and compiler warnings
    
    References #1136
    [#136613953]

commit 5a0e23241157be8160c7432a7906db8b57e9aecd
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 11:41:32 2017 +0000

    Use fast and slow targets from new Makefile plugin
    
    References #1136
    [#136613953]

commit cbe29c0757e31e106b4b324c40858a77dbab1eba
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Mar 6 16:13:57 2017 +0000

    Split test suites into fast and slow Makefile targets
    
    References #1136
    [#136613953]

commit 24c6d07f15cedea16f190b11363a5a9ae9a934f6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 21:19:11 2017 +0300

    Wording

commit 57d21888e7a2cd514c86b343b1e5e8e519f7d5fb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 21:11:01 2017 +0300

    Wording

commit 8a2d857bb5beb93c86a8ee7bba7617cd752efff6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 20:50:35 2017 +0300

    Wording

commit c2aebfadc0c0497e2302dd90c49e1929043e712a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 8 13:25:51 2017 +0000

    Log message store stopping

commit 20f6adc7b19e223f46a9607baece304806600d54
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:44:23 2017 +0100

    partitions_SUITE: Replace tabs with spaces
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit 1d4d9fe68a1d5dd9e2fb53b77271d1ed36def07b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:43:42 2017 +0100

    partitions_SUITE: Do not import rabbit_ct_broker_helpers
    
    They are not used anywhere. This fixes a warning.
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit b006d702943239e5c36e5d57070f28d0c30c97ea
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:42:19 2017 +0100

    partitions_SUITE: Decrease timetrap to 5 minutes
    
    ... instead of the default of 30 minutes.
    
    While here, update the copyright year to 2017.
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit 26c52a197e07425280db06a6e7b3f92b98874a69
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 10:06:26 2017 +0000

    Test and clean up metrics dependent on both process and entity
    
    It leaked consumer_created when the queue still existed, now both
    entity and process must exists to keep the metrics.

commit 407472039f08f8e5ffe8316cead1ae13b6e6a805
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Mar 6 22:54:36 2017 +0300

    Switch to rabbit_misc:is_process_alive/1

commit 22a636849f541a7080a779bedaf8551f95d87b2d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 6 17:26:40 2017 +0100

    unit_inbroker_SUITE: Adapt channel_statistics testcase after gc improvements

commit 9848921cf6d82fb6bb0e5aa3c3dae48d8d0f8107
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Mar 6 15:57:19 2017 +0000

    Check process aliveness on remote nodes

commit 4bd85f52a5c585b4827fff62409288480ec99d51
Author: kjnilsson <knilsson@pivotal.io>
Date:   Mon Mar 6 11:30:48 2017 +0000

    Attempt to make metrics_SUITE more rubust

commit 287ae307092fc7608c70ca1889a653e280c76f90
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 23 14:30:28 2017 +0000

    Log stopping applications

commit 76f966843ae422f9eb84611496a1060361a3ae14
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 22 18:44:09 2017 +0300

    Fix lager initialization code
    
    Setting env var to 'undefined' is different from not setting it at
    all, and lager is sensitive to this distinction in its 'log_root'
    parameter. There will be a crash when rabbit is started without the
    help of startup scripts (i.e. from `make shell` or in the embedded
    mode).

commit 14e2906bf37a3b87ab54021a5e40cbee796994b2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 22 13:49:30 2017 +0300

    Filter current node from the list of peers we're logging
    
    References #1143, #486.

commit c0ad88e6c2ad34a216733eb9f766911ff9669f80
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 22 02:42:46 2017 +0300

    Register with peer discovery backend on start if the backend supports it
    
    This introduces a new function to the peer discovery interface.
    The idea is to let backends indicate if they support registration.
    The goal is not to avoid calling the function, since Erlang
    behaviours require all functions to be implemented anyway.
    What we are trying to avoid with this is extra log entries
    that say "[un]registering with ..." as they can be confusing
    e.g. in single node installations.
    
    References #1143.

commit 5565bb9320656533ad1fea78a8c6d2ff57b4a3e1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Mar 20 16:54:52 2017 +0300

    Unregister from peer discovery backend on shutdown
    
    References #1143.

commit 49eba46c923b472391c5528e3531c375af3fcfc2
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 17 10:55:12 2017 +0000

    Split config snippets test
    
    Move plugin-specific snippets to plugins.
    Part of [#141481501]

commit f6da25c25524a5d36cb278d0a98dc2fa456cd6ac
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Mar 16 18:13:20 2017 +0300

    Add back mnesia dir reset/restore
    
    Use a more descriptive variable name, which explains why this can't be
    actually squashed into a single call to rabbit_mnesia:dir/0.

commit a47be165587bc180398a6670d2cc72fdaaf92233
Merge: 0488e1df0 2f909df3d
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Mar 14 17:13:22 2017 +0000

    Merge pull request #1144 from rabbitmq/rabbitmq-cli-178
    
    rabbit_hipe:compile_to_directory/1 should coerce argument to list

commit 0488e1df09ca3f90d52aca69a983c34a9843fc0c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 14 14:36:13 2017 +0100

    scripts/rabbitmq*: Use `exec` to call escript(1)
    
    This avoids the spawn of a new shell.

commit 6d2a1104fcb3672de651efe228226c37e1cfe743
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 14 14:31:14 2017 +0100

    scripts/rabbitmq*:  Use escript(1) from `${ERL_DIR}`
    
    This fixes the standalone package by using the embedded escript(1).
    Before this change, the wrappers relied on escript(1) available in the
    $PATH.
    
    [#141679931]

commit 2f909df3dc3750f8cb6b1a9854c2ccd6ff6c661a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 14 00:11:46 2017 +0300

    rabbit_hipe: handle eperm errors better

commit c87f3acd4fd23e1204e30ad021c65aa8655e3dd3
Merge: 5efbb8907 78545e1e4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Mar 13 21:13:52 2017 +0300

    Merge branch 'master' into rabbitmq-cli-178

commit 78545e1e4683add09c7e0c88d026c24eee5783e4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Mar 13 20:52:24 2017 +0300

    rabbit_mnesia: rename a couple of functions
    
    to be more to the point and not too attached to the
    classic config-driven "automatic clustering" feature.

commit c49d63ce36df698128df2679c6a4acf754f5a061
Merge: 0e2f2ad5b f3798d4b8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Mar 11 11:24:45 2017 +0300

    Merge branch 'stable'

commit f3798d4b86a5b7edd6d9c30e20b169d666c7e511
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Mar 11 11:24:24 2017 +0300

    Mention make tests

commit 7bc567749d3c5230c219451e7675c63ae8862612
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Mar 11 11:22:55 2017 +0300

    Document new make targets that run tests

commit 5efbb8907d8681422a66239cb4a5d14e1585a9a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 10 20:57:18 2017 +0300

    rabbit_hipe:compile_to_directory/1 should coerce argument to list
    
    Elixir callers such as rabbitmq-cli may use a binary.
    
    References rabbitmq/rabbitmq-cli#178.

commit 0e2f2ad5b4411ecbd7ae838feeb42965fd4ca04e
Merge: 4527efd8f aa28020bb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 9 16:05:37 2017 +0100

    Merge branch 'stable'

commit aa28020bbc658a90d8abd5d7ef1906d9db9ea1da
Merge: b40bf8c99 0ded88c3d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 9 14:45:13 2017 +0100

    Merge branch 'rabbitmq-server-1136' into stable

commit 0ded88c3d1116928487fb47c4551e91ebcc86d07
Merge: ab29c4816 b40bf8c99
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 9 14:59:52 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1136

commit ab29c481675be09cd0ac83b515dba91d29b5a757
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 9 09:55:15 2017 +0100

    test: A few minor style fixes
    
    References #1136
    [#136613953]

commit 8aaf538e92384b1ab7ca10944a3b834968edc6fc
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 8 14:46:25 2017 +0000

    Rename suites and run testscases in parallel
    
    References #1136
    [#136613953]

commit b053cc8fc8768b3c6c9d1770c6480e1e9a1c54b5
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 12:06:59 2017 +0000

    Update copyright and compiler warnings
    
    References #1136
    [#136613953]

commit c4a404d00ca7dfb496c3fd72ec329491df14218d
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 11:41:32 2017 +0000

    Use fast and slow targets from new Makefile plugin
    
    References #1136
    [#136613953]

commit 89aaeec86a89f36509fd9030c0c6f1dc81495a0e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Mar 6 16:13:57 2017 +0000

    Split test suites into fast and slow Makefile targets
    
    References #1136
    [#136613953]

commit 4527efd8f6ad129b7010c4122a211811d97794aa
Merge: fcf04fbdf b40bf8c99
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 9 10:11:19 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_msg_store.erl
            test/partitions_SUITE.erl

commit b40bf8c99dbd1352e0bc04d5cff79ab81d77e786
Merge: b1ce3f16a 29a47cb37
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Mar 9 09:22:01 2017 +0300

    Merge pull request #1141 from rabbitmq/rabbitmq-server-1122
    
    More logs when stopping RabbitMQ

commit 29a47cb376da60d6caa84dda40261d849322b2c3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 21:19:11 2017 +0300

    Wording

commit a7cbd390ee6cd331aa4a66ce8134157683932b78
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 21:11:01 2017 +0300

    Wording

commit 1f6d6d4fcc2107a69bb5fd91601f9168adc97d54
Merge: bf74a923c b1ce3f16a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 20:50:40 2017 +0300

    Merge branch 'stable' into rabbitmq-server-1122

commit bf74a923c59a6ec6bc8f17be803f3281a3047ce0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 20:50:35 2017 +0300

    Wording

commit 6330cb3b01f54faa2937cb8e1c712f3d8f235323
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 8 13:25:51 2017 +0000

    Log message store stopping

commit b1ce3f16a605ad9f06fe98c5e7ff49ba23f4b1f4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:44:23 2017 +0100

    partitions_SUITE: Replace tabs with spaces
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit 42d7e5e523ded154218a1d42d4a47236acd02c1e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:43:42 2017 +0100

    partitions_SUITE: Do not import rabbit_ct_broker_helpers
    
    They are not used anywhere. This fixes a warning.
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit dff1c93e3e45fef6c74cbeaf597bf7e981fb53f8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 8 12:42:19 2017 +0100

    partitions_SUITE: Decrease timetrap to 5 minutes
    
    ... instead of the default of 30 minutes.
    
    While here, update the copyright year to 2017.
    
    Signed-off: Gerhard Lazy <gerhard@rabbitmq.com>

commit fcf04fbdf6d3f943254a1431f0d1e4c2d1745e17
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 10:06:26 2017 +0000

    Test and clean up metrics dependent on both process and entity
    
    It leaked consumer_created when the queue still existed, now both
    entity and process must exists to keep the metrics.

commit cb5659c237b01783d24f689d8636795af325cb53
Merge: 72e025cae ce4987032
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 8 01:46:43 2017 +0300

    Merge branch 'embed-friendly' of https://github.com/binarin/rabbitmq-server into binarin-embed-friendly

commit 1a7a5571ff369831b7af5ce2c24a4cf3d4e58fe1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 7 15:47:26 2017 +0000

    Call msg_store_index operations via helper functions.
    
    This makes reasoning about message store index concurrency and
    usage easier. One can see which operations on index are called from
    which actor in the message store.

commit 72e025caeb2e08164fdd18072bf7519689484fa1
Merge: 480720796 183d0e5c5
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Mar 7 15:43:19 2017 +0300

    Merge pull request #1139 from rabbitmq/rabbitmq-management-agent-32
    
    Test and clean up metrics dependent on both process and entity

commit 183d0e5c5b605af86e8abcf9675c452b97f0f78f
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Mar 7 10:06:26 2017 +0000

    Test and clean up metrics dependent on both process and entity
    
    It leaked consumer_created when the queue still existed, now both
    entity and process must exists to keep the metrics.

commit f94b9ed329b87f3def32948e763a398e48865401
Merge: 609080c65 480720796
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 7 00:04:29 2017 +0300

    Merge branch 'stable'

commit 48072079619e1e2a27c74735db68c7066975e9c3
Merge: bd4619cdd 9a2a05c0e
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Mar 6 23:45:46 2017 +0300

    Merge pull request #1135 from rabbitmq/rabbitmq-server-1125
    
    Check process aliveness on remote nodes

commit 9a2a05c0e91907a56f20fb1f3c8535717852be4a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Mar 6 22:54:36 2017 +0300

    Switch to rabbit_misc:is_process_alive/1

commit 609080c659b38a4336fff8c2331282fb72f89931
Merge: 9ae10c32a bd4619cdd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 6 17:28:00 2017 +0100

    Merge branch 'stable'

commit bd4619cdd73691f7f990649996199def6880a1b7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 6 17:26:40 2017 +0100

    unit_inbroker_SUITE: Adapt channel_statistics testcase after gc improvements

commit 1835d7227ca0f10957c518645889102c8ea393ef
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Mar 6 15:57:19 2017 +0000

    Check process aliveness on remote nodes

commit cc6c3038131d6f5c0912d6270de59c0b5b309c5d
Author: kjnilsson <knilsson@pivotal.io>
Date:   Mon Mar 6 11:30:48 2017 +0000

    Attempt to make metrics_SUITE more rubust

commit 9ae10c32aa6f1732969649dc23333e0e28ea62fe
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Mar 6 12:36:13 2017 +0300

    Correct supported versions we report
    
    Previous revision produced 4 digit version numbers
    which we don't normally use.

commit 94658b1d42f5ea5a02b20f223e344156ffb356f8
Merge: 8d48dc496 89bbe009c
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 3 23:37:42 2017 +0300

    Merge pull request #1132 from rabbitmq/rabbitmq-server-1131
    
    Better message for plugin version requirement

commit 89bbe009cbbbd4dcacfc9bbdeca9c352d828a000
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 3 23:21:15 2017 +0300

    Wording

commit 07d3878f702b676f9e4c4744ce5444dd12290ec4
Merge: bcc24749a 8d48dc496
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 3 23:15:05 2017 +0300

    Merge branch 'master' into rabbitmq-server-1131

commit ce498703295d584f27ff683bbc2ab953aa44279a
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Mar 3 13:54:17 2017 +0300

    Provide some defaults for embedding
    
    This commit provides defaults for some paths (similar to the thing the
    mnesia does with its `dir` parameter) that will allow us to start
    broker in embedded mode without any additional configuration. The
    minimal test-case is to issue the following commands from
    `rabbitmq-server` checkout:
    
        make shell "SHELL_OPTS=-sname embed-friendly@localhost"
        > rabbit:start().

commit 8d48dc496316121d808c87e06c8b117b140fb605
Merge: 7c9d6dc49 697113dec
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 3 15:00:46 2017 +0300

    Merge branch 'stable'

commit 697113decf7c174561e87eee99ce4649ad8701a7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 3 14:03:15 2017 +0300

    Doco

commit 421de6432546bfe1c3db50f8fe9bc3529913caa9
Author: kjnilsson <knilsson@pivotal.io>
Date:   Fri Mar 3 11:08:48 2017 +0000

    Fix metrics test suite
    
    Because changes have been made to how core metrics are cleaned
    up we needed to insert force metrics collections into the tests.

commit 7c9d6dc49bb3777b9ae341cbbaf89678b3eb9bfd
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 1 12:07:26 2017 +0000

    Update metrics gc to support gc marker

commit aa67e54d6b644444c921a547b1e93d0e86dbcce0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 1 22:56:13 2017 +0300

    Revert "Update metrics gc to support gc marker"
    
    This reverts commit bde71d2c49632d25a235edb86aa56efaf760fb97.
    
    This was not meant to be merged directly into master. Other
    repositories need a manual merge.

commit 30d738accc42bc411ce4597e397e07ad761bf1ee
Merge: 393626cc3 bde71d2c4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 1 22:46:14 2017 +0300

    Merge branch 'stable'

commit bde71d2c49632d25a235edb86aa56efaf760fb97
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 1 12:07:26 2017 +0000

    Update metrics gc to support gc marker

commit 393626cc39edb6797776212dc1b64262aebacf65
Merge: e746abffc d62f57878
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 1 22:27:02 2017 +0300

    Merge pull request #1130 from rabbitmq/rabbitmq-management-353
    
    Update metrics gc to support gc marker

commit bcc24749ac0091877ab80de1ce9bc335e7469c52
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 1 18:46:01 2017 +0000

    Better message for plugin version requirement

commit e746abffca500d4ed5dc06e5cfb00a8a11a012a1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 1 18:37:36 2017 +0000

    Add missing acting user for internal function

commit c40f527f4a73e17e2cb2563515845737dbca21b5
Merge: e88fac2ae 831300674
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 1 19:31:26 2017 +0300

    Merge branch 'stable'

commit 831300674837068af16f4e28e93108256b8fbe53
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 1 19:30:38 2017 +0300

    Doco

commit d62f57878d397fc0cbcb9de758c661b524f810dc
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Mar 1 12:07:26 2017 +0000

    Update metrics gc to support gc marker

commit e88fac2aebcb9f3eb55f5b23439d4dd69c09c7a4
Merge: 7f68dffa4 ec2042877
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 28 13:10:23 2017 +0300

    Merge pull request #1128 from rabbitmq/rabbitmq-server-1124
    
    Exclude apps that are not RabbitMQ plugins from the list of plugins

commit 7f68dffa40f24493fe20802b2f9bc56e1c9bae1a
Merge: 9b2d2af67 682a13633
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 27 18:38:29 2017 +0100

    Merge branch 'stable'

commit ec2042877b50a88a87505b8eff486b8c23802412
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Feb 27 16:24:21 2017 +0000

    Rename function

commit 74eace424e303ad452cda41a703d2f62426348f6
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Feb 24 10:58:09 2017 +0000

    Exclude apps that are not RabbitMQ plugins from the list of plugins

commit 682a13633dcc155f7e807e5985b01e56c527f7f9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 27 10:44:47 2017 +0100

    Update rabbitmq-components.mk

commit f56ebf7325357cd817d970992c5d6b3cbf597c41
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 27 10:33:09 2017 +0100

    rabbit, rabbit_cli: Use rabbit_misc:lists_droplast()
    
    ... instead of lists:droplast() directly. The latter was added to Erlang
    17.0 but we need to support Erlang R16B03.
    
    [#140575489]

commit 9b2d2af672b8075bbdff9a38347b71a2cd0f609f
Merge: afc851a40 2dc254732
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 23 20:36:10 2017 +0300

    Merge pull request #1123 from rabbitmq/rabbitmq-server-838
    
    Rename msg_store_index:delete_by_file to index_cleanup_undefined_file

commit 2dc2547323e2b720cb8973c68652d318555c42c0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 23 17:22:20 2017 +0000

    Long ugly callback name

commit afc851a40c80862a90e95a1b54196173f3629feb
Merge: ff83a7471 b261c8bf8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 23 19:55:27 2017 +0300

    Merge branch 'stable'

commit b261c8bf823dbada19e91efcbefd742e47e2a7cf
Merge: 3b8d508c2 19fcd1d49
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 23 19:50:05 2017 +0300

    Merge pull request #1121 from rabbitmq/rabbitmq-server-1120
    
    Emit rabbit_event events when alarms go in and out of effect

commit a8997349d1affc03e72c98bab1200463a2aa0569
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 23 16:20:23 2017 +0000

    Rename msg_store_index:delete_by_file to index_cleanup_undefined_file
    
    The `delete_by_file` function is used only once with `undefined` parameter.
    For key-value store implementations (e.g. eleveldb) it's much easier to
    implement, than maintaining a filename index. ETS index also can be optimised.

commit e18cd0682c8f0085a5521462cf79c7cdb5cf91fd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 23 14:30:28 2017 +0000

    Log stopping applications

commit 19fcd1d49a8784159cafacb54c0af69cd70e4174
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Feb 22 15:56:31 2017 +0000

    Emit rabbit_event events when alarms go in and out of effect

commit ff83a7471c40746e59473153a3a0c5bfdc7350ba
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Feb 22 15:29:05 2017 +0100

    Revert "Restore "Do not expand plugins anymore""
    
    Loading a native library (eg. a NIF) from an .ez archive in unsupported
    by Erlang and the team decided to revert this change again.
    
    This reverts commit 0151abf37710dfc421523f9235514a438270e032.
    
    [#136622317]

commit b343da61f6d4f2c9b91f204b24e2049d4141ca12
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 21 16:10:48 2017 +0300

    Rework DNS peer discovery test to be less sensitive to local resolver
    
    In some environments (e.g. on AWS) there can be more than one result
    returned. We only care about the list containing the value we expect.

commit 0f8d2c06aa7c9cb9ec7eb33c9547552679f2d095
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 23:57:51 2017 +0300

    Prefer inet:gethostbyaddr/1 to inet_res:gethostbyaddr/1
    
    The former is supposed to be the public API of the latter,
    see aweber/rabbitmq-autocluster#127.
    
    Fixes #1116.

commit d1a8ff8d28bfc66ddc512ae972d8f7d8daef47fd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 23:48:20 2017 +0300

    Fix a bad merge

commit 333f22b569096db1c0fd713e1a97d24280c57415
Merge: 702110c25 3b8d508c2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 23:37:01 2017 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_exchange.erl

commit 3b8d508c257d5710fce2527bc97d99f8ec87fc1e
Merge: 1f1d87227 af3fe74b1
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 20 23:32:55 2017 +0300

    Merge pull request #1118 from rabbitmq/rabbitmq-management-agent-25
    
    Periodic garbage collection of stats

commit af3fe74b13144d42d65ac5165eb87f821ee5c7d7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 23:28:39 2017 +0300

    Whitespace

commit 702110c25fe8d0375bcf8f8ec5cbe2cb7023022f
Merge: abfca7837 23f80ac04
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 20 20:38:33 2017 +0300

    Merge pull request #1115 from rabbitmq/rabbitmq-server-msg-store-recovery-optimize
    
    Optimise message store recovery.

commit abfca783762741ddc6a88610118fd2fef15b49f0
Merge: c4d74f429 0151abf37
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 20 17:58:37 2017 +0100

    Merge branch 'do-not-expand-plugins'

commit 0151abf37710dfc421523f9235514a438270e032
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 20 12:44:34 2017 +0100

    Restore "Do not expand plugins anymore"
    
    Support for reading static files from Erlang .ez archives was added to
    Cowboy and various RabbitMQ plugins were updated to take advantage of
    the new API.
    
    So this commit restores the following commits:
        7069f3b40daeb5095077bdac19f3837978bc2665
        76a8c66c8092cc1c37bb4aa90a0a3d18b27f7d9d
        2044cb1eed02e67c4ea749a807694c55ed574756
        bc64ac16774aeb403cba87f7e48ad70329dd8b3b
        d616cc922dbd73eca7700c50f09e33e6b578b0d9
    
    They were reverted in 72f7c8e70028209ee1c58074c087b4d0cb901e6c because
    Cowboy didn't have this support at the time.
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#118562759, #136622317]

commit 23f80ac04884ea08d2f8c1b567abd5689c8553e5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 19:23:19 2017 +0300

    Improve logging a bit

commit 0b777c76bcf65c73328caa0726eafd98e6824c8e
Merge: 78ac7fb59 c4d74f429
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 17:41:13 2017 +0300

    Merge branch 'master' into rabbitmq-server-msg-store-recovery-optimize

commit c4d74f4294169d875bb734164c52d020f10f37c9
Merge: 09b078a15 d9032a24b
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 20 17:40:29 2017 +0300

    Merge pull request #1102 from rabbitmq/rabbitmq-auth-backend-uaa-3
    
    Extend protocol error message with {error, _} from authz backend

commit d9032a24ba14aa0d7672acb835d8f4a750b66c61
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 17:07:57 2017 +0300

    Wording

commit 34d25d5f658dbccf721e4ec11b6b80cee9eaa604
Merge: 38bf6ec72 09b078a15
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 20 15:27:28 2017 +0300

    Merge branch 'master' into rabbitmq-auth-backend-uaa-3

commit 09b078a15e982d9a1163fb697bbee2b7fb9a054e
Merge: ea5e7da6f 1f1d87227
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 18 09:52:44 2017 +0300

    Merge branch 'stable'

commit 1f1d8722760f06984f7331bdbe14c9562ea37022
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 18 09:52:35 2017 +0300

    Update configurable value test expectation

commit ea5e7da6f74a41aacfde10426e27915791b62a96
Merge: a439b5f85 00c94eb8d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 17 23:52:49 2017 +0300

    Merge branch 'stable'

commit 00c94eb8d1bc608837c0b65cb4fc893947a8fd6e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 17 22:31:29 2017 +0300

    Bump msg_store_io_batch_size according to #1098
    
    Avoids a validation warning and if we increase initial
    message store disk bound credit to 4000, all values
    become proportionally increased (compared to < 3.6.7 defaults).

commit 78ac7fb591753c34c6c8cc87f31544a20d878af0
Merge: 47b2d490f a439b5f85
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 17 16:25:59 2017 +0300

    Merge branch 'master' into rabbitmq-server-msg-store-recovery-optimize

commit 828bc8ea4d7d98177cb952ffeaaa4cbc7fb943b7
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Feb 17 11:12:17 2017 +0000

    Test gc of core metrics

commit 7ff014f4c59c0ba66db2841ddb8f3037915f4b9e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Feb 16 16:21:02 2017 +0000

    GC gen_server2 metrics

commit ab21cce15ff0174d651b1ee61cbe5eb04041ae4d
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Feb 16 15:38:35 2017 +0000

    Garbage collection of core metrics

commit edaa714b6b00672683e4ae30a3ff9e5d42498a1f
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Feb 16 11:28:09 2017 +0000

    Function to retrieve all exchange names (keys)

commit 38bf6ec721f7d71e6e0477e029cde510bda85378
Merge: 6aa14c488 3b9953647
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 16 17:19:15 2017 +0000

    Merge branch 'master' into rabbitmq-auth-backend-uaa-3

commit a439b5f851380b5518e3a212cd31ac73db823c32
Merge: 3b9953647 305d042a7
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 16 18:23:07 2017 +0300

    Merge pull request #1112 from rabbitmq/rabbitmq-trust-store-56
    
    Config schema tests for trust store

commit 3b9953647e49883d64d6f205e2ec05c2440a301f
Merge: c9b80faab a84c90db4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 16 13:25:17 2017 +0300

    Merge branch 'stable'

commit a84c90db47d89aab8835deeb069dd0da872a91b6
Merge: 82748534a 1d0cf9673
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 16 13:24:19 2017 +0300

    Merge pull request #1114 from rabbitmq/rabbitmq-server-1113
    
    Use new #delta arity introduced to report paged out messages

commit 47b2d490f431112cd8b03aa35ef48c346a011a46
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 16 10:05:52 2017 +0000

    Allow any StartFunState for message stores

commit 1d0cf9673b40d5235755f0500433d4cd2c90a8ce
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Feb 16 08:25:23 2017 +0000

    Use new #delta arity introduced to report paged out messages

commit 305d042a7127ae96fb0899e81399c54f3617bf0c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 15 17:45:57 2017 +0000

    Config schema tests for trust store

commit 8e8c89993e46913c1449c7b6f4072a241e6570bc
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 15 15:06:31 2017 +0000

    Optimize per-vhost message store recovery

commit c9b80faab8a99139bcac047f630be3ce28a508a6
Merge: e01aff8c5 82748534a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 15 00:05:49 2017 +0300

    Merge branch 'stable'

commit 82748534acce4a9c6cf05400e1c7bed3320a6d07
Merge: 6f9ce6524 1d9a24e71
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 14 23:57:25 2017 +0300

    Merge pull request #1111 from rabbitmq/rabbitmq-top-20
    
    Initialize core stats before any gen_server2 is started

commit 1d9a24e71ef8e67c3f1fe2bfad646cf61b74d661
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Feb 14 15:21:23 2017 +0000

    Test that gen_server2 buffer length stats are generated for a gen_server2

commit 86a77a2000c8adaac1df6473533bce55893da353
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Feb 14 12:29:44 2017 +0000

    Initialize core stats before any gen_server2 starts

commit 6f9ce6524637259c1fcede0fe2f7a4f1544ae427
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 14 16:07:22 2017 +0300

    Remove a comment that's no longer relevant
    
    sync_mirrors can come from any process, so make sure
    the reader does not fixate on that unnecessarily

commit e01aff8c523fe74b3a1f6c8a755376b05d3e4abf
Merge: 753739f5e cb1842a59
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 13 16:28:26 2017 +0300

    Merge pull request #1101 from rabbitmq/fix-escript-hardlinks-copy
    
    Makefile: Use rabbitmq-cli's Makefile `install` target

commit 753739f5e16c237bbcf9eaa264fc2459b8b668b7
Merge: cb3c935dd c7e2c5324
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 13 16:27:14 2017 +0300

    Merge pull request #1109 from rabbitmq/proxy-protocol-configuration
    
    Add proxy protocol to configuration

commit c7e2c53243078b6c4487c1abe4c93bf0829fd035
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Feb 13 13:44:50 2017 +0100

    Add proxy protocol Cuttlefish mapping tests
    
    Part of #589

commit 96d7ede303ed4ee5c015fbc10207d30c313a16cc
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Feb 13 12:10:45 2017 +0100

    Add proxy protocol Cuttlefish mapping test
    
    Part of #589

commit 4073e52e86bf90630155ffa377dc92fd0586b661
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Feb 13 11:52:38 2017 +0100

    Add proxy protocol to configuration
    
    Part of #589

commit cb3c935ddb289498cfe8507c32c5890719954687
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Feb 13 10:39:41 2017 +0100

    Polish proxy protocol test suite
    
    Set copyright year to 2017, add rabbit_ct_helpers:testcase_started() call.
    
    References #589

commit 3e7c540eb6f708edc45381cc2aee83f6095d9d69
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Feb 11 23:25:56 2017 +0300

    Update rabbitmq-components.mk

commit f9ee1ec509b390b166d2d35b685ef2be45a1ad81
Merge: 43e54b28b b37471080
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 11 01:17:51 2017 +0300

    Merge branch 'stable'

commit b374710802cf482500b3ccb10b3a974e09581ab5
Merge: c98732335 bf8c38317
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Feb 11 01:16:12 2017 +0300

    Merge pull request #1107 from rabbitmq/rabbitmq-management-345
    
    Calculate memory size of pagged messages

commit bf8c3831744840240e63e9f2cc45594272d68e91
Merge: ff8a0fc45 c98732335
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 10 20:43:42 2017 +0300

    Merge branch 'stable' into rabbitmq-management-345

commit 43e54b28b16e58aba8f4279998ca41671db0acb6
Merge: 69b34aed4 c98732335
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 10 17:29:28 2017 +0000

    Merge branch 'stable'

commit c987323355979fad895bf7f84538840148851af9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 10 17:29:04 2017 +0000

    Make dynamic_ha tests more tolerant to timing issues

commit ff8a0fc45bc0302ccf50f154be4e6d6829a8ffaa
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Feb 10 10:56:23 2017 +0000

    Calculate memory size of pagged messages

commit 69b34aed418c2e52cd5e8faebcd3c161f7323658
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 10 11:16:16 2017 +0300

    Update rabbitmq-components.mk

commit c965682e8a573855978ca3b9108a305baf5c1953
Merge: e43347914 bbce05cf1
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 10 03:00:22 2017 +0300

    Merge pull request #1095 from rabbitmq/rabbitmq-server-589
    
    Support proxy protocol

commit bbce05cf1b33a94aef2a36133c799eaeed9d4280
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 10 01:00:37 2017 +0300

    Update rabbitmq-components.mk

commit e43347914b08677c4ca229c3ded5aceca3e405d4
Merge: 7c2d56d6f d84aefc50
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 9 19:16:07 2017 +0300

    Merge pull request #1106 from rabbitmq/rabbitmq-auth-backend-cache-7
    
    Support auth backend cache in sysctl config

commit d84aefc5036c59a53db0298aa4552cdc699dceee
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 9 19:14:21 2017 +0300

    Remove a duplicate head

commit 9e910db5f143cae41298219aa3569e588f5bba53
Merge: a3287dfee 7c2d56d6f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 9 19:12:33 2017 +0300

    Merge branch 'master' into rabbitmq-auth-backend-cache-7

commit 7c2d56d6ff8557358109d3883ff6f53cef16df2e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 9 18:56:02 2017 +0300

    Accept `cache` as a shortcut for `rabbit_auth_backend_cache`
    
    References rabbitmq/rabbitmq-auth-backend-cache#7.

commit 3599cde502f31d840cf6bcf49b12986c2b25c36c
Merge: c2fc3f218 b685d8cb9
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 9 18:04:06 2017 +0300

    Merge pull request #1103 from rabbitmq/rabbitmq-auth-backend-ldap-59
    
    Shorter prefix for LDAP conf keys in test snippets

commit b685d8cb929c60a84fd1d469891dd0b90884e2ab
Merge: 8cbdf0e8b c2fc3f218
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 9 17:42:54 2017 +0300

    Merge branch 'master' into rabbitmq-auth-backend-ldap-59

commit a3287dfeebf50e6ee787cdad76e4b5280eb06a7c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 9 12:41:29 2017 +0000

    Support auth backend cache in sysctl config

commit cb1842a596536d80add33b15f6eab97018774a6f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 9 12:05:10 2017 +0100

    Makefile: Use rabbitmq-cli's Makefile new install target
    
    The local recipe was moved and adapted to rabbitmq-cli. This allows to
    get rid of any knowledge of rabbitmq-cli layout.
    
    Furthermore, package building will be able to use that target too
    instead of copying this copy again. Therefore each package can use
    hardlinks or symlinks independently.
    
    [#138925175]

commit 8cbdf0e8b449815d6c10a73e619880228a8e9434
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 9 10:52:36 2017 +0000

    Rename auth backends prefixes to auth_X

commit c2fc3f2187aa2ae45853aa4bd89e628685909630
Merge: 60fe60d08 6b0f50086
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 9 05:03:00 2017 +0300

    Merge pull request #1105 from Jakauppila/rabbitmq-server-1104
    
    Quote -conf_dir/-conf_schema_dir path variables

commit 6b0f500865d7d3111f618491a388e12139c493e2
Author: Jakauppila <Jared@Kauppi.la>
Date:   Wed Feb 8 19:49:01 2017 -0600

    Quote -conf_dir/-conf_schema_dir path variables

commit 271fe85363861e790b1c7d745f6b120b2818cafb
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 8 18:13:53 2017 +0000

    Shorter prefix for LDAP conf keys in test snippets

commit f8ef1a73e872ad9b3e3a8936b0ddc18217cbe2ba
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Feb 8 17:13:23 2017 +0100

    Makefile: Use pax(1) to copy escripts from rabbitmq-cli
    
    Before this change, we used cp(1) and its `-r` flag to copy the source
    directory recursively. Pretty standard.
    
    We are using hardlinks in the source directory because all escripts are
    the same code: the program uses the filename to determine the behavior.
    Pretty standard too. We settled on hardlinks, not symlinks, because on
    Windows, you need elevated privileges to use symlinks apparently.
    
    Unfortunately, `cp -r` treats those hardlinks as separate files. thus
    the destination directory contains three distinct copies of the same
    file:
    
        $ ls -l escript/
        -rwxr-xr-x  1 dumbbell  dumbbell  4545805 Feb  8 17:25 rabbitmq-diagnostics
        -rwxr-xr-x  1 dumbbell  dumbbell  4545805 Feb  8 17:25 rabbitmq-plugins
        -rwxr-xr-x  1 dumbbell  dumbbell  4545805 Feb  8 17:25 rabbitmqctl
                    ^---- Single references to distinct files
    
        $ du -sh escript/
        13M    escript/
    
    I first tried with `-a` (cp(1) archive mode) instead of `-r`, but
    the behavior is inconsistent accross platforms. GNU coreutils' cp(1)
    preserves hardlinks as I would expect, but BSD cp does not. Indeed `-a`
    isn't a standard option. BSD cp's manpage documents the behavior and
    suggests to use tar(1), cpio(1) or pax(1) when hardlinks are meant to be
    preserved.
    
    tar(1) and cpio(1) are unavailable by default in MSYS2 (used on
    Windows), but pax(1) is. So now, we use pax(1) to copy the escript
    source directory and hardlinks are preserved on all platforms, including
    Windows.
    
        $ ls -l escript/
        -rwxr-xr-x  3 dumbbell  dumbbell  4545805 Feb  8 13:53 rabbitmq-diagnostics
        -rwxr-xr-x  3 dumbbell  dumbbell  4545805 Feb  8 13:53 rabbitmq-plugins
        -rwxr-xr-x  3 dumbbell  dumbbell  4545805 Feb  8 13:53 rabbitmqctl
                    ^---- Three references to a single file
    
        $ du -sh escript/
        4.4M   escript/
    
    [#138925175]

commit 6aa14c4889e2a85acf4c2ed343694152f7a7051e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 8 16:34:49 2017 +0000

    Extend protocol error message with {error, _} from authz backend

commit 60fe60d08d0213f3345ea8a50bac239e0dda2218
Merge: d8e0c2722 3466d007d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 16:51:44 2017 +0300

    merge branch 'stable'

commit 3466d007d529e24e4bc995b98021ae0a9dfe295a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 16:38:08 2017 +0300

    Update rabbitmq-components.mk

commit d8e0c27222335db77cb5fe083a1cc15936493da2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 13:12:32 2017 +0300

    Use more realistic hostnames in ldap.servers examples

commit 3b02c783169435db0835159fc06cebd5853dfd92
Merge: a2ffc12d0 f5b3d3ed6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 12:17:16 2017 +0300

    Merge branch 'stable'

commit f5b3d3ed6fbadd0bcf351db4774fdb349b7c7b3d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 12:15:10 2017 +0300

    Rework credit_flow test to not depend on application env
    
    Every time it is updated we forget to update the test, plus
    at least one time it took a few hours to even find out
    what exactly was failing (yes, even with CT logs).
    
    This test doesn't have to use application environment
    values anyway.

commit 562449c5f7c74535f222ba64356c6bc6561db449
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 8 11:56:05 2017 +0300

    Mention #1098

commit 2e8f90e2636c6989bf1d126982af4cd84b4125cf
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Feb 7 17:58:02 2017 +0100

    Remove ranch proxy protocol from rabbitmq-components
    
    Will be added once the PRs are merged.
    
    References #589

commit 9529aceb302f35e68fc08808a7c45c012c5972d2
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Feb 7 17:34:00 2017 +0100

    Add ranch proxy protocol to rabbitmq-components
    
    References #589

commit a2ffc12d06bfd23223ea4cefd3012fc93cc0e485
Merge: 9280ea6c5 86d8ef602
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 7 15:30:33 2017 +0300

    Merge branch 'stable'

commit 86d8ef6024170205fda5dfd7eb9b55c0c00779d7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 7 15:30:18 2017 +0300

    Update test expectations

commit af77e0f0955c1e0b75ec2f1140dbabbe87847524
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Feb 7 11:25:20 2017 +0100

    Fix Makefile

commit 678dcd91c28a939b612e5945b92fe130a1011df2
Merge: ac29fabde 9280ea6c5
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Feb 7 11:11:25 2017 +0100

    Merge branch 'master' into rabbitmq-server-589
    
    Conflicts:
            Makefile

commit ac29fabdefd1887b27014814589c2bbd4ec903b7
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Feb 7 10:43:14 2017 +0100

    Add tests for proxy protocol support
    
    References #589

commit 9280ea6c5c33245831a295edb4fb72ee775cf681
Merge: a6dfd29fc fbfb2b12d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 7 10:23:15 2017 +0100

    Merge branch 'stable'

commit fbfb2b12d91b83bc009b73b274813f814a838833
Merge: 3234c7a3e 0d596be72
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 7 10:22:38 2017 +0100

    Merge branch 'disable-background-gc-by-default' into stable

commit a6dfd29fc18fc0d0611528d9dac7f5437e372231
Merge: b88b88d65 3234c7a3e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 6 19:49:22 2017 +0300

    merge branch 'stable'

commit 3234c7a3ec78ee7717962d969dae619f83255ae4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 6 19:23:46 2017 +0300

    Update rabbitmq-components.mk

commit b88b88d65fdc27017843496a960678c0b1d81798
Merge: 5f020264b cfb0b2271
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 6 01:22:20 2017 +0300

    Merge pull request #1086 from rabbitmq/rabbitmq-server-1085
    
    Add topic authorisation for consumption

commit cfb0b22718ddc4fcbfaf4937a775a5be278a6a08
Merge: e06ad9811 5f020264b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Feb 5 23:18:47 2017 +0300

    Merge branch 'master' into rabbitmq-server-1085

commit 0d596be722460638331340d45ae7724a7f585200
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Feb 5 23:05:52 2017 +0300

    Bump message store credit flow settings
    
    If we increase generic value for all processes, we should
    also increase them for the message store. The ratio isn't particularly
    scientific.

commit 2f3fb8023ba1f535b13f4deb97106c08b78bc1d9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Feb 5 14:41:40 2017 +0300

    Disable background GC by default; bump credit flow defaults
    
    Quite a bit of evidence of different kinds of workloads suggest
    that background GC does not contribute meaningfully to reducing
    node RAM usage on most of them. It does, however, on each run
    produce a massive spike in VM and CPU context switches,
    causing latency spikes.
    
    Some users report that running without background GC cuts
    their latency to a half or even a third.
    
    Multi-hour stress tests that max out all node CPU cores
    suggest that our current credit_flow default can still be bumped
    safely, reducing the amount of time publishers are throttled
    and making publisher latency and node's observed message throughput
    more predictable.

commit 5f020264b9507e2a9a7e024cc6bb9a47df0200ee
Merge: ff70e180a 3c32d7ed3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 3 17:24:17 2017 +0300

    Merge branch 'stable'

commit 3c32d7ed3ebf6d756a3e61a84cbeebc7394fc7f4
Merge: 4d90fd705 8a5387ffe
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 3 16:28:17 2017 +0300

    Merge pull request #1097 from rabbitmq/move-rabbit_ssl-functions-to-rabbitmq-common
    
    rabbit_ssl: Move most functions to `rabbit_cert_info` in rabbitmq-common

commit 8a5387ffed36c9b85e10574f11549c118df7b8be
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Feb 3 13:19:40 2017 +0100

    rabbit_ssl: Move most functions to `rabbit_cert_info` in rabbitmq-common
    
    Those functions do not depend on the broker itself, so they are safe to
    be moved to rabbitmq-common.
    
    Those functions are used by rabbitmq-erlang-client. So moving them
    resolves one more dependency of the client on the broker.
    
    [#118490793]

commit ff70e180a31c0c57304de9683c38c13fd7e49995
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 2 17:16:47 2017 +0100

    Update rabbitmq-components.mk

commit 7d30f7f77b7fb0390424cc458f3b59bbb23a7801
Merge: af7150ed7 a235f2c99
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Thu Feb 2 10:02:43 2017 +0000

    Merge pull request #1091 from rabbitmq/rabbitmq-server-1090
    
    Ignore pre-release version part in plugin version requirement validation

commit 543ae6303754ab9060936a42bf4b95c9088adf29
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Feb 2 10:45:40 2017 +0100

    Add proxy_protocol configuration options
    
    References #589

commit af7150ed7f943bb75ba3b6f7d46d443c0e0801db
Merge: 22a756fd8 288ab0841
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 1 23:22:00 2017 +0300

    Merge pull request #1089 from rabbitmq/rabbitmq-common-164
    
    Change the calls that uses the rabbit_json module

commit 288ab084198212282d419eb78ccfd91c1c4108b6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 1 17:45:07 2017 +0300

    Switch to rabbit_json:try_decode/1

commit f4f8c58e72f39c2181e8293bff8f9d995a88b1a3
Merge: 40cdcf956 22a756fd8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 1 15:42:25 2017 +0300

    merge branch 'master'

commit e06ad9811621e4f44ebedc6893968924745b4d85
Merge: 41394d3cc 22a756fd8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Jan 31 17:14:18 2017 +0100

    Merge branch 'master' into rabbitmq-server-1085

commit 22a756fd8c10f317590a43754548df3192cf3701
Merge: 051967f1f 4d90fd705
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 31 18:21:09 2017 +0300

    merge branch 'stable'

commit 4d90fd7055900b8c168cb1b62ab505eb2271149c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 31 18:06:20 2017 +0300

    Update rabbitmq-components.mk

commit 051967f1f9e9fb273dadff98e072b6ce5d828578
Merge: 192f844d6 0b95bbfc9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 31 11:25:08 2017 +0100

    Merge branch 'stable'

commit 0b95bbfc9ee995e8132bd9abc9c4b89e4b673a87
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 31 11:24:05 2017 +0100

    Makefile: Load rabbitmq-dist.mk before rabbitmq-run.mk
    
    rabbitmq-run.mk also loads rabbitmq-dist.mk. This avoids a double-load
    of rabbitmq-dist.mk.

commit 40cdcf956c602666b476061e5d1621ccbdf342c3
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Jan 27 21:59:43 2017 +0100

    Add Reason to error handler

commit d2be09c346b6745545496f45b54350bf616435c9
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Jan 27 21:57:05 2017 +0100

    Add Reason to error handler

commit a235f2c99c1aa545f5f760bab7f02a1815fd73a5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jan 26 15:14:12 2017 +0000

    Rename "alpha" to "preview" in version comment

commit 9983b0b6961cced4093934334c3ac4a7d33a84e0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jan 26 14:09:08 2017 +0000

    Ignore pre-release version part in plugin version requirement validation

commit 064c91dd5ce45553b6ed0c818247f7727b86e0e9
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Jan 25 17:41:40 2017 +0100

    Change the calls that uses the rabbit_json module
    
    See :https://github.com/rabbitmq/rabbitmq-common/issues/164

commit 41394d3cc9f2aa28f213dd75ebf2d64a9a7d37a6
Merge: 1ae0e83f7 192f844d6
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Jan 23 09:41:59 2017 +0100

    Merge branch 'master' into rabbitmq-server-1085
    
    Conflicts:
            test/topic_permission_SUITE.erl

commit 192f844d6fe0259aa0d6bb0f0eeb283a9038f031
Merge: 66a44fa15 ee27e6650
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 21 02:05:09 2017 +0300

    Merge pull request #1082 from rabbitmq/rabbitmq-event-exchange-10
    
    Notify user who performed the action in all system events

commit ee27e6650ac243125a9be080a71446e40ec4af8e
Merge: cfe982987 66a44fa15
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 20 20:29:00 2017 +0300

    Merge branch 'master' into rabbitmq-event-exchange-10

commit cfe9829874149d431428217947d97f9c2d2c84a7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 20 20:24:00 2017 +0300

    Fall back to ?UNKNOWN_USER if no user is present in options
    
    Sometimes we don't know who the declaring user was: it can be
    due to an upgrade, because an exchange is built-in, and so on.
    
    Per discussion with @dcorbacho.

commit 1ae0e83f74afec21246af3542978388442d7c248
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Jan 19 14:56:47 2017 +0100

    Add topic authorisation for consumption
    
    Fixes #1085

commit 66a44fa157f2ab3f68e9894f13a0f4eb4ff71b80
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 19 10:53:56 2017 +0300

    Correct and expand rabbitmqctl(1) examples for vhost limits

commit d8fd7d3f04b9e42513dd493c91167039076e75f3
Merge: bfff36ea6 5c239b061
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Wed Jan 18 17:07:23 2017 +0000

    Merge pull request #1084 from rabbitmq/use-sh-for-scripts
    
    Modify new scripts to use /bin/sh

commit 5c239b0618333f4d4f140012e90cc61fc5139799
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Jan 17 18:03:18 2017 +0000

    Modify new scripts to use /bin/sh
    
    While at it, make them POSIX.1-2008 compliant (a.k.a fix all shellchecks)
    
    Prefer parameter expansion and manipulation over command invocation:
    
        # OK-ish
        `dirname $0`
    
        # SPOT ON
        "${0%/*}"
    
    Guard against empty ESCRIPT_DIR var

commit 6bf17f6c6351e019db3df4112d1c33b95bcff705
Merge: 7e3aae8c1 bfff36ea6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 17 20:23:51 2017 +0300

    Merge branch 'master' into rabbitmq-event-exchange-10

commit bfff36ea6517bcb478534001a0430f5e58149666
Merge: dd92f1550 24862a63d
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 17 18:41:58 2017 +0300

    Merge pull request #1083 from rabbitmq/rabbitmq-cli-165
    
    Fix API for listing vhost limits

commit 24862a63d24dde583e697ae781fb1f4ba534d222
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jan 17 13:02:42 2017 +0000

    Fix API for listing vhost limits

commit 7e3aae8c1af08775dd3094c17aadfd380a41e383
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Sun Jan 15 20:23:27 2017 +0000

    Notify user who performed the action in all system events

commit 7b1f550c17d9cd7da4dc8394df7941bd7dd9fd1b
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Jan 10 14:59:58 2017 +0100

    Add user ID to consumers

commit 3d7e53723c3855d1e874be8a32f3258347d95518
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Jan 10 09:02:09 2017 +0100

    Include options map in queue and exchange records

commit dd92f155047a9f2d0c312287ef3711a2e5c7525f
Merge: 03bc4fb93 d74c5e4fb
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 13 15:06:36 2017 +0300

    Merge pull request #1065 from rabbitmq/rabbitmq-server-505
    
    Topic-based authorisation for publishes

commit 03bc4fb93c6b98284e6967f0157dd1de88c2a499
Merge: 5958618e5 468dc77ca
Author: D Corbacho <diana@rabbitmq.com>
Date:   Fri Jan 13 08:50:56 2017 +0100

    Merge pull request #1080 from rabbitmq/rabbitmq-management-limit-json
    
    Change  format for Limits API

commit 468dc77caf6b57aacdb022cecb4f133623a6e520
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Thu Jan 12 23:47:05 2017 +0100

    Change  format for Limits API

commit d74c5e4fb4a712d57e55ddcf50fdecb4ab7f9106
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 12 18:23:57 2017 +0300

    Log topic when access to one is refused

commit 5958618e5b6c8e13400eb9dbe212493c7cfcb94a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jan 12 13:28:47 2017 +0000

    Make sure command extensions are enabled during script execution
    Extensions are required for recursive directory creation via mkdir

commit 155da39ad31ad788b6ccedc0bbd3a9da66338ae5
Merge: eeaafa91e becd93d97
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 12 13:09:10 2017 +0300

    Merge branch 'master' into rabbitmq-server-505

commit becd93d971cb3a0de439920443077ef1fbb9f2a5
Merge: 20e7ba8ee 6a105dba9
Author: D Corbacho <diana@rabbitmq.com>
Date:   Wed Jan 11 10:16:24 2017 +0100

    Merge pull request #1078 from rabbitmq/rabbitmq-server-1054-master
    
    Credential configuration config schema

commit 6a105dba95c4005779734079f94d042785194589
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 10 15:38:47 2017 +0800

    One more test

commit 1af0ca5c8702de867aaca282c35f349a0281b448
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 10 15:08:17 2017 +0800

    Config schema mappings for credential validators

commit ab1a4edabb61093eb227b8d4a86c9eeb90525feb
Merge: 20e7ba8ee a5a4fda6e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 10 14:41:04 2017 +0800

    Merge branch 'stable' into rabbitmq-server-1054-master

commit 20e7ba8ee8dcee02cc3e7e5dbb2ab725cb0151a7
Merge: f2e4139ee 7cedbad38
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 7 05:30:53 2017 +0800

    Merge pull request #1074 from rabbitmq/rabbitmq-cli-155
    
    Export close_connections

commit 7cedbad38b93ccb67bc6b42c271c84392d500a08
Merge: 341973d02 f2e4139ee
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jan 7 03:25:11 2017 +0800

    Merge branch 'master' into rabbitmq-cli-155

commit a5a4fda6e51a3a4bc7eca25e72c2a72a9f230a0a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Jan 7 02:18:22 2017 +0800

    These helpers were moved to rabbitmq_ct_helpers

commit f2e4139eeb52e599d5b9a5c465ac1a94f3e992df
Merge: 4bd7bb481 8e04bdd1f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 6 23:28:31 2017 +0800

    Merge branch 'stable'

commit 8e04bdd1ffde27fe1fb5dc3084469fcf2c2493f2
Merge: fa1651940 1bfce82fd
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Fri Jan 6 15:19:51 2017 +0000

    Merge pull request #1075 from rabbitmq/rabbitmq-clusterer-19
    
    Re-introduce rabbit_table:wait_for_replicated/0

commit 1bfce82fd9fc8c1216f6b74f81d61e70237a3f28
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 6 22:23:20 2017 +0800

    Re-introduce rabbit_table:wait_for_replicated/0 for backwards compatibility
    
    Fixes rabbitmq/rabbitmq-clusterer#19.

commit 4bd7bb481423e714227a4b2d4a9587b7d501b841
Merge: ca4d19fa0 fa1651940
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Jan 6 08:44:31 2017 +0100

    Merge branch 'stable'

commit fa16519406b88ed56e44f30f392bdb7ef328d9c7
Merge: 62d8e6757 19e43f63b
Author: D Corbacho <diana@rabbitmq.com>
Date:   Fri Jan 6 08:41:24 2017 +0100

    Merge pull request #1070 from rabbitmq/rabbitmq-server-1054
    
    Introduce credential validators

commit 341973d024b1046a7eaa1d915374f838f08fd471
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Jan 6 08:26:36 2017 +0100

    Export close_connections

commit 19e43f63b16a3364b9bfea0ce5e0ffaf3fe73451
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 6 03:59:49 2017 +0800

    Compile

commit e4a6e388d017bed82ae2fd6eabea30920263afcc
Merge: 9a40523c8 62d8e6757
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jan 6 03:59:31 2017 +0800

    Merge branch 'stable' into rabbitmq-server-1054
    
    Conflicts:
            test/worker_pool_SUITE.erl

commit ca4d19fa0a5aa082e9b600352da109cbe636ab64
Merge: e1bb00158 c6c40352d
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 6 03:54:00 2017 +0800

    Merge pull request #1073 from rabbitmq/rabbitmq-server-628
    
    Force close connection when user is deleted

commit c6c40352d46aa7f9de8aa412825122871e9aa3a6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 5 11:25:31 2017 -0800

    Rename a function
    
    If it returned a map of users to connections
    then "per_user" would be the perfect name.
    However, it only returns connections of a single
    user.

commit 9a40523c863f3e3a9f212364689ac8c47acaeca5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 5 23:55:49 2017 +0800

    rabbit_credential_validation:validate_password/1 => rabbit_credential_validation:validate/2
    
    Existing built-in implementations still ignore the username argument.
    
    Per discussion with @dcorbacho.

commit e1bb001582da62718fc5339490813ab53045a719
Merge: 4e1745591 62d8e6757
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 5 15:59:52 2017 +0100

    Merge branch 'stable'

commit 4e174559130bac052a269b52606b525280d6212f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 5 15:59:06 2017 +0100

    clustering_management_SUITE: Fix "unused variable" warnings

commit 62d8e67571af1f5e90e1e5864c5f7ca101d2c0c2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 5 15:49:34 2017 +0100

    worker_pool_SUITE: Fix "unused variable" warnings

commit 06d41a43c553596a7c602a072c533a10f387d23c
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Jan 5 14:54:36 2017 +0100

    Force close connection when user is deleted

commit b1e63d496afb0958a00c21d60ec8b824d4038769
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 5 15:52:37 2017 +0800

    More tests; wire in validation into change_password/2

commit 99a170cd36464762bf868484643695804e8b9a95
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 5 03:35:09 2017 +0800

    Test suite fixes

commit 75bee2611c8efcbfd4bb3f464a642405f4cec0dd
Merge: 32587fa7f af06a3cc6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 5 00:27:22 2017 +0800

    Merge branch 'stable' into rabbitmq-server-1054

commit 32587fa7f3232713a2a08f60a44ca87272467b6c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jan 5 00:26:55 2017 +0800

    More (failing) tests

commit af06a3cc6c5d80448cf0831753f2c5b54576b18b
Merge: 8acf85beb 00ad4cd57
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 4 20:55:01 2017 +0800

    Merge pull request #1072 from rabbitmq/rabbitmq-server-964
    
    Configure memory reduction for all queue types

commit a2bf05779c508b248a9d53fae79bb83ee353c5dc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jan 4 19:41:45 2017 +0800

    Initial integration tests for credential validation

commit 00ad4cd57ca54ae8d5b40b01221f7eb32dcae615
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Jan 4 11:08:44 2017 +0100

    Force memory reduction on tests

commit 833e65ef52fac14664fd82f808aa55f306a0ce72
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jan 4 16:26:13 2017 +0800

    Introduce rabbit_credential_validation; fix validators for successful integration

commit 7c3ab570393c5b5c125bb3706f8aeb38a68dc318
Merge: bbbab4f9a 8acf85beb
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Jan 3 16:08:25 2017 +0000

    Merge branch 'stable'

commit 8acf85bebac7a69afe5e19c4c522434393a2b8ec
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Jan 3 16:03:43 2017 +0000

    Fix include path
    
    Otherwise Syntastic cannot find it

commit ccebf4a0043d2c346f33cb95ece1995a10e8735c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jan 3 15:08:45 2017 +0800

    Property-based tests for regexp credential validator

commit d879a863efc6effd67ac2e2e1ee2a82c330fd89f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jan 2 19:48:26 2017 +0800

    Extract a function

commit 70fdf59cb51a47592c77e06a111b4250b8d1ceb5
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Dec 22 16:43:19 2016 +0100

    Configure memory reduction for all queue types

commit 634a53f44a4795baa68a0b654e71210e5589b524
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Dec 30 03:56:57 2016 +0800

    Introduce rabbit_credential_validator_regexp

commit eeaafa91e6299a41faf6c7972f6418e518b245d2
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Dec 29 17:33:28 2016 +0100

    Launch topic authorisation test in broker
    
    References #505

commit cf259df33dc27b9ca99682cdccc1067eb76fd808
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Dec 29 08:49:34 2016 +0100

    Create topic permission table in upgrades
    
    References #505

commit f2012f2d9b07b8e92549cb115541e3af507e8083
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Dec 28 17:56:44 2016 +0100

    Basic property-based tests for min length validation strategy

commit 0876ac25d41a647b2f0af5fa186e530ea68b39ef
Merge: 868573a77 bbbab4f9a
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 28 09:37:44 2016 +0100

    Merge branch 'master' into rabbitmq-server-505

commit bbbab4f9ac1b23f9950a3172790d7ba724699c93
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 28 09:34:38 2016 +0100

    Remove not-existing test group reference

commit 868573a77513057e80f2e884b2d8baf438d70639
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 28 09:28:23 2016 +0100

    Move topic permission tests in their own suite
    
    References #505

commit fea4fdde4ceae88d818ac2847677462a4aced62b
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Dec 27 16:40:24 2016 +0100

    Fix topic authorisation test
    
    Fixes #505

commit 6a016d5b5db291ab0a99edbc794fc7ab45299c24
Merge: 6afabee77 30ebac8cc
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Dec 27 16:36:08 2016 +0100

    Merge branch 'master' into rabbitmq-server-505

commit 30ebac8cc103cf032d5e7bdd1b5f74407f4b986f
Merge: 9468daed0 0463c59f0
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Dec 27 16:08:33 2016 +0300

    Merge pull request #1067 from rabbitmq/rabbitmq-server-1058
    
    Getting rid of rabbit_control_main

commit 6afabee7738c5e56ebf9638101f11b6be728afaf
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Dec 27 12:20:58 2016 +0100

    Test topic permissions list functions
    
    References #505

commit 9468daed03453545d3d9a6c0f66b2def77f9d42d
Merge: a2b7d2137 58dd55b00
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 26 10:01:54 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            scripts/rabbitmq-server
            scripts/rabbitmq-server.bat

commit 58dd55b00851c98c004bb1a3ed7666a5c1a492de
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 26 09:57:05 2016 +0300

    Use a less ambiguous word that does not confuse spelling checkers

commit c0336e85f4260ab256891adb71fa44bd3d42ee69
Author: Andrew Dryga <andrew@dryga.com>
Date:   Sun Dec 25 17:32:54 2016 +0200

    Fixed various typos across code comments
    
    Conflicts:
            scripts/rabbitmq-server
            scripts/rabbitmq-server.bat
            src/rabbit_queue_index.erl

commit a2b7d21372bc13030f9b63a6d19094d83730cfff
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 26 09:57:05 2016 +0300

    Use a less ambiguous word that does not confuse spelling checkers

commit d8a90c9b4545ea0a162b310d77574ff58e87f068
Merge: fdf783f9a d1359be41
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 26 09:55:47 2016 +0300

    Merge pull request #1069 from AndrewDryga/fix-typos
    
    Fixed various typos across code comments

commit d1359be41d60076518f354e5454d4eb5a28ddd0b
Author: Andrew Dryga <andrew@dryga.com>
Date:   Sun Dec 25 17:32:54 2016 +0200

    Fixed various typos across code comments

commit fdf783f9accd0b7c914b17907c0d7528750fb961
Merge: 72f7c8e70 1d4e939b8
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Dec 24 04:09:12 2016 +0300

    Merge pull request #766 from rabbitmq/rabbitmq-server-567
    
    Per vhost message store

commit 1d4e939b84b56dd793bd265bec074a392cdf194b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Dec 24 01:05:37 2016 +0300

    Don't log #resource records

commit bcff954479ceefd21f883afc249b2e30686c9856
Merge: 12901fbbc 72f7c8e70
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 23 23:18:16 2016 +0300

    Merge branch 'master' into rabbitmq-server-567

commit 72f7c8e70028209ee1c58074c087b4d0cb901e6c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 23 18:36:57 2016 +0100

    Revert "Do not expand plugins anymore"
    
    This broke the management plugin: Cowboy assumes direct file access to
    resources in the `priv` directory.
    
    This reverts commits:
        7069f3b40daeb5095077bdac19f3837978bc2665
        76a8c66c8092cc1c37bb4aa90a0a3d18b27f7d9d
        2044cb1eed02e67c4ea749a807694c55ed574756
        bc64ac16774aeb403cba87f7e48ad70329dd8b3b
        d616cc922dbd73eca7700c50f09e33e6b578b0d9
    
    [#118562759]

commit 12901fbbc5656d2140738c98c72272d7b8383c9b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 23 17:30:13 2016 +0000

    Revert to syncronous vhost recovery since there are concurency limitations

commit 0463c59f046dad645cc4f83b9c2289df755af85a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 23 17:15:03 2016 +0000

    More messages for sync test

commit 6f728e7b54986b65e02c34978dbc6c2a8205f364
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 23 16:03:16 2016 +0000

    Do not test global parameters command
    Should be handled by CLI tests

commit f50465102ea647917ea629b0306661c510e5a9a6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 23 12:11:39 2016 +0000

    Get rid of rabbit_control_main

commit 83d32221804d75ce0d6957a0886ae7a451e2a08b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 23 10:25:23 2016 +0000

    Fix logs. Expect multiple logs during startup

commit c223cce52a1a9f200d9691c86fd75d876cadaf4d
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Dec 23 10:34:48 2016 +0100

    Delete topic permissions on vhost deletion
    
    References #505

commit dc89936ce4b74d322601972abc9b195ee7535a90
Merge: 0706cf06b d616cc922
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Dec 22 17:09:20 2016 +0100

    Merge branch 'master' into rabbitmq-server-505

commit 0706cf06b09c5c55762ab67ee4c11b28fcf6ee85
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Dec 22 16:54:52 2016 +0100

    Check non-existing user/vhost in topic authz tests
    
    References #505

commit 365e13319e034f9c5aa1b6e8ca86133f976d87ed
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Dec 22 13:48:10 2016 +0100

    Test clear_topic_permissions functions
    
    References #505

commit 79685d044aee1ec7c557660fbefbcede8d789338
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 22 12:03:52 2016 +0000

    Recover queues after non-clean shutdown

commit 5282534220029eaaf138542eb15b16fa96afde82
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 22 11:55:33 2016 +0000

    Recover vhosts message stores in parallel after a crash

commit 1403596717839c48f95903dc37058c2146878f9f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 21 17:54:54 2016 +0000

    Force recover client references to be maps. Start empty message store for each vhost on migration.
    
    Empty message stores should be started to avoid rebuilding indexes on actual startup.

commit e5557ad53c2d01c5534ad7626f2b447ad1c0aa9b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 21 17:54:04 2016 +0000

    Fix msg_store test

commit d616cc922dbd73eca7700c50f09e33e6b578b0d9
Author: Daniil Fedotov <daniil@rabbitmq.com>
Date:   Wed Dec 21 16:12:47 2016 +0000

    Fix listing active plugins with multiple plugin directories
    
    Bug introduced in https://github.com/rabbitmq/rabbitmq-server/pull/1064
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#136495407]

commit 1514c2d1f44e7dda3a2c75e38ec452f4001550cf
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 21 16:21:29 2016 +0100

    Improve topic test authorisation test
    
    References #505

commit 109c449c269baf0f27645a818a1b8a6fb23d7418
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Dec 21 15:44:53 2016 +0300

    Move credential validators into rabbitmq-server
    
    Also introduces `rabbit_credential_validator_min_length` with
    basic tests.

commit 38d7d86a8a0620fe2e632429f403b426a9810704
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Dec 21 14:33:15 2016 +0300

    Introduce credential validation CT suite
    
    [#135773147]

commit badf82983611f5777b8d756f7ebc6f40a91d32d5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Dec 21 14:30:06 2016 +0300

    Drive by change: squash a few warnings in worker_pool_SUITE

commit 460b2dc75e068485900b1ad9fffb909216e76891
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 21 11:52:15 2016 +0100

    Add rabbit_topic_permission table
    
    References #505

commit 569d114f5c85d9f329bdc10cba1fdb41f97e42d3
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Dec 21 11:26:23 2016 +0100

    change error function with rabbit_log:error

commit eafad5a84eb94bf7cb001ee932540f9de7d6a897
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 20 18:54:33 2016 +0000

    Refs can be undefined

commit 1ec2ac8b0ffb712f6b1e14ac0366a6dd869dc1d3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 20 18:45:30 2016 +0000

    Pass queues and recovery terms to fold

commit 308a2b5f5603b20906de2bec0d7d80ff99073e86
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 20 18:38:40 2016 +0000

    Group recovery client refs by vhost

commit 5f7553c0bd2eac3fc311761bc2b81763f537c1e5
Merge: 3d568701e cbbcc3e32
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 20 18:17:10 2016 +0000

    Merge branch 'master' into rabbitmq-server-567

commit cbbcc3e32f97b6047b4f82f0776717dd3e85430c
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Tue Dec 20 17:22:12 2016 +0000

    Ignore indirect dependencies of rabbit in rabbit_plugins
    
    The goal of maybe_keep_required_deps() is still the same: we don't want
    to list applications from $RABBITMQ_PLUGINS_DIR the rabbit application
    depends on. Now, the function handles indirect dependencies.
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#136346167]

commit 3d568701e733dfb07d9a61390c192364ad4ce68a
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Dec 20 17:08:14 2016 +0100

    fix typo

commit bc1011d0ea93591bb01faf105a58d05cdc1bea76
Merge: 6caabb89c bc64ac167
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Mon Dec 19 17:42:45 2016 +0000

    Merge pull request #1064 from rabbitmq/do-not-expand-plugins
    
    Do not expand plugins

commit bc64ac16774aeb403cba87f7e48ad70329dd8b3b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 19 17:41:10 2016 +0100

    Do not set `plugins_expand_dir` from $RABBITMQ_PLUGINS_EXPAND_DIR
    
    The environment variable is now ignored.
    
    Signed-off-by: Gerhard Lazu <gerhard@rabbitmq.com>
    
    [#118562759]

commit 2044cb1eed02e67c4ea749a807694c55ed574756
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Mon Dec 19 12:40:27 2016 +0000

    Use the code path to find loaded plugins
    
    We were using the expand_dir before, which no longer exists
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#118562759]

commit 76a8c66c8092cc1c37bb4aa90a0a3d18b27f7d9d
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Mon Dec 19 12:39:57 2016 +0000

    Optionally cleanup the old plugins expand dir
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#118562759]

commit 7069f3b40daeb5095077bdac19f3837978bc2665
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Mon Dec 19 12:38:00 2016 +0000

    Do not expand plugins anymore
    
    We are now using plugins directly from plugins_dir, regardless whether
    they are .ez or dirs.
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#118562759]

commit 4b23681c986269ea86e49b528e7c145b12c66280
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Mon Dec 19 12:23:23 2016 +0000

    Accept list of #plugin records or atoms in maybe_keep_required_deps
    
    Signed-off-by: Jean-Sébastien Pedron <jean-sebastien@rabbitmq.com>
    
    [#118562759]

commit 6caabb89c9bd33c667f4279a27297447632e1573
Merge: d4ed3c98c 12aa662f7
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 19 14:34:51 2016 +0300

    Merge pull request #1063 from rabbitmq/rabbitmq-server-1057
    
    Create RABBITMQ_GENERATED_CONFIG_DIR

commit 12aa662f76ffe7c55783fe1f3c4b241c9c9072c2
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Dec 19 11:31:02 2016 +0000

    Create RABBITMQ_GENERATED_CONFIG_DIR

commit d4ed3c98cbb7f92271185e6830cc37dd473f2f7b
Merge: d4bbbead1 8fd90cb5d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 19 13:34:27 2016 +0300

    Merge branch 'stable'

commit 8fd90cb5d3fe608c8b9ca31665e435e06c5f73ed
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 19 13:32:25 2016 +0300

    Fix a condition test here
    
    We don't want to run a command here.

commit 8a98bdb0808840d2dbd3d70937cadfe2bdb3bb80
Merge: 806cd800b d4bbbead1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Dec 17 02:43:09 2016 +0300

    Merge branch 'master' into rabbitmq-server-567

commit 806cd800b055a660988c5b1da6ae388bb72fa3a7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 16 18:09:04 2016 +0000

    Replace dying_client_index and dying_clients set with a map
    Required to decrease ETS tables usage per vhost

commit d4bbbead10c128290b030f2769712dac666ab5f4
Merge: 559fe217a ba616d14f
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Dec 16 16:48:53 2016 +0100

    Merge branch 'stable'

commit ba616d14f49cefcda9bb06ca915464d5c19983e1
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Dec 16 16:48:08 2016 +0100

    Coerce global parameter key to atom on deletion

commit 559fe217a90dcfa68896b45751cd2edd74090974
Merge: 63ed10728 8b36c74d1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Dec 16 18:05:05 2016 +0300

    Merge branch 'stable'

commit 8b36c74d171f08d5e40fdb0cba5a6733239fe41c
Merge: 5f16a139c 03091a090
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 16 18:04:39 2016 +0300

    Merge pull request #1060 from rabbitmq/rabbitmq-server-1059
    
    Bump the default ets tables limit

commit 03091a090708f09e526e4379a8c66ed0c6effd93
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 16 14:18:33 2016 +0000

    Bump the default ets tables limit

commit 63ed107289d2012bc6bb7f57bd6f747b08ba8819
Merge: 93c876aba 5f16a139c
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Dec 16 09:58:01 2016 +0100

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_runtime_parameters.erl

commit 5f16a139c04c4338c4817295e0c0ee20c48c7706
Merge: 6a18f556d ee9a020e0
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 16 01:16:47 2016 +0300

    Merge pull request #1056 from rabbitmq/rabbitmq-mqtt-73
    
    Improve global runtime parameters support

commit 93c876aba1184e83811dd39a32b2d17913bc3a20
Merge: 3bb8bade8 6a18f556d
Author: kjnilsson <knilsson@pivotal.io>
Date:   Thu Dec 15 13:22:11 2016 +0000

    Merge branch 'stable' of github.com:rabbitmq/rabbitmq-server

commit 6a18f556dca9b3c28268958568d153e111e4de9d
Merge: 97f3f2a37 d5e2ed834
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Wed Dec 14 20:14:40 2016 +0000

    Merge pull request #1048 from rabbitmq/rabbitmq-auth-backend-ldap-7
    
    Timeouts for worker pool

commit 97f3f2a370bea2efaa05a140cfb27be788dba27b
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Dec 14 12:06:19 2016 +0000

    Be more specific about what is being stopped on `stop_app`
    
    Already implemented in the new CLI, planned to ship as of 3.7.0
    
    rabbitmq/rabbitmq-server#1043

commit ee9a020e0808d0aa0a04f0a1614ac76a57d03d72
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 14 16:24:38 2016 +0100

    List all global parameters
    
    Including the cluster_name.
    
    References rabbitmq/rabbitmq-mqtt#73

commit 065f72f8939ad3acd495697b6f9b09ff9227585a
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 14 15:13:54 2016 +0100

    Polish global parameters documentation

commit f18311aa7275769bb4f7bdc27bdfa639f03dc7a8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 14 14:00:17 2016 +0100

    Document global parameters CLI commands
    
    Part of rabbitmq/rabbitmq-mqtt#73

commit 3bb8bade8022db0e860f4ab084a02f5b571d0067
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Wed Dec 14 12:06:19 2016 +0000

    Be more specific about what is being stopped on `stop_app`
    
    Already implemented in the new CLI, planned to ship as of 3.7.0
    
    rabbitmq/rabbitmq-server#1043

commit 9323c28e80ee3964ef1f42976989c8b55ee8fdd2
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Dec 14 12:37:23 2016 +0100

    Coerce global parameter key to atom

commit 1a8e5c9e311f3f70e1b375f8d8bd727e60e763b8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Dec 13 14:55:57 2016 +0100

    Use atom key and JSON value for global parameters
    
    Part of rabbitmq/rabbitmq-mqtt#73

commit 321abd47ccc97d3de3b0bcae388ea30299fd47a6
Merge: f43990d05 21e8b3359
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Dec 13 08:39:04 2016 +0100

    Merge branch 'master' into rabbitmq-server-567

commit 21e8b335950b6871c71e5e3de54ea249fe4322f9
Merge: 1220bdb2e 157e79bf6
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Dec 12 17:33:16 2016 +0100

    Merge pull request #1055 from rabbitmq/recursive-mkdir-for-rabbitmq-schema-dir
    
    Recursively create `RABBITMQ_SCHEMA_DIR`

commit 9966bf207df0dd6999ff237f92de1c3731f6fc84
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Dec 12 17:22:09 2016 +0100

    Improve global runtime parameters support
    
    References rabbitmq/rabbitmq-mqtt#73

commit 1220bdb2eca2d077e5ce12252c6b5d03c7ae8bca
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 12 12:44:06 2016 +0100

    Travis CI: Import changes from rabbitmq-auth-backend-amqp

commit 157e79bf6d8a65f4c76c4ad1b9cf9103bb0ad285
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 12 14:08:59 2016 +0300

    Recursively create `RABBITMQ_SCHEMA_DIR`
    
    Just like we do with `RABBITMQ_PID_DIR`. Otherwise there is a warning
    emitted at node startup when the directory doesn't exist.
    
    Per discussion with @acogoluegnes.

commit 59fcbd90cd48d89ab69231cef2a61ea8f81f02e3
Merge: bd67bc366 4d3d1705e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 9 19:17:39 2016 +0100

    Merge branch 'stable'

commit 4d3d1705e835e2bad9b82ff10bbaee6f8130a2a9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 9 18:30:14 2016 +0100

    metrics_SUITE: Increase the timer after force_channel_stats()
    
    The change introduced in rabbitmq/rabbitmq-common#154 to restore
    compatibility with Erlang R16B03 and 17.x makes the cost of the first
    call(s) to rabbit_core_metrics more expensive.
    
    Increasing this timer allows the testsuite to succeed again.

commit bd67bc3669ce588c05be8999dbd86e54c7ee8a7d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 9 12:00:05 2016 +0000

    Double timetrap timeout for partition test to make CI happy

commit 3bb0ff39e1ef0aa20fa2cb11a45219f2ecf297a9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Dec 8 19:14:41 2016 +0100

    Update rabbitmq-components.mk

commit 31f368a4c20809d9392fbff18f58656acc693dc7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Dec 8 17:14:55 2016 +0100

    Travis CI: Use Ubuntu Trusty image to have access to Elixir
    
    Also, required `sudo` so a VM is used instead of a container. This makes
    the test much longer, but allows us to install non-whitelisted pacakges
    such as xsltproc.

commit 5e18fd1c674309c4a7aa3243955a2c29cbfae8f2
Merge: 07ccb1054 b517ef266
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 7 15:21:58 2016 +0100

    Merge branch 'stable'

commit b517ef26690f7a8891ccbdd013349f8baff80b05
Merge: 675cbaaff 386118c26
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 7 15:47:57 2016 +0300

    Merge pull request #1053 from rabbitmq/rabbitmq-server-1052
    
    Improve error reporting in rabbitmq-service.bat

commit 386118c2618f03cc78b4d36510057cb9f9ce6765
Author: kjnilsson <knilsson@pivotal.io>
Date:   Wed Dec 7 12:44:25 2016 +0000

    Exit with non zero exit code when erlsrv command fails during service install

commit 675cbaaffd261919d261d42c757555457711f98e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 6 15:50:06 2016 +0100

    Update rabbitmq-components.mk

commit b37686c46b474d34d287bb863989eb6effc8020b
Merge: e82c0641e d16b7347f
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Dec 6 16:18:16 2016 +0300

    Merge pull request #1051 from rabbitmq/rabbitmq-server-1050
    
    Coerce default_* configuration entries to binaries

commit e82c0641eebd2b542ec5d1aefa9eff3b371128d5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 6 13:45:18 2016 +0100

    Makefile: PROJECT_VERSION is set in rabbitmq-components.mk
    
    [#130992027]

commit 3311d2a628b98405a1c51fc6bd99d5f28fa13d4e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 6 13:36:23 2016 +0100

    Update rabbitmq-components.mk
    
    Remove PROJECT_VERSION computation from Makefile: rabbitmq-components.mk
    takes care of it.
    
    [#130992027]

commit 1bbbcbc76e747330b382f64831c746e2b5b62462
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 6 12:18:02 2016 +0100

    Move from .app.src to Makefile variables
    
    This is the recommended way with Erlang.mk.
    
    By default, the version is computed with git-describe(1) or inherited
    from rabbitmq-server-release when creating the source archive.
    One can override the version from the command line by setting the
    `PROJECT_VERSION` variable.
    
    One nice bonus is that `make run-broker` will present a meaningful
    version by default, and one can set the version with `PROJECT_VERSION`.
    
    [#130992027]

commit 945f2f48eb9c93f6edcb36a77fc5d782395ace9f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 6 11:31:07 2016 +0100

    rabbit: Use application description in banner
    
    ... instead of application id. They have the same value currently, but
    once we move from .app.src to Makefile variables, Erlang.mk will use the
    id for other purposes.
    
    [#130992027]

commit d16b7347f416e1edba03b49890780535280995b9
Merge: d3d1cfd73 a1fb615ff
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Dec 6 10:45:01 2016 +0100

    Merge branch 'stable' into rabbitmq-server-1050

commit d5e2ed834fd359626c5140c9f1608e836945d3ac
Merge: 8b7e898d4 59a0b3185
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Dec 5 20:57:33 2016 +0300

    Merge branch 'stable' into rabbitmq-auth-backend-ldap-7

commit a1fb615ff66b34a10d18c09268f0e399dfd9dea1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 5 18:00:15 2016 +0100

    Makefile: Remove $(VERSION), it is unused

commit d3d1cfd734c230974fafcc1db24652ec49c057c8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Dec 5 16:59:37 2016 +0100

    Coerce default_* configuration entries to binaries
    
    Namely default_user, default_pass, default_vhost, default_permissions.
    
    Fixes #1050

commit 07ccb1054d33a3e2d7646d7c6c42049abbd249f6
Merge: 7c848ca98 59a0b3185
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 5 15:35:31 2016 +0100

    Merge branch 'stable'

commit 59a0b318574b04bb844bb3d8c43007af9f4ab91c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 5 15:33:59 2016 +0100

    unit_inbroker_SUITE: Adapt channel_statistics() to the new metrics

commit 7c848ca98a57fb3645793d218cc4d508434cb566
Merge: 68fdb120e 87995fe67
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 2 18:23:24 2016 +0100

    Merge branch 'stable'

commit 87995fe675e7a618167d2edcb78d0fb2c6dc2474
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 2 18:20:25 2016 +0100

    metrics_SUITE: The helper module is called `rabbit_ct_proper_helpers`

commit 8b7e898d46846b02ce7ac918910219c52ceb3b33
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 1 18:00:43 2016 +0000

    typo

commit 964aacd8f19898e3cbcbce35429bbe3eb7ffe3d7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 1 13:38:43 2016 +0000

    reference type name

commit 28b843664ad2ebbb580a5066c3236877d9e25cf5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Sep 27 15:51:38 2016 +0100

    Timeouts for worker pool worker

commit 68fdb120e091c39319058f7956483c0160a0fb74
Merge: 445f44a4d 438bb3b26
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Dec 1 21:10:03 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_mnesia.erl

commit 438bb3b260f9b45a1115e0bb07547ecd079d52a4
Merge: ad04a73e8 c76fcdbe3
Author: Gerhard Lazu <gerhard@users.noreply.github.com>
Date:   Thu Dec 1 18:01:37 2016 +0000

    Merge pull request #1038 from rabbitmq/rabbitmq-server-1033
    
    Back ports #1022 (#1023) to stable

commit c76fcdbe365c304eeef59eae4b9327dea8f4646f
Merge: 3b7c05c8d ad04a73e8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 1 11:42:04 2016 +0000

    Merge branch 'stable' into rabbitmq-server-1033

commit 445f44a4db371b16c35f31667a3175d30697ff84
Merge: 8401de2f4 ad04a73e8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Dec 1 14:12:57 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit_log.erl
            src/rabbit_vm.erl

commit ad04a73e8ba3157e8b737f1521b1c4946c1d30e6
Merge: c21608770 0a5d5689a
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Dec 1 14:03:08 2016 +0300

    Merge pull request #1034 from rabbitmq/rabbitmq-management-236
    
    Make statistics collection distributed

commit 8401de2f41fad32a887a648265faf9b32542b0f1
Merge: 920f42835 f565f251d
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Nov 30 22:11:34 2016 +0300

    Merge pull request #1045 from rabbitmq/rabbitmq-cli-131
    
    Add function returning active plugins and versions

commit 3b7c05c8db27f19e993e5fc230954e3707af46bd
Merge: 4ca5396b5 c21608770
Author: Gerhard Lazu <gerhard@rabbitmq.com>
Date:   Wed Nov 30 17:37:05 2016 +0000

    Merge branch 'stable' into rabbitmq-server-1033
    
    Conflicts:
            rabbitmq-components.mk

commit f565f251dbe20366c6e5f886c22c363bdd0a3e7e
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 30 17:27:05 2016 +0100

    Do not call function in list comprehension filter

commit dfa40b0f3108259dad41ecb904ac58c6f63a5aa5
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 30 17:16:38 2016 +0100

    Add function returning active plugins and versions
    
    For rabbitmq/rabbitmq-cli#131

commit 0a5d5689af7ca86f32477b87f7b01538c3d1a24d
Merge: c88243cf4 c21608770
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Nov 30 18:48:21 2016 +0300

    Merge branch 'stable'

commit f43990d05f8c629e41e9f748d7e8f6963039905f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Nov 30 12:23:16 2016 +0000

    Make queue migration batch size configurable

commit cfc9a88d90dc24911a8ea7cafc1b4726d621ea77
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Nov 30 12:17:17 2016 +0000

    Write per queue upgrade log to a separate file

commit 920f428356c736d76cbabba4422f08896e8ee7e9
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 30 10:39:46 2016 +0100

    Use rabbit_semver instead of ec_semver
    
    ec_semver has been renamed into rabbit_semver in master.
    
    References #1016

commit 44910273005ebabb949f442cd5c7c4c0b703dc0a
Merge: b907d3468 c21608770
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 29 21:11:58 2016 +0300

    Merge branch 'stable'

commit c2160877085bf4755cac3a2338695597c136523f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 29 20:59:22 2016 +0300

    Update rabbitmq-components.mk

commit 2a80a4c33d237f875e264d683ee1f51d3286a68d
Merge: ee793bd49 deafa581a
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 29 19:39:00 2016 +0300

    Merge pull request #1044 from binarin/missing-socat-error-handling
    
    Properly handle systemd notify errors

commit 475e86b505d5b84e7140385692d0c80e33bca6fd
Merge: 55451523b b907d3468
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Nov 29 16:35:45 2016 +0000

    Merge branch 'master' into rabbitmq-server-567

commit deafa581a8ac73bef86a8ba5d9c198b9e03ef054
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Tue Nov 29 17:52:10 2016 +0300

    Properly handle systemd notify errors

commit b907d34689879da7e9f2f4991d61e344a48cce30
Merge: b2141bde4 a31bb2e16
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 29 15:29:57 2016 +0300

    Merge pull request #1042 from rabbitmq/rabbitmq-server-1040
    
    Add background GC settings to new config format

commit a31bb2e166229230b91a88ce206dae046d2c158c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Nov 29 15:28:39 2016 +0300

    Be more elaborate in background GC config example

commit 51b40693444d93d0fa18b764046fe6c7bd411ccb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Nov 29 15:27:48 2016 +0300

    Port a version from master
    
    Per request from @hairyhum.

commit cdbd5605c4a999d04010d94c58e6c8b321f54d03
Merge: 39df722a3 ee793bd49
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Nov 29 15:12:28 2016 +0300

    Merge branch 'stable' into rabbitmq-server-1040

commit 39df722a3e471be3d40dc24cb391317f16e9d4a0
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Nov 29 10:25:32 2016 +0100

    Add background GC settings to new config format
    
    Fixes #1040

commit 55451523b84168ceeb36398f7a8e6734b35e969a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 28 16:27:45 2016 +0000

    Migrate queues in batches of 100 in parallel. Write recovery terms for migrated queues.

commit 03bdc78d54c0bf1c1c9b8bf7fa544ef511d08a17
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 28 15:56:10 2016 +0000

    Keep backup between mnesia upgrade and message store upgrade

commit ee793bd498ff8e7ea29a94725dba5b808c01995f
Merge: e184cb083 0a6c74ba8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Nov 28 15:19:13 2016 +0100

    Merge pull request #1039 from rabbitmq/rabbitmq-server-1026
    
    Make it possible to disable background GC

commit 0a6c74ba821ba932f16bfe3ee013c43d0fac6dca
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Nov 28 15:16:15 2016 +0100

    Add background GC settings in example config
    
    Fixes #1026

commit 5f04225397fd7f752ab83f8dbf3c2a56ba7a455d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Nov 28 15:28:57 2016 +0300

    Make it possible to disable background GC
    
    and make the interval configurable via config file.
    
    Kudos to Kyle O'Donnell and his team for contributing
    a patch that was included with minor modifications:
    https://groups.google.com/forum/#!topic/rabbitmq-users/gdqLpdWbop0.
    
    Fixes #1026.

commit c88243cf41a0aa4f23c642616eb5a342cebbf943
Author: kjnilsson <knilsson@pivotal.io>
Date:   Fri Nov 25 15:44:11 2016 +0000

    Ensure extra stats info is also passed to core metrics

commit 4ca5396b5d77b39a6de518c7ae580d1591ae2b84
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Nov 7 21:37:41 2016 +0300

    Timeout values are in milliseconds

commit 192d5792e3679c04d196cba6c33fc67d8eb24ef6
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Nov 7 17:17:24 2016 +0000

    Log the number of retries left

commit 800eb4c52cf6bbdbac64a9fe28ae18cfa89a8339
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Nov 7 16:54:39 2016 +0000

    Log Mnesia reconnection attempts

commit 602719721962f2112e4e1d5cd131ce5e562cc459
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 25 10:50:52 2016 +0100

    Update rabbitmq-components.mk

commit a4f85212db5419559d5e35cf97ea0177b1576000
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Nov 4 15:05:51 2016 +0000

    Configure member retries on Mnesia reconnection failures
    
    (cherry picked from commit a5f4572243f2667c22385dd8f4eb32f94a9e2452)
    Signed-off-by: Michael Klishin <michael@rabbitmq.com>
    
    [#134685209]

commit e184cb08323a7ff14706aaefd033a0ff92dce2e5
Merge: b4d8d27e4 05ca97d35
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Nov 25 10:44:30 2016 +0000

    Merge pull request #1016 from binarin/multiple-plugins-dir
    
    Support multiple plugins directories

commit b2141bde48add4f3281e5667c8d7835dbd62601a
Merge: c1a0683a7 b4d8d27e4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 25 10:53:44 2016 +0100

    Merge branch 'stable'

commit b4d8d27e4bb6157d4781e167ab764dff37fabd07
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 25 10:50:52 2016 +0100

    Update rabbitmq-components.mk

commit c1a0683a711f42fe8efff51a53aacc29366ba218
Merge: b98bfcf3f 33b242dee
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 25 10:11:52 2016 +0100

    Merge branch 'stable'

commit 33b242deef8c13d2339ef3dbe01521d9e7d1c60a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 25 10:08:13 2016 +0100

    Update rabbitmq-components.mk

commit b98bfcf3fd07ea65926246e9ce329331e3240b97
Merge: d6e9f16c2 b58f6dcdc
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 24 22:11:02 2016 +0300

    Merge pull request #1037 from rabbitmq/rabbitmq-common-139
    
    Move mochi licensing info to rabbit_common

commit 05ca97d35e9be8e298008f264a9b317f218e2c2c
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Nov 24 18:52:09 2016 +0300

    Report pending upgrades when listing plugins
    
    It's implemented with additional RPC call to
    `rabbit_misc:which_applications/0` to preserve backwards compatibility.

commit 944e0f476b2055e9a74be31aa7d193dd6569863a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Nov 24 15:49:52 2016 +0000

    Fix vhost dir location in test

commit c3ae58154b231c81a341358ef2db438f316be578
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Nov 24 15:10:33 2016 +0000

    Rollback to sequential queue migration. Move queue directories before migrating messages

commit b58f6dcdc802bea6d3790a9db43f43da33be69dc
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Nov 24 16:07:58 2016 +0100

    Move mochi licensing info to rabbit_common

commit bfd14dd7ff1a7eb28c00a44d5d52887f42cd603d
Merge: 1bd0fa11a beb8e52c3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 24 12:00:42 2016 +0100

    Merge branch 'stable' into rabbitmq-management-236

commit d6e9f16c202935341fd2f7550280eb5304f7be67
Merge: 30399c0c2 77c428c8b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 24 14:00:31 2016 +0300

    Merge branch 'stable'

commit 77c428c8bb12dba998194f45afe41a0fbfc6df35
Merge: beb8e52c3 025f9d761
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 24 13:56:47 2016 +0300

    Merge pull request #1036 from rabbitmq/rabbitmq-server-1035
    
    Termination of queue master fails with `{badmatch,{error,not_found}}`

commit 30399c0c2cc170cb409221c1cffef1743b729c2b
Merge: 283e4d0c9 beb8e52c3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 24 10:13:11 2016 +0100

    Merge branch 'stable'

commit beb8e52c3648c06340c4c1d6b573a2570d4ee0dd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 24 10:12:30 2016 +0100

    Add rabbitmq_ct_client_helpers to TEST_DEPS

commit 025f9d7611dd0caf4ea86b8129fc75fedae33b92
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Nov 24 07:40:57 2016 +0000

    Move rabbit:prep_stop/1 to stop/1 to avoid master termination crash

commit 283e4d0c9547597b2270d5f868610fb194b4de63
Merge: 90d640207 8bbe9ad3b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 23 18:12:23 2016 +0100

    Merge branch 'stable'

commit 8bbe9ad3bd83f45a82401068eb7429cfcda42e76
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 23 18:05:57 2016 +0100

    Update rabbitmq-components.mk

commit 3542d80dfc102170c591639361d41288a853e3c7
Merge: c135b70c4 90d640207
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Nov 23 16:17:21 2016 +0000

    Merge branch 'master' into rabbitmq-server-567

commit 0108d509a7210509889345b961e4011c0e4682d8
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Oct 28 20:50:22 2016 +0300

    Support multiple plugins directories
    
    And provide some packaging-friendly defaults on Unix.

commit 90d640207e1f6d8d0956019fd799412677e8a965
Merge: 6a9e3e6d0 24155e5a5
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Nov 22 16:27:25 2016 +0000

    Merge branch 'stable'

commit 24155e5a5edbfcc2d983ee98aa82ed0c778a6228
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Nov 22 16:17:44 2016 +0000

    Update erlang.mk

commit fc6b333e19bfd17bcb2d7d87eb72ec2303f5df4f
Author: Gerhard Lazu <gerhard@lazu.co.uk>
Date:   Tue Nov 22 16:16:26 2016 +0000

    Update rabbitmq-components.mk

commit 6a9e3e6d0c12042cc47fbb886a97901bdc5fd1f5
Merge: fd69c99db a19f4a680
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 21 16:23:37 2016 +0000

    Merge branch 'stable'

commit a19f4a680dfdff7d4bedda8e19d924608d87b5b5
Merge: 3be6cd4bb 4021f7c76
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Nov 21 16:18:19 2016 +0000

    Merge pull request #1032 from rabbitmq/rabbitmq-cli-118
    
    Move rabbit_pbe module to rabbitmq-common

commit 4021f7c76a0ac96a38b381aeca1c36fd2723946d
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Nov 18 16:02:52 2016 +0100

    Move rabbit_pbe module to rabbitmq-common
    
    So new CLI can use it.
    
    References rabbitmq/rabbitmq-cli#118

commit fd69c99db2ee7b6f4f0c615f2fda3ff6ac32743f
Merge: c53ac3f20 5df678db8
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 17 21:55:32 2016 +0300

    Merge pull request #1031 from rabbitmq/rabbitmq-server-1030
    
    Use binaries to define policies

commit 5df678db80f73446987ad3db8738334efde7162b
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Thu Nov 17 09:47:17 2016 +0100

    Use binaries to define policies
    
    Fixes #1030

commit c53ac3f20bc0b58b08ccec428902b1d6de4f3e75
Merge: 6c0fdd3a7 01f526dd8
Author: D Corbacho <diana@rabbitmq.com>
Date:   Mon Nov 14 14:36:14 2016 +0000

    Merge pull request #1008 from rabbitmq/rabbitmq-server-988
    
    DNS peer discovery backend

commit c135b70c4690ddf3fdbafb9e0a8191cb2312eaae
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 14 13:11:13 2016 +0000

    New dir path for queue index data

commit 01f526dd8b43b8f3e85c6b5e808c27078eeb216e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Nov 14 15:25:49 2016 +0300

    Improve logging

commit 6c0fdd3a7f0aa938c2a3606beae8227e0a3d3069
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 14 11:53:04 2016 +0100

    Update erlang.mk

commit 36ff2bf650f42151418f9b4b5a6ad1635f4a883f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Nov 13 19:59:29 2016 +0300

    Update config examples

commit 77567c95c7d2a50acc9deaacb81fa793b6c1821f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Nov 13 04:31:40 2016 +0300

    Integrate DNS peer discovery backend, more logging
    
     * Returned value must be a list of atoms
     * Support more tuple types in normalize/1
     * Update tests

commit 93876aef692a9ec0f7ba9fe693b32885e9b3c0e1
Merge: 634bda9a4 a86d04097
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Nov 13 02:58:21 2016 +0300

    Merge branch 'master' into rabbitmq-server-988

commit f6feb6ba16e9132194a991ef233c663a734f4e24
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Nov 13 02:57:13 2016 +0300

    Cosmetics

commit 7a84a2492f541166591eee8f412c09911b4e13ab
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Nov 13 01:01:09 2016 +0300

    Towards functional message store migration fn

commit 245fd0804d451cef7f55a07e517b8ba176294e82
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Nov 12 17:13:09 2016 +0300

    Fix test expectations, more renames, more logging

commit 460d413aca94ce0bd68200efa2edefbfef2f1cbe
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 11 21:30:29 2016 +0300

    We get a tuple from ETS here, not just a pid

commit 1643c344b872ee43317928f6e579adb568cb45db
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 11 20:32:23 2016 +0300

    Renames

commit eea4fc3fd423d2b5c624ecf440e7bfcbed6ff044
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 11 20:08:38 2016 +0300

    Use a fixed size encoding fn for vhost directory names

commit cc75e5672ad23b63fb7c1f93e263b706a95d0cf6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Nov 11 18:00:36 2016 +0000

    Avoid atom exhaustion in vhost message stores

commit 0b37027731d14c22e8aa0b9e45d7c3281b304509
Merge: 05e9dbebf a86d04097
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Nov 11 15:17:52 2016 +0000

    Merge branch 'master' into rabbitmq-server-567

commit 05e9dbebf54711bc5e13baa0da9f08fb5f738b91
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 11 16:59:36 2016 +0300

    Naming and cosmetics

commit a86d04097367ba94a615944614d261321af26853
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 10 16:56:24 2016 +0100

    Update rabbitmq-components.mk

commit 4837af6cd04ccb87b5e2399495eff468fa99c1a3
Merge: 008c4eb7f 5c6d8e523
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 19:45:20 2016 +0300

    Merge branch 'master' into rabbitmq-server-567

commit 634bda9a4ddb156a1654b9eb912dba9afc6be411
Merge: 16b46a3ac 5c6d8e523
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 19:44:44 2016 +0300

    Merge branch 'master' into rabbitmq-server-988

commit 5c6d8e523349bb7df418cfff52b99f173a7cc4c1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Nov 10 16:00:51 2016 +0000

    Export alarm function to avoid calling status/0 from cluster_status command

commit 16b46a3ac0de91b75291eb48d63f0bbca8abc913
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 18:07:14 2016 +0300

    Skip DNS peer discovery backend tests in offline environments

commit 8defad6fb4620ad61a96c1459b85ebddfdc7d763
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 16:43:15 2016 +0300

    Integration tests for rabbit_peer_discovery_dns
    
    As previously discussed with the team, instead of starting a node
    with customized resolution strategy (via `kernel.inetrc` [1]) and
    a local erl-dns [2] node we rely on pre-configured records in
    the rabbitmq.net domain.
    
    For offline environments we will make the test a no-op if it can't
    contact rabbitmq.net.
    
    1. http://erlang.org/doc/apps/erts/inet_cfg.html
    2. https://github.com/aetrion/erl-dns

commit 4c01ecd27e15da05d2a42abba0ba0ada9d3722d2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 04:28:34 2016 +0300

    Prefix hostnames discovered via DNS

commit 6eff8127f55b0e90bfb1460ce2e9b11d1717838c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 03:00:54 2016 +0300

    First cut at rabbit_peer_discovery_dns

commit 92c2d59b08115f39b281dd7b55eabfeb707e7565
Merge: cd9da9fe1 590d717a2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 10 00:53:52 2016 +0300

    Merge branch 'master' into rabbitmq-server-988

commit 008c4eb7f0a9b14838439db934eb98dbe7801dbb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Nov 9 12:22:34 2016 -0800

    Rename an upgrade function

commit 590d717a266922ce76e1b214ea1045408b2401bd
Merge: 69119fe72 5a79e0e79
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Nov 9 18:46:18 2016 +0300

    Merge pull request #1025 from rabbitmq/rabbitmq-common-46
    
    Switch JSON library to JSX

commit 69119fe7298b189ff20061a31a18e32cbdff1237
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Nov 9 13:02:39 2016 +0000

    Make sure rabbitmqctl is built when running tests

commit 5a79e0e79b39681257b29ac0b5a11d144f83c589
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 9 12:57:14 2016 +0100

    Add jsx to dependencies of Rabbit
    
    So it's not considered as a plugin.
    
    See rabbitmq/rabbitmq-common#46

commit e64d0e16019ebce893b9af5b7070c6e6c595c446
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 9 11:13:53 2016 +0100

    Use conversion module for JSON arguments in CLI
    
    See rabbitmq/rabbitmq-common#46

commit c18ecb33acd97920ef19d5f04f408b0c90659664
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 9 10:55:54 2016 +0100

    Accept both lists and binaries for JSON arguments
    
    See rabbitmq/rabbitmq-common#46

commit f3dd0f0a27313649c9ae132620efa0cfab8e77d3
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Nov 9 10:22:07 2016 +0100

    Fix JSON arguments parsing in CLI
    
    See rabbitmq/rabbitmq-common#46

commit db3515ba7855dae6fdce4e6fc622fc9e1bdda75a
Merge: fa8784fe7 81e2170a6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 8 19:08:23 2016 +0100

    Merge branch 'rabbitmq-cli-integration'

commit 81e2170a6c6f4d4835e7731a9d251f5eadd060ce
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 8 17:16:37 2016 +0100

    rabbitmq-plugins.bat: Use `escript.exe` to run `rabbitmq-plugins`
    
    [#131353583]

commit 4348467a93ff70f606367fbf4e90abbb064f03e1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 8 17:14:24 2016 +0100

    Makefile: Rename target to `copy-escripts`
    
    ... so it looks like other targets.
    
    [#131353583]

commit 2c66f2874af3ee71e33d0072691b5ebaefdde16d
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Nov 8 15:44:55 2016 +0200

    Update the list of magic plugins for rabbit_vm

commit e96011f719f8f4565abc22930f9de5749974e7f9
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Nov 8 15:44:40 2016 +0200

    Remove reference to mochiweb_http in diagnostics

commit fbba13e03ea30c94554ba8836231dc6f38438302
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Oct 11 12:23:26 2016 +0200

    Switch JSON library to JSX

commit 560ade437bb37cee7055c1a86f50396fa91eb849
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 8 12:00:13 2016 +0100

    Makefile: Build rabbitmq-cli *before* copying escripts
    
    [#131353583]

commit fa8784fe7c343992cc3591b0d0353e560d252067
Merge: c30a4d92e 86c075538
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 7 21:38:52 2016 +0300

    Merge pull request #1023 from rabbitmq/rabbitmq-server-1022
    
    Configure member retries on Mnesia reconnection failures

commit 86c075538a31a79973f46e94b57d066e5d6d24e9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Nov 7 21:37:41 2016 +0300

    Timeout values are in milliseconds

commit fe91a65f524d91c5bc460ce62fb5cd3c69289ae4
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Nov 7 17:17:24 2016 +0000

    Log the number of retries left

commit 70e523b25e600b3d4386d079f1151d65519fdd69
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Nov 7 16:54:39 2016 +0000

    Log Mnesia reconnection attempts

commit 02ffdc34f2191075d0b687522a53ba43d6eaaf65
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Nov 7 12:03:18 2016 +0000

    In development environment, check for ENABLED_PLUGINS_DIR for rabbitmqctl too

commit a5f4572243f2667c22385dd8f4eb32f94a9e2452
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Nov 4 15:05:51 2016 +0000

    Configure member retries on Mnesia reconnection failures

commit f58e6d857dbef0f3d5f267d9276dfac54b737f3d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Nov 3 11:44:26 2016 +0000

    Windows integration for plugins and diagnostics

commit cd9da9fe1ca76eaec2d72afb402ff5c2afefaaa2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Nov 3 09:15:47 2016 +0000

    Introduce autocluster.peer_discovery_backend
    
    If it's not configured, don't generate autocluster.node_type.

commit 81a67aecf1a256256ee35997bd2da7135ad425d5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Oct 31 11:37:34 2016 +0000

    Use the new cli in windows rabbitmqctl

commit c30a4d92e5007ebc857cc1dade66c8c4d3284d1a
Merge: 4e1ad5305 3be6cd4bb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 29 19:26:20 2016 +0300

    Merge branch 'stable'

commit 3be6cd4bb31f4a7a99fe1e5cd4652766a08c3c40
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 29 19:26:06 2016 +0300

    Link to website source repo

commit 4e1ad5305aa05a55edaedd3c12ea8ed8766af47b
Merge: 0e2e03fab 35c970be7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 29 19:25:18 2016 +0300

    Merge branch 'stable'

commit 35c970be7de6c909ff6ff018c8ad35a38347c52f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 29 19:25:08 2016 +0300

    Update README.md

commit 0e2e03fab9f93cd6e391dea4aef5f489c3654813
Merge: 58f57d5b2 e93b8c025
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Oct 29 19:24:36 2016 +0300

    Merge branch 'stable'

commit e93b8c025ddc06fe68395ef0ee7b50d2533ebbbb
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Oct 29 19:22:39 2016 +0300

    Update README.md

commit b2b4215c713875df4705711595a1146712cd922e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 27 14:49:02 2016 +0100

    Add escript folder to store build ctl escripts

commit 58f57d5b214c755e119be3a7c1ce56187b020be2
Merge: a94a002c2 d98a66a6a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 19:56:18 2016 +0300

    Merge branch 'stable'

commit d98a66a6ac2a612d5db9ad3763ae4028ab203a34
Merge: e0866b7c2 7cb4835a7
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 26 19:55:59 2016 +0300

    Merge pull request #1012 from rabbitmq/rabbitmq-server-960
    
    Ignore unknown ack

commit 7cb4835a7f3bee6c42d3469a14b7acd0bbe9ea56
Merge: ed1ef0aa2 e0866b7c2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 18:07:16 2016 +0300

    Merge branch 'stable' into rabbitmq-server-960

commit a94a002c27a6a3c7e66f967acabbf7cbfbe7c7ff
Merge: 324c81b97 e0866b7c2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 18:06:52 2016 +0300

    Merge branch 'stable'

commit e0866b7c2ecb50c13bd137eb3d5600816f9ad96d
Merge: 47916838a 79b2ecb53
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 26 18:06:30 2016 +0300

    Merge pull request #1011 from rabbitmq/rabbitmq-server-972
    
    Avoid duplicates in members list during partial partition

commit ed1ef0aa2b545f64cbde5ef018c6386f90a9bc19
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Oct 26 14:59:12 2016 +0100

    Ignore unknown ack

commit 324c81b972ba2c742ef84391fb70bec6f2851cd7
Merge: 1fb0b1ed8 47916838a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 06:17:23 2016 -0700

    Merge branch 'stable'

commit 47916838a759be87efe3acf2db910600f51603d8
Merge: d36b6391d 0cd55eb2b
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 26 16:14:13 2016 +0300

    Merge pull request #1009 from rabbitmq/rabbitmq-server-1006
    
    Stop master in receiving sync_start from another master after partition

commit 79b2ecb53fbfed394485a86a7f27308897c825c3
Merge: 03725d2d1 d36b6391d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 16:13:14 2016 +0300

    Merge branch 'stable' into rabbitmq-server-972

commit 1fb0b1ed848092186022c83f94d549bdb0ccef4a
Merge: 3ad0b674c d36b6391d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 26 16:12:43 2016 +0300

    Merge branch 'stable'

commit d36b6391d04de5120418368e621dc12f97cc4012
Merge: 3906b1bfd 1dd5afb1f
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 26 16:12:15 2016 +0300

    Merge pull request #1010 from rabbitmq/rabbitmq-server-1007
    
    Ignore policy_changed on slaves

commit 2c6fb996a8c8839cde8a75bb388f0bc9038cd1fd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Oct 25 17:29:12 2016 +0100

    Integrate escripts from rabbitmq_cli on make

commit 672d0c156b036047010feda8ba787bbad4c699e9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 25 17:50:02 2016 +0300

    Initial DNS backend config schema support; decouple autocluster node type key
    
    Since node type won't vary from backend to backend we should pull it up
    to `autocluster.node_type`.

commit 1dd5afb1fc18ee607ea7b2d9eda0a62c6f6865d6
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Oct 25 13:51:41 2016 +0100

    Ignore policy_changed on slaves

commit 0cd55eb2b1d8b3e482bb19d85d304acb26b18304
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Oct 25 13:44:55 2016 +0100

    Stop master in receiving sync_start from another master after partition

commit 03725d2d1c3b225510d5e7e780656a0fbe2b7ba1
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Oct 25 13:31:55 2016 +0100

    Avoid duplicates in members list during partial partition

commit 36f3e6791cb12ba5ab448a330baa11b3eae64e9a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 20 11:10:39 2016 +0100

    Purge vhost storage in transaction

commit 8a45f409c3177505b342ad33f0c3d84cb04359db
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 20 11:07:04 2016 +0100

    Migration to per-vhost store message

commit 1c81c509d738b9ba85baf48f579b734468d72c2d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 20 11:04:52 2016 +0100

    Move queues to vhost storage on upgrade

commit 8369950c887c817a2096a3c2fdc941e32547ebce
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 19 17:56:33 2016 +0100

    Allow restart of a vhost message store. purge_messages function to clean message storage (together with message indexes) for a vhost

commit fd4db66c2c65b2de20b81ef89bc7a87dcea0f209
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 19 17:47:04 2016 +0100

    Terminate message store ignoring file save errors

commit 4f12ebeb53c72d25ecb9f1b5bf0feda1fcf4523f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 19 14:45:52 2016 +0100

    Tests for per-vhost message store. Stop vhost message store when deleting vhost

commit e6c76fd377c92cd9c4e1cdd6ab6ed6da785a9271
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 19 11:16:34 2016 +0100

    Queue index per vhost location

commit fdd7b871df020cd138623bd8bffab7077440cbd5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 2 15:13:39 2016 +0100

    Updated tests to support per-vhost message store

commit 460abf24db53b0137271cb24db41ec520fabc75b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 2 13:40:34 2016 +0100

    Update tests

commit 93ba24b4327ab66c288a10fcfe1d131e53dcd477
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 21 16:22:02 2016 +0100

    Moved directory selection to vhost_dir function

commit d1f4a9d302c2ad319c58d7aa8aa21e1bc90aa4b5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 21 14:20:39 2016 +0100

    Remove duplicate migration. Match no_ack message

commit 325e2fcd8a66a2db702e819cc8da1bafde4ac8ed
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 21 13:19:18 2016 +0100

    New upgrade scope `queues` started by boot step before queue recovery

commit 492e23bf188820756e07076c4539692376cfcbc6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 20 17:54:24 2016 +0100

    wip: migrating to vhost base messge store

commit b3fc71af45e53633c69a045e65cfe01e110aa9c5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 19 18:07:17 2016 +0100

    wip

commit d1bffd00f326c4e43cbfaadc20a306d1a598ac9a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 19 17:02:52 2016 +0100

    Work in progress: Migration to vhost based message store

commit ec15e971cfc8a44b5279f5b8350663cb373b4c1c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 6 12:28:02 2016 +0100

    Migration algorithm

commit 80436dfaef0366d48f1e8b1293e1a12a5e922c79
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 10 16:39:05 2016 +0000

    Starting and restarting app

commit abaa77062e27688f984ba8cb914ca69a9cb5e2e6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 10 13:29:08 2016 +0000

    message store supervisor

commit 3ad0b674caaa7a898f525933590acfd4f0d99d3c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Oct 20 14:33:13 2016 +0100

    Do not fail on {cluster_nodes, [node()]} config

commit c1737b73cdc71c7c6f7de94bf7508e7c79f0cc40
Merge: 81a360c46 3906b1bfd
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Oct 17 15:20:13 2016 +0200

    Merge branch 'stable'

commit 3906b1bfd21c83ba33ef5de491a993f8d4d9fc03
Merge: 9ee645a28 360bc947e
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Mon Oct 17 13:58:56 2016 +0100

    Merge pull request #999 from rabbitmq/rabbitmq-website-282
    
    Document configuration encryption

commit 360bc947ec1c7ed17ed2fb4291f245cea2dfeea5
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Oct 17 12:05:56 2016 +0200

    Change formatting for rabbitmqctl help

commit 6101e8fa7cc9ad817040306e6e994344f30b0350
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Oct 17 11:03:30 2016 +0200

    Document configuration encryption
    
    References #979
    Fixes https://github.com/rabbitmq/rabbitmq-website/issues/282

commit 81a360c460ce7671eac99844871974f7c303ada1
Merge: ad09a27f9 9ee645a28
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Oct 14 14:59:28 2016 +0200

    Merge branch 'stable'

commit 9ee645a281c3006850e111b898fd9cf6b6214bd1
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Oct 14 14:58:06 2016 +0200

    Remove version_equivalance entry from test group

commit ad09a27f9a80fbf596f61574cff29f1bba79bd79
Merge: 32762100e 44e719829
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Oct 14 14:50:28 2016 +0200

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit.app.src

commit 44e7198298f984974e6c4e13e3d55d2aa685f455
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Oct 14 14:46:02 2016 +0200

    Use config_entry_decoder key for config encryption
    
    Fixes #979

commit 32762100e8b9b7a36d681fa59602c3fa9e065a31
Merge: 3769343e7 23d84850f
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Fri Oct 14 14:30:39 2016 +0200

    Merge pull request #989 from rabbitmq/rabbitmq-server-486
    
    Switch config-driven autoclustering to rabbit_peer_discovery_backend

commit 3769343e713d52a5a3cb6a9218686432831e06e4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Oct 14 12:06:27 2016 +0100

    Support x.y in plugin versioning

commit b3064b4cc39a46528a53e334c7ae27fd73dfea9a
Merge: fdd9f295d fc20fa9b0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Oct 14 12:05:53 2016 +0100

    Merge branch 'stable'

commit fc20fa9b03a232364bf4f7487d51f01e767d1ba3
Merge: ae67c3e12 73eb4d6f9
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Oct 14 12:04:20 2016 +0100

    Merge pull request #997 from rabbitmq/broaden-version-format-support
    
    Move version equivalence tests to common

commit 23d84850f8fe3d4b7f99c7635f0b81eab312bbbf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 14 07:35:04 2016 +0800

    Be more defensive and accept 'disk'

commit 0454457f4ef429d6b9d0337aa43fa738da3b5d72
Merge: 45c728a4a fdd9f295d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 14 07:32:40 2016 +0800

    Merge branch 'master' into rabbitmq-server-486
    
    Conflicts:
            src/rabbit.app.src

commit 45c728a4a5b637521a17f0472ed29a2a4187763a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 14 07:31:40 2016 +0800

    2016, even

commit 73eb4d6f9b9a87b8c2fc530c8803c126f5ebdefd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 11 17:37:20 2016 +0100

    unit_SUITE: move version equivalence tests to common
    
    [#131650399]

commit fdd9f295d8b33a0774b3fa1f9753ff044fcfee15
Merge: 471e1dc70 ae67c3e12
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Oct 12 16:14:36 2016 +0200

    Merge branch 'stable'
    
    Conflicts:
            include/rabbit_cli.hrl
            src/rabbit.erl

commit ae67c3e121322f70a10359675786adb4df7baddb
Merge: 157cdaa0d c5991c696
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Wed Oct 12 14:44:36 2016 +0100

    Merge pull request #994 from rabbitmq/rabbitmq-server-979
    
    Add optional password based encryption of configuration values

commit c5991c696f7a5751af1899729ff5a15b1f58950e
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Wed Oct 12 15:37:27 2016 +0200

    Add better message when decryption fails in config

commit 471e1dc702d0af4419119feb443a629ea8f3b8b9
Merge: ce111d7f9 9207d7b41
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Oct 12 13:20:59 2016 +0100

    Merge pull request #996 from rabbitmq/rabbitmq-server-987
    
    Change config schema for the classic autoclustering backend

commit 9207d7b413b0aecc4671081e4881b68ea5c3eb67
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 12 13:18:00 2016 +0100

    Support `disk` node type. Test ignore of node_type if there is no nodes

commit 697425f470dc19fac17f20d3c816b5d9e0f3cf6c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 12 13:09:42 2016 +0100

    Ignore *.schema files in test dir. Copy them on setup

commit 92cdd72f8caa7e968c89143247df1883ba656975
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Oct 12 12:08:35 2016 +0100

    More tests for cluster config

commit c900c50e40676793bc22e8784a121102a813210f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Oct 12 13:14:04 2016 +0300

    Change config schema for the classic autoclustering backend
    
    Fixes #987, references #486, #487.

commit 172c158b94b3f4bf4a9b1f7ed622f7b83164d5c1
Merge: 82036e045 157cdaa0d
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Oct 11 17:25:50 2016 +0200

    Merge branch 'stable' into rabbitmq-server-979
    
    Conflicts:
            src/rabbit.app.src

commit 82036e04518ef1033e6f23f51803edd163638c94
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Oct 11 16:13:36 2016 +0200

    Create tests for rabbitmqctl encode

commit 65b0d3355e0880ec2b47a68fa3523656f7e2a390
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Tue Oct 11 12:00:52 2016 +0200

    Use terms in rabbitmqctl encode

commit 7e1ea9d5c1a137b27d0f3ed018b32f33060dabb8
Author: Arnaud Cogoluègnes <acogoluegnes@gmail.com>
Date:   Mon Oct 10 12:25:47 2016 +0200

    Add encode command to rabbitmqctl

commit 1bd0fa11a08e311718d0c0162ab38aa646068790
Author: kjnilsson <knilsson@pivotal.io>
Date:   Fri Oct 7 13:33:13 2016 +0100

    Inline function specs in rabbit_log

commit d827dbad50c4e7c4c4b93545ac523137412b7f14
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Oct 6 17:17:54 2016 +0200

    Remove a pointless comment

commit 61250711fe23df9a4b3980fdc2f133eef7aa805e
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Oct 6 17:14:51 2016 +0200

    Add a test for decrypt at start without passphrase

commit 34e264740a25cecc5da5b6ede1704717daadda4b
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Oct 6 17:06:21 2016 +0200

    Add tests for decrypting at application start

commit 11307a2f3ef6edc7cb74ed53ef5203fe34bb55cd
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Oct 6 16:24:26 2016 +0200

    Add a test to decrypt environment values

commit ce111d7f9f116c2e873edc12985b9d2896f6b4be
Merge: 41bfe8f02 25aeb3591
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 6 18:01:34 2016 +0400

    Merge pull request #985 from rabbitmq/rabbitmq-management-289
    
    Vhost limit API functions to set/list/clear specific limits

commit 557c27efb5c9206b8ab77a6c2e6bacb20c63a09b
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Oct 6 14:51:10 2016 +0200

    Add configuration for decrypting hidden configuration values

commit 157cdaa0d0c9b7753fbfcb2dba37cd48b8101407
Merge: 75795f977 c1c56a29b
Author: Andrew Bruce <me@andrewbruce.net>
Date:   Wed Oct 5 15:27:00 2016 +0100

    Merge branch 'rabbitmq-server-990' into stable

commit c1c56a29b098b7c5ad0915a340a2a039e61a22a3
Author: Andrew Bruce <me@andrewbruce.net>
Date:   Wed Oct 5 15:21:47 2016 +0100

    Choose master from intersection of sync slaves and policy nodes
    
    Previously, when applying an HA policy with the 'nodes' type, if the
    current master was not part of the new policy, then the first
    synchronised slave was chosen as the new master. This would happen even
    if the node was not part of the new policy.
    
    For example, if we began with:
    
    Master A
    Slaves [B, C]
    
    Then requested a new policy of just [C], we'd end up with:
    
    Master B
    Slaves [C]
    
    Instead, choose the master from the intersection of (nodes in
    the policy) and (synchronised slaves).
    
    Issue #990
    [#126767013]

commit 41bfe8f020f62871f02f41e236d6458ef969d9f2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 4 16:53:01 2016 +0300

    Drive-by change: reduce log noise
    
    Don't log connection tracking table creation failures
    where the error is "the table already exists".

commit f75bc0971ea24efc67ca42a9e3d81de32f6691ca
Merge: 8b500cd2e a980106a8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 4 16:59:16 2016 +0300

    Merge branch 'master' into rabbitmq-server-486
    
    Conflicts:
            src/rabbit.app.src

commit 8b500cd2ef48787bff4208c6abfd2e95ca1e7531
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 4 16:54:00 2016 +0300

    Switch config-driven automatic clustering to the new behaviour

commit d9cb0050d82a85d4f9a2ea72f28143c2946b798a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 4 16:53:01 2016 +0300

    Drive-by change: reduce log noise
    
    Don't log connection tracking table creation failures
    where the error is "the table already exists".

commit 25aeb359102ad4673b35e187fe70df693af68c21
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Oct 3 13:03:40 2016 +0100

    Vhost limit API functions to set/list/clear specific limits

commit a980106a85afd40b9f773feba1d2a0ef626655ef
Merge: 424d0aefc 75795f977
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 30 00:15:07 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/pg2_fixed.erl

commit 75795f977c8b96fa580d58cd9bda049e312b2044
Merge: 42d20f6c5 e9d7488d6
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 30 00:55:13 2016 +0400

    Merge pull request #978 from rabbitmq/rabbitmq-server-973
    
    Add VM GC calls configuration for lazy queues

commit 42d20f6c5b81a83810d26c439930e826e351358c
Merge: 29193f031 f3c43f05a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 30 00:53:48 2016 +0400

    Merge pull request #981 from rabbitmq/rabbitmq-server-980
    
    Remove `pg2_fixed`

commit 3a2d1395cd63a6fe5f08d9a62bd06affda5ec521
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Sep 29 17:53:51 2016 +0200

    Add comments

commit 8edcd88d01b5e3cef565219272d48e5f01d4e969
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Sep 29 17:53:28 2016 +0200

    Add rabbit_pbe:encrypt_term and decrypt_term

commit f3c43f05a968229da5bdce0ede60924900fb64ba
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 29 15:36:31 2016 +0200

    Remove `pg2_fixed`
    
    We now use the standard `pg2` module.
    
    Fixes rabbitmq/rabbitmq-server#980.
    [#131354699]

commit 7cb692ea9f4b4ae871e9eb31aa67367f30b976f1
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Sep 29 16:49:15 2016 +0200

    Add rabbit_pbe module for password based encryption

commit 424d0aefc7aa580716c8d309742d8079a5b31623
Merge: 37e1d7509 29193f031
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 29 16:15:03 2016 +0200

    Merge branch 'stable'

commit e9d7488d6a83de115049e7ebb853bb8f0fa35b14
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 29 16:59:38 2016 +0300

    Use a name that's more to the point

commit 6ff4794537c3ceafefc26451450fe65467cd2fa5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 29 16:53:06 2016 +0300

    Naming, cosmetics

commit 29193f031840a6f306fb3cce724a80a74f0cfebc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 29 14:53:51 2016 +0200

    health_check_SUITE: Use a RabbitMQ nodename suffix

commit 32b6cb838105fe4efa56aad3d1496ec870f7d217
Merge: 1215682ac d0359ac82
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 29 10:58:53 2016 +0300

    Merge branch 'stable' into rabbitmq-server-973

commit 37e1d7509e8a4cf960c65970af56252993cbd4b0
Merge: b24fb4037 d0359ac82
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Sep 28 16:44:45 2016 +0100

    Merge branch 'stable'

commit d0359ac82ce8c3a8868800963c9163afe91456b6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Sep 28 16:44:22 2016 +0100

    Tests timing

commit 25de0db933521881673c3889865815abc82b75e7
Merge: e7ae83f5c a40b517c4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 27 11:20:29 2016 +0200

    Merge branch 'stable' into rabbitmq-management-236

commit b24fb403700f4708dc9b8f7abbfe09bdc56d7a00
Merge: a2ad24fae a40b517c4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 26 18:17:13 2016 +0300

    Merge branch 'stable'

commit a40b517c4f20be94bc007e83541e18a3da85b5f5
Merge: 6a27cb5fb 1ef16ba0c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 26 18:16:59 2016 +0300

    Merge branch 'rabbitmq-server-975' into stable

commit 1215682ac2896ddafee14ba4ea2ed6811882e5f9
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Sep 26 16:48:23 2016 +0200

    renamed run_count to gc_run_count

commit 5bbc6dd4d73aaf96173cc60a9ad7feb8ef695dc1
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Sep 26 15:07:27 2016 +0200

    defaul value for run_count

commit 1ef16ba0c52e450ae620a9545db6178672590128
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Sep 26 13:06:17 2016 +0100

    Stop syncer if there is no slaves to sync to

commit a2ad24faedc32eaca771db0f6a75a1a5282b311c
Merge: ec5d9a8c3 6a27cb5fb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 23 14:27:03 2016 +0200

    Merge branch 'stable'

commit c78daa7b6e239dde9f8c965ea81dfc325830efbe
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Sep 23 13:08:23 2016 +0200

    Make the GC calls configurable for lazy queues

commit 6a27cb5fb1dfecfdaf875842b50b1a2c6dc3a924
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 23 11:23:01 2016 +0200

    Update rabbitmq-components.mk

commit 32b9253b8e7b8e409e82eb001eca5cc853232e37
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 22 17:55:56 2016 +0200

    Update erlang.mk

commit 8ca7d84a0d402ad294c6ba031134a6a7f65b30a0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 22 17:36:10 2016 +0200

    Makefile: Move install recipes to rabbitmq-release
    
    [#130659985]

commit ec5d9a8c3d03fc7c035a624113b8a0136e17f2b4
Merge: 68cf2a5fa ed9356dba
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Wed Sep 21 18:02:00 2016 +0100

    Merge pull request #968 from rabbitmq/rabbitmq-server-501
    
    Provide a way to limit max number of queues in a vhost

commit 35d6c0349b692bc3b745b46a743ec7b83c04e0fb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Sep 21 16:42:32 2016 +0200

    Move all release handling bits to rabbitmq-release
    
    [#130659985]

commit 68cf2a5fac665f5eee81497908582abc391d1890
Merge: 8ebdbc60a ddecc0416
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 21 17:25:40 2016 +0300

    Merge branch 'stable'

commit ddecc0416338a881d24beed556de5e774081195d
Merge: be9a3f7f8 0e7e75d3e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 21 17:24:53 2016 +0300

    Merge branch 'rabbitmq-server-944' into stable

commit ed9356dba7db48f2637475bef67c60ea784b1bd6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 21 16:06:59 2016 +0300

    Add a test that ensures max queue limit isn't enforced for re-declaration

commit 0e7e75d3e3a85965fa1848073ab82d511c4c8da5
Merge: d5e11bc48 be9a3f7f8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 21 15:26:40 2016 +0300

    Merge branch 'stable' into rabbitmq-server-944

commit 74308064e56fb975488f260b7cc8652162c88714
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 21 13:26:01 2016 +0300

    Correct a comment

commit 8ebdbc60a597613ee7b9ed1cc1a9460951913e77
Merge: 7a53030de be9a3f7f8
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Sep 21 10:09:46 2016 +0100

    Merge branch 'stable'

commit e7ae83f5cf81b103f3f1e46a64a1e0053dc4ba74
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Sep 21 09:03:52 2016 +0200

    Remove remaining references to mochi/webmachine

commit be9a3f7f84d3f6c680d3019360c5458f946aa462
Merge: 1f8fba1df b0cb2c4a2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 20 16:51:02 2016 +0300

    Merge branch 'rabbitmq-server-953' into stable

commit d5e11bc481154b1534c00a04d0e32a314dec7ddd
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Sep 20 11:15:52 2016 +0100

    Stop in request_depth if master is not a member any longer

commit b0cb2c4a23c81e0e405723e6988bf0d1235eca80
Merge: 3bb49aa0e 1f8fba1df
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 20 13:57:54 2016 +0300

    Merge branch 'stable' into rabbitmq-server-953

commit be7658f9f4ea800ca7f23538a5961ce7d79787d0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 20 02:50:29 2016 +0300

    One more test

commit 256d17114db77527601a0dd9611423a45eb3e0cd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Sep 20 02:16:37 2016 +0300

    One more test

commit 1f8fba1df31b2b01f7c6404fc251b22727f3d125
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 19 18:46:37 2016 +0200

    Makefile: Remove the `$(PLUGINS)` variable
    
    Now that plugins have an explicit dependency to rabbitmq-common and
    rabbitmq-server, using `$(PLUGINS)` recreates the circular dependency
    being fixed.
    
    This facility will be replaced by a proper mechanism.
    
    [#130659985]

commit 1cdef63c2fbdc547b725e89ca3efbfed766956d5
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 19 14:13:43 2016 +0100

    Stop slaves once removed from the amqqueue record by other nodes

commit 97bfbf6b999923b0183a11fc37eff2ce0d8a4b9d
Merge: 05ac795e6 7a53030de
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 19 15:24:29 2016 +0300

    Merge branch 'master' into rabbitmq-server-501

commit 05ac795e631282141eed1e3b9102cb8ff4db7dd8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 19 15:23:51 2016 +0300

    More tests

commit 94507bbe557ac83c27e52c147aac3c1a89724fee
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 19 13:35:52 2016 +0300

    More tests

commit 4e3715591d91a6aac7351aeed8a3fab7de7f438b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 19 11:57:30 2016 +0200

    Remove `inet_proxy` Erlang distribution
    
    It's now part of rabbitmq-ct-helpers.
    
    [#130086871]

commit 03cac547bd36aade0453628889f57aa5bb18625f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 19 11:37:56 2016 +0200

    Makefile: Explicitely list all DEPS
    
    Sync rabbitmq-components.mk with rabbitmq-common to remove automatic
    DEPS handling.
    
    [#130086871]

commit 0904ddd5968e8a9a9f962c018f6a2af4c105274f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 19 04:28:05 2016 +0300

    Enforce max-queues vhost limit

commit 3bb49aa0eda6510c1dc02ab304a54e1ad14126b4
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Sat Sep 17 13:10:21 2016 +0100

    Match shutdown as expected return value

commit 9a5eac9a9480c547cd875bf755105e60f2135428
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Sep 17 04:54:25 2016 +0300

    Introduce per_vhost_queue_limit suite

commit dde6d63c201782ea4ab1cde8013d1f20898909ca
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Sep 17 04:53:44 2016 +0300

    When setting up a node DB, create secondary indexes on queue tables

commit 4005a5a12cffea117e4bc59a64ce4ec06b93ef7e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Sep 16 16:28:35 2016 +0100

    Stop queue gracefully on coordinator/GM initialisation shutdown

commit 7a53030deadc9109ad14113e81a0e18cbe9bf3db
Merge: 06ddafc89 64e6258a9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 16 14:41:19 2016 +0300

    Merge branch 'stable'

commit 64e6258a9f6b32d518f3550623268e7e9a173c09
Merge: ddaa0e9dc 202089440
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Sep 16 15:40:45 2016 +0400

    Merge pull request #966 from bogdando/stable
    
    Fix stdout/stderr redirects

commit 44d831eefb04f994fb247f562a8ce7250fe82e46
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Sep 16 12:18:28 2016 +0100

    Stop GM with reason shutdown whenever an error is detected

commit 202089440bdc209284a617e0b6ab8c12475f9d1e
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Sep 16 10:43:57 2016 +0200

    Fix stdout/stderr redirects
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1506423
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 06ddafc891a9b85ac3f79a6293968c5d3bdccf5c
Merge: 0ca63e9ce ddaa0e9dc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 15 22:13:57 2016 +0300

    Merge branch 'stable'

commit ddaa0e9dc9c717da5135eec30286d904287a90e1
Merge: 36c92f534 172c52d89
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 15 23:13:03 2016 +0400

    Merge pull request #961 from rabbitmq/rabbitmq-server-953
    
    Stop master with reason shutdown on duplicated masters

commit 172c52d894b2d36ba63b47f0dcf1d67e34378749
Merge: b52470750 36c92f534
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 15 18:36:01 2016 +0300

    Merge branch 'stable' into rabbitmq-server-953

commit 36c92f534885cee048ad1a4bce891a8cb46f50c2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 15 18:33:04 2016 +0300

    Update expectations for new credit flow values

commit b52470750d82d5653c8b23e6a5c93c3a2df6faad
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 15 18:33:04 2016 +0300

    Update expectations for new credit flow values

commit d64eb05f2473440e14b19b5b01b247f19389ff4e
Merge: bb827dd81 98e271fbe
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 15 17:55:38 2016 +0300

    Merge branch 'stable' into rabbitmq-server-953

commit 0ca63e9ceba0c5977e88d6f8cc345351650952de
Merge: 1b0096a92 98e271fbe
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 15 16:35:14 2016 +0200

    Merge branch 'stable'

commit 0e60c60954378b4339ed77d1e5b71e07f0bac002
Merge: 6577b1041 1b0096a92
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Sep 15 17:05:23 2016 +0300

    Merge branch 'master' into rabbitmq-server-501

commit 98e271fbe6fbcda4610c78dbbeff14fc9c3a32ff
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 15 15:45:15 2016 +0200

    Update rabbitmq-components.mk

commit edea140eb3f9334ecb75a81150336557bcd4f64a
Merge: c86b6a0a1 7666d58d6
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 15 16:37:44 2016 +0400

    Merge pull request #963 from rabbitmq/rabbitmq-server-962
    
    Fix log message

commit 7666d58d659dd911d5bc6f12288de9eebbb06cba
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Sep 15 13:23:36 2016 +0100

    Fix log message

commit bb827dd81e5912a307bee0b40acaf8e343ad383d
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Sep 14 12:44:35 2016 +0100

    Stop master with reason shutdown on duplicated masters
    
    * Avoid removing the queue record

commit 8259d901807320dc2dcd027ca2494e3c7eabfc27
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Sep 13 15:45:59 2016 +0100

    Update rabbitmq-components.mk

commit 50f4bdaa0c6ecd1076438f7845973ae8f6c7656f
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Apr 5 16:28:49 2016 +0200

    Add upgrade function adding listener socket options
    
    (cherry picked from commit 6d443bbae5ce570e3fdfd51088c0b7bbeef3c9ce)

commit 1b0096a925ba56af16d4776713a5c8e9593c587a
Merge: da7f18737 c86b6a0a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 12 21:07:28 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            scripts/rabbitmq-env

commit c86b6a0a1bfaf43f114141730dd8215267bd96e8
Merge: 9e412098e 37cb0c826
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 12 21:59:42 2016 +0400

    Merge pull request #957 from rabbitmq/rabbitmq-server-956
    
    Introduce RABBITMQ_IGNORE_SIGINT to ignore the +B VM flag

commit 37cb0c826e8423e3d7aa7eee3d09272ae49c8b37
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 12 20:40:08 2016 +0300

    Ignore current value of RABBITMQ_IGNORE_SIGINT_FLAG

commit da7f18737edbda4752a3ec589f031e5b1f76e0a6
Merge: ade8bab28 9c577158c
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 12 20:16:58 2016 +0400

    Merge pull request #958 from rabbitmq/rabbitmq-server-948
    
    Support direct connection tracking

commit ade8bab28353d691a1418daee4130bacd6830263
Merge: 90dcd68cf 9e412098e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 12 18:50:22 2016 +0300

    Merge branch 'stable'

commit 9e412098eb5c913a020a908bd1ef66384724355d
Merge: 41f2d6d49 ca075f59e
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Mon Sep 12 15:22:16 2016 +0100

    Merge pull request #954 from rabbitmq/rabbitmq-server-908
    
    Make VM +zdbbl easier to configure, bump default to 32MB

commit 90dcd68cf2c871abf999851605451ebf0e3dfaf6
Merge: f887ff1a4 41f2d6d49
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 12 15:18:32 2016 +0100

    Merge branch 'stable'

commit 9c577158c17653f31ba9925dc1338ee36a4ffd58
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Sep 12 15:15:54 2016 +0100

    Support direct connection tracking

commit 41f2d6d49d6456a22cb80a9e0866fe71e551d55e
Merge: 49a735468 f289d0c43
Author: D Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 12 15:14:01 2016 +0100

    Merge pull request #955 from rabbitmq/rabbitmq-server-949
    
    Bump default MoreCreditAfter to 100

commit 4f085c2b0d7945ea0c879918630212e4e7c9ab4f
Merge: 401da163f 49a735468
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 12 16:48:16 2016 +0300

    Merge branch 'stable' into rabbitmq-server-956

commit 49a7354689f3f137839de4ad46a93281229f55e3
Merge: 6bc3b2db5 9bde49f0f
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 12 17:46:45 2016 +0400

    Merge pull request #946 from dmitrymex/reset-mnesia-schema
    
    [OCF HA] Delete Mnesia schema on mnesia reset

commit 401da163fd4c035a1e55db7ca357e18fbae96356
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Sep 12 14:44:23 2016 +0100

    Boolean flag to enable/disable +B VM option

commit 6bc3b2db51b01e7ce4b09e5fda02a1669de16bb0
Merge: dc8a92168 60c2a6163
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Sep 12 17:42:27 2016 +0400

    Merge pull request #951 from rabbitmq/rabbitmq-server-950
    
    Handle not found outside of verify

commit 9b60b46d109afb33cffc92ce203f282279395c82
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Sep 12 14:27:26 2016 +0100

    ENV variable to override +B VM option

commit 60c2a6163fe1fbc360763f24c1456261fa7d22c2
Merge: acc39e857 dc8a92168
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 12 13:30:23 2016 +0300

    Merge branch 'stable' into rabbitmq-server-950

commit f289d0c43e3556760b6f593ff4f8aa814be0e62b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 12 13:04:59 2016 +0300

    Bump default MoreCreditAfter to 100
    
    Local benchmarks with PerfTest demonstrate an insignificant
    (ranging from -1% to 2% improvement for 95th percentile) throughput
    change, however, a few large users report this reducing
    the amount of time queues spent in flow on their workloads.
    
    The original value is certainly quite conservative.

commit ca075f59ecced52f58fe17447c7c020a55755a4c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Sep 12 12:48:37 2016 +0300

    Make VM distribution buffer size easier to configure, bump default to 32MB
    
    Fixes #908.

commit acc39e857742cfb2ebbeb6675fd233913edf9552
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Sun Sep 11 09:50:56 2016 +0100

    Handle not found outside of verify

commit d6cdeee5ed2594a6e9a0d17b9978811ea84e2f9e
Author: kjnilsson <knilsson@pivotal.io>
Date:   Fri Sep 9 11:56:18 2016 +0100

    move delegate to common

commit 6577b1041b5e3f0b4d8bf89593afdf3c5d23017a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 9 03:57:29 2016 +0300

    Correct return value

commit b089dbdcdb74123856a04d46f32baa0279b1b7cb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 9 03:53:40 2016 +0300

    Cosmetics

commit 99dbf0fa937d303a27f08c46d23e3a3c56c6b840
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 9 03:10:44 2016 +0300

    Table migration fn that fills out rabbit[_durable]_queue.vhost

commit fe8e0204a3964830f902c6ef780957fb38babaa4
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Sep 8 17:50:22 2016 +0100

    Return size 0 if rabbit_metrics does not exist (rabbit app is stopped)

commit 9bde49f0fc95ffbfe82f63e454e68ae98e199d26
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Wed Sep 7 22:02:10 2016 +0300

    [OCF HA] Delete Mnesia schema on mnesia reset
    
    Not doing so leads to RabbitMQ node being half-stuck in cluster. As a
    result, it can't clearly join back and constantly fails. Details could
    be found in the following Fuel bug:
    https://bugs.launchpad.net/fuel/+bug/1620649

commit f887ff1a4b403a17040627fea1aa901ef23dbe30
Merge: ddc7552cd dc8a92168
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Sep 7 18:44:46 2016 +0300

    merge branch stable

commit 815af41da98f745515e661ac5b1ee443c38ab76f
Author: kjnilsson <knilsson@pivotal.io>
Date:   Wed Sep 7 11:57:42 2016 +0100

    idempotency metric property tests

commit dc8a921682342e2b44a3dd59a76b08643ff3c0b5
Merge: f8371f775 7fd8dcf68
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Sep 7 13:19:35 2016 +0400

    Merge pull request #942 from dmitrymex/remove-second-monitor
    
    [OCF HA] Do not suggest to run the second monitor action

commit 3497b65eb5dc2ea17178e582a26ea3e7633750f4
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Sep 6 17:44:32 2016 +0100

    switch metrics property tests to lists of operations

commit f1fd9731c638f1217e7e4eb10c39ecb17ba2e360
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Sep 6 16:10:43 2016 +0100

    ensure properties validate the number of things created

commit 7fd8dcf68f1fa50bf8092df83f1884b4fa206697
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Tue Sep 6 17:53:08 2016 +0300

    [OCF HA] Do not suggest to run the second monitor action
    
    Right now we suggest to users to run the second monitor for slaves
    with depth=30. It made sense previously, when there was an additional
    check at that depth. Right now we don't have any depth-specific
    checks and hence it does not make sense to run the second monitor.
    Moreover, removing the second monitor fixes an issue with Pacemaker
    not reacting on failing monitor if it takes more than a minute. For
    details see Fuel bug https://launchpad.net/bugs/1618843

commit c9feeffc94d87f80b3060db1a087a47abbbecb35
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Sep 6 14:55:31 2016 +0100

    PropEr test for core metrics

commit cf8fc6bef793ac6917a6772a93b6497ef41ce18d
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Sep 6 10:36:04 2016 +0100

    test refactor

commit 071b3b66e3decec9d32fb2475dbe49d48db3ce73
Author: kjnilsson <knilsson@pivotal.io>
Date:   Mon Sep 5 16:38:00 2016 +0100

    add tests for core metrics

commit ddc7552cd50d6b226bcae809f1777de1d5f64dd3
Merge: 69485f86e f8371f775
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Sep 5 11:11:27 2016 +0100

    Merge branch 'stable'

commit f8371f775321ec5a0e15776bfa1d0072c9732c84
Merge: 1e3c0b48e eabdd6899
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Sep 3 01:24:06 2016 +0300

    Merge branch 'rabbitmq-server-803-stable' into stable

commit eabdd68997169ce7a5fc25adce43e05028cb1b49
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 2 20:26:21 2016 +0300

    Proper is a test dependency now

commit 1c959076f376da63152dd757ecce9476023aca04
Merge: 864b9d9bf 1e3c0b48e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Sep 2 19:27:22 2016 +0300

    Merge branch 'stable' into rabbitmq-server-803-stable
    
    Conflicts:
            Makefile

commit 69485f86e1b1c95ebf41bed250042864b6cc8e48
Merge: 9cbdc60b6 1e3c0b48e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 2 15:52:05 2016 +0200

    Merge branch 'stable'

commit 1e3c0b48edee2fdd4ed713faabf4ee5521ea7e59
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 2 15:49:02 2016 +0200

    Makefile: Re-add amqp_client and meck as TEST_DEPS
    
    There were accidentaly removed in f67c055e1e2a1931c0a84e1e271573b7abdf2877.
    
    [#127356157]

commit c582e1631e9707258291f85bca788dbd9baeda54
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 2 13:22:24 2016 +0200

    Update rabbitmq-components.mk

commit f67c055e1e2a1931c0a84e1e271573b7abdf2877
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 2 12:14:42 2016 +0200

    Makefile: No need to filter out rabbitmq_test from TEST_DEPS anymore
    
    [#127356157]

commit b1cc22e86168179d3bf10e1b654d55883a65a558
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 2 12:03:29 2016 +0200

    Update rabbitmq-components.mk

commit 9cbdc60b62085d71ff359f8d00363cc7fd44a651
Merge: cc6dbc706 d6234d9af
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 2 00:07:43 2016 +0300

    Merge branch 'rabbitmq-server-930' (again)

commit d6234d9af10c6978940d7d5e9bfe69ade753e2bf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 23:52:15 2016 +0300

    Make sure the argument to md5 is a binary in this test

commit cc6dbc706e7bd811a01c89a1cdafe7251aa3092f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 23:52:15 2016 +0300

    Make sure the argument to md5 is a binary in this test

commit 7a5a63b13e9374ea5a295ecb790c5b14c0ceae8d
Author: kjnilsson <knilsson@pivotal.io>
Date:   Thu Sep 1 17:49:43 2016 +0100

    change stats to include rabbit_mgmt_sup_sup instead of rabbit_mgmt_sup

commit 6fd6548bb68356cceb50679767446a1ea0f3c55d
Merge: 7b8f649e7 26376b8d0
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 1 19:21:05 2016 +0400

    Merge pull request #938 from rabbitmq/rabbitmq-server-930
    
    Operator policies

commit 26376b8d0b9347f5c62e24b33b53f8e02b516c54
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 15:27:45 2016 +0300

    Document arguments supported by operator policies

commit a35ba221b2b522d503235d13dbac025fdedb0c91
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 14:08:58 2016 +0300

    Extract policy tests into a separate suite

commit cb6c9aa7dc1811bf7ab0035c58a38532143d0496
Author: kjnilsson <knilsson@pivotal.io>
Date:   Thu Sep 1 10:14:57 2016 +0100

    update memory usage stats

commit b4eeb8cc87395fd9b72fbf4d85301b3a9fce5b48
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 10:30:18 2016 +0300

    Use a separate event key for operator policies

commit abc2565d5aa422f1ea55102947277f3448b40afd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 02:23:24 2016 +0300

    Optimize a case clause
    
    Operator policies won't be used most of the time.

commit 20d1f37f5d93c3aab97e2afa62ac3f40c94d59a3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 1 02:17:28 2016 +0300

    Update operator policy commands in rabbitmqctl(1)

commit 7b8f649e762c00f792b8472ccb4c059f95ff4fed
Merge: f944b548d 68b1a9158
Author: Karl Nilsson <knilsson@pivotal.io>
Date:   Wed Aug 31 14:22:47 2016 +0000

    merge

commit 610a656598ee47d170c7ce4f9c2c6682fe3a8aed
Merge: 0ba5fbd1f f944b548d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 31 16:57:12 2016 +0300

    Merge branch 'master' into rabbitmq-server-930

commit 0ba5fbd1f6d18ff153842daf091786a842389292
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 31 14:13:16 2016 +0100

    Added new registry class policy_merge_strategy to define policy values merging

commit 68b1a91589ce10d2e5ef0c3d3bd32a2c4224a5bc
Merge: ad02ae79f 5a54c4df6
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 31 15:46:25 2016 +0300

    Merge pull request #934 from rabbitmq/rabbitmq-server-932
    
    Create el6 and el7 rpm packages

commit 5a54c4df6f5ee7a583290d655564c40bb4c0a64e
Merge: ef46aa63c ad02ae79f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Aug 31 13:19:53 2016 +0100

    Merge branch 'stable' into rabbitmq-server-932

commit f944b548dce9a7cda30e1816b3aa5e0c6eebdeff
Merge: 6d9d506f4 ad02ae79f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Aug 31 14:02:44 2016 +0300

    Merge branch 'stable'

commit ad02ae79f705369f24085ad5ba8a98397b4f0662
Merge: 3b0f2762c 274c1d901
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 31 13:51:44 2016 +0300

    Merge pull request #941 from lemenkov/move_mochinum_to_rabbitmq_common
    
    Move mochium to rabbitmq-common

commit 30530d5a266fb7e2d98105a33f94744d53b55534
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 31 11:12:10 2016 +0100

    Queue TTL operator policy

commit 864b9d9bf8d37f09798372f788637de95bf71d15
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:50:58 2016 +0200

    dynamic_ha_SUITE: Disable random policy tests for now
    
    ... while known failures are being investigated. This should unblock
    downstream tasks in Concourse.
    
    References #889.
    [#126767013]

commit eca3fb9d38d68d99a1e35338c9b6fffb84310171
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:50:35 2016 +0200

    dynamic_ha_SUITE: Log the failing set of policies
    
    References #889.
    [#126767013]

commit 666c5188a929f5eaf455795c7c3efa5d23a71dbf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:47:36 2016 +0200

    dynamic_ha_SUITE: Add a new kind of failing set of policies
    
    References #889.
    [#126767013]

commit 9f34f606c5de8c14ee636144b5b7973eed6b18ec
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 20:11:12 2016 +0200

    dynamic_ha_SUITE: Handle the change of queue master PID
    
    We must query the queue master PID before each check and handle `badrpc`
    if the process disappeared.
    
    References #889.
    [#126767013]

commit 52b6c7db2c0ddd446d1d8f1c08e22e144887d06a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 15:37:02 2016 +0200

    dynamic_ha_SUITE: Explicitely add failing policies found by PropEr
    
    References #889.
    [#126767013]

commit f459f29a2ff07c0d3580d16e059474944c40ea8b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 15:35:33 2016 +0200

    dynamic_ha_SUITE: Wait for the last policy to apply a little longer
    
    This fixes some false positives.
    
    References #889.
    [#126767013]

commit a53b2405b4a7c0e6a7a64cceed71fbd63064a5cc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 14:54:40 2016 +0200

    dynamic_ha_SUITE: Use an assertion to possibly fail the test
    
    ... instead of raising an exit signal.
    
    While here, use ct:pal/3 as the output function for PropEr, not
    io:format/3. This ensures common_test knows the origin of the message
    and that it's expected.
    
    [#126767013]

commit b8a0379d226d88155e73b065d15f1fac14296cc7
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 16:05:13 2016 +0100

    Upgrade amqqueue record with policy_version

commit 3ccfc3b4483624d03d4b40c189fe6b8a765cd376
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 15:07:19 2016 +0100

    Check return value of clear_policy in the test instead of auxiliary function

commit d712ef1fc5602d7e34dcc8a75e50ec9db65afd89
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 14:04:56 2016 +0100

    Test concurrent application of HA policies

commit c555df59bb9d66fe22d4c97f101b2a2d989eea1c
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri May 27 11:58:32 2016 +0200

    Update policy version on set_policy and use it on update_mirroring

commit 45caaaa959f93ce0c061e59fda1e94df9466f8a4
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed May 25 07:46:34 2016 +0100

    Take update mirroring decision in rabbit_amqqueue_process

commit 8765f2c939aefe864633e697f69878cea6802612
Merge: c12d5a6c9 6d9d506f4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 31 03:31:08 2016 +0300

    Merge branch 'master' into rabbitmq-server-930
    
    Conflicts:
            src/rabbit_control_main.erl
            src/rabbit_upgrade_functions.erl

commit 3b0f2762cb1c526b1b4d293abfa35adabca62305
Merge: 57622a4c7 94769bad8
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Aug 29 14:33:04 2016 +0300

    Merge pull request #939 from binarin/rabbitmq-server-ocf-is-clustered-check
    
    Perform partition checks from OCF HA script

commit 6d9d506f453e38e1134235c57d365c91af5b6cc4
Merge: 300181042 a660b7009
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 26 20:00:49 2016 +0300

    Merge pull request #891 from rabbitmq/rabbitmq-server-500-squashed
    
    Keep track of connections, introduce per-vhost limits

commit a660b7009a61d1e05c096b518a961720669c0bb9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 26 15:09:07 2016 +0200

    per_vhost_connection_limit_SUITE: Add a test around cluster rename
    
    This makes sure the limits are still good after a node was renamed and
    thus, the tracking tables were recreated with a new name too.
    
    While here, do some cleanup in the init/end functions in both the two
    per-vhost limit testsuite.
    
    References #500.
    [#116521809]

commit 274c1d9013c13ec9973fbb3cbc567434a4f46c07
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Fri Aug 26 15:53:43 2016 +0300

    Nobody is using mochinum in this repo. Move it to common.
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 94769bad87fcf54c71a980920ba192676a496b2e
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Aug 26 14:39:17 2016 +0300

    Allow node_health_check retries in OCF HA script

commit 2ac267a2351ec90ffa5014762ed2fef0caed7a00
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Aug 26 14:35:26 2016 +0300

    Perform partition checks from OCF HA script
    
    Partitioned nodes are ordered to restart by master. It may sound like
    `autoheal`, but the problem is that OCF script and `autoheal` are not
    compatible because concepts of master in pacemaker and winner in
    autoheal are completely unrelated.

commit a5cdde115e5373cae4c8a5577549308167540e1d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 26 12:34:59 2016 +0200

    Remove dead code left from a previous incarnation of the patch
    
    References #500.
    [#116521809]

commit c12d5a6c9a77a670614b04a64df73263d64789f7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Aug 26 11:33:38 2016 +0100

    Usage for operator policy management commands

commit 3234494e06c3c8f8d8b85573212806492fecdc5e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Aug 26 11:12:22 2016 +0100

    Test policy and operator policy message ttl

commit 300181042dd0b30cc2270c4e08a394bbf1e5e966
Merge: f057a8c90 57622a4c7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Aug 26 01:33:04 2016 +0300

    Merge branch 'stable'

commit 57622a4c7a0c4021de522f0e7eebf2382d1a7311
Merge: ce0381c0c ae5dceabc
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 26 01:32:18 2016 +0300

    Merge pull request #936 from niclic/rabbitmq-server-935
    
    Docs: Default AMQP heartbeat delay should be 60 seconds in rabbitmq.config.example

commit ae5dceabcd84469fdafab10f6fd012210dbed6a3
Author: Raymond Fallon <rfallon@360incentives.com>
Date:   Thu Aug 25 17:46:29 2016 -0400

    Docs: Default AMQP heartbeat delay should be 60 seconds

commit 0593afdd05bed1619e197487ee1170a1b95cf6eb
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Aug 25 17:06:55 2016 +0100

    Operator policy as a separate queue field

commit 99f75622beaefa7e4acab9f11befef7067237215
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 25 17:55:03 2016 +0200

    cluster_rename_SUITE: Lower the testsuite timeout
    
    While here, be more informative when a node rename fails.

commit d431320559960968eef716f343cc90d9dbe5e4ce
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 25 17:53:04 2016 +0200

    per_vhost_connection_limit_SUITE: Sleep 500ms after connection open/close
    
    This helps in CI where the connection tracking tables may not yet
    be up-to-date at the time the testcase verifies them.
    
    References #500.
    [#116521809]

commit f43f6cd6133c57aeb814b2c4e6998b1a89beb7d5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 25 17:49:49 2016 +0200

    rabbit_mnesia_rename: Backup local tables only
    
    The connection tracking tables are not replicated because the table
    tracking connections on node A logically exists only the node A.
    
    The backup made during the rename of a node failed because it wanted to
    access a remote offline node to backup its connection tracking tables.
    Obviously it didn't work. The solution is to not backup those tables.
    This is correct because they are only relevant while the node is
    running.
    
    References #500.
    [#116521809]

commit 2527a853a27595915edcb736dbe35cd56fb067a2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 25 17:43:17 2016 +0200

    rabbit_mnesia:forget_cluster_node/2: Skip event if node if offline
    
    When the node is offline (`--offline` is set on the command line),
    we must skip the emission of the `node_deleted` event because the
    rabbit_event event handler is not setup (RabbitMQ is stopped).
    
    Otherwise, the command fails with `badarg` in gen_event.
    
    References #500.
    [#116521809]

commit b9bdedf0574783be316a9d451076064e2a30b910
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 25 09:08:54 2016 +0100

    Push queue metrics

commit ef46aa63c0b0833c14bed680f39431e0d61b5cd1
Author: Karl Nilsson <knilsson@pivotal.io>
Date:   Tue Aug 23 15:16:14 2016 +0000

    Pretend to build on rhel6 and rhel7 during package-rpm
    
    manually expand some rpm macros that do not get expanded when packaging on debian
    
    set _unitdir for rhel7

commit 15116daafe3f1ef1b55427c35b27c51a5cf2592d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 24 15:42:48 2016 +0100

    operator_policy runtime parameter

commit 086fd01ae1356c358bbc2ebc0f02a375b8cd618b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 24 15:41:03 2016 +0100

    operator policies

commit 2994c427aae5b06179f32cfdf92b9a0e2bf510e2
Merge: 922a43c2b f057a8c90
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 24 17:11:31 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed

commit f057a8c90c103eb4d7012df47478fbfb51988f00
Merge: ea8df21f5 ce0381c0c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Aug 24 14:48:59 2016 +0300

    Merge branch 'stable'

commit ce0381c0cd65e0334892e657c43c4112e69fd250
Merge: 29a12b6be 69bf94235
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Aug 24 14:48:40 2016 +0300

    Merge branch 'rabbitmq-server-928' into stable

commit 69bf942356aa0282ec2cab5073eccac01cfe0950
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Aug 24 11:33:03 2016 +0300

    Naming, wording

commit 484db84679351fd7137aadcd1d9083750490194a
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Wed Aug 24 09:12:50 2016 +0100

     Handle late autoheal_finished message

commit edf5d7527fcc8aba9707584adbece681e7d10f04
Merge: 7b151d751 29a12b6be
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 23 15:59:33 2016 +0300

    Merge branch 'stable' into rabbitmq-server-928

commit 7b151d75144e72c484f60af8a949029272a5d87e
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Aug 23 13:28:34 2016 +0100

    Improve tolerance to partial partitions in autoheal
    
    * Also solves deadlocks when leader aborts autoheal in node down

commit ea8df21f5f4b4addbfad8a128466ca7e04e638fa
Merge: c72f7b4b9 29a12b6be
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 23 15:11:17 2016 +0300

    Merge branch 'stable'

commit 29a12b6be5744efb0dd270411b3ad112096fc4e6
Merge: cc8a3c73d 99f2a48b1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 23 15:03:40 2016 +0300

    Merge pull request #916 from binarin/rabbitmq-server-new-shiny-ocf-health-check
    
    Use new rabbitmqctl features for monitoring

commit 5f573ef7b9e38f2042cc94813fbc7d052f45215c
Merge: cc8a3c73d 4ee5fc293
Author: Ubuntu <ubuntu@ubuntu-xenial.haas-40.pez.pivotal.io>
Date:   Tue Aug 23 10:49:06 2016 +0000

    Merge branch 'systemd-fedora-usage-and-tmpfiles' of git://github.com/harlowja/rabbitmq-server into harlowja-systemd-fedora-usage-and-tmpfiles

commit 922a43c2b56695478b9ef04699eceab5e170f649
Merge: 754feab69 c72f7b4b9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 23 13:29:59 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed

commit 99f2a48b175ef7f54b1f2a54991fb6aa0696cefc
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Aug 17 15:18:22 2016 +0300

    Monitor rabbitmq from OCF with less overhead
    
    This will stop wasting network bandwidth for monitoring.
    
    E.g. a 200-node OpenStack installation produces aronud 10k queues and
    10k channels. Doing single list_queues/list_channels in cluster in this
    environment results in 27k TCP packets and around 12 megabytes of
    network traffic. Given that this calls happen ~10 times a minute with 3
    controllers, it results in pretty significant overhead.
    
    To enable those features you shoud have rabbitmq containing following
    patches:
    - https://github.com/rabbitmq/rabbitmq-server/pull/883
    - https://github.com/rabbitmq/rabbitmq-server/pull/911
    - https://github.com/rabbitmq/rabbitmq-server/pull/915

commit c72f7b4b91e05e4de7024e7c649feef8ee019338
Merge: e08e2b960 cc8a3c73d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 23 00:40:29 2016 +0300

    Merge branch 'stable'

commit cc8a3c73dcc5780316cab9a7547c332ac882bd70
Merge: d4020f5f5 be86bf4e2
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Aug 22 17:31:40 2016 +0300

    Merge pull request #929 from dmitrymex/start-sequence
    
    [OCF HA] Change master score computation & split-brain detection logic

commit be86bf4e207cb9cb00f786d9476ef3dc58ced72c
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Mon Aug 22 14:22:21 2016 +0300

    [OCF HA] Enhance split-brain detection logic
    
    Previous split brain logic worked as follows: each slave checked
    that it is connected to master. If check fails, slave restarts. The
    ultimate flaw in that logic is that there is little guarantee that
    master is alive at the moment. Moreover, if master dies, it is very
    probable that during the next monitor check slaves will detect its
    death and restart, causing complete RabbitMQ cluster downtime.
    
    With the new approach master node checks that slaves are connected to
    it and orders them to restart if they are not. The check is performed
    after master node health check, meaning that at least that node
    survives. Also, orders expire in one minute and freshly started node
    ignores orders to restart for three minutes to give cluster time to
    stabilize.
    
    Also corrected the problem, when node starts and is already clustered.
    In that case OCF script forgot to start the RabbitMQ app, causing
    subsequent restart. Now we ensure that RabbitMQ app is running.
    
    The two introduced attributes rabbit-start-phase-1-time and
    rabbit-ordered-to-restart are made private. In order to allow master
    to set node's order to restart, both ocf_update_private_attr and
    ocf_get_private_attr signatures are expanded to allow passing
    node name.
    
    Finally, a bug is fixed in ocf_get_private_attr. Unlike crm_attribute,
    attrd_updater returns empty string instead of "(null)", when an
    attribute is not defined on needed node, but is defined on some other
    node. Correspondingly changed code to expect empty string, not a
    "(null)".
    
    This fix is a fix for Fuel bugs
    https://bugs.launchpad.net/fuel/+bug/1559136
    https://bugs.launchpad.net/mos/+bug/1561894

commit 5a6f61c423b19b33e36f0be0f995a1636b310873
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Mon Aug 22 14:19:21 2016 +0300

    [OCF HA] Rank master score based on start time
    
    Right now we assign 1000 to the oldest nodes and 1 to others. That
    creates a problem when Master restarts and no node is promoted until
    that node starts back. In that case the returned node will have score
    of 1, like all other slaves and Pacemaker will select to promote it
    again. The node is clean empty and afterwards other slaves join to
    it, wiping their data as well. As a result, we loose all the messages.
    
    The new algorithm actually ranks nodes, not just selects the oldest
    one. It also maintains the invariant that if node A started later
    than node B, then node A score must be smaller than that of
    node B. As a result, freshly started node has no chance of being
    selected in preference to older node. If several nodes start
    simultaneously, among them an older node might temporarily receive
    lower score than a younger one, but that is neglectable.
    
    Also remove any action on demote or demote notification - all of
    these duplicate actions done in stop or stop notification. With these
    removed, changing master on a running cluster does not affect RabbitMQ
    cluster in any way - we just declare another node master and that is
    it. It is important for the current change because master score might
    change after initial cluster start up causing master migration from
    one node to another.
    
    This fix is a prerequsite for fix to Fuel bugs
    https://bugs.launchpad.net/fuel/+bug/1559136
    https://bugs.launchpad.net/mos/+bug/1561894

commit e08e2b960dc48873c56a6f98b527d99cf52db90f
Merge: 80efcc725 d4020f5f5
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Aug 19 12:26:10 2016 +0100

    Merge branch 'stable'

commit d4020f5f50f118f870ead1d1180f79e75032f6f7
Merge: c6338564a 6fc561f14
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Aug 19 12:24:05 2016 +0100

    Merge branch 'Ayanda-D-rabbitmq-server-914' into stable

commit 6fc561f14213446f6bfc7ba7e6d946640d5f0d56
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Aug 19 10:45:55 2016 +0100

    Test GM crash when group is deleted while processing a DOWN message

commit 89a4e14de8dbb73f6369801070c0769a8c766a09
Merge: 387b54920 a41606031
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Aug 19 11:56:55 2016 +0100

    Merge branch 'rabbitmq-server-914' of https://github.com/Ayanda-D/rabbitmq-server into Ayanda-D-rabbitmq-server-914

commit c6338564a6d0fd2b5f3c9c2b32923c97e1518844
Merge: 387b54920 39a5faf4c
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 18 22:53:38 2016 +0300

    Merge pull request #926 from dmitrymex/get-private-attr
    
    [OCF HA] Add ocf_get_private_attr function to RabbitMQ OCF script

commit 39a5faf4cee7fc480607e51ad75806fbecede12f
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Thu Aug 18 15:35:38 2016 +0300

    [OCF HA] Add ocf_get_private_attr function to RabbitMQ OCF script
    
    The function is extracted from check_timeouts to be re-used later
    in other parts of the script. Also, swtich check_timeouts to use
    existing ocf_update_private_attr function.

commit 80efcc7258bcf9ae9ca62a8509a76f56b2fc6c5c
Merge: 9f1c12f8a 387b54920
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Aug 18 16:29:29 2016 +0300

    Merge branch 'stable'

commit 754feab6936ff1954964bf04423a2758899b91dc
Merge: dad8511a6 9f1c12f8a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 18 12:17:34 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed
    
    Conflicts:
            src/rabbit_control_main.erl

commit dad8511a6409816d3d8012fdb70213122bb690e4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 18 11:18:58 2016 +0300

    Squash warnings

commit 387b54920ec520e4c6a12940fce27f00dc8e0fec
Merge: b02d325f2 f7d5d6e48
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 18 11:04:09 2016 +0300

    Merge pull request #925 from bogdando/fix_bashisms
    
    Fix bashisms in rabbitmq OCF RA

commit f7d5d6e48c186b1e0e973d7ee63224644d94ae0a
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Aug 18 09:59:32 2016 +0200

    Fix bashisms in rabbitmq OCF RA
    
    Change "printf %b" to be passing the checkbashisms.
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit bbe671dd2a2bd9939b0368c19b9427e71ba1a305
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 18 09:50:02 2016 +0300

    record_info/2 is appropriate here

commit 769472f9baa6bc66d77eadd1362bfc8a0bd2d33b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 18 09:38:29 2016 +0300

    Use lists:foldl/3 only

commit 0db9986808b207466aad066f380f7f473268d6e0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 18 09:32:50 2016 +0300

    Reformat with emacs

commit 9febe154c3f396cebee365543266bba3cb4b2c75
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 17 01:30:34 2016 +0300

    Combine map/2 and foldl/3

commit 9f1c12f8ab553aab2da435f82a805da8b08c9149
Merge: ccb5972bc b02d325f2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 16 19:11:32 2016 +0300

    Merge branch 'stable'

commit b02d325f21e643710d0e86bbdcf4206c38182516
Merge: 4d4144eb9 878b6a00a
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 16 19:11:02 2016 +0300

    Merge pull request #923 from rabbitmq/rabbitmq-server-922
    
    Discard any unexpected messages, such as late replies from gen_server

commit 878b6a00ad9ade9adb0c400df6541e63f74b9ede
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 16 19:10:37 2016 +0300

    Typo

commit e86d65f1f5eb85087ce529921f1ff848cb010230
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Tue Aug 16 16:31:12 2016 +0100

    Discard any unexpected messages, such as late replies from gen_server

commit ccb5972bc3e75a2295a26899879b9dbdfbb736ed
Merge: 6225ce61b 4d4144eb9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 16 14:05:40 2016 +0300

    Merge branch 'stable'

commit 4d4144eb920464c60d57896dd2fdeb034714913b
Merge: 9d4f0aaa2 741e19543
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 16 14:02:36 2016 +0300

    Merge branch 'binarin-rabbitmq-server-health-check-node-monitor' into stable

commit 741e195437f1c958fefbc42768031394d5d53518
Merge: 9d4f0aaa2 0e35bc61d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 16 13:23:07 2016 +0300

    Merge branch 'rabbitmq-server-health-check-node-monitor' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-health-check-node-monitor

commit 6225ce61bcad71785d5733a285209766c6191684
Merge: e6c0ac043 9d4f0aaa2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 16 10:18:26 2016 +0300

    Merge branch 'stable'

commit e6c0ac043b53e40b2964cff9db0f7e59c0c5d127
Merge: 87a214d8f b28620837
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 16 10:15:18 2016 +0300

    Merge pull request #919 from mwhahaha/iptables
    
    Update iptables calls with --wait

commit 9d4f0aaa22653130aebc7408729b3164bbe63227
Merge: 15cb69740 6e1d718b0
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 16 10:15:13 2016 +0300

    Merge pull request #920 from mwhahaha/iptables-stable
    
    Update iptables calls with --wait

commit 6e1d718b0312b472fb658f4e9b0dac69cb2794be
Author: Alex Schultz <aschultz@mirantis.com>
Date:   Mon Aug 15 10:02:32 2016 -0600

    Update iptables calls with --wait
    
    If iptables is currently being called outside of the ocf script, the
    iptables call will fail because it cannot get a lock. This change
    updates the iptables call to include the -w flag which will wait until
    the lock can be established and not just exit with an error.

commit b28620837391de1b6208ddb096d1dcdb98e6ab8b
Author: Alex Schultz <aschultz@mirantis.com>
Date:   Mon Aug 15 10:02:32 2016 -0600

    Update iptables calls with --wait
    
    If iptables is currently being called outside of the ocf script, the
    iptables call will fail because it cannot get a lock. This change
    updates the iptables call to include the -w flag which will wait until
    the lock can be established and not just exit with an error.

commit 87a214d8fee46037c85c44c94ff67e39e80f2446
Merge: ca2d2054d 15cb69740
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Aug 15 15:07:10 2016 +0100

    Merge branch 'stable'

commit 15cb69740faf7c3df7ddbf0a6ce593f885f12e10
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Aug 15 17:01:13 2016 +0300

    Docs wording

commit a41606031791651ecea255070395b4cbfb075be4
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Aug 15 12:30:38 2016 +0100

    Handle unexpected gm group alterations prior to removal of
    dead pids from queue

commit ca2d2054ddcdcee66ec36d52a2604a3c343c4cc9
Merge: 703ea5abe c2bd22cdc
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Mon Aug 15 12:12:56 2016 +0100

    Merge branch 'stable'

commit 53f10c98bb16202c09c2567a2a0590dd8e1f8dc9
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Aug 15 11:43:23 2016 +0100

    Adds check_membership/2 clause for handling non-existant gm group

commit 6d0ca9cca257e61ffe522933a1bf6460c8047d5c
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Aug 15 11:37:48 2016 +0100

    Safely handle (and log) anonymous info messages, most likely
    from the gm process' neighbours

commit c2bd22cdc3c1f0ba75bbeebd3a6d59b3d976cb68
Merge: 9c0823739 2482c9fe4
Author: D Corbacho <diana@rabbitmq.com>
Date:   Mon Aug 15 08:48:49 2016 +0100

    Merge pull request #911 from binarin/rabbitmq-server-851
    
    Add support for listing only local queues

commit e25e906d958b7cfdadda385da8ed865414fe8603
Merge: 93682bd77 703ea5abe
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Aug 14 11:03:50 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed

commit 93682bd779b4af0f1350dd9363be727418d081bf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Aug 14 11:03:42 2016 +0300

    Rename function

commit 0363bac78b403e666ab36584f58c527682ac7869
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Aug 14 10:09:30 2016 +0300

    Delete connection tracking tables for nodes removed from the cluster

commit 9c0823739580e3e9fcd382feda429408ba3d55aa
Author: jerryk <jerrykuch@gmail.com>
Date:   Fri Aug 12 16:55:52 2016 -0700

    Fix trivial typo noticed in error message.

commit 2482c9fe4b540d9ef9a66cd6ca3534015eeb88bc
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Aug 8 19:31:27 2016 +0300

    Add support for listing only local queues
    
    Partially implements https://github.com/rabbitmq/rabbitmq-server/issues/851
    
    - Made old `--online`/`--offline` options mutually exclusive between
      themselves and the new `--local` option
    - Added documentation both for the old and the new option
    - Fixed some ugly indentation in generated usage (only `set_policy`
      wrapped line remains unfixed)
    - Added integration test suite for `rabbitmqctl list_queues`

commit 4ee5fc29384d304fefb9527e7ef01019da40d87b
Author: Joshua Harlow <jxharlow@godaddy.com>
Date:   Wed Aug 3 14:26:09 2016 -0700

    Add rabbitmq-server fedora/rhel/centos systemd service integration
    
    Add support for systemd usage (vs sysvinit) on versions of fedora
    and supporting versions of centos/rhel (newer than or equal to 7).

commit 0aadbb093f0426cb5ce39451caceaf3b85da820d
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 11 15:24:10 2016 +0100

    Push consumer metrics

commit 7749aa8e6072db0a6681cec0000e2794e7e317ba
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 11 13:37:36 2016 +0100

    Push connection created/closed events

commit b68ce3f76e22aefd6ba8091e1f6a8d0cc141bf92
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Thu Aug 11 13:36:52 2016 +0100

    Start raw metrics storage

commit 703ea5abe6b7fd1cb2008d4e1c990de4593de90d
Merge: efafdd01c 64c01b7d5
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 10 18:21:09 2016 +0100

    Merge pull request #917 from rabbitmq/rabbitmq-server-909
    
    Add tcp linger option to schema

commit ede361d09288eb8a04cf55f0f7e53f01c069d6c0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 10 20:18:33 2016 +0300

    Emit a node_deleted event when a node is removed from the cluster

commit 64c01b7d557f10a13de0ced0b8460b19ee929201
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 10 18:13:12 2016 +0100

    Non negative integer validator

commit 6bf712ae585da00fc7f69220a44a524de88b1760
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 10 18:00:37 2016 +0100

    Non negative validator for tcp linger

commit 724656bf242f289270bfe585de920a6f2fbe6965
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Aug 10 17:06:09 2016 +0100

    Add tcp linger option to schema

commit efc0f993e1e66b724f22be77bbc1d3830b2ddcdb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 10 18:37:06 2016 +0300

    We can use record_info/2 here; log errors in table creation

commit 0e35bc61d33b39b2181b0df619274889e6a9b87d
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Aug 10 14:19:42 2016 +0300

    Check rabbit_node_monitor during health-check
    
    Tests + comment outlining the problem. The check itself is in separate
    commit to `rabbitmq-common`.

commit efafdd01cf4832cada5dfe81f6ec6cdd7a5d28c5
Merge: 84f40296d ccffb4011
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 10 12:57:15 2016 +0200

    Merge branch 'stable'

commit ccffb401112b54568dcf4884d9be666657e3cc29
Merge: ca4c0c011 37d4fc789
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Aug 10 12:43:48 2016 +0200

    Merge pull request #892 from binarin/rabbitmq-server-890
    
    Fix longname-mode on hosts without detectable FQDN

commit f012c49c5df5f2c7bbb2aa2d7a2f61e81da1863a
Merge: cb4835b7d 84f40296d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 10 13:11:32 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed

commit cb4835b7d594ada2056839740dd20030683caa15
Merge: d36d1d4df 5f92e9f30
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 10 13:11:03 2016 +0300

    Merge branch 'master' into rabbitmq-server-500-squashed

commit 84f40296d6533c344d457bdd7192cdb897e45dbf
Merge: 5f92e9f30 ca4c0c011
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Aug 10 12:05:26 2016 +0300

    Merge branch 'stable'

commit ca4c0c011f963b4511da111261bb48bdd3dabad2
Merge: 065f31d3d 1c4934df5
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 10 10:04:22 2016 +0100

    Merge pull request #910 from rabbitmq/rabbitmq-server-850
    
    Added resume after flow

commit 1c4934df5b22df0ae6a5496bcd40d8b954dbfcac
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Aug 8 23:23:03 2016 +0200

    add resume after flow

commit 5f92e9f306dd9898f692fbbe702fd3b866356cd9
Merge: 22d451a12 065f31d3d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Aug 8 21:53:24 2016 +0300

    Merge branch 'stable'

commit d36d1d4dfe528b9426f7b0f3452e54d033667bc8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Aug 5 17:55:32 2016 -0700

    More test cases

commit 0199aa9a82055b1be7c5fa0a0d5089bd3fc6607d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Aug 5 17:27:19 2016 -0700

    Use negative values to disable per-vhost limits, 0 to refuse all connections
    
    Per recommendation from @dumbbell.

commit 065f31d3d878f887bb811db0c5a49029a3f057ef
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 5 17:18:02 2016 +0100

    Commit .deb and .rpm change logs

commit 249995a23d14f543d6cc197ff0062b6a7e804d90
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Aug 5 15:23:48 2016 +0200

    fix loop in flow control state

commit 363d0a183e4b54bdb3aa2cf584175ff43156992e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 22:36:25 2016 -0700

    One more test case

commit e447910d2765d730be650662d992244877250c98
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 19:03:59 2016 -0700

    Refactor

commit a9fbb98cedb912014eec89fb2969c61c52b6df37
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 18:41:13 2016 -0700

    Use rabbit_misc:pget/2 here

commit 0457b588f33751b23fad2a0e618c45174de1701e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 12:12:36 2016 -0700

    Simplify

commit da08e953d1de90d0e06481a267585f0316861ea7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 12:00:48 2016 -0700

    Drop the _test prefixes, remove some dead code

commit 95b6e8f48f7a581cf21e4807560d327714e1abd2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 11:48:58 2016 -0700

    Remove a debug message

commit 87c2d6f2c0da37d8edc3d16790733305a1594075
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 11:48:05 2016 -0700

    Inline

commit 295c7b21f6328501fb1cee7a35b879d743dca9e9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 4 11:29:38 2016 -0700

    Remove a duplicate comment

commit ed4fe7e663447a61a92089cc033c5c87c8d757fb
Merge: 747b41a9d 22d451a12
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 2 10:52:34 2016 -0700

    Merge branch 'master' into rabbitmq-server-500-squashed

commit 22d451a12ff0bbc68b7cc9b7f9433662e8977d95
Merge: 8685e140c 6214ebdf0
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 2 09:44:50 2016 -0700

    Merge pull request #900 from johnlonganecker/master
    
    fixed typo in config example comment

commit 8685e140cbcc1a94af3a6bd34e62e9ce41a57878
Merge: 2ccc749a2 ea4e59ee3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 2 09:36:57 2016 -0700

    Merge branch 'stable'

commit ea4e59ee3018bd2824b003ac8f9db3e59c9d3413
Merge: cdca66beb 20067a9c2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Aug 2 09:36:42 2016 -0700

    Merge branch 'rabbitmq-server-904' into stable

commit 747b41a9d3794706390b21003eb4bf6929422213
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 2 06:06:09 2016 -0700

    Switch to a single table per node for connection tracking
    
    This way we have a single writer, multiple readers and no
    lost counter update due to natural race conditions.
    Data for tables from available nodes are then aggregated.
    
    Two open questions:
    
     * Whether to use a parallel version of lists:map/2
     * When to clean up the tables

commit 20067a9c208bc66c1a6ef5494033e89efd9ef91f
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Aug 2 12:18:07 2016 +0200

    added rabbit_registry require

commit 6214ebdf0c8440ad15332cf1403907786cae9261
Author: johnlonganecker <johnlonganecker@gmail.com>
Date:   Fri Jul 29 16:02:38 2016 -0700

    fixed typo in config example comment

commit 2ccc749a28a643e5020a769d48b950d17d0fda56
Merge: 0af2c6d38 cdca66beb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jul 30 00:17:32 2016 +0300

    Merge branch 'stable'

commit cdca66bebd89d27b616c94e514e674cb9f3f364c
Merge: fd5d6da6d 5e634fa2d
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jul 30 01:16:55 2016 +0400

    Merge pull request #898 from binarin/rabbitmq-server-868-secs
    
    Fix some type specs

commit 5e634fa2dc3c7f62fe3e4fce834cef83aceaa547
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Jul 29 19:32:49 2016 +0300

    Fix some type specs
    
    Forgot to update specs in #868

commit 0af2c6d3875a00fed6c6090ebd39fe2b82395411
Merge: dcd7de322 fd5d6da6d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 29 18:20:32 2016 +0300

    Merge branch 'stable'

commit fd5d6da6da3af7298040c9653f93678628ef53b4
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 29 14:30:47 2016 +0100

    Commit .deb and .rpm change logs

commit dcd7de32202622c6f522278453f46a655aab7948
Merge: 070182621 40fc150ff
Author: Diana Corbacho <diana@rabbitmq.com>
Date:   Fri Jul 29 10:35:31 2016 +0100

    Merge branch 'stable'

commit 40fc150ff49a95e771166da9cf14050d5bc95729
Merge: f8a9643af eec000708
Author: D Corbacho <dcorbacho@users.noreply.github.com>
Date:   Fri Jul 29 10:30:44 2016 +0100

    Merge pull request #896 from rabbitmq/rabbitmq-server-895
    
    Bump default VM atom table limit to 5M

commit 070182621ff16643080cefad57a3df4c57fe0466
Merge: 2288c7455 5bcf3bafa
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 28 16:18:28 2016 +0300

    Merge branch 'stable'

commit f8a9643af5973ec51569cc122d128c68f6910411
Merge: 0c316fc3b 5bcf3bafa
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 28 17:17:33 2016 +0400

    Merge pull request #894 from lemenkov/toctou_in_cluster_status
    
    Don't die in case of faulty node

commit eec000708b124753a474fba476c2cd181f983638
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 28 15:38:48 2016 +0300

    Bump default VM atom table size to 5M
    
    See #895 for background and reasoning.
    
    Fixes #895.

commit 5bcf3bafa558ec361002e87c89b3f0b6b3a14069
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Fri Jul 22 17:15:02 2016 +0200

    Don't die in case of faulty node
    
    This patch fixes TOCTOU issue introduced in the following commit:
    
    * rabbitmq/rabbitmq-server@93b9e37c3ea0cade4e30da0aa1f14fa97c82e669
    
    If the node was just removed from the cluster, then there is a small
    window when it is still listed as a member of a Mnesia cluster
    locally. We retrieve list of nodes by calling locally
    
    ```erlang
     unsafe_rpc(Node, rabbit_mnesia, cluster_nodes, [running]).
    ```
    
    However retrieving status from that particular failed node is no longer
    available and throws an exception. See `alarms_by_node(Name)` function,
    which is simply calls `unsafe_rpc(Name, rabbit, status, [])` for this
    node.
    
    This `unsafe_rpc/4` function is basically a wrapper over `rabbit_misc:rpc_call/4`
    which translates `{badrpc, nodedown}` into exception. This exception
    generated by `alarms_by_node(Name)` function call emerges on a very high
    level, so rabbitmqct thinks that the entire cluster is down, while
    generating a very bizarre message:
    
            Cluster status of node 'rabbit@overcloud-controller-0' ...
            Error: unable to connect to node 'rabbit@overcloud-controller-0':
            nodedown
    
            DIAGNOSTICS
            ===========
    
            attempted to contact: ['rabbit@overcloud-controller-0']
    
            rabbit@overcloud-controller-0:
              * connected to epmd (port 4369) on overcloud-controller-0
              * node rabbit@overcloud-controller-0 up, 'rabbit' application running
    
            current node details:
            - node name: 'rabbitmq-cli-31@overcloud-controller-0'
            - home dir: /var/lib/rabbitmq
            - cookie hash: PB31uPq3vzeQeZ+MHv+wgg==
    
    See - it reports that it failed to connect to node
    'rabbit@overcloud-controller-0' (because it catches an exception from
    `alarms_by_node(Name)`), but attempt to connect to this node was
    successful ('rabbit' application running).
    
    In order to fix that we should not throw exception during consequent
    calls (`[alarms_by_node(Name) || Name <- nodes_in_cluster(Node)]`), only
    during the first one (`unsafe_rpc(Node, rabbit_mnesia, status, [])`).
    
    Even more - we don't need to change `nodes_in_cluster(Node)`, because it
    is called locally. The only function which must use
    `rabbit_misc:rpc_call/4` is `alarms_by_node(Name)` because it is
    executed remotely.
    
    See this issue for further details and real world example:
    
    * https://bugzilla.redhat.com/1356169
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 995c430fbb1981d81f8c18740153c611c49fda4d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 26 16:24:22 2016 +0300

    Correct a type spec

commit d4aaae97b672e2b630eac48ce1e5cf40d1b0afba
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 26 15:00:04 2016 +0300

    Use ?PER_VHOST_COUNTER_TABLE here

commit 2288c7455449c5043fd0612a9fc8cc25edb99082
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:50:58 2016 +0200

    dynamic_ha_SUITE: Disable random policy tests for now
    
    ... while known failures are being investigated. This should unblock
    downstream tasks in Concourse.
    
    References #889.
    [#126767013]

commit d4c8dbc5caa0336b201f1197f2650b4da069b3b8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:50:35 2016 +0200

    dynamic_ha_SUITE: Log the failing set of policies
    
    References #889.
    [#126767013]

commit 0fdce27055a3391d9a33945d33a5ca803f48ea13
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 22 13:47:36 2016 +0200

    dynamic_ha_SUITE: Add a new kind of failing set of policies
    
    References #889.
    [#126767013]

commit 37d4fc789d89a1ff981bd8d771013014b4d05147
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Jul 22 10:24:28 2016 +0300

    Fix longname-mode on hosts without detectable FQDN
    
    Server startup and CLI tools fail in longnames-mode if erlang is not
    able to determine host FQDN (with at least one dot in it).
    
    E.g. this can happen when you want to assemble a cluster using only
    IP-addresses, and you completely don't care about FQDNs.
    
    And it was not possible to alleviate this situation using any options
    from http://erlang.org/doc/apps/erts/inet_cfg.html
    
    Fixes #890

commit 9adb6cd23905ce01d987ec3dfdef515768b4d208
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 22 05:33:09 2016 +0300

    Keep track of connections, introduce per-vhost limits
    
    Fixes #500, #627.
    
    Squashed commit of the following:
    
    commit 88036dccbb28828ceed39d793b13a2d3d3b99b80
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Thu Jul 21 03:31:25 2016 +0300
    
        Refactor
    
    commit fc84b7a23735352da4cf95726b430fad984b837d
    Merge: df745e2 df28c63
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 20 18:30:19 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit df745e2544824b882d174b99d1d4470d05ac78c8
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 20 18:04:59 2016 +0300
    
        Force close connections when vhost is deleted
    
        Fixes #627, related to #500.
    
    commit 2167f8ffebe9473af482816822bb30a0694a1f3e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 20 16:00:35 2016 +0300
    
        Add tests for per-vhost connection limits
    
    commit 2a032a3ac9cc3b01b07692456590e213e5d28806
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 20 01:53:07 2016 +0300
    
        Rename a few tests
    
    commit 86ce592db1516bb216d6dc45326ea80f55d14a30
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 20 01:44:10 2016 +0300
    
        Tests for connection re-registration idempotency
    
    commit a774c7bebe0d91c18af1a2035697c431dca28d89
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Tue Jul 19 04:05:20 2016 +0300
    
        Ask nodes that come back to re-register their connections
    
        Depending on the partition handling mode used there may or may not
        be any clients still connected. We make sure that registration
        and deregistration functions are idempotent and assume there
        may be connections on the node that has come back.
    
        Point of improvement: when a node comes back up, N-1 nodes
        will tell it to re-register connections. It could be fewer
        than N-1, ideally just 1.
    
    commit 24e4c0e690f192d138e70000ada6335671275f0b
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Mon Jul 18 17:05:17 2016 +0300
    
        Fix boot step
    
    commit 62da3c6a73b96d4a07e69a9b1f5519ae708817a6
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Mon Jul 18 11:16:21 2016 +0300
    
        Compile
    
    commit b656f9e96bc4a55072c2092289c52e972c44f754
    Merge: f2831e1 492406e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Thu Jul 14 15:25:49 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit f2831e14cd12fc242b5280326ce1cf28a1fc9766
    Merge: e5858e9 7b10a4e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Thu Jul 7 13:45:31 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit e5858e971825d50032e41794f68692c3d9ffa381
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 6 12:32:56 2016 +0300
    
        Towards working connection re-registration after (inter-node) network splits
    
    commit 548df732f17d4e30268cef4c1b2046b8c03613ef
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jul 6 12:32:07 2016 +0300
    
        Make network split simulation work as expected
    
    commit 4028c660b96b31123f3a932d17d7b8a23b08cfb6
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Tue Jul 5 14:43:37 2016 +0300
    
        Close connections using rabbit_ct_client_helpers
    
        Per discussion with @dumbbell.
    
    commit 26fecc97aa6c4368ecc7dba4464cca8f9ea08cfa
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Tue Jul 5 04:17:52 2016 +0300
    
        Extract connection limit partition tests into a separate suite
    
    commit 8a466f1b61e3cb07ba639d5f09d260223c0ff0a4
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Tue Jul 5 04:17:41 2016 +0300
    
        Better logging
    
    commit b06de9b26ee13742290f13b32e293a990c3d5192
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Mon Jul 4 02:54:54 2016 +0300
    
        Modify a test so that it (expectedly) fails
    
    commit 078a78ae00a88566e2b7068a63457e58e149e09e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Mon Jul 4 02:44:58 2016 +0300
    
        Towards covering node termination/unavailability in connection tracking
    
    commit ab99361041fd58371ddd0c1a76ab2a37a3c47142
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sun Jul 3 15:25:10 2016 +0300
    
        These are moved to rabbit_ct_broker_helpers
    
    commit 520b6ef2b268e263fe4a0d33fbc578343c7ebf83
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sun Jul 3 03:54:52 2016 +0300
    
        {allow,block}_traffic_between/2 are moved to rabbit_ct_broker_helpers
    
    commit b842eaa616d55ca813012d6afc3e3d9d85acb46f
    Merge: 26eb1fa d4f031e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sun Jul 3 03:14:27 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 26eb1fa0ede083f67f7f7177064f0274ebcd8530
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sun Jul 3 02:39:09 2016 +0300
    
        dist_proxy helpers moved to rabbit_ct_broker_helpers
    
    commit 3d741f445be053222eaa73c973257114c17aea1c
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sun Jul 3 01:28:44 2016 +0300
    
        Cluster node shutdown test
    
    commit 57c7129edf583120d3f20702ea68a8c2a73cf136
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 23:01:46 2016 +0300
    
        Refactor
    
    commit b736b30724828027d77a34cddf9f4bcb17b1773d
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 22:49:42 2016 +0300
    
        More tests
    
    commit dc1cb5f0797cba5840fc1fa5e98a0d688383c713
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 22:27:16 2016 +0300
    
        More tests
    
    commit e94edfed7a19add20545f40cd9dc78562546e163
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 17:08:34 2016 +0300
    
        Initial per-vhost connection limit tests
    
    commit 15b7b4e271eedea9ce02bcbbd766609fa9fe970d
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 15:04:57 2016 +0300
    
        Adapt to master, compile
    
    commit dc7f3337a8a0a268c42857becdd92640deddb1a4
    Merge: e4884ff bb1fa55
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Sat Jul 2 02:44:18 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit e4884ffb29452fcdbd11ace1ac7b4d1b7d506b03
    Merge: 71e2710 f0f43f8
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Wed Jun 29 14:27:40 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 71e2710948d3a531c5426b18d63367fddf98ff55
    Merge: b1ec9f3 704a2b5
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Thu Mar 31 01:55:29 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
        Conflicts:
            src/rabbit_control_main.erl
            src/rabbit_types.erl
    
    commit b1ec9f30c4b896f227d3e8800d60b2934996f39e
    Author: Michael Klishin <mklishin@pivotal.io>
    Date:   Mon Feb 15 13:51:37 2016 +0300
    
        Stub out event handlers for #627 and #628
    
    commit f3cfb57e2e83436e51d7d065edd04cc9197b6539
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Sat Feb 13 01:33:50 2016 +0300
    
        Use a counter column to track number of connections per vhost
    
        Limit query time is now 50-70 microseconds for
        50M connections.
    
    commit e9132f11253972ff6b0cc09529e9cd39ba67c140
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Fri Feb 12 06:23:51 2016 +0300
    
        Ignore ./debug
    
    commit 976e3ae10ba7e81c3ead1d2bd1fc852b0f9e3004
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Fri Feb 12 06:20:01 2016 +0300
    
        Switch to ets:select_count/2
    
    commit ec23cf15ad840da46c321e965081815173989197
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Thu Feb 11 05:11:08 2016 +0300
    
        Enforce max connection limit
    
        Also introduce `rabbitmqctl clear_vhost_limits`
        and fix rabbitmqctl(1).
    
    commit ba20887832170f9c9b88e19cad06e0995f887b5b
    Merge: 49a1886 8974581
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Thu Feb 11 02:16:24 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 49a18867faf6e38c08ad12635e716d7ff53b0529
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Feb 10 16:45:00 2016 +0300
    
        Spelling
    
    commit 723e6e4e412b81e47f3a9db5451a1342debcf79e
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Feb 10 16:31:34 2016 +0300
    
        Create secondary indices on rabbit_tracked_connection.vhost and username
    
    commit b468c0fa05ce51cebff19098b500ccc217542f9f
    Merge: 6940d05 0120438
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Feb 10 12:23:38 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 6940d059cf3f844b2aab9cfe00652f23f9a6ad06
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Mon Feb 8 01:30:03 2016 +0300
    
        Spam
    
    commit 032c2a67f59889dbec6a3ca6c5af23920a0d7cb2
    Merge: 46da39c 2374ae8
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Fri Feb 5 23:48:38 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 46da39c5f5e801939a61b476e577636d30eb6e54
    Merge: 655e351 05361e6
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Feb 3 11:20:08 2016 +0300
    
        Merge branch 'master' into rabbitmq-server-500
    
    commit 655e3512a031c5f57c8c09c5432a5d7671acc6af
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Feb 3 11:19:23 2016 +0300
    
        Store and delete tracked connections in a table
    
    commit 4e849cf936f414a11bf5da3135e7a79c75413642
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Tue Jan 19 17:56:14 2016 +0300
    
        Compile
    
    commit 504adde27cfbdb4f81ddd0e4e25abda23b5f138e
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Tue Jan 19 17:55:08 2016 +0300
    
        Switch to a handler for connection tracking (WIP)
    
    commit 3e1d2b4f65608e2c853ad7be0580050ee38fa4e7
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Tue Jan 19 14:46:09 2016 +0300
    
        Migrations for virtual host limits and tracked connections
    
    commit 7499020af6fa8f2685cbee37ad77f189af6ee1e6
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Fri Jan 8 19:40:36 2016 +0300
    
        Compile
    
    commit f3a11012f05d64d6d62fd5ec45a38fafaef47c49
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Fri Jan 8 19:14:12 2016 +0300
    
        Switch rabbitmqctl set_vhost_limits to use JSON payload values
    
        Just like policies do.
    
    commit 7fc5f1a074ab5a34c33792a8ba25aa107eb0d993
    Author: Michael Klishin <michael@clojurewerkz.org>
    Date:   Wed Jan 6 19:07:50 2016 +0300
    
        Stub out set_vhost_limits in ctl

commit 6ad34a433978b1cb6eaf4db481ac55e4382b3ef4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 20:11:12 2016 +0200

    dynamic_ha_SUITE: Handle the change of queue master PID
    
    We must query the queue master PID before each check and handle `badrpc`
    if the process disappeared.
    
    References #889.
    [#126767013]

commit 630f683626d628dcfac766c231b9d89c61a45c16
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 15:37:02 2016 +0200

    dynamic_ha_SUITE: Explicitely add failing policies found by PropEr
    
    References #889.
    [#126767013]

commit 3faaecf985e42287f7c3709afaa9c72cbb36e366
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 15:35:33 2016 +0200

    dynamic_ha_SUITE: Wait for the last policy to apply a little longer
    
    This fixes some false positives.
    
    References #889.
    [#126767013]

commit a0fb8b82ca817f528a0d0ce87cbcb5eec8ea41ae
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 21 14:54:40 2016 +0200

    dynamic_ha_SUITE: Use an assertion to possibly fail the test
    
    ... instead of raising an exit signal.
    
    While here, use ct:pal/3 as the output function for PropEr, not
    io:format/3. This ensures common_test knows the origin of the message
    and that it's expected.
    
    [#126767013]

commit df28c63f6bb703e953bcda6ffe3cb62915b9d28c
Merge: 78a9220e0 db33a5669
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 14 17:37:05 2016 +0400

    Merge pull request #884 from binarin/rabbitmq-server-818-master
    
    Merge 883 into master

commit db33a5669e3b48f216dd7003a4d076bc3bd992c8
Merge: 78a9220e0 0c316fc3b
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jul 14 15:46:08 2016 +0300

    Merge local `node_health_check` into `master`

commit 78a9220e077f79055c225f0f319cbabe13eb3c50
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 14 15:44:09 2016 +0300

    Update rabbitmq-components.mk

commit 0c316fc3b6c135236fb0a267b31595dc5762f9eb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 14 15:37:27 2016 +0300

    Update rabbitmq-components.mk

commit da2e0bf6892623dbdb838317cd93867e1ac8dc14
Merge: f091ba4be b36f79044
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 14 16:29:41 2016 +0400

    Merge pull request #873 from rabbitmq/rabbitmq-server-612
    
    Tune scheduling bind flags for Erlang VM

commit b36f79044511465a8f1d2aa3cce6ee8a8a1b530b
Author: Karl Nilsson <knilsson@pivotal.io>
Date:   Thu Jul 14 12:35:03 2016 +0100

    use the default_bind bind type

commit f091ba4be07c1c50887ca81c62f954d1dfaf350b
Merge: 3448f97e0 73e2f6111
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 14 14:34:37 2016 +0300

    Merge branch 'binarin-rabbitmq-server-818' into stable

commit 73e2f61116c31dacff05f56166f2a2677ea5c839
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 14 14:34:17 2016 +0300

    Run client helper tear down steps before broker's

commit ee00aa44a11b70b0a8438f203a59399c77fc79c7
Author: Karl Nilsson <knilsson@pivotal.io>
Date:   Thu Jul 14 12:00:22 2016 +0100

    remove stale comment

commit 489293b05936aa502ba0acaa12e6777df25bf367
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jul 14 13:31:49 2016 +0300

    Add `node_health_check` test suite

commit d14f8647d92c866ab384c3fffaea405ffb77c354
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jul 14 13:29:27 2016 +0300

    Reuse timeout/error logic for `node_health_check`

commit 7b36b7ff75d5d7cea98b40690fd7b19c983b9c5c
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Jul 13 18:15:04 2016 +0300

    Default timeouts: fix global/add per-command
    
    - Global timeout `?RPC_TIMEOUT` was not used, because default value of
      infinity was always introduced via `?TIMEOUT_DEF`. Now `infinity` is
      used for commands without timeout support, and `?RPC_TIMEOUT`
      otherwise.
    
    - `?COMMANDS_WITH_TIMEOUT` now can contain per-command default values
      for timeout, using tuple `{Command, DefaultTimeoutInMilliSeconds}`
      instead of just `Command`.

commit 492406e2c4a39f41351fdc5b5ab71b2d25ddce1b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 14 13:19:56 2016 +0300

    Update rabbitmq-components.mk

commit 3448f97e0ab6c6978066f937a14d467ad9b2d6ca
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 14 13:19:56 2016 +0300

    Update rabbitmq-components.mk

commit c93d5366e9353a7319c2f7e04acb5309bea5e74e
Author: Karl Nilsson <knilsson@pivotal.io>
Date:   Thu Jul 14 11:19:17 2016 +0100

    Set scheduler bindings in rabbitmq-env.bat for windows
    rename SCHEDULING to SCHEDULER in line with erlang documentation

commit 179873dc29cfd156986d0a02f61e8961f8edcda6
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Jul 13 11:03:50 2016 +0100

    Renaming

commit 00f995b5030e51380d35363a93847c076c74daa8
Merge: 33986b6b5 bd21a6903
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 13 06:11:22 2016 +0300

    Merge branch 'stable'

commit bd21a6903455c3efe2b8f67da262b0ef19a37ca9
Merge: 079ac7f2e ab1ed2c87
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 13 06:10:18 2016 +0300

    Merge branch 'binarin-rabbitmq-server-fix-join-cluster-when-already-member' into stable

commit ab1ed2c879dff4d090e493f06572db841471a025
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 13 06:09:26 2016 +0300

    Wording

commit 4ecdb1413de429f0c21ef73a32fea098140f6121
Merge: 079ac7f2e 1e3810ad5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jul 13 03:42:37 2016 +0300

    Merge branch 'rabbitmq-server-fix-join-cluster-when-already-member' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-fix-join-cluster-when-already-member

commit 33986b6b52824eaf65e2769acdca4fa3ecd29f2f
Merge: 057e7aed8 079ac7f2e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jul 12 21:53:47 2016 +0300

    Merge branch 'stable'

commit 079ac7f2e5e2bc6966126968f939cdd5141cdf01
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 12 17:13:57 2016 +0100

    Handle paths with spaces on disk volumes with 8.3 name creation disabled

commit 057e7aed8412875c6a205774e9faf35cda2f821f
Merge: 6bd09d586 d49fb88cd
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jul 12 22:52:36 2016 +0400

    Merge pull request #882 from rabbitmq/rabbitmq-server-859
    
    Handle paths with spaces on disk volumes with 8.3 name creation disabled

commit d49fb88cd841af69b44dbe0be2d4c47015b29fce
Author: kjnilsson <knilsson@pivotal.io>
Date:   Tue Jul 12 17:13:57 2016 +0100

    Handle paths with spaces on disk volumes with 8.3 name creation disabled

commit 6bd09d5864e4c440b9b2f18e08f8a38f87ddb14b
Merge: 12edd78f5 d04cb67d1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 8 22:48:58 2016 +0300

    Merge branch 'stable'

commit 12edd78f54086aef6dcbfd48200e1204a295cf50
Merge: b2bb29e57 222b4f443
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 8 19:01:43 2016 +0300

    Merge branch 'binarin-rabbitmq-server-lager-internal-sink-overhead'

commit 222b4f44332a9baacdbd4ac7e092e796f0adef7f
Merge: b2bb29e57 1be5fc5ee
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 8 16:32:11 2016 +0300

    Merge branch 'rabbitmq-server-lager-internal-sink-overhead' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-lager-internal-sink-overhead

commit d04cb67d10d95d2482408bc6d5dac7b49e1db3ed
Merge: aeb5c6b6d 730ffa5f9
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 8 17:17:14 2016 +0400

    Merge pull request #855 from rabbitmq/rabbitmq-server-839
    
    Use separate index to store dying clients file offsets

commit b2bb29e577193efc38d4e94b15da0052aaa5977a
Merge: 7b10a4efb aeb5c6b6d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 8 16:15:32 2016 +0300

    Merge branch 'stable'

commit aeb5c6b6d3e376732e03d0788cd9c76e7a79e3c4
Merge: 6c135d9ff 41dd04a2d
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 8 17:12:17 2016 +0400

    Merge pull request #877 from rabbitmq/rabbitmq-management-244
    
    Use rabbit_misc to parse GC stats, supporting maps in R19

commit 1be5fc5eea6564552827ccd5980b2f04515cd2a2
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jul 7 19:04:36 2016 +0300

    Improve logging performance
    
    Noticed dobule atom_to_list/list_to_atom roundtrip while profiling. Not
    too significant, but it still caught my eye because it was happening for
    every line in log.
    
    I think this a missing part for
    https://github.com/rabbitmq/rabbitmq-common/commit/46c78094c69a769ba35bea86ed55bf6c48e8a163
    
    And with unrolling predefined sinks it should avoid
    atom_to_list/list_to_atom roundtrip completely.

commit 41dd04a2d1a83a50099ee1072ad0fd61a97281a4
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jul 7 15:37:15 2016 +0100

    Use rabbit_misc to parse GC stats, supporting maps in R19

commit 7b10a4efb35f211a2f705efdae16b3efa9c12762
Merge: c72013ec6 6c135d9ff
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jul 7 00:13:01 2016 +0300

    Merge branch 'stable'

commit 6c135d9ff3adcaf6118eb0bf749e36317b666e42
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jul 6 19:48:24 2016 +0100

    Commit Debian and RPM change logs

commit c72013ec63479cf643806e6af9dbae7237e841ef
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 6 13:44:00 2016 +0200

    Only use new non-builtin types in master
    
    We only support Erlang 18.3+. Therefore we can revert what was done in
    b6a3aa477156036c129d04a82c90ad916bc3865e.
    
    [#118562897]

commit 02807ba720feb3482966c312f5dddf0c14ba1599
Merge: 082314022 b6a3aa477
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 17:43:21 2016 +0200

    Merge branch 'stable'

commit b6a3aa477156036c129d04a82c90ad916bc3865e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 17:42:52 2016 +0200

    Fix testsuite build on Erlang R16B03 by using macros for old builtin types
    
    Those macros are provided by `old_builtin_types.hrl` in rabbitmq-common.

commit 0823140224efbe3867fb90397390745a34ea7243
Merge: 229118599 d73ad99a6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 17:33:00 2016 +0200

    Merge branch 'stable'

commit d73ad99a62dfe4a136488f7320082c22e459e7cc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 17:18:49 2016 +0200

    Travis CI: Do not set CT_OPTS, it's handled by rabbitmq-build.mk

commit 27cc58563327225a6f63481d7ff2766d924c207f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 17:18:28 2016 +0200

    Use CT_OPTS from rabbitmq-build.mk

commit aca15d5950fe99044e815ff2a48a1e563c073fa0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 16:21:54 2016 +0200

    Travis CI: Turn off error_logger messages
    
    Hopefully the testsuite should be quiet enough now.

commit 6e44654fc4d5b4d6079461dc91b2db64967311d4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 16:06:43 2016 +0200

    Travis CI: Test against Erlang 18.3 and 19.0

commit 0af8986c232acc8121062334a5739a822d1fc669
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 5 15:55:59 2016 +0200

    Fix build on Erlang R16B03 by using macros for old builtin types
    
    Those macros are provided by `old_builtin_types.hrl` in rabbitmq-common.

commit d956c5cb97ff0e9a95d14d307e67aabcfaaa1c63
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jun 30 13:20:35 2016 +0100

    Tune scheduling bind flags for Erlang VM

commit 22911859952542028638336e42acdadcf68afdba
Merge: d4f031e25 9e5fdbf75
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jul 3 15:29:52 2016 +0300

    Merge branch 'stable'

commit 9e5fdbf75d385fd4c356da11849dfe3c0910f57e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 3 15:25:10 2016 +0300

    These are moved to rabbit_ct_broker_helpers

commit ca99a3edaffea883f5190aa6fc444e21afe0019f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 3 03:54:52 2016 +0300

    {allow,block}_traffic_between/2 are moved to rabbit_ct_broker_helpers

commit d4f031e25d28bdfa01c676e6b7099bf39e4a4215
Merge: 745f6136f a9f5d3884
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jul 3 03:11:45 2016 +0300

    Merge branch 'stable'

commit a9f5d3884121ce041965517df25b07c7cd8ce87d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 3 02:39:09 2016 +0300

    dist_proxy helpers moved to rabbit_ct_broker_helpers

commit 745f6136f50cad5e3a21f877b265f540745a02e7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 3 02:39:09 2016 +0300

    dist_proxy helpers moved to rabbit_ct_broker_helpers

commit bb1fa5565563ae97057a9489e0aabd3922b12855
Merge: 320774f25 1abf4b3c5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 1 20:36:38 2016 +0300

    Merge branch 'stable'

commit 1abf4b3c5c9de7e448ac11fba83292f274060fa3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 18:06:10 2016 +0200

    Travis CI: Use "if/then" instead of "cmd && cmd" for conditional steps

commit 434e327878f4d3de2490d16cd5bd27990a6ca057
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 17:59:20 2016 +0200

    Travis CI: Fix the `$GROUP` env. var. matrix

commit f7b7b6a4d0ced42764b93df7c70a3ef1336191b6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 17:20:29 2016 +0200

    Travis CI: And fix another syntax error...

commit 787471adda71270389f690f02b1e3a5009bc15e0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 17:05:06 2016 +0200

    Travis CI: Fix stupid syntax error

commit 03f10dbd95df1febdde36e765cbb8eb549164a35
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 1 15:02:12 2016 +0100

    Hardcode init-system-helpers dependency to be Ubuntu 14.04 (or later)-compatible
    
    Now that systemd support is introduced,
    there is an issue with package dependencies between Ubuntu 14.04 and 16.04.
    
    We produce releases on Debian Wheezy which specifies init-system-hlpers 1.18 as a dependency.
    Unfortunately that version is not available on Ubuntu 14.04, only 1.14 is.
    
    So we primarily have 4 options for the short term:
    
     * Revert systemd support and upset 16.04 users
     * Drop 14.04 support and upset 14.04 users
     * Switch to Ubuntu 14.04 for producing Debian packages and hope it will work on Debian
     * Hardcode the dependency
    
    Options 3 and 4 seem to be the least of all evils. We will evaluate option 3
    separately.

commit 78c7f7bf98a47162f1eb31923bafc3619e519c6a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jul 1 15:16:55 2016 +0300

    Update Uploaders list

commit 62a4ad873ef726b5a6379a6453975bb56da57c9c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 12:17:51 2016 +0200

    Travis CI: Lower verbosity of common_test
    
    Out-of-the-box, it spits more than 4 MiB of messages, which is above the
    limit imposed by Travis, causing a build failure.
    
    While here, remove the use of `travis_wait` because our common_test
    helper make sure we log at least a message every minute.

commit 4149120c20010a8c2e7698eb53e0575bc451c298
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 1 12:16:36 2016 +0200

    Travis CI: Import Git branch handdling from rabbitmq-shovel

commit 1e3810ad57e6db46265b1324b3908122f613d13e
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jun 30 19:29:04 2016 +0300

    Report join_cluster errors more thoroughly
    
    Because `{ok, _}` should mean OK, and `{error, _}` should be a real error.
    
    With the addition of
    https://github.com/rabbitmq/rabbitmq-common/pull/115
    `rabbitmqctl join_cluster` will become consistent.

commit 320774f250af30ae32f96cef6730447a22e63bc9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 30 17:31:25 2016 +0200

    Use `rand` directly in master because we require Erlang 18.3
    
    References rabbitmq/rabbitmq-server#860.
    [#122335241]

commit d600f4ba74c3b6d1c157369b9253a55b4a2589d3
Merge: f67a8477d ef4146b48
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 30 16:12:19 2016 +0300

    Merge branch 'stable'

commit ef4146b4823f56bc8cd6c8509a4c9a32682fceea
Merge: c0bd3bac9 1965e836a
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 30 16:01:42 2016 +0300

    Merge pull request #866 from rabbitmq/rabbitmq-management-825
    
    Include metrics for the time it takes to obtain a file handle

commit 1965e836ab971e52d1734ec554042c385f75108f
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jun 30 09:26:37 2016 +0100

    Include metrics for the time it takes to obtain a file handle

commit f67a8477dee59e79a66c9ed464f04af6d559e811
Merge: f0f43f800 c0bd3bac9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 29 19:17:11 2016 +0300

    Merge branch 'stable'

commit c0bd3bac9ec8ed7d6dd64c8039bf33758add92cf
Merge: 0923c9676 c72afe6bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 29 19:13:55 2016 +0300

    Merge pull request #858 from rabbitmq/rabbitmq-management-211
    
    Report queue reductions per second and GC options

commit c72afe6bc1794ef85515743bf53400c6ea4e6dfb
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Jun 29 14:22:00 2016 +0100

    Report reductions and garbage collection options in queue processes

commit f0f43f8002678451bdb1e1d7ccdd5e7723949625
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 29 12:01:23 2016 +0200

    Use `rand` directly in master because we require Erlang 18.3
    
    References rabbitmq/rabbitmq-server#860.
    [#122335241]

commit fbad57dfe085c1f1d6fe73bfe6bfab3188a91b15
Merge: b655d4cef 0923c9676
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 29 11:59:32 2016 +0200

    Merge branch 'stable'

commit 0923c9676fa7a1e5a839551ed6a11bb8192ff2c6
Merge: f7c54b9a7 35d9cf6f6
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 29 00:10:28 2016 +0300

    Merge pull request #861 from rabbitmq/rabbitmq-server-860
    
    Compile on OTP 19.0

commit 35d9cf6f67040aa53f0627734aa462fb92b8ed14
Merge: 2735990fc f7c54b9a7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 28 22:58:53 2016 +0300

    Merge branch 'stable' into rabbitmq-server-860

commit f7c54b9a7caaa9c3655fe8cfeccec8deaa28ca5c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 28 22:58:25 2016 +0300

    Ignore debug/*

commit 2735990fcc5907613c053d16ce86686662c39dc3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 28 15:56:17 2016 +0200

    Use the new `rand_compat` module to transition from `random` to `rand`
    
    References #860.
    [#122335241]

commit fa20bbcc482e3bd09678351191ee9a296113b3dc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 28 15:26:41 2016 +0200

    Use the new -spec format
    
    The old format is removed in Erlang 19.0, leading to build errors.
    
    Also, get rid of the `use_specs` macro and thus always define -spec() &
    friends.
    
    While here, unnify the style of -type and -spec.
    
    References #860.
    [#118562897]
    [#122335241]

commit d27a16388d28e753120f30b047ab64077abb9f88
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 28 15:55:20 2016 +0200

    Git: Ignore `xrefr`

commit b655d4cef1a835aed5f8b7be6095a6ce4bf88529
Merge: 16851f9ea e0051b72b
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 28 16:19:29 2016 +0300

    Merge pull request #865 from rabbitmq/rabbitmq-server-863
    
    Stop pending slaves on restart

commit e0051b72b1e6926ab8e023dec86d9b15833cc064
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 28 16:13:38 2016 +0300

    Set rabbit.slave_wait_timeout back to 15s at the end of this test

commit 7b061c717174fc176e322e77e1b011c04977e6a0
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 28 10:00:08 2016 +0100

    Test for stop pending slaves

commit 6fed347626931ef12a04aba0ac0e5d47d59bc24f
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Jun 22 15:02:31 2016 +0100

    Ensure old incarnations of slaves are stopped before new ones start
    
    * Solves race condition between master asking to stop and the restart
      of the queues.

commit 16851f9ea5f727e6bf219def5816e394a8b7819c
Merge: c824c9dd1 dd25bf944
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 28 10:21:57 2016 +0100

    Merge branch 'stable'

commit dd25bf9445eccdf148dfbd9fdfe59180b1f6b1d4
Merge: ebd33bab5 b6aaf5351
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 28 02:20:56 2016 +0300

    Merge pull request #857 from rabbitmq/rabbitmq-server-802
    
    Infinity loop in synchronisation of priority queues

commit b6aaf53513ae5b8d909a714f53389fc5bd3445c8
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Mon Jun 27 16:17:10 2016 +0100

    Fix tests cleanup

commit af644c24d5805ee432ac53e9caa2f814b8d07fac
Merge: 5b330057b ebd33bab5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 27 16:33:26 2016 +0300

    Merge branch 'stable' into rabbitmq-server-802

commit 5b330057b2eaf5781c4a18398c49bf79769c1c2a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 27 14:36:26 2016 +0300

    Re-enable more tests

commit 9f30621e86abcb7bccb1534b9bfede44b50c589e
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Mon Jun 27 14:30:21 2016 +0100

    Restore invoke clause

commit c824c9dd19341cdd0e8a48ff02d846abf9c9c313
Merge: a62865540 ebd33bab5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 27 16:07:53 2016 +0300

    Merge branch 'stable'

commit ebd33bab54474ea13653a2861314e93151aad4bc
Merge: b9d7e4d7e 8e8787966
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jun 27 16:06:49 2016 +0300

    Merge pull request #862 from rabbitmq/rabbitmq-server-854
    
    Avoid index reset when publisher confirms are pending

commit ab03861f77395b99249274d1a023dcd414036e8a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 27 14:29:39 2016 +0300

    Use a separate connection per test

commit 730ffa5f906f6e1aca34a333d5d6c7350ed3e2dd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 27 00:10:56 2016 +0300

    Be more lenient when deleting dying client entries
    
    If no entry was deleted, that's suspicious but it's certainly more
    important to keep queue process functional.

commit 736a61d9a73fcd9ead3b5358cb9e9d4f17728805
Merge: 2e1ae067b b9d7e4d7e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jun 26 21:57:26 2016 +0300

    Merge branch 'stable' into rabbitmq-server-839

commit 8e8787966d087c8400eddfd9f471ef7d60094342
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Jun 24 12:30:32 2016 +0100

    Avoid index reset when publisher confirms are pending

commit f5a4d26d638be14a139e72335c0bb65a6ff363c5
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jun 23 15:41:28 2016 +0100

    Tests for 802 issues and related race conditions

commit a62865540cf6f0a55ad22a455c0c9f88597d43ea
Merge: 014fa86bd b9d7e4d7e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 23 02:12:08 2016 +0300

    Merge branch 'stable'

commit b9d7e4d7e4699e927e978ea3bb7393da11491655
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 23 02:11:30 2016 +0300

    terminate/2 now returns ok

commit 716a43bbd34786b5052b2ca4f2b46e6516958aa0
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 21 08:20:37 2016 +0100

    Erase index on crash recovery for any backing queue
    
    It is up to the individual implementation to decide what to erase,
    i.e. priority queues have one index per priority

commit 3cc9a1c135371af04281bbee85862b5944a1ac4b
Merge: 81ff300a4 92b3ef121
Author: Karl Nilsson <kjnilsson@gmail.com>
Date:   Wed Jun 22 13:24:14 2016 +0100

    Merge pull request #853 from rabbitmq/rabbitmq-server-852
    
    Include rabbitmq_top into server distribution

commit 92b3ef1212d4faba84939a90c6fe9883860d7444
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 21 23:30:27 2016 +0300

    Include rabbitmq_top into server distribution
    
    Fixes #852.
    
    [##121992375]

commit 2e1ae067bef44838e191647d4c1c1b69c183b10c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 21 15:24:05 2016 +0100

    Use separate index to store dying clients file offsets

commit 5f1ffc6b2834aca32674121ed723e6b7e632a54e
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 21 08:17:49 2016 +0100

    Priority queues: retrieve max priority from state in invoke
    
    Neither amqqueue_process, master or slave modules are aware of
    the priority data expected by this function, it must be stored
    and retrieved internal.

commit 014fa86bde7a64b75f95f1db44ace6a5b2657d6d
Merge: 95e11692f 81ff300a4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jun 19 00:28:11 2016 +0300

    Merge branch 'stable'

commit 81ff300a43640acd7a6c36f2dc31a73f8dc05bb2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jun 18 23:52:28 2016 +0300

    Gracefully handle cases when logging exchange does not exist
    
    Client test suites that test connection recovery by
    restarting RabbitMQ ocassionally lead to a situation when
    amq.rabbitmq.log in the "/" vhost can be unavailable for a split
    second.
    
    Default vhost may or may not exist in general. So handle {error, not_found}
    responses from rabbit_basic:publish/4 instead of potentially seriously
    polluting logs with confusing exceptions.
    
    While at it, return a sensible value from terminate/2.

commit 95e11692fea19715fd0ce93573a4f07dd21468f9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 16 13:12:36 2016 +0100

    Set bounded timeout for OTP workers

commit cd73f98a6d2a2b0b1c55b0a7f6aebfc05a32a5dc
Merge: 089645318 6bceb552a
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jun 17 01:07:16 2016 +0300

    Merge pull request #846 from rabbitmq/rabbitmq-server-541
    
    Set bounded timeout for OTP workers

commit 6bceb552a762fc0473624e62fe4af3e6e0317deb
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jun 16 13:12:36 2016 +0100

    Set bounded timeout for OTP workers

commit a9885e7a893c261d902e80029b81697bd5d69c01
Merge: 22a6d88fc 089645318
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 15 17:48:51 2016 +0200

    Merge branch 'stable'

commit 089645318fbe56394935466537e7cf9c77809f21
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 15 17:39:13 2016 +0200

    priority_queue_SUITE: Use the new open_connection_and_channel() helper

commit 22a6d88fc1c5f5008e86b7a9ed5054d06f918f04
Merge: 47639b5bd da7b6b137
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 15 03:31:07 2016 +0300

    Merge branch 'stable'

commit da7b6b137fea2d7749619a5a10c9d25036579704
Merge: d8d72f128 c1b917cc1
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 15 03:14:09 2016 +0300

    Merge pull request #843 from rabbitmq/rabbitmq-server-837
    
    Removed confusing code from rabbit:stop

commit 47639b5bd91f55d60cf5a6bd12d7bbe82c8805ae
Merge: 538814318 d8d72f128
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 14 22:50:54 2016 +0300

    Merge branch 'stable'

commit d8d72f12867599a1687b32a99a50fd4ce8ddbe1b
Merge: 03d015c3b 55acdb577
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 14 22:50:36 2016 +0300

    Merge branch 'rabbitmq-server-687' into stable

commit c1b917cc1857cb3b380bf8079e9295551a04b2b9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 14 14:07:49 2016 +0100

    Unused const

commit 55acdb57727cc2cda19972269693d4c9133d8810
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 14 12:29:56 2016 +0100

    Add tests for order of messages within each priority queue

commit 8fc07bedef4a0d0409696107d415f55846b2ca62
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 14 11:09:16 2016 +0100

    Do not run on_node_down

commit b5ad8e6725a810b0065b3135c5f6b6e0b769d211
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 14 07:40:04 2016 +0100

    Restore original order in batch publish messages
    
    * During the synchronisation of slaves the message's order was
      reverted. Then, acks could not be processed as those msgs
      were not yet dropped.

commit 6b7fc63a5530e5efcd8001aa50a366ab9b23d780
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jun 13 18:18:20 2016 +0100

    Move cleanup to prep_stop

commit 5388143188f8e36274891c9be48438a3342a45c8
Merge: 5ac8307bf 03d015c3b
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jun 9 15:56:36 2016 +0100

    Merge branch 'stable'

commit 03d015c3bd2c86dc6df8413b58e2d780c783af08
Merge: 8c0700e80 765b9c4aa
Author: D Corbacho <dcorbacho@users.noreply.github.com>
Date:   Thu Jun 9 15:55:09 2016 +0100

    Merge pull request #835 from rabbitmq/rabbitmq-server-834
    
    Significantly bump max restarts intensity for worker_pool_sup

commit 765b9c4aaeae2875c176516e38a6d47ff2affc19
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 9 17:42:04 2016 +0300

    Simplify

commit ae501fde2f3e8bea5a4fbd53979027cecc6b9a77
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jun 9 17:03:39 2016 +0300

    Significantly bump max restarts intensity for worker_pool_sup, fixes #834

commit 5ac8307bfa1006964a4714a391bb3240b8311930
Merge: 5104d3314 8c0700e80
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 9 15:56:13 2016 +0300

    Merge branch 'stable'

commit 8c0700e809b9a1efcbb9a8394a9b4241b7c3f415
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 9 15:48:11 2016 +0300

    Correct doc typo

commit 5104d3314a715ae65d7020ab68dce469620975c6
Merge: d10a3b0a1 2db731cb2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 8 18:26:24 2016 +0300

    Merge branch 'stable'

commit 2db731cb2015d9256c791391557d360c860d78ac
Merge: d59ac4c47 cef24b75d
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jun 8 17:55:07 2016 +0300

    Merge pull request #831 from binarin/rabbitmq-server-ocf-bashisms
    
    Fix bashisms in OCF HA script

commit cef24b75d605eae79137b2cdf7b15b373c091ba5
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Jun 8 17:42:26 2016 +0300

    Fix bashisms in OCF HA script
    
    `-` is not allowed in function names by POSIX, and some
    shells (e.g. `dash`) will consider this as a syntax error.

commit d10a3b0a193e33975377997b36a5c625207c3e99
Merge: daa3c3248 d59ac4c47
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 8 02:55:26 2016 +0300

    Merge branch 'stable'

commit d59ac4c4700e370a8bb27864fdcd15cc5dcece19
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 8 02:54:24 2016 +0300

    Extract rabbit_mirror_queue_misc:sync_queue/1 and cancel_sync_queue/1
    
    Having these functions outside of rabbit_control_main makes
    it possible to use them in other tools, e.g. an alternative CLI
    implementation.

commit daa3c3248b51ed4d3fdc2db3851f951838642ca0
Merge: 373b2cd93 734be9304
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 8 00:35:28 2016 +0300

    Merge branch 'stable'

commit 734be9304f1855ee2042d3924c62991ea33eb3d3
Merge: 7e5c76a20 7e1f0b021
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 8 00:34:15 2016 +0300

    Merge branch 'rabbitmq-server-828' into stable

commit 7e1f0b0213560837c46f829b2b1cbdeb89f7d46a
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jun 7 13:58:23 2016 +0100

    Performance improvements on file_handle_cache

commit 373b2cd935e9c7bec375e8532fb8fd574c99e437
Merge: d596334b1 7e5c76a20
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jun 7 16:35:36 2016 +0300

    Merge branch 'stable'

commit 7e5c76a20856bb685f1e5839f06ab6059ebcd219
Merge: d1966c0da d1dc0edc6
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 7 16:25:43 2016 +0300

    Merge pull request #827 from rabbitmq/rabbitmq-management-219
    
    ETS tables memory consumption info

commit d1dc0edc655963e07a2ab0571a0dd4f458b7c6b3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jun 7 13:29:20 2016 +0100

    ETS tables memory consumption info

commit d1966c0dab3d5cccf2d19ae4d4790dfe9c345382
Merge: 6853bb46b 2bba5edb6
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 7 15:03:07 2016 +0300

    Merge pull request #819 from binarin/rabbitmq-server-ocf-cluster-status
    
    Check cluster_status liveness during OCF checks

commit d596334b19389fc5919a536f827f57dea0c2a66c
Merge: 3df0e752d 6853bb46b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 6 15:43:41 2016 +0300

    Merge branch 'stable'

commit 6853bb46b9516a9a06d764a258510659d02b5ef0
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Tue Apr 19 00:52:30 2016 -0700

    Stop match earlier, and added some comments

commit b6db63151efffa7c091702b78aac64f84f4ffcb2
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Tue Apr 19 00:46:07 2016 -0700

    Compare values only on headers match

commit ac7225809362f2df541a656bc0611506566e361a
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Mon Apr 18 14:55:20 2016 -0700

    Match on types deleted and shortcuts algo

commit 3df0e752dde6eff47419b99f7124e81a07f6fbba
Merge: 2b4df8a83 64d9d35f8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jun 6 15:01:21 2016 +0300

    Merge branch 'rabbitmq-server-760'

commit 64d9d35f8c551a846e3004e9efa0777af14017c1
Merge: 60db69567 49b8a4014
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Sun Jun 5 16:04:16 2016 -0700

    Merge branch 'rabbitmq-server-xh-notypeandshortcuts' of https://github.com/sylvainhubsch/rabbitmq-server into rabbitmq-server-xh-notypeandshortcuts

commit 60db6956798b8dbbb664ba4c61080faad9f12441
Merge: 8b9a54c5c 2b4df8a83
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Sun Jun 5 15:56:12 2016 -0700

    Merge remote-tracking branch 'upstream/master' into rabbitmq-server-xh-notypeandshortcuts

commit 2b4df8a8382b9cd62d23165409754b54c5fab2ca
Merge: 7e84bc3ae 4edec0969
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jun 5 02:24:50 2016 +0300

    Merge branch 'stable'

commit 4edec0969fa31c26e9c6020ad1bab33a0491f292
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jun 5 02:22:33 2016 +0300

    Docs correction

commit 7e84bc3ae8be80157e8a42660d9c46db3f2c073b
Merge: 1c3f45409 eb60bcfe5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jun 5 02:18:36 2016 +0300

    Merge branch 'stable'

commit eb60bcfe5dec939d577fbde00b1a140031fb1d03
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jun 5 02:16:15 2016 +0300

    Brief docs for rabbit_amqqueue_process state record

commit 00ea39d4b92ec327bb6234443863610822766f0a
Merge: 249b7fb84 f1f7dac2c
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Jun 3 17:21:47 2016 +0100

    Merge pull request #822 from rabbitmq/rabbitmq-server-820
    
    Fixes #820.

commit 2bba5edb6f78e436a1c1c3d3b9655d9fb821ad6c
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jun 2 19:21:59 2016 +0300

    Check cluster_status liveness during OCF checks
    
    We've observed some `autoheal` bug that made `cluster_status` became
    stuck forever.

commit f1f7dac2cc37e60c3f6a43b66a96104ec0c5d909
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jun 3 15:10:40 2016 +0300

    Fixes #820.

commit 1c3f4540969f22da3c9564e3c9de70f3b2fba240
Merge: 45641a626 f2a8427b7
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 2 16:32:39 2016 +0300

    Merge pull request #754 from rabbitmq/rabbitmq-delayed-message-exchange-3
    
    Support for type-specific exchange info

commit f2a8427b7d44f6de633cfe6abaccee9dc06710a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 2 14:56:45 2016 +0300

    Squash a warning

commit 1ca18072ac3c036e89069733a10f957b0f6df707
Merge: 270997fd4 45641a626
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 2 14:54:44 2016 +0300

    Merge branch 'master' into rabbitmq-delayed-message-exchange-3

commit 45641a62675b1b67b01a5db76056a7d22de68175
Merge: ace33fce6 249b7fb84
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jun 2 11:46:39 2016 +0200

    Merge branch 'stable'

commit 249b7fb84ce52273bfa58ceb9068990151b0dd44
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jun 2 11:45:31 2016 +0200

    unit_inbroker_SUITE: Give one hour for the backing queue tests
    
    In our CI, some tests are hitting the default commont_test timetrap of
    30 minutes.

commit ace33fce695657f22e6853b051d795811b10f6df
Merge: d9f7f8670 0e5c97572
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 1 01:52:51 2016 +0300

    Merge branch 'stable'

commit 0e5c975720bcb70c2de50f88d1d87a4099556855
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jun 1 01:52:05 2016 +0300

    Include rabbitmq_jms_topic_exchange into RabbitMQ distribution
    
    Now that our JMS client is open sourced we can do it.

commit d9f7f86708ac6cfcce4dbc27ea499debe92df31b
Merge: ec5a71d79 df7a84271
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 31 11:38:42 2016 +0200

    Merge branch 'stable'

commit df7a84271155ecc3765c066cf35e3dccc786e31c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 31 11:38:20 2016 +0200

    Backport the use of rabbitmq-build.mk from master

commit ec5a71d79ac5e8e200ce51827a3fb2c4b8887de1
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon May 30 18:04:27 2016 +0200

    config_schema_SUITE: Copy Cuttlefish schema in the testsuite data directory
    
    We must do that instead of adding the plugins as test dependencies
    because doing this introduces a circular dependency: all plugins depend
    on rabbitmq-server.
    
    With the circular dependency in place, the broker was compiled with
    $(ERLC_OPTS) compiler flags, because the build was triggered by the
    first plugin. Therefore we missed all the $(TEST_ERLC_OPTS) additions.
    
    With the circular dependency fixed, the broker is again built with
    $(TEST_ERLC_OPTIS): `src/truncate.erl` depends on the `-DTEST=1` flag.
    
    In the longer term, we must move the testcases depending on the plugins'
    schemas to their corresponding plugin.

commit 455644498e97f91c7005bed85d2519db5f506030
Merge: e0210397f f14ae2212
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 30 00:27:45 2016 +0300

    Merge pull request #814 from rabbitmq/rabbitmq-server-803
    
    Handle concurrent application of HA policy

commit e0210397f3d8328f598d5829d3aa5ba7374f72c9
Merge: f32ae7e94 22ab163dd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun May 29 23:31:37 2016 +0300

    Merge branch 'stable'

commit 22ab163ddbdb254ea384c27bde3814650498c61e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 29 23:21:53 2016 +0300

    Update rabbitmq-components.mk

commit f32ae7e94f1e6c564490628399ffab0a4aef0d16
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 28 14:22:48 2016 +0300

    Update CONTRIBUTING.md, add CODE_OF_CONDUCT.md

commit 58d58398b46d37e28f37365cfbffedc638fbd092
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 28 14:22:48 2016 +0300

    Update CONTRIBUTING.md, add CODE_OF_CONDUCT.md

commit f14ae2212e649d3d1017e0aa3a3ae93b1778cfa8
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 16:05:13 2016 +0100

    Upgrade amqqueue record with policy_version

commit c00bd9f513a97538f428637843db68848bdef063
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 15:07:19 2016 +0100

    Check return value of clear_policy in the test instead of auxiliary function

commit a36787f6c68db4674bc7651547ab8c18b40cc5a9
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 27 14:04:56 2016 +0100

    Test concurrent application of HA policies

commit 38be6a77d2f8322801a61e2222c22fc665990cf0
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri May 27 11:58:32 2016 +0200

    Update policy version on set_policy and use it on update_mirroring

commit 66e6a917f728de933a146cae08590d82434136dc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 27 16:55:44 2016 +0200

    Lager extra sinks are renamed to `rabbit_log_*`

commit 86cb7025488c6ba0e61739d6ae278b79e00f57bd
Merge: 3d6a79027 217488728
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 27 14:45:12 2016 +0300

    Merge branch 'stable'

commit 217488728781c13cda413b6d0308991ba752633d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 27 14:44:16 2016 +0300

    Include rabbitmq_trust_store into RabbitMQ distribution
    
    [Finishes ##120401213]

commit 0ee7b1580ed683a924434cf56250d250123b70a0
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed May 25 07:46:34 2016 +0100

    Take update mirroring decision in rabbit_amqqueue_process

commit 3d6a790272be7ce4bca7fb8f3bf4d5a98a4b2cee
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri May 27 11:28:41 2016 +0200

    Makefile: Add several plugins to TEST_DEPS
    
    Those plugins have a Cuttlefish schema which is needed by
    config_schema_SUITE.
    
    References #725.
    [#116526487]

commit c8bdf334f626e6b5de7837234be8c541396fe2d4
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri May 27 10:41:32 2016 +0200

    Switch testsuite to common_test, part #4
    
    This is a follow-up to the previous merge of the stable branch. It
    covers tests which were modified or added only to the master branch.
    
    References #725.
    [#116526487]

commit dc941fed07171ecbc2a356e095c6e45f8af65de6
Merge: a4c74c5ca 41a512e8c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri May 27 10:39:58 2016 +0200

    Merge branch 'stable'

commit 41a512e8c01f27f776e84ec94319a3e8bbb9f390
Merge: 1adb58bf8 83643e45c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri May 27 10:38:06 2016 +0200

    Merge branch 'rabbitmq-server-725' into stable

commit 83643e45cc43a0f852cc60b27ca3e015635854ff
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 20 16:10:51 2016 +0200

    Switch testsuite to common_test, part #3
    
    The migrated tests are those from `$(WITH_BROKER_TEST_COMMANDS)` and
    `$(STANDALONE_TEST_COMMANDS)`.
    
    References #725.
    [#116526487]

commit ff951ac32deebd7e5f867459a12a9e3799097c74
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 7 18:11:36 2016 +0200

    Switch testsuite to common_test, part #2
    
    The migrated tests are those from `rabbit_tests.erl`.
    
    References #725.
    [#116526487]

commit 662214d3e062635a9a281c3d72b91a0e2182a908
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 7 15:53:09 2016 +0200

    Update erlang.mk
    
    In particular, this brings support for `make ct-$suite t=...`.
    
    References #725.
    [#116526487]

commit 2c9d5c452e1863bcab2c110ad7a16dbc82e04473
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 21 18:22:26 2016 +0200

    Makefile: Add amqp_client and meck to TEST_DEPS
    
    References #725.
    [#116526487]

commit 0aee9e647bf24d69044d06d79cadca466ccfbf00
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 7 15:30:17 2016 +0200

    Makefile: Remove rabbitmq_test as a TEST_DEPS
    
    When this branch gets merged, rabbitmq-components.mk should be fixed
    instead.
    
    References #725.
    [#116526487]

commit ed6588bd1ea2c31b029d7ee510ae7df1ed0da62e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 7 15:16:40 2016 +0200

    Squash several small testsuites in unit_SUITE and unit_inbroker_SUITE
    
    This allows to run most of the testcases in parallel. As the name of the
    new testsuites suggests, testcases are grouped by the fact they must run
    inside a running broker or not.
    
    References #725.
    [#116526487]

commit 4d2e3bbcbbfee4d72de3ddf4f610c5a2834ae0a1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 5 18:44:54 2016 +0200

    Switch testsuite to common_test, part #1
    
    The migrated tests are the external ones executed from
    `rabbit_tests.erl`:
        o  credit_flow_test
        o  gm_tests
        o  mirrored_supervisor_tests
        o  on_disk_store_tunable_parameter_validation_test
        o  password_hashing_tests
        o  rabbit_ctl_timeout_tests
        o  rabbit_resource_monitor_misc_test
        o  supervisor2_tests
        o  truncate
        o  vm_memory_monitor_tests
    
    References #725.
    [#116526487]

commit 8dbc931d46eb85dfe5674bd5c1a16a5df2cf3161
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 6 12:59:14 2016 +0200

    rabbit_ct_broker_helpers: New helpers specific to the broker testsuite
    
    In particular, it allows to run tests on the broker node itself.
    
    References #725.
    [#116526487]

commit becf2c7ecad6203d6b6705a0d32fdf3f7893bba3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 5 18:42:17 2016 +0200

    make tests: Do not run tests from rabbitmq-test
    
    We are about to switch everything to common_test and rabbitmq-test will
    become unnecessary for the broker.

commit a4c74c5ca8905a5b3a32fc4b58567671d6b3577d
Merge: beeb772e2 1adb58bf8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 27 00:35:49 2016 +0300

    Merge branch 'stable'

commit 1adb58bf81b030352b38c411c9a5b495e0067bb4
Merge: dae432e0c bf5879e4e
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri May 27 00:33:51 2016 +0300

    Merge pull request #813 from rabbitmq/rabbitmq-server-812
    
    Initialise wait_timeout in slave promotion

commit bf5879e4ec987ca5a446cc03c2262b10bad637ba
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu May 26 16:05:16 2016 +0100

    Initialise wait_timeout in slave promotion

commit beeb772e225ff5c325c726750ce32065eae5c680
Merge: deae5fa97 dae432e0c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed May 25 14:15:42 2016 +0200

    Merge branch 'stable'

commit dae432e0caf5474564d8a7bb8b093163bab9d469
Merge: bb76dbc04 7e2b42209
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed May 25 14:14:39 2016 +0200

    Merge pull request #792 from rabbitmq/rabbitmq-server-718
    
    Deb repository: Use SIGNING_KEY to select the repository signing key

commit 7e2b42209e60b8a04e4b60d7f5286ae0505ea1cc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 12 15:48:41 2016 +0200

    packaging: We only use the signing key ID
    
    This is the only way to select a specific subkey. The user ID is useless
    for that.
    
    References #718.
    [#118296861]

commit e05c64405020de144487be33f5e0c40cd0fba31e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 12 15:34:31 2016 +0200

    Deb repository: Use SIGNING_KEY to select the repository signing key
    
    By default, honor the default key; usually it is specified in
    `gpg.conf`.
    
    References #718.
    [#118296861]

commit deae5fa9746971e723fc5aff926c8459753bb543
Merge: e0c323b26 bb76dbc04
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue May 24 14:03:45 2016 +0200

    Merge branch 'stable'

commit bb76dbc04888f8c3966ead8bed89a6f7d1017306
Merge: 918cb78ab 228a78e70
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue May 24 14:02:35 2016 +0200

    Merge branch 'rabbitmq-server-570' into stable

commit 228a78e703b3cf00d546a4a93320616ec52ec2e7
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri May 20 18:12:31 2016 +0300

    Enable systemd triggers in deb-package
    
    Fixes #570
    
    With this patch systemd service file will be used on systemd-enabled
    hosts, providing more seamless experience.
    
    I've tested it by building it on ubuntu 14.04, which is not managed by
    systemd. Still, it has necessary packages to build systemd-aware
    debs. And then I tried to install this package:
    - On ubuntu 14.04 - regular init script was used
    - On debian jessie with systemd and esl-erlang 18.3 - server was
      properly started using systemd service file (and epmd dependency was
      also automatically started by systemd)

commit e0c323b265398380592815349b671648a56d77cb
Merge: 6b17470a0 918cb78ab
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 23 17:07:17 2016 +0300

    Merge branch 'stable'

commit 918cb78abc9c0fa91a6be1182cacf350ee5596ae
Merge: 1aa116591 2b9bdfd73
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 23 16:36:03 2016 +0300

    Merge pull request #806 from rabbitmq/rabbitmq-server-687
    
    Use AckRequired in drop_one as priority queues return tuples {Priority, AckTag}

commit 6b17470a080864a2bebd5610446d034d38d08a21
Merge: fe8cecad7 1aa116591
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 23 16:12:27 2016 +0300

    Merge branch 'stable'

commit 1aa116591bb09b41f1f5f898e0e2748715802ff3
Merge: ba88ee7f7 3826f36bf
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 23 15:44:47 2016 +0300

    Merge pull request #805 from rabbitmq/rabbitmq-server-795
    
    Use max priority for higher priorities when returning backing queue state

commit 2b9bdfd73b7157cbce9ece636d05f6916d5a3a5a
Merge: 77332e682 ba88ee7f7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 23 15:15:06 2016 +0300

    Merge branch 'stable' into rabbitmq-server-687

commit 3826f36bfa327733c784ea39242c420e7f3d6d12
Merge: 1c3dc8d37 ba88ee7f7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 23 13:39:01 2016 +0300

    Merge branch 'stable' into rabbitmq-server-795

commit fe8cecad7116259cc83f26efb3b25b3d0ec6a655
Merge: dbff4cb5e d963bc8ef
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun May 22 20:34:07 2016 +0300

    Merge pull request #683 from binarin/rabbitmq-server-parallel-listing
    
    Listing items in parallel

commit dbff4cb5ef56cbc1171ebccdaefe6be1dff65b0b
Merge: afcdc4791 ba88ee7f7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 21 20:06:59 2016 +0300

    Merge branch 'stable'

commit ba88ee7f743f0abb85e09981c7d3a86f95e835c1
Merge: 776dd2423 42fc7814b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 21 20:04:22 2016 +0300

    Merge branch 'binarin-rabbitmq-server-cached-hipe-compilation' into stable

commit 42fc7814bf7058637f45621bba4912c432b894df
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 21 20:03:34 2016 +0300

    Naming

commit 4dd4fd61f4e55bff38ec1725fb9c0df7437ba53f
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri May 20 15:43:35 2016 +0300

    Allow caching HiPE-compilation results
    
    That way HiPE compilation can be performed during package installation
    and will not waste time during every startup.
    
    rabbit_hipe is refactored to support both modes of compilation - during
    every server startup or separately with caching in the filesystem.

commit 270997fd46286aa69c9da5fb30124f8e93bc7512
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 18 14:11:59 2016 +0100

    Select type specific info items

commit 36365ab29fb13034e1928cecc963a50e8b915d68
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 12 11:39:50 2016 +0100

    Support for type-specific exchange info

commit 1c3dc8d37ab487eb5991735d94a7bf1b66a94c7a
Merge: 1dd9ae5f2 776dd2423
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu May 19 23:11:49 2016 +0300

    Merge branch 'stable' into rabbitmq-server-795

commit 776dd2423f8e64ad7e387a7bb8e3b34e484f3c9d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu May 19 12:45:09 2016 +0100

    Commit package release notes for 3.6.2

commit 1dd9ae5f24b2b4f7e6b99d648d37cfc5216ceee6
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed May 18 16:18:23 2016 +0100

    Use max priority for higher priorities when returning backing queue state
    
    * Needed in synchronisation, otherwise messages for higher priorities are dropped in the slave

commit afcdc479194ca260ae496a35426eee50afc66f7b
Merge: 90a1e737d 02146c996
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed May 18 17:53:12 2016 +0300

    Merge branch 'stable'

commit 02146c99661fa0ff066387ec1b4648361cdda28e
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Wed May 18 14:23:29 2016 +0300

    Remove systemd dependency on syslog target
    
    Neither rabbitmq nor any dependent services in chain actually relies on
    syslog, so why keep it?
    
    This tested in Fedora since 2016-01. See this commit:
    
    http://pkgs.fedoraproject.org/cgit/rpms/rabbitmq-server.git/commit/?id=1477671
    
    Nobody complained so far.
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 90a1e737dec654dacb284c8245c163d846070b34
Merge: 86b8aaef1 16f72ad45
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 18 17:22:00 2016 +0300

    Merge pull request #804 from lemenkov/remove_systemd_bogus_dependency
    
    Remove systemd dependency on syslog target

commit 86b8aaef1029320347fa420283118a73a20925d0
Merge: 2e09767f4 61e16f2dc
Author: kjnilsson <kjnilsson@gmail.com>
Date:   Wed May 18 13:22:06 2016 +0100

    Merge branch 'stable'

commit d963bc8eff23802fb9f7ed9b0fa0b2f2040d9c1e
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 9 18:09:04 2016 +0300

    Avoid RPC roundtrips in list commands
    
    Current implementation of various `list_XXX` commands require cross-node
    roundtrip for every processed item - because `rabbitmqctl` target node
    is responsible for gathering global list of all items of
    interest (channels etc.) and then processing them one by one.
    
    For example, listing 10000 channels evenly distributed across 3 nodes
    where network has 1ms delay takes more than 10 seconds on my
    machine. And with the proposed change listing will take almost the same
    time as it'll take to gather this info locally. E.g. in the case above
    listing now takes 0.7 second on the same machine with same 1ms delay.
    
    It works by invoking emitting_map on every node, where it should send
    info about only local items to aggregator, in an async fashion - as no
    reply from aggregator is needed.

commit 61e16f2dc264ab5a7a71de8acd620ba7278f8fae
Author: kjnilsson <kjnilsson@gmail.com>
Date:   Wed May 18 12:55:27 2016 +0100

    Update rabbitmq-components.mk

commit 16f72ad45d9aefb33a3f7996a5a9d6bad3045b28
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Wed May 18 14:23:29 2016 +0300

    Remove systemd dependency on syslog target
    
    Neither rabbitmq nor any dependent services in chain actually relies on
    syslog, so why keep it?
    
    This tested in Fedora since 2016-01. See this commit:
    
    http://pkgs.fedoraproject.org/cgit/rpms/rabbitmq-server.git/commit/?id=1477671
    
    Nobody complained so far.
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 2e09767f433748e3d26d4de784a6e14e54ff3543
Merge: 8981049b7 4eca125d7
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue May 17 23:10:48 2016 +0300

    Merge pull request #798 from rabbitmq/rabbitmq-server-546
    
    Bump minimal required version to 18.3

commit 4eca125d7db41422125e304699dc63a550811293
Merge: 4a2b17f6d 8981049b7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 17 15:29:28 2016 +0300

    Merge branch 'master' into rabbitmq-server-546

commit 8981049b7b9b463e4056c5c9352014a0393f88ff
Merge: 8fa920d91 1e349682e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 17 11:38:19 2016 +0300

    Merge branch 'stable'

commit 8fa920d91cb3c12ef6caf6dc818ef8d0661beaff
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 17 11:17:51 2016 +0300

    Update rabbitmq-components.mk

commit 1e349682ede277150610a92923e8af54ac764902
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 17 10:16:07 2016 +0300

    Update rabbitmq-components.mk

commit 4a2b17f6d9b3a7aca95caf8cb22e5bef9e61fe1c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue May 17 09:24:34 2016 +0300

    Only test against Erlang 18.3

commit 66f8d59dd790f8c85fdf3579244b219dac5e62fb
Merge: 456fef7db 91939fb9b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon May 16 17:36:33 2016 +0300

    Merge branch 'stable'

commit 91939fb9b115d02191583a666a32f098c22eea57
Merge: 788d33258 98ef0080b
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon May 16 18:36:04 2016 +0400

    Merge pull request #801 from binarin/rabbitmq-server-systemd-example-wants-and-after
    
    Add explicit epmd dependency in systemd example unit

commit 98ef0080bcda637fa188bcac1bcbd66d15e51ae1
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon May 16 14:34:40 2016 +0300

    Add explicit epmd dependency in systemd example

commit 456fef7db0575e21b4a16e56543a71e81f847cc0
Merge: 972039cc9 788d33258
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun May 15 14:23:43 2016 +0800

    Merge branch 'stable'

commit 788d33258fc2c38b754be8a59eab7110db5d76ff
Merge: 5ea6f6ffd a024f3ca6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun May 15 14:23:19 2016 +0800

    Merge branch 'rabbitmq-event-exchange-9' into stable

commit 77332e682250f4e6a315de81abadd9e3a682e416
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Sat May 14 09:40:15 2016 +0100

    Use AckRequired in drop_one as priority queues return tuples {Priority, AckTag}
    
    * Fetch and drop operations of priority queues' consumers with no_ack=true,
      were changed internally to no_ack=false in the requests to the mirror slaves.
      Those messages would never be acknowledge by the consumer, as it was not part
      of the consumers configuration.

commit 972039cc92eeb3e8e9e01e297330e7fc2ca02904
Merge: b5b90e6aa 5ea6f6ffd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 14 01:12:09 2016 +0800

    Merge branch 'stable'

commit 5ea6f6ffdf780b014b86d7f9d0b1012360f7cc97
Merge: 6e0ce13ba 8e9ec88fb
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat May 14 01:11:40 2016 +0800

    Merge pull request #797 from rabbitmq/rabbitmq-server-795
    
    Limit priority to maximum during synchronisation

commit b5b90e6aa88ac99682e156588eb52b3ac76ce375
Merge: c72f2d89b 6e0ce13ba
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat May 14 00:02:58 2016 +0800

    Merge branch 'stable'

commit 6e0ce13ba7cda10bcd46924a0eafaf5c8c3ebd8a
Merge: 87418da7b ddd0d2b62
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat May 14 00:02:26 2016 +0800

    Merge pull request #794 from lefremova/stable
    
    Private attributes usage in rabbitmq script

commit 8e9ec88fb5ad318cf636770e95bda7c70400a5fb
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri May 13 12:13:43 2016 +0100

    Limit priority to maximum during synchronisation

commit a024f3ca6ed6f36b0136b978a664ba3877fffe4b
Author: kjnilsson <kjnilsson@gmail.com>
Date:   Fri May 13 11:11:28 2016 +0100

    add vhost information to binding and policy events

commit c72f2d89b2d44d9beb8fe5703923d8d51be62cea
Merge: 9898a5fe3 87418da7b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 13 10:54:47 2016 +0200

    Merge branch 'stable'

commit 87418da7b90c789310e6e258078fed94c7a7ce01
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 13 10:53:35 2016 +0200

    make source-dist: Exclude default $(PACKAGES_DIR)

commit 9898a5fe3f58ab4b303368126b341127295909f7
Merge: 79e216827 e9e640284
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 13 10:44:47 2016 +0800

    Merge branch 'stable'

commit e9e640284edf780ee669e547c28a6e9ad6c839ba
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri May 13 10:44:35 2016 +0800

    (c) year

commit ddd0d2b6212001d1b2be9585240af63239a16e3c
Author: Liubov Efremova <lefremova@mirantis.com>
Date:   Thu May 12 18:55:21 2016 +0300

    Private attributes usage in rabbitmq script
    
    Required Pacemaker >= 1.1.13.
    (The command 'attrd_updater' have '-p' option only since this version).
    
    There are three types of rabbitmq attributes for pacemaker nodes:
            -'rabbit-master'
            -'rabbit-start-time'
            - timeouts:
                    -'rabbit_list_channels_timeouts'
                    -'rabbit_get_alarms_timeouts'
                    -'rabbit_list_queues_timeouts'
    
    Attributes with names 'rabbit-master' and 'rabbit-start-time' should be
    public because we monitor this attributes in cycle for all nodes in our
    script. All timeouts attributes were changed to private to avoid
    unnecessary transitions.
    
    Also, --lifetime and --node options were removed for attrd_updater as
    'lifetime' for this command is always 'reboot' and 'node' default value
    is local one.

commit a004f197905b463a2236c95f97b72fdbd2774163
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu May 12 10:34:15 2016 +0100

    Bump minimal erlang version to 18.3

commit 79e216827b308902039fbcd60bad017148580a7a
Merge: f6530d0bb 7f348db0d
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue May 10 11:48:30 2016 +0200

    Merge pull request #786 from binarin/rabbitmq-server-scary-plugins-warning
    
    Don't scare ops with empty list of failed plugins

commit 7f348db0dffb443baf4468aa038d3888819b8132
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Tue May 10 11:01:37 2016 +0300

    Don't scare ops with empty list of failed plugins

commit f6530d0bb3dacf62d0ef2bbb9bb579aa6ffe2104
Merge: 5192856ba a1f47b536
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 30 00:38:40 2016 -0500

    Merge branch 'stable'

commit a1f47b536546278374c77721fb952940d5bcec03
Merge: 69312f8e0 314c975b8
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Apr 30 00:38:10 2016 -0500

    Merge pull request #773 from rabbitmq/rabbitmq-server-772
    
    Add log information during the network_partition

commit 5192856bab89f5c134aba6d29b37a9c9ed1104cc
Merge: 773f356d4 69312f8e0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Apr 29 22:04:41 2016 -0700

    Merge branch 'stable'

commit 69312f8e0eb4b6315a0ae2604cb8492df7043401
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Apr 27 16:20:34 2016 +0200

    modified the message

commit f77fcd51442e75711ee753d14b833f99122a93af
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Apr 27 11:23:13 2016 +0200

    warning message during partition

commit 773f356d4648e86bb1ed8c945359141d7db0d4d2
Merge: d93efbbe2 0a3e7877d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 29 23:40:51 2016 -0500

    Merge branch 'stable'

commit 0a3e7877d81e679f3294a30c6854cad63e52c522
Merge: 392e0396c 6f11f14d1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 29 23:40:36 2016 -0500

    Merge branch 'rabbitmq-server-749' into stable

commit 6f11f14d183050b8804c0adf304bf7468586296e
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Apr 28 18:09:01 2016 +0100

    Drop ACKs of messages from lost members of the ring
    
    * when partial partitions happen, inconsistent views can take place
      where both nodes in partial partition see the live node as their left
      (A -> C and B -> C), and override each other view in mnesia. Thus,
      when C tries to compare the ACKs finds missing elements on A or B data.
      We'll drop these as they won't be answered because the origin node
      is going into pause_minority and stops.

commit d93efbbe2eb932f6314a1c9b08fae5b60c8f812b
Merge: ee8605454 392e0396c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Apr 28 15:36:43 2016 +0200

    Merge branch 'stable'

commit 392e0396c844493c977223225c95aca277d5b8b1
Merge: 5b5d9b983 2c00a20c1
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Apr 28 15:34:52 2016 +0200

    Merge pull request #778 from rabbitmq/rabbitmq-server-690
    
    Windows, reconfigure ERLANG_HOME during the update

commit 2c00a20c1253e829b0dba7fd5cb94f5698f04dd0
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Apr 27 17:49:17 2016 +0200

    reconfigure ERLANG_HOME during the update
    
    The `un.StrContains` macro is now useless, so we remove it.
    
    Fixes #690.

commit ee86054540d04042eb6ae24a65922daae47b2171
Merge: 8b4ae4204 77c2d0a3d
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Apr 28 12:13:40 2016 +0200

    Merge pull request #776 from rabbitmq/rabbitmq-server-735
    
    set broker requirements during package gen

commit 77c2d0a3d1798e7697315bd2df9215bbe28be2bf
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 22 14:35:02 2016 +0100

    set broker requirements during package gen
    
    References #735.

commit 8b4ae4204947a4131895320663640f390b0eaa31
Merge: 9532743d5 5b5d9b983
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 27 13:35:22 2016 -0500

    Merge branch 'stable'

commit 5b5d9b983b90d4840d7dc791449536e5448e6e62
Merge: 473beb92b 702956f2c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 27 13:34:35 2016 -0500

    Merge branch 'rabbitmq-server-767' into stable

commit 702956f2c69cba624146180f4c715912012392d2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 27 12:19:59 2016 -0500

    Wording

commit 314c975b8dd9c202f10bfd1c86f7374af9cddab4
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Apr 27 16:20:34 2016 +0200

    modified the message

commit cb1fc3b7c588f452b8d52bfbcc2df3d96cd22486
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 27 11:02:35 2016 +0100

    Log invalid x-death header as warning

commit e6c5dcb1189740b850a3cc32b6233739cce6b05e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 25 17:25:29 2016 +0100

    Ignore non-array x-dead header

commit 28a814b572d624a918bc1e66e4e3d9e7a019faf1
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Apr 27 11:23:13 2016 +0200

    warning message during partition

commit 9532743d5c9db954f42693e5f412fdfed0213e1d
Merge: ebac3c4cf 473beb92b
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Apr 26 17:16:21 2016 +0200

    Merge branch 'stable'

commit 473beb92b3bd3b22dd26b565af19a49e1151f3d9
Merge: 9099f8b55 5fb86319c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Apr 26 17:10:05 2016 +0200

    Merge pull request #771 from rabbitmq/rabbitmq-server-crash-on-damaged-io
    
    Improve notifications about damaged I/O subsystem

commit 5fb86319c444d459dee3606d56fbde335382f26e
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Apr 22 16:52:42 2016 +0300

    Improve notifications about damaged I/O subsystem
    
    Follow-up to https://github.com/rabbitmq/rabbitmq-server/pull/747
    
    It's the best thing that can be done. Without `exit` anything inside
    rabbit could hang - most prone to it is the `start_app` action. Crashing
    loudly will be helpful, because during 2016 there were at least 2
    production investigations about that issue.
    
    And here is the script that I was using for reproduction:
    https://gist.github.com/binarin/edd4102b7262d53e2cf09c76d5ca8e9e

commit 9099f8b5579d8b8839384bec6c2897df16a6be7e
Merge: 534cf5e6e 4eaa46ef0
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Apr 26 16:23:13 2016 +0200

    Merge pull request #770 from rabbitmq/rabbitmq-server-dont-hardcode-df-path
    
    Don't use hardcoded path to `df`

commit 4eaa46ef0ea1e1777c86a5ddc93e0cf447a3f448
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Apr 22 17:06:19 2016 +0300

    Don't use hardcoded path to `df`
    
    Search the `PATH` instead, because e.g. NixOS has no `/bin/df`.

commit ebac3c4cf22a6b0535236206eedf55b1d82c0eba
Merge: f84eeccc0 74cafa3c5
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Apr 26 12:11:40 2016 +0200

    Merge pull request #765 from rabbitmq/rabbitmq-server-763
    
    Do not move rabbitmq.conf to rabbitmq-env.conf during RPM and DEB install

commit 74cafa3c57ab1899314a811798e65e5d7416bcbc
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 25 17:07:48 2016 +0100

    Do not create rabbitmq-env.conf file during installation

commit f84eeccc05ecaa30e8546314fea82c96be787ebe
Merge: 00e6d4ce0 534cf5e6e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 22 13:39:34 2016 +0100

    Merge branch 'stable'

commit 534cf5e6e64053c181c3f4b7bd33bb35567f1c55
Merge: b809d2e31 8f4cfceb8
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Apr 22 13:26:50 2016 +0100

    Merge pull request #722 from rabbitmq/rabbitmq-auth-backend-ldap-13
    
    Include vhost to direct connection authentication properties.

commit bb777dec813e8480c3f301de996a0a32aae308e5
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 21 15:05:16 2016 +0100

    Do not move rabbitmq.conf to rabbitmq-env.conf during RPM and DEB install

commit 8f4cfceb8ad933d453ab692e6386560e18c1960b
Merge: c15a4adf0 b809d2e31
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 20 14:21:13 2016 +0100

    Merge branch 'stable' into rabbitmq-auth-backend-ldap-13

commit 00e6d4ce087dce2b8ed930eac850b003d9919908
Merge: 9eee23fa0 b809d2e31
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 20 15:10:33 2016 +0300

    Merge branch 'stable'

commit b809d2e314d523aa578bbed637ce4a35afb980c6
Merge: 91c668480 bc7b5c667
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 20 15:10:12 2016 +0300

    Merge pull request #762 from bogdando/bug/1541471
    
    Stop process when rabbit is running but is not connected to master.

commit bc7b5c667a22ea3fa9e60b5fffd48756b27de843
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Wed Apr 20 14:02:07 2016 +0200

    Stop process when rabbit is running but is not connected to master.
    
    It's should goes down due to avoid split brain.
    
    Related Fuel bug: https://bugs.launchpad.net/fuel/+bug/1541471
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>
    Co-authored-by: Maciej Relewicz <mrelewicz@mirantis.com>

commit 9eee23fa04926a84d97d0762f0f2f57e49341082
Merge: 32a7c103a 91c668480
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Apr 20 03:40:02 2016 -0700

    Merge branch 'stable'

commit 91c668480ca95a5ae19c86cec20cd4a1ec4f3afe
Merge: af96cc83f cc258d7a0
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 20 13:39:12 2016 +0300

    Merge pull request #723 from rabbitmq/rabbitmq-server-698
    
    Replace OTP version consistency with mnesia protocol consistency

commit 32a7c103a7b06006513b78959f785289fafe4633
Merge: e115ccbf7 af96cc83f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 20 10:37:04 2016 +0300

    Merge branch 'stable'

commit af96cc83f4159b875c87fb8a8d9662f439c48add
Merge: 0df4e53f3 eb1f6e5cd
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 20 10:36:31 2016 +0300

    Merge pull request #585 from rabbitmq/rabbitmq-server-343bis
    
    Batch writes to the index on requeue

commit eb1f6e5cdd8e53164135c10dc79f9a9496d53755
Merge: 628d803b9 57c4a7af7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 20 09:03:52 2016 +0300

    Merge branch 'stable' into rabbitmq-server-343bis

commit e115ccbf74ad57c60566ab3cbbee8b04126c3de6
Merge: 8bc324f90 0df4e53f3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 19 17:15:18 2016 +0100

    Merge branch 'stable'

commit 0df4e53f356a184245eec7729dfbcd75392563e6
Merge: 57c4a7af7 c04501385
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Apr 19 17:14:43 2016 +0100

    Merge pull request #745 from rabbitmq/rabbitmq-server-744
    
    rabbit_policy: Fix several issues with policy updates

commit c0450138586379a9f8e5554e15a8fc5dde6aece3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 19 16:08:32 2016 +0200

    rabbit_policy: Fix case clause for missing vhost
    
    If the vhost is missing, `rabbit_vhost:assert(VHost)` throws
    `{error, {no_such_vhost, _}}` which is caught by `mnesia:async_dirty/1`
    and wrapped inside a tuple which is passed to `exit()`. Therefore,
    the catch in the transaction function returns:
      `{'EXIT', {throw, {error, {no_such_vhost, _}}}}`
    not:
      `{error, {no_such_vhost, _}}`
    
    Fixes #759.
    [#117522069]

commit 8b9a54c5cae6541dadef021f35abc50b84b6cf96
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Tue Apr 19 00:52:30 2016 -0700

    Stop match earlier, and added some comments

commit d7b45c28b18298a808b2c3c245366fd82c263ccd
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Tue Apr 19 00:46:07 2016 -0700

    Compare values only on headers match

commit cc258d7a04d336883c12277b1a432f8c9a630e35
Merge: e5724d797 57c4a7af7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Apr 18 16:02:57 2016 -0700

    Merge branch 'stable' into rabbitmq-server-698

commit c15a4adf07441c7cd6f3819c296c192f4a54c5e4
Merge: 4affec5cb 57c4a7af7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Apr 18 15:52:54 2016 -0700

    Merge branch 'stable' into rabbitmq-auth-backend-ldap-13

commit 49b8a4014af62ce86063ac6f4595a96175971c47
Author: sylvainhubsch <sylvain.hubsch@gmail.com>
Date:   Mon Apr 18 14:55:20 2016 -0700

    Match on types deleted and shortcuts algo

commit bac2dac787b4ff1c58fae3bdde7d53eea6a0e94c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Apr 18 18:07:43 2016 +0200

    rabbit_policy: Fix transaction return value in udpate_policies()
    
    If a vhost is removed while policies are being updated, the transaction
    returned `ok` while the calling code expects a tuple.
    
    Fixes #755.
    [#117522069]

commit 868176d779361e5235130038b09106c0c801453d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 13 12:50:25 2016 +0200

    rabbit_policy: Forward exit signals update_policies() transaction
    
    Thus, any transaction abort are properly forwarded. This fixes a
    `function_clause` because the code called `update_exchange()` or
    `update_queue()` with the caught exit signal.
    
    Fixes #744.
    [#117522069]

commit 8bc324f90e6a4243bd385176a7aae69092f1cefe
Merge: 2df0197be 57c4a7af7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Apr 16 00:17:52 2016 +0300

    Merge branch 'stable'

commit 57c4a7af72268b8cf88efd2ec774616dd14aa31f
Merge: 165c6e796 059271001
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Apr 16 00:17:24 2016 +0300

    Merge pull request #748 from rabbitmq/rabbitmq-server-714
    
    Stop deleted GM member when partial partition is detected

commit 2df0197be8eec2c13cea78a486030cbf4c589859
Merge: fdd972f24 f9a47d7db
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 15 16:13:53 2016 +0300

    Merge pull request #752 from rabbitmq/rabbitmq-server-750
    
    Changed default schema dir to /var/lib/rabbitmq/schema

commit f9a47d7db5103feae577de574df481ad61a791c1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 15 14:07:40 2016 +0100

    Changed default schema dir to /var/lib/rabbitmq/schema

commit fdd972f24a25d2e6f9a4c89247b19f666240cdcb
Merge: e9ce0fa5c 5f675aaaf
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 15 07:32:13 2016 +0300

    Merge pull request #751 from rabbitmq/rabbitmq-server-750
    
    SCHEMA_DIR set to writable location by default

commit 5f675aaaf2c9161c26c406d834f82fb070e2f12e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 14 18:14:39 2016 +0100

    SCHEMA_DIR set to writable location by default

commit 059271001a2b8fc41ff4958e9ff9f958307ef340
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Apr 7 14:34:30 2016 +0100

    Stop deleted GM member when partial partition is detected
    
    * Avoids deadlock on syncing queues and inconsistent state across
    the cluster
    * Queue must restart and rejoin the group

commit e9ce0fa5c6426a7baca4171f72b99bf0183f8071
Merge: e6a555e43 165c6e796
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 13 20:41:38 2016 +0300

    Merge branch 'stable'

commit 165c6e796afd2a88cd2db9e60b60c32bc322ef21
Merge: b943c0d16 e77ff6980
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 13 20:40:56 2016 +0300

    Merge branch 'binarin-rabbitmq-server-dead-user-diagnostics' into stable

commit e77ff6980fed41fb30fc4b03575527f8864e2008
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 13 20:39:47 2016 +0300

    Wording

commit 50861dc51300ff0b15c73e52c059503e325a3bbb
Merge: b943c0d16 b149da724
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 13 20:38:08 2016 +0300

    Merge branch 'rabbitmq-server-dead-user-diagnostics' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-dead-user-diagnostics

commit e6a555e438adc6b5106f5cab3d56a208569e768a
Merge: d37a278ff b943c0d16
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Apr 13 18:20:19 2016 +0100

    Merge branch 'stable'

commit b943c0d1677a42e1763d71159b7b84d519ad3cf2
Merge: 68c940985 f9c558d49
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Apr 13 18:19:30 2016 +0100

    Merge pull request #743 from rabbitmq/rabbitmq-server-742
    
    rabbitmqctl set_policy: Format error messages

commit b149da724210dba4021dbe49936ff7cabc28c3c6
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Apr 13 18:37:29 2016 +0300

    Detect missing 'user' process
    
    'user' process can be unrecoverably crashed with good timing. As a
    result some rabbitmqctl commands will stop working, e.g. add_user:
    
        rabbitmqctl -n rabbit@localhost add_user ley ley
        Creating user "ley" ...
        Error: {badarg,
               [{erlang,group_leader,[undefined,<5428.28745.44>],[]},
                {rabbit_log,with_local_io,1,
                    [{file,"src/rabbit_log.erl"},{line,99}]},
                {rabbit_auth_backend_internal,add_user,2,
                    [{file,"src/rabbit_auth_backend_internal.erl"},{line,149}]},
                {rpc,'-handle_call_call/6-fun-0-',5,
                    [{file,"rpc.erl"},{line,206}]}]}
    
    Exact sequence events that will crash 'user' is the following:
    - Move startup_log file to a separate partition
    - Start server
    - Fill partition to the fullest
    - Do stop_app/start_app several times, so all the remaning slack will be
      used by log records.
    - At some point 'user' will crash.
    - Free some space on partition with startup_log
    - Observe that any rabbit action that requires logging is now broken

commit f9c558d49d60362d9cbbf9284c458a6c83f16f85
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 13 12:30:25 2016 +0200

    rabbitmqctl set_policy: Format error messages
    
    References #742.
    [#117521029]

commit e5724d797f18aec8ab86b9a4054e1183a5bc063f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 13 11:31:38 2016 +0300

    Explain

commit 066d7e63198db640df479f6990856456a3a2eccc
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 12 11:21:29 2016 +0100

    Check mnesia consistency starting from 3.6.2, OTP consistency in older versions

commit 21c57385ade0f43cd3f47488e2985cda758e79db
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 11 18:53:36 2016 +0100

    Compatibility with 3.6.x

commit 7d55ad5ac0f5c5700d6f24daf8da0df08e6cc899
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Apr 11 17:36:14 2016 +0300

    Naming

commit d37a278ffb865048e5bbf843495d928efb49439a
Merge: 64f579434 f6404b19e
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Apr 11 17:15:40 2016 +0300

    Merge pull request #729 from rabbitmq/rabbitmq-management-163
    
    Add upgrade function adding listener socket options

commit c846ac819dd21074a213fe8c79447f2fda5318b2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Apr 11 16:24:34 2016 +0300

    Update comment

commit f6404b19e09ad2b14957f68fe7215fb7916ccbd5
Merge: d2a29577b 64f579434
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 10 04:14:27 2016 +0300

    Merge branch 'master' into rabbitmq-management-163

commit 64f57943434c4b699585427f19fa7f5125d19faf
Merge: c7cae1562 de2dbed33
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 8 23:08:11 2016 +0300

    Merge pull request #642 from rabbitmq/rabbitmq-server-591
    
    Validate plugin compatibility with version ranges

commit de2dbed33f4c73065741eb96f1a3ee178c995adf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 22:50:03 2016 +0300

    Wording

commit 5cdc5d5e9970c67a2733fc4e9404022fea6a282c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 22:18:46 2016 +0300

    Wording

commit aeecbec95807127d7c279dd87d15d212e6b29962
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 22:18:29 2016 +0300

    Cosmetics

commit 9f59ed5e1a7a8fc73a6e5e72989b6d79d0f49034
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 8 15:00:54 2016 +0100

    Log development version ignore

commit 38ad97582336c12f46fdfabaad1d725398f63120
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 8 14:34:41 2016 +0100

    Versions "" and "0.0.0" always match

commit 5ff8cece72045bf7781af173a8a6b44a08fd09c2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 15:11:02 2016 +0300

    Wording

commit 75e64e76bf9a05d1e32befac90068de21423c0a5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 14:43:34 2016 +0300

    Naming, cosmetics

commit 2f58c3a6a51212528dd610b1a422b8deac12bcbc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 13:29:24 2016 +0300

    Naming

commit 0648d403a6341030369956ff63d4ba6c336436f5
Merge: 64540f2de c7cae1562
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 8 01:17:59 2016 +0300

    Merge branch 'master' into rabbitmq-server-591

commit c258acf87e635fd6ffc67fcf6c3e6b4371ecae06
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 7 17:14:58 2016 +0100

    Naming

commit 64540f2de0ead2b37caab184e7ac43a3349c855c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 7 16:47:48 2016 +0100

    Naming

commit 77cf284870049dae7dda3a7566df0a55fad55c12
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Apr 7 15:16:52 2016 +0100

    Reverted version in app.src

commit c7cae156260fc6509d2274ef452e767c692e3fa3
Merge: 9601bd67c 68c940985
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Apr 7 16:30:16 2016 +0300

    Merge branch 'stable'

commit 68c940985669c7fc1951234cedae0dd3ab5dfbc8
Merge: b4da78a77 01dcd2ba7
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Apr 7 16:18:55 2016 +0300

    Merge pull request #731 from bogdando/bug/1567355
    
    Stop a rabbitmq pacemaker resource when monitor fails

commit 01dcd2ba79b7799dd1cef0231ab62e50481941a5
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Apr 7 12:55:11 2016 +0200

    Stop a rabbitmq pacemaker resource when monitor fails
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1567355
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit d2a29577ba430e871d01355474b520c447214103
Merge: 6d443bbae 9601bd67c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Apr 5 18:17:23 2016 -0700

    Merge branch 'master' into rabbitmq-management-163

commit 9601bd67c34b04db36a375604dfdccbb2d4941a9
Merge: e472def85 3fd6c009d
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 5 21:32:38 2016 +0300

    Merge pull request #711 from rabbitmq/rabbitmq-server-691
    
    Support file extension in the RABBITMQ_CONFIG_FILE env var values

commit e472def85b0937cdceba67117f3e8e6ee435d2ca
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 5 11:05:17 2016 +0100

    Remove redundant lines

commit a1636c499cee36c7fd0fe30b0b48eb90628267cd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 14:58:05 2016 +0100

    Remove start arguments log

commit 6c27b6f2770b5be3c7253f705c8c958317371c1e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 11:46:37 2016 +0100

    Unquoting and extension trimming in windows scripts

commit 6074ef205fc8def000296afebdd258febb56e041
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 1 18:39:49 2016 +0100

    Support extension in advanced.config

commit 6a5f0266071ad5a47f51bad8da5b0f498ea9a65f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 31 11:08:26 2016 +0100

    Equality operators and trimming extension

commit 06fa298aacb9826a68224c123abb24c2cdabad22
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 31 10:13:26 2016 +0100

    Condition ordering to set RABBITMQ_CONFIG_ARG

commit e3b856330562951fff07767ba82ccd03b13a19a4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 31 02:51:02 2016 +0300

    Strip off trailing .conf/.config using dirname and basename
    
    Otherwise if there is no dot in RABBITMQ_CONFIG_FILE,
    RABBITMQ_CONFIG_FILE_NOEX ends up being empty.

commit db4d5426b65763dd05fdb02d49336dd14d4c7cbc
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 29 14:15:44 2016 +0100

    Remove debug echoes

commit b3eb6fd3809a8fc74601d44997eac2bc007194b1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 18 16:26:04 2016 +0000

    Support extensions in config files

commit 3fd6c009db4375e36a95c3390fc161a58f09e3ea
Merge: ab9ebd59a 71a7cc423
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 5 21:29:32 2016 +0300

    Merge branch 'master' into rabbitmq-server-691

commit 277c477091c3ebbd3f23b56ea6f2abaf0c883a91
Merge: 869f06811 b4da78a77
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 5 21:11:45 2016 +0300

    Merge branch 'stable'

commit b4da78a77a038c331ef6768ebdf33beb566e5fc1
Merge: 475763ec2 710589e74
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 5 21:10:47 2016 +0300

    Merge pull request #726 from rabbitmq/rabbitmq-management-166
    
    Update owner of mgmt_db tables

commit 869f06811a7dac184673950cd2a524efbb229311
Merge: 71a7cc423 475763ec2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Apr 5 10:33:18 2016 -0700

    Merge branch 'stable'

commit 475763ec2162d30610ddcc3aefb9683d434110d9
Merge: 81fde9ecb 811b0d977
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 5 20:32:03 2016 +0300

    Merge pull request #728 from rabbitmq/rabbitmq-server-210
    
    Override CONF_ENV_FILE with RABBITMQ_CONF_ENV_FILE

commit 36d9c694a3556d0a938d9b64218f41f6c0a51a35
Merge: 20a2d289c 71a7cc423
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 5 17:50:03 2016 +0100

    Merge branch 'master' into rabbitmq-server-591

commit 20a2d289c6e3f227a681d0886c09b30ebe14a4d8
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 5 17:46:30 2016 +0100

    Test exports

commit 710589e746150e7fbac4ef770a1e765f5f391191
Merge: 07bb8f249 81fde9ecb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 5 19:01:26 2016 +0300

    Merge branch 'stable' into rabbitmq-management-166

commit 6d443bbae5ce570e3fdfd51088c0b7bbeef3c9ce
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Apr 5 16:28:49 2016 +0200

    Add upgrade function adding listener socket options

commit 811b0d9772808499fcee154d9a4060afe67a37e3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 5 13:58:36 2016 +0100

    Override CONF_ENV_FILE with RABBITMQ_CONF_ENV_FILE

commit 71a7cc423d2e3760adf0f3cbe26c278f9b2eec5a
Merge: 13635aa79 81fde9ecb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Apr 5 14:13:36 2016 +0300

    Merge branch 'stable'

commit 07bb8f2491cebfdb923d12e9e4ff819658187568
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Apr 5 11:43:59 2016 +0100

    Update owner of mgmt_db tables

commit ab9ebd59ab2d43030a84e3ed9d4550b8929ab522
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Apr 5 11:05:17 2016 +0100

    Remove redundant lines

commit 81fde9ecb2f5396687239970380a7d66fd5f53ba
Merge: c64ec9a3a c45b4c30e
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Apr 5 11:25:27 2016 +0300

    Merge pull request #724 from binarin/rabbitmq-server-ocf-reset-mnesia-overquoting
    
    Fix half-hearted attempt to erase mnesia in OCF RA

commit c45b4c30e1836a6cbec6cd86a13143305eb14ba1
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Apr 4 19:33:25 2016 +0300

    Fix half-hearted attempt to erase mnesia in OCF RA
    
    ocf_run does `"$@"`, so "${MNESIA_FILES}/*" wasn't expanded and mnesia
    directory wasn't actually cleaned up
    
    Fuel bug: https://bugs.launchpad.net/fuel/+bug/1565868

commit 9b23813646904e149a33a848a36d9341547fb3dd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 17:19:00 2016 +0100

    Log invalid plugins during startup

commit 9c76b9efb565a29d7684f94b1e1dee6c5a9fc19e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 14:58:05 2016 +0100

    Remove start arguments log

commit 47baba044ae832b9e3bb7c3862e54ffdcda48d28
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 14:48:42 2016 +0100

    Error messages in rabbitmq-plugins

commit 5ebcb9b437940289b2a133d9d9c890124c2e176c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Apr 4 11:46:37 2016 +0100

    Unquoting and extension trimming in windows scripts

commit c5e029bcc30df26417c65688e5f2fd32b74a3d73
Merge: 11fa86d24 13635aa79
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Apr 3 07:45:44 2016 -0700

    Merge branch 'master' into rabbitmq-server-691

commit 11fa86d24ac8ddafb3e642aeba4e1b4fc45adea6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 1 18:39:49 2016 +0100

    Support extension in advanced.config

commit d2780fe4db57217fef31eb7fdf287c1cfe4d8483
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 31 16:56:15 2016 +0100

    Check mnesia consistency by negotiating protocol

commit 4476b4b2919917476d16f6a5f1ab2418852c0cbc
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 30 17:09:33 2016 +0100

    Ignore OTP version in clustering

commit 28826181bd2cef140fb8e9fe5b68da5a84835218
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Apr 1 18:20:18 2016 +0100

    Validate plugins before enabling

commit 13635aa794b6f29894501d725341b58c882656e5
Merge: 4b6faa788 c64ec9a3a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Apr 1 18:38:26 2016 +0200

    Merge branch 'stable'

commit c64ec9a3ac208cd667d80cd53b5df8fc5636f6b1
Merge: b99f96580 41ce5ad80
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Apr 1 18:37:34 2016 +0200

    Merge pull request #715 from binarin/rabbitmq-server-151
    
    Guess thread pool size on startup

commit 4affec5cb796ecf54e8517312025f5804864d205
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Apr 1 15:59:02 2016 +0100

    Includes VHost to AuthProps.
    
    Ref: rabbitmq/rabbitmq-auth-backend-ldap#13

commit 4b6faa788f7dd396f419e97e096e88e5de178982
Merge: 704a2b5b6 b99f96580
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Apr 1 02:50:58 2016 +0300

    Merge branch 'stable'

commit b99f96580c655821937e6046ad7240197f62d6ca
Merge: 5e56d9645 4f146b96f
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 1 02:50:34 2016 +0300

    Merge pull request #721 from rabbitmq/rabbitmq-server-717
    
    Allow memory-relative disk-free limits greater than 1.0

commit 4f146b96fcbb27368bca4cbea793a42a774cee66
Author: Brandon Shroyer <bshroyer@pivotal.io>
Date:   Thu Mar 31 19:29:12 2016 -0400

    Allow memory-relative disk-free limits greater than 1.0

commit bbb2695a040cca5c3a1d9b04b2edc34fb6d1fd13
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 31 11:08:26 2016 +0100

    Equality operators and trimming extension

commit a4496d44e5304372d0448baa91ff26fd07efe1db
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 31 10:13:26 2016 +0100

    Condition ordering to set RABBITMQ_CONFIG_ARG

commit 93dbc2ff09234740caedb4e9cd9610f79c7a4e9d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 31 02:51:02 2016 +0300

    Strip off trailing .conf/.config using dirname and basename
    
    Otherwise if there is no dot in RABBITMQ_CONFIG_FILE,
    RABBITMQ_CONFIG_FILE_NOEX ends up being empty.

commit 41ce5ad808863944cd6d62ce7f7e2271f1010582
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 30 17:27:23 2016 +0300

    Guess thread pool size on startup
    
    Fixes #151

commit c8eb1766195d790acf58bac1080039f843341e4f
Merge: a61038635 704a2b5b6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 30 00:58:55 2016 +0300

    Merge branch 'master' into rabbitmq-server-691

commit 704a2b5b67dd2fe72c903899a995d455026b4578
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Mar 29 23:01:19 2016 +0300

    Update rabbitmq.conf.example

commit a610386356823523f5cd93638de2646d8126baff
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 29 14:15:44 2016 +0100

    Remove debug echoes

commit 0feb95d76c18a9a8ba67acaf4f638fd4524abf32
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 18 16:26:04 2016 +0000

    Support extensions in config files

commit 1089be3c5990d03e4d157007f61d678fea045f27
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Mar 29 13:48:07 2016 +0100

    Fixing merge issue. Create advanced config instead of config file for use in windows service

commit f4db0e84afbcaf419663236023ea9e106351898c
Merge: 58b0895f7 5e56d9645
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 25 12:38:29 2016 +0300

    Merge branch 'stable'

commit 5e56d9645536ca67fb2f6a23c289d6feaa9e1df3
Merge: 397cd1e18 6f1f7ee32
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 25 12:23:10 2016 +0300

    Merge pull request #708 from rabbitmq/rabbitmq-server-705
    
    Fixed RABBITMQ_IO_THREAD_POOL_SIZE on rabbitmq-server.bat

commit 6f1f7ee326fb77528b53563cab933a7dffbf27a1
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Fri Mar 25 09:27:09 2016 +0100

    fix RABBITMQ_IO_THREAD_POOL_SIZE

commit 58b0895f70ef7d39c9534c8158db65eac1662611
Merge: ac9bafa4d 397cd1e18
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 25 01:28:51 2016 +0300

    Merge branch 'stable'

commit 397cd1e18379eca9222aa925ab9013abfa7181bd
Merge: 6e5441fcc ad30bfaca
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 25 01:27:43 2016 +0300

    Merge branch 'binarin-rabbitmq-server-688' into stable

commit ad30bfaca7db89bb8a5d9beb23bd8cf604f9dd81
Merge: 6e5441fcc fa60c263b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 24 23:50:12 2016 +0300

    Merge branch 'rabbitmq-server-688' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-688

commit ac9bafa4d53f72e57ccc45ad5088869093c89c13
Merge: cc13f505d 6e5441fcc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 24 21:51:23 2016 +0300

    Merge branch 'stable'

commit 6e5441fcc7fe152a8a4359b5be0ad81f268baa44
Merge: d19bf82d3 a80064bfd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 24 21:49:19 2016 +0300

    Merge branch 'binarin-rabbitmq-server-701' into stable

commit d19bf82d3fcebc80b0007e63493d37196f8f3c87
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 23 17:49:07 2016 +0300

    Fix `rabbitmqctl list_consumers`
    
    As we are mapping over queues in search of their consumers, actual
    result for every queue could be zero or more consumers. We need to take
    that into account while printing.
    
    Closes #701

commit cc13f505d5062a29f5bd0819de71846c29f74875
Merge: c34c6cb45 4aa2aa0d8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 24 19:44:31 2016 +0100

    Merge branch 'stable'

commit d3676b51bb04ec2ea14076ff8f70368f0d586b6d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 24 14:01:33 2016 +0000

    Check deps versions before missing dependencies

commit 4aa2aa0d8d975f1531289ae9e7b1f419f9a8a0b2
Merge: af67b9554 50506b399
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Mar 24 14:50:09 2016 +0100

    Merge pull request #697 from bogdando/bug/1558627
    
    Put the RabbitMQ OCF RA policy to /usr/sbin

commit 50506b399eee3e86d9577f4b3a6a58750a5cbcc5
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Mar 21 14:22:50 2016 +0100

    Put the RabbitMQ OCF RA policy to /usr/sbin
    
    * Fix failing pcs resource list command
    * Move policy file to examples in docs dirs
    
    Related Fuel bug: https://bugs.launchpad.net/fuel/+bug/1558627
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit fa60c263bab6eecbc98addd4ccbc4bc3119b1ffe
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Mar 24 15:29:07 2016 +0300

    Add support for listing up/down queues
    
    Part of https://github.com/rabbitmq/rabbitmq-server/issues/688

commit c34c6cb45ca7adb0db1dddeba5ab0808bc9f9919
Merge: 117a20bc2 af67b9554
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 24 12:07:43 2016 +0100

    Merge branch 'stable'

commit a80064bfd596664919024d2b2f48f0af04694525
Merge: 4932f7dbf 859a3a520
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 24 13:57:03 2016 +0300

    Merge branch 'rabbitmq-server-701' of https://github.com/binarin/rabbitmq-server into binarin-rabbitmq-server-701

commit 4932f7dbf3ca279f2d2194ca2266428852a16e08
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 23 17:49:07 2016 +0300

    Fix `rabbitmqctl list_consumers`
    
    As we are mapping over queues in search of their consumers, actual
    result for every queue could be zero or more consumers. We need to take
    that into account while printing.
    
    Closes #701

commit 03a7fdeb073b2aa22d70c45d586c747bb240c4c8
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 23 14:32:45 2016 +0000

    Plugin versions check

commit a2222acd34d5b281e66860e3c88f903d6d8d2e01
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 23 09:53:55 2016 +0000

    plugin versions

commit de353f83314c38a2aa64aa6f97b72ed7839b5add
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 22 16:07:51 2016 +0000

    Clean version check function

commit b40dd3708c211f0bea90985a3e7a7a548a576c99
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 22 15:02:44 2016 +0000

    Rabbit broker version check in plugins

commit 117a20bc2383d6ee841547468fb615f34e4916f5
Merge: a5a24d327 2b9b292de
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Mar 24 00:29:04 2016 +0300

    Merge pull request #575 from rabbitmq/rabbitmq-server-550
    
    Support new configuration format

commit af67b9554059568dcef1bd05224ba84324ec817b
Merge: d34a5e8bc aa4cd2143
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 23 20:21:13 2016 +0300

    Merge pull request #704 from rabbitmq/rabbitmq-server-703
    
    Increase IO async to 64 for windows

commit aa4cd214353b28c58e41989414d34cb5276b08d0
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Mar 23 18:14:33 2016 +0100

    increase IO async to 64 for windows / service

commit d34a5e8bc9680943ac2c27567b106afb603273fe
Merge: 1547c6788 e35736537
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Mar 23 17:50:25 2016 +0100

    Merge pull request #689 from bogdando/rabbit_ocf_ra_travis
    
    Rabbit ocf ra travis

commit 1547c6788ec91f45b7a46b93962b6645f0d90205
Merge: 2259ab420 f9d33f527
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Mar 23 17:34:58 2016 +0100

    Merge pull request #699 from binarin/rabbitmq-server-systemd-logrotate
    
    Fix logrotate / systemd incompatibility

commit 2259ab4208eedc3ac5f7955f17b737bb1eaecf27
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 19:11:23 2016 +0300

    Inline, don't reinvent rabbit_misc:get_env/3

commit c1ef21206383a3a5725f6cf8dd30d3aa24013aca
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Tue Feb 2 17:19:19 2016 +0300

    Make slaves wait timeout configurable instead of hardcoded 15000
    
    This slightly improves rabbitmq/rabbitmq-server#584
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit a5a24d32733e80e0ab1b5383d17bb405bd58d743
Merge: 1c11d093d a9c1bcdb0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 19:12:03 2016 +0300

    Merge branch 'lemenkov-slave_wait_timeout_configurable'

commit a9c1bcdb0822118d9e0dece7af3fd3fe8a3cbd8e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 19:11:23 2016 +0300

    Inline, don't reinvent rabbit_misc:get_env/3

commit 233c2b80739a2308531279f877d463641ca35940
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Mar 23 17:09:45 2016 +0100

    increase IO async to 64 for windows

commit 9f4e9442a453f0dc23078571cc63b69b31c8fdcb
Merge: 1c11d093d c922b2fa8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 18:49:52 2016 +0300

    Merge branch 'slave_wait_timeout_configurable' of https://github.com/lemenkov/rabbitmq-server into lemenkov-slave_wait_timeout_configurable

commit 859a3a520764b394507df7dc35c6a29efb444f5c
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 23 17:49:07 2016 +0300

    Fix `rabbitmqctl list_consumers`
    
    As we are mapping over queues in search of their consumers, actual
    result for every queue could be zero or more consumers. We need to take
    that into account while printing.
    
    Closes #701

commit 1c11d093d26275e7c4d1dc5d67eec181c88d9397
Merge: 8b5093ed2 ae548891f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 17:20:44 2016 +0300

    Merge branch 'stable'

commit ae548891fc8a6c8e8254e064d91e3b4e89eba8d6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 17:13:37 2016 +0300

    Update rabbitmq-components.mk

commit c922b2fa84a8a7717f90dedccddf878ce7671a1d
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Tue Feb 2 17:19:19 2016 +0300

    Make slaves wait timeout configurable instead of hardcoded 15000
    
    This slightly improves rabbitmq/rabbitmq-server#584
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 2b9b292de4e2f31f49fc9b9e99396aa47c1c8d53
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 23 09:38:54 2016 +0300

    Cosmetics, slightly improved warning messages

commit f15a7ac8de62f87d5a5b76245568b990ec7d3baf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 22 16:01:08 2016 +0300

    Edit authentication backend and mechanisms examples
    
    Only use module names for now, per discussion with the team.
    Many other edits, too.

commit 0982087000eab7fbaffb400c478e9c3b44721f5e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 22 14:58:10 2016 +0300

    Correct validator description

commit f9d33f5275325fbfc8bf36eb12dc4a2b428d62eb
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Mar 21 18:45:48 2016 +0300

    Fix logrotate / systemd incompatibility
    
    On systemd-enabled hosts `/sbin/service` just proxies commands to
    `systemctl`, which doesn't understand funny commands like
    `rotate-logs`. So `rabbitmqctl rotate_logs` is a better alternative.

commit 8b5093ed2b36bed5d977ad64da00b900e2ea4436
Merge: 0de73f310 06d63e3d3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 18 17:44:55 2016 +0100

    Merge branch 'stable'

commit 06d63e3d36287a790ef3928d4e6377ffb7e2fe44
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 18 17:44:18 2016 +0100

    rabbitmq-server: Remove trailing spaces

commit 0649e7bf247a883d4ce7d468b0efacc439ff515a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 18 17:42:00 2016 +0100

    Do not warn about mising kernel polling on Windows
    
    Erlang does not support kernel polling on Windows: there is no need to
    confuse users about this.
    
    Fixes #695.

commit 0de73f310f34bb4ffe53c2c5d217d23b8de630c4
Merge: e75d8be54 f78bd6cda
Author: Brandon Shroyer <bdshroyer@gmail.com>
Date:   Fri Mar 18 15:56:32 2016 +0000

    Merge branch 'stable'

commit f78bd6cdaa934d9097157ad510838ba661d27dc7
Merge: d9851bdde 9cfd5bd64
Author: Brandon Shroyer <bshroyer@pivotal.io>
Date:   Fri Mar 18 15:27:02 2016 +0000

    Merge pull request #694 from rabbitmq/rabbitmq-server-693
    
    "rabbitmqctl stop" exits with 0 if it fails to contact the node

commit 67ff51a1ff5149482a2dcbcb0f8c5c31dd5f0129
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 18 15:24:38 2016 +0000

    Ignore extracted plugin schemas

commit 9cfd5bd64edd527db418ea2cbbb35d53054bfad5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 18 15:21:15 2016 +0100

    "rabbitmqctl stop" exits with 0 if it fails to contact the node
    
    If rabbitmqctl fails to contact the node to ask it to stop, it still
    displays an error message. However, now it exits with 0; it was
    EX_UNAVAILABLE before.
    
    There are two main reasons it can happen:
        o  The node is stopped, so that's ok to exit with 0 because the end
           result is the same.
        o  The Erlang cookie is incorrect. The error message is here to help
           but this situation is quite rare compared to the other one.
    
    There is no way to distinguish both, so let's assume the common
    situation.
    
    This helps in the case of systemd in particular: if one stops RabbitMQ
    using "rabbitmqctl stop" instead of "service rabbitmq-server stop",
    systemd tries to call "rabbitmqctl stop" again. Before this change, it
    failed and put the service in a "failed" state.
    
    Fixes #693.

commit 4d6a76afa7be64c4fcd23e7f17881e41d77c6246
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 17 18:31:15 2016 +0000

    Cosmetics

commit 32cfe13c5da39c4b8f0a15df87733ab17cdac3fb
Merge: c55d96cf7 e75d8be54
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 17 18:24:33 2016 +0000

    Merge branch 'master' into rabbitmq-server-550

commit e75d8be549a5de161fd8e6f201335ae76c425b6b
Merge: 1f45928d8 d9851bdde
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 17 19:17:40 2016 +0100

    Merge branch 'stable'

commit c55d96cf750568ec89b207bf4aa2058a999b71a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 17 18:11:25 2016 +0000

    Rename function

commit d9851bdde8deb7a784738c25370e9a2a9b7637fc
Merge: 9a02ab057 2f8069568
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Mar 17 19:07:53 2016 +0100

    Merge pull request #666 from binarin/rabbitmq-server-664
    
    Systemd improvements

commit 6e2f094bc73a22a805cbb236ae80378548a3ad47
Merge: 5f921b563 1f45928d8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 17 17:44:12 2016 +0000

    Merge branch 'master' into rabbitmq-server-550

commit 5f921b56324c8780014561e54b2632db87de6416
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 17 13:48:27 2016 +0000

    Trailing ws

commit 06d9f014bd8805e5803104414f84a02491c58026
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 17 12:31:11 2016 +0000

    Added queue_master_locator setting to cuttlefish schema

commit a0f01adceb01d744e4cf79edaaf6dd517c04387f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 17 09:32:14 2016 +0000

    rename env variable CONFIG_ADVANCED to ADVANCED_CONFIG_FILE

commit 458b59adcb45b5e3b77dcb8f991b3fd8f9a705bf
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 16 16:09:05 2016 +0000

    moved snippets tests to rabbitmq_test

commit 2f80695688855157f5ff8fe33239920a793c020a
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 16 16:20:53 2016 +0300

    Check 'systemctl' usability for activaction check

commit dad0d3573b547dd601408a8feac56fb025c2347d
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 16 15:37:34 2016 +0300

    Support abstract unix socket for systemd notify

commit e35736537d4397750244de798a19c6674cf5841c
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Feb 15 12:28:34 2016 +0100

    Add Travis CI job to deploy and smoke test a rabbit OCF
    
    * Add a CI job which triggers only if there are changes
    to the scripts/rabbitmq-server-ha.ocf
    * Add a script to setup a cluster by the pacemaker OCF RA
    and issue a simple smoke test for the cluster membership.
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 1f45928d895868200ddc40592d73ef04f2150649
Merge: 4b777770f e732a7923
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Mar 14 08:35:14 2016 +0000

    Merge pull request #686 from bogdando/master
    
    Revert "Private attributes usage in rabbitmq script"

commit df0965b4a69f8191bba7d213d82ef2edf0d09b77
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Mar 11 20:17:08 2016 +0300

    Explicitly close `socat` port
    
    Before that it happened implicitly due to the death of the controlling
    process. But it's better to make it explicit.

commit 9b6c04b11d879601c8aa11c5ae0e4749618884be
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Mar 11 20:03:51 2016 +0300

    Add an explanation about why `socat(1)` is used

commit 2d6383bade61fea0b8652b72d25bb1a9f0d6133f
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Mar 11 17:42:15 2016 +0300

    Improve systemd integration
    
    Hopefully this patch will fix all systemd-related problems:
    - Proxy shell process (which converts signals to `rabbitmqtl stop`) will
      no longer be started under systemd. There is no need in it, as systemd
      unit already contains instructions for graceful shutdown.
    - Ready notification for systemd will be sent with the help of `socat`,
      as `systemd-notify` is currently broken for non-root users. `socat` is
      the most lightweight way to do it (other options are using NIF or some
      external helper in Perl).
    - epmd will not be able to interfere by sending it's own ready
      notifications.
    - systemd journal will contain some additional messages about startup
      and shutdown sequence, just to be sure that everything is working
      correctly.
    
    Fixes #664

commit 4b777770f22d8c936c5e92c10a7e6a9ab3bbffd9
Merge: 0930ba977 9a02ab057
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 11 19:08:50 2016 +0300

    Merge branch 'stable'

commit 9a02ab05715068740cb125123a271a8f705a6bde
Merge: 2ed6627c1 2f67cb5c1
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 11 18:08:56 2016 +0300

    Merge pull request #685 from bogdando/bug/1556123
    
    Revert "Private attributes usage in rabbitmq script"

commit 2f67cb5c1c82a929a56fa9996773150a9ec49837
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Mar 11 15:35:37 2016 +0100

    Revert "Private attributes usage in rabbitmq script"
    
    This reverts commit 4aeaa79bc566c81bc7f5c20d7afbe39c32771aba.
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1556123

commit e732a79230849f28b24b7823720947bcf3f59f02
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Mar 11 15:35:37 2016 +0100

    Revert "Private attributes usage in rabbitmq script"
    
    This reverts commit 4aeaa79bc566c81bc7f5c20d7afbe39c32771aba.
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1556123

commit 0930ba97749cf24ff7c2f2d564d3392836422b75
Merge: 3de092177 2ed6627c1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 11 09:13:59 2016 +0000

    Merge branch 'stable'

commit 2ed6627c178b22851ad359f2243a4d474a2e46e5
Merge: 61cc6e5a7 96a791b51
Author: Gabriele Santomaggio <G.santomaggio@gmail.com>
Date:   Thu Mar 10 21:14:50 2016 +0100

    Merge pull request #674 from rabbitmq/rabbitmq-server-553
    
    Verify that mandatory environment variables are (pre)set

commit aa8d7f00d3ae279a0bac46137933540b009aa86d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 10 14:30:38 2016 +0000

    Do not generate config in prelaunch. Copy rabbitmq.schema to SCHEMA_DIR

commit 32b59f88115699f139a15621aaa36c01542c20fe
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 10 14:16:12 2016 +0000

    Env variable for schema dir

commit 410084826c1d2a8f03a806f3ca417114f788d412
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 10 14:02:19 2016 +0000

    Create rabbitmq-env.conf file on installation to prevent copying of rabbitmq.conf

commit 96a791b5137c3e463bf0ab13484f325b1a3bb3fd
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Thu Mar 10 14:47:02 2016 +0100

    removed check_start_params on stop_rabbitmq_server

commit 3de0921770a3c41779889880082db467ef6edac4
Merge: de451393f 61cc6e5a7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 9 14:56:51 2016 +0000

    Merge branch 'stable'

commit 61cc6e5a764a765f9d36e30ee0e6de58b06ffd6c
Merge: 9ece58cd9 fa75a4a0f
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Wed Mar 9 17:54:49 2016 +0300

    Merge pull request #680 from binarin/rabbitmq-server-ctl-no-break-handler
    
    Disable erlang break handler in rabbitmqctl

commit fa75a4a0f4267ff7aa380441aa22159039446069
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Mar 9 17:32:02 2016 +0300

    Disable erlang break handler in rabbitmqctl
    
    So rabbitmq operator will not be baffled by erlang break handler when he
    tries to interrupt some long-running `rabbitmqctl` command by `Ctrl-C`.

commit cc1b3d264a825e61e65e166aaf51e2ecd01b13b4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 9 12:06:22 2016 +0000

    variable unquoting

commit e5774d44fae2dc5b4df5d1442ffe5186e526adee
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Mar 9 09:45:28 2016 +0000

    remove debug echo

commit fa3d8290f079e4eb3ae150c4486fd6427d2f9008
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Mar 8 17:51:55 2016 +0100

    moved check_not_empty controls, removed double quotes

commit da4eb948c30589c4685152466adb33af4457b230
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Mar 8 12:29:07 2016 +0100

    fixed message

commit c75f4f985d079b833b307bb890f326fe4b187fe2
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Mar 8 12:26:35 2016 +0100

    more error details

commit 053e798b312a01ada29c17cc101fa140f3ae9753
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Tue Mar 8 11:25:05 2016 +0100

    removed double quotes for the variables

commit 9ece58cd937bcf7ace78843d1db3cac8a0a93352
Merge: a4fb78fec bca3c1d1b
Author: Gabriele Santomaggio <G.santomaggio@gmail.com>
Date:   Mon Mar 7 18:14:56 2016 +0100

    Merge pull request #660 from rabbitmq/rabbitmq-server-659
    
    Create rabbitmq.config on windows installation

commit bca3c1d1bde28b52ba81b5f3ed8e5250d7bf0278
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Mar 7 12:06:44 2016 +0100

    fixed a small syntax error

commit de451393f149a41ce7af56195557ccc8d78e8a7d
Merge: 07d336b85 a4fb78fec
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Mar 7 14:00:11 2016 +0300

    Merge branch 'stable'

commit a4fb78fec4517570988b79c0c8b1cebc32c17a1c
Merge: 0d65ecaa6 3fa7e7b05
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Mar 7 13:59:48 2016 +0300

    Merge pull request #653 from dmitrymex/log-pid
    
    [OCF HA] Log process id in RabbitMQ OCF script

commit 4596ca25a2e2f9652a2ac2a5e3f2458dbb508fd9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 4 17:09:48 2016 +0000

    mention RABBITMQ_CONF_ENV_FILE

commit efb5c041e93d371e5f95b5a9cdee7f1e529c8c56
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 4 16:22:02 2016 +0000

    testing snippets from documentation

commit 628d803b95a6aa93e82e6b6e53dce70a7513a522
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Jan 27 16:59:21 2016 +0100

    Batch writes to the index on requeue

commit 5d0c0c7932cc43dc8387baccdf9a7d5046ee8ac2
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Mar 4 10:09:51 2016 +0000

    Move default config creation to rabbitmq-service.bat

commit 07d336b85141ef02f431eab18ad94a8574e6b7e4
Merge: b6833ce9f 0d65ecaa6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 4 03:02:00 2016 +0300

    Merge branch 'stable'

commit 0d65ecaa6437094873e68d12e63907ae98c0f99f
Merge: 9bffa7957 3ee51f779
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Mar 4 03:01:01 2016 +0300

    Merge pull request #572 from rabbitmq/rabbitmq-server-346
    
    Avoid hipe compile versioned modules

commit 3ee51f779ac237d33c9d07a7214a3aa75248c404
Merge: e56a3ab64 9bffa7957
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Mar 4 01:02:47 2016 +0300

    Merge branch 'stable' into rabbitmq-server-346

commit 6cf3097e9f99f9293bac718aaea03b595270d57f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 3 15:39:15 2016 +0000

    Don't install rabbitmq service if empty env

commit d48f79513738f94922a1ec10090bf253eef16204
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 13:26:21 2016 +0000

    Check for env variables in windows script

commit 5101bbc65b8bd67ba856bf850dda50f2716d9f4d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jan 29 16:10:44 2016 +0000

    Check env variables before start

commit fd5c4c6a496676d36f06b883a98aaa2678666246
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 3 15:06:01 2016 +0000

    config generation testing

commit c61a79f050bbffc00329c1a56b09732508fbf63c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Mar 3 15:04:50 2016 +0000

    Config generation fixes

commit b6833ce9ffb6121e458374b8713aaf7cec9e4fa9
Merge: 8d6ae7c68 9bffa7957
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Mar 3 03:08:38 2016 +0300

    Merge branch 'stable'

commit 9bffa7957ecea99b9d3363a55f12d590c0af8bf9
Merge: b322e0c12 34eb9c14b
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Mar 3 03:07:45 2016 +0300

    Merge pull request #673 from rabbitmq/rabbitmq-server-671
    
    Move auth_backend and types modules to rabbitmq-common.

commit 34eb9c14bc83077665eccb82ea2dab237bbffcde
Author: Brandon Shroyer <bshroyer@pivotal.io>
Date:   Wed Mar 2 13:48:57 2016 -0500

    Move auth_backend and types modules to rabbitmq-common.
    
    * Delete these modules from rabbitmq-server and add them to rabbitmq-common.

commit 8d6ae7c68bb4df0ceed252b683a48e3113997cbd
Merge: 7f9dfd829 b322e0c12
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 2 23:24:30 2016 +0300

    Merge branch 'stable'

commit b322e0c121f38abc3d2c74d28896fa3455ea1aa9
Merge: 98182a9a7 a2641acda
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 2 23:17:28 2016 +0300

    Merge pull request #648 from rabbitmq/rabbitmq-server-645
    
    Restart option for windows service.

commit 7f9dfd829f2f4bf9fefaf8a96aaccedcda3c2930
Merge: aace92afd 98182a9a7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 2 20:13:23 2016 +0300

    Merge branch 'stable'

commit 98182a9a70db53d6d99845780832ca318141a655
Merge: c2b0c69b4 188d7a06e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 2 20:12:53 2016 +0300

    Merge branch 'rabbitmq-server-398' into stable

commit 188d7a06e21d75220d0d0a718164f717a92cb70e
Merge: 11a09bd72 c2b0c69b4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Mar 2 19:30:42 2016 +0300

    Merge branch 'stable' into rabbitmq-server-398

commit aace92afd7405cbff7597769079ad692a50d28cc
Merge: d7791b895 c2b0c69b4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 2 17:36:42 2016 +0300

    Merge branch 'stable'

commit c2b0c69b4d6eb366c215933e0d8320f2b66bc4ab
Merge: 9c33c701f 88106e6a8
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Mar 2 17:36:20 2016 +0300

    Merge pull request #669 from rabbitmq/rabbitmq-server-667
    
    Bump rabbit.channel_operation_timeout default to 15s

commit 88106e6a8375692436a7c0c40aaeea06f1293937
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 2 17:00:16 2016 +0300

    Bump rabbit.channel_operation_timeout default to 15s
    
    Fixes #667.

commit d7791b8954dc2fe1714d7ab06a0d3d23b5dddad1
Merge: 9c5506388 9c33c701f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 1 16:40:32 2016 +0300

    Merge branch 'stable'

commit 9c33c701fa496826b53a7a387da3b5e4beaa6e87
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Mar 1 13:37:17 2016 +0000

    Commit 3.6.1-1 change log

commit 9c55063883ee201c1f29340db182996d880d5c20
Merge: 9753e9767 a99d5939c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 1 13:45:34 2016 +0300

    Merge branch 'stable'

commit a99d5939c8557384760db3783b59385af7d3db9a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Mar 1 13:45:06 2016 +0300

    Ignore debug/* and PACKAGES/*

commit 9753e97671a1cc2a917bdc4c7e91eded15bc5da5
Merge: 10d3342fb 827db0c8e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Mar 1 00:53:53 2016 +0300

    Merge branch 'stable'

commit 827db0c8e4ab5ca8102e2423de459e0cea8f91db
Merge: 43966560c 54f1fce2d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Mar 1 00:50:46 2016 +0300

    Merge branch 'deadtrickster-rabbitmqctl-man-fix' into stable

commit 54f1fce2d8116f0954386be57547802dbb389a59
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Mar 1 00:47:33 2016 +0300

    vhostpath => vhost in rabbitmqctl.1

commit a105dd09f4cbfbbb90a248cff6c9500803b5448c
Author: Ilya Khaprov <dead.trickster@gmail.com>
Date:   Mon Feb 29 12:30:02 2016 -0800

    Document rabbitmqctl commands sync_queue, cancel_sync_queue, purge_queue also accept vhostpath.

commit ee55dd5b1c454c57b85cb34743117545aaa0dbcd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 29 18:10:07 2016 +0000

    Missing ssl options

commit 814b2a6ca7b4c6b5fa4e2cb3d2427a0ae145c8a9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 29 17:25:19 2016 +0000

    "none" option for listeners

commit 09c15b37d9a8fbdb185fcb8858ee5b3a1c01e068
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 29 14:15:19 2016 +0000

    Plural form for pause_if_all_down nodes

commit c2be967dbceaa2ecb6e222bd569cca2d671912e9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 29 13:18:15 2016 +0000

    Create rabbitmq.config on installation

commit 43966560c282156997f7b2f585f6e9c931e2a943
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 29 05:03:01 2016 -0800

    Run xmlto in more verbose mode

commit 10d3342fb68f871f3f4433fec95a7907e74a04cc
Merge: 023fd3f48 49c1517ac
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 29 03:04:04 2016 -0800

    Merge branch 'stable'

commit 49c1517acd96b8c7baafa55d1fd059ad25a606c3
Merge: 4027b421c 41bcec42a
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 29 13:32:38 2016 +0300

    Merge pull request #657 from dmitrymex/seamless-promotion
    
    [OCF HA] On neighbor promotion do nothing if we are already clustered

commit 41bcec42a8606e8be02b1069d606591ba18dcf84
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Mon Feb 29 12:41:57 2016 +0300

    [OCF HA] On neighbor promotion do nothing if we are already clustered
    
     + extracted function checking if we are in the same cluster with
       given node
    
     + made post-promote ignore promotion of self. Previously it was
       done inside jjj_join, but now we need to do that before the
       new check.
    
     + now we write "post-promote end" log entry at the very
       end of post-promote, not somewhere in the middle.

commit 11a09bd729af49e843ddefec8d82425111f7a972
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 29 02:04:05 2016 +0300

    Wording

commit 023fd3f48a0eb74b9322a7687c2db282350640a3
Merge: aa6ecbfd9 4027b421c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 27 02:03:21 2016 +0300

    Merge branch 'stable'

commit 4027b421cf22fa8d7f5eba0ac8f0da9668ab2e11
Merge: a578f1228 0681ff2f3
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Feb 27 01:58:07 2016 +0300

    Merge pull request #655 from rabbitmq/rabbitmq-server-596
    
    Unescape list_permissions and list_user_permissions regexes

commit 2492383e66974934060b304e1adf147964527a6f
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Feb 26 17:18:39 2016 +0000

    Return error codes in node health check

commit 7caacbb67f5ea1429aae4e4a0c372ca6e93d0a51
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Feb 26 16:47:54 2016 +0000

    Restore rabbit_cli:rpc_call API

commit 0681ff2f37c06091b9a834e125aa27b45c6a41fa
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Feb 26 16:35:25 2016 +0000

    Unescape list_permission and list_user_permission regexes

commit ab9c1f9c4ad73e8aaaaf865a751171cdaecd499a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 26 14:30:11 2016 +0000

    none options for config collections

commit 292f99e12f80a9ff7b10c0bf3d9a7f9b56d169a6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 26 15:41:52 2016 +0300

    Minor edits

commit e545ab285c0458a657373fb5b018f42eddfc724e
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Fri Feb 26 13:51:12 2016 +0300

    [OCF HA] Do not check cluster health if master is not elected
    
    Doing otherwise causes node to restart when get_monitor is called
    within action_promote - it does not find a master and assumes that
    it is running out of cluster.
    
    Also, code is refactored a little bit - a new function returning
    current master is created and is used in the changed code.

commit e6cea86b4d4db00b182083a1ed34f8e0c8336415
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Feb 25 16:27:54 2016 +0000

    Move health checks to rabbit_common and rabbit_cli:rpc_call to rabbit/rabbit_misc

commit e56a3ab64d7f756f1d95e954c227348f0b2381de
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Jan 22 12:45:51 2016 +0000

    Avoid hipe compile versioned modules
    
    References #346.
    References #347.

commit 3fa7e7b05c4a921f5baecb27bee57615b96acb3d
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Thu Feb 25 17:45:32 2016 +0300

    [OCF HA] Log process id in RabbitMQ OCF script
    
    Several OCF calls might run simultaneously. For example, it often
    happens that two monitor calls intersect. Logging current process id
    for each line helps distinguish logs of different calls.
    
    Also aligned get_status() logging with format used in all other
    parts of the script.

commit aa6ecbfd9e17a2911f90b11a17157c74fe75e37f
Merge: 2ca7c479e a578f1228
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 25 17:06:35 2016 +0300

    Merge branch 'stable'

commit a578f1228b5e0e7ca276ce74738fc446beece07e
Merge: 472aa9abb a85a7bd85
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 25 17:03:05 2016 +0300

    Merge pull request #650 from dmitrymex/increase-timeout
    
    [OCF HA] Increase tolerable number of rabbitmqctl timeouts

commit 0b8e52ae62fb80ce4902c7fddc9aaf5f522483dd
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Feb 25 12:48:37 2016 +0000

    Rename aliveness_test to node_health_check

commit 5745eb38faf0f66df1123582695783f78d69764c
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Feb 25 12:17:30 2016 +0000

    Use net_ticktime + 10s as timeout in the aliveness test and abort with the first error

commit a85a7bd85e449a1379760c01c037edba0400cb5f
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Thu Feb 25 14:47:34 2016 +0300

    [OCF HA] Increase tolerable number of rabbitmqctl timeouts
    
    We still see that rabbitmqctl list_channels times out from time
    to time, though the RabbitMQ cluster is absolutely healthy in any
    other aspect.
    
    Setting max_rabbitmqctl_timeouts to 3 seems to be a sane default
    to help avoid unnecessary restarts.

commit 4a540f50aa3792ef2ce870ecf2319edaf266fb8f
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Feb 25 11:42:43 2016 +0000

    Add aliveness_test documentation

commit a5713f090c873a85cff74ff3a281d5765919743e
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Feb 24 17:40:50 2016 +0000

    Aliveness check
    
    * Basic checks

commit a2641acda4cceef6ec009648e75c3c90886cd789
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 24 15:08:02 2016 +0000

    onfail parameter to erlsrv

commit b65acaad385c17eb11e5d04df7bd69602d2f2c29
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 24 14:48:23 2016 +0300

    Example edits

commit 9ad0b6d6ec5b248aa09558ccc561ffa0e2b1a6c8
Merge: 81885ac7b 2ca7c479e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 23 11:27:29 2016 +0300

    Merge branch 'master' into rabbitmq-server-550

commit 2ca7c479e13a4d4ebce29591a0c9590579030516
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Feb 23 11:27:18 2016 +0300

    Ignore debug/*

commit 81885ac7b8aa09e105ba9f1c977f49fa69c9af7a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 22 16:16:17 2016 +0000

    Application unload on plugins schemas extract

commit 307f6acb13c24ca4314c54ecfb2db63e0e0df6bd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Feb 22 18:41:05 2016 +0300

    Use more realistic (and unique) filenames

commit 34665a95d8ba021bdc685d8e71918a697fcdd7c6
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 22 11:19:29 2016 +0000

    Advanced config with pieces of examples

commit d937467ee05b0eef81f3ba2b4d420cbc3df98f50
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 22 11:15:40 2016 +0000

    Config location logging

commit 173260d91e1f10ba0e5ef2cd16889ccd5bb28dab
Merge: 5e10fa5b9 1b511b72c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 17:12:08 2016 +0000

    Merge branch 'master' into rabbitmq-server-550
    
    Conflicts:
            scripts/rabbitmq-env.bat

commit 5e10fa5b9ec26c8934b477007a83e556cbac719f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 17:07:03 2016 +0000

    Do not rewrite advanced.config on windows installation

commit c97ea160f5af0699c7389ad6f4167477aa81bc60
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 16:36:15 2016 +0000

    New cuttlefish

commit 7f9f0d2bc5dcc20eb4f6d7e82f45c4dae1da8694
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 16:32:06 2016 +0000

    Update rabbitmq.config to advanced.config on windows

commit 1b511b72c6ac58a21157e08349344ca5a23894e5
Merge: 58313b7f8 472aa9abb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 19 17:54:27 2016 +0300

    Merge branch 'stable'

commit 6c8be6e7b15d787382afcb77f62ef0a82fae1a55
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 14:22:57 2016 +0000

    Windows scripts

commit 472aa9abbadeaaf0c325bbd7f1edc90c61464fc1
Merge: d68b89294 6fe8cd4c0
Author: Gabriele Santomaggio <G.santomaggio@gmail.com>
Date:   Fri Feb 19 14:50:41 2016 +0100

    Merge pull request #636 from rabbitmq/rabbitmq-server-634
    
    Windows installer: don't jump to the finish page on install/uninstall

commit 58313b7f8bb358fd60ed639cbd71274843eecd53
Merge: 3a57615bd d68b89294
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Feb 19 15:30:23 2016 +0300

    Merge branch 'stable'

commit d68b89294d1b0b806b353f246b8058078efc776a
Merge: a245be70b 4aeaa79bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 19 15:28:30 2016 +0300

    Merge pull request #639 from lefremova/stable
    
    Private attributes usage in rabbitmq script

commit a245be70bbd3608ec8a0183f231ac40fe401e2c9
Merge: 0f60daf36 6f0afbe44
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 19 15:28:21 2016 +0300

    Merge pull request #630 from dmitrymex/stable
    
    Exit waiting loop once node has unjoined

commit a1c765da79f81c8e07191fccb4aecb14819eeb1f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 19 11:24:13 2016 +0000

    Use advanced config as inittial config. Extract plugin schemas

commit 4aeaa79bc566c81bc7f5c20d7afbe39c32771aba
Author: Liubov Efremova <lefremova@mirantis.com>
Date:   Fri Feb 19 12:58:38 2016 +0300

    Private attributes usage in rabbitmq script
    
    There are three types of rabbitmq attributes for pacemaker nodes:
            -'rabbit-master'
            -'rabbit-start-time'
            - timeouts:
                    -'rabbit_list_channels_timeouts'
                    -'rabbit_get_alarms_timeouts'
                    -'rabbit_list_queues_timeouts'
    
    Attributes with names 'rabbit-master' and 'rabbit-start-time' should be
    public because we monitor this attributes in cycle for all nodes in our
    script.
    
    All timeouts attributes were changed to private to avoid unnecessary
    transitions.
    
    Also, --lifetime and --node options were removed for attrd_updater as
    'lifetime' for this command is always 'reboot' and 'node' default value
    is local one.

commit 3a57615bd41dd77aa50577c2a3788972d7eb958c
Merge: 0d68c00ab 0f60daf36
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 18 18:31:56 2016 +0300

    Merge branch 'stable'

commit 0f60daf36232578b023e365dcd7c0be6166c82b2
Merge: b84ebceb5 c66d51f4f
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 18 18:31:05 2016 +0300

    Merge pull request #635 from rabbitmq/rabbitmq-server-248
    
    Introduce rabbit.channel_operation_timeout

commit c66d51f4f57c425bfa2fa152bd4895ed56915ceb
Merge: 4152ecbc7 01e039f4d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 18 18:30:18 2016 +0300

    Merge branch 'stable' into rabbitmq-server-248

commit 0d68c00abcc11af44984233182a852706f557e26
Merge: 104906c21 b84ebceb5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 18 14:55:13 2016 +0000

    Merge branch 'stable'

commit b84ebceb5d55f73ac9ca7eee9ec4a4d96f357a94
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 18 14:53:48 2016 +0000

    Makefile: Fix Makefile indentation
    
    Spaces were mixed with tabs, though make(1) expects the latter.

commit 54b48b26e3b4ca7172c5ba46c6430e98f5bb8696
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 18 14:52:49 2016 +0000

    make manpages: Fix xmlto(1) failures handling
    
    Before, a failure from xmlto(1) was ignored and the build continued
    "happily".

commit 4152ecbc7a7a4d0223a4f51f542149da04f37692
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Feb 18 17:12:34 2016 +0300

    Bump rabbit.channel_operation_timeout to 5s
    
    Per discussion with Ayanda. Lower values
    are known to produce false positives in a variety
    of contexts.

commit 6fe8cd4c0e5e91727e85369f048012b67fff5564
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 18 10:32:25 2016 +0000

    Do not jump to finish in windows uninstall

commit e6e62c756be1944dadfa92ccbce57a9dc0674ef8
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 18 10:12:45 2016 +0000

    Do not jump to finish in windows install

commit 0d6204f67337ea10c9b1707f116f1e9b813327cf
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Feb 17 18:00:43 2016 +0000

    Sets initial channel_operation_timeout to 3s.
    To update to a higher value in future, for cross-node calls.

commit 16f22c45cc4f584b1875a87e765d37ba4b56fbcc
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Feb 2 18:54:01 2016 +0000

    Adds channel_operation_timeout envionment variable.
    
    References: #248

commit d0bc71dba5a07786d4f9d71445b55276bfb12846
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 17 13:21:44 2016 +0000

    Load any schema from plugin schema dir

commit 104906c21c6ffdc6741d5341e07465e6ced8d9c5
Merge: eefeaa480 01e039f4d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 17 14:32:00 2016 +0300

    Merge branch 'stable'

commit 01e039f4dd2b6d78d9d67f7472bc06394f320fc3
Merge: dc970adcd 9b837c0bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 17 14:31:28 2016 +0300

    Merge pull request #631 from rabbitmq/rabbitmq-server-625
    
    Added erl call to make sure epmd is started

commit 9b837c0bc582deb39ae12c6172e41d5e13813dee
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 17 14:30:32 2016 +0300

    Indentation

commit 7104595588c739dc8e92671b0307adcb9b40ef2f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 17 11:11:57 2016 +0000

    Support for plugin schemas

commit a12dca2d39f6bbff94a8008f5250a81af70f6db4
Author: gabriele santomaggio <g.santomaggio@gmail.com>
Date:   Wed Feb 17 11:42:32 2016 +0100

    added erl with -sname to make sure epmd is started

commit 77bea34198bbbf4f67f726652e5144ca14d66601
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 16 17:17:53 2016 +0000

    Removed single to plural form mapping

commit 6f0afbe443df40725a2d876e80ed47f354bdb865
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Tue Feb 16 15:25:28 2016 +0300

    Exit waiting loop once node has unjoined
    
    Without the break we always wait for 50 seconds, even if we don't need
    to wait at all.

commit b1656e011b14f8890d45c5370fab87511a855636
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 12:25:13 2016 +0300

    Re-format with Emacs, clarify comments

commit 709d26538da4309f1f284aca10be7be4a1fef2c9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 12:18:09 2016 +0300

    Strip trailing ws

commit d3b09679a14f7f6986f6efbcfc6e6e9edb99b90e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 12:16:35 2016 +0300

    Wording

commit 071bfd9aa227b7031f6a858e5a35030075d04130
Merge: 3e671a153 eefeaa480
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 11:14:55 2016 +0300

    Merge branch 'master' into rabbitmq-server-550

commit eefeaa480ceaf86c993b7ab2a392aeef5a378865
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 11:13:59 2016 +0300

    Squash a warning

commit 3e671a153b02dda537351a68ea5920c9f7524eef
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 11:07:45 2016 +0300

    Squash a warning

commit 113bc016ac222151b11e1e110bdbca10d23d56b6
Merge: fbb49b43f 25a2d83fb
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 16 10:29:26 2016 +0300

    Merge branch 'master' into rabbitmq-server-550

commit 25a2d83fbd2952f5cb0e9f8840d3379f11ee402c
Merge: 7f1a82c96 dc970adcd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 15 22:43:49 2016 -0800

    Merge branch 'stable'

commit dc970adcd90dc2f9bda4af1d14989fc647354a82
Author: Chris Bandy <cbandy@sittercity.com>
Date:   Tue Feb 9 13:30:39 2016 -0600

    Use basic regular expressions for sed portability

commit 7f1a82c9640a573d309881fc59453eab96fbd4e2
Merge: 897458190 99c982d3c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 15 22:42:01 2016 -0800

    Merge branch 'cbandy-posix-sed'

commit 99c982d3cf0e2b2b89ae1253ec52c16b02d4161e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 15 22:41:40 2016 -0800

    Ignore PACKAGES/*

commit 42598d54d321ee0d2d1785e5f4f36f554131fcf8
Merge: 897458190 1d3093798
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 15 20:53:04 2016 -0800

    Merge branch 'posix-sed' of https://github.com/cbandy/rabbitmq-server into cbandy-posix-sed

commit 897458190d41596f2aa4d513172b6e6dd66aadb9
Merge: b69f3e7a8 dbf992303
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 11 01:49:41 2016 +0300

    Merge branch 'stable'

commit dbf9923039f6de4d18a3af0934146408eb9f455b
Merge: 5d9d07476 61e6e6c33
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 11 00:29:40 2016 +0300

    Merge pull request #617 from rabbitmq/rabbitmq-server-616
    
    rabbit_mirror_queue_sync: Pause the syncer process if memory is low

commit b69f3e7a8f2957d29614f2ae4bd861e00ccb8fed
Merge: 0120438b9 5d9d07476
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 10 16:51:38 2016 +0300

    Merge branch 'stable'

commit 61e6e6c33d447d2aa9e977d0244ad3a692670a8c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Feb 10 14:34:34 2016 +0100

    rabbit_mirror_queue_sync: Pause the syncer process if memory is low
    
    If any node in the cluster is running out of memory, we pause the syncer
    process. If we don't do this, this alarmed node could crash.
    
    Fixes #616.

commit 5d9d07476a85993b082bed651afdc6103be57af8
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Feb 10 14:24:21 2016 +0100

    rabbit_alarm: Fix resource_alarm_source() type
    
    Alarms are emitted for 'disk' or 'memory' resources shortage, not
    'node'.

commit 1d3093798ed77bcadf86524d127cd97f1d9c420e
Author: Chris Bandy <cbandy@sittercity.com>
Date:   Tue Feb 9 13:30:39 2016 -0600

    Use basic regular expressions for sed portability

commit fbb49b43fd6a3472fffb6ad7f0ecea94a4727926
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 9 14:35:47 2016 +0000

    Additional config gile

commit bbaf22bd1fe2397dd0f97cf2fcde84db42e62837
Merge: 0f5111cab 0120438b9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 9 14:12:07 2016 +0000

    Merge branch 'master' into rabbitmq-server-550

commit 0f5111cab23e900ccc6794b53f220de594a11c80
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 9 13:36:38 2016 +0000

    Node name for epmd touch

commit bc3d5247c38e14e938bf8461889c52b15d188aaa
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 9 11:35:05 2016 +0000

    Touch epmd when installing to windows

commit 0120438b9441e6c4c1d650bf03e9e4995d9cab83
Merge: 2374ae857 1c89fe978
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 9 11:10:50 2016 +0100

    Merge branch 'stable'

commit 1c89fe978d6199f3fe63daed1dec377d5378db7e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 9 11:09:09 2016 +0100

    rabbitmq-env.bat: Do not prepare and escape RABBITMQ_PLUGINS_EXPAND_DIR
    
    RabbitMQ recreates it anyway so we can't pass it the escaped directory
    name. Therefore, this directory must not contain any non-US-ASCII in its
    name.
    
    References #493.

commit e2d8b5949f4244e004e6187635eb6a90cd411d9d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 8 18:21:18 2016 +0000

    Make service generate config

commit 85b811e30b792c42d1c1f087eaec41725f64d06f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 8 16:25:36 2016 +0000

    Config detection in rabbit_config. Always pass generate args to windows script

commit b27e7d1dfb889df1b2c98c6101bf8cb3cf281e15
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 8 13:32:08 2016 +0000

    Fixing start args

commit d7ae42db7c3741c5a93da596ac0bd7efccd58985
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 8 12:33:43 2016 +0000

    Scripts to start erlang node with .conf file to generate config

commit 2374ae85777e4b1005021c540936af3bba828681
Merge: 831a60f8a e9ee125ae
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 5 23:47:13 2016 +0300

    Merge pull request #611 from rabbitmq/rabbitmq-server-590
    
    Auto deleted queue log

commit e9ee125aecee9cdd61a4b8f48cdd3849a8bb439d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 19:28:17 2016 +0000

    Log connection pid only

commit e14d56d6e8377ff88356783f4e2ede4a3ce3da4a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 18:07:06 2016 +0000

    Do not log connection ref

commit cc80a0ce8dab2b8e96c2d0ede17213f0dfdecb7f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 5 20:28:10 2016 +0300

    More copy edits

commit 41c6ec56c5829286551906c9ddd23fa0a166f9fd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 16:43:24 2016 +0000

    Logging queue deletion at debug level

commit 8e4715b91cec879335b70fccd0fd4e5c9ceb25d7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 5 19:34:35 2016 +0300

    Grammar

commit 9d6e514a9ead6d784a939fe52e798dcd21d5c519
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 5 19:31:18 2016 +0300

    Copy

commit 7a062e5f5cb1c8caf59d06680c1a015a30fdbe6c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 16:05:42 2016 +0000

    Fix wording

commit 831a60f8a3820d266d7aa12be309023dbd9165ad
Merge: feab45a50 2a676f60d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 5 18:48:11 2016 +0300

    Merge branch 'stable'

commit 2a676f60d4f5f8b3f21815e6d99720c279da5d58
Merge: f9adbe0be 4b08c2875
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Feb 5 18:33:19 2016 +0300

    Merge pull request #609 from bogdando/bug/1541029
    
    Fix action_stop for the rabbit OCF

commit 266f37db4b4bbf23c9559b10d7d716bfc66b6652
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Feb 5 14:43:29 2016 +0000

    Generation called from inside erlang only

commit c7e8d67416a88b627f97c77932d64ed385581404
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 19:01:22 2016 +0000

    Remove rabbitmq fork of lager dependency

commit 0d5a1f2868acff46746545f3a1020faa868c0e63
Merge: f608e304e feab45a50
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:58:30 2016 +0000

    Merge branch 'master' into rabbitmq-server-590

commit f608e304e0dbeb11154514eb249848e482e1d52f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:58:10 2016 +0000

    error_logger_lager_event sink

commit c533ae0cfbb962d81ce3f76eb079abcef9e29c1f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:48:25 2016 +0000

    Federation log sink

commit 4f06877b3adee8d1f39f96d5376aeb6f59c0d16e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:25:51 2016 +0000

    Log auto delete with debug level

commit d273e9f72b15ed0448461b85fb8fea89fb08b6a1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:22:56 2016 +0000

    Resolve category name to sink name

commit 246c21eec2d8acce04ce5bafa283877f46351666
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 18:03:07 2016 +0000

    Call config generation from within erlang

commit 5cc29e823845fcce3f878eddc1c2f1de84f2f7ba
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Feb 4 11:49:03 2016 +0000

    Log auto deleting queues

commit 4b08c2875809b05fd5fc8cf2e3c22684a1a6c548
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Feb 4 12:34:39 2016 +0100

    Fix action_stop for the rabbit OCF
    
    The action_stop may sometimes stop the rabbitmq-server gracefully
    by the PID, but leave unresponsive beam.smp processes running and
    spoiling rabbits. Those shall be stopped as well. The solution is:
    - make proc_stop() to accept a pid=none to use a name matching instead
    - make kill_rmq_and_remove_pid() to stop by the beam process matching as well
    - fix stop_server_process() to ensure there is no beam process left running
    
    Related Fuel bug: https://launchpad.net/bugs/1541029
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit feab45a50294b7aee8e39c0c28ce41e875b58455
Merge: c273270f6 f9adbe0be
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 4 03:06:32 2016 +0300

    Merge branch 'stable'

commit f9adbe0beb355f40194c7cc6b548b6c1f40228c5
Merge: ddd931666 b8b24048e
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 4 03:06:05 2016 +0300

    Merge pull request #604 from rabbitmq/rabbitmq-server-595
    
    Add emitting node info to amq.rabbitmq.log messages

commit b8b24048ec5eb35cfe87e1ea1d95bc518f66214e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Feb 4 02:27:09 2016 +0300

    Add emitting node info to amq.rabbitmq.log messages
    
    Fixes #595.

commit c273270f61a0a78069cacf9443e64a32eb4b4dcc
Merge: e709a0a03 ddd931666
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 3 20:27:37 2016 +0300

    Merge branch 'stable'

commit ddd93166663e574a96f04208dd27098db35b733f
Merge: be984d9f7 9736b075e
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 3 19:48:24 2016 +0300

    Merge pull request #602 from dmitrymex/stable
    
    Streamline checking for cluster partitioning

commit d4ec127d7aa0a8d6514599006db550de96fbdf09
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 3 14:54:23 2016 +0000

    Generated config usage in windows scripts

commit 731019a2b1c2375104239648bb3334a9ea200342
Merge: d3b96aa97 e709a0a03
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 3 14:50:44 2016 +0000

    Merge branch 'master' into rabbitmq-server-550

commit e709a0a03f6c41a3d5e23bfa5c8e20484ea3222c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Feb 3 14:47:27 2016 +0000

    Lager integration for windows service script

commit 9736b075e28f79fab02efca3f4def1382074cbfb
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Wed Feb 3 14:28:50 2016 +0300

    Streamline checking for cluster partitioning
    
    Move check if we are current cluster master to earlier place in code.
    That way we will avoid unnecessary operations for master case.

commit 05361e68edbb3e6893e0bcea2b3a8af4181fab2d
Merge: 28da8c061 be984d9f7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 3 01:00:54 2016 +0300

    Merge branch 'stable'

commit be984d9f7657719d9ec5f77c5b8efd5e6aae9cb7
Merge: 1d2d606b6 4b5d4b791
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 3 01:00:02 2016 +0300

    Merge pull request #601 from bogdando/bug/1540936
    
    Fix cluster membership check for running master

commit 4b5d4b7911e910b399d46ad33fc34bb6e45fbe36
Author: Bogdan Dobrelya <bogdando@mail.ru>
Date:   Tue Feb 2 22:11:09 2016 +0100

    Fix cluster membership check for running master
    
    The running master is always inside of its own cluster.
    Fix the cluster membership check when a node is the master.

commit 28da8c0614a168840c5fafb6dce882ec339dfb36
Merge: 73941de2b 1d2d606b6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 2 20:43:26 2016 +0300

    Merge branch 'stable'

commit 73941de2b1037ced726f1de46ee0cebe49f3c39b
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 2 20:42:43 2016 +0300

    New section: building from source and packaging

commit 1d2d606b6cf890e77bb577310f37ee14d5b46ae6
Merge: 57cd8f8db cb06b9cb1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 2 20:38:40 2016 +0300

    Merge pull request #600 from bogdando/bug/1540936
    
    Fix uninitialized status_master

commit cb06b9cb17871f6d8864dcf106a288a7fce69c58
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Tue Feb 2 17:26:46 2016 +0100

    Fix uninitialized status_master
    
    Fix multiple nodes may be reported in logs as the running master
    
    Related Fuel bug https://bugs.launchpad.net/bugs/1540936
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 54195efa45c44d2290a659b4f8a2f63f6def3c3f
Merge: b36840581 4b556a4e5
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 2 17:39:38 2016 +0300

    Merge pull request #578 from rabbitmq/rabbitmq-server-559
    
    Support for [de-]registration callbacks in rabbit_registry

commit b36840581b73b943b8b01484c31e268dc13c58ac
Merge: 04484fd92 57cd8f8db
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Feb 2 15:58:00 2016 +0300

    Merge branch 'stable'

commit 57cd8f8db9346abc58270ed4c0ca445181db9dd1
Merge: 96161ead7 b9fb0f5a3
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Feb 2 15:45:00 2016 +0300

    Merge pull request #597 from binarin/rabbitmq-server-ocf-quiet-curl
    
    Suppress curl progress indicator in rabbit OCF

commit b9fb0f5a30121f763a9e26e7a228f824d7e7fbc9
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Tue Feb 2 15:41:18 2016 +0300

    Suppress curl progress indicator in rabbit OCF
    
    curl is used by OCF script for fetching definitions (queues etc.), but
    results of that invocation is shown as garbage in pacemaker logs -
    progress indicator doesn't make any sense in logs.
    
    According to curl manpage the following combination of options should be
    used "--silent --show-error" - this will suppress only progress
    indicator, errors will still be shown.
    
    Also other short curl options are replaced with their long counterparts
    - for improved readability.

commit d3b96aa976b11092c695353e623ec58fe109f4c0
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Mon Feb 1 23:25:51 2016 +0000

    Cuttlefish generation in windows

commit 564e11b450b27e650d84a6abb3b0d843adcbe639
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 2 11:47:26 2016 +0000

    COnfig file generation windows

commit 309ca6dc469fa1d782e2fbf5f50b8bd35bbe5721
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Feb 2 10:59:56 2016 +0000

    Starting node with generated config

commit 644073a85997e1334ac7d2b4f8fcd38531c9252a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 1 15:45:42 2016 +0000

    Fixes

commit 2e5378682cba8feac4d60d3c4abed91eee22d43e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 1 14:27:56 2016 +0000

    Auth backends. conf.example file

commit 423ab9d519503ecf8c670860da4f104a90a3285e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Feb 1 11:43:05 2016 +0000

    Docs examples in conf file

commit 04484fd92be9f0076d096094870317fdb649eeae
Merge: 76b134a74 96161ead7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 1 01:22:33 2016 +0300

    Merge branch 'stable'

commit 96161ead760459ba420e7acc001db0433380dffd
Merge: 4f7da6bef 0aced26f9
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Feb 1 01:22:18 2016 +0300

    Merge pull request #594 from rabbitmq/rabbitmq-server-592
    
    Use -r with sed on Linux

commit 0aced26f965fd53a5dc34adfde48e36f9276b053
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Feb 1 01:08:50 2016 +0300

    Use -r with sed on Linux, fixes #592
    
    We previously did the same change in #273 (PR: #275),
    but the file in which it was done was removed in 231e90cacf3daec5f43b3307867129e61496b123.
    
    Note that #592 recommends using `-r` unconditionally but that option
    is not recognised by sed which ships with OS X.

commit 5687c5cd0afc864512dd7245a69f7c2fc895e377
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jan 29 14:47:02 2016 +0000

    more aftomation for testing config

commit 76b134a746c0a8c9a31810cce9b76202ff269516
Merge: 2fa870f86 4f7da6bef
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 29 17:15:16 2016 +0300

    Merge branch 'stable'

commit 4f7da6bef9f9b273c9749739275b1a12ab3be91c
Merge: 548c1ca6b 6aba71548
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 29 17:13:53 2016 +0300

    Merge branch 'rabbitmq-server-541' into stable
    
    This is only a part of what #541 is supposed to cover but
    it already helped in a particular node shutdown lockup we've
    observed => worth merging earlier.
    
    Per discussion with @dcorbacho.

commit 2fa870f863567135e4fc2e4e0ea41837da1964f2
Merge: eae87229e 548c1ca6b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 29 03:50:56 2016 +0300

    Merge branch 'stable'

commit 548c1ca6bf34056f039febdbe395de50f39a2d06
Merge: 9af509002 25f7e3d4f
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 29 02:59:51 2016 +0300

    Merge pull request #588 from rabbitmq/rabbitmq-management-117
    
    Specify hash algorithm in change_password_hash

commit 25f7e3d4f57b090584d879a8008c0e7af24c84a3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 28 22:51:31 2016 +0300

    Trailing ws

commit 7cf3c35d6a0ea7ae2333750fb2b124b55745c749
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jan 28 15:42:23 2016 +0000

    Fix config to start broker

commit ebd48ed0e44cdeaa6987464f69243c2f202f8243
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jan 25 13:04:09 2016 +0000

    Testing schema

commit 3944d12a495ab77b5e9afc6e4ea44bf2e872ad90
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jan 22 16:08:48 2016 +0000

    Duplicate ssl and tcp options in management and MQTT schemas

commit dbe6b5f0a9de1e88cb482c2856da87692b920197
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Jan 22 15:47:01 2016 +0000

    Cuttlefish schema for default config

commit f1f28eac1bc955580bbead82721d75c45e69999d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Jan 28 15:17:06 2016 +0000

    Specify hash algorithm in change_password_hash

commit eae87229e6a115fe4d491cc4d878e4257a81215a
Merge: e4c84b0d1 9af509002
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 27 05:26:10 2016 -0800

    Merge branch 'stable'

commit 6aba71548f60227d2d927facdbe9e8f0c529ab86
Merge: dc6cb6ba6 9af509002
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 27 16:16:45 2016 +0300

    Merge branch 'stable' into rabbitmq-server-541

commit 9af509002ca4d7634d845844571cf30385584efa
Merge: 5dfd117a1 a540dcb15
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 27 16:16:12 2016 +0300

    Merge pull request #584 from rabbitmq/rabbitmq-server-581
    
    Unblock receive after 15s

commit dc6cb6ba63c1df13e9d461ab50baf2416ce733f8
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Jan 27 12:17:27 2016 +0000

    Increase supervisor timeout to net_ticktime + 10s

commit a540dcb15241df519d9ddf09896a0ee9d6fef9e2
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Jan 26 13:10:58 2016 +0000

    Unblock receive after 15s

commit 266d94ac2701618ac2040b2a1ec0f706ef0c70fc
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Jan 27 12:07:52 2016 +0000

    Introduce timeout in rabbit_channel_sup

commit e4c84b0d11cc733057c317b06b2eae6bebee4164
Merge: a99256990 5dfd117a1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 27 11:53:27 2016 +0100

    Merge branch 'stable'

commit 5dfd117a18355ae71b7ec7d389cc8e7a45516aa9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 27 11:51:16 2016 +0100

    rabbit.erl: Do not run systemd-notify on Windows
    
    This silences a warning logged during RabbitMQ startup.

commit a99256990d1cc95cb542301430bebc94b32e73bd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 27 11:20:57 2016 +0100

    rabbitmq-server.bat: Properly quote %RABBITMQ_LOG_BASE%

commit 0a149c54d1ba57d309c00551791f2c3fb06723f7
Merge: 1a2923186 44cd71d1a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 27 09:56:35 2016 +0100

    Merge branch 'stable'

commit 44cd71d1a4eefdb3607a01d183908aec6cffc8cb
Merge: 9b96066d5 cc2f0d295
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Jan 27 09:08:19 2016 +0100

    Merge pull request #535 from rabbitmq/rabbitmq-server-307
    
    Ignore duplicate down_from_ch

commit 9b96066d598c3aef947d13da916536e338dbe891
Merge: 6d3636afe bb8c65c0e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 27 04:06:33 2016 +0300

    Merge branch 'rabbitmq-server-493' into stable

commit bb8c65c0e7b17417c5824fc4075dc5409d6d09d1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jan 26 18:42:57 2016 +0100

    Create directories and files on Windows before conversion to short filenames
    
    If the directory or file does not exist before RabbitMQ starts, we can't let
    RabbitMQ create it, otherwise, it's created with its short filename, not its
    long one.
    
    With this new correction, we can "escape" all variables instead of only
    RABBITMQ_BASE.
    
    Fixes #493.

commit 4b556a4e5c29a7fd947e09e9040d082211a137c7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jan 26 14:21:17 2016 +0000

    Moved rabbit_registry to rabbit_common

commit daef62d8a39dbc96c0001b69aa5dfbafeb6218f1
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Jan 26 14:16:48 2016 +0000

    rabbit_registry_class behaviour

commit 8431261b439f048dbc5b402da23f08cd19ade7eb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jan 15 12:21:22 2016 +0100

    rabbitmq-server.bat: Honor RABBITMQ_LOGS=- to log to stdout
    
    Note that at the time of this commit, Lager does not support logging
    to stdout on Windows. This commit still improves consistency between
    Unix and Windows.
    
    References #493.

commit 0cf09727a63b0e31e6e8487857c0d5b4134060ae
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 16:16:06 2015 +0100

    Use RABBITMQ_HOME to set the path to RabbitMQ ebin directory
    
    Compared to the script's parent directory (stored in TDP0),
    RABBITMQ_HOME is converted to a short filename to avoid non-ASCII in the
    path.
    
    Fixes #493.

commit 4fdacff37dba18e553c8f37c5c43f87de03b793d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 13:52:47 2015 +0100

    Use short filenames in Windows startup scripts
    
    On Windows, cmd.exe and batch scripts do not support Uniode apparently.
    However, Windows uses UTF-16 to encode filenames one disk. In batch
    scripts, filenames are converted to some one-byte-wide charset. Once
    passed to Erlang and RabbitMQ, those filenames are incorrect. In
    particular, the management UI is unhappy because filenames obviously
    contain invalid UTF-8 characters.
    
    Using short filenames makes sure filename only contain US-ASCII
    characters.
    
    To convert them, we use "for" expansion. At the same time, filenames are
    made absolute. It works even better than realpath.exe because the latter
    also converts filenames to another charset again.
    
    Fixe #493.

commit 59ce03bfe4710f5a35765a5b49b2cc962b7773dd
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Jan 25 15:57:54 2016 +0000

    Support for callbacks on register/unregister in registry.

commit 1a292318690bdbf3ee60d63c52045f1dabb4be8e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 22 17:35:13 2016 +0300

    Compile, references #574

commit 12ee9f0180d80963d65b058f2663545a81859e67
Merge: 76e19344a dbc910bdc
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 22 17:34:10 2016 +0300

    Merge pull request #574 from binarin/rabbitmq-server-get-rid-of-sd_notify
    
    Remove mentions of `sd_notify` library

commit dbc910bdcd3a5ac47695a3d9c1375cc93fe943d4
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Jan 22 17:26:00 2016 +0300

    Remove mentions of `sd_notify` library
    
    Calling shell helper systemd_notify(1) is enough to do the same.
    
    Systemd unit file should specify `NotifyAccess=all`.

commit 76e19344a3cf75ab1c2f70b86a5f3f101592eceb
Merge: d1f3b9b8c 6d3636afe
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 22 17:07:22 2016 +0300

    Merge branch 'stable'

commit 6d3636afe1e45b23447e809094c7a7d75240ed0f
Merge: 116f9bd44 466dea8ba
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 22 17:06:52 2016 +0300

    Merge pull request #573 from binarin/rabbitmq-server-systemd-notify-zero-deps
    
    Use systemd-notify(1) shell helper as fallback

commit 466dea8ba68f5687eb8e2dfb90d06f94ce3ac3ee
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Fri Jan 22 16:28:57 2016 +0300

    Use systemd-notify(1) shell helper as fallback
    
    Currently external erlang library `sd_notify` is used to make systemd
    unit with `Type=notify` to work correctly. This library contains some C
    code and thus cannot be built into architecture-independent package.
    
    But it is not actually needed, as systemd provides systemd-notify(1)
    helper for shell scripts which serves exactly the same purpose.
    
    The only thing is that you need to add `NotifyAccess=all` to your unit
    file to make everything work well.

commit d1f3b9b8cd8bb42ed36b29b9a56a7a02ab197ed1
Merge: 212ba3139 116f9bd44
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 21 16:35:59 2016 +0300

    Merge branch 'stable'

commit 116f9bd449abee8d0d4dbc920bb3896efce86882
Merge: 09efccd62 6599946f1
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 21 15:04:22 2016 +0300

    Merge pull request #571 from binarin/rabbitmq-server-ocf-shell-quoting
    
    Fix usage of uninitialized variable in OCF script

commit 6599946f13e35d80ffeb3b55b62e4a67f96f5f4b
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Jan 20 11:10:52 2016 +0300

    Fix usage of uninitialized variable in OCF script

commit 212ba3139a15ff96742c1459ca4f4672ee74da55
Merge: 1f9c3492a 09efccd62
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 21 14:12:25 2016 +0300

    Merge branch 'stable'

commit 09efccd62cf9ac043ccbcaddc0c180474c8957e3
Merge: 8021fef20 3108dabf6
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 21 14:12:07 2016 +0300

    Merge pull request #563 from binarin/rabbitmq-server-ocf-list-channels-diagnostics
    
    Improve OCF script diagnostics for timed-out 'list_channels'

commit 1f9c3492a793f0dfba6be7b84727bf850f9ba1e4
Merge: 3d1f30e48 8021fef20
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 20 17:35:52 2016 +0300

    Merge branch 'stable'

commit 8021fef20327c90faa35ceebd23bab1ddc3c9708
Merge: afd30fb0a 7a0b50ce2
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 20 17:34:33 2016 +0300

    Merge pull request #566 from rabbitmq/rabbitmq-server-319
    
    Remove duplicate code in pre_publish and publish functions

commit 3108dabf61a6c469a38e3c8079a27db2ba2501c5
Author: Alexey Lebedeff <binarin@gmail.com>
Date:   Wed Jan 20 17:14:38 2016 +0300

    Improve 'list_channels' diagnostics in OCF
    
    timeout(1) manpage mentions 124 as another valid return code from, in addition to 128 + signal-number.

commit 7a0b50ce24afa79659ae90bb0883da9ae5d1d135
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Wed Jan 20 14:14:52 2016 +0100

    Remove duplicate code in pre_publish and publish functions

commit 3d1f30e4824f7ba50576617ab3e966509d6d46c4
Merge: 0e5362d0c afd30fb0a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 20 16:03:48 2016 +0300

    Merge branch 'stable'

commit afd30fb0a1739ab8d6c027416ce9ea146a02eb2c
Merge: 6f6825a07 9846fbf5d
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jan 20 15:29:18 2016 +0300

    Merge pull request #560 from dmitrymex/reset-master-score
    
    Reset master score if we decide to restart RabbitMQ on timeout

commit e78bc2d9b792678d1ebdb09f30ee06fe58d39719
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Wed Jan 20 12:07:22 2016 +0300

    Improve rabbitmq OCF script diagnostics
    
    Currently time-out when running 'rabbitmqctl list_channels' is treated
    as a sign that current node is unhealthy. But it could not be the
    case, as the hanging channel could be actually on some other
    node. Given that currently we have more than one bug related to
    'list_channels', it makes sense to improve diagnostics here.
    
    This patch doesn't change any behaviour, only improves logging after
    time-out happens. If time-outs continue to occur (even with latest
    rabbitmq versions or with backported fixes), we could switch to this
    improved list_channels and kill rabbitmq only if stuck channels are
    located on current node. But I hope that all related rabbitmq bugs
    were already closed.

commit 9846fbf5d31997076b46c4735899157d12c7c69c
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Tue Jan 19 19:15:31 2016 +0300

    Reset master score if we decide to restart RabbitMQ on timeout
    
    Doing otherwise might not trigger the restart while it is clearly
    needed.

commit 0e5362d0cbf31eaf520c8f62fd23d3ab0fd40e5d
Merge: b693e911b 6f6825a07
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 19 16:50:50 2016 +0300

    Merge branch 'stable'

commit 6f6825a07440f7272f37bbd47dd445de631c9787
Merge: 115babd86 3202d2151
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 19 16:50:29 2016 +0300

    Merge pull request #558 from galanoff/stable
    
    Add optional prefix for RabbitMQ node FQDNs

commit 3202d21514a51d3c20e290b149364556600decd2
Author: Kyrylo Galanov <kgalanov@mirantis.com>
Date:   Fri Jan 15 16:14:12 2016 +0200

    Add optional prefix for RabbitMQ node FQDNs
    
    It would allow to instantiate multiple rabbit clusters constructed
    from prefix-based instances of rabbit nodes.

commit b693e911b81477a49111c2e8baf1073362998a31
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 16 16:02:46 2016 +0300

    Update LICENSE-MPL-RabbitMQ

commit 721d8e0a47d9f0a406d412f63c9857f8c6ebacec
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 16 03:48:01 2016 +0300

    2016

commit 6f1e94f9d4012c6c39552ca561ce0077a7b054e4
Merge: 2398554cf 115babd86
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 15 21:48:22 2016 +0300

    Merge branch 'stable'

commit 115babd8683614cf89da6cf8cbbba351fc6e8e9a
Merge: c02d7ba8e fe243c2e7
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Jan 15 18:06:00 2016 +0100

    Merge pull request #527 from binarin/rabbitmq-server-better-startup-diagnostics
    
    Improve diagnostics in 'rabbitmq-server' script

commit 2398554cfb5a1cd942ad91dfa8a4e2ac88f38647
Merge: 067882313 07d27cbe9
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Jan 15 17:10:52 2016 +0100

    Merge pull request #548 from binarin/rabbitmq-server-lager-rotate-logs
    
    Update calls to 'rabbitmqctl rotate_logs'

commit 07d27cbe98e7228c4daefb734b31cfc7ed366f4e
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jan 14 12:48:33 2016 +0300

    Update calls to 'rabbitmqctl rotate_logs'
    
    After switch to lager there is no need to to call 'rabbitmqctl
    rotate_logs' from logrotate. Also 'rotate_logs' no longer accepts
    optional argument. Update documentation accordingly.

commit 067882313ce98e5509343761d3d239aa415d92fd
Merge: ffce71a5d c02d7ba8e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 15 14:08:21 2016 +0300

    Merge branch 'stable'

commit c02d7ba8e4ca82ad89bd54f0ef48b269a7a6c17e
Merge: 9a1b1caad 6fd4eb5bc
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 15 14:06:10 2016 +0300

    Merge pull request #547 from bogdando/bug/1531838
    
    Fix rabbitMQ OCF monitor detection of running master

commit ffce71a5d735525d9abc1fbe0beb4e0ade1e25a2
Merge: 32f39d36f 9a1b1caad
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 15 02:40:18 2016 +0300

    Merge branch 'stable'
    
    Conflicts:
            src/rabbit.erl
            src/rabbit_error_logger_file_h.erl
            src/rabbit_sasl_report_file_h.erl

commit 9a1b1caad973826a074a5f1e2fa25a8c6649832b
Merge: d54c06ab2 dbbe3d6e4
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jan 15 02:37:58 2016 +0300

    Merge pull request #543 from binarin/rabbitmq-server-rotate-logs-data-loss
    
    Fix 'rabbitmqctl rotate_logs' behaviour

commit 32f39d36f8a757e3c19816feb6201daa512e0def
Merge: 7c98f51b6 d54c06ab2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Jan 14 23:49:49 2016 +0300

    Merge branch 'stable'

commit d54c06ab2ffd82f6f4d1edb19fd646b84f07ba0e
Merge: 86db8bccc 5eeed4886
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 14 23:48:40 2016 +0300

    Merge pull request #552 from binarin/rabbitmq-server-549
    
    Limit number of unique node names for rabbitmqctl

commit 5eeed4886c1b52f9f92158720813749b5f868325
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Jan 14 17:16:25 2016 +0300

    Limit number of unique node names for rabbitmqctl
    
    It prevents atom table overflow in a long running broker.
    
    Fixes #549

commit 6fd4eb5bcb39be7f5ac26dcc78e3a4b4df4c6fbb
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Jan 14 10:03:57 2016 +0100

    Fix rabbitMQ OCF monitor detection of running master
    
    When monitor detected the node as OCF_RUNNING_MASTER, this may be
    lost while the monitor checks in progress.
    * Rework the prev_rc by the rc_check to fix this.
    * Also add info log if detected as running master.
    * Break the monitor check loop early, if it shall be exiting to be
      restarted by pacemaker.
    * Do not recheck the master status and do not update the master score,
      if the node was already detected by monitor as OCF_RUNNING_MASTER.
      By that point, the running and healthy master shall not be checked
      against other nodes uptime as it is pointless and only takes more
      time and resources for the action monitor to finish.
    * Fail early, if monitor detected the node as OCF_RUNNING_MASTER, but
      the rabbit beam process is not running
    * For OCF_CHECK_LEVEL>20, exclude the current node from the check
      loop as we already checked it before
    
    Related Fuel bug:
    https://launchpad.net/bugs/1531838
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 7c98f51b6c52d5b819317c7b4b249641417d2bb6
Merge: 636142506 670d98664
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Jan 13 12:23:38 2016 +0100

    Merge pull request #491 from rabbitmq/rabbitmq-server-94
    
    Switch to Lager for logging

commit 670d986641cebf3db4d24c4c18b0cbc8132a9829
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 17:07:00 2015 +0000

    Use Lager to log RabbitMQ messages
    
    By default, RabbitMQ now logs messages to a single file
    ($RABBITMQ_LOGS). The $RABBITMQ_SASL_LOGS variable is unused. To
    configure how and which messages are logged, it's recommended to do it
    from rabbitmq.config, not from the environment variable.
    
    The old `log_levels` parameter is unsupported and categories are
    replaced by Lager extra sinks. If you had in your rabbitmq.config:
        {rabbit, [
            {log_levels, [{connection, info}]}
          ]}
    You can now configure Lager like this:
        {lager, [
            {extra_sinks, [
                {rabbit_connection_lager_event, [
                    {handlers, [{lager_forwarder_backend, [lager_event, info]}]}
                  ]}
              ]}
          ]}
    
    rabbitmq-build.mk from rabbitmq-common is included in the top-level
    Makefile. It sets the appropriate compiler options to enable Lager's
    lager_transform parse_transform module.
    
    rabbit_log calls are now converted by this parse_transform to direct
    calls to lager:log(). To keep backward compatibility with other plugins,
    the rabbit_log module still implements all the <level>() functions.
    Compared to the parse_transformed calls, the main difference is the
    logged message does not carry the file:line metadata.
    
    Fixes #94.

commit dbbe3d6e473fcfaa725e7aa0dda10601b63b9c27
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Tue Jan 12 14:31:45 2016 +0300

    Fix 'rabbitmqctl rotate_logs' behaviour
    
    When 'rabbitmqctl rotate_logs' is called without any parameters, it
    clears logs unconditionally. And given that this form is used in
    logrotate config files, this could result in data loss.
    
    This could be reproduced with following scenario:
    1) 'max_size' is set globally in lograte config
    2) One of two rabbitmq logs is greater than that limit
    3) Daily logrotate run was already performed today, and now we
       are calling it manually. In this case logrotate will copy only file
       that is bigger than max_size, but 'rabbitmqctl rotate_logs' will
       clear both of them - leading to data loss.

commit 636142506ccf1fb65058fe0ae8d997edcc25af65
Merge: d76f9188e 86db8bccc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 12 16:24:05 2016 +0300

    Merge branch 'stable'

commit 86db8bccc9530e40105a0969e3c0fd09c82fc93d
Merge: 1dcaad8f4 577183dee
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 12 16:14:55 2016 +0300

    Merge pull request #542 from rabbitmq/rabbitmq-server-528
    
    Make number of Ranch acceptors configurable

commit 577183deed496b46d9c491d3ef6ef5d3c313b879
Merge: ce484f2fa 1dcaad8f4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 12 14:31:56 2016 +0300

    Merge branch 'stable' into rabbitmq-server-528

commit d76f9188e1f6170ca09cace5b8593ed37757ff81
Merge: a9aa29f8f 1dcaad8f4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 12 13:26:46 2016 +0300

    Merge branch 'stable'

commit ce484f2fa970b9fe7fe542ccedbfef7564b9de40
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Jan 12 10:36:38 2016 +0100

    Make number of Ranch acceptors configurable

commit 1dcaad8f4859a04d2e6e427e9aaf4e948bdd417e
Merge: 93b9e37c3 5a3418f2f
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 12 13:25:47 2016 +0300

    Merge pull request #540 from bogdando/bug/1529897
    
    OCF: Fuel bug 1529897

commit a9aa29f8f45b4555fa17d17921cd3a1748c592da
Merge: 36f4160a9 f846b6847
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jan 11 19:09:27 2016 +0300

    Merge pull request #539 from rabbitmq/rabbitmq-server-392
    
    392: Add cluster-wide resource alarm status to `cluster_status` output

commit 36f4160a97499eeab4426fa4f81fd7b9ccf59164
Merge: ece819701 93b9e37c3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jan 11 19:04:36 2016 +0300

    Merge branch 'stable'

commit 93b9e37c3ea0cade4e30da0aa1f14fa97c82e669
Author: Joseph Yiasemides <joseph.yiasemides@erlang-solutions.com>
Date:   Wed Jan 6 18:17:09 2016 +0100

    Include alarm information in output for cluster status
    
    After this change `rabbitmqctl cluster_status` will print information
    about alarms raised across a cluster.

commit 5a3418f2f1b427dcdf2bf5f36e8caad475dc0dce
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Jan 11 14:19:27 2016 +0100

    Fix get_status, action_stop, proc_stop then beam's unresponsive
    
    * Fix get status() to catch beam state and output errors
    * Fix action_stop() to force name-based mathcing then no
    pidfile and the beam's unresponsive
    * Fix proc_stop to use name based matching if no pidfile
    found
    * Fix proc_stop to retry sending the signal when using the name
    based match as well
    
    W/o this patch, the situation is possible when:
    - beam's running and cannot process signals, but is reported "not running"
    by the get_status(), while in fact it shall be reported as generic error
    - which_applications() returned error, while its output is still
    being parsed for the "what" match, while it shall not.
    - action stop and proc_stop gives up then there is no pidfile and the beam's
    running unresponsive.
    
    The solution is to make get_status to return generic error and action
    stop to use the rabbit process name matching for killing it.
    
    Related Fuel bug:
    https://bugs.launchpad.net/fuel/+bug/1529897
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit f846b6847f04767a3c752997930fa65081b005e0
Author: Joseph Yiasemides <joseph.yiasemides@erlang-solutions.com>
Date:   Wed Jan 6 18:17:09 2016 +0100

    Include alarm information in output for cluster status
    
    After this change `rabbitmqctl cluster_status` will print information
    about alarms raised across a cluster.

commit 968623d98da33d686d20b389132946073b1b0adf
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Jan 11 13:31:08 2016 +0100

    Fix proc_kill then there is no pid found
    
    W/o this fix, the rabbit OCF cannot make
    proc_stop to try to kill the pid-less beam process
    by its name matching because the proc_kill()'s
    1st parameter cannot be passed empty.
    
    The fix is to use the "none" value then the pid-less
    process must be matched by the service_name instead.
    
    Also, fix the proc_kill to deal with Multi process
    pid files as well (there are many pids, a space separated).
    
    Related Fuel bugs:
    https://launchpad.net/bugs/1529897
    https://launchpad.net/bugs/1532723
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit ece8197016fcb9f91362efef6897aab5bf7d4908
Merge: da81d431d 7e1022d11
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jan 11 14:58:48 2016 +0300

    Merge branch 'stable'

commit 7e1022d11be94513360cc9be7c0065ca9590b996
Merge: 87e68fef8 630beb3a5
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jan 11 14:33:19 2016 +0300

    Merge pull request #533 from rabbitmq/rabbitmq-federation-7
    
    Set deleting exchange status

commit da81d431d189f938d797d516131c238ff4a3222f
Merge: 40acd8120 87e68fef8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Jan 11 14:03:36 2016 +0300

    Merge branch 'stable'

commit 87e68fef82f10cd60a01add60bf36c4751621cbc
Merge: 03fd0c2d3 b00c0576d
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jan 11 13:20:33 2016 +0300

    Merge pull request #538 from bogdando/bug/1529897
    
    Syntax and local vars usage fixes to OCF HA

commit b00c0576ddd2cc19834c744bf297f5c9ca27bb5e
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Jan 11 10:05:52 2016 +0100

    Syntax and local vars usage fixes to OCF HA
    
    Related Fuel bug:
    https://launchpad.net/bugs/1529897
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 630beb3a5cad8741ac0707219f7338133efe22a8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Jan 10 01:40:19 2016 +0300

    Clear temporary runtime exchange parameters on boot
    
    This makes sure that values that were set right before
    node failure or restart are not retained.

commit 7b864ffa829137cd2c587fbcbc0bc0155425d642
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jan 9 20:38:12 2016 +0300

    Elaborate

commit 438f16d2b8af9099c36bb2cac36621dcb932786d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jan 9 20:30:04 2016 +0300

    Ensure exchange-delete-in-progress is always cleared

commit 26b670a90e2b27e8d09fcba34a8f2e59d9a47147
Merge: 33ce3f8d9 03fd0c2d3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Jan 9 18:01:05 2016 +0300

    Merge branch 'stable' into rabbitmq-federation-7

commit 40acd8120f84473e701f4e8dd40e5acde214fb62
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 9 13:16:16 2016 +0300

    Update rabbitmq.config.example

commit f3f264de1cb56ab0f94979581bfac30a97209bf4
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 9 13:14:34 2016 +0300

    Update rabbitmq.config.example

commit 05fdb1e80808b61fde222fbaa09f3ccb5635b220
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 9 13:11:14 2016 +0300

    Mention mirroring_sync_batch_size

commit 56e5d0dd9de7285b7dfb62b7a68072c04e56e38f
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Jan 9 13:07:42 2016 +0300

    Remove server properties
    
    99.9% of users never need it

commit 33ce3f8d9caf9ac7d5048ac323526a7f1772e9b6
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Jan 8 18:53:34 2016 +0100

    Rename runtime parameter to exchange-delete-in-progress

commit cc2f0d2951a622986fa7ad6d028f29d9b8fa02d9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 23 11:54:58 2015 +0000

    Ignore duplicate down_from_ch

commit 5f9ab868ac7bc111c2d8aeafcde459844e129ebc
Merge: bcd5958a4 03fd0c2d3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 8 01:14:36 2016 +0300

    Merge branch 'stable'

commit 03fd0c2d35e82ed02c9fe615502e6b78c6ee9a1b
Merge: 0c4d9a0d8 0f77ae3f4
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jan 7 12:45:28 2016 -0800

    Merge pull request #532 from bogdando/bug/1529897
    
    Remove unneeded sleep for a graceful stop by PID

commit 0f77ae3f47fabeebdb75644e61b183daddfc3917
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Jan 7 13:51:40 2016 +0100

    Remove unneeded sleep for a graceful stop by PID
    
    The sleep in not needed according to the
    https://www.rabbitmq.com/man/rabbitmqctl.1.man.html
    "If a pid_file is specified, also waits for the process
    specified there to terminate."
    
    Related Fuel bug https://launchpad.net/bugs/1529897
    Related PR
    https://github.com/rabbitmq/rabbitmq-server/pull/523
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 203ac917ab6736d1d09b4c7a14121b309529e947
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Jan 7 11:03:27 2016 +0100

    Set deleting exchange status
    
    * Avoids race condition between declare and delete

commit bcd5958a4a46cebcf50a3450a047301d8a0fecc5
Merge: dbca59b9a 0c4d9a0d8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 6 13:36:43 2016 +0300

    Merge branch 'stable'

commit 0c4d9a0d88e15394889e69a426cf3a8fce149257
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 6 13:32:36 2016 +0300

    Didn't mean to delete this behaviour

commit dbca59b9a8460ad35a05482404e6c5675a7cc4fc
Merge: 9eb26faad 74f312a88
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 6 09:45:55 2016 +0300

    Merge branch 'stable'

commit 74f312a88ea78f4be022c030226c02b46c251b95
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 6 09:45:42 2016 +0300

    Docs

commit 2db3ca9aeb52c5d2171a67022d2e4e607dc065c8
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Jan 6 09:41:46 2016 +0300

    Docs

commit 9eb26faadc07c9e99d191750cfd0c3dfd89ba7a3
Merge: 9fc95989c ef7a7f32a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 5 18:39:21 2016 +0300

    Merge branch 'stable'

commit ef7a7f32a6b73fcac223849973a1c3b51c05b4dd
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 5 18:39:00 2016 +0300

    Essay doco for rabbit_runtime_parameters

commit 9fc95989c2f854491bb7d4c9ccb3690773d0bacf
Merge: f915858c5 87ff2128d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Jan 5 17:20:37 2016 +0300

    Merge branch 'stable'

commit 87ff2128d673f985ec6760080d9de5c3aa25e06e
Merge: 21e4b2d18 0d8bef07e
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jan 5 17:16:11 2016 +0300

    Merge pull request #529 from rabbitmq/rabbitmq-server-521
    
    Adds handling for bindings not of type 'queue'

commit 0d8bef07eda8123efffdea1b69ce79ec72e34b43
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Jan 5 10:40:47 2016 +0000

    Adds get_queue_master_per_binding/3 handle all clause, to handle
    exchange type bindings, for example.
    
    References #521

commit f915858c5f17e1ae2752d8db040edbdc0fa11791
Merge: 77f7e1171 21e4b2d18
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 1 13:10:35 2016 +0300

    Merge branch 'stable'

commit 21e4b2d1898d4a1db3e7f83891ef2d6f7000ce0a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Jan 1 12:59:15 2016 +0300

    Update (c) info

commit fe243c2e71771b208574c612b9a06b52ca1a509c
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Dec 31 12:30:04 2015 +0300

    Improve diagnostics in 'rabbitmq-server' script
    
    While errors are detected with '-e' shell option in this script,
    diagnostics messages leave a lot to be desired.
    
    E.g. when trying to write pid file to full partition, the only message
    in log is:
    
        sh: echo: I/O error
    
    Which is definitely insufficient

commit 77f7e1171749a3344a799462faf0caf2c88e0496
Merge: 9a8a2dad1 4f1483b3d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 31 13:59:41 2015 +0300

    Merge branch 'stable'

commit 4f1483b3d9bab8f996128e676f40b168eb0fee65
Merge: 852176c5c 923ca2379
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Dec 31 13:58:00 2015 +0300

    Merge pull request #525 from bogdando/bug/1530150
    
    Ensure rabbit node uptime is reset in the CIB for OCF resource

commit 923ca2379902b4ddcdabb7fd1484aeb6750a576f
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Wed Dec 30 17:25:33 2015 +0100

    Ensure rabbit node uptime is reset in the CIB for OCF resource
    
    * Add ocf_run wrappers and info log messages for CIB attribute events
    * Move "fast" CIB attribute updates before "heavy" operations like
      start/stop/wait to ensure CIB consistent even if the timeouts
      exceeded for the ops
    * Delete master and start time attributes from CIB on action_start
      to ensure the correct rabbit nodes uptime evaluation for new
      master elections for corresponding pacemaker resources
    * For post-demote notify and action_demote() delete the master
      attribute from CIB as well.
    * For post-start notify, update the start time in the CIB even when
      the node is already clustered. Otherwise it would remain running
      in cluster w/o the start time registered, which affects the new
      master elections badly.
    * fix wrong log message when joining by a node
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1530150
    https://bugs.launchpad.net/fuel/+bug/1530296
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 9a8a2dad117e8822ed7b284c752ed70966de9842
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 17:17:34 2015 +0300

    More details on rabbit.password_hashing_module

commit 985bb9a6ec6a033a5b936fba892b672130761da1
Merge: 65208827e 852176c5c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 17:15:19 2015 +0300

    Merge branch 'stable'

commit 852176c5c59f3eac402c4fb76597fe5107618315
Merge: 29af23b74 b8a554e5b
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 30 17:02:15 2015 +0300

    Merge pull request #523 from bogdando/bug/1529897
    
    Fix stop conditions for the rabbit OCF resource

commit b8a554e5b936e3e0fffc23025200dd3fc43befa6
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Wed Dec 30 12:52:05 2015 +0100

    Fix stop conditions for the rabbit OCF resource
    
    * Fix the get_status() unexpectedly reports generic error
      instead of "not running"
    * Add proc_stop and proc_kill functions
      (TODO these shall go as external common ocf heplers, eventually)
    * Rework stop_server_process()
      - make it to return SUCCESS/ERROR as expected
      - grant the "rabbitmqctl stop" a graceful termintation window and only
        then ensure the beam process termination and pidfile removal as well
      - return the actual status with get_status()
    * Rework kill_rmq_and_remove_pid()
      - use proc_stop to try to kill by pgrp with -TERM, then -KILL, or
        by the beam process name match, if there is no PID.
      - make it to returns SUCCESS/ERROR
    * Fix action_stop()
      - fail early by the stop_server_process() results without additional
        rabbitmqctl invocations in the get_status() call
      - rework hard-coded sleep 10 to use the gracefull stop windows in the
        stop_server_process() instead
      - ensure the rabbit-start-time removal from CIB before to try to stop
        the server process
      - issue the "stop: action end" log record before the actual end
    * Add comments and make logs to be more informational
    
    Related Fuel bug https://bugs.launchpad.net/fuel/+bug/1529897
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>
    Co-authored-by: Alex Schultz <aschultz@mirantis.com>

commit 65208827e7a9177bc769c24fbab360c21f82e113
Merge: 931e8cf8b 29af23b74
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 09:04:54 2015 +0300

    Merge branch 'stable'

commit 29af23b74dd159ae44471d53bec50253cc5fbcb0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 08:51:21 2015 +0300

    Wording

commit 3c0229f065b2312926b0683f0f9acd66728889ff
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 24 10:13:16 2015 +0000

    indent with emacs

commit ab194855e9358ad7f90b97bf6f1380583ee1c83f
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 15:12:39 2015 +0000

    Hint to stop_app if mnesia is running but should not

commit 6f166ebc5afed2e424e976fd594369fbee81f48c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 12:23:42 2015 +0000

    Proper error report

commit 1ba9534de152fc0bca9f9d490fdf6480dde0605b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 12:12:31 2015 +0000

    Hint to stop_app when running rabbitmqctl reset

commit 931e8cf8b4578f691c0210003147fc4a217199bb
Merge: 0fe073e9e 1c8f9352e
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 30 09:00:10 2015 +0300

    Merge pull request #510 from rabbitmq/rabbitmq-server-167
    
    Improve error message of rabbitmqctl reset when the node is running

commit 1c8f9352e34ad365bda380155eedceeb7dc7f0af
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 08:51:21 2015 +0300

    Wording

commit 0fe073e9e062f8e825d78153ea231c8788bedfc1
Merge: a72ec4f09 e0c8ceda9
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 30 07:04:02 2015 +0300

    Merge branch 'stable'

commit e0c8ceda910f2fc597d276868cab995bcb2fe202
Merge: bdc345555 747552dbd
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 30 06:59:20 2015 +0300

    Merge pull request #516 from rabbitmq/rabbitmq-server-328
    
    Adds exception handling to rabbit_vm:bytes/1

commit a72ec4f0905ac1f166792c23689532ad75b59777
Merge: 63c80f2b3 bdc345555
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Dec 28 17:51:35 2015 +0300

    Merge branch 'stable'

commit bdc34555592f9bbc8c3b0a5ae996208aa5731bbc
Author: Pierre Fenoll <pierrefenoll@gmail.com>
Date:   Mon Dec 28 11:03:57 2015 +0100

    .gitignore: make absolute paths relative

commit 63c80f2b3c542a877f250245f9d459f237cc61f7
Merge: 4109fb828 670c32998
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 28 17:21:23 2015 +0300

    Merge pull request #518 from fenollp/patch-1
    
    .gitignore: make absolute paths relative

commit 670c32998e57e1d603ecd9cdffb77d3e04e37dec
Author: Pierre Fenoll <pierrefenoll@gmail.com>
Date:   Mon Dec 28 11:03:57 2015 +0100

    .gitignore: make absolute paths relative

commit 9d7ff053cd3a5e8ccf9d3d4bf2a65860f5693c5d
Merge: cc0685002 4109fb828
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 24 13:51:55 2015 +0000

    Merge branch 'master' into rabbitmq-server-167

commit 747552dbd2a04123c2306c316b31a1d1a7dd9312
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Dec 24 10:53:50 2015 +0000

    Changes rabbit_vm:bytes/1 to return 0 on exception
    
    References #328

commit cc0685002249978f630cc586a0f8589a394364e7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 24 10:13:16 2015 +0000

    indent with emacs

commit ef111e2d22d8b8abbe905c0c3abb4e5846576e59
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Dec 24 09:52:37 2015 +0000

    Adds try-catch block and returns error on exception
    
    Fixes #328

commit 4109fb828d8faf07412d298547c9777603e15f45
Merge: 30324f811 0e2dccc01
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 24 02:45:56 2015 +0300

    Merge branch 'stable'

commit 0e2dccc019071b9e52b86fce32f752c0fa78d1d5
Merge: b2cf1238e 447e54986
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 24 00:18:14 2015 +0300

    Merge branch 'stable' into rabbitmq-server-485

commit 30324f811866ba88b8c02005a7232865108c672f
Merge: b6d63de19 447e54986
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 24 00:15:04 2015 +0300

    Merge branch 'stable'

commit 447e549860d6281b12bd9cbb2d11f04e741561aa
Author: shawnsli <lishuaihenu@gmail.com>
Date:   Wed Dec 23 21:01:32 2015 +0800

    purge may crash in lazy queue(3.6.0)

commit b6d63de19d0539ddc20221adae0161756f32e7c4
Merge: 3d478460a c6d9719bb
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Dec 23 15:09:11 2015 +0100

    Merge pull request #513 from javaforfun/lazy_purge
    
    purge may crash in lazy queue(3.6.0)

commit 5d617bac4006a2f605a263db2a1f4817fef3305b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 23 16:44:05 2015 +0300

    Sync RPM package description with Debian

commit c6d9719bb2db4ed38a340d7ecb981075b291f918
Author: shawnsli <lishuaihenu@gmail.com>
Date:   Wed Dec 23 21:01:32 2015 +0800

    purge may crash in lazy queue(3.6.0)

commit 50bdb9e7489ef98d2d6941e312fd0c529d37ec9e
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 15:12:39 2015 +0000

    Hint to stop_app if mnesia is running but should not

commit 68374c5be299e3d65a78b9e9c3fe576c9f6a9bb7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 12:23:42 2015 +0000

    Proper error report

commit c8b6841282c93db47ec812607b20e75642c8c31c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 22 12:12:31 2015 +0000

    Hint to stop_app when running rabbitmqctl reset

commit b2cf1238eea40f6a505a42d1bf10b75efcdff3bc
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Dec 22 16:17:41 2015 +0000

    Moves Erlang and OTP functions from rabbit_mnesia
    to rabbit_version.
    
    References #485

commit 3d478460a3d9a94160e89ee82b85eb15ec5102a1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 15:17:25 2015 +0100

    packaging: Always use xzcat(1) to decompress xz archive
    
    Do not rely on tar's behaviour. It was already done everywhere except in
    those three places.

commit 203fb23c10e4f0a4c9c87d0964ea3a275f57c266
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 15:15:33 2015 +0100

    packaging: tar `-n` is not portable, use --no-recursion instead

commit d70105e0ec914c6b7195de454e1132f6a9eba834
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Dec 22 13:36:22 2015 +0000

    Commit Debian and RPM change log entries

commit 515ad3a112c8b92c341fc88462ecc97e3487bd81
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 14:14:28 2015 +0100

    packaging: Deorbit macports package

commit b96d5b05e113c3ab1ae29e1a18fa5142da3746d3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 14:13:03 2015 +0100

    packaging/debian: Update list of files removed in `make clean`

commit e5d577d2815c93906f797fc09cea1a35a5be5418
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 14:04:01 2015 +0100

    Fix build: the produced archive is now compressed with xz(1)

commit 286563d4005b69ca1433b81dfda7b4ba675fb659
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 22 08:49:29 2015 +0100

    packaging/generic-unix: Produce tar.xz archive
    
    Also, files are sorted in the tar. This is now consistent with other
    produced archives.

commit 0bd1600253c4b562b81ca40d6c12153c726683ae
Merge: 41dfed366 39b5b6458
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 21 19:40:08 2015 +0300

    Merge pull request #509 from rabbitmq/rabbitmq-server-508
    
    Distribute event-exchange, recent-history-exchange and sharding

commit 39b5b6458a3b14701b5bc9ab144d6b9e9b391d78
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 21 17:22:54 2015 +0100

    Distribute event-exchange, recent-history-exchange and sharding
    
    Fixes #508.

commit 41dfed36678b6d9ce37f84ca601050c4833fcd96
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 21 17:02:49 2015 +0100

    packaging/generic-unix: Create web manpages
    
    They are not used by the generic Unix archive, but by `make release` in
    the Umbrella: they are needed by the website.

commit b984fc2ba7f77ee62d17938fc2b556f32ff503af
Merge: ab42bc257 2e55211eb
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 21 18:59:53 2015 +0300

    Merge pull request #507 from rabbitmq/rabbitmq-server-506
    
    Datetime in rabbit_diagnostics

commit 2e55211eb60b0b51fff87059dab88e82865a772a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Dec 21 14:40:58 2015 +0000

    Datetime in rabbit_diagnostics

commit ab42bc257b866f6fec7e52b3bdc0b30c43fd0ea8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 18 20:33:28 2015 +0100

    Update erlang.mk

commit e0dbf3b3cbe04aaba0998f10093748c1078d6cad
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 18 20:33:03 2015 +0100

    Sync with upstream build.config

commit f36353b704e4c3c272113095e39dad9ce73642be
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 18 19:08:06 2015 +0100

    Update rabbitmq-components.mk

commit 7f1b753669d25b82d8bc4bea9c3eeb8aa23ca6c4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 18 19:47:09 2015 +0300

    Update rabbitmq-components.mk

commit 4c1e9d2a7c50756daf73a449b2c834f2f3055373
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Fri Dec 18 10:53:11 2015 +0000

    Tell travis to wait for long-running tests.

commit cc0f7ce7f12bab62a69d9b182c18ac71bb3a5e4a
Merge: 8fddefcf6 b8145384b
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Dec 17 16:34:02 2015 +0300

    Merge pull request #503 from rabbitmq/rabbitmq-server-368
    
    GM: Ignore 'DOWN' when the ring is going down

commit b8145384b262fcd788b2a5c3c844a713a5464f70
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Dec 17 12:11:52 2015 +0100

    GM: Ignore 'DOWN' when the ring is going down
    
    This is a follow-up commit to ed276656. This fixes the following crash:
    
    =ERROR REPORT==== 18-Oct-2015::00:51:30 ===
    ** Generic server <0.966.0> terminating
    ** Last message in was {'DOWN',#Ref<0.0.3.4250>,process,<21148.716.0>,
                                   shutdown}
    ** When Server state == {state,
                                ...
                                {true,{shutdown,ring_shutdown}}}
    ** Reason for termination ==
    ** {function_clause,[{orddict,fetch,
                                  [{1,<0.966.0>},[]],
                                  [{file,"orddict.erl"},{line,80}]},
                         {gm,check_neighbours,1,[{file,"src/gm.erl"},{line,1243}]},
    
    Submitted by Alvaro Videla (@videlalvaro).
    Fixes #368.

commit 8fddefcf6e6131211d382b66f6bed8229c6b4ea2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 16 00:59:08 2015 +0300

    Trigger a new Travis build

commit abe032ae02acdf9c3066dc4f211660fb12505406
Merge: 0408ddcc0 61a5fd395
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Dec 15 15:15:45 2015 +0300

    Merge branch 'stable'

commit 61a5fd3950a5b34f596c48214c9299c7f4d4d582
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Dec 15 10:40:56 2015 +0000

    Commit Debian and RPM release notes

commit 0408ddcc087021c7ada45a80f4530281af470dcc
Merge: 6ef38905f 079bfdcb4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Dec 15 01:42:02 2015 +0300

    Merge branch 'rabbitmq-server-484'

commit 6ef38905f1ac6dd5fd81b2a4db3bff0fca95c547
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Dec 14 10:34:00 2015 +0000

    HIPE compilation moved to rabbit_hipe module

commit 2512ce8b7559937d93007580fcbfa4965e6ecadd
Merge: acada7b16 2d536f4f6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Dec 15 01:08:39 2015 +0300

    Merge branch 'stable'

commit 2d536f4f688f656adcea63e7706021da05190f60
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Dec 15 00:58:10 2015 +0300

    Backport #496 to 3.5.x

commit acada7b166f6ccdda80a9a73c33162c43fddf80b
Merge: de9f60af0 869640358
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 14 23:47:52 2015 +0300

    Merge pull request #496 from rabbitmq/rabbitmq-server-255
    
    Ignore unknown channel acks in queue

commit 869640358a3e269704c0a6338f2014d9265a72c3
Merge: d90a5ead3 de9f60af0
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Dec 14 20:06:53 2015 +0300

    Merge branch 'master' into rabbitmq-server-255

commit de9f60af016198973ed163b1586b9838eb194228
Merge: 7cf0e51ed 46b54ff9e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 17:34:14 2015 +0100

    Merge branch 'stable'

commit 46b54ff9efb00796def74e3a423b81a2d90dd151
Merge: ef0a5c333 fca26b065
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 14 19:21:24 2015 +0300

    Merge pull request #495 from rabbitmq/rabbitmq-server-494
    
    Install set_rabbitmq_policy.sh as an example script

commit d90a5ead3dd848af51e2673e81c14bbb96b37c2b
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Dec 14 16:01:24 2015 +0000

    Ignore unknown channel acks in queue

commit fca26b065cc5b1440e2ec40299c8b2a1e53afb3a
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Dec 14 16:50:10 2015 +0100

    Install set_rabbitmq_policy.sh as an example script
    
    Otherwise, it will overwrite any local modifications.
    
    Fixes #494.

commit 7cf0e51eda9cf40b3f01dc1649ce04471a9b37ea
Merge: f1caf10cb ef0a5c333
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 16:10:45 2015 +0100

    Merge branch 'stable'

commit 079bfdcb43e0730d9d9d1f13656ee88ceb1f2fc3
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Mon Dec 14 10:34:00 2015 +0000

    HIPE compilation moved to rabbit_hipe module

commit f1caf10cb8af79b2620d9afdfd48f97591f0b75e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 12:40:03 2015 +0100

    Add Travis CI configuration

commit c939cf5c4f45fce678f111f0079a237f4669e4ad
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 12:04:21 2015 +0100

    rabbitmq-server.bat: Honor $RABBITMQ_ALLOW_INPUT

commit c8aa445577c8aa3b912649c84bf431325b13e197
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 11:54:38 2015 +0100

    Disable erl_crash.dump in rabbitmqctl and rabbitmq-plugins
    
    Crash dumps are disabled by default only: if the user set
    $ERL_CRASH_DUMP_SECONDS, his setting is honored.

commit 592372751bd7245881ca51501071db502cfa08f0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 14 10:39:30 2015 +0100

    rabbit_mnesia.erl: Remove trailing space in logged message

commit c275c0aa589060955b19ecf891850762898c9557
Merge: c7e03fd9c 05162cba7
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Dec 13 04:27:03 2015 +0300

    Merge pull request #489 from rabbitmq/rabbitmq-server-488
    
    Handle queue mode statistic emitted by priority queues

commit 05162cba78c3999d9be5ed833f24e1e34a51fda1
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Dec 13 02:49:59 2015 +0300

    Handle queue mode values

commit 417c14b545c77d4c1d2055d8e21e7ab6c1738843
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Dec 13 00:28:15 2015 +0300

    Handle a case when newly created (priority) queue may emit some of its stats as default
    
    Fixes #488.

commit c7e03fd9c17be97d9f5db31e240a4e5457fae717
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Dec 12 15:15:59 2015 +0300

    Ignore tracing tool files

commit 01e3ee01a133c42882ad3916932f34d9fa1f3ca2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 11 01:20:23 2015 +0300

    Be more precise

commit a10485a81a1a6fb598b3f691081497f94f4fca4e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 11 00:49:52 2015 +0300

    Docs

commit d4e0f70ca541d3e0535376ef66014a81f385db1f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 11 00:36:21 2015 +0300

    Docs

commit ef0a5c333524851c001bd401f3e624a726e2db81
Merge: 06389b4f4 550241932
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Dec 10 20:49:38 2015 +0300

    Merge pull request #482 from bogdando/related_PR480
    
    Fix the set_rabbitmq_policy.sh usage

commit ec446a82725c734a9fce3981b26a139140787210
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 10 17:12:21 2015 +0000

    uuid dependency

commit 550241932b1fda01ef2909e56c818d97ceec0452
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Dec 10 13:32:21 2015 +0100

    Fix the set_rabbitmq_policy.sh usage
    
    * Call it only if exists
    * Address packaging:
      - for stable branch, use packaging/common/ to contain the
        set_rabbitmq_policy.sh and include it to the debian rules
        and rpm spec
      NOTE: for master branch landing please update as appropriate,
      as it should be using ./scripts source!
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 38f0b7ad9471c6dac2e3e036adc7cb9fdf003509
Merge: 497ad281a 99c68002b
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 9 19:07:58 2015 +0300

    Merge pull request #481 from rabbitmq/rabbitmq-server-479
    
    Fall back to code:is_module_native/1 on older OTP releases

commit 99c68002bfd87e5ee1a08dee0c777832f39f95af
Merge: 81834de91 497ad281a
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 9 08:04:29 2015 -0800

    Merge branch 'master' into rabbitmq-server-479

commit 81834de912bce65f5a3cd9a77b9e137a8cef0570
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 9 08:03:15 2015 -0800

    A way to detect if a module is HiPE-compiled that's compatible with R16B03

commit 497ad281afc4af593e5bfacf53100e3da6cb1c76
Merge: b264ef744 06389b4f4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Dec 9 18:58:34 2015 +0300

    Merge branch 'stable'

commit 06389b4f4a33cb94464d7d72a23ac848c6809082
Merge: 1be1da575 7d3055a50
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Dec 9 18:51:29 2015 +0300

    Merge pull request #480 from dmitrymex/stable
    
    Allow users to define poliies and parameters in OCF script for HA

commit 7d3055a5052e073c2a7beda3b38b717715f21f10
Author: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
Date:   Wed Dec 9 17:02:21 2015 +0300

    Allow users to define poliies and parameters in OCF script for HA
    
    By mistake OpenStack policies were copied into the initial version of
    the script. The policies are removed by this change.
    
    Instead users are provided with ability to set their own policies in
    a new set_rabbitmq_policy.sh file. Also now users can extend
    parameters list with their own ones. For now extended parameters can
    be used only in the policy file, but later new places to hook into
    could appear.

commit b264ef744d3d26ea4b2bf16fdab0cbb46f00b783
Merge: 40ce3d7f9 bf6e9d676
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Dec 8 23:50:09 2015 +0300

    Merge pull request #477 from rabbitmq/rabbitmq-server-169
    
    Report backup directory if previous update is failed

commit bf6e9d67605cc95b33c99c910b9ebd2310e42c36
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Dec 8 23:49:06 2015 +0300

    Wording

commit d8ab7395d07f8b9d948db3928d9f79519e3ca831
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Tue Dec 8 14:06:52 2015 +0000

    Report backup directory if previous update is failed

commit 40ce3d7f9e266e5e1ad63db1d8902b1bb7da6eed
Merge: bbbd8f345 1be1da575
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Dec 7 21:04:48 2015 +0300

    Merge branch 'stable'

commit 1be1da575bfdcd01d8c674b7c359f807f1e3e723
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Dec 4 16:40:59 2015 +0300

    Back port https://github.com/rabbitmq/rabbitmq-common/pull/34

commit bbbd8f345ff3bf8912b9249087c9c20648c42309
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Dec 7 16:06:51 2015 +0100

    make source-dist: Fix path to erlang.mk in rebar-based dependencies
    
    When rebar is used to build a dependency, a Makefile including erlang.mk
    is automatically generated. This Makefile finds erlang.mk in the project
    which depends on this rebar-based component.
    
    For instance, mochiweb could find erlang.mk in
    rabbitmq_auth_backend_http. This breaks the build from a source
    distribution if a project is not distributed (ie.
    rabbitmq_auth_backend_http in this example).

commit 3c2136053a7f704b15cb2b252384488b638a75b4
Merge: 9bacf06c3 e75061fc4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Dec 7 14:53:08 2015 +0300

    Merge branch 'stable'

commit e75061fc4426f3a9e07938d2bfb66a95dd371e0c
Merge: 169a325a6 85bbed9fa
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Dec 7 14:52:22 2015 +0300

    Merge pull request #476 from rabbitmq/rabbitmq-server-470
    
    Makes 'CTL forget_cluster_node' execute net_adm:ping/1 whilst in distributed mode

commit 85bbed9fa4d47adb5c523f6e3f130d54e435d1b9
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Sat Dec 5 12:19:27 2015 +0000

    Makes net_adm:ping/1 be executed whilst in distributed mode,
    before net_kernel:stop/1. Otherwise it would always fail
    to ping the node.
    
    References #470

commit 9bacf06c3ade074fe4ae1149236f94ad61dc667f
Merge: e2f5701d9 b2ca6fdf2
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Dec 5 09:16:02 2015 +0300

    Merge pull request #469 from rabbitmq/rabbitmq-server-461
    
    Add command to change disk_free_limit to rabbitmqctl

commit b2ca6fdf23f49078e8ddcfab189cf1d8ac2fead7
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Dec 5 09:15:44 2015 +0300

    Wording

commit e2f5701d948d17f5c3bbebfc0e4d6b748eec99e8
Merge: f0b636e81 49016b188
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 4 20:00:31 2015 +0300

    Merge pull request #475 from rabbitmq/rabbitmq-server-448
    
    Change capture value spec in regex to support older stdlib

commit 49016b18833da5fb181c5427d085be9778d983cc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 19:10:31 2015 +0300

    Compile

commit 37b9e9b9ca2f38fd0c95cd60ccd956b106c3e6a9
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 14:05:23 2015 +0000

    Wrong order of matches

commit e02f30d26bf1074ad109210e7c577eb7088ffe35
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 13:33:59 2015 +0000

    Change capture value spec in regex to support older stdlib

commit f0b636e81e022248c4328add21fa668e850f7a9e
Merge: 66b6cce17 169a325a6
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:43:41 2015 +0300

    Merge branch 'stable'

commit 169a325a66c19d8c92faadfd78cee3a5aac39bde
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:30:17 2015 +0300

    drop the quotes

commit 116dc4eb4db1fa513fade80dc9d86526f5851540
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:29:31 2015 +0300

    copy

commit ca1922d2108d60de7eca49bc93b92a478e7d39dc
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:28:10 2015 +0300

    Re-indent with Emacs

commit 8a172f1d565a9e4c9dbad796c56f2e8fd901f0ad
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:27:56 2015 +0300

    copywriting

commit 1e4dd9b374eccade4791fdfb2e9b60b052c02b8f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:27:09 2015 +0300

    Don't log anything for non-virgin nodes

commit 327fe44183b1a92f050e2d8166adeaae07d0c0a7
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 13:06:09 2015 +0000

    Log on startup if starting virgin node, or existing database

commit 66b6cce170fe04c7c02fc1c3df76c8d6c68e3a92
Merge: a3b97c247 d970b1212
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 4 17:41:14 2015 +0300

    Merge pull request #473 from rabbitmq/rabbitmq-server-168
    
    Log on startup if starting virgin node, or existing database

commit d970b12124fd3b577c38b418b0d135a075977240
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:30:17 2015 +0300

    drop the quotes

commit 738a578f5e7ec26ac52b309da1e418c184654139
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:29:31 2015 +0300

    copy

commit 3a09b107eed9da65b5f527de5be998774e26628b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:28:10 2015 +0300

    Re-indent with Emacs

commit e1b7229a88cfaaa391ab111d26786a62976932d1
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:27:56 2015 +0300

    copywriting

commit 5c249c736cd6a6a497c0102ab419dfe2cd3830c4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 17:27:09 2015 +0300

    Don't log anything for non-virgin nodes

commit a3b97c2478041471f431d5a1b8304b9d4ab73210
Merge: b191f452a 9be99b9df
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 4 16:50:40 2015 +0300

    Merge pull request #472 from rabbitmq/rabbitmq-server-20
    
    Added unsigned field types

commit 0a168762ef2e95d110f1335781eaa52a7ff6f133
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 13:06:09 2015 +0000

    Log on startup if starting virgin node, or existing database

commit 9be99b9dfbf612f32e107dca18993cc502c3dd7d
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Fri Dec 4 09:58:33 2015 +0000

    Added unsigned field types

commit a3ae71048dbcb128006d648351a5d02531482706
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 3 18:56:22 2015 +0000

    rpc_call arguments

commit 7c86a003972522e5512252557516b2ee21db3be4
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 3 16:45:58 2015 +0000

    Syntax errors, wrong variable name

commit 5a99f1fab3a0b343b25294e9858193e4cd77215c
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 3 16:32:36 2015 +0000

    Added rabbitmqctl command to change disk_free_limit

commit b191f452afaf832d5093077f463df82c9f522f20
Merge: 3c6425ff6 6b61f74ea
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Dec 4 07:28:02 2015 +0300

    Merge branch 'stable'

commit 6b61f74ea78a0dcd99bda2fa6846d3d19824baad
Merge: 7b28e920f c6321690d
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Dec 4 07:27:29 2015 +0300

    Merge pull request #466 from rabbitmq/rabbitmq-server-465
    
    rabbit_mirror_queue_coordinator: Ensure GM exited before terminating

commit 7b28e920ff2c72feeb56e699dbdb45e54e758aa0
Merge: d5f73f7ea e56bec647
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Dec 3 18:54:23 2015 +0100

    Merge pull request #468 from rabbitmq/rabbitmq-server-464
    
    Make wait command wait for start_rabbitmq_server command

commit e56bec64777c277833552303caa2d0c09b702831
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Thu Dec 3 15:45:21 2015 +0000

    Make wait command wait for start_rabbitmq_server command

commit c6321690ddb1e89edd38744fc653bee995d816ec
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Dec 3 16:44:38 2015 +0100

    rabbit_mirror_queue_coordinator: Ensure GM exited before terminating
    
    If the coordinator exits before the GM informed all other GMs (and
    therefore all slaves) about the termination of the queue, another slave
    could be promoted as a master in between. This causes the old master's
    GM to wait forever than other GMs exit.
    
    Fixes #465.

commit 3c6425ff65229c4c0241358cde5629b4a5de364b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Dec 3 15:38:47 2015 +0100

    Update rabbitmq-components.mk

commit 6e486a1e713f5a227ec7bfca2389cc81c63eddb9
Merge: 92a3cd890 a9f7fef06
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Dec 3 15:09:54 2015 +0300

    Merge pull request #462 from rabbitmq/rabbitmq-server-448
    
    Support setting vm_memory_high_watermark and disk_free_limit in units

commit a9f7fef06380e7c29bb8d5d64c706be16732b553
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 3 14:39:07 2015 +0300

    Cosmetics

commit 3f238fbaafbab5989ea6bf4a40d84cec26959545
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 3 11:39:12 2015 +0300

    Use MiB as an example
    
    That's what management plugin uses

commit 6fa6a071c9a2eb722b36a5abb559c4f7187b524c
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 3 11:31:02 2015 +0300

    Convert match to integer, support more suffix values
    
    Sadly most users don't read the docs so supporting
    more permutations is more than a nice-to-have.

commit d6365c9342002283c30e542cc9e9b6f6e54ea8cf
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Dec 3 11:02:16 2015 +0300

    Re-indent with Emacs

commit 829890be2a664a00205a3cbf04cdf00e18b022a0
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 2 17:25:03 2015 +0000

    Moved parse function to separate module and specific parses to monitor modules

commit 38d05e8ec5404d15f2d613fda272c1a98e6ac356
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 2 16:02:55 2015 +0000

    syntax errors

commit 927be5b2d218d246c1f2c08ca627a925c9a94a7a
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 2 15:58:20 2015 +0000

    More logging

commit 99d2e486179137d2b4e51df76beedad73032bb36
Author: Daniil Fedotov <dfedotov@pivotal.io>
Date:   Wed Dec 2 14:59:27 2015 +0000

    Support setting vm_memory_high_watermark and disk_free_limit in memory units

commit 92a3cd890fd4f5b506e496f429d90b2048bb5c7a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 1 18:36:20 2015 +0100

    Update rabbitmq-components.mk

commit e932fc7e71855eae996ff698ba64266d92020fc8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 1 16:17:49 2015 +0100

    Load rabbitmq-tools.mk

commit d9979d76e1350c5e66100c5e9e8bdc89c3d55563
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 1 16:17:17 2015 +0100

    Update rabbitmq-components.mk

commit 30355b38894732a9a55b0e5ede83728ae914fecf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 1 10:32:50 2015 +0100

    make source-dist: Exclude more files
    
    erlang.mk's *.d and some generated files are still distributed if the
    projects were built. Maybe we should run `make clean` before
    distributing a project.

commit 3d1b61d4e2040d070716d27bef7ca230f1a538c9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 1 10:31:39 2015 +0100

    Distributed deps: Move from a blacklist to a whitelist
    
    It will be easier to add more projects to the Umbrella: we won't have to
    remember to blacklist projects which are not ready to be distributed
    with a release.

commit 6b35a0478da700a5b94b92dd29c417712fc34066
Merge: 13f8c6f64 840e23d9e
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 30 17:10:52 2015 +0300

    Merge pull request #458 from rabbitmq/rabbitmq-server-457
    
    HiPE: Compile modules when RabbitMQ is started on an existing node

commit 840e23d9eab4394938546cbdbbb9f28b9de1d009
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 30 12:38:47 2015 +0100

    HiPE: Compile modules when RabbitMQ is started on an existing node
    
    Now, maybe_hipe_compile/0 is always called, no matter if RabbitMQ is
    started during node boot or on an already running node. To avoid
    compiling modules several times, we check if they are already natively
    compiled and skip those where it's true.
    
    Fixes #457.

commit 13f8c6f64c31e1f15c185dcb53fff200ccd4af18
Merge: d05f0f258 b51f678ce
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 30 11:47:14 2015 +0100

    Merge branch 'rabbitmq-server-455'

commit b51f678cefbb43e8bc521a83e9830e4cb845a698
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 30 10:54:50 2015 +0100

    Fix HiPE compilation during startup
    
    Now that several modules were moved to rabbitmq-common, they are stored
    in an EZ archive and do not exist as simple files on disk. hipe:c/1
    expects the file to exist. So now, we get the code from
    code:get_object_code/1 and pass it to hipe:compile/4.
    
    Fixes #455.

commit d05f0f2581f39c1b88c469b1c48a6b2ec4d9cc96
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 30 09:10:09 2015 +0100

    Update rabbitmq-components.mk

commit 8b9574fcd517cde55be9ba670a99da433483430f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Nov 27 18:57:19 2015 +0300

    This comment is no longer relevant

commit e94ec88efd3fe8f3a8e472474ad68612e88e0437
Merge: a1b96ae70 d5f73f7ea
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 26 22:42:55 2015 +0300

    Merge branch 'stable'

commit d5f73f7eab6c44331d7922e9646bfcb0f01d99ed
Merge: d173fd774 db4d7e8b0
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Nov 26 19:56:22 2015 +0100

    Merge pull request #452 from gigablah/rabbitmq-server-451
    
    Fix RABBITMQ_CTL_ERL_ARGS variable in rabbitmq-plugins

commit a1b96ae70450e44cac4c145a04f17294a1030b5a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 26 18:12:14 2015 +0100

    make tests: Fix typo in how $(TARGETS_IN_RABBITMQ_TEST) is constructed

commit 1005f77eb97ac60c1bf410b912321f9a39bd488a
Merge: 63359c888 150186c5e
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 26 16:33:11 2015 +0300

    Merge pull request #454 from rabbitmq/rabbitmq-server-453
    
    Cleanup TCP options in example config file

commit 150186c5ef769b4ad1beddb068fc23cd9885ef67
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Thu Nov 26 14:01:02 2015 +0100

    Cleanup TCP options in example config file

commit db4d7e8b0b0aa6d8e20fe750d578743cb73d96a7
Author: Chris Heng <bigblah@gmail.com>
Date:   Thu Nov 26 16:33:53 2015 +0800

    Fix RABBITMQ_CTL_ERL_ARGS variable in rabbitmq-plugins

commit 63359c888d18f0b102600fb45125d1b243e65042
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 26 08:54:10 2015 +0100

    Update rabbitmq-components.mk

commit 79137862d358bcd88b66995529b44125065ea09b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 26 08:41:22 2015 +0100

    Update rabbitmq-components.mk

commit de0d78f5c57ac9f22b32888bff7d9f643c392ed9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 18:40:12 2015 +0100

    make *-in-rabbitmq_test: Depend on test-build and TEST_DEPS list

commit b8395ae5cd7d9103b43fe0c0e278123617b3fce7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 17:19:49 2015 +0100

    packaging/standalone: Use plain Bourne shell in the patched erl(1) script
    
    "[[ ... ]]" is a Bash extension.

commit dfcde198635dfcc49db6eca5dfbd1f5a8480b767
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 17:18:56 2015 +0100

    packaging/standalone: Take broker dependencies into account
    
    While here, use the new rabbit_plugins:list/2 API to remove the
    hard-coded list of broker direct dependencies.

commit f40539ea26c043717a7555be055fc0dc9e88d310
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 17:15:34 2015 +0100

    Add rabbit_plugins:list/2
    
    It takes a boolean() as the second argument. It allows to choose if
    broker dependencies such as rabbit_common or ranch should be part of the
    returned list.

commit e92b351f9aab96cc39dd1e5a087a2b9cb889c6d4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 10:35:45 2015 +0100

    Update erlang.mk

commit 2c8e4313f79bce1adcad3b39ef0e6751d51199d2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 10:35:22 2015 +0100

    Update rabbitmq-components.mk

commit 93f0b3effc38688ffbbe4a92255783ee8eac8428
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 25 10:33:34 2015 +0100

    make tests: Run tests in rabbitmq_test as well

commit 6f70dcbe05dbba35f7d950674d293a4c7d867d44
Merge: 8b5a89209 d173fd774
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Nov 24 21:54:25 2015 +0300

    Merge branch 'stable'
    
    Conflicts:
            test/src/rabbit_tests.erl

commit d173fd774a28490eb5e4a66a588d92c0c95540fe
Merge: 5d45ac766 e07be9a0f
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 24 21:53:05 2015 +0300

    Merge pull request #450 from rabbitmq/rabbitmq-server-447
    
    Switch absolute memory watermark values to be in bytes

commit e07be9a0f52a1c09f6928cb06c27c47f1f3af2bf
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Nov 24 18:12:53 2015 +0300

    Switch absolute memory watermark values to be in bytes
    
    Fixes #407, references #207, #378, #448.

commit 8b5a89209f1b01c7d7a650eadee91746443314b1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 24 10:56:51 2015 +0100

    Put `*_usage.erl` dependencies and recipe in a single rule
    
    This ensures `$<` is the dependency we want, ie. the XML source file.

commit 87479ab442124833105f2a5d1bc373c250a5c3f5
Merge: 056fa2e2c 5d45ac766
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 23 21:08:54 2015 +0300

    Merge branch 'stable'
    
     Conflicts:
            scripts/rabbitmq-env.bat

commit 5d45ac7664f82261d9479551e0affe657ede1977
Merge: c42d5e571 5d6a59b71
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 23 20:43:14 2015 +0300

    Merge pull request #444 from rabbitmq/rabbitmq-server-433
    
    Fix issue 433

commit 5d6a59b71816f5a2b12d6f41d114070b9f82efdf
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Mon Nov 23 16:54:35 2015 +0100

    fix issue 433

commit 056fa2e2cd0dbcae5140a75eaf8a490b92daa448
Merge: 3c1588167 c42d5e571
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 23 17:36:21 2015 +0300

    Merge branch 'stable'
    
     Conflicts:
            src/credit_flow.erl
            src/gm.erl
            src/mirrored_supervisor.erl

commit c42d5e571e95bf96b5933bc770ec5331dee2542f
Merge: 543e53c5e bd31f797a
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 23 16:28:38 2015 +0300

    Merge pull request #442 from rabbitmq/rabbitmq-server-441
    
    fixes various dialyzer warnings

commit 3c1588167e5cf4ceea5c2b4c4e47fa50e6998541
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 23 10:48:57 2015 +0100

    Applications being required by RabbitMQ can't be plugins
    
    This replaces the hard-coded "rabbit_common", now that "ranch" is also a
    required application.
    
    The goal is the same: we don't want to list requirements as plugins.
    Otherwise, the user could thnk he can disable them.

commit a5bd8bd35f72d504ba331648c109a7281d1586aa
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 23 10:48:32 2015 +0100

    rabbit.app: rabbit_common and ranch are required by RabbitMQ

commit db28a261c7a54642a177f558507e10294106fca5
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Nov 22 21:38:27 2015 +0300

    Handle cases where Ranch wasn't yet started
    
    Fixes #443.

commit a524f6f0aa95c1a3692dae11de9624db1fd36084
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Nov 22 21:24:13 2015 +0300

    Ignore *.plt files

commit af67b4714e2a318cd0afb5a4d81505523815f199
Merge: ebdf6d5d2 543e53c5e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sun Nov 22 21:22:39 2015 +0300

    Merge branch 'stable'
    
    Conflicts:
      src/file_handle_cache.erl

commit 543e53c5e6519064455970f6d767dcfc1dd9e39b
Merge: f61c0fca3 b5388a1f8
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Nov 22 20:54:30 2015 +0300

    Merge pull request #440 from rabbitmq/rabbitmq-server-438
    
    addresses dialyzer warnings

commit ebdf6d5d2c0a82f28acb9a94b1d59ad86b08302f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 18:55:44 2015 +0100

    packaging/windows-exe: Use ExecDos plugin to run batch files
    
    Thanks to this plugin, batch files output is logged to the detailed
    view (ie. behind the "Show details" button). This is way more helpful
    than the cmd.exe windows which comes and go quickly.
    
    During unattended install and uninstall (/S), this is really silent
    now: no cmd.exe windows popping.
    
    ExecDos.dll comes from the x86-ansi directory in the ExecDos
    distribution.

commit bd31f797a1777fcbef2a16bb08ef52724422ec2c
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Nov 20 16:40:15 2015 +0100

    fixes various dialyzer warnings

commit 86b8dd3849d63fd7a6d08794f9be8fc5de72040b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 16:21:21 2015 +0100

    packaging/windows-exe: Fix quoting of uninstall.exe

commit 99788269e7905fd70beeec2a2153fd64ae6cc846
Merge: 4dd361c46 a3687fb81
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 15:24:12 2015 +0100

    Merge branch 'rabbitmq-server-264'

commit a3687fb814d3d2f9774bb3bbbedf480e1db0b92e
Author: Ryan Zink <ryanzink@gmail.com>
Date:   Tue Oct 20 09:53:02 2015 -0500

    packaging/windows-exe: Allow silent install
    
    While here, do not remove `ERLANG_HOME` on a reinstall/upgrade process.
    
    Fixes #264.

commit 4dd361c460d3ac913ca71eefeeafe3475b43a161
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 14:57:59 2015 +0100

    packaging/windows-exe: Wait for uninstall to finish before installing

commit b5388a1f828a8eb36897b7e19e5f4db8e0198c24
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Nov 20 14:27:19 2015 +0100

    addresses dialyzer warnings

commit cb220addb1af1530df6d983d619d149fe279a8d9
Merge: 3522f9c53 5bf4b9926
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Nov 20 15:56:23 2015 +0300

    Merge pull request #439 from rabbitmq/rabbitmq-server-435
    
    Fix memory reporting for connections

commit 5bf4b992648c8ae583aad1d6c4fcfc1f5eb6ba3f
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Fri Nov 20 13:37:48 2015 +0100

    Fix memory reporting for connections
    
    Before, there was two parts of the supervision tree: one for the
    listener/acceptor, and one for connections. The latter was one
    big supervisor handling all connections, regardless of the
    listener they were coming from.
    
    With Ranch, each listener has its own branch in the supervision
    tree. Inside it are then two more branches, one for the
    acceptors and one for the connections.
    
    The fix simply adds all Ranch connection supervisors to the list
    by fetching them from the ranch_server ETS table.

commit 3522f9c5310f97c12c7acc2679578ec7a088abf3
Merge: f6b36919b f61c0fca3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Nov 20 15:21:48 2015 +0300

    Merge branch 'stable'

commit f61c0fca34adcc01d0dfc5e2944f74b0a555e01e
Merge: 1eb029e4c 41eec8587
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Nov 20 15:21:22 2015 +0300

    Merge pull request #437 from rabbitmq/rabbitmq-server-436
    
    fixes clear_read_cache get_env handling

commit f6b36919ba08d0038e78ac03eb873f85b40527fe
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 13:19:03 2015 +0100

    Makefile: Fix how we modify an autopatched erlang.mk
    
    This fixes package builds when eg. ranch was pulled from a
    sub-repository instead of from the Umbrella.

commit 41eec8587d75993c1113da74efae726547a7ae26
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Nov 20 13:13:09 2015 +0100

    fixes clear_read_cache get_env handling

commit b44626cae3be4635b0147d8a8f8101d5a77497fe
Merge: 7c99d9928 1eb029e4c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 12:00:15 2015 +0100

    Merge branch 'stable'

commit 7c99d99281d29e8836d038e19bf198fc25396e0e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 10:52:14 2015 +0100

    Makefile: Required Ranch version was moved to rabbitmq-components.mk

commit 392f6a8b150f0fc3cec6b7414525a04d1a7b9d15
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 20 10:52:04 2015 +0100

    Update rabbitmq-components.mk

commit 1eb029e4c62cbe88dab7465c5abf085b7ca202eb
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Nov 20 10:31:48 2015 +0100

    Use erlang:min/2, not min/2 which is not available in Erlang R13B03

commit 640ad01f7fd48e58e6c6ba7f2f262f3b6b18bea6
Merge: 4a0b548d7 c784148b9
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 19 20:51:19 2015 +0300

    Merge pull request #430 from rabbitmq/rabbitmq-server-429
    
    Refactors AckTags handling for mirror_queue_sync

commit c784148b98efc119424ca20541d454540cef5552
Merge: adba72286 c47326433
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 19 20:00:46 2015 +0300

    Merge branch 'master' into rabbitmq-server-429

commit 4a0b548d7e969bd9ff7f28d02e340894daef7e06
Merge: c47326433 b232b1421
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 19 19:59:28 2015 +0300

    Merge pull request #432 from rabbitmq/rabbitmq-server-428
    
    Discards rabbit_ctl_misc and updates its references

commit c473264336b4ad8d9f7f6e013b577c26137f8d70
Merge: 1676d53ab 0cc8abef4
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 19 19:55:29 2015 +0300

    Merge branch 'stable'
    
    Conflicts:
      src/pmon.erl

commit 0cc8abef453086c58be7c6b16f1ae6c6e4d16749
Merge: 4d0c33031 9673dbf0c
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 19 19:54:31 2015 +0300

    Merge pull request #431 from binarin/rabbitmq-common-pmon-contract-breach
    
    Make pmon:demonitor/2 respect its contract

commit 1676d53aba201590665124973178105d31ee6b65
Merge: 7c9f04547 ed42f6c4d
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Nov 19 19:37:12 2015 +0300

    Merge pull request #414 from rabbitmq/rabbitmq-server-260
    
    Use Ranch for TCP acceptor pool

commit 9673dbf0c4463aafc017d888eecad0e441cbdbc4
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Thu Nov 19 16:32:23 2015 +0300

    Make pmon:demonitor/2 respect its contract
    
    Spec states that demonitor/2 should always return #state{}, but it
    wasn't the case when pid wasn't found in #state.dict. This made API
    unsafe to use, as it could lead to some other process storing incorrect
    data as a pmon state.

commit ed42f6c4d1d028b8055868f5a2543264e5a3b0b3
Merge: 2e6d27cf4 7c9f04547
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 19 16:42:17 2015 +0300

    Merge branch 'master' into rabbitmq-server-260

commit 7c9f0454700d4748ff53e4e1097d0aa600d997aa
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 19 14:31:30 2015 +0100

    Update erlang.mk

commit b232b1421a8cc93433af73c43f975fb5f45d7e98
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 19 12:26:09 2015 +0000

    rabbit_ctl_misc => rabbit_control_misc
    
    References #428

commit 37f22e8963cb8d27645f426d77f04cdb8b532b5d
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 19 12:24:34 2015 +0000

    Discards 'rabbit_ctl_misc.erl'
    
    References #428

commit 2e6d27cf4e6e8eceb4cd8004a31bd625084fc50a
Merge: 56666e5b9 843815896
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Nov 19 14:11:47 2015 +0300

    Merge branch 'master' into rabbitmq-server-260

commit adba722864340e520b30a4d02e7cfccd4ec9e459
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Nov 19 11:18:10 2015 +0100

    removes unused export

commit e68a94e720cc2862fe5b572800cbdef135bcafcd
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Nov 19 11:16:36 2015 +0100

    adds missing state param

commit 6fcfd70d7e70134fa007a448240d10dbfda8c344
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 18 20:06:40 2015 +0100

    refactor handling of acks after batch_publish_delivered

commit 8438158962429fa8d0ca8dacabffa31ba7297cb4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 18 19:14:16 2015 +0100

    Update erlang.mk

commit 4435fe411f0e4cb5f6dc8fd5f74fbe23c62e565d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 18 17:39:18 2015 +0100

    Update erlang.mk

commit 56666e5b9843d341fb27f3b53b06a47507d65dbd
Merge: 93f17772a 4b09cda42
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Nov 18 16:03:05 2015 +0300

    Merge branch 'master' into rabbitmq-server-260

commit 4b09cda42c32dd21a6880fdc52cd9da663c77432
Merge: 52ce9fa48 8928a29b4
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Nov 18 15:49:27 2015 +0300

    Merge pull request #377 from rabbitmq/rabbitmq-server-351
    
    Implements Lazy Queues

commit 93f17772a0767194c08129956ce52399d56a78a1
Author: Loïc Hoguin <essen@ninenines.eu>
Date:   Tue Nov 10 11:08:41 2015 +0100

    Switch to Ranch for connection handling

commit 8928a29b43322e6dee9f3b5a6e9b546a93047a89
Merge: 5931edc27 52ce9fa48
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 17 15:37:39 2015 +0300

    Merge branch 'master' into rabbitmq-server-351

commit 52ce9fa48c596424a39059d13aad3c3183d42cee
Merge: 8c5ff0aa3 4d0c33031
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 16 20:04:30 2015 +0300

    Merge branch 'stable'

commit 8c5ff0aa3e7bd2d5fbe1a2537319ca91688cfc20
Merge: cf2c1732d da5bc96f3
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 16 18:33:32 2015 +0300

    Merge pull request #425 from rabbitmq/rabbitmq-server-417
    
    makes sures the aggregator process doesn't hang

commit cf2c1732da0c1c01108e1dbff977bd9858273e36
Author: Matthew Mosesohn <mmosesohn@mirantis.com>
Date:   Mon Nov 16 14:20:40 2015 +0300

    Add host_ip field
    
    Working with RMQ definitions via management plugin
    requires knowing the IP address where it listens.
    
    host_ip parameter will default to 127.0.0.1, but is
    configurable.

commit 4d0c3303154deb552b1a490b112b5588c85d5c18
Merge: 32f97ff1f 71e722892
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 16 15:19:20 2015 +0300

    Merge pull request #424 from mattymo/host_ip_param
    
    Add host_ip field

commit da5bc96f3a0cad9b41a1735ec101faa4d6351d8b
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Nov 16 12:59:52 2015 +0100

    makes sures the aggregator process doesn't hang

commit 71e72289225bb9788e779e636d3ceceef4ccb20f
Author: Matthew Mosesohn <mmosesohn@mirantis.com>
Date:   Mon Nov 16 14:20:40 2015 +0300

    Add host_ip field
    
    Working with RMQ definitions via management plugin
    requires knowing the IP address where it listens.
    
    host_ip parameter will default to 127.0.0.1, but is
    configurable.

commit f553e08ba40de18725b3315346669db5667b228e
Merge: d63dbbe30 aa699d606
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Nov 13 21:45:44 2015 +0300

    Merge pull request #422 from rabbitmq/rabbitmq-server-420
    
    refactors credit flow code

commit aa699d6065c700c4421c754d3c8e85de7dab444d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Nov 13 16:07:56 2015 +0100

    refactors credit flow code

commit d63dbbe3064de35dec0c97741300bec4ae6954ea
Merge: 95cc2fd97 c1a75f70c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 13 14:39:56 2015 +0100

    Merge branch 'rabbitmq-server-80'

commit c1a75f70c7047dde60970f72656f9b7852669d36
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 13 14:35:44 2015 +0100

    packaging/windows-exe: Append version to program name in "Add/Remove Programs"
    
    There is already a key dedicated to the product version. But apparently,
    this is not easy when automating things. Moreover, most aplications I
    checked have the version appended to the product name so this is a
    common practice.
    
    Fixes #80.

commit 95cc2fd975348e7166422acd88c4cf0923282bb2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 13 12:46:19 2015 +0100

    packaging/windows-exe: Use rabbitmq.ico in the "Add/Remove Programs" window

commit e87fcd589c25815c5e48a185151f4344a50b2277
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 13 12:19:39 2015 +0100

    packaging/windows-exe: Remove \Program Files\RabbitMQ Server on uninstall

commit c9cb9b45f8ed08b49804ee98af2c8e19e75f9dbf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 13 11:58:45 2015 +0100

    packaging/windows-exe: Always install in \Program Files
    
    ... even on 64-bit Windows (instead of `\Program Files (x86)`
    previoously).
    
    This change of directory takes effect for new installs only, not for
    updates.

commit 5931edc27eb3273945345dc3f9a784287df88ccd
Merge: 4e1dd3749 9ce5036ed
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Nov 12 16:31:50 2015 +0100

    Merge branch 'master' into rabbitmq-server-351

commit 9ce5036edd3d9ef116285565c8de8124601389e4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 10 17:38:13 2015 +0000

    packaging: Quote variables passed to sub-makes

commit a01bae7eeacbaa7ffb0c9cb3b9e2fb9fca2271fd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 10 17:11:36 2015 +0000

    packaging: Pass SIGNING_* variables to sub-makes
    
    While here, change the name of the variable from SIGNING_KEY_ID to
    SIGNING_KEY in `debs/Debian/Makefile`.

commit 4edd782209da6220e01cc8b8c236196c3648cfdd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 10 13:12:01 2015 +0100

    Update erlang.mk

commit 4a0f19f19195879f35de95e34fea0e77e3879849
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 10 13:11:15 2015 +0100

    Update rabbitmq-components.mk

commit 884302d69c4b4250e3b1fbd41f6d1e09878f7152
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 10 01:39:38 2015 +0300

    Explain

commit 45141a069d164f245ed7837720da7a213321fd2f
Merge: e5af86f75 2d1061cd1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 10 01:27:33 2015 +0300

    Merge pull request #408 from rabbitmq/rabbitmq-server-62
    
    RabbitMQ server 62

commit 2d1061cd1e492fa3428a45b59924722c9be453f7
Merge: 543201bf9 e5af86f75
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Nov 10 01:26:55 2015 +0300

    Merge branch 'master' into rabbitmq-server-62
    
    Conflicts:
            src/rabbit_cli.erl

commit e5af86f753f3307d919a17603fa1f77fc678cbad
Merge: 1d0606968 798454017
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Nov 10 00:32:23 2015 +0300

    Merge pull request #412 from binarin/rabbitmq-server-396
    
    Distinct exit-codes for CLI utilities

commit 1d0606968856bb512f7ff065fb0c003d45607991
Merge: 19905b328 e0f90d8f4
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 9 21:02:54 2015 +0300

    Merge pull request #411 from binarin/rabbitmq-server-ocf-idempotent-cookie
    
    Don't update cookie on every run of HA OCF script

commit 19905b328e5f0f67949ba6cafcdaf074eaa54cb5
Merge: a9f3f5735 c85fdd0f5
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 9 21:02:08 2015 +0300

    Merge pull request #410 from binarin/rabbitmq-server-ocf-typo-fix
    
    Fix metadata in OCF HA script

commit 7984540175d0b8852025165b6b6a0ac05d692c98
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Nov 9 20:58:31 2015 +0300

    Distinct exit-codes for CLI utilities
    
    Use exit codes from sysexits.h instead of just 0 and 2.

commit e0f90d8f4ab908c49f058de7123a28ad3590e770
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Nov 9 20:24:30 2015 +0300

    Don't update cookie on every run of HA OCF script
    
    Update happens even during no-op commands like 'meta-data' or 'usage'.
    During this update there is a short window for a race condition: a shell
    redirection truncates the cookie file, and echo writes data there only
    after a brief period of time. So erlang may read data from this empty
    file and die with the error "Too short cookie string".

commit c85fdd0f5c54f312fc2147dad2b956961aae3f12
Author: Alexey Lebedeff <alebedev@mirantis.com>
Date:   Mon Nov 9 20:20:10 2015 +0300

    Fix metadata in OCF HA script
    
    Looks like copy-paste has gone wrong.

commit a9f3f57356befb3cfeea1bb6047b1fed30e7155a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 9 16:42:12 2015 +0000

    packaging/windows-exe: Fix circular variable references

commit de7923bdee93b8b7f48d812165636836220f1021
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 9 16:41:55 2015 +0000

    packaging: Add `make clean`

commit 7230cd8326c9232ad6d5d99794de32a0697e4ab4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 9 15:51:50 2015 +0000

    APT repository: Give more control to the caller

commit c80d7965c163b6f4959ae104be893fe97daa6b86
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 9 14:43:51 2015 +0000

    packaging: Automatic `make clean` can be disabled

commit 9a2f88d4749894a6fef9803a658d39c431923b30
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 9 14:42:46 2015 +0000

    packaging/generic-unix: Do not remove build directories in `make dist`
    
    There is `make clean` for that.

commit 0f892337184752e779935eb5716d657d2ed7def6
Merge: a0e04b767 168524364
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 9 16:57:16 2015 +0300

    Merge pull request #407 from rabbitmq/rabbitmq-server-237
    
    Changes error code when connecting to a non-existent or forbidden vhost

commit 168524364c4449a7f4ee5e86488faff9c72dd548
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 9 16:47:19 2015 +0300

    Slightly better name

commit 543201bf9d09e8d61639ed9b939a82ed43a1c943
Merge: 2cfcc3d6e a0e04b767
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Nov 8 21:52:42 2015 +0100

    merges master into rabbitmq-server-62

commit 2cfcc3d6e033d8b3dd37fc31ea2f274a24262c15
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Nov 8 21:16:35 2015 +0100

    move mapping helpers to rabbit_common

commit 8c796f1c2a2c13337057c3956e6e402807605959
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Nov 8 21:14:39 2015 +0100

    whitespace

commit a0e04b76737b350633196e2a3841afb0e84aa118
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Sat Nov 7 19:31:30 2015 +0000

    `make clean-source-dist` is PHONY

commit faa4c10ce94b641c052162f5b9cd850ca6d28a03
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 28 18:46:30 2015 +0000

    Updates exception to handle 'not_allowed' error.
    
    References #237

commit e523f1e20cb3346d8e21292cfcac6e7aa372c507
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 28 18:43:48 2015 +0000

    Update from 'access_refused' error tag to 'not_allowed' for
    failed vhost validations.
    Adds check_access/4 clause to allow passing of error tag as a variable.
    
    References #237

commit adb913085e071307eb95effbc5ea2f382208ba4b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 6 13:40:32 2015 +0000

    make source-dist: Do not distribute the website

commit 98b0a6f3240db17291b7011e4719b1c7683ee012
Merge: d977c0f1c 32f97ff1f
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Nov 6 09:26:56 2015 +0300

    Merge branch 'stable'
    
    Conflicts:
            test/src/rabbit_tests.erl

commit 32f97ff1f795551e46231ca32c9c82f8cddcf73b
Merge: fbc33dcaa 1f8de3d70
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Nov 6 09:24:30 2015 +0300

    Merge pull request #405 from rabbitmq/rabbitmq-server-119
    
    Adds authentication command to rabbitmqctl.

commit 1f8de3d70695b662ce396ff3c5e6bea85b49269b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 6 09:16:57 2015 +0300

    Typo

commit 6a5dd103a57a3f361bcfdd923a5c4ee63e96a0eb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Nov 6 08:57:10 2015 +0300

    auth_user => authenticate_user
    
    "auth" is an overloaded term that some use to say
    "authentication" and some to say "authorization". We distinguish
    between authn and authz in RabbitMQ for that reason.
    
    So lets be more specific in user-facing bits.

commit d977c0f1c604f6f6f7542be4fadca51ff40891b8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 5 20:51:33 2015 +0000

    Update rabbitmq-components.mk

commit a7b4a60a5e110e1a013f3cd95d567da417121d4a
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 5 11:39:05 2015 +0000

    Introduce 'rabbitmqctl auth_user' to authenticate user.
    
    References #119

commit 5dbdb47f55f1be3505c60079cee8974a412a2a68
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 5 11:10:20 2015 +0000

    Initial commit.
    
    References #119

commit c7b4b88fa81b7e649ed1259d9a6a0b9986e7f8f2
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 5 11:09:05 2015 +0000

    Adds tests for 'auth_user' control command.
    Adds handling of results of {ok, Result} format.
    
    References #119

commit 0b9892e74d886827bf47e9e79bf4682c8e3daa8a
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 5 11:01:36 2015 +0000

    Adds 'auth_user' control command.
    
    References #119

commit 0e49824839eb807d8927d57b6200afa873f2ab11
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Nov 5 10:46:24 2015 +0000

    Adds handling of 'auth_user' control command results.
    
    References #119

commit 3bd2714ab5e390e232520e95f658abd7057c1871
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 5 09:23:29 2015 +0000

    Makefile: Remove a debug "echo"

commit f6db0c0df463a0c8fd4248f8ed8ab52ead5468f5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 18:09:06 2015 +0000

    packaging/Makefile: Remove a debug $(info)

commit 4e854f2527da0ae5730be74f0355551fa59dc0d5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 18:06:22 2015 +0000

    make packages: Move targets to packaging/Makefile
    
    make packages is now independent of erlang.mk and the RabbitMQ source
    distribution.

commit c70e10f6ad90d018c97a308f9165ffcae3a98204
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 18:05:30 2015 +0000

    make source-dist: -n means different things for BSD and GNU tar
    
    Use --no-recursion instead.

commit 31d89320e714d847b0ee89c374106da6a6f1cf68
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 18:05:02 2015 +0000

    make source-dist: Do not distribute Mercurial and Travis files

commit f070aa7140afbef8400b72d56fc0505fa9942da8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 11:29:35 2015 +0100

    rabbitmq-env.bat: No need to set a default value in %COMPUTERNAME%
    
    References #402.

commit fdb1eb485c5e7fbeba3c26006ddf1c193367a241
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 4 11:25:33 2015 +0100

    rabbitmq-env: Revert "Use Erlang to determine local hostname"
    
    After further investigation, the problem was not an inconsistency
    between hostname(1) and Erlang, but a `/etc/rabbitmq/rabbitmq-env.conf`
    in Travis CI's host having `NODENAME=rabbit@localhost`. See #402.
    
    The real problem is therefore the testsuite which should ignore
    `/etc/rabbitmq/rabbitmq-env.conf`.
    
    The Windows side of the change is kept because it fixes a real issue.
    
    References #402.

commit 765218a666681139f3f5f05390c35871090afe49
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 3 18:25:10 2015 +0100

    rabbitmq-defaults.bat and rabbitmq-echopid.bat: Fix line ending

commit 1fb451090a2557f35a2800f9d04c476ff1ad6a22
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 3 19:13:55 2015 +0100

    rabbitmq-env{,.bat}: Use Erlang to determine local hostname
    
    This helps when Erlang and hostname(1) or  %COMPUTERNAME% return different
    value. This happened on Travis CI and some Windows hosts so far.

commit d23b788326cb3bbe022962188654bc631e2176e5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 3 18:30:05 2015 +0100

    rabbitmq-env.bat: Fix how we escape double quotes

commit 21fb84eeff6a56bcd2cfeb31e3db46f8c61d9799
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 3 15:12:28 2015 +0100

    Update rabbitmq-components.mk

commit bbc58be11ef8d2b983840abe6d276777e8a83e84
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Nov 2 22:08:27 2015 +0100

    removes rabbit_ctl_timeout_tests.erl from rabbit repo

commit 2a69ce3a0e8d3adad9003f2869d3c147f5d121e6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 2 12:35:47 2015 +0100

    make source-dist: Put distributed archives in $(PACKAGES_DIR)

commit 695e7f53dc04465d5a34a5b3825b78abf3d54ac1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 2 12:32:00 2015 +0100

    Makefile: Support V=2

commit 62cccd99e6172ff94c5559cd429a7fa03b69dcd1
Merge: 143a4cf5a 1c90b45c4
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Nov 2 12:24:55 2015 +0300

    Merge pull request #395 from rabbitmq/rabbitmq-server-379
    
    Fix cluster-wide alarm handling

commit 143a4cf5a6b924c664bd9c88bdcd352f28cb529c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 2 10:20:48 2015 +0100

    Update rabbitmq-components.mk

commit 1c90b45c45694249916195340022d6805f22581e
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 2 11:00:07 2015 +0300

    Ignore ./etc

commit 0368d6bc50ae6cf7e513439ddf2c46f46df254d6
Merge: 03c28ed96 412cb9c81
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Nov 2 10:39:41 2015 +0300

    Merge branch 'master' into rabbitmq-server-379

commit 7112c6896d8dded26bade8d51a27a850b299bfc7
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 31 12:39:15 2015 +0100

    moves emitting_map to rabbit_control_misc

commit 412cb9c8197e778182418519a8a1d445319d90a4
Merge: b68e637bc fbc33dcaa
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 31 10:43:30 2015 +0300

    Merge branch 'stable'

commit fbc33dcaa55a9f416545e6d24add4ae227af9334
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 31 10:43:00 2015 +0300

    Ignore erlang.mk artifacts (when switching from master)

commit b68e637bc3f02fa0a3d49281fc72f7d23e331af9
Merge: 91d007da4 0cc96cb8c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 31 10:41:26 2015 +0300

    Merge branch 'stable'

commit 0cc96cb8ca93a6bda9d6e3c00dc7047fbbf62731
Merge: a74006936 84dec3da9
Author: Michael Klishin <michael@novemberain.com>
Date:   Sat Oct 31 10:38:11 2015 +0300

    Merge pull request #397 from rabbitmq/rabbitmq-server-91
    
    Disable disk monitor in unsupported platforms

commit 91d007da47d26600f2b0800cfa0639b4e61d9baf
Merge: fd1fdf56b a74006936
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 31 09:55:28 2015 +0300

    Merge branch 'stable'

commit a74006936b7aaccd952d73b80561259430065170
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 19:53:25 2015 +0100

    rabbitmq-service.bat: Use RABBITMQ_ prefix for *LOGS variables
    
    The service script was forgotten when fixing the bug in rabbitmq-env.bat
    and rabbitmq-server.bat.
    
    References #375.

commit fd1fdf56bdf43504cf515edd992bfea6855d92cd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 20:00:46 2015 +0100

    rabbitmq-service.bat: Set $ERL_LIBS in the service environment
    
    This is required to find rabbit_common.

commit 6ee124068ab235556d0fba0c465fdcb655138aa6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 19:53:25 2015 +0100

    rabbitmq-service.bat: Use RABBITMQ_ prefix for *LOGS variables
    
    The service script was forgotten when fixing the bug in rabbitmq-env.bat
    and rabbitmq-server.bat.
    
    References #375.

commit 571d4cb3468372cd132d577d0e2d1d8ac7c95324
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 18:31:54 2015 +0100

    rabbitmq-env.bat: Use lazy variable expansion
    
    ... when querying `plugins_dir` and `enabled_plugins_file`.

commit 226e52a87c5e376adce9d857dad1ccc24d934971
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 18:29:57 2015 +0100

    rabbitmq-env.bat: Use consistent indentation across the file

commit 611c7a52dd85b1b637208fd2b065c3f5885cfdba
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 18:22:58 2015 +0100

    scripts: Convert Batch files to DOS line endings

commit 733b8a458d9247736599ddafc6d7a09258dd0081
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 18:19:32 2015 +0100

    packaging/windows-exe: Use explicitely $(VERSION) in the source zip name

commit a5b9ab0634bd392bc7ed6477dca753cfa63d46c2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:32:54 2015 +0100

    Update rabbitmq-components.mk

commit 7639c00a1470aea74d9c4331be7505d44731f151
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:20:04 2015 +0100

    scripts: Pass script name to rabbitmq-env.bat

commit 14e82c3ac70b48c311aac3bed00e1580416ade7c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:19:03 2015 +0100

    rabbitmq-env.bat: Adapt to erlang.mk

commit 9fb751bb9a34b214693cac4702301cc6aa2f2abd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:17:48 2015 +0100

    rabbitmq-env.bat: Use backslashes in paths

commit ced15255ec0c78c897d360e99de1b0bfd1b5b414
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:16:45 2015 +0100

    rabbitmq-env.bat: Automatically set ERLANG_HOME if "erl" is in the PATH

commit 2af2131e3e15a90fe8979e0772bb79d5051579cd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:15:04 2015 +0100

    rabbitmq-env.bat: Take the caller script name as first argument

commit a4d6099b134705650ee12e537f99f233b5e63c93
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 17:12:37 2015 +0100

    rabbitmq-defaults.bat: Detect development env on Windows

commit ff5cfcc67467c49d65368d02e727dccbe2ae8a79
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 16:40:38 2015 +0100

    Git: Ignore editors' backup files

commit ad8fea9914cd739765af6a88367388c74861c966
Merge: 06c3d2b04 3ab1f8d19
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 30 16:32:03 2015 +0100

    merges master with erlang.mk changes

commit 84dec3da91283e3a0bb153ac4437e2600ea1a96d
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Fri Oct 30 13:34:31 2015 +0000

    Test failure to start disk monitor in unsupported platforms

commit 72dcf7c5b48a3b60af81dfa0071b9de4e7c6b0a7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 12:33:26 2015 +0100

    rabbitmq-env: Ensure RABBITMQ_HOME is an absolute path
    
    This helps rabbitmq-plugins when it queries rabbitmqctl to get the
    various plugins path variables.

commit 561333bd0e1ddf71ab18295d5027d51c873a1100
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 30 12:21:44 2015 +0100

    rabbitmq-plugins: Don't query rabbitmqctl if env vars are explicitly set
    
    So if RABBITMQ_PLUGINS_DIR is explicitely set in the environment, do not
    run rabbitmqctl. Likewise for RABBITMQ_ENABLED_PLUGINS_FILE.
    
    This prevents rabbitmq-plugins from taking configuration from a running
    unrelated node, when it is started from `make run-broker`. The make
    command will still fail later but for the correct reason: there is
    already a node conflicting with the one we want to start.
    
    Without this, `make run-broker` would abort with the following error:
        Error: {cannot_write_enabled_plugins_file,
                   "./sbin/../etc/rabbitmq/enabled_plugins",enoent}
    ... which doesn't make any sense.

commit 03c28ed96e16d05b12d8019969eb3ac8854b242b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Oct 30 12:10:42 2015 +0900

    Doc edits

commit 3ab1f8d196dd61e12098b1fbfd32320f82137c91
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 11:04:30 2015 +0100

    packaging/standalone: Use "cp", not "cp -a"
    
    For the same reasons as:
    
        commit a131baadf409db533c24dfd87d3a141136bcc37c
        Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
        Date:   Thu Oct 29 09:56:21 2015 +0100
    
            Makefile: Use "cp -r", not "cp -a"

commit 29c9fe7c5844d3309b59b6d5a4a88944f4356e08
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 11:03:15 2015 +0100

    packaging: Do not pass $(ERL_LIBS) to sub-make

commit 8ebac9056d0c7f5cb172aaca54ce61e4c00e0621
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 10:09:56 2015 +0100

    packaging/standalone: Use "xzcat | tar" instead of "tar -J"
    
    The -J flag is not supported by old versions of GNU tar. This is the
    case on Mac OS X 10.5.x for instance.

commit cde16aaa20791ab2366b3ebee47cc642f4e31030
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 10:00:12 2015 +0100

    make package-standalone-macosx: Only valid on Mac OS X
    
    On other platform, there is no point in creating this package because it
    embeds a native Erlang.

commit a131baadf409db533c24dfd87d3a141136bcc37c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 09:56:21 2015 +0100

    Makefile: Use "cp -r", not "cp -a"
    
    "cp -a" is not portable and in fact, we don't need to preserve
    timestamps or owner. Permissions are preserved anyway.

commit c3e18edda8bcbb9dfd5167d31ba6fc1ddb13eced
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 29 09:42:16 2015 +0100

    make source-dist: Mention we should fix file timestamps
    
    Add an example with the comment.
    
    This is on the TODO to have reproducible builds.

commit eb86030af14158be87a8ace7d893a9fd27ec3ccf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 19:10:21 2015 +0100

    packaging: Do not pass $(DEPS_DIR) to sub-make

commit 15c69da995015b9b39a0ea9734ec387b2dfa6efa
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 19:04:07 2015 +0100

    make source-dist: Replace version in rabbit.app.src as well

commit b81e0af1b0392f961bb97ca0f51e8e1065b9d6df
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 19:03:39 2015 +0100

    make source-dist: Use $(PROJECT) instead of hardcoding `rabbit`

commit 7132caff0f6e6b9a48a3a53e14afcf07c5d0d8cb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 19:02:34 2015 +0100

    packaging/standalone: Test if `generate_release` succeeded

commit 4e9560fcc17a84da736bf8c8bdaf90f013dbddf4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:39:10 2015 +0100

    packaging/standalone: Sort files in final archive
    
    While here, switch from gzip to xz as the compression format. This saves
    around 16% of file size.

commit 09683b9d3f0ea6ccb76d512fa03a2b24d51163b3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:26:03 2015 +0100

    packaging/standalone: Remove patch(1) backup if any

commit ff060cc2ec9c7aa656f8f40d39cc70b00444a32c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:25:22 2015 +0100

    packaging/standalone: Use $(abspath) instead of `pwd`

commit d015c5ca895313f2689b233ff59beeb477aa4108
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:20:21 2015 +0100

    packaging/standalone: Remove existing build directories

commit d51bb4a4c6e4ea0732fd0ce97938c4666af35567
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:19:56 2015 +0100

    packaging/standalone: Do not pass $(DEPS_DIR) to sub-make

commit df5339c087e8284b1c44e1f3a68898f161fe1500
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:19:18 2015 +0100

    packaging/standalone: Fix path to default $(SOURCE_DIST_FILE)

commit 9c722e93624d5e423f621e5c99e77d6e4b8ab036
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 18:09:00 2015 +0100

    packaging/standalone: Ensure plugin deps are listed once in the rel script
    
    Otherwise, systools complains with eg:
        Duplicated register names:
                ssl_sup registered in ssl and ssl
                ssl_manager registered in ssl and ssl
                ...

commit a4611b899fe226f6b586af06653f5ed8ebca6d8d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Thu Oct 29 00:41:56 2015 +0900

    Doc edits

commit 983a7321339109f15f35cfc151b9be86168de2ef
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 14:49:57 2015 +0100

    make source-dist: "find -s" is not portable, use sort(1)
    
    sort(1) supports the option -z to work with NUL-terminated strings, so
    we can keep "find -print0" and "xargs -0" and support filenames with
    whitespaces.
    
    As a reminder, LC_COLLATE=C is used to ensure the order is the same for
    everybody (ie. independent of the user's locale).

commit e5647667a4bce9147d97e92923b40e41baf1d4ce
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 11:15:40 2015 +0100

    Update erlang.mk

commit f57349aead3ece76076b1924089da7b530af7e16
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 28 11:10:35 2015 +0100

    Update rabbitmq-components.mk

commit 7bb08766c651eb5ae794b61eba84962cd45d4b62
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 28 10:07:41 2015 +0900

    Wording

commit 4fc5d8567f2c3b3bea575656e2400e927f8edb91
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 28 10:06:20 2015 +0900

    Ditto

commit dbb47ad228dca5dc08d29965fe82a08a431cf312
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 28 09:53:13 2015 +0900

    Ditto

commit 123d7cf2b635e6f32dd6960dcdb80541a2bf4286
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Oct 28 09:47:36 2015 +0900

    Doc edits

commit 4f4c88ec03f44488a26935c8bfa4c7beaf0e23b5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 17:47:05 2015 +0100

    make source-dist: Sort files in the source archive
    
    This is one step toward reproducable builds.

commit 1c3e459a1e2ba6ff0a476f013dbbdea4fcdb7cac
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 14:29:08 2015 +0100

    Makefile: USE_PROPER_QC is now a simply expanded variable
    
    This shaves off 50% of the build time because the shell command is
    evaluated only once.
    
    Do the same for ERTS_VER, though it doesn't bring a significant speed
    improvement.

commit 5fd88e1008b28d6052794aef08f470a646f3a553
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 11:51:16 2015 +0100

    Makefile: Move .DEFAULT_GOAL to the same place as other Makefiles

commit 03b31b4da0f3bfe4010a56c592c118cb5f869c15
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 27 11:41:13 2015 +0100

    cosmetics

commit 79237dc7f827c182adfd79c51167253b929ba517
Merge: 6a0bcaa32 8331f4690
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 27 10:47:54 2015 +0100

    Merge pull request #390 from rabbitmq/rabbitmq-server-369
    
    Rename policy parameters, references #369

commit 6a0bcaa32dca1aa733a3f7a52938ff272101ea7c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 10:09:15 2015 +0100

    make source-dist: Only force plugins' version when it's empty

commit dc7740cd8987665449a8e765a8dd05c31c367566
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 10:08:36 2015 +0100

    make source-dist: Fix licenses handling to match previous behavior

commit e52ac8764f82d1375f85ddbd458a0c7c86ff4757
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 10:06:41 2015 +0100

    make source-dist: Do not distribute some subdirectories
    
    For now, skip cowboy's documentation and examples, and rabbitmq-mqtt
    test client (which is downloaded during the test).

commit 891e5a345e8adc7403abccfe74f192dc544d8f11
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 27 10:06:05 2015 +0100

    make source-dist: Do not distribute rabbitmq-metronome and -toke

commit 741fbef0c9f9fc7691435eba34db68d59e4da378
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 27 11:40:51 2015 +0900

    Move resource_alert to rabbit-common

commit e0f0d3db7796723012cb70cb53cfcb534396e264
Merge: 161e256c2 48e32a894
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Tue Oct 27 11:31:57 2015 +0900

    Merge branch 'fix-alarms' of https://github.com/binarin/rabbitmq-server into rabbitmq-server-379
    
    rabbit_reader is now in rabbit-common.

commit 161e256c2f5a3bb278957f6c1e0f43cf869ba5fa
Merge: 8366d05cc 50f68262c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 27 06:13:57 2015 +0900

    Merge branch 'stable'

commit 50f68262c789997073f95764242b2e75d8f51e83
Merge: 9c87242dd 0e2ed78cf
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 27 06:13:43 2015 +0900

    Merge pull request #394 from aboroska/rabbitmq-server-117-fix-function-name
    
    Fix spelling of function name

commit 0e2ed78cfe26d0328f9d3e094b18dff50c3bb22f
Author: Andras Boroska <andras.boroska@gmail.com>
Date:   Mon Oct 26 20:53:50 2015 +0000

    Fix spelling of function name

commit 8366d05cc8638662a5bf74448e63f34f74220e10
Merge: 5f8bdce5b 9c87242dd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 27 05:31:03 2015 +0900

    Merge branch 'stable'

commit 9c87242dda3a864661f8092b8c07fc6ea76aab11
Merge: 035347c44 ef8f4b96e
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 27 05:05:07 2015 +0900

    Merge pull request #391 from rabbitmq/rabbitmq-server-117
    
    Check port using ipv6

commit 5f8bdce5bd4b7473dec5ac1e2c9245fd90d8bf27
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 15:33:06 2015 +0100

    Update erlang.mk

commit 6581968166c18937807d39078e0690759d0e566f
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Mon Oct 26 12:47:36 2015 +0000

    Disable disk monitor in unsupported platforms

commit 56239e6ea88aec7b563dc486d2ef4929ccb50866
Merge: f42451b4c bde0a08bc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 12:50:14 2015 +0100

    Merge branch 'rabbitmq-server-386'

commit f42451b4c0efc2267177290b2f6190e4007c554b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 12:23:45 2015 +0100

    make source-dist: Do not distribute plugins/ directories
    
    Those are artefacts of unrelated builds.

commit af19ac0684ef604a63aec27bdc4cf1aa73549b30
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 12:00:37 2015 +0100

    make source-dist: Properly list distributed components
    
    I was waiting for the erlang.mk branch to be merged.

commit 3f7c064ee70857b1f840c2e848fa88638c900fe9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 11:59:58 2015 +0100

    make source-dist: Filter out `rabbit` from the dependencies list

commit 9fff8bdeb0325c9651f0a00713763b99ffe56749
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 11:15:23 2015 +0100

    Update rabbitmq-components.mk

commit 739dff3c55dd9c42c3a7eeac1deb6df8ada0dbe6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 26 10:21:13 2015 +0100

    Update rabbitmq-components.mk

commit ef8f4b96efeaf502a6890271f1b308298b1c270b
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Mon Oct 26 08:06:27 2015 +0000

    Check port using ipv6

commit 8331f469015d6261ff84c4babb8a72374d410b57
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Mon Oct 26 06:08:14 2015 +0900

    Rename policy parameters, references #369

commit bde0a08bc3d80b4df7a9f5a78c97d69c05338240
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 23 22:42:43 2015 +0300

    Disable FHC read cache by default
    
    Fixes #386.

commit 644b9b26232d04f8ee3d2091a14a08cca59692a8
Merge: b7092c798 6b93fa3a6
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 23 22:17:35 2015 +0300

    Merge pull request #385 from rabbitmq/erlang.mk
    
    Switch to Erlang.mk

commit 6b93fa3a65d74c72d2b9d6de1dada0515e19e28f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 23 20:54:53 2015 +0200

    Move compare_version to rabbitmq-common

commit 4a70392a104a6eb863432b3e2fdb3b4b0948f46e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 23 19:33:09 2015 +0200

    Update erlang.mk's build.config

commit 4e1dd3749d3a1bcd8778ba40ec8f00d1dbdb271a
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 23 19:27:07 2015 +0200

    fixes typos

commit 5b654bad0f07cbe19c72bfaba00d4dcb27792465
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 23 18:32:23 2015 +0200

    Update erlang.mk

commit 43882723aead6e92291806c2b6ddcf192d1e8071
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 23 16:05:38 2015 +0200

    Update rabbitmq-components.mk

commit b7092c79837da3d89a6a11044fdb31c402590e7a
Merge: ad461b30e 035347c44
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 23 16:58:49 2015 +0300

    Merge branch 'stable'

commit 035347c4468d0b2d5f433a8e8dd6f41c25737b2c
Merge: 1474424ed 7478205d9
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 23 16:43:23 2015 +0300

    Merge pull request #383 from lemenkov/add_cmd_help
    
    Recognize help as a valid sub-command for rabbitmqctl and rabbitmq-plugins

commit 7478205d9b3b9159cf2e9aac54c6552d659d9033
Author: Peter Lemenkov <lemenkov@gmail.com>
Date:   Fri Oct 23 16:05:41 2015 +0300

    Recognize help as a valid sub-command
    
    Some people believe that rabbitmqctl and rabbitmq-plugins should provide
    a valid help subcommand (instead of throwing an error). So here it is.
    
    Signed-off-by: Peter Lemenkov <lemenkov@gmail.com>

commit 48e32a894e51ba2a6ee7433744196eb21d168066
Author: Alexey Lebedeff <binarin@gmail.com>
Date:   Fri Oct 23 13:48:35 2015 +0300

    Fix cluster-wide alarm handling
    
    - Properly handle clearing alarms from dead nodes - #362.
    - Unblock publisher only when all alarms throughout the cluster was
      cleared - #379.
    - Disable/enable paging in rabbit_memory_monitor only in response
      to disk resource alarms from current node (I'm not totally sure
      about this).
    - Add some documentation.

commit 9b248462c68c4e91713059681c2b554ccc754e94
Merge: ea9e299e9 ad461b30e
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 23 12:10:07 2015 +0200

    Merge branch 'master' into erlang.mk

commit ad461b30e9c0104277dff7ec937354d1fc1e64d5
Merge: 2bc39429a 1474424ed
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 23 01:23:53 2015 +0300

    Merge branch 'stable'

commit 1474424ed873b756438bc6a1a3e0fcebb8e9c958
Merge: 0069732db 512e7e0c1
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 23 01:16:21 2015 +0300

    Merge pull request #378 from rabbitmq/rabbitmq-server-207
    
    Accept absolute values in memory high watermark

commit ea9e299e912f0e44a073feffcfab6c5a6de19846
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Oct 22 18:34:03 2015 +0200

    Update erlang.mk

commit 512e7e0c146336e802255e25130207326c85bf96
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Thu Oct 15 12:24:05 2015 +0100

    Accept absolute values in memory high watermark

commit 2bc39429a943957d64b29a1c7a70a8e787e2cd18
Merge: 671baa4e8 0069732db
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Oct 22 12:16:48 2015 +0300

    Merge branch 'stable'

commit 0069732db116c4ffb4a11d6a5311143d4d5d8e35
Author: Alexey Lebedeff <binarin@gmail.com>
Date:   Tue Oct 20 21:17:14 2015 +0300

    Add `exclusive` item to `rabbitmqctl list_queues`
    
    In addition to owner_pid, which makes little sense to beginners.
    
    References #371

commit 671baa4e8766dcd481ec952ab2450fdac4b6e0a0
Merge: 272bfb74e 83e971df6
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 22 11:21:48 2015 +0300

    Merge pull request #373 from binarin/rabbitmqctl-list-queues-exclusive
    
    Add `exclusive` item to `rabbitmqctl list_queues`

commit 272bfb74e06aab7cdc7958ac9e938f8a63a208ce
Merge: c706513c9 94b2959c0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Oct 21 19:03:37 2015 +0300

    Merge branch 'stable'

commit 5724c0be0778818d7436f6aa11954971b5ac63a3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 21 18:01:50 2015 +0200

    removes whitespace

commit dc66197f3539a7a7bc3e3cc5b491a25b84d73011
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 21 17:58:40 2015 +0200

    typo

commit 94b2959c061d40bbf379e1cf7adaf4c6a48b01ea
Merge: c824717c1 bfa142964
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 21 18:41:29 2015 +0300

    Merge pull request #376 from rabbitmq/rabbitmq-server-375
    
    Fix issue 375

commit bfa14296427e663ed8b770f0853a9ceada067315
Author: Gabriele Santomaggio <gabriele.santomaggio@erlang-solutions.com>
Date:   Wed Oct 21 17:32:54 2015 +0200

    fix issue 375

commit c706513c9a8a4b0cd35b6788a79169cb8a11e30f
Merge: 88328fe18 c824717c1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Oct 21 11:52:50 2015 +0300

    Merge branch 'stable'

commit c824717c13dcea67171e3c42e43b9f303bcbcd21
Merge: 256c2218d 6427aaf46
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 21 11:50:21 2015 +0300

    Merge pull request #374 from bogdando/ra_ocf_ha
    
    More OCF HA fixes ported from OpenStack Fuel

commit 6427aaf46b97fca26adda03b0f2b6acb5282f599
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Wed Oct 21 10:46:51 2015 +0200

    Fix piped exit codes expectations and count processing
    
    * Fix return code of the get_all_pacemaker_nodes() and
    get_alive_pacemaker_nodes_but() to be
    not provided as ignored anyway.
    * Fix return code expectation of the fetched count attribute
    in the check_timeouts().
    
    (Fuel related bug)
    Closes-bug: #1506440
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 9e4e607de3a4f8112fecc1d9a4a1af9c5e1cfd83
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Wed Oct 21 10:43:16 2015 +0200

    Fix the timeout arg for the su_rabbit_cmd
    
    And fix local bashisms as a little bonus
    
    (Fuel related bug)
    Related-bug: #1464637
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 83e971df6b6693bb885bd57191f3e87a2b2ce3d1
Author: Alexey Lebedeff <binarin@gmail.com>
Date:   Tue Oct 20 21:17:14 2015 +0300

    Add `exclusive` item to `rabbitmqctl list_queues`
    
    In addition to owner_pid, which makes little sense to beginners.
    
    References #371

commit 7a9c6b771e077165e449d1fc5ae1d03e24ee49d7
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 20 15:42:59 2015 +0200

    rabbitmqctl-env: Fix how we locate rabbit_common

commit 2143ea0641d71350cd56a932296559624302acd9
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 20 12:15:34 2015 +0200

    fixes test

commit 935f14921a30b495d01a067dd042cfccfcdb51bd
Merge: 5a110fd1c 88328fe18
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 20 12:03:04 2015 +0200

    Merge branch 'master' into rabbitmq-server-351

commit 5a110fd1cb88ccd59cbe334bbde48aa5d0f9705a
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 20 11:56:02 2015 +0200

    adds policy validator tests

commit 39d53d797cd3c50464654ddeea839b0cbfb7ea3d
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Oct 19 17:35:43 2015 +0200

    Update rabbitmq-components.mk

commit b8246eef4f8fa40ee7eabcf1ab37fc6691a064a1
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Oct 19 17:12:15 2015 +0200

    Update erlang.mk

commit bb7f4fdfd5699592d7b9f1d06c697875e30c77eb
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Oct 19 17:11:39 2015 +0200

    Update rabbitmq-components.mk

commit 07986213bf3d57136d32db34593408c41bea9b52
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 16 18:04:02 2015 +0200

    Update rabbitmq-components.mk

commit dac3e7acf8c94ca2167107f8a203cb1c49010233
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 16 16:58:16 2015 +0200

    Update rabbitmq-components.mk

commit 94b0b444bae22e6010e76f24c7dbbedb384a2a1b
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 16 13:03:09 2015 +0200

    Update rabbitmq-components.mk

commit fde92ce3eaa28102b90251198dec29f2c60136c6
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Oct 16 11:10:03 2015 +0200

    Move password_hashing_tests.erl to rabbitmq-test

commit fd97e3a74611518cb4bd7707ea2114b8124b1553
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Oct 15 16:32:15 2015 +0200

    Update rabbitmq-components.mk

commit 9a44c875076faf0e589c0c0a91f5be9bf653c8a0
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Oct 14 13:01:12 2015 +0200

    Update rabbitmq-components.mk

commit e5565986addc4070b9d435a6513f5b24c29dda6f
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Oct 14 12:33:57 2015 +0200

    rabbit_common is added automatically

commit f3b1f26322d245ef0c2b683f1b4ce30ba8695293
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Oct 14 12:32:23 2015 +0200

    Update rabbitmq-components.mk

commit 8d0c8dad7da9d9b2d642874a70fcbeb44f68be54
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Oct 14 11:53:54 2015 +0200

    Update rabbitmq-components.mk

commit 04ada4583d976acb38419f15a2af90c29e443897
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 13 19:29:09 2015 +0200

    Update erlang.mk

commit 4e7c8ea5683b23680f440040a8ff9d40b4ccd612
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 13 19:21:51 2015 +0200

    Update erlang.mk

commit 768ac915ae402eed1a7f36f4c555971f3ed7ec2a
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 13 19:12:14 2015 +0200

    Update rabbitmq-components.mk

commit 7c42ea28ea3b4f507a0bbab9980f99eccfea1474
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 13 14:37:03 2015 +0200

    Allow to specify temporary $(PLUGINS)
    
    This is useful when a user wants to start a broker with a temporary list
    of plugins.
    
    The name of the Erlang application must be used (ie. the same as the
    name in erlang.mk), not the name of the repository. For example:
        make run-broker PLUGINS="rabbitmq_shovel rabbitmq_shovel_management"

commit f533f02539e73eb2faed1f4f91e17e74728d73da
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 13 11:56:28 2015 +0200

    Update rabbitmq-components.mk

commit 8692d245f959c95c5683c96991fc654bd71481ae
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Oct 12 19:02:03 2015 +0200

    Update rabbitmq-components.mk

commit 51fd10caac23abcf89fe781bef685392d2809b2d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 12 17:53:51 2015 +0200

    Update erlang.mk and rabbitmq-components.mk

commit 706cf18bcae67b03a803c15eeabc38a80d9e85d1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 17:40:44 2015 +0200

    Give path to the source dist to packages' Makefiles

commit 231e90cacf3daec5f43b3307867129e61496b123
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 17:12:27 2015 +0200

    Packages are now "self-hosted": no need for the packaging dir
    
    ... in the source distribution anymore

commit bb018b6adc4295fe13690ca8c3e23a3b828856fd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 16:53:46 2015 +0200

    Remove exec bit from non-executable scripts

commit 8fa9390ac54c8e2f8b6508570f83089c543d36fb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 16:49:56 2015 +0200

    Update distributed LICENSE with license_info from plugins

commit f78a6551e80baa7113dcb1f7201b7c2d0bb88a7f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 15:05:24 2015 +0200

    Finish with generic-unix and standalone-macosx packages

commit 48614919f369ffcf68f78d2fd48edbf416ce81ec
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 11:54:39 2015 +0200

    Add targets to build packages

commit 84c69805c11caba193d45f9755352ecdcd5d8394
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 11:25:11 2015 +0200

    Fix "/LANG=${LANG_ENGLISH} language not loaded" warning

commit ae54c2e6d26f9403bf70f8c7d27fc5739fdd635d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 11:24:21 2015 +0200

    Small cleanups to the Windows exe installer

commit 7154a871fc522fb2c3c477893b11882e99b99e2d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Oct 9 11:23:41 2015 +0200

    Don't append `.txt` to `rabbitmq.config.example` on Windows

commit 58d44e3dc85365df7acb01e981f0bc079e41efe2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 18:51:01 2015 +0200

    Fix typo, a trailing ')' was left over

commit 2704bf9ef3fb9831d281b23d5d91c84104e3079f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 18:48:28 2015 +0200

    RPM: Include manpages

commit 68a1b81e3543afcbac05c4ab5f8ff0f9abd858d2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 18:48:01 2015 +0200

    Add install-man target to install manpages

commit a7c52a97f0d1048a8a57371597a9381b9cd3ea56
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 18:24:31 2015 +0200

    Make the Windows non-exe package work with erlang.mk

commit 4b88cdf12fc8a60b4a19f60a367792eaee00f74f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 18:24:01 2015 +0200

    Add install target for Windows

commit 7c950bad7b56205dc0f31ef828cb162b28354c0e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 16:59:12 2015 +0200

    sed: Use [[:blank:]] instead of \s
    
    It seems more portable.

commit 59efa1a1a7ab6bf750aa1c687324a0d6d6af82df
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 11:43:10 2015 +0100

    Make the RPM package work with erlang.mk

commit 947161632e9ebf3ba87d06ded4b48044f49081c1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 11:42:00 2015 +0100

    In source-dist, fix dependencies' erlang.mk
    
    By default, it contains an absolute path which is incorrect in the
    source archive.

commit 1bec029d0c7649a01c6bc90e2945e4105ff6bac0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 11:21:58 2015 +0100

    awk: split() takes a list of separators, not a regex

commit c2a5cc5e646ae4aa9d05892a3185ae8aedada62b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Oct 8 11:21:35 2015 +0100

    Debian: In fact, unzip(1) is not needed

commit 9d61c7ecc994e3c70bd14e4e287feaf8a88a2898
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 7 14:26:44 2015 +0100

    Modernize Debian package and make it work with erlang.mk

commit 689e65ce80aaebe8cb8a2bd69064b1bd5e1d645f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 7 14:15:01 2015 +0200

    Move scripts list to a variable

commit d3aaf9a6f31f488d6181d720ba7d2f90fb9b1bd2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 7 14:12:07 2015 +0200

    Define $(VERSION) earlier

commit 1fff560708e83a24d4400e4f7a16a65cdb8fc39f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 7 14:07:39 2015 +0200

    Add plugins dir to ERL_LIBS even for non-dev environment

commit dba8ec338ab58c7f882a356a79ec3f7e92766812
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Oct 7 14:06:05 2015 +0200

    Overwrite symlink in $(RMQ_BINDIR)

commit f5cc88238295d2fd88f65e56fd4f1e4eafad4626
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 20:29:26 2015 +0200

    Remove .zip dist file before creating it again
    
    Otherwise, zip(1) wants to update it. It works but it is slower than
    recreating it from scratch.

commit 5e14a4cee58c6d97607a9cb8d55cd94cd20c7c83
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 20:27:44 2015 +0200

    Install script symlinks in $(RMQ_BINDIR)

commit fe2395e1f9abb077b0b7caa6ae72d37f7ee476e0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 20:17:38 2015 +0200

    Remove unused variable $(UNZIP)

commit 61f51c5532cc0f7a50bbd5342bad0d274b91922a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 19:51:02 2015 +0200

    Be conservative only with rabbitmq-server-*

commit 51b34661204c8f9b4e2f5be8cb6bc1221fccf094
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 19:40:58 2015 +0200

    Be more conservative with rsync --exclude
    
    Ie. do distribute rabbitmq-server-ha.ocf.

commit eb3fe0bdaead1f8d07730335d4324dbaf5690782
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 19:16:15 2015 +0200

    Include `packaging` in source-dist

commit 97c28fc4f285a8bba436061eb23e87c3bf8c3900
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 19:07:29 2015 +0200

    Git: Ignore uncompressed manpages

commit 5ae92091fbf7938d0e43e8a0649203fca258e92c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 18:48:45 2015 +0200

    Do not compress manpages, the packaging system handles that

commit 4f4c127ad4d1e331d3796f14a1cd6c35d70abae9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 18:23:13 2015 +0200

    Remove debugging echo

commit 76776c0bd756c8ccf04a1dca49def2cc3ee4dcb0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 18:15:13 2015 +0200

    Add `make install` target

commit 1b679a912dccf92e7190051bd4f1180cc488bcd2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Oct 6 12:52:47 2015 +0200

    Escape '{' with [] in sed regular expression to please GNU sed

commit d13545b5033577760fc431ca348345f581536817
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Oct 5 17:37:01 2015 +0200

    Move common modules from rabbitmq-server to rabbitmq-common

commit bab7368ea3575051140e95a20140eaeba5ceb85f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 25 12:05:42 2015 +0200

    rabbitmq-env: Fix vars for rabbitmq-plugins before setting ERL_LIBS

commit 7e2dfd6ac35677d8e51ba8313fa545a6000fb501
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 25 11:32:06 2015 +0200

    Git: Ignore /plugins instead of /dist

commit b6ea6e9ef9a14f610b42a47813769c5268cd95b0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 25 11:31:14 2015 +0200

    rabbitmq-env: Adjust RABBITMQ_*PLUGINS* if running from dev env

commit 00976770611cebf8a2970162296c931c03a44197
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 25 11:30:17 2015 +0200

    rabbitmq-defaults: Set RABBITMQ_DEV_ENV...
    
    ... if we believe to be running from the source directory.

commit 7b838f0d1569cf87c222312ed2095bc025927145
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Sep 25 10:23:37 2015 +0200

    Use `plugins` as the dist directory directly

commit 9cb1b4ec05de3df01d4b620bbf573284ea544acd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 17:41:25 2015 +0200

    Update rabbitmq-components.mk

commit 89e316223f73e837aeb73c617f0749de30fb4607
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 17:13:28 2015 +0200

    Update rabbitmq-components.mk

commit 58361ef4e9bd7fea26c840ff849f0ecb96978ded
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 11:48:18 2015 +0200

    rabbit.app: Default to version 0.0.0 in source app file

commit e755963d97741de9d79a636dec8916712cc2cccb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 11:47:55 2015 +0200

    Git: Ignore source distribution files

commit 997a6d6c9cc3a05941014b26217c11d75f040032
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 11:47:26 2015 +0200

    Use rabbitmq-components.mk to fetch RabbitMQ components

commit dcfbd47319d1fa54d41a2d9ec67b09a5c7dff13e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 11:43:10 2015 +0200

    Update erlang.mk

commit dd55817e5d6bc3c06ae97567fe23521725cf68e7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Sep 23 12:17:32 2015 +0200

    Update erlang.mk

commit 6e1cdbd1273254429a83026ab3d608bebdad0390
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 22 15:34:40 2015 +0200

    Add all revisions/tags/branches in the source archive

commit 9ba8c4e868276e37b33f550117fdf591e9b88cff
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 21 18:08:44 2015 +0200

    In source-dist, set all applications' version to `$(VERSION)`
    
    When building from `source-dist`, do not attempt to get Git informations
    and build all `$(SRCDIST_DEPS)`.

commit fe61400611b31a498f263960f07139199edc8460
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 14 18:04:59 2015 +0200

    Finish `make source-dist` and update erlang.mk

commit 0f3a9ac85d591f16f1fc2124e8440983a7e327fb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 10 17:52:43 2015 +0200

    Add `make source-dist` to prepare the source archive(s)
    
    It lacks the ZIP archive still.

commit 008e65f958c925090ce0559a94482283ed098f5b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 10 15:46:38 2015 +0200

    Remove unused scripts & Makefiles

commit b31818b598767f7c8b0109c58a37a6d626ca4abf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 8 15:15:00 2015 +0200

    Use dependency branches matching the parent branch

commit 9cac28d6a7aebc0fd2c491a71f444e800ce401b8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 8 14:46:46 2015 +0200

    Update erlang.mk
    
    Temporarily fetch it from RabbitMQ's fork on GitHub.

commit ce62e5e78bc4ee8aa3f8412391bdbcc90793162c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 3 15:23:07 2015 +0200

    Update erlang.mk and rely on the new makedep feature

commit 4331abe2d31bdd0b84f7953be138dcad2ad861ad
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Sep 2 12:47:10 2015 +0200

    Move codegen.py to rabbitmq-common

commit acab9f2f00a30b99fbf8da93f16fce950af23089
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Sep 2 11:32:12 2015 +0200

    Tests are moved to rabbitmq-test

commit 93d830ee5a3f94477de2c8c4a216d71ad729dad0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 1 18:30:45 2015 +0200

    rabbitmq-env: Use deps/rabbit_common in ERL_LIBS
    
    ... if there is no dist.
    
    Also, export ERL_LIBS.

commit 2a2e302557c45a857acc909dd55e9775c288d5a1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 1 14:23:33 2015 +0200

    Start rabbit_common on boot

commit 920eb60269855e462aeac0d2dcfd15889001157d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 1 14:23:14 2015 +0200

    rabbit_plugins: Do not consider rabbitmq-common as a plugin

commit 0b4131479931e2fb88d083ba7f812cee14018659
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Sep 1 10:48:13 2015 +0200

    Makefile: Take rabbitmq-common from GitHub

commit b28fbfce63963edc060927f641cbb00f9944fc50
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 31 11:26:39 2015 +0200

    Define ERL_LIBS when RabbitMQ runs from its source directory

commit d68b63fafcd35f5d180541c1b8bb0fa534e7bc1b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 18:28:29 2015 +0200

    Use `$(DEP_PLUGINS)`

commit 0f1efd266866ff7af9492425e4ec718867ccb98a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 18:28:16 2015 +0200

    Update erlang.mk

commit 866a755344f479ebfdf7cdd6b763b9de570327cf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 18:09:11 2015 +0200

    `make run*`-related targets were moved to rabbitmq-run.mk

commit 153eac10f0c374d568cead74db3843efc0728246
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 11:32:44 2015 +0200

    Makefile: Use the rabbitmq-run.mk plugin, not -dist.

commit c3ff397dbda7d10fed6f0e6c2e6f4a3d080d3204
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 09:03:25 2015 +0200

    Git: Ignore /dist

commit 556f6e0bb1f38e32495b9941c8c78d368fb62c5f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 27 17:12:32 2015 +0200

    Use rabbit_common .ez archive instead of deps/

commit 10bf6e442bdfd2cd0604181f21ad4840321568e3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 27 14:57:11 2015 +0200

    Update erlang.mk

commit 0e1c78b3beb6a6c4ce867d751912c5cd1f84e2fc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 18:40:11 2015 +0200

    Git: Ignore /doc and /logs

commit 0f44fd8c768c7faeb9c50960848e8e8edcaf3df7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 18:34:52 2015 +0200

    Update erlang.mk and disable `edoc` plugin

commit 38184c99dcc0575a4d0baaeb8926a425ad362893
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 17:46:35 2015 +0200

    `rabbitmq_common` is now `rabbit_common`

commit 633fc492cdceac1efc049122d5f3d887cf05e998
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 16:53:21 2015 +0200

    Use EXTRA_SOURCES for `*_usage.erl`

commit 4602951aad8af58716a8fc932a3bcf1221fef66a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 15:52:37 2015 +0200

    Style

commit c9697b35064eae7ae615134159c4aebb78111156
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 12:24:11 2015 +0200

    Update erlang.mk

commit cfc78f8e6bbc7cfe4dcc08cc20367e3ea56aa926
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 25 12:23:46 2015 +0200

    Makefile: Add targets to run RabbitMQ

commit bdf8a64f555c57ca9a47eb0299b56a87f4183e86
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 24 16:43:05 2015 +0200

    Git: Ignore *.beam

commit 8466f2e40bb6d80156ffc0a65bcf5485334a1993
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 14 12:21:42 2015 +0200

    Makefile: Set TEST_ERLC_OPTS

commit 2b0d50730dc0d531e2d05336b0e00a24e64370bf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 14 12:20:51 2015 +0200

    Git: Ignore generated documentation

commit 8dd4eb8f5fb42a3c441852a2af30a3b0e657d5a8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 19:01:27 2015 +0200

    Makefile: Sort content a bit

commit d1fce2e9ab033221fbb31a893a57ae38b475dd21
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 18:48:53 2015 +0200

    Makefile: Connect manpages to the build

commit 75e07313179f6fa6ee06320e842a59917c37f50c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 18:48:38 2015 +0200

    erlang.mk: Disable EDoc generation

commit b0ba76d69234585ddc2976a9c2aec2a4d9609a9b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 18:48:17 2015 +0200

    erlang.mk: Apply experimental speed improvements

commit 42099a5d99e7133d2e45f6195625feed1f9d8517
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 17:54:06 2015 +0200

    Use $(ERL) from erlang.mk

commit fa1d8ae0d58160f59a0c2bf4cf5232c7e2ae5326
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 16:52:10 2015 +0200

    Makefile: Resolve $(USE_PROPER_QC) only when needed

commit 266853faa151ceb5193e27f6d43a1ed981b9f59d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 16:50:43 2015 +0200

    Makefile: Use `erl -version` to do ERTS version tests
    
    This is way faster than starting a full VM. Use awk to perform the
    comparison.

commit 01d8cb1a7853ec050f8ef170c259d3fc9babf451
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 12:47:13 2015 +0200

    Add $(gen_verbose) in front of generated sources

commit 0e173fd162450c815af168da388675bc1c14e118
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 13 11:08:27 2015 +0200

    Makefile: Compile behaviors first
    
    Also, use Erlang atoms when naming dependencies.

commit 387d304df8b0122f160f1374f32e244c47efe279
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 12:02:11 2015 +0200

    Update .gitignore

commit 03cf28142b5beb5d09399b49d3b58ed6d458b79f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 12:01:15 2015 +0200

    Move .app file to src/

commit 95d131844a23f08bac0d49262c4da55fedc9034c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 11:58:03 2015 +0200

    Move headers to rabbitmq-common

commit e3b6e1e1b545a20b6c1ec9d8c55d12406325d139
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 11:50:41 2015 +0200

    Makefile: Use `erlang.mk`

commit 31c9fdf6080b42684b27d6e7805f7ba6bfa38601
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 11:50:24 2015 +0200

    Move modules to rabbitmq-common

commit 7ce3113375c50b39cabe6fb24c71b25241f791d0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 11:41:25 2015 +0200

    Add `erlang.mk`

commit 88328fe18ee5ba1cb8a01797050cc1443669be5d
Merge: 0ee06c3a7 256c2218d
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 20 11:09:24 2015 +0200

    Merge branch 'stable'

commit 256c2218d423e3d43cecd8a805ff8bc9fb93074a
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Oct 20 11:09:00 2015 +0200

    description/0 is not a behaviour callback
    
    The -ifdef(use_specs) part was correct, but the -else part was incorrect
    compared to it.

commit 8cc4229802161d0ce4c30114a605f9e2539f413d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Oct 19 21:38:32 2015 +0200

    adds lazy queue tests

commit 0ee06c3a7ddafc440c08a1a376c6ab1864b501c9
Merge: aae969130 9d7d38b11
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 19 18:52:12 2015 +0300

    Merge pull request #367 from rabbitmq/rabbitmq-server-366
    
    fixes batch_publish_delivered for priority queues

commit 9d7d38b11a01d51c0fdcacbcd82b4bf2c75e6aaf
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 17 14:04:33 2015 +0200

    renames according to priority queue internal API

commit 0803568fdd84add533156001fef09e3c63727823
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 17 13:23:14 2015 +0200

    fixes rabbit_priority_queue:batch_publish_delivery/4

commit aae969130172ec5afc98a391f6f66a14cdd0a853
Merge: ea837c8b2 fedfefeba
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 16 14:05:58 2015 +0300

    Merge branch 'stable'

commit fedfefebaa39a0aeb41cf9328ba44c3a458e4614
Merge: 895f04863 fb87a25bf
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 16 14:05:32 2015 +0300

    Merge pull request #365 from bogdando/ra_ocf_ha
    
    Sync lost change from Fuel HA rabbitmq OCF fixes

commit fb87a25bf8a632a86f81e1b30163a8596148e628
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Oct 16 12:59:37 2015 +0200

    Sync lost change from Fuel HA rabbitmq OCF fixes
    
    Fix missed change for the return value from the fix:
    5097d94 - Bogdan Dobrelya, 3 months ago : Fix error return codes for rabbit OCF
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit ea837c8b2d11a5ad5ac0ec8e726e20832c1bed3d
Merge: 83826845f 895f04863
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 16 13:13:47 2015 +0300

    Merge branch 'stable'

commit 895f04863eb5450eddae6b5ac1a494bc2a082dea
Merge: 9b2566d5e 98fc9f7e2
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 16 13:12:43 2015 +0300

    Merge pull request #364 from bogdando/ra_ocf_ha
    
    Port Fuel fixes for the HA rabbitmq OCF

commit 98fc9f7e29eb57d1e0765420301db9d321657684
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Tue Oct 13 16:15:00 2015 +0200

    Port Fuel fixes for the HA rabbitmq OCF
    
    Sync OCF script changes and fixes from Fuel,
    version 8.0dev/9ca5b6709cd18c8134cd8feaccf937ef49a625b4
    Changelog brief:
    9ca5b67 - Matthew Mosesohn, 8 days ago : Wait for rabbitmq sync before stop/demote actions
    00a6a01 - Davanum Srinivas, 4 days ago : Avoid division operation in shell
    c1900b4 - Dmitry Mescheryakov, 4 weeks ago : Start RabbitMQ app on notify
    00f28b5 - Vladimir Kuklin, 4 weeks ago : Return NOT_RUNNING when beam is not RUNNING
    2707a5e - Dmitry Mescheryakov, 7 weeks ago : Make RabbitMQ OCF script tolerate rabbitmqctl timeouts
    403b28c - Bogdan Dobrelya, 6 weeks ago : Detect a last man standing for rabbit OCF agent
    60d5743 - Victor Sergeyev, 7 weeks ago : Add more logs to rabbitmq get_status function
    11c4e4c - Alex Schultz, 9 weeks ago : Fix rabbitmq data restore for large datasets
    8ccdfc6 - Stanislav Makar, 6 months ago : Implement the dumping of rabbitMQ definitions
    5097d94 - Bogdan Dobrelya, 3 months ago : Fix error return codes for rabbit OCF
    b5ae83a - Bogdan Dobrelya, 3 months ago : Fix chowning for rabbit OCF
    bf604f8 - Bogdan Dobrelya, 4 months ago : Restart rabbit if can't list queues or found memory alert
    
    Co-authored-by: Matthew Mosesohn <mmosesohn@mirantis.com>
    Co-authored-by: Davanum Srinivas <dsrinivas@mirantis.com>
    Co-authored-by: Vladimir Kuklin <vkuklin@mirantis.com>
    Co-authored-by: Dmitry Mescheryakov <dmescheryakov@mirantis.com>
    Co-authored-by: Victor Sergeyev <vsergeyev@mirantis.com>
    Co-authored-by: Alex Schultz <aschultz@mirantis.com>
    Co-authored-by: Makar Stanislav <smakar@mirantis.com>
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit 3b1321a9082b5a574c92a11ea6cf8725588eebda
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 16 07:24:36 2015 +0200

    fixes queue transition from default to lazy

commit 06c3d2b0484fe9695aaac66edc2830c91041c507
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:59:04 2015 +0100

    Update to use list_formatted/1 for ordered display of policies.
    
    References #62

commit a6ceef958599f1c539f92da7bda7f96cb54a8ca4
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:53:39 2015 +0100

    Updates to call to rabbit_control_main:emitting_map_with_wrapper_fun/5.
    
    References #62

commit 20396c64ca74caa9696ea268a9cb1b991b08d652
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:52:15 2015 +0100

    Updates to call to rabbit_control_main:emitting_map_with_wrapper_fun/5.
    
    References #62

commit aa7ca9bfc8fe92be5ec52df1d21fcd27f7381093
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:50:37 2015 +0100

    Updates to reference rabbit_control_main:emitting_map_with_wrapper_fun function.
    Adds map_fun/0 helper function.
    
    References #62

commit ab7eeed0a1d2d6088da911a26bd6492ac31b9fe0
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:48:53 2015 +0100

    Adds emitting_map_with_wrapper_fun/5 and emitting_map_with_wrapper_fun/6.
    Fixes handling of emitted messages which use 'continue' tag.
    
    References #62

commit 6e98d2bb478d95fdf0efdacdd831ab88df9f8a35
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:21:11 2015 +0100

    Changes call to timeout_tests, to rabbit_ctl_timeout_tests following
    module renaming.
    
    References #62

commit 111717bd3b0de9222e2ce584fc9bf1f49fe36be4
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Oct 16 01:16:49 2015 +0100

    Renames timeout_tests.erl to rabbit_ctl_timeout_tests.erl.
    Removes unused imported functions.
    
    References #62

commit 83826845f895990a369311926bdaa82ab2de338c
Merge: aea0de278 d37e6fe32
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 15 20:20:18 2015 +0300

    Merge pull request #361 from rabbitmq/rabbitmq-server-63
    
    Adds net_ticktime to rabbitmqctl status output.

commit d37e6fe326b79132d1da1df23ddf364cb637cb9c
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Oct 15 14:56:26 2015 +0100

    Adds net_ticktime to rabbitmqctl status output.
    
    References #63

commit aea0de2788070dc5ea08bb9d1835850b1d71b15f
Merge: 2cdf0c174 9b2566d5e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Oct 14 16:11:51 2015 +0300

    Merge branch 'stable'

commit 9b2566d5e8f2b869a88cb8d9a1b9e9158c749587
Merge: 6f02f3cb0 113054667
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 14 16:11:22 2015 +0300

    Merge pull request #360 from rabbitmq/rabbitmq-server-84
    
    Move rabbit_mirror_queue_misc:all_nodes/0 to rabbit_nodes:all_running/0

commit 113054667dbb4177d60eebee067fe2afec89fd13
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Wed Oct 14 10:15:11 2015 +0100

    Move rabbit_mirror_queue_misc:all_nodes/0 to rabbit_nodes:all_running/0

commit c9ecb00da9c41004630c2a74da884dd399b6d5cf
Merge: b57fd4935 2cdf0c174
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 10:17:43 2015 +0200

    Merge branch 'master' into rabbitmq-server-351

commit f3f362a7c006534fd4f0929648c48097956f2e31
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 14 08:39:31 2015 +0100

    Fixes indentation.
    
    References #62

commit 2cdf0c174217970ba6912de225f1b19229948964
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 09:14:47 2015 +0200

    fixes gm_qc API

commit 5e4b03ccbdc35f353622fa6adda2909835f3ec05
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 09:06:14 2015 +0200

    fixes QuickCheck tests for rabbit_backing_queue_qc

commit b57fd49355334875ce5f2a47e83357e210f632d5
Merge: 6c3de1303 2a8965162
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 08:32:41 2015 +0200

    Merge branch 'master' into rabbitmq-server-351

commit 2a8965162129d1af95683a6a737017f4b6eea157
Merge: 63eccd863 db51b4613
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Oct 14 09:09:30 2015 +0300

    Merge pull request #359 from rabbitmq/rabbitmq-server-358
    
    fixes failing test

commit 6c3de1303e4a1175fa3e222ff7a47a83cb258bbc
Merge: ee19ec06d 63eccd863
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 07:45:50 2015 +0200

    Merge branch 'master' into rabbitmq-server-351

commit db51b46135e591c0925411e0076e089eecdeb789
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 07:19:48 2015 +0200

    fixes failing test

commit 63eccd863a493795a92941af3be41af364e1d637
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 06:51:36 2015 +0200

    fixes batch_publish tests

commit 26531e144ef530e74816af869bf23a53c7374684
Merge: 038167f4d 6f02f3cb0
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 04:44:57 2015 +0200

    Merge branch 'stable'

commit 6f02f3cb0e6e2d5669c4998e0eed21bcc72fc37b
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 04:28:36 2015 +0200

    restores the rabbit_variable_queue tests
    
    This line
    https://github.com/rabbitmq/rabbitmq-server/blob/master/src/rabbit_priority_queue.erl#L78
    sets the rabbit_priority_queue as the default rabbit_backing_queue
    which had the side effect of disabling the tests for the
    rabbit_variable_queue

commit ee19ec06d56bc73a8ba542f9202ba7a7f5bccc56
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Oct 14 01:40:19 2015 +0200

    fixes stats/delta handling on publish_delivered

commit 963953842918a287df05dd8c9dbe712835b116e7
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 23:54:40 2015 +0200

    fixes stats for lazy publish delivered

commit 1539be4261a7c60fc062485c0911ca4fc3bbb79b
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 23:43:43 2015 +0200

    cosmetics

commit c4f5e57d7bb8c803ceaff720cb301f83a2f1735c
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 23:43:30 2015 +0200

    brings comments up to date

commit a647ec7a7e2199cf1d1165b8a813badeca220876
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 21:25:10 2015 +0200

    fixes in_r/2 implementation for lazy queues

commit 587c66a1c16f221feee3c8134627257892e16430
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 20:56:26 2015 +0200

    updates state assertion function for lazy queues

commit 24eff3e741bc2b5a5f8f75e07ae604044381cda9
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 20:50:31 2015 +0200

    makes sure convert_to_lazy terminates

commit 4f936195ddda26337bc858c18163b1593468c1b6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 20:49:45 2015 +0200

    fixes call to queue stats from publish

commit 1f38a7e780f8730bc5d8ea421c85e8ebd2c355ef
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 16:05:22 2015 +0200

    implements requeue for lazy queues

commit 9257e753216065c5183be92d1cc086d24aabefa6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 16:01:42 2015 +0200

    do not code with headache

commit 038167f4d036b2e4e44b7a501af890b2d402281f
Merge: 3ff2d9810 5e6625e81
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 13 16:42:26 2015 +0300

    Merge branch 'stable'

commit 5e6625e8195b9c9117ae1701089ffcaead81c08f
Merge: 9a4bfaa6b 46c8f80f1
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 13 16:35:50 2015 +0300

    Merge pull request #356 from bogdando/ra_ocf_ha
    
    Ra ocf ha

commit 24bd20b0f87331975ba639f6a77d1d389e425aa0
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 15:31:41 2015 +0200

    adds mode to backing_queue_status info

commit 362fe50320fde390cc50f66cb80915abdc5a7aa3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 15:07:03 2015 +0200

    implements lazy publish delivered

commit 4153515adf6d2082b7ceff16d9e2a86726838335
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Oct 13 12:56:12 2015 +0100

    Changes internal_user_filter/1 name to extract_internal_user_params/1.
    Changes user_permission_filter/2 name to extract_user_permission_params/2.
    Restores TODO comment.
    
    References #62

commit d1dabd10cf8bf2eb8dbb0c753c0de403ed76215e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 13:25:41 2015 +0200

    uses binary_to_exisiting_atom when handling queue mode policy

commit 053ecde04549a1659881272cb895e794c8dfe9db
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 12:01:01 2015 +0200

    fixes unused var warning

commit b1de0a87078b3f9309598e2c8b2aa7f8a6555cfc
Merge: 8f2bc0848 44a0ddb72
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 13 12:00:39 2015 +0200

    merge master into rabbitmq-server-351

commit 3ff2d98109c2a769ceadcc5f21c6b53e3bccfe70
Merge: 1a24c9bb8 9a4bfaa6b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 13 12:27:42 2015 +0300

    Merge branch 'stable'

commit 1a24c9bb842a59e16c2b70ed45ee9f960c033cd1
Merge: 44a0ddb72 545816528
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 13 12:27:06 2015 +0300

    Merge pull request #355 from rabbitmq/rabbitmq-server-112
    
    Read memory monitor interval from configuration

commit 545816528f972f9b1c01eba12dead5de899bd2df
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Oct 13 12:26:50 2015 +0300

    Missing comma

commit 87402fad7fe68be84395d4ea8907b6591019357c
Author: Diana Corbacho <diana.corbacho@erlang-solutions.com>
Date:   Tue Oct 13 09:57:12 2015 +0100

    Read memory monitor interval from configuration

commit 9a4bfaa6bb5571246a82266e94050965b467a03f
Merge: c232c3ea0 872074a00
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Oct 13 11:14:20 2015 +0300

    Merge pull request #354 from Jakauppila/rabbitmq-server-354
    
    Allow ERLANG_HOME to be overridden from rabbitmq-env.bat

commit 872074a0029909c760dcae831a439a765b86b8e1
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Mon Oct 12 21:33:11 2015 -0500

    Move call rabbitmq-ev.bat
    
    Moving the rabbitmq-ev.bat call above the ERLANG_HOME check. This grants the ability to override ERLANG_HOME within rabbitmq-env-conf.bat.

commit 34cb453de802bc921de7ffe5727caeaee0579867
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Oct 12 18:22:10 2015 +0100

    Adds call/4 to default ToBinUtf8 to 'false' when calling call/5.
    Updates some list_* action functions to use call/4.
    
    References #62

commit 44a0ddb72dc0337235bcecf63878658bac4288a4
Merge: 63cc2bb93 dc7293560
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 12 20:01:11 2015 +0300

    Merge pull request #344 from rabbitmq/rabbitmq-server-336
    
    Implements Mirror Queue Sync in Batches

commit d5b56ffc9e91aa35771baefe9fae1245af48a114
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Oct 12 17:42:45 2015 +0100

    Fix to call list_down/1 instead of list/1
    when listing down queues.
    
    References #62

commit dc72935607e5bf6c563556139ea6992899b8520a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 12 17:19:55 2015 +0300

    Move this constant closer to the only place it is used

commit e17a5e256c353e0a1f3a7239163cee0a16d955e3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:37:10 2015 +0200

    removes non batch-sync code path

commit 1a08f21c0b6161a39628424f20b632139958975f
Merge: 192953364 ed516d462
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:28:03 2015 +0200

    fixes conflicts

commit 192953364736aff37b00e17ae1952588a1cfc896
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:26:07 2015 +0200

    refactors message sync'ing in batches

commit b43b3b9ba8ea60651dbae86e81f2da4ddf9f67a4
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:24:54 2015 +0200

    send msg batch in proper order

commit 1a0a00c2bc3a9b1562c287330c689a36641822b2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:23:44 2015 +0200

    get into account unacked messages when syncing

commit 0646e9d9b74bbc430ea8042abcf98f1e61bde61d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 23:22:38 2015 +0200

    adds default sync batch size on the app config

commit ed516d4622d04ff79d56a9c0a303dd546f26c20f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 10 19:07:58 2015 +0300

    Clarify this comment

commit fbc7ff540c30e6734f87c19fe09197124fdcdabb
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 18:01:41 2015 +0200

    removes unused constant

commit 8f2bc0848376f15a745e3a9879b3a47504f440db
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:54:14 2015 +0200

    publish/6 for lazy queues

commit a3490dc3acd3a624f0cc51ece84ebcd65fb9235e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:53:43 2015 +0200

    queue_out/1 for lazy queues

commit 69554ab2789e33ff09f514cb9457f92f674347f3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:52:53 2015 +0200

    in_r/2 for lazy queues

commit 31102cc85049706f39fed64f0ad1673eda5ab7bc
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:51:32 2015 +0200

    paging for lazy queues

commit 9bf9a6a6380273e648cb1867378707340dd80597
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:49:53 2015 +0200

    variable queue state assertion for lazy queues

commit a9462aa8144cb3afe68054f01495b2296f40136e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:40:23 2015 +0200

    handles queue-mode policy/argument

commit 06cde9069282cbb6169da10352ddff8f82825feb
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:36:38 2015 +0200

    adds x-queue-mode argument

commit 78278184dbc5c9269fa28ff2fe80e09df1187dba
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 10 17:35:50 2015 +0200

    adds queue-mode policy

commit 199d5a96e8d492de14ae4a6410163a927be84272
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 10 15:08:07 2015 +0300

    Wording

commit c863a81e480fcfe08271588d9e630e3e782939f6
Merge: 215dac355 1a7db7371
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 10 13:37:08 2015 +0300

    Merge branch 'master' into rabbitmq-server-336

commit 63cc2bb9391a34901de50b092f59045b1daf9289
Merge: 379258b9d c712c3a6e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 10 01:18:47 2015 +0300

    Merge branch 'rabbitmq-server-270' (again)

commit c712c3a6eb024260b33ceff698150483bcf324e3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Oct 10 01:14:00 2015 +0300

    Fix migration from 2.1.1

commit 379258b9d9ff7d9c52c1fd1fe05e76d0d3a9120d
Merge: 91d032439 c232c3ea0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 9 16:17:28 2015 +0300

    Merge branch 'stable'

commit c232c3ea056e949df8473f29878373e2d293218d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 9 16:16:47 2015 +0300

    Use a public-facing email address

commit 91d032439502cf4b080213c480316de725e8d848
Merge: 1a7db7371 1d31f7151
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 9 16:16:23 2015 +0300

    Merge branch 'stable'

commit 1d31f7151d55c13856c84cc3b138f5b217241776
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 9 16:13:29 2015 +0300

    Update Debian metadata
    
     * to not use "AMQP" as there are 2 versions in use today
     * to be a bit more humble in the description
     * to have up-to-date (and future-proof) contacts

commit 1a7db7371fb0eb537c259f593b30ffb5ee9145f5
Merge: 4eff6cf0c 1ea3cacdc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Oct 7 20:10:14 2015 +0300

    Merge branch 'stable'

commit a68b8565a8d3092616ec78ce7fbf1d562354414a
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 17:16:26 2015 +0100

    Removes explicit 'ok' return.
    
    References #62

commit b209bf307000864e6370a1c37c7c73f4a17045f9
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 16:51:54 2015 +0100

    Changes socket to passive.
    Adds verification of AMQP connection - checks if AMQP method is replied back,
    with no open channels.
    Replaces timer:sleep(100) by setting timeout in gen_tcp:recv/3.
    
    References #62

commit 6f3a691bfcea075d37e1d9702e2e854a2c5e4c01
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 16:46:55 2015 +0100

    Update to use abstraction function rabbit_control_main:emitting_map/4.
    
    References #62

commit b4bc2f69df46b3bb4faec63c381cd8f1ad3d3504
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 16:44:00 2015 +0100

    Adds emitting_map function to abstract aggregator logic for all list_* backend operations.
    Adds {Ref,  continue} to handle display of more results before finishing.
    Removes unsed function call/3.
    
    References #62

commit 9f8db9d54e0f568f56aa198e7aaea247f8b1df8f
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 16:42:10 2015 +0100

    Update to use abstraction function rabbit_control_main:emitting_map/4.
    Updates list_permissions/2 to use user_permission_filter/2.
    Updates list_users/0 to use internal_user_filter/1.
    
    References #62

commit d410cb6c5cea6e4f89032dc2dddffba8bddda101
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Oct 7 16:37:13 2015 +0100

    Updates to use abstraction function, rabbit_control_main:emitting_map/4.
    Updates existing consumers_all/1 to also use get_queue_consumer_info/2.
    Fixes indentation.
    
    References #62

commit 1ea3cacdc04134cc3cb91652e54a64ba476658b6
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Oct 7 16:34:47 2015 +0100

    Commit 3.5.6 package release notes

commit 8ecf489362abde0f63480b9681056a01609e063d
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 14:52:03 2015 +0100

    Removes duplicated code in rpc_call/7.
    
    References #62

commit 8c6b06b0e86b82fcbd3801b489550baf31cf3efd
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 14:09:40 2015 +0100

    Removes TIMEOUT_LIST_OPS_PASS macro. Now used in 'timeout_tests' module.
    
    References #62

commit 1c1d93f2a6d024168dcfdafe75a69623d0ebc67a
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 12:47:13 2015 +0100

    Adds boolean parameter to call/5 to determine whether
    list_to_binary_utf8/1 is applied to Args.
    Moves spawning of rabbit_cli:rpc_call/7 to call/5.
    Moves calling of wait_for_info_messages/4 to call/5.
    
    References #62

commit a97260c1905d7aecf6916071607a8bb770ef7dc9
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 12:28:40 2015 +0100

    Moves 'rabbitmqctl' timeout successful tests to separate module.
    
    References #62

commit 6d3ef5aa75fd45f4788085b8f89dc8b4e2697123
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 11:30:00 2015 +0100

    Update to print command when invalid parameters are passed.
    
    References #62

commit 4a10191e3651eab8ba310dd8234fd293a79e03e8
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 11:24:03 2015 +0100

    Moves mapping and response message sending to list_formatted/3.
    
    References #62

commit aaf06adf5509dd4b10367fb6c782548ecf7101d6
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 25 09:57:57 2015 +0100

    Updates consumers_all/3 to get consumer info in seperate function.
    
    References #62

commit 829ce0d0cb8b1e217036eea98648a2b1c125f8b7
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Sep 14 17:31:07 2015 +0100

    Removes append operation on result list.
    
    References #62

commit d5d2c7dbdab5738f2d25f4ca0dce2be35b761339
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Sep 14 16:46:06 2015 +0100

    Removes 'don't care' sign on Ref variable.
    
    References #62

commit e5ef1d752453943560bc153325f2033891563a49
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 11 15:36:04 2015 +0100

    Function name change of wait_info_messages.
    
    References #62

commit a318b5bf8679ade3d54e86f43eaa9c045a5a68a9
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 11 15:30:20 2015 +0100

    Updates 'Pid' variable to 'AggregatorPid'.
    Updates info_all/3 function and spec.
    
    References #62

commit ebab0f780bbdeb41565c3759f3aca44a892b1a57
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Sep 11 15:27:00 2015 +0100

    Updates 'Pid' variable to 'AggregatorPid'.
    
    References #62

commit 31eaf2f177260b194ddf62c7f6deb019ce8d3d60
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Sep 9 16:17:08 2015 +0100

    Updates rpc_call function spec.
    
    References #62

commit 7d8af0eea84e60358d951fc24ac5d51713e54f5f
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Sep 9 16:15:56 2015 +0100

    Updates info_all/4 function spec.
    Updates consumers_all/3 function and spec.
    
    References #62

commit 7049d834d07fd40afac221ccaee91762d2d4a8a3
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Sep 9 14:50:26 2015 +0100

    Removed TODO comment.
    
    References #62

commit 67d44a48a0cebe0b11bb8b881d6023278218ee1c
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 17:22:45 2015 +0100

    Adds info_all/3 for dynamic display of vhosts.
    
    References #62

commit 8320c4d3e477921de62ebe9e5502fec31b8c0455
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 17:13:34 2015 +0100

    Adds list_formatted/3 for dynamic display of parameters.
    
    References #62

commit c6e9ec2691c117094535329026a1454167e7cfd3
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 17:02:59 2015 +0100

    Adds list_formatted/3 for dynamic display of policies.
    
    References #62

commit 84b91e200f57c899acac7a2bc5a571ddbd9c8abe
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 16:56:57 2015 +0100

    Adds connection_info_all/3 for dynamic display of connections.
    
    References #62

commit ed1a42feb501e7d03f9386ddda5631e93bde1fdc
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 16:50:29 2015 +0100

    Adds info_all/4 for dynamic display of exchanges.
    
    References #62

commit ae305dc2ad51be7d8aa2ef803edbfe49e7334231
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 16:44:33 2015 +0100

    Updates list_* operations to dynamically display info.
    Adds notify_if_timeout/3 for terminating display of info process on timeout.
    
    References #62

commit 383defe127d93b13fc7b1ec10a977a5e8f43f189
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 16:14:43 2015 +0100

    Adds rpc_call/7 for remote calls for dynamic listing of info.
    Adds 'function_clause' case match to handle commands with invalid parameters.
    
    References #62

commit 19fa31319b4e50e207d59d668c6ec4fbcf2052c0
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 15:04:21 2015 +0100

    Adds info_all/3 for dynamic listing of channels.
    
    References #62

commit 4dd0bc19277187ff1012c02dd160b33eff54c9d8
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 14:57:10 2015 +0100

    Adds info_all/4 for dynamic listing of bindings.
    
    References #62

commit 4418d46470344a36312c44ed1c6a680d89b15456
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 14:41:58 2015 +0100

    Adds list_users/2 for dynamic listing of users.
    Adds list_user_permissions/3 for dynamic listing of user permissions.
    Adds list_vhost_permissions/3 for dynamic listing of vhost permissions.
    
    References #62

commit 58733568bac91c141911a12c03c653c7d27ce2d0
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Sep 8 14:31:00 2015 +0100

    Adds info_all/4 for dynamic listing of queues.
    Adds consumers_all/4 for dynamic listing of consumers
    
    References #62

commit 4eff6cf0cb5b08ba829b20aa1a95f6f87f9c7c05
Merge: b0d5818c5 3a08998fc
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 6 16:29:38 2015 +0200

    Merge branch 'stable'

commit 3a08998fcf7977d43c0645b8c6bf6a62382c9eee
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Oct 6 16:29:13 2015 +0200

    fixes check_xref for erlang:max

commit b0d5818c584383fb1a90e14d6975c52b8b771435
Merge: cba94b127 6a65e1343
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 5 21:55:56 2015 +0300

    Merge branch 'stable'

commit 6a65e1343bb1412f2c99366712b8eb593b73659f
Merge: e09b99351 0f7eb9d44
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 5 21:47:43 2015 +0300

    Merge pull request #345 from rabbitmq/rabbitmq-server-338
    
    Collect tags from all authz backends

commit 0f7eb9d44040d5147cbb5a6646aa69d3afe1f9d8
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 5 21:45:32 2015 +0300

    Cosmetics

commit 08047a37bf3dde5b127f73bead207009e816856a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 5 21:00:21 2015 +0300

    Cosmetics

commit afe6a0e9c6350a7fb622a8a9b06f7b70a612fbf0
Author: Robby Raschke <robby.raschke@erlang-solutions.com>
Date:   Mon Oct 5 18:13:22 2015 +0200

    Have the callback spec be backwards compatible.

commit 32281bd205c20e3eca82077416dbd553a7e1733a
Author: Robby Raschke <robby.raschke@erlang-solutions.com>
Date:   Mon Oct 5 17:53:55 2015 +0200

    Be backwards compatible for homegrown auth modules.

commit 215dac355a77c4e2f87a98aee998693c98d37349
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Oct 5 02:37:31 2015 +0200

    restores new line

commit 3776634e0da41f2d2b8888a33ce34b3010b238d2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Oct 5 02:36:35 2015 +0200

    improves comment

commit e0bb5df5b5ee83e6542df4471ffe3dfd695deb04
Merge: 7f27f432c cba94b127
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Oct 5 00:28:12 2015 +0200

    Merge branch 'master' into rabbitmq-server-336

commit 7f27f432c2ac97a7cc12b57d652a522d4b9293cf
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 23:51:59 2015 +0200

    off by one error

commit b6f44d6a25ee2605a5eff5ca36ab52fa0e669f28
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 23:43:00 2015 +0200

    fixes arguments passed to batch_publish_*

commit b813c420d7f00e7410bcff901a366356cf61dd12
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 23:42:26 2015 +0200

    cosmetics

commit 332c389a308cd0e6679d434ea709b4490f33f721
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 23:41:45 2015 +0200

    improves comment about sync batch order

commit 474520d049be58a0049b47a70cfe1c4a255ca248
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 23:40:43 2015 +0200

    fixes retrieving sync_batch_size from policy

commit 7cdd8c725ba484e40e55322c0066673196e08709
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 13:22:33 2015 +0200

    fixes failing test

commit cba94b12742f436ddf423c432a2fb429961909bf
Merge: a4ff2a86c e09b99351
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Oct 5 00:26:27 2015 +0300

    Merge branch 'stable'

commit e09b99351721b7498f8fe0afc2fbae76aa6840ef
Merge: fbaf08d11 820b709d6
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Oct 5 00:26:10 2015 +0300

    Merge pull request #334 from rabbitmq/rabbitmq-server-324
    
    Fixes log handlers breakage since 18.1

commit 90c02443cc685424108dd88dd59d614a556b6820
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 4 12:40:27 2015 +0200

    adds batch publish tests

commit 8076b1bd9ca5385c668bc979d12d19f0ce7dc9fa
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Oct 3 00:32:12 2015 +0200

    implements batch publishing for priority queues

commit 5c2d50deed094e2e6e07990793bc8b09739a34c9
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 23:24:47 2015 +0200

    implements batch publishing for mirrored queues

commit 820b709d6d713a37ca0998d620c04a23336ca040
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 15:22:46 2015 +0200

    uses rabbit_misc:version_compare/3 this time

commit ccae00a253236f817587e9145e8fc1e85cbf9fd1
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 00:48:51 2015 +0200

    adds explanation

commit e8fe201e57a045ecc9082ebbd492eab5fa99984e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 00:46:29 2015 +0200

    cosmetics

commit 0e89449e39f1538c00bceae0dc340833dc1a0fab
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 00:40:04 2015 +0200

    refactors shared logic

commit d480e1db524df32680ccd66efd7cef56520199a9
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Oct 2 00:38:39 2015 +0200

    oops

commit 701ee991cee61160d569277213a94c0d5b90c283
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Oct 1 23:57:53 2015 +0200

    refactors msg broadcast

commit 16509fe08fdc9c0d965d70131ea282b72dd8b192
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Oct 1 22:42:26 2015 +0200

    checks if the current OTP release is >= 18.1
    
    This is rather ugly. In the future once we have erlang.mk support we
    should use a semver libary instead.

commit ef2d3f3976d7a504326b2af46490625dcb25c3ce
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Oct 1 21:50:28 2015 +0200

    retrieves batch size from policy

commit a4ff2a86cfd926530760ef3e47000bc55e42e213
Merge: 189039574 fbaf08d11
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Oct 2 02:47:15 2015 +0800

    Merge branch 'stable'

commit fbaf08d111532a7b413732d2dd89571a0d4298a3
Merge: ea7a37519 8bbd6d1e2
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 2 02:46:53 2015 +0800

    Merge pull request #342 from rabbitmq/rabbitmq-server-341
    
    closes the journal handle before erasing the queue index dir

commit ea7a3751903601d2a1d31d4edfcbefc21fdb7d82
Merge: 6ce6cb3de 1df75264b
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Oct 2 02:00:50 2015 +0800

    Merge pull request #335 from rabbitmq/rabbitmq-server-316
    
    improves fetchwhile performance

commit 8bbd6d1e213eb1c2fb443223f5238925e4290516
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Oct 1 19:39:45 2015 +0200

    closes the journal handle before erasing the queue index dir
    
    Fixes #341

commit 5ec328dcb9ce0a7e711c7caf64f6c5be2790961a
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Oct 1 19:36:00 2015 +0200

    adds ha-sync-batch-size policy

commit 18903957448df7a1889b49cb528bd6b81a7abbf5
Merge: bd7cc49bc 6ce6cb3de
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Oct 1 11:00:24 2015 +0800

    Merge branch 'stable'

commit 6ce6cb3def0cf68e084562d2e9e009f37706b256
Merge: 31a4b251e 6c390df86
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 1 10:59:11 2015 +0800

    Merge pull request #339 from rabbitmq/rabbitmq-server-290
    
    forces GC after queue paging

commit bd7cc49bc3fb418e783206d7015c3e327ed7a8f3
Merge: c5dc37f9b ce514ace2
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Oct 1 10:45:33 2015 +0800

    Merge pull request #329 from lshift/initial_frame_max
    
    allow initial frame_max to be configured

commit 6c390df864567d26aeb84a2d1be2ec162249991e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Sep 30 21:13:17 2015 +0200

    forces GC after queue paging
    
    See malingin list discussion linked in #290
    Fixes #290

commit 255a4951e0bc9a486d11044dacf8b0ecdac79ffb
Author: Robby Raschke <robby.raschke@erlang-solutions.com>
Date:   Wed Sep 30 11:41:02 2015 +0200

    Add the return tags element into the behaviour callback spec for authorization backends.

commit 0f8947bebed309cff647a8ae566ef9f8ccf6fd5b
Author: Robby Raschke <robby.raschke@erlang-solutions.com>
Date:   Wed Sep 30 11:35:14 2015 +0200

    Add the permission tags from an explicit separate authorization step into the user record.

commit 676e4137e88e08d0a845f5dd9f2ea78650d4eb00
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Sep 29 00:42:42 2015 +0200

    implement mirror message sync in batches

commit f30aaa32cf9f3cd43e9531636f323a726812428a
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Sep 29 00:41:51 2015 +0200

    implements BQ:batch_publish and BQ:batch_publish_delivered

commit 032b653adc113d91df3fdd12002401f65bfb99f5
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 28 14:51:57 2015 +0200

    simplifies delete_log_handlers test logic

commit 1df75264be00f3582e1012b6b95544060d30621c
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 28 04:32:20 2015 +0200

    improves fetchwhile performance
    
    Fixes #316

commit c5dc37f9bb70a2daf95e79cc5248fdc9bbe229fb
Merge: e35e05833 31a4b251e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 21:09:53 2015 +0200

    Merge branch 'stable'

commit bafea4db67620955e217cc2fff54e2db7b782803
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 19:08:46 2015 +0200

    fixes tests

commit 4027ba3e49f5ae4371ddda56789150f175d8ca63
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 18:02:10 2015 +0200

    fixes log rotation

commit 30570ce331f27b9ac33c6d2fa68fe912c3a249a3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 18:01:46 2015 +0200

    fixes OtpVersion handling

commit e972acfaa601554c693fa0baa825be5b7326f5f6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 17:46:35 2015 +0200

    cosmetics

commit 46435e52903e446cd7afab0abb78301f3c5beb07
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 16:17:19 2015 +0200

    initializes logger state depending on OTP release

commit 31a4b251e4ce303458031d09f29730a8c27aff6d
Merge: 3136aa257 b2a63a047
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Sep 25 15:39:36 2015 +0200

    Merge pull request #331 from rabbitmq/rabbitmq-server-330
    
    Adds documentation for credit_flow usage

commit b2a63a047c598fccd2fe020c7128e5344efbcec7
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 15:16:28 2015 +0200

    typo

commit 9a15c76e3c8043a7d8416d2c8929724759f15392
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 15:07:06 2015 +0200

    clarifies sentence

commit 5be0f6429e3aff2977d95a15ba0e3bab4cc8bf8e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 14:59:13 2015 +0200

    typo

commit e0a5c0051e22c5bd29b54a9aedca2f95d07ea2ab
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 25 14:54:41 2015 +0200

    adds documentation for credit_flow usage

commit ce514ace295baa88270a0dbfc075f106e966e2f8
Author: ash <ash@lshift.net>
Date:   Fri Sep 25 12:52:51 2015 +0100

    allow initial frame_max to be configured

commit 14eb2802c798cc076fa6add331b4c8043056338f
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Sep 24 23:50:30 2015 +0200

    handles the error logger state change introduced in Erlang 18.1

commit e35e05833ad9a36f7461e94f59666b16083cc984
Merge: a73630513 3136aa257
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Sep 24 21:44:24 2015 +0200

    Merge branch 'stable'

commit 3136aa25752542dfdbc7af3f77d8a66eb8d5d844
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 20:25:33 2015 +0100

    RPM/deb changelogs for release 3.5.5, package revision 3

commit 7e734a46c45478d060e26fe904389d8ad7393e67
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 18:59:40 2015 +0100

    Debian: Always build a source+binary package

commit 957e137792a2e0766329470535a5fdb4aff48288
Merge: 77c074b05 0105c77d4
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Sep 24 19:57:50 2015 +0200

    Merge pull request #327 from CVTJNII/rabbitmq-script-wrapper_quote-fix_stable
    
    Quote arg to prevent shell expansion, Issue-325

commit 0105c77d40a903118d58812c65e55adb12b3689e
Author: Tom Noonan II <thomas.noonan@corvisa.com>
Date:   Thu Sep 24 11:17:13 2015 -0600

    Quote arg to prevent shell expansion, Issue-325

commit 77c074b05a391852d91b2d5e563848281e1f6d23
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 24 13:40:07 2015 +0200

    rabbitmq-script-wrapper: Use '=', not '==' with Bourne shell's test

commit a736305139e7c42bb36a7509a4044f3c95e08614
Merge: 6964e8ac1 793d7bff9
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Sep 24 14:42:25 2015 +0200

    Merge branch 'stable'

commit 793d7bff97fefd25094fd0a93a3bc83c13da2f50
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Sep 24 12:56:35 2015 +0100

    RPM/deb changelogs for release 3.5.5

commit 6964e8ac1559cf76b9245394b46aaec5822f4178
Merge: 6abc15914 d93cfdbf9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 22 03:07:22 2015 +0300

    Merge branch 'stable'

commit d93cfdbf961c25e8b9c23692273b4640ef1e0f58
Merge: 47f3e1295 7fe2c61ac
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Sep 21 14:28:42 2015 +0200

    Merge pull request #318 from ben-page/stable
    
    Fixed support for arguments containing ` characters

commit 6abc15914fea8d1586adc67111cf58eb19e2eef6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 18 21:02:18 2015 +0300

    Compile with Erlang earlier than 18.0

commit fc65eba4e48320da6295e06a4dc71c543d0a1a3f
Merge: c6f2d4f3e 47f3e1295
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 17:57:50 2015 +0300

    Merge branch 'stable'

commit 47f3e12953892d58426c38a43aa99fdbd59415de
Merge: 0c9bf69dc 522d76495
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 17 07:46:48 2015 -0700

    Merge pull request #309 from rabbitmq/rabbitmq-server-308
    
    Improves dropwhile performance

commit 7fe2c61ac3764865b784dcf34131358dba0d722d
Author: Ben Page <ben.page@openreign.com>
Date:   Wed Sep 16 18:40:20 2015 -0500

    fixed support for arguments containing ` characters

commit c6f2d4f3e9085cfa9f667570e30297e33d354f5f
Merge: e8446a21d 290861c17
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Sep 17 16:53:41 2015 +0300

    Merge pull request #310 from rabbitmq/rabbitmq-server-270
    
    Introduce per-user hashing functions, default to SHA-256

commit 290861c1796f418ab74b688af860acef4125e375
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:53:00 2015 +0300

    Ditto

commit f62e117a0f10b249d52fcf8627a0e0c0011ee1d7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:52:21 2015 +0300

    Ditto

commit a3d5ae86bceb7181c8bb82991fabe129179ee887
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:51:32 2015 +0300

    Ditto

commit 8604b175fbba57b762179183a2d1ec683ea28f92
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:41:37 2015 +0300

    Do I even English

commit d38472413991be07086ffc4d0a9256f475cfd055
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:41:06 2015 +0300

    Ditto

commit a1f7e50ffe287139c04510933aeb54445d1ceed1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:40:41 2015 +0300

    Please formatting gods

commit 7c070cf81e28ea0fb6249bf417e0c36d5b028cfc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:39:10 2015 +0300

    Please code style gods

commit 69fa002aca02ae804eb550cb2ecfa46ba08079c9
Merge: 571f1a172 e8446a21d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:37:11 2015 +0300

    Merge branch 'master' into rabbitmq-server-270

commit e8446a21d053445aaa856e300960656dab9ada66
Merge: 76f9565ec 0c9bf69dc
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 16:18:24 2015 +0300

    Merge branch 'stable'
    
    Make credit flow setting a tuple, per discussion with @videlalvaro.

commit 0c9bf69dc9d96cfe4b100c289e7ef259caa74253
Merge: ef60743ac 0a44d9d91
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Sep 17 06:04:00 2015 -0700

    Merge pull request #306 from rabbitmq/rabbitmq-server-143-stable
    
    Backport configurable credit flow to stable

commit 571f1a1722674fcef8705b96051c84eabc1c9ca0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 17 14:23:53 2015 +0300

    Refactoring, per feedback from @videlalvaro

commit 9bfb85c26576d10331e4bee9c1602eb5844ffee3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 16 01:47:35 2015 +0300

    Add password_hashing_module to rabbitmq.config.example

commit 622a609e1939605efaf37e226a233741f263a3fa
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 16 01:29:56 2015 +0300

    Extract this test, per discussion with @videlalvaro

commit 323ca2a88b6df1ad1ecc2c048249424307069a27
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Sep 16 01:12:59 2015 +0300

    More tests

commit ae5eac5138470472950396fd9c30b899a1475aeb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 15 10:20:49 2015 +0300

    Correct password hashing fn migration

commit 76f9565ecc25357d894508f61e1d2864176de527
Merge: 2eec79191 ef60743ac
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Sep 14 18:16:32 2015 +0200

    Merge branch 'stable'

commit 9f4ce81d28278f14bc60754640769d49565a6060
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 14 15:30:53 2015 +0300

    Some unit tests for pluggable password hashing

commit bfc4891fb4817d2cabd9d9767e98b3ff6abefc65
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 14 10:26:16 2015 +0300

    rabbit.password_hashing_mod => rabbit.password_hashing_module

commit a3e2b9edc49c4a06f956e5956d2a500cdadcf7f7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 14 10:25:40 2015 +0300

    We no longer use rabbit_registry for password hashing

commit 93b5a3a8092f52063cbca3ab661c7c6bae43c512
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 14 10:15:48 2015 +0300

    Introduce per-user hashing functions, default to SHA-256
    
    References #270.

commit ef60743ac759d49364feeb2312cd0d1bf11c5478
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Sep 13 01:16:40 2015 +0200

    adds note on msg_store_credit_disc_bound

commit 8bb7c6b7ee55e77afd6413e49f09aa2dd9321029
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sat Sep 12 02:53:23 2015 +0200

    adds missing copyright header

commit 522d7649503ecef10cd215ef8d02c908f9619645
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 11 21:13:54 2015 +0200

    Improves dropwhile performance
    
    Fixes #308

commit 0a44d9d91680a2dda5de5327163781dd595d4209
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 11 12:18:21 2015 +0200

    refactors credit flow default config format

commit 68351a279fb5f8f20c809c9bb3e76a1379ae659c
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue May 5 18:02:32 2015 +0200

    Allows credit flow Credits to be set via configuration
    
    Backports this fix from master into stable
    
    Fixes rabbitmq/rabbitmq-server#143

commit 2eec79191f25368fe60435d5829c028e57426841
Merge: ae63a44aa 1393a4589
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Sep 10 01:37:03 2015 +0300

    Merge branch 'stable'

commit 1393a458941e9b1193c51366b9a9bce9cf088d36
Merge: 53d96127b 8ed0c81e8
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Sep 9 15:35:18 2015 -0700

    Merge pull request #305 from rabbitmq/rabbitmq-server-304
    
    refactors betas_from_index_entries/7 > betas_from_index_entries/4

commit 53d96127b4444c52069da2d36470642ceef6a133
Merge: 990bc9a25 07db76a89
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Sep 9 15:13:37 2015 -0700

    Merge pull request #302 from rabbitmq/rabbitmq-server-301
    
    uses remove_msgs_by_id/2 in places where same functionality was duplicated

commit 8ed0c81e8d259149fc860ef3831fc32e9bd8632d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Sep 9 23:57:01 2015 +0200

    unwelps code

commit a1ee6baacd270f7666320841b38f4302cf11abcf
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Sep 9 19:55:48 2015 +0200

    refactors betas_from_index_entries/7 > betas_from_index_entries/4
    
    Fixes #304

commit 07db76a89770eea7c12a641507e9fc5c773d690f
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Sep 9 15:59:19 2015 +0200

    uses remove_msgs_by_id/2 in places where same functionality was duplicated
    
    Fixes #301

commit ae63a44aa8fca0dc388f680052b6d934f6eb2189
Merge: 7ba2571e9 990bc9a25
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 8 23:08:27 2015 +0300

    Merge branch 'stable'

commit 990bc9a25d2cbd190a47364b9b4f48bd3074c591
Merge: b647c30d9 647ae31c0
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 8 13:07:39 2015 -0700

    Merge pull request #300 from rabbitmq/rabbitmq-server-295
    
    improvements for BQ:purge

commit b647c30d906de16c10ac6cd477fa4ec8a39c216d
Merge: 10059bc76 c7af78525
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Sep 8 19:28:44 2015 +0200

    Merge pull request #299 from rabbitmq/rabbitmq-server-297
    
    Lower heartbeat timeout default to 60

commit 647ae31c0b4cdc2a1ffb19240699017532179226
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 8 19:35:53 2015 +0300

    Cosmetics

commit d9c9e16d2e52fe4300af5b7a840c01285face51c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 8 19:27:22 2015 +0300

    Inline

commit e0a30b48000abac998df455f416e8003aa0e2bd4
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 19:05:54 2015 +0200

    inline qi_deliver_and_ack fun

commit 8d9206d245af44af270ce3b5d50f694fa4c30ef6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 18:51:59 2015 +0200

    typo

commit fe4c7980f3fb06a2cdbd3ce3c9a60a41aa42ae1c
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 18:32:13 2015 +0200

    updates comment

commit bb515df0ea599bcf2dfd418117cbcb38a85cec6f
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 18:23:19 2015 +0200

    renames function for clarity

commit 51543033e8aee162151b5fc46215a89284d5ac5d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 18:15:48 2015 +0200

    refactors purge_pending_ack/2 to handle delete_and_terminate

commit 8719045fbc51209dc160a08f9d9cb9c73ad3aef5
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 17:15:35 2015 +0200

    wording

commit 93574897a041e4d873e39f777ea1f1801b638645
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 17:11:40 2015 +0200

    renaming

commit db235d5b108ce93ac3000cf026d367c648b6f984
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 14:03:15 2015 +0200

    cosmetics

commit e6b01de70e648f6b42eae11a2b4e398c694fb2fb
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 14:01:52 2015 +0200

    updates comments

commit 1609fbe3fdf3290e5aecc3acbf08db86931196e3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 13:52:57 2015 +0200

    renames wipe_index -> reset_qi_state

commit 09c2922c4200a3af98a080d8c23bc98c8321bd9d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 13:51:16 2015 +0200

    uses purge_when_no_pending_acks for delete_and_terminate

commit f2028a09f5a1c7cc1a306e59d25b3ad8c42494b8
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 13:35:48 2015 +0200

    adds missing space

commit b1837a816a731bc72ae8b6a8f970e05a119cf6b9
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 13:30:33 2015 +0200

    moves purge helpers to helpers area

commit 6e6651fb1190729e3c5dda5dff21812ed1c95f58
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Sep 7 12:59:39 2015 +0200

    uses index purge callback in betas_from_index_entries

commit c7af785250efb1cdd99e7ed6650f2124c81c3ed3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Sep 7 05:05:10 2015 +0300

    Lower heartbeat timeout default to 60
    
    Fixes #297.

commit 99634fcbbe4c5a14196a1ead4c4546cdfa4612df
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Sep 6 12:45:14 2015 +0200

    refactors purge

commit 7ba2571e9550f9030d69bc29119bc814f935db59
Merge: 6a084b62c 4527bea53
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Sep 5 04:23:36 2015 +0300

    Merge branch 'master' into rabbitmq-stomp-24

commit 4527bea53d0e79331ecb298b056e6c2410c5e2fa
Merge: 758fd677e 10059bc76
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 4 20:17:52 2015 +0300

    Merge branch 'stable'

commit 10059bc768fc45339b764af2df4956ec8169ea52
Merge: 5b71eb3d3 8c153b7b5
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Sep 4 20:17:06 2015 +0300

    Merge branch 'rabbitmq-server-289' into stable

commit 1d9a92b20494a4c096a36573ab4595626ff741da
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 4 10:57:23 2015 +0100

    adds missing spec for reset_state

commit 5f410cd8ea07b0b893720ae196ec87cecb90d109
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Sep 4 10:52:31 2015 +0100

    takes into account the delete_and_terminate case

commit 6a084b62c62809c5bdedabcb4b0a998cb42c6eb7
Author: Giuseppe Privitera <priviterag@gmail.com>
Date:   Thu Sep 3 10:54:13 2015 +0100

    updated rabbit_misc:plmerge to use dict:merge

commit d8b9264bdb7f3a1cce639a3dbdb50cb588a3593e
Author: Giuseppe Privitera <priviterag@gmail.com>
Date:   Thu Sep 3 09:55:25 2015 +0100

    fix erlang -spec definition for pset, pmerge and plmerge

commit f1377540aa410eb26a2f8e7fae489044d6636b7b
Author: Giuseppe Privitera <priviterag@gmail.com>
Date:   Wed Sep 2 09:24:56 2015 +0100

    implemented rabbit_misc:plmerge/2 to merge property lists

commit 43b04fee5990f23d28cefdd5ecf67b4fc1c05297
Author: Giuseppe Privitera <priviterag@gmail.com>
Date:   Fri Aug 21 16:31:58 2015 +0100

    implemented rabbit_misc:pmerge to manage default values in proplists

commit 4e40d079efb5f1bb4a0ea856626693c9f4fec596
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Sep 3 00:55:31 2015 +0100

    Improves BQ:purge performance when there are no pending acks
    
    Fixes #295

commit 758fd677eb347fce88451150d34ba24663ecb02b
Merge: 09af3f6fd 5b71eb3d3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Sep 1 16:06:43 2015 +0300

    Merge branch 'stable'

commit 5b71eb3d3207f30dff02c3b5fd976058eed7fbdc
Merge: 7b2dabafb 725b3c7e9
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Sep 1 16:03:42 2015 +0300

    Merge pull request #292 from rabbitmq/rabbitmq-server-291
    
    fetches IndexMaxSize at BQ init time

commit 725b3c7e955af5c6ae4a79add0b2f50f03a556e2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Sep 1 11:40:04 2015 +0100

    fetches IndexMaxSize at BQ init time
    
    Fixes #291

commit 09af3f6fd57fa065d3b14789edebb4d36cdcca62
Merge: 2e2afaecd 7b2dabafb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 31 17:32:21 2015 +0300

    Merge stable into master

commit 7b2dabafb1ce73c47e0f8b1c1e1d775ca51bb3e3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 31 16:09:00 2015 +0300

    Reduce distance between rabbitmq-service.bat and -server.bat

commit a290838a727737919d4110fb632781f6176a459f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 31 15:35:24 2015 +0300

    Use RABBITMQ_BOOT_MODULE in rabbitmq-service.bat, too

commit f1eea8be10a3fd403ccf7f69ef8f57eff659c746
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 31 15:31:48 2015 +0300

    More humble description

commit 721d5e3a24604fd9e00f847ced571d08ecea094e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 31 14:44:45 2015 +0300

    GoPivotal => Pivotal Software in a few more places

commit 8c153b7b5dac9467a127f8ca1b690658d0d2f1d8
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 17:03:45 2015 +0200

    implements maybe_flush_pre_publish_cache

commit 623f1de05bccad3170d26438816855ef1e439256
Merge: 75071795b 1085e243a
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 16:41:24 2015 +0200

    Merge branch 'stable' into rabbitmq-server-289

commit 75071795bfa4581cc08a39529e27f06c767079f2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 16:19:35 2015 +0200

    cosmetics

commit d77d69558e94fa5dcb1866e77aec0fa852062763
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 16:16:21 2015 +0200

    cosmetics

commit ecd7d3b129585ab1cec437f3fa52a8ab987da2c2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 16:15:35 2015 +0200

    removes unnecessary DeltaRam change

commit f448e0bbe29a0a9d294fbeff29e20d6eee718791
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 16:12:26 2015 +0200

    refactors QI flushing

commit f4d5afd53510f952d9894294babb7f94b444b1a2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 28 14:50:05 2015 +0200

    removes stats optimization from reduce_memory_use

commit 1085e243a6df514f675b452aa96ffa23b6632ac3
Merge: 06807a4ee 383245674
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Aug 28 15:26:55 2015 +0300

    Merge pull request #283 from rabbitmq/rabbitmq-server-227
    
    Converts journal entries in place.

commit 2e2afaecd326ffcb5c8fd43a08a83aa92126a5ed
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 28 11:34:02 2015 +0200

    Boot steps: Ensure boot step's module is loaded
    
    ... before checking if the function is exported.

commit 57d5d093da421534a00906cda729bdcc74adfef6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 20:21:56 2015 +0200

    fixes argument order

commit c825578831c37044d26e6b8871f40271955f83db
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:53:16 2015 +0200

    improves comment

commit 20e8f91e8b5b0c3163a2430d8dd6055707b6a90d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:47:06 2015 +0200

    maybe_write_index_to_disk_paging > maybe_batch_write_index_to_disk

commit 713ccff1e4d686f5d6bd4c8a34f7eefa7817b2fa
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:36:12 2015 +0200

    improves push_alpha_to_betas stats calculation

commit c99ba63cda1d693a48063fe7b05c83ed38d18ec8
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:09:52 2015 +0200

    fixes typo

commit d5b8ff530b50f8a0a3fed432016444a97fdad6a4
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:05:59 2015 +0200

    improves limit_ram_acks stats calculation

commit 77bb3ee447b804ceb12647b37bbaca369f79dead
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 19:04:34 2015 +0200

    refactors DeltaRam calculation from stats0

commit 7b841803f39a005671a7f603b95ec99570d086de
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 18:39:28 2015 +0200

    improves push_alphas_to_betas paging performance

commit 38d58c4c1f4e8090aa6ca42b101f6312ca16e467
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 18:27:04 2015 +0200

    improves limit_ram_acks batching performance

commit d76d9bd3c8a247acd1ded282ff0b80c4cc049348
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 17:42:20 2015 +0200

    reinstates Force parameter to write_index_to_disk_paging

commit a576769d5aff720938077f8a75aa33d5a4ae7c7f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Aug 27 18:11:08 2015 +0300

    Merge stable into master

commit 06807a4ee5c4989f36d1577164a22652e71bd628
Merge: 1167e5a58 58e5b3848
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 27 16:48:05 2015 +0300

    Merge pull request #286 from rabbitmq/rabbitmq-server-284
    
    Makes CREDIT_DISC_BOUND and IO_BATCH_SIZE configurable

commit 58e5b3848df61a1e804a01a359b51ee7650fc9dd
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Aug 25 18:30:31 2015 +0200

    Makes CREDIT_DISC_BOUND and IO_BATCH_SIZE configurable
    
    Fixes #284

commit a8d40f06ee8c91cb83fcbb912a1f36d8d9e707ce
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Aug 27 00:39:33 2015 +0200

    improves push_betas_to_deltas performance
    
    When messages are persistend to the index, instead of pushing one
    message at a time to the FHC, now first we accumulate them in a list
    that acts as a cache, and then we push them all at once once
    push_betas_to_deltas finished recursion.
    
    The same is done when marking the message as delivered.

commit 1167e5a5808f47ee743634406a40f1050507d8c2
Merge: b61c80d1d 9708dc8e2
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Aug 26 15:54:22 2015 +0200

    Merge pull request #281 from rabbitmq/rabbitmq-server-279
    
    Reduce default QI journal size

commit 9708dc8e2144f6217a662ed156b014fd301704ab
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 26 16:50:10 2015 +0300

    Restore a comment

commit b61c80d1d75d162b8fd9e2958f03bd5b4ad96b82
Merge: b72d210ff 695be6bae
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Aug 25 03:18:22 2015 +0300

    Merge pull request #285 from rabbitmq/rabbitmq-server-282
    
    Force essential listen socket options

commit 695be6bae122364352922601730364957573f285
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 25 03:01:58 2015 +0300

    Force essential listen socket options
    
    Taken from Ranch, plus forces nodelay.

commit 38324567449b190d0c5c2d76c76daf291de38c6d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Aug 21 16:42:11 2015 +0200

    Converts journal entries in place.
    
    Instead of folding over the whole journal when we flush it to disk, it
    might be better to convert the journal entries to their final disk
    format, to avoid folding over 65k journal entries. Of course this
    approach uses more memory.
    
    Fixes #227

commit bad018b1a307528e9a18ce2c8eabac20f18a1a96
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Aug 24 15:54:08 2015 +0300

    Restore SEGMENT_ENTRY_COUNT, lower QI journal size but not as much
    
    This preserves index recovery but still reduces journal size by
    a noticeable amount.

commit 67c24aa1ccf5209660d54ad49033a1d1e3cc0502
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 24 13:40:07 2015 +0200

    rabbitmq-script-wrapper: Use '=', not '==' with Bourne shell's test

commit 9e588f63965413fd31a1f952af14b78989591919
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Aug 22 00:35:27 2015 +0300

    Reduce default QI journal size
    
    References #279, see #227 for background info.

commit 247bb9fb3a804ba2a13e0c6b2c62b1f098d0b1c6
Merge: 504ba41c9 b72d210ff
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Aug 19 17:06:59 2015 +0300

    Merge branch 'stable'

commit b72d210ff7b7c4c82708e6882694199108f55364
Merge: 85a302790 b82a9fdb0
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Aug 19 16:57:05 2015 +0300

    Merge pull request #277 from nishan/stable
    
    On Linux, use -r option for 'sed'. -E is not present in versions earlier versions of 'sed'

commit b82a9fdb0fbc0f675facccdbcdf8dd8d753f2899
Author: Nishan Naseer <nishan.naseer@gmail.com>
Date:   Wed Aug 19 06:46:08 2015 -0600

    On Linux, use -r option for 'sed'. -E is not present in versions earlier versions of 'sed'

commit 504ba41c9a5b1aa06c12147c640f7eb289d8ee74
Merge: f20a1e271 85a302790
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Aug 18 15:36:04 2015 +0200

    Merge branch 'stable'

commit 85a3027903265e11c829f98667603d45e8e84995
Merge: 0fe791689 8c866421e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Aug 18 15:32:13 2015 +0200

    Merge pull request #269 from erylee/stable
    
    issue #268 - gen_server2 can fail to dispatch messages sent by a process to itself

commit 8c866421e66369c70b2436d5178b4b9afd25df62
Author: Feng Lee <ery.lee@gmail.com>
Date:   Sun Aug 16 21:41:51 2015 +0800

    issue #268 - gen_server2 can fail to dispatch messages sent by a process to itself

commit f20a1e271e6e7fbaefe442ebf3c62e2058202244
Merge: 72853aaf4 0fe791689
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 13 16:46:36 2015 +0200

    Merge branch 'stable'

commit 0fe7916899076f90f6ba3e8e73d077b3bd5b6d12
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 13 16:45:15 2015 +0200

    Fix versions comparison to work on Mac OS X too
    
    `sort -V` is indeed not portable. The new method is based on awk,
    hopefully a portable portion of the language!

commit 72853aaf40e30dd586c15cd618f5c295b12d7938
Merge: dbddebdac 1d0e1988b
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 13 14:41:11 2015 +0200

    Merge branch 'stable'

commit 1d0e1988bdf09294033a2758c0e33de9632f5860
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 13 14:38:48 2015 +0200

    Makefile: Resolve $(USE_PROPER_QC) only when needed

commit 04e7596e0c700d3a525d91fc12d41b84c43ee59c
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Aug 13 14:33:47 2015 +0200

    Makefile: Use `erl -version` to do ERTS version tests
    
    This is way faster than starting a full VM.

commit dbddebdaced58b9b9484792d581fd6fcab1085c4
Merge: 3863a9d07 350d535d6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 12 17:58:31 2015 +0200

    Merge branch 'stable'

commit 350d535d66cf97c0cc268e97d1db895cfaff32b6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 12 17:00:43 2015 +0200

    Add `ssl_compat` and `time_compat`
    
    They are not meant to be used by the Core. Their goal is to simplify the
    development of plugins which must support RabbitMQ 3.5.x and 3.6.x+.

commit 3863a9d07ce7c8e3e9e12260cbe8cbe1bba144aa
Merge: 9b0752685 fc84a3fe8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 18:18:36 2015 +0200

    Merge branch 'rabbitmq-server-233'

commit fc84a3fe8d5ebba37909f8c1e02418956b4351c1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 18:17:14 2015 +0200

    erlang:phash2/1 returns a value in the range 0..Range-1
    
    ... but lists:nth/2 takes a position in the range 1..Length.

commit 7f3ab57c3846b98f7a8de055a384465013d02f82
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 18:15:59 2015 +0200

    Avoid division by 0
    
    erlang:monotonic_time() does not strictly increase: two subsequent calls
    can return the same value.
    
    References #233.

commit 9b0752685d65bb73a19912a494efbb70cbcd8e6f
Merge: a585ac27e 11feec626
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 14:48:41 2015 +0200

    Merge branch 'stable'

commit 11feec626c6341e08b264320c4d6c90ae61d8f81
Merge: 699ce52eb 0afe1f669
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 14:48:20 2015 +0200

    Merge branch 'rabbitmq-server-234' into stable

commit 0afe1f6693d45a6e30ee53595f7147f331a81177
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 14:46:05 2015 +0200

    rabbitmq-server: Don't catch EXIT "signal"
    
    The only reason for the script to terminate is that RabbitMQ exited. By
    trying to stop it again in the EXIT signal handler, we could stop a
    newer instance of RabbitMQ. This caused the testsuite to fail in an
    unexpected way.
    
    References #234.

commit 699ce52eb0fc88bfa89e8f7162e402b07649398f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 11 14:40:24 2015 +0200

    make stop-node: Stop the node synchronously
    
    ... ie. wait for the process to actually exit.

commit a585ac27e02bec19c57a733ecc79263270b84422
Merge: 4bb756f6e d75793e97
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Aug 10 11:19:06 2015 +0200

    Merge branch 'stable'

commit d75793e97618c9d187175c7500deefb64953c058
Merge: 804a2209b 54bbf0083
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Aug 10 11:18:17 2015 +0200

    Merge pull request #258 from rabbitmq/rabbitmq-server-234
    
    rabbitmq-server: Catch SIG{HUP,INT,TERM,TSTP} and exit gracefully

commit 54bbf0083ab648c916f92dbf6bf143103822b588
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 29 14:13:10 2015 +0200

    rabbitmq-server: Catch SIG{HUP,INT,TERM,TSTP} and exit gracefully
    
    This is only done when RabbitMQ runs in the foreground and when the
    Erlang shell is disabled ($RABBITMQ_ALLOW_INPUT is unset).
    
    This should be useful to Docker where the service runs as PID 1.
    
    Fixes #234.

commit 4bb756f6ec4f7a20d67615671043ccad32d3686d
Merge: 222ebe2ac ddd9179c7
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Aug 9 13:03:36 2015 +0300

    Merge pull request #254 from rabbitmq/rabbitmq-server-233
    
    Support the new Time API in Erlang 18.0

commit 222ebe2acd2909ffb5c967476480152938738a99
Merge: 559f7e237 804a2209b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 7 13:11:35 2015 +0200

    Merge branch 'stable'

commit 804a2209b4c8c540559c06f2c9d1544c609f1624
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Aug 7 12:59:51 2015 +0200

    Warn about exported variables
    
    Fix the reported warning in `credit_flow.erl` and `rabbit_table.erl`.
    
    This is the default setting in erlang.mk, so fixing this directly in
    RabbitMQ will ease future work on erlang.mk or Rebar.

commit 559f7e237ddc31eb2bf42cffc30b1c52e142965f
Merge: 06ce1d512 41b40e3d0
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Aug 6 17:19:08 2015 +0300

    Merge pull request #256 from rabbitmq/rabbitmq-server-245
    
    Priority queue: Fix a crash when querying 'head_message_timestamp'

commit 41b40e3d080e2b1f4ef5cba9426c71e1b59d4e52
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Aug 6 15:57:08 2015 +0200

    Priority queue: Fix a crash when querying 'head_message_timestamp'
    
    Before the fix, the code would consider it an integer which could be
    summed. It crashed if the head message had no timestamp at all (the
    underlying queue returned '').
    
    Now, we have a special case, exactly like 'backing_queue_status'. The
    code first finds a priority with queued messages, then it queries the
    underlying queue for the 'head_message_timestamp'.
    
    Fixes #245.

commit ddd9179c70070c05403ec00abc65298607cb613a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 18:12:34 2015 +0200

    rabbit_misc: Remove now_ms/0 and now_to_ms/1
    
    References #233.

commit 869d2bbe7b9b2f3d8cf4fb39843cd93d6450fff8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 31 18:46:08 2015 +0200

    Replace os:timestamp() with os:system_time(milli_seconds)
    
    It will require all consumers of eg. events to be updated. But this is a
    good occasion anyway to change the exposed timestamp format to something
    pushed by the new Time API.
    
    Comparisons and calculations are much simpler because the new format is
    a simple integer.
    
    The resolution is a millisecond, not a microsecond, because current
    consumers of these timestamps do calculations in milliseconds.
    
    References #233.

commit 52a12c0cd87fee85c50ed0affa5362764bd9775e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:13:01 2015 +0200

    GM: Convert the testsuite to use `time_compat`
    
    References #233.

commit 78bf4ce6ef185669066213dca38bc641138108a8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 18:06:24 2015 +0200

    rabbit_node_monitor: Rework `global` hang workaround
    
    Up-to and including Erlang 17, `global` would use `erlang:now()` to tag
    messages in the process dictionary. In Erlang 18.0, it uses a unique
    integer, so we can't use this value to determine for how long messages
    are stuck in the dictionary.
    
    We now do two snapshots of the dictionary and compare them.
    
    References #233.

commit ae53a636074e19b371be04ebdb80c659720df9d7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:49:13 2015 +0200

    pg2_fixed: Use erlang:system_time(micro_seconds) to pick a "random" node
    
    References #233.

commit 26637302123dc6196dff436d1ed4d695f1cf44cd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 18:01:51 2015 +0200

    Use os:system_time() when the time is exposed
    
    ... or compared to time values from outside.
    
    References #233.

commit 584af327acd8e74b54d3701778aa5167cc55b6ed
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:52:44 2015 +0200

    Use os:timestamp() to get a non-unique timestamp
    
    References #233.

commit d718d4c5af58418cad3b6e8d7747efef66d5f801
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:33:05 2015 +0200

    Use monotonic_time() to compute elapsed time
    
    ... not `erlang:now()` (deprecated) or `os:timestamp()` (which could go
    backward).
    
    file_handle_cache:
        While here, change the LRU tree key from `erlang:now()` to a
        combination of the monotonic time and the handle reference (which
        was the value in the tree previously). This is required as the
        monotonic time doesn't increase strictly: two subsequent calls
        could return the same time, leading to non-unique key. We could use
        unique_integer([monotonic]) but it's a bit heavy weight just to keep
        a rough order of opened files. So now, files sharing the same age
        are arbitrary "sorted" by their reference.
    
    References #233.

commit 40b5c82b4b0feeab28fa85c2f1855590b722fc08
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:51:30 2015 +0200

    Use phash2() and the new Time API as a random seed
    
    References #233.

commit 7953eb7f3ebf8a494257bc7fcfcc6a3ae378a6d6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 30 17:10:57 2015 +0200

    Add `time_compat` module
    
    This module, obtained from Erlang 18.0 ERTS examples, allows to use the
    new Time and Time Correction API introduced in Erlang 18.0 and fallback
    to the old API (the deprecated `erlang:now()`) when running on older
    Erlang.
    
    References #233.

commit 06ce1d512c96ee0b2be6c387123570f03798e133
Merge: 3cc3fec90 3ef7756d5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 5 16:16:18 2015 +0200

    Merge branch 'rabbitmq-server-250'

commit 3ef7756d5a48da33af4c1e15ba86ac11f22841fd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 5 16:15:30 2015 +0200

    RPM/deb: Depend on Erlang R16B03
    
    References #250.

commit 3cc3fec9006bd917920cd7548ea7d5593ca2a8e5
Merge: ce88f9f17 e2b7de27c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 5 09:44:36 2015 +0200

    Merge branch 'stable'

commit e2b7de27cc6c55e430882621a4545dcfdd901e95
Merge: f1ce00b6a dc5ffca01
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Wed Aug 5 09:44:01 2015 +0200

    Merge pull request #253 from rabbitmq/rabbitmq-server-251
    
    Memory monitor: Log a warning if a 32-bit version of Erlang is used

commit dc5ffca01f3b5f359801a61e671c1544e39c2ddd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Aug 5 09:41:31 2015 +0200

    Memory monitor: Log a warning if a 32-bit version of Erlang is used
    
    Fixes #251.

commit ce88f9f17b76d6d1da006193a46ea15ccbe8b83a
Merge: 4caed4b8b 6def6cbb5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 4 17:28:02 2015 +0200

    Merge branch 'rabbitmq-server-250'

commit 6def6cbb53c6a62fd9451064a20551ffea622ea5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 4 17:25:42 2015 +0200

    Require Erlang R16B03, not R16B03-1
    
    Erlang R16B03 is the version provided with Ubuntu 14.04 LTS and
    CentOS 7. This should avoid some pain to those users.
    
    However, we will highly recommend Erlang 17.0 for any serious TLS
    deployment.
    
    References #250.

commit 4caed4b8b51b2ae7e2d73338d764e0dccb06abb3
Merge: 3f8f24bbb be83042dd
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Tue Aug 4 11:50:00 2015 +0200

    Merge pull request #252 from rabbitmq/rabbitmq-server-250
    
    Require Erlang R16B03-1

commit be83042dd09154a8b40fab5575dc45dd390bea52
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Aug 4 11:25:07 2015 +0200

    Require Erlang R16B03-1
    
    Fixes #250.

commit 3f8f24bbb6f75d095f9dd68bb826afb15bc624e5
Merge: b5d2e0090 585a9690f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Aug 4 00:24:47 2015 +0300

    Merge branch 'rabbitmq-server-121'

commit 585a9690f078d720db62898d04b6405d802bb10c
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Aug 3 18:21:15 2015 +0100

    Renames queue-master-location header to x-queue-master-locator
    Renames rabbit.queue_master_location config key to rabbit.queue_master_locator
    
    References #121

commit b5d2e0090717a5f4559fb9a68dcffa2266347004
Merge: 7fa5f4eb2 e5b427666
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 31 18:45:40 2015 +0300

    Merge pull request #247 from rabbitmq/rabbitmq-server-246
    
    Support the new `ssl:connection_information/{1,2}` API

commit e5b4276660e660899549b8f184b2810a7b031ad8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 31 13:36:24 2015 +0200

    Support the new `ssl:connection_information/{1,2}` API
    
    A new module, `ssl_compat`, is added. It provides a wrapper around
    `ssl:connection_information/{1,2}` which is introduced in Erlang
    18.0. If this API is unavailable, it falls back to the deprecated
    `ssl:connection_info/1`.
    
    Use this module in `rabbit_net:ssl_info/1`. As a consequence, the return
    value changes, so update `rabbit_reader:ssl_info/2` accordingly.
    
    Fixes #246.

commit 7fa5f4eb28a9d9d4c9b5e166213b2e5d9666c2ec
Merge: 8a5c4b5a3 f1ce00b6a
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jul 30 17:09:50 2015 +0200

    Merge branch 'stable'

commit f1ce00b6ae3c4ebd1a0a105d6d9386bea8371e5f
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Jul 30 17:07:53 2015 +0200

    gm: Remove an unused variable in terminate/2
    
    The variable was left unused after the fix to #224.

commit 93ecc11f07aff80bb1ea99d7530363f7db695166
Merge: 28499dd69 1f61e4fae
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 29 23:23:59 2015 +0300

    Merge pull request #243 from Jakauppila/rabbitmq-server-243
    
     Fixes a logic problem with NODE_IP_ADDRESS and NODE_PORT in rabbitmq-env.bat.

commit 1f61e4fae109561572beca3f0ddc9c7624622126
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 15:21:00 2015 -0500

     Fixes a logic problem with NODE_IP_ADDRESS and NODE_PORT in rabbitmq-env.bat.
    
    Fixes the logic for NODE_IP_ADDRESS and NODE_PORT. First, check for the existence of the environment variable, then the definition if set via conf file, then proceed with the original logic on setting the IP/Port variables.

commit 8a5c4b5a38392206ad4bb21cd4491154d2f31cfb
Merge: 5fd24fbb7 28499dd69
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 29 22:15:22 2015 +0300

    Merge branch 'stable'

commit 28499dd69a17763bec2b83c9bc77b9ffc85b997e
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:43:00 2015 -0500

    Missing a backslash
    
    Added a missing backslash.

commit 374901966f8aa6262bed374b55b844ded2eccf21
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:37:42 2015 -0500

    Adding quotes to the !RABBITMQ_CONF_ENV_FILE! call
    
    Added quotes around the call for the !RABBITMQ_CONF_ENV_FILE! file.

commit 77052f42d1389caedff1f4febdb384a81535d49b
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:36:07 2015 -0500

    Modify the default path of RABBITMQ_CONF_ENV_FILE.
    
    Added the prefix `RABBITMQ_` to `CONF_ENV_FILE` since it can't be overridden from the file anyways. Updated the default path to `!RABBITMQ_BASE!` so it'll default to that path if only the Base is overridden or go to the same `!APPDATA!` path if not.

commit 5fd24fbb744b975c943e512595423cddbd61442c
Merge: c9c2876b3 429768cb7
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 29 22:13:49 2015 +0300

    Merge pull request #240 from Jakauppila/rabbitmq-server-239
    
    Modify the default path of RABBITMQ_CONF_ENV_FILE within rabbitmq-defaults.bat

commit 429768cb795694d492550a29b62e5a76198cad72
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:43:00 2015 -0500

    Missing a backslash
    
    Added a missing backslash.

commit 553a3995f3ea87005978c337dd511ab86869a671
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:37:42 2015 -0500

    Adding quotes to the !RABBITMQ_CONF_ENV_FILE! call
    
    Added quotes around the call for the !RABBITMQ_CONF_ENV_FILE! file.

commit 633f6ca2459b020815313c5cb1aabaa90598889e
Author: Jared Kauppila <Jared@Kauppi.la>
Date:   Wed Jul 29 11:36:07 2015 -0500

    Modify the default path of RABBITMQ_CONF_ENV_FILE.
    
    Added the prefix `RABBITMQ_` to `CONF_ENV_FILE` since it can't be overridden from the file anyways. Updated the default path to `!RABBITMQ_BASE!` so it'll default to that path if only the Base is overridden or go to the same `!APPDATA!` path if not.

commit c9c2876b3dff656ddabedc0b2ab8d9ed11853297
Merge: c3088e96e aaa09daf1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 29 15:02:06 2015 +0300

    Merge branch 'stable'

commit aaa09daf1a451d141a49a2b90238db9852d657d9
Merge: ac5373f34 4606c363a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 29 13:26:40 2015 +0300

    Merge branch 'rabbitmq-server-224' into stable

commit 4606c363a06482164a34b1255f4f341a6528c5e8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 29 11:10:52 2015 +0200

    GM: Remove debug messages added in 08f25ec6
    
    References #224.

commit ed2766564f5e2cc23e62e139d435e2ea511d12dd
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jul 28 17:11:30 2015 +0200

    GM: Wait for messages to be ACK'd before exiting
    
    When the GM is asked to stop, it flushes the pending messages but
    does not ensure those messages are actually delivered to all members.
    
    In some situations, this can lead to other GMs detecting that this GM is
    unexpectedly down, even if this GM just sent a message to ask them to
    stop as well.
    
    When this happens in the case of queue mirroring for instance, this
    causes a slave to promote itself as the new master, and the old master
    to wait forever that other slaves exit.
    
    Fixes #224.

commit c3088e96e2b808676b87801940f0e77ba487755a
Merge: f8e8c2fe1 ac5373f34
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 29 11:00:46 2015 +0300

    Merge branch 'stable'

commit ac5373f34ec1dac6ad338d14580d28c7c2d4132e
Merge: 0c9509eeb 32d0d8769
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 29 11:00:17 2015 +0300

    Merge pull request #236 from legoscia/remove_nonexistent_bindings
    
    Don't crash when removing non-existent bindings

commit 32d0d87699e1c5cf6585f3cddda6aedb468be69d
Author: Magnus Henoch <magnus.henoch@gmail.com>
Date:   Tue Jul 28 13:32:47 2015 +0100

    Don't crash when removing non-existent bindings
    
    In rabbit_exchange_type_topic:remove_bindings/3, if the binding we're
    removing cannot be found, ignore it and keep going.
    
    Fixes #235.

commit f8e8c2fe117179adf7cf091acd75c5d21651b332
Merge: 9cd7f2c97 0c9509eeb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jul 27 13:53:53 2015 +0300

    Merge branch 'stable'

commit 0c9509eeb85ca3e0091fd617e3d6365258a43c04
Merge: c6bb1a044 7bef94550
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jul 27 13:48:45 2015 +0300

    Merge branch 'rabbitmq-server-226' into stable

commit 7bef94550f861b8d67b3f1ffaf48d69d7e02cb85
Merge: 700ab414d c6bb1a044
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jul 27 10:18:14 2015 +0300

    Merge branch 'stable' into rabbitmq-server-226

commit 700ab414d6ab83bb8cedfc4fddc19b1efaa7a5dc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jul 24 20:00:29 2015 +0200

    Log if FHC buffering is enabled or not during startup
    
    References #226.

commit 9cd7f2c974f5b9c3d998a729d57a750177e0f0bc
Merge: b62f96690 46c8f80f1
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Fri Jul 24 16:22:28 2015 +0200

    Merge pull request #189 from bogdando/ra_ocf_ha
    
    Add OCF Pacemaker RA for HA A/A cluster

commit 46c8f80f1e99171db5d99e23488890c9e0bf090e
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Jul 24 11:25:23 2015 +0200

    Fix indentaion, typos, hardcodes
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit d333f44ee7806daa2f82632c755a1c06cef3c1ac
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Fri Jul 24 11:03:58 2015 +0200

    Fix kill and mnesia removal
    
    * Do not use kill -9, use kill -TERM
    * If pidfile is empty try to kill by matching beam process
    * Fix mnesia files removal to be more name-safe
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit b692903d238eb7aae9d34106634f467d4064341b
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Jul 23 18:17:36 2015 +0200

    Add use_fqdn and fix pidfile
    
    * Add use_fqdn to control a rabbit node and a node naming
      rules. Defaults False (use shortnames)
    * Fix default pidfile path
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit a83a9172d1b39b9f49a50880ee8e63fb8fa71f36
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Jul 23 16:46:03 2015 +0100

    Adds policy validation tests for queue master location
    
    References #121

commit 7dfa7614935c1a716c214dc8ba14e9acdfa6ace4
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Thu Jul 23 16:51:32 2015 +0200

    Remove bashisms and sync recent changes
    
    * Remove bashisms and switch to the /bin/sh shebang
    * Partial apply changes for the fixed Fuel bug
      https://bugs.launchpad.net/fuel/+bug/1463433
      - Treat resource failed when list_channels hangs
        and killed by timeout.
      - Ignore memory alerts, if any were set, as this maybe
        out of the generic OCF control scope and is a Fuel
        specific change.
    
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit c6bb1a04439fc96d6c63de94a8f71d74280bf686
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jul 22 15:37:37 2015 +0100

    Commit package change logs

commit d610df6cc2fcf861d9db1f280662e5285eb1fefb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 22 10:18:01 2015 +0200

    file_handle_cache: Add a config option to disable buffering
    
    To disable read buffering, one has to put the following line in
    rabbitmq.config:
    
        [
          {rabbit, [
            {fhc_read_buffering, false}
          ]}
        ].
    
    Fixes #226.

commit b62f966901b5a0687dd5d9bf30105bf9ce957ea0
Merge: 7569fe113 b877b9846
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 22 11:01:29 2015 +0200

    Merge branch 'stable'

commit b877b98462adef4aa108033815cc6a7d6e4f2976
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jul 22 10:58:55 2015 +0200

    Do not ignore /ebin entirely as it contains rabbit_app.in

commit 7569fe113e317947cbb6674da66e34416bc6f226
Merge: bd6398f89 7cd961532
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 21 22:26:00 2015 +0300

    Merge branch 'stable'

commit 7cd961532cb1362485e39e778a85763358371f42
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 21 20:49:59 2015 +0300

    rabbitmq-echopid.bat is mean to be executable

commit d44004221e457baa5efb4e36a09963df10eea218
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 21 20:41:43 2015 +0300

    Load rabbitmq-env.bat in a cwd-independent way

commit bd6398f8977089ece7fa0908c770dfa2c75c555f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 21 20:41:43 2015 +0300

    Load rabbitmq-env.bat in a cwd-independent way

commit 99c63caef262d77a621e89c4bdd4cb334032f8a1
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jul 21 16:15:08 2015 +0200

    cosmetics

commit 4352e0c23fdc7ae87c8eb5e63204f29746bf64c1
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jul 21 16:13:41 2015 +0200

    expand_shortcut errors were not handled correctly

commit 556a81d5227bce8fcd1488afda6ada124f3fbd0d
Merge: cfc84df22 c426b5f85
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Jul 20 16:39:56 2015 +0200

    Merge pull request #214 from lshift/interceptors
    
    change rabbit_channel_interceptor API

commit c426b5f85a22f36611088cab388f8987d41b1fd8
Author: ash-lshift <ash@lshift.net>
Date:   Mon Jul 20 11:50:41 2015 +0100

    change rabbit_channel_interceptor API...
    
    ...to allow:
    
    - all methods to be intercepted
    - content to be intercepted as well as the method
    
    Previously only a subset of methods were allowed due to performance
    concerns. Here we move work previously done at method handling time to
    channel initialization time. This seems to reduce the performance impact
    to an acceptable level.

commit e12c840a4391740d2368e447a7f6fbf0e2950b59
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Fri Jul 17 13:51:30 2015 +0100

    Updates coding style
    
    References #121

commit cfc84df229bc014d5ebfdb9ce033d57a5d2b2dfa
Merge: 1372de63e 9a1f21f8e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 15 18:33:29 2015 +0300

    Merge branch 'stable'

commit 9a1f21f8e4ca2d721493f83a01e0d941f78c1407
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 15 18:22:26 2015 +0300

    Make sure rabbitmqctl.bat arguments are not overwritten

commit ab29c09cc41c3cb4104cc85ca329efe67c399472
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 15 18:21:48 2015 +0300

    Bring back ERLANG_HOME check

commit cfceb7cd6d4a69cc444e245f6c91e13b999df31d
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 15 16:51:15 2015 +0300

    Remove a misleading comment

commit 40a35185af6f09568930c6912549988bb4f78a4f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 15 16:25:47 2015 +0300

    Apply the change in 4b12be8f9f287606762cbc1440d979abcebb17f3 to rabbitmqctl.bat

commit 7de22f31fdaabc0f579905ec818a249f9baa6917
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 15 12:15:45 2015 +0100

    Adds queue_master_locator class module
    
    References #121

commit b0c7deec130e94f93bee90d92f2d3a6c1be71d77
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 15 11:12:12 2015 +0100

    Moves callback execution to one place
    Renames functions
    
    References #121

commit 6b3056448154869c82b459682f7df2e2f4163f9a
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 15 11:05:50 2015 +0100

    Checks if module exists
    
    References #121

commit 40b291242fb6aa1d4b11a08b1d5e28581a8ab3cc
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 15 11:03:38 2015 +0100

    Takes queue name from #binding.destination
    
    References #121

commit 2cd399a88f70c840e8616f1857797ee525e55e52
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 15 10:57:23 2015 +0100

    Removes temp variable
    
    References #121

commit 2ed519b82803b2902bfcb31cc423de7f0844e192
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Mon Jul 13 17:18:56 2015 +0100

    Simplifies min-masters helper functions
    
    References #121

commit 952033fc4feb5b8dec3fed89087a747d68a09796
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jul 13 18:22:03 2015 +0300

    Apply the change in 4b12be8f9f287606762cbc1440d979abcebb17f3 to rabbitmq-service.bat

commit 1372de63e8a874554385011beb0cc2588b87842f
Merge: 97d32138f b60644eca
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 12 23:52:35 2015 +0300

    Merge branch 'stable'

commit b60644ecacae39e3d9b5902a5f7578c433a10ddc
Author: U-rabbitmq\admin <mklishin@pivotal.io>
Date:   Sun Jul 12 23:45:43 2015 +0300

    Another typo

commit 15421800b3cff85f4c4637ed8708302901ed213d
Author: Alexey Ermishkin <alexey.ermishkin@engine6.com>
Date:   Sun Jul 12 17:15:40 2015 +0500

    Replaced {} with () in server bat files

commit 97d32138f6da3cfe9d3261b51bf0abef02b897f1
Merge: a3d2c59a4 7c6adf006
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Jul 12 23:51:15 2015 +0300

    Merge branch 'scratch-net-Fix_bat_typos'

commit 7c6adf006a03bac46dfd14f13bceb669f98b0425
Author: U-rabbitmq\admin <mklishin@pivotal.io>
Date:   Sun Jul 12 23:45:43 2015 +0300

    Another typo

commit 5e7dfe34c378342b531cc761272166dc2bc58f29
Author: Alexey Ermishkin <alexey.ermishkin@engine6.com>
Date:   Sun Jul 12 17:15:40 2015 +0500

    Replaced {} with () in server bat files

commit 9262a96f672c6b2ebf8a0de6fe6e0e85ab232284
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Thu Jul 9 16:34:06 2015 +0100

    Coding style and header updates, #121

commit 2815985b1177ddfc939bd7e24ac63f42510650e5
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Wed Jul 8 19:45:01 2015 +0100

    Change min-masters calculation
    Remove validate_policy callback from queue location behaviour
    Create seperate queue location policy validation module
    Delete function, delay_ms/1. Unused
    Remove functions not used by other modules from export
    Update coding style and header to GoPivotal Inc standards
    
    References #121.

commit a3d2c59a46ff309dfad2a5d04889ec87cdc0aec9
Merge: ba17cacc5 a96155455
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 8 14:52:55 2015 +0300

    Merge branch 'stable'

commit a9615545545daf17c3d168deead29444c293b88a
Merge: 632845bea 508d76d31
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Jul 8 14:38:11 2015 +0300

    Merge pull request #221 from rabbitmq/rabbitmq-server-216
    
    Be less assertive about x-death value types, fixes #216

commit 508d76d31984caf91977d2b0fdb095ed829981b3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 8 14:30:04 2015 +0300

    Be less assertive about x-death value types
    
    Multiple numerical (and string, e.g. for "reason") types can work
    equally well. Strict type assertions result in clause failures in
    cases when clients modify headers (intentionally or not) and use
    types other than long for "count".
    
    Fixes #216.

commit ba17cacc5c22260f7ca0e2dafb18b6af69fcc9d9
Merge: bd3cd13db 632845bea
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 7 23:00:48 2015 +0300

    Merge branch 'stable'

commit 632845bea39bce9a14ac78b8c382c060c4966cd7
Merge: 5c3c0e6f3 516f0cd84
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 7 22:12:54 2015 +0300

    Merge branch 'rabbitmq-server-159' of https://github.com/hairyhum/rabbitmq-server into hairyhum-rabbitmq-server-159

commit bd3cd13db7febaad658d6738b8074442f9662375
Merge: 11b110a81 5c3c0e6f3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jul 7 22:05:32 2015 +0300

    Merge branch 'stable'

commit 9b291479d133272013a85270dd44a3001c6850d6
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Jul 7 15:52:20 2015 +0100

    Delete round robin callback. Not supported.
    
    References #121

commit 516f0cd84464b89beacdc0d3e53ab5cf4c0b3560
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Jul 7 17:43:37 2015 +0300

    Log heartbeat timeout in a human friendly way #159

commit 5c3c0e6f38792ca37289888ce39996e6baf4d846
Author: Daniil Fedotov <hairyhum@gmail.com>
Date:   Tue Jul 7 16:47:42 2015 +0300

    Fixes #179

commit 7f81963ae0e37d40f291035cbe96b15b73db0c1c
Author: Ayanda Dube <ayanda.dube@erlang-solutions.com>
Date:   Tue Jul 7 13:59:42 2015 +0100

    Initial commit #121

commit 11b110a81633793d97d972b34c607599bd734fc9
Merge: f46d3e3d9 8412720c2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jul 6 17:22:57 2015 +0200

    Merge branch 'stable'

commit 8412720c2582a347d02ff04571869de0355178e2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jul 6 17:21:25 2015 +0200

    make start-background-node: Use "rabbitmq-server &"
    
    ... not "make run-background-node", because the latter does not write a
    PID file.

commit f46d3e3d9e02e2b191d00d2738309251d2797405
Merge: 64e60dfca 16ad85f69
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Jul 3 16:43:21 2015 +0200

    Merge branch 'stable'

commit 16ad85f690203b0ae403f5392f9bb747b8dc84ce
Merge: 9fdbab196 e4b7eecf6
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Jul 3 16:42:37 2015 +0200

    Merge pull request #215 from rabbitmq/rabbitmq-server-175
    
    Introduce rabbitmqctl purge_queue

commit e4b7eecf6f643367dd99fd69138a587a128c6e9e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 3 17:39:43 2015 +0300

    Squash unused variable warnings

commit b99adec0c1b81327fc27791b5d350c0f77d6298c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Jul 3 17:27:44 2015 +0300

    Introduce rabbitmqctl purge_queue
    
    For operational convenience.

commit 64e60dfcad57e1a27e5bffe713eb5eba24430b21
Merge: 9b5d2e210 383b70bb4
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jul 3 14:49:12 2015 +0300

    Merge pull request #213 from ingwinlu/remove_python_version_detection
    
    remove python version detection from Makefile...

commit 383b70bb4e643f0dfb7d79c3ee841819dc0a0ff3
Author: derwinlu <derwinlu+git@gmail.com>
Date:   Fri Jul 3 11:27:41 2015 +0200

    remove python version detection from Makefile...
    
    ...and let env handle it.

commit 9b5d2e21099250c9fa96a421e6af3e08cb270cf7
Merge: 0c9cd7478 9fdbab196
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 2 18:10:42 2015 +0200

    Merge branch 'stable'

commit 9fdbab196ba41501c330f6636e2a186317eb1079
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jul 2 18:10:03 2015 +0200

    make run-background-node: Actually run RabbitMQ in the background

commit e38932e276ddfcec1e561a3fa03372cfdedd53bb
Merge: 32b45d8db 40db73ec3
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 2 14:12:28 2015 +0300

    Merge pull request #212 from rabbitmq/rabbitmq-server-176
    
    Bump default +A value to 64

commit 40db73ec3126a15382425e2d13a8abcd8a17e28c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 14:09:36 2015 +0300

    Bump default +A value to 64
    
    Based on user feedback, 30 feels a bit low. We have to recommend
    users with 8 or more cores per node to bump the value to around 100.
    
    This value is not very scientific and assumes roughly 16
    I/O threads per core. This is also the default Riak 2.1 uses.

commit 0c9cd74784d287d48a7cc1ddac4ae57c062a5dfc
Merge: 4460f309e 32b45d8db
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 13:58:43 2015 +0300

    Merge branch 'stable'

commit 32b45d8dbc32a6518ac0b029d05d0023a9cd0fab
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 04:31:24 2015 +0300

    Initialise IO_THREAD_POOL_SIZE in rabbitmq-defaults

commit c57ab10fd02188e4052109a52060f1cd34970c32
Merge: 8ac770285 7dfff8bbb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 03:58:56 2015 +0300

    Merge branch 'stable' into rabbitmq-server-178

commit 7dfff8bbb0aff9d2b7c392b7d2782f34710f08b7
Merge: 4b12be8f9 61036f00c
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jul 2 03:52:42 2015 +0300

    Merge pull request #209 from rabbitmq/rabbitmq-server-208
    
    Make boot module configurable via env variable

commit 61036f00cb0cc4f390f5e6bec91fdaf969060141
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 03:33:04 2015 +0300

    Introduce BOOT_MODULE in Windows batch scripts

commit 4d5e06aac3cfd82d9101fd71c40d2fdb2f130b3f
Merge: 018720752 4b12be8f9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 02:48:29 2015 +0300

    Merge branch 'stable' into rabbitmq-server-208

commit 4460f309e0943292417c2c87f25400e1cd4e815f
Merge: b102b814c 4b12be8f9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jul 2 02:39:17 2015 +0300

    Merge branch 'stable'

commit 4b12be8f9f287606762cbc1440d979abcebb17f3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 1 17:43:03 2015 +0300

    Make it possible to run scripts from dirs other than scripts and sbin

commit 0275421df675a1f14421675838669dc65405875f
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue Jun 23 22:42:49 2015 -0500

    Windows batch file changes to support -env, -defaults, and -conf functionality present on *nix
    
    Mimicked the behavior of the -env, -defaults, and -conf scripts
    available on *nix

commit c990ba703aa1d1ca4e990777bc7d5f5d0a8394e1
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:45 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmqctl.bat

commit 50ddcf5a4654b61339ea13a445accc3a24bd7f01
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:33 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-service.bat

commit 31905a4c89d6ff82cb60668ffcc48036cd2d3184
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:13 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-server.bat

commit 8cab79be60c060130d60039d4211add6cc683e94
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:12:57 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-plugins.bat

commit aa7105f1310998787b462e641b2dad54edbc83f7
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:12:22 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-echopid.bat

commit b102b814ce574fcc1a29c602661da0f46efff625
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 1 17:43:03 2015 +0300

    Make it possible to run scripts from dirs other than scripts and sbin

commit 56e6b4e62e39974785959750d5431b9e517c7868
Merge: d7c625cb5 2b89dbe8b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 1 17:03:07 2015 +0300

    Merge branch 'rabbitmq-server-154' of https://github.com/Jakauppila/rabbitmq-server into Jakauppila-rabbitmq-server-154

commit 018720752583824c3aaf3cf68193970559350890
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jul 1 15:47:36 2015 +0300

    Introduce RABBITMQ_BOOT_MODULE (for *nix for now)

commit d7c625cb563772d0368422a2ad1c5081f60cbde4
Merge: 78a9581e0 ddf890037
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 30 11:11:42 2015 +0300

    Merge branch 'stable'

commit ddf89003752eca8cacc38333d1b42f29242ae4ac
Author: derwinlu <derwinlu+git@gmail.com>
Date:   Tue Jun 30 06:58:14 2015 +0200

    add detection for python2.7
    
    In python2.7 simplejson has been removed from stdlib and replaced
    with json. codegen.py already has a fallback import in place so no
    changes needed there.
    
    This way python2.7 can be detected if installed and rabbitmq-server
    can be compiled even if python is bound to python3.

commit 78a9581e01f1fc4a1d6d00b63e24f3a833afda96
Merge: b9e39a8df d09360cd2
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 30 11:06:45 2015 +0300

    Merge pull request #204 from ingwinlu/python_detection
    
    add detection for python2.7

commit d09360cd21c31323646b6df5eaf274ac845bff07
Author: derwinlu <derwinlu+git@gmail.com>
Date:   Tue Jun 30 06:58:14 2015 +0200

    add detection for python2.7
    
    In python2.7 simplejson has been removed from stdlib and replaced
    with json. codegen.py already has a fallback import in place so no
    changes needed there.
    
    This way python2.7 can be detected if installed and rabbitmq-server
    can be compiled even if python is bound to python3.

commit b9e39a8df9e22622ee582945c472521afea3f3aa
Merge: 8bb746878 3bb83ebe3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 29 14:44:59 2015 +0200

    Merge branch 'stable'

commit 3bb83ebe342a676236fe0f2748de96e3bfed8ed8
Merge: e2d819164 1e4ca4672
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 29 14:44:15 2015 +0200

    Merge branch 'bug26427' into stable

commit 1e4ca4672c397e95a5caf945b4d9492c3799cd80
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Jun 29 14:40:25 2015 +0200

    Ensure the conditions to log "accepting..." match those for "closing..."
    
    For instance, the following test led to "accepting AMQP connection"
    being logged, but no corresponding "closing AMQP connection":
      $ nc localhost 5672
      a
      ^C
    
    The same issue applied to TLS connections.
    
    References bug26427.

commit a8d622317ea37bbcd3355cadb66d910f97a6f574
Merge: ed351cf9b 8356c5ac8
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Mon Jun 29 14:38:26 2015 +0200

    Merge pull request #202 from legoscia/bug26427
    
    Be quiet about sockets closed during SSL upgrade

commit 8356c5ac880f407b79c01f4f656e20806a62f00f
Author: Magnus Henoch <magnus.henoch@gmail.com>
Date:   Mon Jun 29 12:38:56 2015 +0100

    Be quiet about sockets closed during SSL upgrade
    
    Log such errors on debug level only, since this is probably a TCP
    healthcheck.

commit 8bb7468784a0434921fb4424b4dfdd290a4c7a10
Merge: 3934bbd93 e2d819164
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Jun 29 14:27:31 2015 +0300

    Merge branch 'stable'

commit e2d819164703728b9dd0bdee47d58d3589e44151
Merge: ede194b2d 31173263e
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Jun 29 14:26:12 2015 +0300

    Merge pull request #201 from rabbitmq/rabbitmq-server-200
    
    rabbit_amqqueue:on_node_up/1: Check the queue's running slaves list

commit 31173263e1c34356f7e85b0268a531b85247e0f1
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri Jun 26 20:10:53 2015 +0200

    cosmetics

commit d7b18da002ceab4c1afd31aa6fa3f5828e0f8084
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Jun 26 17:35:47 2015 +0200

    rabbit_amqqueue:on_node_up/1: Check the queue's running slaves list
    
    ... before removing the node from the recoverable slaves list.
    
    This prevents a race with
    rabbit_mirror_queue_slave:record_synchronised/1, where a recoverable
    node could be removed from the recoverable slaves list.
    
    Fixes #200.

commit 3934bbd93060e2f6cd41deec4427b085c4e28502
Merge: 46d07781a ede194b2d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Jun 25 14:12:20 2015 +0200

    Merge branch 'stable'

commit ede194b2d5600b3214c7dfbd9310c560a1ce8add
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Jun 25 14:12:07 2015 +0200

    applies emacs formatting to file_handle_cache.erl

commit 46d07781a53a983f093af6ddd11b816dfea5dc1a
Merge: a4c2eeed0 4b8bcce21
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Jun 24 19:02:14 2015 +0200

    Merge branch 'stable'

commit 4b8bcce21475811d6525580838242e0529e0276f
Merge: 0802e872c 47cde19cf
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Jun 24 18:55:34 2015 +0200

    Merge pull request #199 from rabbitmq/rabbitmq-server-196
    
    file_handle_cache: Add a command to clear all read buffers

commit 47cde19cf0a4d3b771c0c168f44591dae18e50eb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 24 16:38:40 2015 +0200

    Limit clear_read_cache/0 action to the node it is running on
    
    References #196.

commit 8a485193c7a00fd6685a2ebe9175fba11fd8aa34
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Jun 23 19:19:41 2015 +0200

    file_handle_cache: Add a command to clear all read buffers
    
    This is meant to be called from `rabbitmqctl`:
      rabbitmqctl eval 'file_handle_cache:clear_read_cache().'
    
    The command sends a message to all queues on all vhosts to make them
    clear their own read cache. It is asynchronous, so the command will
    return before the action is complete.
    
    Fixes #196.

commit a4c2eeed06c9cda4e6900a9d299e8c14e782950c
Merge: ae21a368a 0802e872c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 24 07:23:00 2015 +0300

    Merge branch 'stable'

commit 0802e872c22aabfe8c65aa30beb7f2adec359d52
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 24 07:21:53 2015 +0300

    Correct a typo in 88b3a971b0f154f1415e5884bcca4afdf2221a37
    
    Spotted by @Jakauppila.

commit 2b89dbe8b0ab70cd42f4514a8f4920768feef5f8
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue Jun 23 22:42:49 2015 -0500

    Windows batch file changes to support -env, -defaults, and -conf functionality present on *nix
    
    Mimicked the behavior of the -env, -defaults, and -conf scripts
    available on *nix

commit ae21a368a0cb15dd9cfebc88710f676c44270527
Merge: 6f6c491ff a09482a3a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 23 22:38:48 2015 +0300

    Merge branch 'stable'

commit a09482a3aac1a293be1e4361d09e753789e29adc
Merge: 37628f82f f82127aec
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 23 17:34:07 2015 +0300

    Merge pull request #198 from rabbitmq/rabbitmq-server-197
    
    adds missing callback to behaviour_info

commit f82127aec3d5f2eeed276721b7be83f515891208
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jun 23 16:31:28 2015 +0200

    adds missing callback to behaviour_info
    
    Fixes #197

commit 6f6c491ff34004aa5da5c83c634f33055a95d4f8
Merge: ed66857f1 37628f82f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 23 14:53:59 2015 +0300

    Merge branch 'stable'

commit 37628f82ff48c44517dce00a7c1298888d201bd3
Merge: 677bb64ff 87927e60b
Author: Michael Klishin <michael@novemberain.com>
Date:   Tue Jun 23 14:50:47 2015 +0300

    Merge pull request #195 from rabbitmq/rabbitmq-server-194
    
    adds missing callback to behaviour_info

commit 87927e60b1c8cf4fc57926483aa37593c0fae458
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jun 23 12:34:22 2015 +0200

    adds missing callback to behaviour_info
    
    Fixes #194

commit ed66857f1f61dac4e01fef67ea3ebac00989f0bd
Merge: f0931b7dc 677bb64ff
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 18 23:48:43 2015 +0300

    Merge branch 'stable'

commit 677bb64ffd177f72d6131a8a6202b7c8a4ff6f24
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Jun 18 13:59:34 2015 +0200

    Adds error message for list_user_permissions missing argument
    
    Fixes #183

commit f0931b7dcca40e366e8272dfa403cc52493ec9b3
Merge: 1d152ce87 252ea74d4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 17 11:44:25 2015 +0200

    Merge branch 'stable'

commit 252ea74d444af3efdb9ef59c129b1f9293999e53
Merge: 40d1df780 6cf1bb2c3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Jun 17 11:43:43 2015 +0200

    Merge branch 'rabbitmq-server-191' into stable

commit 6cf1bb2c3050c57d9583982e343faa6a6d112b4f
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Jun 17 00:45:15 2015 +0200

    adds missing find_prioritisers call
    
    Fixes #191

commit 1d152ce87d127e20a791e0879ea9ec793af6fddc
Merge: ae5e61f6f 40d1df780
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 16 12:23:21 2015 +0300

    Merge branch 'stable'

commit 40d1df7807990cd75faa25555ae5c3cc09e07244
Merge: 7e3ec1388 6b85fb135
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jun 16 11:06:25 2015 +0200

    Merge pull request #187 from rabbitmq/rabbitmq-server-186
    
    Support warn as an alias for warning (the log level)

commit c22362b197f62b3a5f3549c71053a6766dd0f955
Author: Bogdan Dobrelya <bdobrelia@mirantis.com>
Date:   Mon Jun 15 17:47:05 2015 +0200

    Add OCF Pacemaker RA for HA A/A cluster
    
    Add OCF script for Pacemaker resource agent
    for dynamic membership control of the nodes
    in RabbitMQ active-active mirrored cluster.
    
    source https://github.com/stackforge/fuel-library
    v6.1-dev b9b6376cab317906af625faa5e48521aaeb0201b
    
    Co-Author: Vladimir Kuklin <vkuklin@mirantis.com>
    Co-Author: Sergey Vasilenko <svasilenko@mirantis.com>
    Signed-off-by: Bogdan Dobrelya <bdobrelia@mirantis.com>

commit ae5e61f6f7b15dc66f7885df1713d97a64090ae9
Merge: 00efc6b4a 49d9a696f
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Jun 12 23:16:35 2015 +0300

    Merge pull request #188 from weisslj/fix-digraph-type
    
    Update digraph type

commit 49d9a696ff8db9a9b28c93ebe83c3dd989699414
Author: Johannes Weißl <jargon@molb.org>
Date:   Thu Jun 11 22:16:00 2015 +0200

    Update digraph type
    
    The type digraph:digraph/0 got changed to digraph:graph/0 in OTP R16B03.
    
    To support older and newer releases a preprocessor define (with
    configure-like check) would be necessary.

commit 00efc6b4a38cb354d38a08e68297a74a515d5c98
Merge: 562a5bd16 7e3ec1388
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 11 12:28:23 2015 +0200

    Merge branch 'stable'

commit 7e3ec138816302652f00ef2e8d71876ee95bd262
Merge: 826fe750d 393602351
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 11 12:27:18 2015 +0200

    Merge branch 'rabbitmq-server-62-part1' into stable

commit 39360235188fca8727051403924226e0efda9f8b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Jun 11 12:24:09 2015 +0200

    action/5 calls action/6 with default timeout for unknown commands
    
    This restore backward compatibility and unbreak the test suite.
    
    References #62.

commit 6b85fb13513089d0c7969f3e7025f199fafb0b42
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Jun 11 12:54:03 2015 +0300

    Support warn log level (an alias for warning)
    
    As a usability improvement.
    
    Fixes #186, references #185.

commit 826fe750d418049ff8120cddb7c16a074d8959c4
Author: Johannes Weißl <jargon@molb.org>
Date:   Thu Jun 11 01:50:06 2015 +0200

    Fix set type

commit 562a5bd1698fd0161d27741b52e988ddcfd437b5
Merge: a3e4afb22 175b0dfd2
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Jun 11 11:30:15 2015 +0300

    Merge pull request #184 from weisslj/fix-set-type
    
    Fix set type

commit 175b0dfd2eb34483ac915acf00bbb2512409c0e3
Author: Johannes Weißl <jargon@molb.org>
Date:   Thu Jun 11 01:50:06 2015 +0200

    Fix set type

commit a3e4afb22877b0489fbb8c372e6b5c4c35ca274b
Merge: e758072e3 8531c9fe9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 10 11:50:39 2015 +0300

    Merge branch 'stable'

commit 8531c9fe9fdb1655154e4381e606d3c3af381d83
Merge: 2bcddc175 44f35f369
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 10 11:50:04 2015 +0300

    Merge branch 'rabbitmq-server-62-part1' into stable

commit 44f35f3693720f9e072b595d5aa5bb692dae1cd4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 10 11:34:03 2015 +0300

    Avoid float_to_list/2
    
    Not available in older Erlang/OTP releases.

commit e758072e3d28581999b6a0b8aa7b91c3e1b538cb
Merge: 0cc6b93d3 2bcddc175
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 9 20:51:39 2015 +0300

    Merge branch 'stable'

commit 2bcddc175519d8edd379c8bbecaf9c918d794361
Merge: 73f47630a 54ec4d41b
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Jun 9 18:32:02 2015 +0200

    Merge pull request #181 from rabbitmq/rabbitmq-server-62-part1
    
    Introduce a timeout flag to rabbitmqctl (for some commands)

commit 54ec4d41bb85db2afb8806032cbf93fa0c45fbf7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 9 19:05:57 2015 +0300

    Handle negative timeout values

commit fb96cdc63d7962bb0f8fc2519a111dc63c75a52b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Tue Jun 9 18:20:22 2015 +0300

    Improve timeout handling in ctl
    
     * Don't add any output when timeout = infinity (3.5.x default)
     * Support float values (round them)

commit 6961b3196fbdff4d3cdafce220a3c7dc8ebfebfb
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Mar 8 15:10:37 2015 +0300

    Mention timeout in rabbitmqctl(1)

commit ee2b30e8f7e634f8b3a3bb2ad03cebd80879c5cd
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Mar 8 14:57:14 2015 +0300

    Add timeout option to list_* commands

commit 8ac770285b464c93930c6c27ce9dd01a13fc3a62
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Jun 3 20:06:59 2015 +0300

    Make it possible to override the +A VM flag with an env variable
    
    For easier tweaking. References #178.

commit 0cc6b93d3b6773e429f1b3209c4d1df4c20243a1
Merge: 6a6c42d7e 6461dd3f3
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu May 28 06:27:22 2015 +0300

    Merge pull request #174 from rabbitmq/rabbitmq-server-163
    
    Moves boot steps to its own module

commit 6461dd3f33a9f09dc7c6c94e0178b0848d165727
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed May 20 20:36:28 2015 +0200

    moves boot steps to its own module

commit 6a6c42d7ea6bc206f97bf59b82c4d223dec2c6da
Author: Michael S. Klishin <mklishin@pivotal.io>
Date:   Tue May 26 04:12:34 2015 +0300

    Initial rabbit_writer doc essay

commit 7c85d8437159cbfaa709fd59d1611e4e26fe65f3
Merge: 7cb55202a 73f47630a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 24 22:37:32 2015 +0300

    Merge branch 'stable'

commit 73f47630aa566d6ae7f4849aa36d0243195d7713
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 24 04:24:11 2015 +0300

    (c) year

commit 7cb55202a039a4f4078bbc7217d919bb4fa05562
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 24 04:19:23 2015 +0300

    (c) year

commit 29242a376589065ccdb411246ecfaf585a9a072f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 23 07:42:06 2015 +0200

    rabbit_disk_monitor documentation

commit d59e2592320cf6fefc1e12a29eb5b39b14e38d0d
Merge: 222f184c8 f04d53ff8
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 22 15:54:09 2015 +0200

    Merge branch 'stable'

commit f04d53ff82e04891ef6121e43a8cd40a60bfed1b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri May 22 11:55:22 2015 +0100

    RPM/deb changelogs for release 3.5.3

commit 222f184c8df8ad51d49199267a3208230f00672f
Merge: ca1e4ac38 3a76c1536
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu May 21 14:08:40 2015 -0700

    Merge branch 'stable'

commit 3a76c1536748ba2a684b5e815f20bb7f8b6f29a4
Merge: 79da7e3a1 b710efcbf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 21 18:56:57 2015 +0200

    Merge branch 'rabbitmq-server-157' into stable

commit b710efcbf80867334bdffe4bd71990eafd44285d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 21 17:15:43 2015 +0200

    After starting the fhc, ensure it is working
    
    This is a runtime check to ensure the fix proposed in #157 actually
    works.
    
    Export rabbit_table:wait_timeout/0 which returns the value of
    'mnesia_table_loading_timeout' or 30000. We then use this timeout while
    waiting for the fhc test to finish.
    
    References #157.

commit ca1e4ac3873a370efed7819384c7ad41529fd57c
Merge: ec12f616e 79da7e3a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 20 18:04:07 2015 -0700

    Merge branch 'stable'

commit 79da7e3a17b07425797acbb5dfd76821799c6b69
Merge: e100e9a12 c4fd4b9d4
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 20 09:42:04 2015 -0700

    Merge pull request #165 from rabbitmq/rabbitmq-server-162
    
    Adds TLS suggestion

commit c4fd4b9d41f3cc17c11fa2a8af8b0bdfcbc9e5a3
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed May 20 18:23:26 2015 +0200

    Adds TLS suggestion
    
    Fixes #162

commit ec12f616ef026f881495f24ffc10d77ada403a3a
Merge: a003065d6 e100e9a12
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed May 20 09:44:01 2015 +0200

    Merge branch 'stable'

commit e100e9a12aef79f9b76dbd9771b2acda2f4ed916
Merge: b5cc6a041 64b133c6b
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue May 19 18:37:15 2015 +0200

    Merge pull request #160 from rabbitmq/rabbitmq-server-157
    
    Start rabbit_alarm before FHC

commit 64b133c6b3ca13b623019c689b83c22000ff9a4e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri May 15 17:23:19 2015 +0300

    Start rabbit_alarm before file_handle_cache
    
    Since the FHC now uses memory monitor, we need to make sure it is
    running early on. Nothing in rabbit_alarm really depends on the
    steps that used to run earlier.
    
    `full` test suite passes.
    
    It may be worth extracting memory and disk monitors into separate
    boot steps down the road.
    
    References #134.
    Fixes #157.

commit 789419af0fc7f08c2f44a26bf81ca5d4c104df5f
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:45 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmqctl.bat

commit d7116a6a3fce1631bb381b844ba4a4221139db62
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:33 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-service.bat

commit a88ca243430615041747a9d7ebdce5a3474e22d5
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:13:13 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-server.bat

commit 7c576e5ffaafeb03f91ee5706e39563d7cec0d0a
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:12:57 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-plugins.bat

commit f360ee47ccee0bca92c19714678b17117455d9bc
Author: Jakauppila <Jared@Kauppi.la>
Date:   Tue May 12 21:12:22 2015 -0500

    Add 'rabbitmq-env.bat' execution in rabbitmq-echopid.bat

commit a003065d6c3c73490e1f85b906936a906ebcd673
Merge: 73f10c80b b5cc6a041
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 12 18:34:24 2015 +0200

    Merge branch 'stable'

commit b5cc6a04168cf40241788e1dad0938ff7ae3ffe9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 12 16:47:53 2015 +0100

    RPM/deb changelogs for release 3.5.2

commit 73f10c80b70a35c4e7a217745dd2a982a1119c62
Merge: c139a6893 ac896b70c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon May 11 19:10:21 2015 +0300

    Merge branch 'stable'

commit ac896b70ca69c3025c0e847e4afa8d3ed92b1522
Merge: 6fc2e9ea1 46cb4eaf1
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon May 11 17:52:08 2015 +0200

    Merge pull request #153 from rabbitmq/rabbitmq-server-152
    
    Support x-death event values from before #78

commit 46cb4eaf14fcf7eff67f4bee0362e2b84ea620f7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon May 11 18:06:33 2015 +0300

    Re-format for 80 characters wide

commit 3f08241f866c01011170439b5f042f672e6f3b1a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon May 11 14:02:28 2015 +0300

    Re-format with Emacs

commit c139a6893bfad8871e52850fda89d56f19eead81
Merge: d849a364f 6fc2e9ea1
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon May 11 09:58:58 2015 +0200

    Merge branch 'stable'

commit 6fc2e9ea182b0c55d01b2271d9ba9a21e95a4a26
Merge: 18fcb1a9c 771082984
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon May 11 09:56:48 2015 +0200

    Merge branch 'rabbitmq-server-138' into stable

commit 54c63a2eeaccdd36381d12283e244e7133c6ab27
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 10 21:15:43 2015 +0300

    Use a set to look up previously seen {queue, reason} keys
    
    For O(1) lookup complexity.

commit 9a8e7b0a243daa2b3778dbf342a0229f7cfd40f9
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 10 21:04:52 2015 +0300

    Refactor

commit a61069fe9fc5a7232c2492c44ba2367e364db04a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 10 14:53:04 2015 +0300

    Refactor

commit d849a364f91ded5b9c917933db43b88f19609edb
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun May 10 00:48:21 2015 +0200

    cosmetics

commit dc9cda7f07ee4e29ba40f914900a6ff34579b3a7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun May 10 00:33:50 2015 +0300

    Support x-death event proplists from before #78
    
    We group x-death header values before processing them
    to make sure there's only one per {queue, reason}.

commit 818bbc585cf0760e2e1939aea7396e4b08c38168
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Fri May 8 15:57:48 2015 +0200

    adds missing word

commit 7710829844feecee3acb102f50e7202d3aed768e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu May 7 15:28:18 2015 +0300

    Make credit flow state transition interval 1s instead of 5s
    
    Management UI and HTTP API currently report connections and channels
    as in flow if they've been in flow for the last 5 seconds. That
    can confuse the user with inter-node flow control, making them
    believe the flow is permanent (it is not: the actual state
    toggles many times a second).
    
    This reduces the interval to 1s, which seems more reasonable and
    accurate (in a way).
    
    Fixes #138.

commit 441177b7760c9a70f72d342d18d2c9e6911f38b9
Merge: 5ad463668 a26434986
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu May 7 11:49:45 2015 +0200

    Merge pull request #139 from rabbitmq/rabbitmq-server-137
    
    Introduce conditional tracing of credit_flow events

commit a26434986308283ef505fca4525a3d2a85a2b254
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 7 11:48:02 2015 +0200

    creadit_flow.erl: Indent both TRACE_* macros the same way

commit 5ad46366823620d5d5ece8820f690905ca184768
Merge: 87aa364dc 18fcb1a9c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 7 10:13:24 2015 +0200

    Merge branch 'stable'

commit 18fcb1a9c793ac2530fa3b73b63092499120d1f0
Merge: d91b774ed f678ab5c0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu May 7 10:12:29 2015 +0200

    Merge branch 'rabbitmq-server-129' into stable

commit 87aa364dccc01b46b2c11af87788e447ea8c20b1
Merge: 7f952e6a4 d91b774ed
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu May 7 02:25:54 2015 +0300

    Merge branch 'stable'

commit d91b774edaaf051f8f7be9a0f52233265c01d94e
Merge: c29a33fd3 e0066cac5
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu May 7 02:25:27 2015 +0300

    Merge pull request #146 from rabbitmq/rabbitmq-server-134
    
    PR for rabbitmq/rabbitmq-server#134

commit 7f952e6a4569a33cab19dde32f850c265fb0470d
Merge: 65086af47 443e6fb93
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 6 17:52:45 2015 +0300

    Merge pull request #149 from rabbitmq/rabbitmq-server-148
    
    removes dictionary from the PROCESS_INFO keys

commit 443e6fb931839d76d2ceb8c455e7f5b0e70ddd26
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed May 6 16:15:09 2015 +0200

    removes dictionary from the PROCESS_INFO keys
    
    Fixes rabbitmq/rabbitmq-server#148

commit 92066c767a9cf361979f4a27194dd58a538c7786
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed May 6 14:48:20 2015 +0300

    Rename
    
    Per pull request feedback.

commit e0066cac5c443464a36b3eb4f68b9fd8fb860e38
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue May 5 22:07:50 2015 +0200

    File handle cache: Pay attention to memory use
    
    ... and clear read cache if necessary.
    
    This solves an issue where sync'ing a mirrored queue could take all
    available memory (way above the high watermark) and possibly crash the
    node.
    
    Fixes #134.

commit 65086af4762c9f4fa84a77c82dbda0c27471237f
Merge: a1afa2430 b9c2c44f9
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed May 6 01:43:28 2015 +0300

    Merge pull request #144 from rabbitmq/rabbitmq-server-143
    
    Allows credit flow Credits to be set via configuration

commit b9c2c44f9a87d0da42fd2a03b6935dfebaddeaef
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue May 5 18:02:32 2015 +0200

    Allows credit flow Credits to be set via configuration
    
    Fixes rabbitmq/rabbitmq-server#143

commit 3e936103ae7373d031c9c0f34015c69d4c811a69
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 2 14:47:43 2015 +0300

    Include more information about processes blocked by credit_flow

commit 87ce609573a5682e1788cfc0bb3b63d5637149d8
Merge: c29e7c331 a1afa2430
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 2 13:21:56 2015 +0300

    Merge branch 'master' into rabbitmq-server-137

commit c29e7c331c05940b7264b1131c1d31d04916aee6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat May 2 13:20:07 2015 +0300

    Make it possible to publish credit_flow events to rabbit_event
    
    This is not intended to be used by end users, at least not yet, so
    this is an opt-in compilation flag.
    
    To enable:
    
        make CREDIT_FLOW_TRACING=true

commit a1afa24303378b785f69856796611f056ce726b0
Merge: abc354dc3 134771351
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri May 1 14:32:41 2015 +0300

    Merge pull request #136 from rabbitmq/rabbitmq-server-135
    
    erlang:now/0 => os:timestamp/0 in credit_flow and rabbit_reader

commit 134771351b6894c2f314d3731f223537bf72a8c3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Apr 30 20:31:00 2015 +0300

    Use os:timestamp/1 instead of erlang:now/0 in credit_flow and rabbit_reader
    
    Fixes #135.

commit abc354dc34f302637098cbe94340911ae4b95ffc
Merge: 8a30408a9 c29a33fd3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 30 11:16:32 2015 +0200

    Merge branch 'stable'

commit c29a33fd39822623ef5743439ffbe1f393bff3d3
Merge: 65011cce7 53af45bf9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 30 11:15:40 2015 +0200

    Merge branch 'rabbitmq-server-128' into stable

commit 53af45bf9a162dec849407d114041aad3d84feaf
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 23 12:15:43 2015 +0200

    rabbitmq-server: Add a way to send log messages to stdout
    
    Now, by setting RABBITMQ_LOGS=-, regular log messages are written to
    stdout. Likewise, RABBITMQ_SASL_LOGS=- sends sasl log messages to
    stdout.
    
    This is useful for Docker images.
    
    Fixes #128.

commit 8a30408a93e27004c76cbb643841bd84c6af32dd
Merge: a5f3380b3 65011cce7
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 29 18:46:18 2015 +0300

    Merge branch 'stable'

commit 65011cce7c0f29d99beabfb3d24e40e47226bb2b
Merge: 3d0040ff2 35d76e0ec
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 29 18:26:04 2015 +0300

    Merge pull request #133 from rabbitmq/rabbitmq-server-114
    
    Make gm flow control configurable

commit 35d76e0ecb854ee416f1c5bd4492b5fe31f2eee0
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 29 18:03:17 2015 +0300

    Reduce number of possible values of rabbit.mirroring_flow_control

commit 0750291e797336d50d4fd12fa5489a5a51a0cb30
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 29 17:52:37 2015 +0300

    Move mirroring flow control setting into rabbit_channel:init
    
    Rename the key to make more sense, support
    true/false values.

commit a5f3380b38be2dbcae0a8844c8086bd5d37a56e6
Merge: ca3d9d274 69e6610ff
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Apr 27 16:51:26 2015 +0300

    Merge pull request #131 from rabbitmq/cosmetics-54
    
    Cosmetics 54

commit 69e6610ff1be091b0571df7b04b8a59c5b6562e8
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Apr 27 15:14:10 2015 +0200

    cosmetics

commit 8e64cf11af6507ce062034283ee918458dc1b464
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Apr 27 15:13:10 2015 +0200

    tests cleanup

commit ca3d9d2742f09bc8aee8f6a57007c6e49df921db
Merge: 2467046fb ded8554e5
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Apr 26 14:50:14 2015 +0300

    Merge pull request #130 from rabbitmq/rabbitmq-server-54
    
    Remove obsolete tests in #54

commit 2467046fb2739e5ffc0aa5a151339615326d8683
Merge: c169604de ee0945aae
Author: Michael Klishin <michael@novemberain.com>
Date:   Sun Apr 26 14:49:41 2015 +0300

    Merge pull request #54 from alexethomas/sla_tracking_v2
    
    Track and expose the timestamp property of the first msg in a queue

commit ded8554e5d9924be7103d8dc25a3989e482cb46e
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 26 13:41:59 2015 +0300

    Remove Python/HTTP API tests

commit a04d9f1dd55d8dde84fa2274ef5ae8b15f05f81d
Merge: c169604de ee0945aae
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 26 13:40:28 2015 +0300

    Merge branch 'sla_tracking_v2' of git://github.com/alexethomas/rabbitmq-server into rabbitmq-server-54

commit c169604de6f02f9703bffc8b1637f02ad22d9151
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 24 18:35:00 2015 +0300

    Warn of potentially dangerous config values

commit f678ab5c0b6c6f4ea45709877e109f3d41673f4e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 23 14:51:05 2015 +0200

    rabbitmq-script-wrapper: Don't use "exec" in front of "su"
    
    This is useless because su(1) forks a process anyway. Furthermore, it
    broke RabbitMQ in Docker.
    
    Fixes #129.

commit 548446be0b4831369f7968277485823234bfa8c2
Merge: 966db7d9d 3d0040ff2
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 20:05:03 2015 +0200

    Merge branch 'stable'

commit 3d0040ff255fe0407ab972b6a66e2f87898bd55b
Merge: 4c9c58995 1edba4a24
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 20:04:23 2015 +0200

    Merge branch 'rabbitmq-server-127' into stable

commit 1edba4a24800c2c58a865079aea118ab980df3bb
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 19:17:28 2015 +0200

    rabbitmq-env: Ignore user's RABBITMQ_PID_FILE if set by init script
    
    The user shouldn't override the init script's RABBITMQ_PID_FILE value,
    otherwise the init script erroneously reports failures to start or stop
    the service.
    
    Now, rabbitmq-env logs a warning if RABBITMQ_PID_FILE is already defined
    in the environment (ie. by the init script) and in rabbitmq-env.conf.
    
    Fixes #127.

commit 966db7d9df362d2c3dcd53e802b6a4b6b08ad367
Merge: 4ead76197 4c9c58995
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 18:35:40 2015 +0200

    Merge branch 'stable'

commit 4c9c589959901dd4ec24934b2f0bf5665d4ab083
Merge: c202878fe 25c8e772c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 18:35:18 2015 +0200

    Merge branch 'rabbitmq-server-126' into stable

commit 25c8e772c9005c9af60b59929d74c499475dd6db
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 22 18:27:56 2015 +0200

    Debian init script: Use $PID_FILE, not $RABBITMQ_PID_FILE
    
    ... because the latter is uninitialized in this script.
    
    Fixes #126.

commit 4ead7619704a769663f245713283fae19276a6a2
Merge: ff08f21b1 666fdb0af
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 17:51:12 2015 +0200

    Merge branch 'rabbitmq-server-118'

commit 666fdb0af98efe267be1409d218356dc20f691a7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 10:59:55 2015 +0200

    rabbitmq-env: Remove trailing slash from configurable paths
    
    This fixes at least one problem with $RABBITMQ_PID_FILE which, by
    default, is set to:
        RABBITMQ_PID_FILE=${RABBITMQ_MNESIA_DIR}.pid
    
    In this case, if $RABBITMQ_MNESIA_DIR ends with a trailing slash, the
    PID file is a hidden file placed in the Mnesia directory. This prevents
    auto-clustering from working and this is tricky to understand why.
    
    Fixes #118.

commit ff08f21b15e7280d2ed97e519b9c7a1d40213c54
Merge: 009cc24f4 c202878fe
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 10:57:31 2015 +0200

    Merge branch 'stable'

commit c202878fe3af75eb4455a3841b6112fa20a2ed4c
Merge: ebb99a12c 69b9bef23
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 10:56:52 2015 +0200

    Merge branch 'rabbitmq-server-120' into stable

commit 69b9bef23b5c399679e4a403e3703176685eebfc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 10:55:19 2015 +0200

    rabbitmq-env: Use "$path" in rmq_realpath(), not "$dir"
    
    ... which does not exit.

commit 009cc24f45d4941078bf9a0603f496d570f64dfa
Merge: b808b3350 ebb99a12c
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 09:54:19 2015 +0200

    Merge branch 'stable'

commit ebb99a12cc6415694998d7cf16f11fbeb7a22156
Merge: 50597aa11 d12654a32
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Apr 21 09:53:54 2015 +0200

    Merge branch 'rabbitmq-server-120' into stable

commit d12654a320ffd80a394ad4fac6720231bfadabc9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Apr 20 19:07:06 2015 +0200

    rabbitmq-env: Check the Mnesia directory is not used for other purposes
    
    If this is the case, log a warning to stderr.
    
    Here is an example with the plugins expansion directory:
        WARNING: RABBITMQ_PLUGINS_EXPAND_DIR is located inside RABBITMQ_MNESIA_DIR
                 => Auto-clustering will not work ('cluster_nodes' in rabbitmq.config)
    
    And with the log directory:
        WARNING: RABBITMQ_LOG_BASE is equal to RABBITMQ_MNESIA_DIR
                 RABBITMQ_LOGS is located inside RABBITMQ_MNESIA_DIR
                 RABBITMQ_SASL_LOGS is located inside RABBITMQ_MNESIA_DIR
                 => Auto-clustering will not work ('cluster_nodes' in rabbitmq.config)
    
    Fixes #120.

commit b808b3350ba9baf59db5c9c5957b92074d86e1e4
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 17 17:07:38 2015 +0300

    Update README.md

commit 0b91553bafde0e063714b9557a1a76dc5213163b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Apr 16 22:28:18 2015 +0300

    Make gm flow control configurable
    
    Fixes #114.

commit 341d1a2b3b2abf79bae27853a994073b04cbf42f
Merge: e0ae7d186 733ff77a6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 15 21:00:18 2015 +0300

    Merge branch 'authz_socket_info'

commit 733ff77a6707cd06241fd2470c83674254f7abed
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 15 21:00:04 2015 +0300

    Correct typespec

commit 76dacb2051e637526dccc4c0407cf42a8a40c5b4
Author: Petr Gotthard <petr.gotthard@honeywell.com>
Date:   Wed Apr 15 21:07:22 2015 -0700

    Implement authz_socket_info structure passed to authorization plugins.

commit e0ae7d1867092267a99c1e1a2fac16d7dce98dde
Merge: 7edbc713e 50597aa11
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 15 17:26:56 2015 +0300

    Merge branch 'stable'

commit 50597aa117bf2017fa4a66b2de67feda3f5d7c41
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Apr 15 01:16:19 2015 +0200

    adds start.boot to bin folder for mac-standalone release
    
    This file is required by rabbit_nodes:ensure_epmd/0 in order to be
    able to programatically start epmd
    
    Fixes rabbitmq/rabbitmq-server#96

commit 7edbc713e05136d8ab4b0695dd6c1ae4e84fe426
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Apr 15 01:16:19 2015 +0200

    adds start.boot to bin folder for mac-standalone release
    
    This file is required by rabbit_nodes:ensure_epmd/0 in order to be
    able to programatically start epmd
    
    Fixes rabbitmq/rabbitmq-server#96

commit 0ec473d283127084b127f1f5292e4fd7af7a1ebc
Merge: f05117586 de4975289
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Apr 15 09:32:15 2015 +0300

    Merge branch 'stable'

commit de49752892174188480d9029b24b7307157e4d53
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Apr 14 23:19:58 2015 +0200

    adds OTP_VERSION to standalone mac
    
    Fixes rabbitmq/rabbitmq-server#106

commit f05117586bdd0e80411bba00a12af07fcfb85285
Merge: 484157671 e49da380a
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Apr 15 07:40:05 2015 +0300

    Merge pull request #107 from rabbitmq/rabbitmq-server-106
    
    adds OTP_VERSION to standalone mac

commit e49da380acc916d33c25e9f3a8037de2e4d4c5b5
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Tue Apr 14 23:19:58 2015 +0200

    adds OTP_VERSION to standalone mac
    
    Fixes rabbitmq/rabbitmq-server#106

commit ee0945aae3b7cffcfbf6f993d488cde08be17e7b
Author: Alex Thomas <alext@lshift.net>
Date:   Mon Apr 13 17:51:56 2015 +0100

    Extract DELIVERY_MODE and DURABLE to globals

commit 0d2772e359008734df2baa65143a69f1696dc613
Author: Alex Thomas <alext@lshift.net>
Date:   Mon Apr 13 13:49:21 2015 +0100

    Temporary addition of Python test script to help track down initially-blank head_message_timestamp problem

commit 484157671cc7826b354dccb925573195870509ad
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 11 21:43:43 2015 +0300

    Move timestamp() to rabbit_types

commit 99e5127352be24795f9708efb8ca46ab277458af
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 11 20:57:08 2015 +0300

    Clarify

commit a3bf23ac6148dcf47dc3fc965dcea449f5fb378a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 11 20:36:14 2015 +0300

    Minor improvements to rabbit_msg_store docs

commit bbd7037c09698110b0d71294aba0dea3a650c3a2
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 11 19:47:56 2015 +0300

    Reformat docs
    
    To allow for more detailed descriptions and follow
    the same style we have in multiple other places.

commit b7df4cdbfdb92f91371b14f97baa595bab1597cc
Merge: 58749727d dc6c9b027
Author: Michael Klishin <michael@novemberain.com>
Date:   Fri Apr 10 21:24:34 2015 +0300

    Merge pull request #103 from rabbitmq/rabbitmq-server-88
    
    PR for rabbitmq/rabbitmq-server#88

commit 41e3f06557256435791fd948ace2afbd4c727df5
Author: Alex Thomas <alext@lshift.net>
Date:   Wed Apr 8 10:36:17 2015 +0100

    Add tests for head message timestamp queue statistic. Distinguish the former statistics tests as channel (_ch) statistics. Expand name.

commit 08c30f6d06ce1f2c6ae65b85a943f1f141cc887d
Author: Alex Thomas <alext@misshelpful>
Date:   Wed Feb 25 14:46:57 2015 +0000

    Update rabbitmqctl doc to include head_msg_timestamp stat.

commit 57af33f1c92b3d92c910df1abe35507f82d1df2f
Author: Alex Thomas <alext@misshelpful>
Date:   Wed Feb 25 14:32:48 2015 +0000

    Change head_msg_timestamp to peek at all internal queue heads and find the oldest timestamp among them instead of taking the first found as per PR comment #7.

commit d899179f39172e5ee26918a1d222f240c9087861
Author: Alex Thomas <alext@misshelpful>
Date:   Wed Feb 25 12:02:42 2015 +0000

    Move head_msg_timestamp from backing_queue_status property to top-level queue stat as per PR comment #7.

commit f5cf81ede57c7b616f6c14893613a7e58fd983f1
Author: Alex Thomas <alext@misshelpful>
Date:   Wed Feb 25 11:15:33 2015 +0000

    Remove head_msg_timestamp from #vqstate as per PR comment #2 as this is a relic from a previous version of the change.

commit 2cc6030e2066013727ae47db6307046a7bd39c54
Author: Alex Thomas <alext@misshelpful>
Date:   Tue Feb 24 14:33:48 2015 +0000

    Track and expose the AMQP Timestamp property of the first (usually oldest) message in a queue.

commit 58749727df061836f7808b934a549fe4b00b670b
Merge: 588b64e22 6a0ef65e4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Apr 10 17:47:33 2015 +0200

    Merge branch 'stable'

commit 6a0ef65e490f2a2b0a1ac662bfca9489b320efa1
Merge: 5aba7d2a6 78efd9024
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Apr 10 17:46:53 2015 +0200

    Merge branch 'rabbitmq-management-33' into stable

commit 78efd9024dc5fda41f852c585f15bf43dd3ea55b
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 10 16:53:53 2015 +0300

    Add rabbit_misc:get_env/3
    
    This is the same as application:get_env/3, but this one was only added
    to Erlang R16.
    
    References rabbitmq/rabbitmq-management#33.

commit 588b64e2262b3566cde101474d72a91f1cb80305
Merge: f836be3e3 5aba7d2a6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 9 16:01:39 2015 +0200

    Merge branch 'stable'

commit 5aba7d2a60f1668bde337ab2452a53ce8e597325
Merge: b9e62d58f 381bf067b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 9 16:01:19 2015 +0200

    Merge branch 'rabbitmq-server-66' into stable

commit 381bf067b5be77f513e9fff18ffb9d32c910b505
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Apr 9 15:59:30 2015 +0200

    rabbitmq-script-wrapper: Escape '$' characters in arguments
    
    Fixes #66.

commit dc6c9b0275ab5b8a9689b4730aeb9e7d0fd37875
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Apr 8 11:52:50 2015 +0200

    rabbitmq-env: Prevent multiple load of the script
    
    This doesn't happen today but it could be the case in the future, now
    that the init scripts are sourcing it too.
    
    References #88.

commit f836be3e3aecbb1cf48ec1f18a4be58de4b97546
Merge: b71f39ffd d21307197
Author: Michael Klishin <michael@novemberain.com>
Date:   Mon Apr 6 23:28:45 2015 +0300

    Merge pull request #99 from dallasmarlow/bounded-gc-backoff
    
    prevent unbounded gc interval backoff

commit d213071976cdfb0b785105d2793dcb48ad8d6e80
Author: Dallas Marlow <dallas@vineapp.com>
Date:   Mon Apr 6 12:33:23 2015 -0400

    max gc interval backoff bounded by specifying a max interval of 4x the ideal interval

commit b71f39ffdb342c384894680bdefff3e59352c317
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 5 05:13:30 2015 +0300

    rabbit_channel documentation improvements

commit a41c4692d7317fd7bdda1ce08db4683ec0148901
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sun Apr 5 03:13:27 2015 +0300

    rabbit_reader documentation improvements

commit ab906a43213f586a53dbf0a86265993ba06879d6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 4 15:55:33 2015 +0300

    Restore a single line README
    
    Source package build process assumes it exist,
    so keep it around but only with links to learn more.

commit 9e08000481ea8426d54354308d74dacd223737d6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 4 01:36:35 2015 +0300

    New README.md

commit 0e467f577867fb277db3ccc732bfd7c2b673afc6
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Sat Apr 4 00:57:14 2015 +0300

    Briefly document rabbit_reader records

commit f8636a8441a5f5ef075cfb2284dd930b5c0ded65
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 3 22:01:54 2015 +0300

    Doc comment

commit 797ee7fa0794f60d96fa7c5bf780853b78de2ef3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Apr 3 16:27:04 2015 +0200

    Init scripts: Honor RABBITMQ_LOG_BASE for {startup,shutdown}_* location
    
    Before this change, they were written to /var/log/rabbitmq, no matter
    the value of RABBITMQ_LOG_BASE.
    
    In rabbitmq-env, allow the caller to set RABBITMQ_SCRIPTS_DIR to the
    directory where rabbitmq-env and rabbitmq-default are located.
    
    In both Fedora and Debian rabbitmq-server.init and
    rabbitmq-script-wrapper, load rabbitmq-env and use RABBITMQ_LOG_BASE.
    The default value is /var/log/rabbitmq, so the default behaviour remains
    the same.
    
    In Debian's rabbitmq-script-wrapper version, use RABBITMQ_LOG_BASE
    instead of the hard-coded /var/log/rabbitmq.
    
    Fixes #88.

commit c5a3e04772d281386cb7a90e4bf2c8a15ed43000
Merge: cf4ad7d6b b9e62d58f
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Apr 3 12:30:16 2015 +0300

    Merge branch 'stable'

commit b9e62d58fa9963090cd16d8e0cb8f15f08dc7804
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Apr 3 08:23:11 2015 +0100

    Commit package changelogs for 3.5.1

commit cf4ad7d6bafe27ba9557bafbfbe6de1ff8317694
Merge: 6ec20ab9f 4fdd61b9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 30 14:17:28 2015 +0100

    Merge branch 'stable'

commit 4fdd61b9c68b911b7d8c35bed385fb2167f173fa
Merge: c4c4dc00a bd4f8aec7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 30 14:17:15 2015 +0100

    Merge branch 'rabbitmq-server-86' into stable

commit bd4f8aec7edf5c295d24adf3edf0cebe3d6e8449
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 30 13:51:03 2015 +0100

    erase_ch/2 should return ctags for just the erased channel, not all of them.
    This was not noticed for a long time because the only use of those ctags
    was to emit consumer_deleted events which were handled by the management
    database, and it ignored invalid {channel, ctag} combinations.
    However, it did end up doing more work - and closing n channels out
    of m became O(nm) instead of just O(n). References #86.

commit 6ec20ab9fc3fdad7d0574d646d6caad4a8c2600a
Merge: f1838bb90 fecbd448b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 27 12:18:48 2015 +0000

    Merge branch 'pull-request-83-fixups'

commit fecbd448b81d16a154a05fb5c5c64772f3725b31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 27 12:16:52 2015 +0000

    Minor tidy-ups
    Reify the default pool name a bit more, rename DEFAULT_SERVER to
    DEFAULT_POOL since that's what it identifies.

commit f1838bb90c94fdf522fdb246e01a2c97841082de
Merge: ada55d3d3 c4c4dc00a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 26 12:29:07 2015 +0100

    Merge branch 'stable'

commit c4c4dc00acf3375eee5dfdb572d27e0a91f75061
Merge: e0cd6f114 47ef08130
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Mar 26 12:25:42 2015 +0100

    Merge pull request #79 from rabbitmq/rabbitmq-server-78
    
    Limit x-death growth to one entry per queue

commit 47ef081300486551ebc07954b21bb0e329a12058
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 26 12:21:21 2015 +0100

    rabbit_dead_letter.erl: Fix shadowing of variable 'Info'
    
    While here, wrap long lines to fit 80 columns.
    
    References #78.

commit e0cd6f11440b48f284494c2752c7a3fb081beebf
Merge: 612745989 925356f7a
Author: Jean-Sébastien Pédron <jean-sebastien.pedron@dumbbell.fr>
Date:   Thu Mar 26 11:53:22 2015 +0100

    Merge pull request #82 from rabbitmq/rabbitmq-server-72
    
    PR for rabbitmq/rabbitmq-server#72

commit 61274598921dd35d3566a373333ec95d3f75d7af
Merge: 811430405 619e58245
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Mar 26 13:47:25 2015 +0300

    Merge pull request #81 from rabbitmq/rabbitmq-server-74
    
    PR for rabbitmq/rabbitmq-server#74

commit 632059acb473b0b2d64d01bc551449d615b6d37c
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Thu Mar 26 00:21:18 2015 +0300

    Refactoring, x-death.counter => x-death.count

commit 0ef3053ffa05b1ec042556507b14a2fdb9a4135a
Merge: f6dcdf11d ada55d3d3
Author: Alex Thomas <alext@lshift.net>
Date:   Wed Mar 25 17:42:55 2015 +0000

    Merge branch 'master' into reusable-worker-pool

commit 925356f7ad5997bf6179518e3b81fd728a639c9a
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 25 16:25:14 2015 +0100

    rabbitmq-server.ocf: Pass ${RABBITMQ_PID_FILE} to "rabbitmqctl stop"
    
    Submitted by jmcmeek on GitHub.
    
    Fixes #72.

commit 462e2b0f28dc105706a91a99b16a7d10ddf0c6c3
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 25 01:30:36 2015 +0300

    Identify x-death events by {queue, reason}, add a counter

commit f6dcdf11dccff7e249a4ff5b502c3ee42a96e8b3
Author: ash-lshift <ash@lshift.net>
Date:   Tue Mar 24 17:45:04 2015 +0000

    allow multiple instances of worker_pool

commit 619e58245f9d912fe7db915cbb2097483c6cb72f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 24 15:58:25 2015 +0100

    Add 'channel' as a new log category
    
    For instance, one can use the following configuration to disable
    messages related to channels:
      [
        {rabbit, [
          {log_levels, [{channel, none}]}
        ]}
      ].
    
    References #74.

commit ada55d3d3f04e909b267b69251a4de12148b69de
Merge: 1234a9aa1 811430405
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 23 17:55:36 2015 +0100

    Merge branch 'stable'

commit 8114304057647986ed212658657dc2f2d51b488b
Merge: 8e2ae9df6 f1945c0d5
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 23 17:52:58 2015 +0100

    Merge branch 'rabbitmq-server-69' into stable

commit f1945c0d506a112788b4aaa604271734f894b593
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 20 13:40:49 2015 +0000

    Improvements to tune_read_buffer_limit
    
    Take into account the size of the current read if appropriate, add an
    extra byte when shrinking so next time we know how we did, and fix
    comments all round.
    
    References #69.

commit 6048843ae9dafa004641400a22990e81a06f70e3
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 20 10:28:59 2015 +0100

    file_handle_cache: Remove the "no read buffer" comment in the essay
    
    While here, fix two typos.
    
    References #69.

commit 73e12734e799696ce72b735baa7a6daf8bb38118
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 16:39:09 2015 +0000

    Tune the read buffer size to prevent pathological behaviour
    ...such as when we are reading backwards through a file. References #69.

commit 8124e3ce7616eeff440750dd6c55b6b938c7e234
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Fri Mar 20 14:38:11 2015 +0100

    Limit x-death growth to one entry per queue
    
    Otherwise the list can grow forever in some cases.
    
    Fixes #78.

commit 1234a9aa11fa8a833005767cff4cc4ce75920725
Merge: 1a4ddb316 8e2ae9df6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 18 15:26:13 2015 +0100

    Merge branch 'stable'

commit 8e2ae9df61da376607624a871ee09fb134746560
Merge: 397e5a1f1 65c68775d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 18 15:24:40 2015 +0100

    Merge branch 'rabbitmq-server-68' into stable

commit 65c68775d0381d3e346e13881c4601222d5b84e4
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Mon Mar 16 18:13:30 2015 +0100

    Alter RabbitMQ database directory permissions for .deb and .rpm packages
    
     * Revoke group writing permission
     * Revoke all "others" permissions
    
    References #68.

commit 1a4ddb316d3c719c6c9e76970cce69bc2b906000
Merge: 7803bd29e 397e5a1f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 16:48:02 2015 +0000

    Merge branch 'stable'

commit 397e5a1f1dd8134e559bde969d6bb09f8a2418ee
Merge: 73f2188d5 2699e4816
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 16:46:17 2015 +0000

    Merge branch 'rabbitmq-server-65' into stable

commit 73f2188d5c2d3b84fc9ffb1a05d4b5bfc82e7b5d
Merge: 17a5da8f0 be901c15d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 16:46:12 2015 +0000

    Merge branch 'rabbitmq-server-67' into stable

commit 2699e48167d852af5c4eb8cbb49381ba6e49748f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 13:22:35 2015 +0000

    Make sure we have the properties before trying to use them. References #65.

commit be901c15d817f4e31b5563ca582e6ff6b39c78e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 13 12:52:10 2015 +0000

    Priority queue ram_duration/1 should be the minimum of sub-queues', not the sum. (References #67)

commit 7803bd29ead635464b9f780388c2ffdea83a8a61
Merge: 578cfc191 17a5da8f0
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 11 16:27:08 2015 +0100

    Merge branch 'stable'

commit 17a5da8f085e4d4acb349fc41ceca0e923ac67d3
Merge: e03e7da31 578cfc191
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 11 16:17:25 2015 +0100

    Merge branch 'master' into stable

commit 578cfc1916a4b6a8202b2f4698e35eb76942f061
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 11 14:34:01 2015 +0000

    Deb changelogs for release 3.5.0 (rerolled)

commit ef9420c928a853272b7c5d532e618f3d51a91cee
Merge: c4cd61709 0ecbdddce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 11 13:19:13 2015 +0000

    Merge branch 'bug26638'

commit 0ecbdddce7d941089be013b4013515883e2729e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 11 13:13:20 2015 +0000

    More reliable way to find the erl executable.
    The old way did not work if erl was not in ${ERLANG_HOME}/bin. The new way
    looks like it should only work if erl is on the ${PATH} - but in fact
    the Erlang VM arranges things so that is always true!

commit c4cd61709b7981684fdf05c099de54951ca44193
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 11 11:34:54 2015 +0000

    RPM/deb changelogs for release 3.5.0

commit 0925f337170a0fa65cf9db6b7ff4428d869023a1
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Mar 11 09:53:20 2015 +0300

    Ignore ./etc/*

commit 06717cc265e8dc2b2fb4293278089203f09d2a8a
Merge: d538f7d95 105ebce7b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 10 11:44:55 2015 +0000

    Merge branch 'bug26636'

commit 105ebce7b6de3655cf1324f11f1efb81e93e3eed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 10 11:41:41 2015 +0000

    Rename things to be slightly clearer

commit 2e5e31494938dea19b2827c5252f7ac2ce9c2d8b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 9 13:07:07 2015 +0100

    rabbit_node_monitor: Exclude Mnesia-synced nodes when clearing partitions
    
    Otherwise, in handle_dead_rabbit(), if the specified node is already
    back in the cluster, "partitions" will not be emptied.

commit 7b38a63dac57326ae2835c2af463245ff43a333b
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 9 13:00:00 2015 +0100

    rabbit_node_monitor: In handle_dead_rabbit(), consider node down once
    
    ... in pause conditions, especially if the remote node is back in the
    cluster already.
    
    This gives the node a chance to enter a pause mode. Without this,
    partitions may never be fixed.

commit e759f8fbe39f4d8a2156925745d987cdcaf7feb7
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Mon Mar 9 12:55:44 2015 +0100

    rabbit_networking: In on_node_down(), don't remove listeners if node is back
    
    If the node is already back in the cluster at the time
    rabbit_networking:on_node_down() is called don't remove the specified
    node's listeners. Otherwise, we would loose the record from the entire
    cluster, creating an inconsistency between the running listeners and the
    recorded ones.

commit d538f7d95646a7a9527c9f05ee274768a758a266
Merge: e16cac646 608217292
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 6 13:51:39 2015 +0000

    Merge branch 'bug26633'

commit e16cac646b613c1cf01827c6aba4c5c031d83eee
Merge: 3efe93904 8e72bf577
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Mar 6 14:18:12 2015 +0100

    Merge branch 'bug26632'

commit 8e72bf57766c7d08c560b98b875e15effbe0d4fc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 5 10:48:17 2015 +0100

    Autoheal: Wait for current outside app. process to finish
    
    rabbit_node_monitor:run_outside_applications/2 gains a new argument to
    indicate if the caller is willing is let a possible current outside
    application process to finish before its own function can run. If this
    argument is false, the current behaviour is kept: the function is not
    executed.
    
    This fixes a bug where autoheal's outside application function was not
    executed if pause_if_all_down's outside application function was still
    running (ie. rabbit:start() didn't return yet). The bug caused the
    loser to not stop and thus the autoheal process to never complete.
    
    Now, the autoheal outside application function waits for the
    pause_if_all_down function to finish before stopping the loser.

commit 60821729247e6fe6ac66fdeec88a7d188de0d6e9
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 5 16:49:48 2015 +0100

    Partial partition: Don't act if pause_if_all_down is about to pause
    
    At least, this fixes the following crash, when the partial partition
    detection tries to close the connection while RabbitMQ is stopping:
    
    ** Reason for termination ==
    ** {timeout,{gen_server,call,
                            [application_controller,
                             {set_env,kernel,dist_auto_connect,never}]}}

commit 3efe9390419c3a842b74423387a621897fc0b820
Merge: 3625fbeb8 da57a42a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 5 12:01:45 2015 +0000

    Merge branch 'bug26628'

commit 3625fbeb85b7903c30ca5790e7cc10de2310a9d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 5 10:42:44 2015 +0000

    Add more explanatory text for timeout_waiting_for_tables

commit da57a42a26f82bce2205996d5b3870da55ae5368
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Mar 5 11:13:05 2015 +0100

    Autoheal: Add a restart_loser/2 function
    
    ... and simplify the handle_msg({winner_is, _}, ...) clause.

commit f71d6945856df3a224ff867cc30ce7d08c6feb90
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 4 20:44:08 2015 +0100

    Autoheal: Document the protocol change
    
    While here, document the message flow.

commit b89e64bab82f461e7f60d5a0fd7bda2f659c8750
Merge: 945b04fde 9fcb31f34
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 4 16:58:06 2015 +0100

    Merge branch 'bug26631'

commit 9fcb31f348590a74fd526333cf881cfbe27241e6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 4 15:28:39 2015 +0100

    Workaround "global" hang
    
    In rabbit_node_monitor:disconnect/1, we change the "dist_auto_connect"
    kernel parameter to force a disconnection and give some time to all
    components to handle the subsequent "nodedown" event.
    
    "global" doesn't handle this situation very well. With an unfortunate
    sequence of messages and bad timings, this can trigger an inconsistency
    in its internal state. When this happens, global:sync() never returns.
    See bug 26556, comment #5 for a detailed description.
    
    The workaround consists of a process who parses the "global" internal
    state if global:sync/0 didn't return in 15 seconds. If the state
    contains in-progress synchronisation older than 10 seconds, the
    spawned process sends fake nodedown/nodeup events to "global" on both
    inconsistent nodes so they restart their synchronisation.
    
    This workaround will be removed once the real bugs are fixed and
    "dist_auto_connect" is left untouched.

commit 14821c6ead2ac2441ba61ef470640eb618716a92
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Wed Mar 4 11:24:21 2015 +0100

    Autoheal: The leader waits for "done!" message from the winner
    
    Before, the leader was monitoring the losers itself (exactly like the
    winner). When they were all down, it was going back to the "not_healing"
    state.
    
    Therefore, there was a possibility that the leader and winner went
    out-of-sync regarding the autoheal state.
    
    Now, the leader simply waits for a confirmation from the winner that the
    autoheal process is over. If the leader is a loser too, the autoheal
    state is saved in the application environment to survive the restart.
    When the leader is back up, it asks the winner to possibly notify it
    again.

commit 945b04fdeb7a3a3113b8cb88ea8777d4b807b65a
Merge: 989cde8ec e03e7da31
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 3 17:40:07 2015 +0100

    Merge branch 'stable'

commit e03e7da3115c54e8a7ca54ad3cc2c4c74f7ed417
Merge: 280de0c58 3b3aa4872
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 3 17:33:07 2015 +0100

    Merge branch 'bug26622' into stable

commit 3b3aa4872af7c7baa7d07f22edcadecf7b0a144d
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Mar 3 17:14:16 2015 +0100

    rabbit_node_monitor: Cache pause_minority_guard() return value
    
    If the list returned by `nodes()` didn't change since last call to
    `pause_minority_guard()`, return the previous state, not `ok`.
    
    This fixes a bug where the first call to `pause_minority_guard()` could
    return `pausing` but the subsequent calls would return `ok`, leading to
    channels resuming the send of confirms even though the node is about to
    enter pause mode.

commit 989cde8ec1e3fe7b51cb2d0c8c7643f8a4e68886
Merge: 1645f2218 280de0c58
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 17:31:16 2015 +0000

    Merge branch 'stable'

commit 280de0c58d388b1eb21a153f8dc8e94aa0a2c3f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 17:30:52 2015 +0000

    Fix tests, the exceptions are a bit cleaner now (bug26610)

commit 23f3e71463a47a6783bc9421f34c596e713e65b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 17:30:16 2015 +0000

    Further cleanup of boot exception handling (bug26610)
    OK, the previous attempt was a bit misguided. Rather than catch any
    exception "inside" starting an app, log it and rethrow a token saying
    no further logging is needed, let's just let the exception bubble out
    and catch it once at the top level.

commit 1645f2218307244b468db9d9a438248c32b38bb7
Merge: 4bf9863f5 c75777c80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 15:09:08 2015 +0000

    Merge branch 'stable'

commit c75777c8033ffabbac30c39d66757ffeb58b7aff
Merge: 6bb8fcbd5 db0aaf821
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 15:08:47 2015 +0000

    Merge branch 'bug26610' into stable

commit 4bf9863f5ff28f6e71e3174ff25986b937e23edd
Merge: cda9634d2 6bb8fcbd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 15:06:54 2015 +0000

    Merge branch 'stable'

commit db0aaf821c7f41810bd7f2a452205548633355b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 14:54:58 2015 +0000

    Detangle boot error handling, step 2
    We used to have a weird situation where an error inside a boot step
    would cause us to go through error logging twice. The exception would
    get caught in run_step/3, then go through boot_error() etc, and
    basic_boot_error/3 would exit again, leading to more stuff being
    logged as an application start failure. So to fix that, let's
    exit with a special atom which prevents further logging. Also
    rename functions to be a bit more meaningful.

commit cfc289b72cfc2619b4694fe13fa100c64d328018
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 26 14:48:28 2015 +0000

    Detangle boot error handling, step 1
    We want to clean up basic_boot_error/3, but these call sites make it
    harder. Really, trying to produce nicely formatted errors here is a
    waste of time, these errors can only be caused when adding boot steps.
    Normal users should never see them. So don't complicate things by
    handling them specially.

commit cda9634d2005284204ba347f08756f159e684b3d
Merge: 3cf1d5bd0 d4a78fefa
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 26 12:09:55 2015 +0300

    Merge pull request #52 from jeckersb/sd_notify-for-upstream
    
    Add systemd notification support

commit d4a78fefa56283bdf41044e2cb7b5daebb02fa0e
Author: John Eckersberg <jeckersb@redhat.com>
Date:   Wed Feb 18 16:11:12 2015 -0500

    Add systemd notification support

commit 3cf1d5bd0fffd535643245f7ae0cc1325c17461b
Merge: bdf92102a 484322f97
Author: Michael Klishin <michael@novemberain.com>
Date:   Wed Feb 25 21:31:18 2015 +0300

    Merge pull request #55 from rabbitmq/bug26614
    
    When ERLANG_HOME is not set, exit with code 1

commit 484322f97fbc64469b4c2d25b197a399919bf74a
Author: Michael Klishin <mklishin@pivotal.io>
Date:   Wed Feb 25 21:19:16 2015 +0300

    When ERLANG_HOME is not set, exit with code 1

commit b1cfedc71209a9fe91016b90107ac2e3639eab43
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 23 16:10:39 2015 +0000

    Fix clearer timeout_waiting_for_tables error message
    
    ...and replace {boot_step, _, _} wrapping with an extra parameter which
    might make it harder to make similar mistakes in future.

commit bdf92102a7094a2c80e2bb52ea2cc69226795f36
Merge: bcb88a2e5 be037e002
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 23 15:18:06 2015 +0000

    Merge branch 'bug26465'

commit 6bb8fcbd5da3d3652716a1321d19a009702900b3
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 21 01:03:08 2015 +0300

    Ignore etags
    
    Conflicts:
            .gitignore

commit bcb88a2e53ac7e2c63e5a5cbf7346c193992cf1b
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Sat Feb 21 01:03:08 2015 +0300

    Ignore etags

commit be037e00261e6b15f9236c24f9fe675b7158a981
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Fri Feb 20 15:35:30 2015 +0100

    pause_if_all_down: Remove configuration check
    
    No part of RabbitMQ does this type of checking, as pointed out by Simon.

commit 22608609ea1db7be38f835507c33e8dbcdb7ad3d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Fri Feb 20 17:07:28 2015 +0300

    Sync CONTRIBUTING.md with the template one

commit 57c53d25a26164f87e69c4d872f3816509b3c86e
Merge: f8b8a704c a614670cc
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 19 18:15:50 2015 +0100

    Merge branch 'stable'

commit a614670cca2825f94f4b385269279e7ba6c6628f
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Feb 19 17:26:01 2015 +0100

    Convert .hgignore to .gitignore

commit f8b8a704c8304fc9e446987205c288f39369309a
Merge: bcda9c57e 9e040aa3e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 19 14:07:04 2015 +0000

    Merge remote-tracking branch 'origin/master'

commit bcda9c57ec4a2ff17b3a4e20a7e963836bc1f45c
Merge: b87d3447f 1bc340d81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 19 12:06:46 2015 +0000

    Merge branch 'bug26603'

commit 1bc340d81faff82d4b415e34f20bc7990390e995
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 19 11:44:40 2015 +0000

    Fix O(n^2) time to ack / requeue multiple messages.
    
    orddict:append/2 uses ++ internally to build the list in the correct
    order, which is O(length). So it's O(n^2) to call it n times. Instead
    let's build the list backwards then reverse it - O(n).

commit 9e040aa3e883f91373f0045c3bf8d6cceee4f83d
Merge: b87d3447f 1524940df
Author: Michael Klishin <michael@novemberain.com>
Date:   Thu Feb 19 13:13:14 2015 +0300

    Merge pull request #53 from nilcons-contrib/fix-typo
    
    Fix a hilarious typo in the example config

commit 1524940df4a3722264faf2e553121eac438d3432
Author: Mihaly Barasz <klao@nilcons.com>
Date:   Thu Feb 19 11:10:29 2015 +0100

    Fix a hilarious typo in the example config

commit b87d3447fd0e1d863eefe5bf1568306068737bf3
Merge: f21c564a7 1795a95ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 18 14:25:24 2015 +0000

    Merge branch 'bug26602'

commit 1795a95ed47847c00e94281f6d7ad68ca3bdaf3b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 18 14:22:21 2015 +0000

    Record the routing decision on published messages.

commit f21c564a790fe59bc2f7737bf7098fa180644c3d
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 18 00:19:02 2015 +0300

    Sync CONTRIBUTING.md with the template one

commit 817b3a3fc8152387542020261d15db8caac5cbb2
Author: Michael Klishin <michael@clojurewerkz.org>
Date:   Wed Feb 18 00:07:25 2015 +0300

    Sync CONTRIBUTING.md with the template one

commit 1413db82cf33fa654e82e72d3caf44e52ee521bb
Merge: cf7735b7a 460b0535e
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 21:01:14 2015 +0100

    Merge branch 'stable'

commit 460b0535e82a7075f2479d9c9a51a279a07129e6
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 20:59:50 2015 +0100

    Remove the "moved to GitHub" warning.

commit cf7735b7ad04c4caf00342fc6781172424274f6e
Merge: 2ed75d627 bc26a6738
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 20:34:27 2015 +0100

    Merge branch 'stable'

commit bc26a6738c3c6600ee41d5be5384e4c0f2ebbcb5
Merge: 141806252 8b6d020e4
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 20:34:11 2015 +0100

    Merge branch 'bug25547' into stable

commit 2ed75d627b45f3659e7589877c5390c9699b72f9
Merge: 38b8c301e 141806252
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 17:28:45 2015 +0100

    stable to default

commit 1418062522b03da0fe6c19358f588724d6260b6d
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 17 17:28:06 2015 +0100

    README: Warn about the move to GitHub

commit 38b8c301eeb5450e5d80937dd958b402b61a5135
Merge: 2f1a59b34 9631d4ba1
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 17 16:23:32 2015 +0300

    Merge heads of default

commit 2f1a59b34955bb936893de1bb5c5fc8a5caba911
Merge: 43ee99532 6f13eca56
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 17 16:19:09 2015 +0300

    merge bug26183 into default

commit 43ee995321158771a665081e3992cae9e4db9582
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 17 15:07:58 2015 +0300

    A few overview comments

commit 8b6d020e49e36fca6c5e68cc60596f09bed3dd8b
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Feb 16 15:42:30 2015 +0100

    rabbitmq.config.example: Send people to GitHub, not hg.rabbitmq.com

commit 9631d4ba17e0700430cf1ac8c1754d5030432bf3
Merge: 5513bea06 6f13eca56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 16 12:05:57 2015 +0000

    stable to default

commit 5513bea062f194dac2d33076eccec4dfc53b0283
Merge: 805d99a9b 7c69f4f6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 16 12:05:22 2015 +0000

    Merge bug26595

commit 7c69f4f6cd41d218dcdae63a8a6b3bea5baa89cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 16 12:05:11 2015 +0000

    Ignore all errors here (just as we do in ssl_info/2) - for example the socket could be closed; no point in blowing up if that is the case.

commit 73a5099e5c0945d538e0d2f7133b6ae7a8ef7b09
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 13 15:35:52 2015 +0000

    Enforce argument equivalence.

commit bab7bae982cd48b887a9aae30f2c2a4874a1b82e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 13 12:26:36 2015 +0000

    API updates for default.

commit 547b69d14bcdfdd2060ba1797ef626dfa60d0261
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 13 12:26:24 2015 +0000

    Compile, now that we are in the broker repo.

commit 5b3c620c53878e79bdde57db9486eff10171a497
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 13 12:16:32 2015 +0000

    Import the module rabbit_priority_queue as-is from the plugin.

commit 6f13eca56e4bcaeb963f1269ecf63ba307c98198
Merge: c25a0baec 805d99a9b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 11 20:10:41 2015 +0300

    merge stable into default

commit 805d99a9b822f4c324186d3ef8074034fe1ad581
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 11 19:14:25 2015 +0300

    Added tag rabbitmq_v3_4_4 for changeset b335fa288177

commit d58371273e0d48dd11d2678479d10da8121b8c2f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 11 15:50:30 2015 +0000

    Commit Debian and RPM change log updates

commit c25a0baecf9979818538a91c62ec478b4d08cc5d
Merge: 4baac823d 88b3a971b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 11 14:32:27 2015 +0300

    merge stable into default

commit 88b3a971b0f154f1415e5884bcca4afdf2221a37
Merge: 0648cb17f fc8065c86
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 11 12:22:53 2015 +0300

    merge bug26144 into stable

commit 4baac823d46fd7a92918d3d0dcc853342b924526
Merge: 0648cb17f 6cdb627f3
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sat Feb 7 15:25:56 2015 +0300

    merge stable into default

commit 0648cb17f03276aa0e5f22957397c053c087b048
Merge: cdb5e060b d770554bb
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sat Feb 7 15:24:57 2015 +0300

    merge bug26584 into stable

commit 6cdb627f309cc88b9f134474dcdde4df5b0dceca
Merge: 6e0250900 d770554bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 13:04:40 2015 +0000

    stable to default

commit d770554bb88385940011547da19a9cf1f7c6efa6
Merge: c11482bfa 2a38e52b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 13:04:27 2015 +0000

    Merge bug 26525

commit 6e025090032c42f033314f12595eda51d8d0db05
Merge: c11482bfa 9a167fe6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:42:27 2015 +0000

    stable to default

commit c11482bfaf6886571eed19efedb41588475d2cbf
Merge: ad004f9bb 30727dc3c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:42:12 2015 +0000

    Merge bug26443

commit 9a167fe6b2d12bd453f4f80d70b1e57ab594e754
Merge: ccc25f1bf 09cbb31bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:17:29 2015 +0000

    Merge bug26573

commit 09cbb31bc7c1d437804c90f6c83d8b3904b9615a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:17:19 2015 +0000

    De-emphasise mirroring, talk about ordering issues.

commit ccc25f1bf21acaef8ae834745ce4c3c42420baa5
Merge: c8563b522 fbf68e455
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:10:25 2015 +0000

    Merge bug26574

commit c8563b522add0529708b1bea3956f604845b73a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:10:13 2015 +0000

    And a bit more.

commit 0688423a2d506d599608d94ba7231864592d1427
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:06:44 2015 +0000

    A bit more explanation.

commit fbf68e455a6ccb5d842b02e175960da8edc08c3a
Merge: 0bbd9baaa 4dbe7eeba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 4 12:03:36 2015 +0000

    Merge bug26579

commit f24d899b8bca92be45bcf02fd3917bde80f1ee39
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 4 13:45:16 2015 +0300

    Clarify

commit 60e9321c5fbff9b23e4aa16eebf144f3e14438d8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 4 13:44:09 2015 +0300

    Overview documentation for delegate

commit 2e73febaebcc4f64a2306028834bd0f238346b06
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 4 13:12:53 2015 +0300

    Overview documentation for worker_pool and worker_pool_worker

commit a2df2f15f7d4fdaf879e8c52c8e2134c48c4d4e2
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 3 15:32:52 2015 +0100

    pause_if_all_down: Lower priority of "listed nodes not in the cluster" message
    
    An admin could add nodes to the pause_if_all_down list before creating
    the nodes.

commit ad004f9bb669ce139bb435b09b3c4ec87d8fbaf1
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 3 15:14:33 2015 +0100

    RPM/Deb: Restrict Mnesia directory permissions to owner and group
    
    Non group members are not allowed to access Mnesia & msg_store data.

commit 2a38e52b08b9595736d14380b2f189d68fb20c6e
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Feb 3 14:32:06 2015 +0100

    Don't install rabbitmq.config.example is DOC_INSTALL_DIR is unset
    
    This reverts commit d795910d2127.

commit 4dbe7eeba5b4f8a9657135f7d0930ff82c4c64b9
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 16:27:37 2015 +0300

    Wording

commit 2accfbf8d0a1b58cda4002f362ee5df950833cc7
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 16:25:26 2015 +0300

    Documentation overview of lqueue

commit 0bbd9baaac321552b14afaeb5fc36bc44f0feef2
Merge: 525b1fb1c 7195b27b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 13:24:08 2015 +0000

    Merge bug26561

commit 7195b27b40ed7f206e936eaf1730b035e8f4dcca
Merge: eef82dd50 5dd46100d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 13:01:16 2015 +0000

    Merge bug26577

commit 5dd46100dbf384d9068c8ef38ff3b4b778e0831b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 13:00:00 2015 +0000

    Rewrite to be similar to what's in configure.xml; don't mention the internal module used but do mention how this differs from net_ticktime.

commit eef82dd50b400442b42b40ff2d526247f397eab5
Merge: 52abb3b20 2c5eaa3f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 12:45:50 2015 +0000

    Merge bug26572

commit 52abb3b207788eb80801b2397727e1bd8f34feaf
Merge: 5d07cfc33 059e64062
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 12:44:39 2015 +0000

    Merge bug26578

commit 059e64062922c6f2448e48fecb10cb1537176e31
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 15:32:23 2015 +0300

    Overview documentation for gatherer

commit 525b1fb1c4f57275fa1244aae9d795e875d60770
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 12:18:31 2015 +0000

    Try to emphasise it's read/write *operations* we are counting.

commit 8a6ca7cc04ca9fd69c496a2967b97a128d1dc2cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 11:41:51 2015 +0000

    Small amount of doc.

commit 9c257b8d1567a62417f991bff21aac5aaa31010e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 3 11:11:04 2015 +0000

    Rename for consistency with other queue info items.

commit 2c5eaa3f5628c3cddad321b5ceb5e7434d420979
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 12:56:17 2015 +0300

    Corrections per feedback from Matthias

commit 8ab18d876fc609e67037f1cf658127733c777a12
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 09:47:42 2015 +0300

    Mention cluster_keepalive_interval in rabbitmq.config.example under advanced options

commit 77b938552c912857fd88cc3aee50405765cff7b6
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Feb 3 09:33:01 2015 +0300

    Basic documentation for pmon

commit 08fb4929f5c21432e0c7452e9cd9350480d4c692
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 16:35:05 2015 +0000

    disk_read_count / disk_write_count info items for queues.

commit 5d07cfc33963e718f7c75cfda27a1ffd63f2016e
Merge: d2ad8ffec ec851de0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 15:04:28 2015 +0000

    Merge bug26539

commit d2ad8ffecc9b45d9b007e6dfbe9be39a72b4b76b
Merge: e11a6d2da 60563bbce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 14:43:50 2015 +0000

    Merge bug26545

commit e11a6d2daf2c0e66dda61af3cf34b3e4217f1b84
Merge: c364864a2 797bf891f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 12:00:49 2015 +0000

    Merge bug26467

commit 797bf891f92ea7968c21c71d78ce7132519f2fb7
Merge: 80548e1b1 de6d80902
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 11:26:55 2015 +0000

    Merge heads

commit 80548e1b1059692dd6584b38e7afbacbecb4cbdd
Merge: c909a4782 30727dc3c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 11:26:21 2015 +0000

    stable to default

commit 30727dc3c10972f34c2a034e7c0e6db77f175943
Merge: 756327642 9160a9c5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 11:26:08 2015 +0000

    Merge bug26570

commit 7563276426a7ce1f3398016edbddfd554c7c1afe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 2 11:25:51 2015 +0000

    Cause some traffic on master hibernation, and explain why.

commit de6d80902fca7de57e600cfbc7405231ac5523fb
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Feb 1 01:31:42 2015 +0300

    It is now basic_consume/10

commit 92f311bc23275fcfe89d010a5a39cadcd6f8af5b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Feb 1 01:31:25 2015 +0300

    Ignore more temporary files

commit c364864a29592215ca331ffd7db19b660ddeeccf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 16:53:02 2015 +0000

    Introduce rabbit_misc:is_os_process_alive/1 from a private function in rabbit_control_main, as we will want it for testing.

commit dd20291501fbd476b88b8d8760553659956469c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 12:35:26 2015 +0000

    Move comment to a more useful place.

commit 5d8f492f902e2fcc00e3dd624ce5f895ca1f7b90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 12:27:20 2015 +0000

    Correctly determine whether offline promotion is likely to work.

commit 9388c6613c1789516614077868b1b7417979ddff
Merge: 3948c08b6 c909a4782
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 11:56:14 2015 +0000

    Merge in default

commit c909a478212e7868adf1f5639fad200cb2b9700d
Merge: 9160a9c5a b33133fa0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 11:54:50 2015 +0000

    stable to default

commit 9160a9c5a48ddf3cd7b7d56bd2f6207e279c6677
Merge: d1b7ddebb 7f0d01b10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 11:54:39 2015 +0000

    Merge bug26564

commit d1b7ddebb7ea4aec0a09185fe832ef2d2dedc0f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 11:08:17 2015 +0000

    Ahem

commit 03feb8acc1976e7c4292d1f0e518eac5f5f4e87a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 30 11:07:51 2015 +0000

    Don't send reply until the BQ:init has taken place, and thus the master has started slaves if we are HA.

commit 3948c08b6ed09c4bd8a2bbfb8e3b40481f86b574
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 29 17:22:26 2015 +0000

    Replace down_slave_nodes with a new field recoverable_slaves with different semantics: this field is intended to show all nodes that contain a slave, even if they are running. That means we don't have to worry about race conditions when getting nodes into the field at shutdown.

commit b33133fa00f04a412476dff1717e9732bed8e21f
Merge: 38e05cdfe 7f0d01b10
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 29 17:09:06 2015 +0100

    stable to default

commit 7f0d01b10903697fbdf9a193105c39f5df88ee8d
Merge: 6e76906aa 05ceeb036
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 29 16:29:35 2015 +0100

    Merge bug26562

commit 6e76906aa521a2b100360d99f803e207ae0414ad
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 29 16:15:10 2015 +0100

    rabbitmq-env: Use "hostname -f", not "hostname --fqdn"
    
    The latter is specific to net-tools' hostname(1), found on Linux
    distributions.

commit 38e05cdfe0a37746835766647766b8942aedda7a
Merge: 05d9b5dbd 05ceeb036
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 29 13:04:12 2015 +0000

    stable to default

commit 05ceeb0361ec032f8653e1b2266acf357fd61f01
Merge: d6453f1d0 cc040e95d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 29 13:02:23 2015 +0000

    Merge bug26558

commit ec851de0e9a9d70620aacef5ad59592fbea75c81
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 29 13:27:40 2015 +0100

    rabbitmq-script-wrapper: Use "exec" to execute the subsequent script
    
    Without this, a new process is spawned to execute the script. This new
    process won't receive the signals delivered to the process initially
    started.
    
    A user reported this problem with RabbitMQ in Docker: when the service
    must be stopped, the SIGTERM doesn't make it to the server which
    continues to run.

commit 2b5f12eefa2f036676c9f16c00b2075701f9ca65
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 28 14:50:54 2015 +0000

    First off, remove workaround.

commit cc040e95d6ee7e0703547338848c2849b39e59ec
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Jan 28 14:03:17 2015 +0100

    adds RABBITMQ_CTL_ERL_ARGS to rabbitmq-plugins

commit 05d9b5dbda524e492dfcef81ede5006c5d107da6
Merge: d6453f1d0 0a4b96407
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 13:05:31 2015 +0000

    stable to default

commit d6453f1d044ac944eeec2b8b3196b79497b528f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 13:05:18 2015 +0000

    Point out that tracing state is not persistent.

commit 0a4b964076f6a360211d36b582f1a2e9ae632490
Merge: 20e8a1799 a9d34ca81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 12:11:11 2015 +0000

    Merge bug26554

commit 20e8a17990edaaa0c60ff3c9d39b3b82de369771
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 12:08:30 2015 +0000

    Change the default, update the example config.

commit a9d34ca8112b9022a523cb0eaa3d5c701578bc68
Merge: 3a0e16bbc 5ade32876
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 11:58:16 2015 +0000

    Merge bug25430

commit 5ade32876106ec6335400759f619627430886d4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 11:53:26 2015 +0000

    Fix tests.

commit 779c886a4fefd526dd2834df20ad25812f87902a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 27 11:41:25 2015 +0000

    Limit journal size ro target_ram_count or queue_index_max_journal_entries, whichever is lower.

commit 60563bbce49e8cd37b880bb139f65086d8479359
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jan 26 23:18:12 2015 +0300

    Prohibit deletion of amq.* exchanges, not just amq.rabbitmq.*

commit 3a0e16bbc9ba25c7edb43d11de5d721ca590db4b
Merge: b782a4fac a40144eab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 26 11:49:33 2015 +0000

    Merge bug26463

commit a40144eabf5077dd459ef5d6b9f5678f878d386a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sat Jan 24 03:10:59 2015 +0300

    Typo

commit bacb167aa7e69900ee812ace37efc7d6045005c7
Merge: 358ccf681 6c6c29cff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 23 14:45:09 2015 +0000

    Merge bug26499

commit 6c6c29cffe250fce54f878db6ddc93fd1e21b15d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 23 13:28:13 2015 +0000

    Oops

commit 2828a3b4925884f985fe30d6edfea2cc709cf444
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 23 13:26:07 2015 +0000

    Simplify purge/1 and friends by getting stats/3 to do the work of updating counters, rather than having separate code to do that. This is conceivably slightly uglier, since the #vqstate{} record is not internally consistent at some points while doing this... but it's so much simpler!

commit 3e064be3eaeb72fa02fcc565f615261bc1c52942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 23 13:10:42 2015 +0000

    Rename things.

commit cc835492a9bc62a411b540127df212260ff8ffa6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 23 12:24:25 2015 +0000

    Simplify SignRamReady.

commit b625bb9627a1bc9c024f39262f1e849a9ad47aeb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 22 18:18:10 2015 +0000

    Refactor updating all of the various counters we have into a single function rather than having a load of ad-hoc updates scattered everywhere. Not perfect but already an improvement.

commit b782a4facef484261686b2c35162fa40d661e07d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 22 14:10:52 2015 +0000

    Revert the merging of bug 25210, and thus allow death of mirrors to cause new slaves to start.

commit 358ccf68180357b4471ce06f87828b9f4d89a214
Merge: 86895beb9 9b833f66a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 22 12:06:39 2015 +0000

    stable to default

commit 86895beb9c059fd9a3f56cf2f014a64dc2c8c7aa
Merge: ec2c1a8c9 f37534814
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 22 12:06:28 2015 +0000

    Merge bug26549

commit f37534814d8152ef9878ee2cdf65ce9a288a9116
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 22 12:06:16 2015 +0000

    Check that our generated distribution port is actually a valid port number! Also rename some exit codes for more generality and clarity.

commit 9b833f66a6323566dc4a9e8e9395696e6a2c36b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 21 17:49:16 2015 +0000

    No longer needed.

commit d8b237c4b6952c676dfb55084e8acff01dd139ad
Merge: 043dd23be 8a605773c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 21 16:07:34 2015 +0000

    Merge bug 26527

commit 043dd23be06db4015aaf32ffb282cf162d92c8ca
Merge: 79b28c03b 0068d17d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 21 12:19:10 2015 +0000

    Merge bug26543

commit 0068d17d865761cadedf4de278664f78cccccff7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 21 11:39:06 2015 +0000

    Fix a couple of silly bugs: specify the journal prefix lengths for ack and del, and correctly assemble the segment backwards.

commit b29eab1cfe77086e7c5dd5af84c226b7ef05d43a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 18:44:24 2015 +0000

    Also, switch to reading the journal in one go. We don't care about this for performance, but it's probably a simplification.

commit 2a6a784fd6088f01b6752fb94499aa539388836d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 18:10:41 2015 +0000

    Read segment files in one call to fhc:read/2.

commit 961df06526ea039207871359b2d5fc859030d134
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 17:29:16 2015 +0000

    Write segment files in one append/2 operation.

commit 79b28c03bea34d1536344201cf2e839971eb7fe1
Merge: b8b7a19b5 38a4a9c3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 15:21:18 2015 +0000

    Merge bug26542 (again)

commit 38a4a9c3d30cc1800e24aaf3efcf6d280d8f0678
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 15:21:05 2015 +0000

    Oops, headers can be undefined.

commit b8b7a19b53d4be916d5953f989da53641641b9b9
Merge: 7d794dd70 f4381b01a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 14:55:25 2015 +0000

    Merge bug26542

commit 7d794dd70df7c0be0809d89ada7884230189968c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 20 14:55:12 2015 +0000

    Improve the performance of determine_persist_to/2, stop it being a hotspot.

commit f4381b01abe5f3e24439adcff49bbe76c7b08abd
Merge: b2b6ce51f 29598b548
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 19 12:41:10 2015 +0000

    Merge bug26484.

commit b2b6ce51f8d94dab9b3162db524ea1a4ca8ce4b7
Merge: 7346bfbab ab8e96071
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jan 16 15:59:06 2015 +0300

    merge bug26426 into default

commit 29598b5481feef02c0fc2dd4e3ec84f5dbd9b33f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 15 17:51:24 2015 +0000

    Allow seeking backwards through the read buffer.

commit 7346bfbabed632077e8c1f6974811b9b541bfc72
Merge: 20bd1b822 61e8c48f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 16:29:01 2015 +0000

    Merge bug26522

commit 61e8c48f9c9411158ffd9254492a108062e4c7d8
Merge: 20bd1b822 30cb8584d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 15:53:24 2015 +0000

    Merge in default

commit 20bd1b822a6258bccc4f965ff026a5696903f215
Merge: 29c0ecd4d 983d281a8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 15:50:14 2015 +0000

    Merge bug26327

commit 983d281a8df07161747b5571ad002c0e1609a960
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 15:35:17 2015 +0000

    Fix confusion over where the embedded size lives.

commit 3b3b8c4f86cb74a9251ad392dfb2e1fa7ee715f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 13:56:34 2015 +0000

    Oops.

commit cce13da176ec2ccbb89b046b6f5352f253c1a990
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 13:40:24 2015 +0000

    Simplify reading message body.

commit e861016a8e5b47500a615cfc9bbcfad85e5d36ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 13:19:04 2015 +0000

    Finish the job started by 2f668f7b457f; make sure we always hold messages in memory in the serialised form.

commit 1ec1e79a2ecdaad03fa9335f74fbee3726eff79e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 13 10:55:02 2015 +0000

    Rename this for a bit more clarity.

commit 7634d04f716b3bccff4a5bae9717119875371c2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 12 19:36:37 2015 +0000

    Only call create_pub_record_body/2 once per message published; keep the serialised form in memory.

commit 30cb8584d7c5d9388bd024758629526aa9f775cb
Merge: 266bafc71 814b54783
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 12 18:26:37 2015 +0000

    Merge bug26327

commit 8a605773ce360d3f29edbf639bebbd204d8c7b7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 12 15:47:34 2015 +0000

    Fix eager sync.

commit 061f7339924c8b610840f223a22c56f4646c5c6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 12 15:14:24 2015 +0000

    Deal with sending additional acks on or after promotion.

commit 75a472ee850bbc95e50d60f1fed5a13512f8d1e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 12 14:37:20 2015 +0000

    Flow control for messages going from channel to slave via GM. Reshuffle the flow control flag into #delivery{} to try to cut down on the number of places it gets passed around. Still to come: DTRT on promotion.

commit 29c0ecd4db98c3a7b15742388acd591fddc7f95b
Merge: ed351cf9b 010367e0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 9 17:49:05 2015 +0000

    Merge bug26427

commit ed351cf9b6660764e99ad2fd2f076c73269251ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 9 17:34:15 2015 +0000

    Ahem

commit 814b54783e326508bcbdce7b6ba251c782b9b1a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 9 16:04:29 2015 +0000

    So that term_to_binary/1 there somehow seemed to end up creating a lot of garbage under heavy load; pumping millions of messages into a queue became almost quadratic. I'm not sure how or why, but let's try another tactic.

commit cdb5e060b72c568f6f525ee09238f0034a13d547
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jan 8 18:03:14 2015 +0300

    Don't fail if sbin or etc exist

commit 45fff3fd7dbb6cbb14baa13989981cac7bbb621f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sat Feb 7 08:10:45 2015 +0300

    Make .msi installer install new version after uninstalling the existing one
    
    With this change it becomes possible to embed RabbitMQ .msi installer into
    other installers.
    
    Contributed by Patrick Ribbing.

commit 010367e0ae3ed8e9d79a5958a600d30000cfd849
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jan 8 18:03:14 2015 +0300

    Don't fail if sbin or etc exist

commit 8a8367f04cf85a1d20cf7b5df38d9d2bca366ef8
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 8 15:12:46 2015 +0100

    Add 'debug' to the valid log_levels in rabbitmq.config.example

commit c6feac6311749bc9c611afb08a7818d1b1199fb8
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Jan 8 15:00:49 2015 +0100

    Do not log the real connection timestamp
    
    Also, remove the "incoming connection" message.
    
    Both informations don't have much value.

commit ab8e9607153020a34345c60d124bd385c55f6f02
Merge: f8121ae94 5d9cee333
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 8 13:42:10 2015 +0000

    Merge in default

commit f0681f34782b3ef800759a5bd1536e2acb154ef6
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 7 16:15:24 2015 +0100

    Remove /tmp/rabbitmq.config.example after RPM build

commit 266bafc71c7996e941c28e2d045f2efb5eae4a7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 7 15:03:04 2015 +0000

    More stats (and rename the existing ones).

commit 5d9cee333a62e74bf9ec541fe561f63eaf873994
Merge: ec2c1a8c9 767f9ab18
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 7 14:24:32 2015 +0100

    stable to default

commit ec2c1a8c9e6144e9a62aba113aff1070f67c2b8e
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 7 10:21:53 2015 +0000

    Added tag rabbitmq_v3_4_3 for changeset ba30e4f0e084

commit d4a164c09e87f323efc1784b6d27ec5c1d39ab63
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Jan 7 10:19:44 2015 +0000

    RPM/deb changelogs for release 3.4.3

commit 9894eed84475fc6ebf73782684f41ef8fdab87c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 6 18:30:24 2015 +0000

    Decide where to persist to based on the encoded size of the message.

commit 767f9ab183fac84eed391276fb16f0f3c5a051b0
Merge: b66853d61 ecbe0d143
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 6 12:15:10 2015 +0000

    Merge bug26393

commit b66853d612f7178effa6364c70e765ae8fb56912
Merge: 2bcd140ce fef21a2e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 5 16:10:41 2015 +0000

    stable to default

commit fef21a2e1d78ad5617b4ce251e8755625dee484b
Merge: 9a6a61d38 98e87ef0c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 5 16:10:27 2015 +0000

    Merge bug26503

commit 2bcd140ce0a382474ed793dd921156962455c3cb
Merge: d0f2c74a0 98e87ef0c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 5 14:05:23 2015 +0000

    stable to default

commit 98e87ef0c0b31123662823098acf34e882c9f109
Merge: 4ccccceaa 97bf9452d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 5 14:05:12 2015 +0000

    Merge bug26502

commit 9a6a61d3847c9a25af4252337e64528386d0bf73
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 26 15:13:52 2014 +0100

    Rework SSL's verify_fun support
    
    Until now, only the legacy form was supported (the one existing
    in Erlang up-to R13B). The user would use the following RabbitMQ
    configuration:
        {ssl_options, [
          {verify_fun, {Module, Function}}
        ]}
    
    This is converted to the following ssl option:
        {ssl_options, [
          {verify_fun, fun(Errors) ->
                           Module:Function(Errors)
                       end}
        ]}
    
    Although this form is still supported by Erlang R14B+, this is
    undocumented and some users complain about RabbitMQ not matching the
    expected behaviour, according to ssl's documentation.
    
    Now, the new form is supported as well. Here's what the user would
    configure:
        {ssl_options, [
          {verify_fun, {Module, Function, InitialUserState}}
        ]}
    or:
        {ssl_options, [
          {verify_fun, {Module, Function}}
        ]}
    
    This is converted to the new form:
        {ssl_options, [
          {verify_fun, {fun(OtpCert, Event, State) ->
                            Module:Function(OtpCert, Event, State)
                        end,
                        InitialUserState
                       }}
        ]}
    
    To determine which form to use, we look at the version of the ssl
    application:
        o  4.0.1+: We check if Module:Function/3 is exported and use the new
           form. If Module:Function/1 is exported, we use the old form. If
           both are exported, the new form is preferred. If InitialUserState
           is unspecified, 'none' is used.
        o  Before 4.0.1: We use the legacy form only.
    
    If Module can't be loaded or if the expected Function/Arity is not
    exported, an error is logged and RabbitMQ fails to start.

commit 97bf9452d031de8fc8cc4beb2ccd52f477226680
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 24 15:58:14 2014 +0100

    Remove 'backing_queue_status' from ?STATISTICS_KEYS
    
    This key is already provided by rabbit_backing_queue:info_keys/0 which
    is concatenated to ?INFO_KEYS and ?STATISTICS_KEYS.
    
    This fixes a bug where this key was duplicated in the JSON returned by
    the "/api/queues" endpoint.

commit 887a161cdd702b55497fcaa20840ba0af4181493
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 24 15:16:27 2014 +0100

    How to recover from partitioning after 'pause_if_all_down' is configurable
    
    Now that 'pause_if_all_down' accepts a list of preferred nodes, it is
    possible that these nodes are spread across multiple partitions. For
    example, suppose we have nodes A and B in datacenter #1 and nodes C and
    D in datacenter #2, and we set {pause_if_all_down, [A, C]}, If the link
    between both datacenters is lost, A/B and C/D forms two partitions.
    RabbitMQ continues to run at both sites because all nodes see at least
    one node from the preferred nodes list. When the link comes back, we
    need to handle the recovery.
    
    Therefore, a user can specify the strategy:
        o  {pause_if_all_down, [...], ignore} (default)
        o  {pause_if_all_down, [...], autoheal}
    
    This third parameter is mandatory.
    
    If the strategy is 'ignore', RabbitMQ is started again on paused nodes,
    as soon as they see another node from the preferred nodes list. This is
    the default behaviour.
    
    If the strategy is 'autoheal', RabbitMQ is started again, like in
    'ignore' mode, but when all nodes are up, autohealing kicks in as well.
    
    Compared to plain 'autoheal' mode, the chance of loosing data is low
    because paused nodes never drifted away from the cluster. When they
    start again, they join the cluster and resume operations as any starting
    node.

commit 6513caf06ae045351224d0c3678ed38f074133dc
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Dec 19 23:41:57 2014 +0100

    Rename 'keep_preferred' to 'pause_if_all_down' and accept a list of nodes
    
    Now, a partition is paused if all nodes from the pause_if_all_down list
    are seen as down. If a fraction of the list is alive, the nodes in the
    partition remain up.
    
    Compared to the previous version, some of the listed nodes can be taken
    down for maintenance without risking service interruption. However, this
    raises the problem of listed nodes distributed in multiple partitions:
    we need to handle recovery. This will be addressed in a followup commit.

commit dd68bab2252516fb1241ebc74ce16cbbc0786fa3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 12 11:41:09 2014 +0000

    Handle read failure in read_pub_record_body

commit 10ead114dc3fe97e9e4887da61aba87f9a7ac7b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 12 10:53:25 2014 +0000

    Remove vestigial use of read_ahead.

commit f2107d6063d3ec9db364c77bcb7e29d90806d1f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 12 10:51:17 2014 +0000

    Use msg_in_ram/1 more.

commit d0f2c74a0937785d6982320aa85fd24e78b8680f
Merge: 4ccccceaa 45bf08cb5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 12 09:58:50 2014 +0000

    stable to default

commit 4ccccceaaa0a41532ebc15b7572b729af09d2834
Merge: af0ce675f 7891d3ce5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 12 09:58:39 2014 +0000

    Merge bug26490

commit 7af62d174b5136c18f569a62267e4f3e1dd02148
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:51:48 2014 +0000

    Rephrase, and add a high level introduction.

commit 70bac223f776d16db47e7061d0587f22b24ddcc6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:42:42 2014 +0000

    Reduce distance to default, add a tiny bit more explanation.

commit b20b305fa811e53b5976b32d598d3502145d4db2
Merge: 45bf08cb5 5db2509f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:17:16 2014 +0000

    Merge in default

commit 45bf08cb52f54fcafd0db11439325620c70fa4aa
Merge: abc92eea3 7891d3ce5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:05:34 2014 +0000

    stable to default

commit 7891d3ce514bdc1182525c951802338a2e1fae12
Merge: 2188f587a f881664ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:05:23 2014 +0000

    Merge bug26498

commit 5db2509f984cac384be0d94bc92b79c0bf5996fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 17:04:50 2014 +0000

    Run the VQ tests both while embedding messages in the QI and sending them to the store.

commit f881664ae124bbca4cb696aebcc5e0b467a9d043
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 16:36:56 2014 +0000

    Minor refactor.

commit 8ccd6154e7b34073a5eb34c8cbf1c4a1bfec0a52
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 16:17:57 2014 +0000

    Backport the part of 505868f421db which fixes ram_bytes when requeueing an in-memory message to delta, and do the same for beta.

commit 109ba9349b8a6842b302d853fa0588a431a1acdf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 11 13:58:14 2014 +0000

    A few fixes to VQ book-keeping, which get the tests passing again:
    
    * Don't count messages / bytes read during read, do so in
      betas_from_index_entries since unacked msgs don't count
    * Introduce qi_pending_ack to prevent us trying to page out messages that
      don't touch the store
    * Fix purge bookkeeping, account for the fact messages can be paged in to be
      purged

commit 7fbdd34bf516ca53f3b8433829e1403e88a2b346
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Dec 11 10:15:40 2014 +0100

    Restore the previous "accepting AMQP connection" wording
    
    The real connection timestamp is logged on the next line.

commit abc92eea32a8774b3e3d3dcd73f5261ca342ddba
Merge: 12471444c 8b3948151
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Dec 10 22:01:49 2014 +0300

    merge bug26475 into default

commit af0ce675fae7c840bf7d578dbac2339d214c8e01
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 18:20:47 2014 +0100

    Inline the Continue() anonymous function

commit 08b91401b6f1d61ec982880889800c408001b5a9
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 18:10:59 2014 +0100

    Add more information to the 'about_to_heal' state explanations

commit 3231071cdc84c1a62e29a0b214be78a805f14de2
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 17:48:25 2014 +0100

    Log new/closed connections only if they are not a healthcheck
    
    The "new connection" message log is deferred to the moment we receive
    the first byte or an error occurs.
    
    If the connection is closed without receiving any data, we consider it
    is a TCP healthcheck. Therefore the new/closed messages are logged only
    if the log level is 'debug'.

commit 5317709c765af700e5f54c1e80b5f52fc86a2573
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 17:32:39 2014 +0100

    Add a 'debug' log level
    
    Like 'info', it is mapped to error_logger:info_msg/2.

commit 8b39481514ae3592636c22a957fc95ad3395fdd5
Merge: 2188f587a c68000d86
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 10 15:29:04 2014 +0000

    stable to default

commit 2188f587af89f71c4e8bbbcfb19cf35af103f7b2
Merge: 5967cd39a 28f82588c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 10 15:28:53 2014 +0000

    Merge bug26491

commit 5967cd39af39d99f754b06655b525af723861133
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 10 15:28:42 2014 +0000

    Minor language corrections.

commit ecbe0d1433dea82f17228ae3c57830030b334110
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 11:42:13 2014 +0100

    No need to concatenate hard-coded lists...

commit e745c1b8af1bda3a79908d9f0e0bf6562d2ef262
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 11:25:59 2014 +0100

    Now that empty keys are dropped, we can always add ssl_* keys
    
    If the connection isn't over SSL, ssl_* keys will be empty and dropped
    anyway.

commit 65b7f0cad75baaf1bebb5fc5c66f40f7758a05cc
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 10 10:55:12 2014 +0100

    Autoheal: Make sure Mnesia is stopped on all losers before they restart
    
    This works around a race in Mnesia where a starting loser would hang
    forever. This happens when a starting loser connects to another loser,
    negotiates the Mnesia protocol and attempts to acquire a write lock on
    the other node's schema. If the other nodes stops right between the
    protocol negotiation and the lock request, the starting node never
    receives an answer to its request.
    
    Before this fix, the hang occurred after at most 30 minutes looping on
    the partitions:autoheal test in rabbitmq-test. With the fix, RabbitMQ
    survived an all night long run.

commit 07d93ab1916933c4663f10f91fa705e02e5c7cf0
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 9 19:14:28 2014 +0100

    Autoheal: The loosing leader must wait for the winner_is message
    
    As any other loosing nodes, the leader must wait for the winner_is
    message, instead of restarting immediately.
    
    The previous behaviour caused transient failures in the autoheal process
    if the leader was in the middle of the restart at the time the winner
    checks that all loosing nodes are up and running.

commit c68000d86eae55bce00d5c8dddea347b76db8a03
Merge: 28f82588c 07508eb32
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 15:23:38 2014 +0000

    stable to default (Alvaro forgot)

commit 12471444cff75854cd04f0a0c9814a7a7b97dde7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 12:21:05 2014 +0000

    Nicer feedback.

commit 529601f60e25a95a8d03a0edb56bb25ed280af8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 12:15:03 2014 +0000

    Split out preparation from rename/2, and add comments.

commit ccbffe80def492c28bc4d15dd062ee741144f293
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 11:49:31 2014 +0000

    Various fixes / improvements: with the new scheme multiple renamings will not waork, so check for them. Fix abortive renames (with a copy of the mnesia dir). Ensure we don't talk to any other nodes while backing up / restoring since that inevitably goes wrong. Split up rename/2 a bit and rename a few other things for more clarity.

commit d2ffd3f4c648e84fef952d1fce6ecec8def29b0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 10:32:11 2014 +0000

    Fail clearly if the node specified with '-n' is not a member of the cluster before or after.

commit 8dc3e8488300e94d62152ca3d5ab72f5e63a4cb2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 9 10:31:42 2014 +0000

    Ensure become(node()) works rather than failing with {node_running, ...}.

commit c27b3c77940636741cc966f1b83ed83d6351f186
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 8 16:57:36 2014 +0000

    WIP clustererer compatibility: install the fallback and "upgrade" mnesia at rename_cluster_node time, instead of during next boot. This means we need to faff around a bit making sure we do not contact other nodes during the upgrade, but also that on-disk data structures are left in a consistent state for the clusterererer to find them.

commit 28f82588c0ea05fa9e69b370ce03a0a316ce9f24
Merge: 94c0fd22f 9c809d9e2
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Mon Dec 8 11:00:54 2014 -0300

    merges bug26478 into stable

commit f15d681b9bad1d42eccd67804a0add2c6bf1e0d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 16:36:33 2014 +0000

    Clearer test failures.

commit 1215f25e584f05bec9560c2236a10e3b6be62d2e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 16:35:58 2014 +0000

    API changes

commit 89fd8c8a38f254b8fbdb1e53b75f81bed0cd7ba8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 16:18:53 2014 +0000

    Don't recover transient messages.

commit 9403fb3c267dd2d62b8eca6b0a17da408c8a083b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 15:35:49 2014 +0000

    Update essay.

commit 25390ec3ec56786ef249ae951ef2df7d1a225d91
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 14:44:31 2014 +0000

    Introduce a selection mechanism so that small messages go to the index, and large ones go to the store.

commit 65727995e6eb3f0f303ceca699c38b892102c9a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 14:37:41 2014 +0000

    Fix bookkeeping of ram_msg_{count,bytes} - don't assume it decrements on alpha -> beta transition, allow it to decrement on beta -> delta as well if the message went to the QI. (We were already correct on delta -> beta, and there isn't a bulk beta -> alpha move.)

commit 281542f5c285b6c005e396eee2f3e4493b7e2ec7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 13:56:15 2014 +0000

    Reinstate this.

commit cbbe81b575def63e9edd47dd1a66e034fc1367b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 12:53:10 2014 +0000

    Upgrade

commit 07508eb322b390a0ec87f1688ea3caa98f73cc8d
Merge: 9c809d9e2 b5431fd4a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 12:18:42 2014 +0000

    stable to default

commit 9c809d9e2b7e661cba7beeb8fe3d397bf02354a2
Merge: d316f64fa b865b3984
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 12:18:10 2014 +0000

    Merge bug26446

commit b5431fd4a55958f6ceabf71767a806feb2b0e132
Merge: d316f64fa 19450507c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 11:36:11 2014 +0000

    stable to default

commit d316f64fa92a7b30b434b8cfbc0f09fe660038d6
Merge: ccaf0d325 dc77cc2e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 11:36:02 2014 +0000

    Merge bug26493

commit ccaf0d32518d81d9797d8100aa57442434f720bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 11:32:17 2014 +0000

    Abstraction: safe process_info().

commit 1cd74a26250c10efa7c92c608bd8e1e60d6a8ce4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 5 11:24:14 2014 +0000

    Add top_memory_use() and top_binary_refs().

commit e01cf9e2d7c60c640d138f8e3da1eb001d146813
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 4 16:48:34 2014 +0000

    Don't leak on noack.

commit da01d7b96dc5ea124b40b3b00987105318276b0c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 3 17:38:49 2014 +0000

    Fix dirty recovery.

commit a3585cc54306096fabd7081d6ee714beafffdf85
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 3 17:27:16 2014 +0000

    Fix confirms

commit 6c8b49e5ee88710f5180c6149c7182376f112562
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 3 16:44:13 2014 +0000

    Rename msg_on_disk to msg_in_store and fix up its semantics. We now don't need to guard msg_store read and remove as we should just naturally not need to do them.

commit 13138e9a7c9a8ef29ce1ed092d3cd5289684a3af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 3 15:52:49 2014 +0000

    Hacked-together implementation of persisting messages in the QI. Currently does it for all messages, but in reality we'd only want to do this for small ones (and make it configurable). Confirms are probably broken, maybe some other things.

commit b865b398460c8f7f28d66172647126711c07d257
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 3 15:43:57 2014 +0100

    Throw an error if at least one plugin's module can't be loaded
    
    This prevents a plugin from being enabled if it won't be able to
    actually run later. A use case for this is a plugin built with Erlang
    version N, but executed on Erlang version M, where M isn't capable of
    running the bytecode from N. This was the case with Eralng R14B vs.
    R15B.
    
    The "rabbitmq-plugins enable <plugin>" command reports the error and the
    plugin remains disabled.
    
    A node reports the error too and refuses to start, exactly as if the
    plugin was missing.

commit 83f42660942a2659c0046cc5e31d04740bd82702
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 3 14:10:35 2014 +0100

    Filter out auth notification properties with no value

commit 5021c61ea8612a5bbedc88c1036a0325db0b1c63
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Dec 3 14:05:03 2014 +0100

    Style fix: Use ++ to construct EventProps, not multiple temporary variables

commit a5fa3277de1cc8fa989cb913519e6349b38c689a
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 17:55:23 2014 +0100

    Pass "extra properties" to notify_auth_result/{3,4} instead of a message
    
    This avoids to passs an empty message in the case of successful
    authentication.

commit 51ac29026fd014ef3cd2441839169e57f335421d
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 17:45:27 2014 +0100

    Only include ssl/certificate informations when the connection is over SSL
    
    This gives lighter notifications for plain TCP connections.

commit 4f0e3599f164478cd6ae64f123a5a20b2e7ee724
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 17:38:12 2014 +0100

    Use list comprehension instead of lists:foldl/3
    
    To keep a somewhat logical order in the list of user_authentication_*
    properties, reverse the order of the AUTH_NOTIFICATION_INFO_KEYS list.
    This list was previously reversed by lists:foldl/3.

commit 859fc5cf328a8f68e572a3f509db295dce78f04d
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 17:17:07 2014 +0100

    Use rabbit_misc:format/2 instead of lists:flatten/1 + io_lib:format/2

commit c7e06b1cff308f4b167fe29fb83c75750d8cd7bb
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 17:14:30 2014 +0100

    Move the info keys list added to user_authentication_* to a -define()

commit 5595a265cebebdcfcfc60bbea61c5418a59996a6
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Dec 2 15:43:32 2014 +0100

    Add a new "keep_preferred" cluster partition handling method
    
    The syntax is:
        {cluster_partition_management, {keep_preferred, node@domain}}
    
    The specified node name is used to determine which partition should run
    or be suspended. Nodes which can still reach the specified node continue
    to run. Nodes which can't are suspended.
    
    Compared to pause_minority, this allows the admin to determine which
    nodes to prioritize in case of partitions with an equal number of nodes.

commit e032fc71a9228a910c159f57fa81894e66157bb6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 1 15:46:57 2014 +0000

    Maybe clearer?

commit be26c7e16c342a4bc642c03159a070d26eafe2b8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 1 15:30:59 2014 +0000

    Add a section to the manual page.

commit 872bbd4f15843d445b6020bc240b571fccebfbd3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 1 15:15:40 2014 +0000

    Swap location of backup and regular config files. A bit less logical, but we need them to be in the right place when starting for big-bang upgrades to work.

commit b4c357b17e350d753ece7921741640b02f1f5331
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 1 14:55:38 2014 +0000

    Put all the rename-related temp files in a directory together, and keep copies of the rewritten configs so we can roll back without having to re-edit them.

commit 1defdc03805ded8a6b3eca52d8988632be8727fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 1 13:57:37 2014 +0000

    Allow argument-pairs to rename_cluster_node to go in any order (and thus allow remote-only renamings). Don't use mnesia:transform_table/3 since it's rather picky about which disk nodes are up.

commit ebf90187d37d081504824669b6ecaed16f6aef72
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 17:56:15 2014 +0000

    Rename again

commit a353c6d065260b80b6447cbc8a82ba5eda4d1191
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 17:22:37 2014 +0000

    And unbreak clusters.

commit dbdb3b20258ebfe45d3c99c352838c3537e3a0b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 17:08:30 2014 +0000

    Detect starting as the old node name after a rename and roll back. Also rename a bit.

commit 77470b45e5d28628da42aeb0d19f4c575e1716fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 17:04:46 2014 +0000

    Less io:format, more rabbit_log.

commit 5adaa81bfaea9262f36e9d983aacdcfded867615
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 17:04:36 2014 +0000

    Improve the chance of not losing a bunch of data.

commit a89b8d6d94b5863691e8125d0acaeb782b26bb17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 16:24:34 2014 +0000

    Oops

commit c67eb29e33b2baa3d219e3bf761903daf0581793
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 16:13:19 2014 +0000

    Rename things

commit e434861963e6f3832a8a7483fe6ae07a15a1546d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 16:06:34 2014 +0000

    Remove commented out bit, remove pointless RPC (we're in the cluster by that point, we can make Mnesia changes ourselves).

commit 3d80a58419a565e7475f89b5192d85e1f994d968
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 15:57:21 2014 +0000

    We are presumably the source of truth now, so make sure we boot.

commit 19450507c7eed92dc8c4a8c264faadf797cf040c
Merge: a2004c120 dc77cc2e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 11:51:43 2014 +0000

    stable to default

commit dc77cc2e7ed62a70518ac416a90174aacdce07d8
Merge: b122e6c6b c2930c9f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 11:51:31 2014 +0000

    Merge bug26265

commit b122e6c6b2afe8b97db28921cff9e04f7cb5ee24
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 28 12:45:14 2014 +0100

    No need to load/unload the plugin around the plugin_provided_by_otp/1 check
    
    While here, remove the unused PluginVsn variable.

commit 3de78ef2c7a118511940f5019ce6f5e705437867
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 28 12:33:18 2014 +0100

    Remove "Plugins: adding to code path" log message

commit d13522a3555a6284c7670ff2e18ab60c08138718
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 28 12:01:25 2014 +0100

    Don't dump the rabbit_reader state in the log...

commit a2004c1203d512478e94cd94c214182ab6a60f0c
Merge: a515d7659 c2930c9f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 11:00:31 2014 +0000

    stable to default

commit c2930c9f91ac755389beaeb7df74597d02497f0d
Merge: f213c97ea d3953c203
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 11:00:20 2014 +0000

    Merge bug 26081

commit f213c97ea21f77eae540fdf11b27033a8d800029
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 28 10:41:59 2014 +0000

    Rename this to indicate what it does, not the current circumstances in which it is called.

commit df431fb74d5b96b187b7eedb4956f09c97ca50d9
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 28 10:13:19 2014 +0100

    Indicate if no data was received in the "closing AMQP connection" log message
    
    This allows the user to distinguish between a normal RabbitMQ client and
    a load balancer healthcheck or misbehaving client.

commit 7414eba5f789b5c3dffcb992f531b14bf7359c6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 27 14:54:47 2014 +0000

    Support renaming other remote nodes at the same time, in case we want to do a big bang.

commit 8f7c08a2485a52e8c0c69d4004c336a2fd76016a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 27 13:52:34 2014 +0000

    Don't be so keep to call upgrade_mode/1, it can die in all sorts of ways.

commit bc86daac842f6e40936eddecffa7a0c3d9dc9efb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 27 12:59:49 2014 +0000

    Rearrange things a bit. We now have something that seems to work.
    
    Merging a modified database back into a running cluster seems to be a
    bit of a non-starter; Mnesia blows up with "Failed to merge schema:
    Incompatible schema cookies." So instead we do something similar to if
    we were doing upgrades: we always create the modified backup, but only
    load it if we are the first node in the cluster to start; if not we
    reset our mnesia state, resync with the cluster, then tell the cluster
    to forget our old incarnation and update its queue records for the new
    one.
    
    This also has the advantage that we don't need two rename commands, we
    just have the local offline one. Which is hopefully nicer
    operationally.
    
    It does mean that we go to the trouble of taking the backup and
    modifying it only to throw it away if we turn out to be a secondary
    node, but it should not be too expensive.

commit becc3d30b4ac6e15ef15ade129a6eba8b3f3392a
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 27 13:59:05 2014 +0100

    Don't log any warning if a TCP connection is closed immediately after open
    
    This happens with load balancers TCP healthcheck for instance.

commit be965029b316969d7221b32014b9ce4fb0f050f5
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 27 12:13:09 2014 +0100

    Check cluster consistency before joining a cluster
    
    Before this change, the node would join the cluster and the consistency
    would be only checked during application restart (rabbitmqctl
    start_app). This could lead to crash during the join due to Erlang,
    Mnesia or RabbitMQ incompatibilities.
    
    Now, the join_cluster command reports the problem. Here's an example:
        $ rabbitmqctl join_cluster <remote_node>
    
        Clustering node <local_node> with <remote_node> ...
        Error: {inconsistent_cluster,
                "OTP version mismatch: local node is R16B03-1, remote node 17.3"}

commit b3b10b5ebbff1273778b03b4fd0f1d414978501b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 18:28:30 2014 +0000

    WIP towards rabbitmqctl rename_other_node.

commit dfe1b688621647aa2447699b9106d102217b1b31
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 26 18:21:44 2014 +0100

    Only check ERTS version to determine if we accept an external eldap

commit ad1fd74f41f4cca3b2d456a3d4359ef3b57a5551
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 26 17:53:45 2014 +0100

    Drop {refuse, _, _} from rabbit_auth_mechanism:handle_response/2 return values

commit 94c0fd22fbbfb05787fa18e4e463af1f3ec7cf12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 16:45:25 2014 +0000

    Don't halt execution if RABBITMQ_CTL_ERL_ARGS is set.

commit af62f3f4985257f29cd175535b0b37e36df50157
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 26 17:01:45 2014 +0100

    Rephrase a comment to use the present tense

commit 00d1338b0bed1f3f01e23a4f7b83ba90f78f5060
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 26 16:51:47 2014 +0100

    Update rabbit_auth_mechanism:handle_response() spec to match the change

commit 5977c7db23bc465fce3d39f6c547972352416a75
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 15:48:32 2014 +0000

    Oops

commit 22ac9d14e0634b9cb01beb500271f209dded41b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 15:47:22 2014 +0000

    Create a way to mutate pids and use that rather than creating "fake" pids.

commit a515d7659079c65d0eeb4ba91b33d31c65a74844
Merge: ef53341f3 d3953c203
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 15:05:26 2014 +0000

    stable to default

commit d3953c20357d98971fe3cb841a16db6a8122439b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 14:34:58 2014 +0000

    deb / RPM changelogs

commit 6ca368c07ab1025c8e2e8a80c6d561cf05dc12ca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 14:12:13 2014 +0000

    First pass at "rabbitmqctl rename_current_node"

commit ef53341f3270be7186cb4d3d49d0769a38e404fa
Merge: 462c577f2 9696f86d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 13:09:31 2014 +0000

    stable to default

commit 462c577f2a954f87066290c97d9d1e2d68e17819
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 12:52:19 2014 +0000

    Added tag rabbitmq_v3_4_2 for changeset b32eb93d4da5

commit 9696f86d7876a454064d0cd8443e39469792d92b
Merge: 5b15ac058 a5002d7ca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 12:20:57 2014 +0000

    Merge bug26471

commit 5b15ac058dd9cfeea49f6dc70032bdc4faf3cdc2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 12:20:43 2014 +0000

    Rename this since it's not quite just success / failure any more.

commit a5002d7caae282cad2341f6b5b551dbfef95d4f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 11:51:57 2014 +0000

    Removed tag rabbitmq_v3_4_2

commit bab81b578ed9bbac641c6a6695a925666184d522
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 26 11:43:20 2014 +0000

    Added tag rabbitmq_v3_4_2 for changeset d472925bb786

commit 9f180a6ae468c249484d5dc671e94763e280f311
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Wed Nov 26 12:35:49 2014 +0100

    During startup, log statistics after modules were hipe-compiled
    
    A similar message was already displayed on stdout.
    
    A warning was also logged when HiPE was desired but unavailable. To
    be consistent with the "HiPE enabled" case, the same warning is now
    displayed on stdout too.

commit 037dca04a8f7f7df2a2c8ba8e8aaf45b444f9004
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Tue Nov 25 19:21:27 2014 +0100

    Add more properties to the user_authentication_* notifications
    
    Until now, the only property was {name, Username}.
    
    The added properties are:
        o  {connection_type, network | direct}
        o  {error, Message} (only if the authentication failed)
    
    For network connections, the following informations are added as
    returned by rabbit_reader:infos/2:
        o  auth_mechanism
        o  host
        o  name (the property is renamed to connection_name to avoid conflict
           with the username)
        o  peer_cert_issuer
        o  peer_cert_subject
        o  peer_cert_validity
        o  peer_host
        o  peer_port
        o  protocol
        o  ssl
        o  ssl_cipher
        o  ssl_protocol
        o  vhost
    
    The notification is sent by rabbit_reader:notify_auth_result/5
    and rabbit_direct:notify_auth_result/4, not by
    rabbit_access_control:check_user_login/2 anymore.
    
    This fixes a bug where a "user_authentication_success" event would
    be sent by rabbit_access_control:check_user_login/2, even if
    rabbit_reader:auth_phase/2 rejects the user later because the connection
    isn't on the loopback interface.

commit 741d0941c3894127463bc28838bdb8c26805bb1f
Merge: e7a6489b6 90ea9de79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:52:24 2014 +0000

    stable to default

commit 90ea9de79665755123de9113da302884c207a16b
Merge: 4c564146e 683754627
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:52:13 2014 +0000

    Merge bug26367

commit e7a6489b69e3f94be621afbd3d37ef46a7a53c95
Merge: 20e598868 683754627
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:46:00 2014 +0000

    stable to default

commit 6837546276fae031cb9dc9bfc949505b2de6e5b8
Merge: b9f9ba1e5 17ef0262b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:44:37 2014 +0000

    Merge bug26474 (again)

commit 17ef0262b80c1f2ea4249b31827f2f5ce8d15e79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:21:48 2014 +0000

    Also add a tiny bit more logging, for symmetry.

commit e5c3e2bb7db0e2035571afd57402494f3d31a999
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 14:21:26 2014 +0000

    Mutual disconnect when partial partition detected. And don't allow a very short disconnection since Mnesia might not detect it.

commit b93597c82ba1c38f29c435e602dd17d08d8e2bb2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 25 12:33:22 2014 +0000

    Do not attempt to "fix up" the partitions field; if Mnesia does not detect the partition it will behave wrong anyway.

commit 1963252daa89ff6736b2d4f776bcf6e9345db0b3
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 20:40:21 2014 +0100

    Add plugin paths to the beginning of the code path
    
    The goal is to make sure the right application is picked, in case the
    same one is available as both a RabbitMQ plugin and an external Erlang
    application. For instance, this could be the case with the Cowboy
    application: a version is available in the plugins, but the user could
    add an incompatible version to Erlang/OTP libdir or set ERL_LIBS to
    point to it.
    
    There's one exception currently: eldap. This application used to be
    available as a 3rd party one. But since Erlang R15B01, it's included
    in the standard library. We trust this version to have a stable API.
    Therefore, if the node runs on R15B01 or later and eldap version is
    1.0+, we use this one. In all other cases, we don't trust it and prefer
    the RabbitMQ plugin.

commit 20e5988683c3d06877a20fcb7aeaec36d2ba2fed
Merge: 580387d71 7fab2fd27
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 18:14:46 2014 +0100

    Merge heads of default

commit 7fab2fd27903b903795722d162da669488d7c3c8
Merge: a29e4c518 589f2648f
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 17:47:17 2014 +0100

    Merge bug26257 (again)

commit a29e4c5187e6d99e05f3f5f9a04dd2d7d793732d
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 17:40:23 2014 +0100

    When reporting invalid cluster node names, keep configuration order
    
    While here, fix an unused variable warning.

commit 4c564146efd846e91dfea547ecb2a73b1509efad
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 17:17:35 2014 +0100

    Add a comment so we remember x-dead-letter-exchange was already verified
    
    While here, rename the check function to a more sensible name.

commit 580387d71c841001db14ee5a9b910fb63eb66c41
Merge: b9f9ba1e5 589f2648f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 24 14:05:28 2014 +0000

    stable to default

commit b9f9ba1e5e27e1b01df972be6ceb6cda47587138
Merge: 1828220a1 f351d4176
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 24 14:05:16 2014 +0000

    Merge bug26474

commit 1828220a1b2a9d57c7405fe1bbd013503df910cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 24 14:04:55 2014 +0000

    Cosmetic

commit d72955e8b315115dd6646edd22110dde2715d0d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 24 13:26:58 2014 +0000

    Even closer to reality.

commit d4626b8900536796b974d1b4b6088193dc262d2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 24 13:24:29 2014 +0000

    Remove out of date subclause.

commit d2416df1f97746646bf519f4af90a073efb4f86d
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Mon Nov 24 12:25:34 2014 +0100

    Restore the "x-dead-letter-exchange" check lost in changeset 12133

commit 589f2648f87bc153beff29ba276d51cff4882713
Merge: e1f85660f e7267bf3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 21 15:08:43 2014 +0000

    Merge bug26257

commit 6d3f2ac7297316c6b85c4c131b1f8b461a4d6af6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 21 13:36:24 2014 +0000

    Drive-by simplification.

commit 76761cf215e889bcde31e0c4c5ffbdb3c797a0fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 21 13:36:09 2014 +0000

    The last changeset made it possible for Mnesia to not report a partition, so do so explicitly here.

commit edf18aeae192c99d9c54e2b3a381795bec799f3e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 21 13:35:22 2014 +0000

    Be a bit more careful before declaring a partial partition.

commit e7267bf3d34667836d52a133098382adda66362e
Author: Jean-Sebastien Pedron <jean-sebastien@rabbitmq.com>
Date:   Fri Nov 21 13:06:12 2014 +0100

    Detect other invalid 'cluster_nodes' values
    
    In all cases, abort startup with an explanatory message.

commit e1f85660f5170b3413f9b4297d878dcf57655ab1
Merge: bef9a347a f351d4176
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 17:28:20 2014 +0000

    stable to default

commit f351d41768a2548fe35fee381c8ea0f2231ed377
Merge: 186ce04c8 3142c3fd0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 17:28:09 2014 +0000

    Merge bug26417 (again)

commit 186ce04c82d80cae1b33565dea3316a7d6ae376e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 17:14:10 2014 +0000

    We don't need to throw that any more, maintain an API like that of rpc:call/4.

commit ba22dac7b2b5584ab40b5bfc1213511cc118a388
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 16:51:26 2014 +0000

    Be a bit more sensible with syncing the ticktime; only do it when RPCing into the node (since there are plenty of commands where we do not expect the node to be up, which the previous changeset breaks...)

commit bef9a347a44d6521290d8368f2ea5e21932876f6
Merge: fc1d49108 3142c3fd0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 15:34:52 2014 +0000

    stable to default

commit 3142c3fd0d311284625888fb839dc2f2c78424cc
Merge: 782e0131b 34ac1cd7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 15:34:42 2014 +0000

    Merge bug26417

commit 782e0131b670f991b821f1ce1871c603b14c06f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 15:33:38 2014 +0000

    Sync ticktime with server.

commit fc1d49108d1561cc7d2db25b9a489c9a4f05fb73
Merge: 21984c64f 34ac1cd7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 09:49:53 2014 +0000

    stable to default

commit 34ac1cd7ff9921f28749fa5707a453fc7975f9d7
Merge: 6a46f5528 82cdedfe4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 09:49:41 2014 +0000

    Merge bug26470

commit 6a46f5528546ce11e5300cd9290197e9d631ac64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 20 09:49:27 2014 +0000

    Sleep to mitigate bug 26467 in the 3.4.x series.

commit 2325ed570a7743fd85d44a54370a2228246d7195
Author: Jean-Sébastien Pédron <jean-sebastien@rabbitmq.com>
Date:   Thu Nov 20 09:45:37 2014 +0100

    Remove support for the legacy 'cluster_nodes' values
    
    Before this change, a list of nodes without the node type was accepted.
    In this case, the node type was guessed and a warning suggesting how to
    update the configuration was logged.
    
    Now, the node type is mandatory and the RabbitMQ server refuses to start
    if the node type is unspecified.

commit 21984c64fc401d9f1c1bf11c185c78dbf726dc15
Merge: bf0e335ba 82cdedfe4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 19 14:36:40 2014 +0000

    stable to default

commit 82cdedfe4ce48bd9b457caefc82457a3dbca06d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 19 14:36:27 2014 +0000

    Don't proceed until the supervisor has actually gone.

commit bf0e335bae5fa304abc3fda05c75f0d073e2bf01
Merge: 221538eee feb6d85cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 17:41:03 2014 +0000

    Merge bug26469

commit 221538eee2cb6a1ba38de5e17866a4379b366521
Merge: 4446c2559 1e84475e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 16:38:07 2014 +0000

    stable to default

commit 4446c2559ff0534930aca62f90c48bef6a878b98
Merge: 48c68e407 e286b845d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 16:37:55 2014 +0000

    Merge bug25788

commit e286b845da707d065574a9a931c804ef2c0714bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 16:37:09 2014 +0000

    Consume and handle {run_backing_queue, _, _} messages.

commit feb6d85ccb7d18e9762680e69a3b94c0439ebc9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 14:16:39 2014 +0000

    Tweak the APIs again, so that authz plugins aren't expected to create a #auth_user record in the first place, just whatever impl they want. Which necessitates seperate login functions for authz and authn, and if we're going to do that we might as well split the behaviours so that we have the possibility of making an authz-only plugin.

commit 17dc4acde6bd15f3943cf69729964190a157e279
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 11:17:19 2014 +0000

    Rename.

commit b76d2bd0e1bea78a05b3e33b5f428f8821e9983f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 14 11:16:17 2014 +0000

    Fix tests.

commit 751b440de2846a87814a2d926043958968a33a7e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 16:18:20 2014 +0000

    Never pass the #user{} record into auth backends, they should only see their own stuff. Get rid of authN_backend, it has little reason for existing. Flatten case of authZ_backend.

commit 1f1aeb21df22abb740483dd011ccec1a25c299b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 14:36:48 2014 +0000

    Cosmetic.

commit 75924c47056260b6f7533c9dce01d8dada072800
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 13:01:35 2014 +0000

    Import changes from https://github.com/gotthardp/rabbitmq-server/tree/multi_authorization

commit 1e84475e7031c04041be1fbe82d3494ed4004509
Merge: 830c24a49 9f4627448
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 12:00:18 2014 +0000

    Merge bug26457

commit 830c24a4928b0ef968e205195aa2b0128d1e662c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 11:57:32 2014 +0000

    Remove a couple of TODOs, make the read buffer size configurable, and don't use the read buffer for the QI or msg store transform since they already read in decent sized chunks.

commit abebb6517d14610bb0ee31f28ee3f10efaeb4154
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 11:10:14 2014 +0000

    Small refactor suggested by Matthias.

commit f285a3880bc5a8b7c77e6f03265cb57fae5278be
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 10:56:33 2014 +0000

    Be a bit more systematic about reseting the read buffer.

commit b838aa5423d99cae683bd9c344c325a7aa3a08b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 10:20:27 2014 +0000

    If they ask to read more than the buffer size, do so.

commit 9f4627448c446becf8a71700cca295e090694446
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 13 09:22:02 2014 +0000

    R13B03 compatibility.

commit 8c132f5822b48f77bcaaea11d80e6e6eb487d708
Merge: 6feef5535 a758b1b06
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 12 16:09:24 2014 +0000

    Merge in default

commit a758b1b061d639eb6a7e0fb5f81ef584620aaddb
Merge: 3c68f6569 edc6ea729
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 12 16:06:02 2014 +0000

    Merge bug24781

commit edc6ea7291e33d8c76702f3d7664018c59ff89cf
Merge: 48c68e407 878212ab4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 12 16:04:11 2014 +0000

    stable to default

commit 48c68e40704ed105b76c23ea66c9e49f49addd38
Merge: 175173eb5 a51b7d8de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 12 16:03:48 2014 +0000

    Merge bug26468

commit a51b7d8dea8e9e585ba927cff6f1f86ace7a6e96
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 12 15:58:40 2014 +0000

    Fix forgetting queue when deleting offline.

commit 3c68f656981fac66162902ddb259c4ff5fc43c12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 11 17:06:42 2014 +0000

    Emit stats on FHC recycling.

commit a765a61c445aa3e44682b280559f39c6671a36e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 11 16:46:20 2014 +0000

    Also generate stats on seek.

commit 6feef553568bbb1ed35915763163dd3c464facbc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 10 13:59:05 2014 +0000

    First pass at adding a read buffer to file_handle_cache.

commit 878212ab43729257d99680c04880ca4d9d871caa
Merge: 175173eb5 532b0ff31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 7 12:21:04 2014 +0000

    stable to default

commit 175173eb54baecd3e166894f4815f1f15d2b9472
Merge: 792be6de7 e5f7de597
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 7 12:20:55 2014 +0000

    Merge bug26460

commit e5f7de597c871d9eec60dcdc99265dd4a5d6af56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 7 12:20:42 2014 +0000

    Don't badarg if a process goes away while running this.

commit 56f30a96e9ce6035f8870faf12a13fe7b7f87d61
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 6 13:51:48 2014 +0000

    Move this formatting up to the agent.

commit ee14d15b0a4dc605cb41f7e2624a8de3904925d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 6 12:49:44 2014 +0000

    Forgot to add that...

commit d0e3516158df5543d7fb086dc53331f215b1ce32
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 6 11:39:25 2014 +0000

    Simple statistics about reads, writes and syncs through the FHC.

commit 532b0ff3107a0cecace3a8bf3c57cebc33ffc68e
Merge: 792be6de7 7ac858136
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 14:48:07 2014 +0000

    stable to default

commit 792be6de739033b17d164328feeedb9c64089f68
Merge: 080ad8ff4 b6442feca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 14:47:57 2014 +0000

    Merge bug26449

commit 080ad8ff4266016f3f2e6ff2761a1f5b7006120b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 14:23:42 2014 +0000

    Also be more explicit about what we don't like; don't just dump out the entire table.

commit 9480b52df2eda4cf73bea73e80d59cd7bd362964
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 14:20:16 2014 +0000

    If we don't know what else to do, at least don't garble binaries.

commit 7ac8581364eed73b3ab1d8f9f0075b5916f7f777
Merge: c2f204b93 981cba369
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 13:20:00 2014 +0000

    Merge bug26444 (again)

commit c2f204b93cf7dee57509f700a27a61f85204e27d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 13:19:43 2014 +0000

    ...and another stupid bug

commit 981cba369a2e7ed0892ce45defe4fab019dd5815
Merge: d10d18bda 51c02274f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 11:28:59 2014 +0000

    Merge bug26444 (again)

commit 51c02274f37cd756962020c700a83160f80b9cde
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 3 11:28:31 2014 +0000

    That shouldn't be a complete copy-paste of the parse_table/1 version.

commit d10d18bda1b8f80669be32a410ae105cd49f76e7
Merge: 77c27bac7 74e267421
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 31 16:19:51 2014 +0000

    Merge bug26444

commit 74e267421affd56e9fcba2f024ca527db11ddc0f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 31 13:09:18 2014 +0000

    Oops

commit 64c9e7cbc1212fd7527ecf77674081983446ce91
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 31 13:08:16 2014 +0000

    Inline parse_field_value/1 and thus prevent sub-binary construction in accordance with the principles documented at http://www.erlang.org/doc/efficiency_guide/binaryhandling.html

commit 77c27bac71007c782c2038ba8ab39297cf98d4f4
Merge: b6442feca 417713750
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 30 11:12:54 2014 +0000

    stable to default

commit b6442fecaf69c073569caab4952b0310bff6238b
Merge: bb20b6bbd b350a581d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 30 11:12:43 2014 +0000

    Merge bug26441

commit bb20b6bbd7b41b98202d0fead94dba6b55a8487c
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Oct 29 22:01:36 2014 +0100

    adds missing CLEAN_BOOT_FILE

commit 417713750c71bab268a7c0cf15f27def791eb8d7
Merge: 90c2e2b8f b350a581d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 29 15:04:00 2014 +0000

    stable to default

commit b350a581d786d1873c42640c11e419a45486c1ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 29 14:12:47 2014 +0000

    Added tag rabbitmq_v3_4_1 for changeset 47d4a08137ff

commit e0c614a20c07df4853007a0a680da0391ef59f48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 29 14:12:29 2014 +0000

    Changelogs for 3.4.1

commit f8121ae94c165bec7a90c024b0ae068792cd5806
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 27 17:28:57 2014 +0000

    Not needed any more

commit 678771b1a9f4dbdce8287953d82f4083ba6b58f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 27 15:25:55 2014 +0000

    Start distribution early so we correctly generate node from "-n"

commit e427d70bb7aee380eaa1a6c48c02eca246b41b50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 27 14:58:14 2014 +0000

    Explain what we are doing and why.

commit a6499ee71ec42b73961a52a32b03358e97ce3d37
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 27 13:38:57 2014 +0000

    Check in with epmd periodically, if it hasn't heard of us then re-register (and restart it if needed).

commit ddeaab14b63dc983192f643a13e3784c578afb50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 27 12:12:35 2014 +0000

    Revert to stable-like behaviour, always starting epmd, but starting it ourselves since we will need this capability later and it lets us get better error messages.

commit 5f718633f55a851b797283cc7ecdb523649b3570
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 24 16:12:39 2014 +0100

    *Do* start epmd ourselves if we want to impersonate a node. And just allow net_kernel:start() to fail and catch the error later.

commit 90c2e2b8f5d386e4184b443ee408e6427e08a081
Merge: 2c66a601e 0b3da0177
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 23 17:16:29 2014 +0100

    stable to default

commit 2c66a601e234fe2ea6a4433c17a7e2a0e4026a82
Merge: f2429678d e79d40bbb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 23 17:16:17 2014 +0100

    Merge bug26429

commit f2429678d3d3d2d8e6c1d8eb12b904e9c1c32893
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 23 17:16:04 2014 +0100

    Log when plugins started / stopped

commit 3b5475471a491360d36bcac3da42c22aa5770ff9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 23 12:55:48 2014 +0100

    First pass at having ctl and plugins not start epmd. This can cause problems though if we are contacting a remote node, or removing a cluster node offline.

commit 0b3da0177a393dc93cf445a9ed3e6b2c4db665d4
Merge: 3a3242153 e79d40bbb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 22 11:26:43 2014 +0100

    stable to default

commit e79d40bbbe91d61f23dffc44d5f73716822c363f
Merge: ff8aa6c42 c412b05cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 22 11:26:35 2014 +0100

    Merge bug26425

commit ff8aa6c424787512d32b3508be11ef74e4a0e794
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 22 11:26:18 2014 +0100

    Read the env file before figuring out USE_LONGNAME.

commit 3a324215323afcbbf08afcdb32d46a38a596a2ac
Merge: 975ed3a0b c412b05cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 22 10:55:27 2014 +0100

    stable to default

commit c412b05ccddc4eef28a0e8f1511e0651ece98946
Merge: 975ed3a0b ba4caa817
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 22 10:54:58 2014 +0100

    default to stable

commit 975ed3a0bf5893a71009c6516ec81f9ac9865f27
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 14:58:56 2014 +0100

    Added tag rabbitmq_v3_4_0 for changeset e88d71c0fcdf

commit 5aa9a3cec69e052fdf94fdb48cb831d01102a8e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 14:58:39 2014 +0100

    Distro changelog for 3.4.0

commit 8485061cd034d483c848d306ce3335dc5bca70af
Merge: d07f0295d 69b5cd601
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 12:53:42 2014 +0100

    Merge bug26423

commit 69b5cd601b1cfab136edbe33fc59f6994488a57f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 12:53:27 2014 +0100

    Change home before executing rabbitmq-plugins so we pick up the correct Erlang cookie. But only do that if the cookie exists, otherwise we might create one owned by root and break everything.

commit d07f0295d18ce32d017eefdc6040a5e1dd8a5a50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 11:14:11 2014 +0100

    Rename this since it shows up in mgmt / ctl and should match the user name for the connection.

commit 5a98ec1054857ad0370ac8ac658ae306c8fd4376
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 21 11:07:03 2014 +0100

    Allow people to re-enable SSLv3 even on newer Erlangs with ssl_allow_poodle_attack; people might be stuck with SSLv3-only clients and view this as the lesser of two evils.

commit 5ef6f9cb1b6de8a9d91b733efae498ef9859f0f0
Merge: 183a1ab47 69f4e744b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 21:00:13 2014 +0100

    Merge bug26422

commit 69f4e744bddad7fed8ea67f84f0ed1e343dd02f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 20:59:42 2014 +0100

    Also ignore sync messages if needed.

commit 50c3620242aba4aafd19ce16edbdc1faefb745a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 20:57:13 2014 +0100

    Sleep briefly, and explain why.

commit 183a1ab479d409db0e9ffdcbd6e9ee7422b0b119
Merge: 2478b4090 837509175
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 16:12:29 2014 +0100

    Merge bug26419

commit 837509175ef2431f55f0882091f51664fda821e8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 13:57:05 2014 +0100

    Test for old Erlang, and shout if we are vulnerable.

commit 8f2c2d08abbe60a6ce665c78aff2d5f5008e9efd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 20 12:55:01 2014 +0100

    Remove bad SSL versions from the configured ones, don't hard code good versions (which differ across Erlang releases). Never permit use of bad SSL versions. Export a function to do this with.

commit 1d0be28cdaaf42994fbf88ea88ffb347abe1b150
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Oct 20 11:21:55 2014 +0400

    Update rabbitmq.config.example

commit 16f86385097a0d52b147cb351fbe5a150e4e4074
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Oct 20 11:21:46 2014 +0400

    Handle edge cases, log enabled TLS/SSL versions

commit 40a8f5113225e923396cd2d4ab919ebf2c42921c
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Oct 20 11:21:13 2014 +0400

    Override ssl_options.versions in the app descriptor

commit 2478b40901922dcf923a978dcbe7bea7979e1eb7
Merge: ca64918f9 c33ba9438
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 17 18:17:13 2014 +0100

    Merge bug18626

commit ca64918f95642f0b4c1a108528d64166f3cf86b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 17 17:35:46 2014 +0100

    Fix plugin activation on Windows.

commit c33ba94384546db803bee2ea9b8124d4f7e774c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 17 17:19:40 2014 +0100

    Correct how to refer to environment variables.

commit 1780ff7927707c6424d857833b1931259b914901
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 17 14:40:39 2014 +0100

    Add RABBITMQ_USE_LONGNAME. Based on a patch from Marcos Diez but with fixes for the new way rabbitmqctl starts distribution, refactoring of common stuff into rabbitmq-env, not trimming the hostname, etc.

commit 383a64375102048030863b00dbc6e19253f75e6d
Merge: b4f53932d 43378e7f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 15 17:01:34 2014 +0100

    Merge bug26368

commit 43378e7f842d7eae03849e0d4399971ca2fdfbb6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:22:54 2014 +0100

    Just in case something goes wrong in our weird unsupervised process, log it.

commit 4e48ea6f2589615afb99113a8576427d8b6c8019
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:22:26 2014 +0100

    Be a bit less verbose here: it's actually a very common case and perfectly normal; no need to dump state.

commit 0dee55e9d90738d0ed1fc832ac205f4a679a3cde
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:21:24 2014 +0100

    Check whether the cluster is fully connected before trying to autoheal, and ignore autoheal requests if it isn't.

commit 621628e07b87181af8ebd609c945e5d551b198d1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:16:34 2014 +0100

    Switch to having the winner inform the losers that they need to stop, rather than having the leader do it. This fixes the race where the leader tells them to stop before the partition has healed from the winner's POV. So it should be simpler and more correct.

commit 99912404206130f34b8aa370150b624ee1320219
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:13:29 2014 +0100

    In fact, that case can't happen since bug 26043, so let's simplify.

commit 7ad60addd98f8382b102be50250d573d5524c78b
Merge: b4f53932d d993139a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 14 15:12:36 2014 +0100

    Merge in default (move from stable to default; we need to change the protocol)

commit b4f53932d40bfbc6ef3fa1f61f903478a3b76e14
Merge: 7dbfe9d5c f2cb9a133
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 13 10:53:12 2014 +0100

    Merge bug26404

commit 7dbfe9d5cb59cda240d35abd7afc8d0a2d1d858a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 16:32:18 2014 +0100

    Also avoid partition-related hangs here.

commit d30e9b269cec365f19e24496f0a6cc293be7ae82
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 16:22:27 2014 +0100

    Use a new function introduced on default

commit 2cb7a0389c023a632e46fb30d3f0dcd044c47e01
Merge: f2cb9a133 b12028d78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 16:21:09 2014 +0100

    Merge in default

commit f2cb9a133a45116ac4c12e52f99bfca36a5a5361
Merge: d8a5d27d6 fe55135fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 15:29:13 2014 +0100

    Merge bug26408 (again)

commit d8a5d27d601cbb008a244ebaec490d538b174189
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 15:28:49 2014 +0100

    Separate out different is_process_alive implementations depending on whether we want to consider the process alive if it is running but we can't talk to it via Mnesia. Thus unbreak exclusive queues with the direct client from non-Rabbit nodes.

commit fe55135fbb4190b28c849bcad0e8269bba1b462b
Merge: bb77801b9 26f19a76d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 11:38:54 2014 +0100

    Merge bug 26408

commit bb77801b95ba5e4447cd962ef7f76cd60fe18250
Merge: 546be94e6 4ccaec4bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 10:59:55 2014 +0100

    Merge bug26410

commit 4ccaec4bfb84f75ac02cceb1978af21aa7b63ed6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 10 10:59:42 2014 +0100

    Use flow control when talking to the message store, on a fast machine this test could overwhelm the message store such that gen_server2:drain/1 never completed.

commit 546be94e635b035c7abef62a2d233890682a38ac
Merge: 4253b0a11 3dd516866
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 17:22:28 2014 +0100

    Merge bug26409

commit 4253b0a1176964fb6713a89f83ef11037e45d069
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 16:33:30 2014 +0100

    Rethink partial partition detection: switching to disconnecting the node that first saw a DOWN (rather than the one that DOWN was about) means we don't need the delay. Also don't attempt to ask nodes we're partitioned from to check; let's not multiply entities needlessly.

commit 9ab1051ca0e168eeae6f478e2d393a4a39099280
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 16:31:19 2014 +0100

    Check Mnesia's idea of which nodes are running; avoid infinite loop.

commit 26f19a76d71565ff1f46567e0abb77e54d0a4879
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 16:17:28 2014 +0100

    Oops

commit c3ef17d9515ab2cd949f82cc2a6e0bb0662aea78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 16:09:48 2014 +0100

    Slightly more accurate comment.

commit b0f2c4644801a1116fbe17adba57c65e87f863ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 16:09:14 2014 +0100

    Make rabbit_misc:is_process_alive() return false for nodes we are partitioned from; prevent prequeue:init/1 from entering an infinite loop on partition.

commit 3dd516866b71143340647f9ad0295867d38a7cb5
Merge: bc4c82b53 81bb4cd01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 12:31:25 2014 +0100

    Merge bug26407

commit 81bb4cd0163e75459e9f5d8537740ba95bc1276b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 12:31:14 2014 +0100

    Partial partition delay.

commit bc4c82b534af4de685a4c8f1b5a7abecbbf36c10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 11:21:30 2014 +0100

    Mini essay

commit a2060f3bdf2bcf00c1b50dd9fd84e4fa20334ed9
Merge: 332a46470 c29289025
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 10:25:12 2014 +0100

    Merge bug26406

commit 332a4647021c399a72566faa0f295c5e9830bbbf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 9 10:24:58 2014 +0100

    Update docs.

commit 9aab11d58d559bea0136e1501024046456e76fdc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 8 17:40:42 2014 +0100

    Return environment for all apps.

commit c292890255537ad8cc5f9a87758130bf2c6f4062
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 8 16:56:32 2014 +0100

    Unbreak quickcheck.

commit b12028d78500722af5e7ec7aff162a36ebafce01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 8 15:41:31 2014 +0100

    Defend against partitions at the wrong time causing badness.

commit 712dffc63727a52456019616b43f590ffb5e4024
Merge: 5e489451f a708ae30f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 8 12:43:26 2014 +0100

    Merge bug 25850

commit a708ae30f67893107f9bc19be37905acfef108d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 6 17:51:53 2014 +0100

    Rename function, and GC for large messages on the way out, too.

commit f5da98ae1e3604e5fefd03359bca8d24e9fabaed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 6 16:53:04 2014 +0100

    Prevent the channel from holding a lot of binary garbage when accepting huge messages.

commit 5e489451fccf995a55f0affa0a02ab84d2d13471
Merge: 37c0ea90c 24b140abe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 6 13:08:00 2014 +0100

    Merge bug26401

commit 37c0ea90c8f0266a2dfd68952c0135631535e9e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 6 12:10:18 2014 +0100

    Classify ETS memory by owner (and thus include all msg store memory under "msg store index").

commit 425a2c70194eee59ea8ef25eef19c160e4cf8363
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 6 12:09:42 2014 +0100

    Split out connection memory into reader / writer / channel / other.

commit 24b140abedb163453a432d047620f30316509c3f
Merge: 233d59118 844160880
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 18:05:08 2014 +0100

    Merge bug26213 (again)

commit 8441608809bb15c72b86707b95a45a10caf6278e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 17:50:18 2014 +0100

    Just because we received a running_partitioned_network, doesn't mean all nodes are now contactable. Defer attempting autoheal until we can talk to everyone again, to avoid getting stuck in a loop with partial partition promotion.

commit 4362d306aa009c0227d986b6b61bd1abe4b9d07b
Merge: 233d59118 33c2f127d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 17:05:13 2014 +0100

    Merge default

commit 233d591185dcd45166b49d107a60f44e6c91849c
Merge: cf283a00f d993139a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 17:04:54 2014 +0100

    Merge bug26368 (again)

commit d993139a0dc3e31d366d16d8948a0a3e614d8964
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 17:04:33 2014 +0100

    Distinguish between "already stopped" (fine, carry on) or "already down" (abort since we've lost contact).

commit 33c2f127dc7fa9b874cc092c27fb81616395765a
Merge: cf283a00f deed1ed5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 16:58:02 2014 +0100

    Merge default

commit cf283a00f7176d07445fd88862e7d8c1a5880a5b
Merge: 9787bc9dc deed1ed5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 15:21:06 2014 +0100

    Merge bug 26213

commit deed1ed5eb8fd5bf0296d879424c9697d8ad0c66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 3 15:20:47 2014 +0100

    Allow requires / enables to be multiple steps, reduce ugliness.

commit 9787bc9dc80da03e25a51c5c24437e2f6785c34f
Merge: b4de8b80f 103fce22e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 2 17:13:12 2014 +0100

    MErge bug26398

commit b4de8b80f3494e50750e062416590565bb545ed5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 2 17:01:49 2014 +0100

    Oops

commit abcaafbbd2bab1436bd44184fddd666a854c178b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 1 17:27:21 2014 +0100

    Present memory and aggregated binaries in the same way.

commit 103fce22ebe88098a2db5d70e69a5b3c29c674f6
Merge: 3a8a87352 fb1403882
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 1 16:46:24 2014 +0100

    Merge bug26397

commit fb140388250c69bec9dd0a85c5783cfce01b27d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 1 15:30:55 2014 +0100

    Simplify.

commit 3a8a87352a72082c7a1498f7d9e1983ccd43f7af
Merge: 82807edaa ba4caa817
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 17:47:34 2014 +0100

    stable to default

commit ba4caa8176a5d7a2df80e02c9ee6b3c14a92079d
Merge: 931c2e31f 0b1e3421a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 17:47:24 2014 +0100

    Merge bug26040

commit 931c2e31f0b9f895e4be965dd43e63828990f464
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 17:47:11 2014 +0100

    Add dependencies for some things we have always needed.

commit 82807edaa4aca07e79ceeb7af55f0418e7578163
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 16:15:13 2014 +0100

    Log something when the app stops, so that we can tell when stop_app etc has succeeded.

commit a461dc189698ff89bad20e1a1cf819bf112adc57
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 16:14:39 2014 +0100

    In the event of a partial partition in pause_minority mode, pause until everything comes back - otherwise we stand a chance of just reconnecting and still being in a partial partition.

commit 9c892dfbd1f33099ba8b5eb9b0de7ca9cd073041
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 13:58:46 2014 +0100

    Oops

commit ec3bae780dd7d2d017a7d20c1ceccaa099893ca9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 30 13:46:20 2014 +0100

    Split out slaves into their own bucket.

commit 70ea2828f2d866186c293069134fd7f6c9be94ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 29 17:51:53 2014 +0100

    Partial partition detection and handling (where by "handling" we mean "promotion to full partition"). This necessitates that we hold GUIDs for each node (so that we can detect if a node has restarted behind our back).

commit 6fdb08c89f9826dd78ec28e19035f1ee6a964682
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 29 15:45:48 2014 +0100

    Oops

commit 861f1276ae6792e6b73e3dbdefeb74d6c4f1b04e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 29 15:19:31 2014 +0100

    Revivify 664ddb5eccf1.

commit d73fafd162bc0b7176683601f78ef65e08843b2d
Merge: d0ec4655c 44b68e1bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 29 12:20:36 2014 +0100

    Merge bug26394

commit 44b68e1bcf7ccdd79bad929a5f7b864859abf4a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 29 12:10:59 2014 +0100

    Cluster keepalives.

commit d0ec4655ca3bf687addaf3a08868b71bea4309e7
Merge: 8e4209055 66d713595
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 25 11:32:01 2014 +0100

    Merge bug26389

commit 66d7135950732631d2063dda2628a37d03c0be99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 25 11:22:37 2014 +0100

    When we add a new consumer we might be inactive; make sure we transition to active since consumers by definition start out unblocked.

commit 8e4209055392d6537c369ff574a48d6724dff456
Merge: 3fd097abb 2663f28b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 24 13:59:50 2014 +0100

    Merge bug26386

commit 3fd097abbccb53ed76bd637049adad203b212b66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 24 13:26:11 2014 +0100

    Just log a warning if we can't start the logging exchange.

commit 2663f28b44b804321a41c81e8397b3197295f7ae
Merge: a795964a6 cad212629
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 24 12:44:52 2014 +0100

    Merge bug26387

commit a795964a632f397af39645a89f5927fb52e75743
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 24 12:26:30 2014 +0100

    Work around Surströmming-addled ideas about how to report version numbers.

commit cad212629e565c1cc3248a066cf1239bd788c52b
Merge: c23c14447 671e3f051
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 22 16:53:39 2014 +0100

    Merge bug 26378

commit c23c14447386f71c3d5a7100cae2a904199fb95d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 22 16:51:46 2014 +0100

    Move actual supervisor definitions out to avoid conflicting behaviours in a module.

commit 671e3f051fd5c9a9b5ecc78ce1d55240d9fc42cb
Merge: 250d861d4 9574e9796
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 16:59:50 2014 +0100

    Merge bug 26216

commit 250d861d41240f5affe957c39ad28be0a68dad37
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 16:59:36 2014 +0100

    Ensure we always compile test code, in case plugins need it.

commit 375d3935b370ddc779f882510ae657394c609762
Merge: 9574e9796 054c1fbd0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 14:24:10 2014 +0100

    Merge in default

commit 9574e9796cf47ea7f3518ebe4835847eec37857a
Merge: 00efde34f b0e5b036f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 14:23:16 2014 +0100

    Merge bug26216

commit 00efde34fe3f29ad4f12f7f176729d4a30ccf189
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 13:27:06 2014 +0100

    Move test modules to their own directory.

commit 054c1fbd0795a0d2edd2d7f61105def06a5801c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 12:26:23 2014 +0100

    Split mirrored_supervisor_tests in two to avoid behaviour clash.

commit b0e5b036fb31ea80d13d52e7be2ea4590963fc79
Merge: 4844f3d4d 8eb153f1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 11:40:01 2014 +0100

    Merge bug 26375 (again)

commit 8eb153f1a87f8ac6028f3f7950ce221f42f4c4a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 11:39:43 2014 +0100

    Make sure we only return the plugins we want here even if others are unpacked.

commit 4844f3d4d2f3139d0aa5bdbac611975975c99e1c
Merge: f4a013833 70aaaf419
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 18 11:25:42 2014 +0100

    Merge bug25824

commit 70aaaf4197045e5d9173ef1b1e095d423b9e0a21
Merge: 68fa1dd3a e6153d9b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 15:55:31 2014 +0100

    Merge bug26375

commit 68fa1dd3a1d414cd27178a65dba26627cb533734
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 15:53:07 2014 +0100

    fewer gratuitous line breaks

commit dbaa11b6f0a30c42b611cb99fd1d061a2cbe01c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 15:51:34 2014 +0100

    If there are enabled-but-missing plugins, don't fail activation; we don't fail to boot here so live activation should be OK too. The command line tool will have warned the user.

commit a96ea0968abebe54ff3831dd705f0f1d4db2465b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 15:50:30 2014 +0100

    Always warn if there are enabled-but-missing plugins.

commit d174409fc0946668f4a8edad9ff342cf09b6df21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 15:03:24 2014 +0100

    Rename GM:terminate/2 to GM:handle_terminate/2 so that it doesn't conflict with the same callback in gen_server.

commit e6153d9b5763828d15525f1813a646a0c84c7d3d
Merge: 8d1d7257c b55dd7659
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 14:56:33 2014 +0100

    Merge bug26211

commit b55dd7659044b4800528383b9b2fb6826df818ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 14:33:50 2014 +0100

    Work around what looks like a bug.

commit a87901e293ca659ddf7958ef7faaeb3ee40e6f12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 14:21:47 2014 +0100

    Also since we are here, fix old-Erlang behaviour_info/1 that got out of sync.

commit 3c1490ac6695c6b21be950d04c1b277f82454954
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 14:16:32 2014 +0100

    While we're here, fix another warning.

commit 07c80659e7a81b3f03ae2cde508c042735a7b68c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 14:15:09 2014 +0100

    Switch to Erlang 17-style types, /0 versions at least.

commit 8d1d7257c81468c9043511cfcdb80878ef532295
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 13:35:17 2014 +0100

    Specs for the spec god!

commit f4a01383323515a807919031e2d90360a6954622
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 13:14:20 2014 +0100

    Crude binary-summarisation thing.

commit 8e79c0baa6add35d6119942f3e8118930c77c973
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 13:09:12 2014 +0100

    Oops, that was renamed.

commit e17ed03d0db94e75d171384b3124b8af1198f6ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 11:44:17 2014 +0100

    Pass the full queue to BQ:delete_crashed/1 since priority_queue will need it.

commit 01cf202e04f9c773d60c91e850dbec42447e5caf
Merge: be81703fa 5567b10f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 11:13:30 2014 +0100

    Merge bug26370

commit be81703fabb4be58cb54bc94e67772d3df22c5c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 17 10:13:48 2014 +0100

    Reinstate exported action/6, rabbit_test_util uses it!

commit 28554c2d339a759a09bb0310529296838d38d49c
Merge: f76526252 d86bdf4e2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 17:52:01 2014 +0100

    Merge bug25955

commit d86bdf4e26710a859a7c5f9241d2110255f41407
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 17:18:06 2014 +0100

    Update tests

commit 6ce43e40b12c0d8dac9a486d6ca0735186520821
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 15:03:37 2014 +0100

    Extract more commonality.

commit a6c97140182effe407e483ff1287225d26058b36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 14:32:37 2014 +0100

    Extract commonality between rabbit_control_main and rabbit_plugins_main.

commit f76526252d8908cb5c00cb328f00cc27e1358508
Merge: 949675333 12d7b079f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 12:01:38 2014 +0100

    Merge bug26366

commit 12d7b079fd0ce0fb29bf06b6f1283dda1598b22f
Merge: b9dd1c596 0b1e3421a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 12:01:17 2014 +0100

    stable to default

commit 0b1e3421a0e0318e7f5886ab7fa8a0ee7db2d4b3
Merge: 0fb60c910 02888fca1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 12:01:06 2014 +0100

    Merge bug26344

commit 02888fca1da26cc5888084d996a6624be8d89474
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 11:56:20 2014 +0100

    Make sure the server sees RABBITMQ_CONFIG_FILE and can thus log the config file location even if it's absent.

commit 5567b10f61b03be9660a09d34ec777de0320ccf5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 11:52:32 2014 +0100

    Only check vhost / user / permission tables before inserting default data in case we somehow get a row somewhere during early startup in first boot that confuses the check.

commit 94967533316fe11514cb6128adbfac035ddf3b3d
Merge: b9dd1c596 56d2bc80b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 10:46:22 2014 +0100

    Merge in default

commit b9dd1c5960d6a46618b58b3c58e3e416cbf5d563
Merge: e5b17ce4b d103810bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 16 10:37:06 2014 +0100

    Merge bug26151

commit e5b17ce4b1a945d09d695305b066b0798717776c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 17:39:32 2014 +0100

    Delete a bit of complicated code.

commit 08112652e6b02c8b84163f136142c873a21ddd61
Merge: 1180168d0 d103810bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 17:08:37 2014 +0100

    Merge in default

commit d103810bdc89b676a3e6b737712c169521fb3416
Merge: 5b05113ac c664ae90a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 17:07:21 2014 +0100

    Merge bug26372

commit c664ae90a580c8508b32f9fc779d69f09e765eca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 17:02:59 2014 +0100

    Oops

commit 283503dad3026ab0417b45084def92e661c36c68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 15:39:23 2014 +0100

    Reify queue crashed state.

commit 56d2bc80bfa2e62201cbdc1d78418fc5b1ef7431
Merge: 5b05113ac 21dcb7473
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 13:13:33 2014 +0100

    Merge in default

commit 5b05113acc65775b5c7ef3373984c5db7e54ce81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 13:06:51 2014 +0100

    Be more assertive, don't assume application.

commit 281eb306a38cfe16f91e702d6cfd95ffde8bdd7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 11:39:47 2014 +0100

    Believe it or not, bug 21446 perturbed things enough that this was no longer enough (on CI at least) in wait_for_confirms/1. So bump it I guess.

commit ea70bbe7582cb2aceb1f2067de673918e301accc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 15 10:09:23 2014 +0100

    Stack trace on test failure.

commit e04bd35f6d0dd1f1d3e797c10f121836be21a414
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 12 18:02:58 2014 +0100

    Post bug 21446 this test became racy since it is supposed to kill the queue and not have it restart - so let's kill the supervisor first.

commit 888cbfb09d83dec60511d274676edd004b88ec7d
Merge: 0fb60c910 c5563363b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 12 14:14:56 2014 +0100

    stable to default

commit 0fb60c910be43fec6e74f7e02017c1fcc233c893
Merge: 073d29015 537cfc84b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 12 14:14:45 2014 +0100

    Merge bug26368

commit 073d29015962cc810b0108caeee4e7b8c900f6f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 12 14:06:02 2014 +0100

    Make sure we don't hang waiting for a node to go down if it went down before we became the winner.

commit 1180168d0267e16d0beb919907b96d558e0c1f37
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 13:50:28 2014 +0100

    Add crashed queues to the output of "rabbitmqctl list_queues". This is rather fiddly since we need to distinguish between queues which are crashed and those which are deleted in between us checking Mnesia and calling the queue pid. We do this by observing that the deleting queue removes its own Mnesia record, so we can check again and if the record is still there after the pid is down, it must have crashed. But this is still rather fiddly; and I wonder if reifying the crashedness in Mnesia would be cleaner.

commit 56f63e73b33fbec616e50c47ea8270d4dea5a656
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 12:05:04 2014 +0100

    Emit a final event to say we crashed.

commit 8b7dd7f2db2d64df15171c22c0384328a697f870
Merge: c5563363b e846352bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 11:32:57 2014 +0100

    Merge in default

commit c5563363b43b460b149a20aef915c66284fe92ec
Merge: 94d0eccad b046454c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 11:32:09 2014 +0100

    Merge bug21446

commit b046454c170760b98cbdc6aeb5f2b795e28dd048
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 10:54:02 2014 +0100

    You should be able to delete a vhost containing a crashed queue too.

commit 2d04091415884ddb8a548f6bb0f66b7f4313b515
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 11 10:53:43 2014 +0100

    Improve comments

commit 21dcb7473949783e582df1f59acbedcb322f8bc9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 17:47:19 2014 +0100

    Quotes.

commit 0c197b506acae19b36d2f535edfaec739dc1c833
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 17:45:49 2014 +0100

    ...and the same for exchanges.

commit 27b9f2e9b0ce75746fa5556dcc4b882ef8cf2025
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 17:35:53 2014 +0100

    Sensible errors on queue durable / auto_delete inequivalence.

commit e846352bc3c49ec10a334d67e3f920b1e7c8c6b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 14:10:17 2014 +0100

    Show down queues in "rabbitmqctl list_queues"

commit e0569fb9abb4679c53dd705eb7458841e50c4ed7
Merge: 94d0eccad b278513e2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 12:56:56 2014 +0100

    Merge in default (no-op)

commit 94d0eccad65094e2b2912691ffc95df022a07483
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 12:50:45 2014 +0100

    Move some chunks of code around and rename a couple of functions in order to be closer to bug 21446.

commit b278513e289b8ce0c7c90c4b9ed95f13c7b44c20
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 12:14:49 2014 +0100

    Restart exclusive queues correctly, update comment.

commit b8cb778430df6279716f9ce4d8b849a518c74474
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 11:59:06 2014 +0100

    Further reduce distance to default (especially in slave), by getting the prequeue to pass straight into the right module at the end of init/1.

commit 63678f206f5648c64459574ab4b748c5852cf094
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 10 11:24:14 2014 +0100

    Fix type spec, fix a behaviour warning.

commit 712582cec362a976289a47ba157fcc5441c73931
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 19:06:06 2014 +0100

    Reduce distance to default, especially WRT rabbit_amqqueue_process startup.

commit 169f86f64c3f1cce2806678bf5f786f6c2ae0b2e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 16:22:22 2014 +0100

    Minor simplification.

commit 5b6e7584ecffcd75ebe7834be83fa577e681005d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 16:14:55 2014 +0100

    Oops

commit 3b61fd6cb61dd43fe72b3cfff538b83aa1d25c30
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 16:03:47 2014 +0100

    Rename slightly and improve comments.

commit 0e4e08db5efb14a09fdc270b538cd0aea73c3683
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 14:37:23 2014 +0100

    Oops

commit dd1cbf056111bc58354dfd125a5d0ee179e7949f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 13:46:53 2014 +0100

    Oops

commit 2c36785add18a3e453cab2e42d4a61e0bb732ff0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 13:41:38 2014 +0100

    Cosmetic

commit 5a87bdd60e32f8cdc62796f51f98f452e8f7ad99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 13:36:06 2014 +0100

    Introduce the idea that queues can be absent for a reason. The traditional absent reason is 'nodedown' and we have a new reason, 'crashed', for when crash recovery has failed and the supervisor has given up. An absent crashed queue is nearly the same as an absent nodedown queue, but we allow for deleting it since it can't be recovered by bringing a node back up.
    
    Currently absent crashed queues are not handled properly by mgmt (they appear to still be there); we might defer that to bug 26151.

commit c979b3ddf5edb70cb9c2fd849c7af2edee655cdd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 9 10:47:16 2014 +0100

    Try to be consistent.

commit 4719aff4a5e3ce82ac9a63c320bffb62c1d5d681
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 16:08:04 2014 +0100

    Spec

commit 79a4d4a5bb641711e5eee93807990de6ba5554bd
Merge: 44be90747 2783826e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 15:58:00 2014 +0100

    Merge in default.

commit 2783826e4f2f21d6c99a85a39cce1f86a67eeea2
Merge: e5cd5b0f6 c5fdae220
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 14:26:41 2014 +0100

    Merge bug26363

commit c5fdae2207ef1bc6a255ccf74861437ad3ddda81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 14:11:47 2014 +0100

    Filter out nodes where Mnesia is not running.

commit e5cd5b0f601bd56cb00f1111b56ff5ac1a0f42d1
Merge: e4cc07491 537cfc84b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 10:25:31 2014 +0100

    stable to default

commit 537cfc84bc0c6d380b527ef1e3b1c40e1e0c44af
Merge: 80d5c8444 5190ad068
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 10:25:19 2014 +0100

    Merge bug26362

commit 5190ad068a02efce0853b65a6aa45ab75105cfe5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 8 10:25:02 2014 +0100

    Slightly less threatening error description, and add stack trace

commit e4cc074918df919faf5002b9ed88db2de51a2b4e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 22 15:20:16 2014 +0100

    We can't assume encoded lengths, so do it all in lists.

commit 4d0100e82651dbbe48b5f306ee08b61811f05123
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 22 11:59:53 2014 +0100

    That's not been relevant since 2.6.0 or something.

commit d7d75ae3d43614414cdfffefaa45824a8041d9ff
Merge: 80d5c8444 914e917df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 18:32:35 2014 +0100

    stable to default

commit 80d5c84443ee16424bc254325ae5d08f8300150a
Merge: 25e58ccfa 238243b10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 18:32:24 2014 +0100

    Merge bug25214

commit 238243b10ba6f666fcd8e84289525961fe6e68b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 18:32:09 2014 +0100

    Rename boolean to reuse / single.

commit 1a32616b744f4dab09cba4e7a7e747c2b6550361
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 17:51:07 2014 +0100

    Make Mnesia tx worker pool jobs use a disposable process so that if mnesia_locker decides to randomly send a message there later it will just get dropped and not cause chaos.

commit 44be90747f04fe87152fdf0fde332fb21412ed06
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 16:21:24 2014 +0100

    Unmislead comment.

commit bc89c97e18625cf44748ba180ea9bb0d1deaa755
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 16:18:04 2014 +0100

    Don't leak supervisors.

commit d0b01e9c4edc3fb6fa32c4daf8f3bbe089e10204
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 13:50:38 2014 +0100

    Remove silly race.

commit 914e917df9082ced1a275779af96a8782a53aef6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 21 09:38:16 2014 +0100

    Avoid binary:split/2.

commit ba7b3357fae655597055bac121af67eeb3373560
Merge: 7c11db033 a9e388787
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 18:29:36 2014 +0100

    Merge in default

commit 7c11db0333b2ec7149ed9a5927ba841473f3f056
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 18:21:32 2014 +0100

    Cosmetic

commit bb5f003943418a5ef420455d7c6870838dc6948d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 18:16:46 2014 +0100

    Make this test make sense for the new regime. There will of course need to be lots of new tests but at least this passes now.

commit 30b72308337928b0242f1a4782938382e65efafc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 18:15:43 2014 +0100

    Switch to making our restart decisions based on explicitly determining whether we are starting for the first time or not. This is not very OTPish but it turns out to be necessary: there's no way to distinguish between losing a race to declare, starting a new slave, and restarting to a new slave otherwise. As an upside this code is shorter and more obviously correct (to me at least).

commit 8a068563e41a91133ff54538297f7590b9bd1cf3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 15:02:02 2014 +0100

    Allow crashing queue processes to come back as slaves if that's what we need.

commit 3d5b0de01b1e79e5f791511255e06b508c94a149
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 14:45:00 2014 +0100

    This is perhaps more honest; if the queue was transient we will not recover anything and if the queue is mirrored we will restart a slave and then also not recover anything.

commit c2237b75e9287da70866e51017e9ae72b8ebc510
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 14:34:35 2014 +0100

    Allow transient queues to recover.

commit a9e3887873b0556544abd24883ff5bef43c6892d
Merge: bed8ade87 97aab5103
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 13:26:45 2014 +0100

    Merge bug26353

commit bed8ade87f2d56440870471043e1697cec43a966
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 13:26:31 2014 +0100

    Those diagnostics are actually a bit dubious, they insert quite a delay and aren't really designed to be logged.

commit 97aab5103d236218d96e0e3bac5372379350365a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 13:18:43 2014 +0100

    call/2 -> call/3.

commit d120950af98a08ccc7cf3a5b609240e00f155ba6
Merge: e5fc9f333 8d7621864
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 12:21:15 2014 +0100

    MErge bug25813

commit 8d76218645adfc2f3e45be262488c5d970d7dda5
Merge: 25e58ccfa 29786bd0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 12:02:26 2014 +0100

    stable to default

commit 25e58ccfaaa246e05ed900c29aac429cfa0d6ce4
Merge: 67564d07b 5867c0b7b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 12:01:15 2014 +0100

    Merge bug26354

commit 5867c0b7b820717f115252ddd355ddf84e35ba93
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 12:01:04 2014 +0100

    Get the message format right for this case too.

commit e5fc9f333c0a496f08efda2730c36d9482992c30
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 11:53:23 2014 +0100

    Fix a race.

commit ee12635ff82a2da3c339ef71c08424bd7b21bf8c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 11:07:14 2014 +0100

    We handled that case in 359da524140b

commit 51cef71c260ff96e6412ec618ba908d73191e176
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 20 11:03:38 2014 +0100

    Add an intermediate supervisor so that if a queue exceeds its restart limit we don't bring the whole server down!

commit 79c7b604f6714c8dc3fa2d17b4c2d6c439838bdd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 16:48:34 2014 +0100

    Log that we recovered. Also store updated pid in Mnesia!

commit 78dd756cf2062f7799fc9cf5d0d5628f888f7fa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 16:12:55 2014 +0100

    Allow crashing queues to recover themselves.

commit 26e6d9f73d3a7724ead932938a4fc70e822d5d44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 15:39:48 2014 +0100

    Remove a pointless check here - we will check from within an Mnesia tx in rabbit_mirror_queue_slave:init_it/4 anyway, which makes much more sense (and it will make little sense to check at slave start if we can restart a crashed slave).

commit d50b69bf50334f1b29ea33882a908d5a24351402
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 15:33:24 2014 +0100

    Another copy of the master_in_recovery check. Not sure that's very elegant, but I don't think we have much choice.

commit 071fa9d3d6d2768aa20d58222ef704802dd8fec3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 14:55:42 2014 +0100

    Roll slave startup into the new mechanism.

commit f0f337781d32bc89a25dd9278e372ef1cab3cd31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 13:58:13 2014 +0100

    Various spec-ish fixes.

commit fc5d02aa27e4046284d28fc6bd954fc4a46bfae0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 19 13:29:19 2014 +0100

    First step along the way to queue restarts. Create a "prequeue" module whose job it is to decide how to proceed, and then have the supervisor start that. At the moment we only handle rabbit_amqqueue_process startup through this, but that will change. Also move the tx which decides whether we successfully declared the queue or not into the first part of the queue startup (before we call into the queue) since in future it will be needed for other things.

commit 7d26dce13c03f93e97413573ae37f7474aa05f6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 16:08:53 2014 +0100

    Return 1 consumer.

commit a4121655d66ba9abf8d209d0fd45e1941046f7b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 14:39:05 2014 +0100

    Implement declaration.

commit 29786bd0bf41b008226f09acaa27a98b4908adf2
Merge: 67564d07b b8a77b27a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 12:56:41 2014 +0100

    stable to default

commit 67564d07b8c670ff7dc6300d26114ea51a88cb84
Merge: 3b12cf2d9 743d6b7f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 12:43:24 2014 +0100

    Merge bug26347

commit 3d91c7bdc240a274735c8b40f1886d4f881d7533
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 11:37:32 2014 +0100

    Prevent malicious channels from sending messages to arbitrary processes with this mechanism.

commit 28c99ee6b3abb17724e2c53aafa7a524a1f408ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 18 10:29:32 2014 +0100

    We'll just document that mandatory doesn't work.

commit b8a77b27a1592b2f3320812ecc5520698f81ddef
Merge: 9a4f02872 743d6b7f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 15 18:23:01 2014 +0100

    stable to default

commit 743d6b7f14a58fbfd8383fe665270b75e20db018
Merge: a6e6a4d65 9f7cb18cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 15 18:22:49 2014 +0100

    Merge bug26343

commit a6e6a4d654ee13e13cf14ac113bbd317ce70185b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 15 18:22:35 2014 +0100

    Restore behaviour_info/1 on older Erlang, don't emit so many warnings.

commit 3b12cf2d9698515d627d4951ab5527260ca65731
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 15 17:14:39 2014 +0100

    Two modes for delete, one for when the server is running and we need to be quick going via the reverse route, and another when it is down and we need to clean up durable routes. Not entirely happy with the elegance of this but it gets the tests to pass.

commit 63cdf2d607221bb1422c4927ed91b448ca7f0e07
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 15 13:17:34 2014 +0100

    base64 encoding is expensive enough to make it worth precalculating the encoded pid just in case we want to reuse it.

commit 8fe8abb282208d552da7c306c41f44269ba3a8b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 14:05:10 2014 +0100

    Remove support for decorators to modify routing for the default exchange; it doesn't make a ton of sense. Also no longer describe this as an optimisation since some of it is more than that.

commit 4fd1c5c03417a5b4976f620d67fad36c12e40076
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 13:28:31 2014 +0100

    We don't need to worry about confirms, they will get sent. Change to a soft error for new errors.

commit 2a1b088e419c3bd504e3394c8dd3cc4348005741
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 12:34:00 2014 +0100

    Support cancel.

commit de45c3853174cf392cdde6f7869f0560aa8f4c66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 12:31:03 2014 +0100

    Unused var.

commit 8ccd3fa39a6983add95eee335c70e26cc5030a66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 12:25:35 2014 +0100

    Security hole--

commit 9a4f028726de5964eb01b68be51d9c49666e7844
Merge: 5af997947 28c652e6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 12:11:39 2014 +0100

    Merge bug26345

commit 28c652e6ead507502aa31ea9e2fb569be6e65a8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 12:07:37 2014 +0100

    Further simplify logging. Get rabbit_log to figure out whether the group leader switcheroo is needed, rather than leaving it up to the caller. We now have one logging API. Woot!

commit ed8517465ea51080f87b18cd54a1341835cf9fd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 14 11:14:13 2014 +0100

    Rename this thing for consistency and also RabbitMQ-specificness.

commit 5af9979478c311c6c63d3bace6f219e659aa7c85
Merge: a345670b4 7cd5c2694
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 15:59:16 2014 +0100

    Merge bug26306

commit 7cd5c26949fe9c60d5a609bb05f9244e74f618bd
Merge: 0f886f8d6 7d0eabdf1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 13:39:54 2014 +0100

    Merge bug26337 (again)

commit 0f886f8d612ba00badf418a86f5e064f509901ca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 13:39:38 2014 +0100

    Don't break rabbitmqctl remove_cluster_node --offline.

commit 830d91423e5e83675c459bc7cea1e445a6a554ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 13:16:45 2014 +0100

    Prototype of fast RPC replies.

commit 7d0eabdf17b9073740c37b0aaeffb7b205f7b70b
Merge: 9f7cb18cb 64a38ae70
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 11:17:23 2014 +0100

    stable to default

commit 9f7cb18cb4c5484ad8fba98868db000a3c9d0185
Merge: d7f01fd1f eccd7a7e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 11:17:13 2014 +0100

    Merge bug26341

commit eccd7a7e0687b38a57a3dae3ceb484edb0a05f7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 13 11:17:00 2014 +0100

    BE more assertive.

commit 64a38ae70a1529b8e2b21b73b928e0d64ff9a1cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 18:40:56 2014 +0100

    For some reason post bug 26337 we need to make sure this gets logged in the server and not though rabbitmqctl.

commit 2cb3ecf0f63c6a3acdd9cb0b86697efb231a9599
Merge: 1b24d3c53 ecc27a365
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 17:22:42 2014 +0100

    Merge bug25884

commit 1b24d3c53abbd6c3b7f8caeb2af24dfb5376bab0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:46:51 2014 +0100

    Rename

commit f7677567c089ccbc70b97af03e342c33f07ac9f3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:45:43 2014 +0100

    And max-length is implemented in terms of messages_ready, so do the same for max-bytes

commit ecc27a36510561785a8fbe80184de49e5d8660ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:44:18 2014 +0100

    Actually maybe that's clearer.

commit 97ffcc91ebac71ca0ad0124223eac7b258fabbb5
Merge: 350097fed ebda5311a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:43:29 2014 +0100

    Merge in default

commit ebda5311a2b2f6dc0f7fe0c0e9e17078f0f58ac1
Merge: 0961c2995 ef265ce71
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:42:51 2014 +0100

    Merge bug26339

commit ef265ce71c3ab49803309559c74e73c8e84ab545
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:39:33 2014 +0100

    Document the two new terms.

commit 9a80668fd58aa9ec957a8484322efdf5c1a968bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 14:26:43 2014 +0100

    Track ready and unacked bytes separately.

commit 350097fedfe6fd4778633920627ea58e126217c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 12:48:28 2014 +0100

    Max-bytes argument / policy.

commit 0961c29956231ef6cbac04454934dbf786f9ab94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 12:20:18 2014 +0100

    Reactor - extract common fail case.

commit 091f213460b56253dd2da9f5f0edbc5ac9ef6fc0
Merge: 067eb2280 fffbabebd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:26:46 2014 +0100

    Merge bug26336

commit 067eb22806e0ade239d68feac725535b87fda2c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:26:30 2014 +0100

    Improve logging when auto-clustering fails.

commit fffbabebd4a43ee11581ff2b3d3662a1330e7fe2
Merge: c43abda64 bca2e20dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:09:19 2014 +0100

    Merge bug26337

commit bca2e20dc6dad9f99d5fd21ce207c97d7614cea4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:08:52 2014 +0100

    Simplify, given the now-temporary nature of this data structure.

commit c43abda6452bbba93ab17cff04e27438611f3e1f
Merge: d7f01fd1f bbbfc715f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:03:17 2014 +0100

    stable to default

commit d7f01fd1ffd2df32ab23367f26f94f4ebd896ed5
Merge: 5e9788c19 02a6486e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:03:07 2014 +0100

    Merge bug26338

commit 5e9788c190df6c8bd528752748a67448d5efc422
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 12 11:02:54 2014 +0100

    Catch enotconn here.

commit 29083bd4951eb3ec02271a7590b420b9141a02b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 18:33:01 2014 +0100

    Don't log a silly warning if starting from scratch, tidy messages a bit.

commit bbbfc715ff0fe2f66e6f741caa79a39624e322ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 18:17:54 2014 +0100

    Explain better

commit 6b4a7af9e074dec3b813ff107ef0319baad405ee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 18:17:41 2014 +0100

    Remove a ton of special-case error_logger invocations

commit dfbd70bb3fb3e254d4d5a2efa1d5e509d0ce7874
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 18:07:08 2014 +0100

    Remove pointless gen_server.

commit 871996ae1fab78091a410afdff67931b22fba262
Merge: 2fc69463d 015ea8541
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 16:14:34 2014 +0100

    Merge bug25666

commit 015ea854138f8a1eb7b2bd16b5a5594c08207c4a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 16:12:58 2014 +0100

    Oops

commit fdade51d3cb749633fb944827f383c830d995b49
Merge: d7163f7a1 2fc69463d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 16:09:07 2014 +0100

    Merge in default

commit 2fc69463d603ee5c81a3c17981c703cc802a3dc6
Merge: e6e0d4ed7 e6892bfed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 16:05:18 2014 +0100

    Merge bug26335

commit e6e0d4ed7c2b62f0c9a85e70901b022d1e34daa9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 16:04:11 2014 +0100

    Maybe a tad clearer?

commit 7be6da64c0ed99f344f046654f104f42122dbb65
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 15:58:41 2014 +0100

    Simplify maintenance of persistent_count on ack and purge:
    
    * Don't parameterise remove_queue_entries/5 with a fold function, there's
      only one call site.
    * Get remove_queue_entries/4 / purge_betas_and_deltas/3 to update persistent
      count directly, not removed counts by store.
    * Update persistent count in one place in remove_pending_ack/2, not many
      places in ack/2.
    * Remove a couple of no-longer needed helpers.

commit d7163f7a1021d9b5154d683108a70e08af1818f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 15:34:50 2014 +0100

    Minor tweaks: reduce distance to default, fix spec, improve assertion, improve comment, cosmetic.

commit a345670b49d2f9aaaf2e862b04faaf2b9b147143
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Aug 11 18:10:57 2014 +0400

    Restore a poorly placed comment

commit e6892bfed3e71c449d05d25623a2ef595b04c4fa
Merge: 7f9413b02 02a6486e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 14:09:56 2014 +0100

    stable to default

commit 02a6486e64dd8828acaea1a06a2e6b7e05c94cf8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 13:57:24 2014 +0100

    Added tag rabbitmq_v3_3_5 for changeset 3347a7f0e689

commit c8ff546bfea20983ae5e07aa3f05655182295d99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 13:57:06 2014 +0100

    Changelogs for 3.3.5.

commit 7f9413b023a0450a868dc28cb040c14e4b576c7c
Merge: 66f5be04f 4b068304b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 12:15:58 2014 +0100

    stable to default

commit 66f5be04f134c9ea37c076215bd4206d9426a71e
Merge: 26fab415b 445540e69
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 12:15:47 2014 +0100

    Merge bug26313 (again)

commit 26fab415b046e26abed1316e3b09e3ea04a087ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 11 12:15:28 2014 +0100

    ...and inline that again.

commit 42c5f78282c1a824dc9309f64e43262a83ef7c9a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Aug 11 15:12:27 2014 +0400

    Use a catch-all fn head instead

commit 7d4e78ccdddd37aed98911db8bd83b373040598c
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Aug 11 15:06:39 2014 +0400

    Handle exceptions when connection_state = 'starting' the same way we do for 'tuning'

commit 4b068304b686eb772f7a1ac7b6472c2b3c854991
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 8 16:30:38 2014 +0100

    Dialyzer points out that the false branch cannot happen. In bug 26204 we removed that distinction (cancelling an already fired timer); cancel_timer now only returns 'ok'.

commit 22e22a7f46ef382dd7b02230fd2a3dfdc63447d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 8 16:11:59 2014 +0100

    Fix type error (introed in 24926 I think) spotted by Dialyzer.

commit eb84f806f9af86a5e3d627d3189180952eeed6a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 8 16:11:12 2014 +0100

    Sigh. The type of the 4th argument to application:set_env/4 has changed in Erlang 17 from being non_neg_integer() | 'infinity' to a proplist of options. And earlier versions of Erlang do not appreciate a proplist here! So just stop using it (yes, 5s timeout, but we have lots of calls to set_env/3 in the tests already and they do not seem to fail).

commit 9501865ebdea6a57886526fde8e8843ce0225046
Merge: 386da8d9b 445540e69
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 8 15:43:48 2014 +0100

    stable to default

commit 445540e69f777821115f9df000a60ba72187f40b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 8 15:43:34 2014 +0100

    Fix typo spotted by Edwin Fine.
    
    Since hitting this line would cause a crash in the caller, and since this code is used very heavily (e.g. in the gen_server2 prioritised mailbox) and since it's been like that for over a year, I can only conclude that this code is unreachable. That conclusion is backed up by trying to get a pqueue() into a state which would hit that head - I was not able to. Still, it should be fixed...

commit 386da8d9bee30b27c528cd920565b1bd35f1415e
Merge: fca7c2fce fd99a8c55
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 15:20:35 2014 +0100

    Merge bug26326

commit fca7c2fce7cf89fb4f91de93a16d8560b08fd10a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 15:03:13 2014 +0100

    A case missed in bug 26204.

commit 70ee028505653239cca920a073ccfb2d0b599fac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 14:46:40 2014 +0100

    Add some docs for the message_bytes family.

commit 32fffd7729dc1f250bc9b34d66b2074c35886102
Merge: fd99a8c55 843b6219a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 14:38:21 2014 +0100

    Merge in default

commit fd99a8c5554e235255c4820f474ecc6c5f2812eb
Merge: 4739729fa c3c03a325
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 10:40:01 2014 +0100

    stable to default

commit c3c03a325ba293c875b500da3109def28454e7d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 7 10:39:51 2014 +0100

    Tweak timings, shorten name, explain heuristics, specify which process info items we want (especially to add 'monitors' and remove 'messages').

commit 4739729fad46ed86aa3d6a89950f028655df0276
Merge: c1c211534 2d38695f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 17:19:59 2014 +0100

    stable to default

commit c1c21153450e676d2dfb7720d07838eb8d117dd6
Merge: 140c28ab6 ed4839d90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 17:19:46 2014 +0100

    Merge bug 26322

commit ed4839d90ddb987e8aab63cd2742ec37cb273673
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 17:19:34 2014 +0100

    Add loopback_users (somewhat late...)

commit 2d38695f77b8d0682c9762a5533c8ed40426b4cc
Merge: 140c28ab6 e65f8c910
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 12:50:57 2014 +0100

    stable to default

commit 140c28ab664aa054d9078bf91870224b0350845a
Merge: 2e0ca6cc2 41ea8dbb8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 12:50:45 2014 +0100

    Merge bug26301

commit 41ea8dbb843e8780156c0cd5dc8c686371d385d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 6 11:23:14 2014 +0100

    Fix typos, remove examples from 3.3.5 case (I'm sure that file will get duplicated...)

commit 843b6219a106f78fec1963d12113109a9e07647d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 5 17:37:03 2014 +0100

    Upgrades to the queue index and recovery terms format.

commit 0c1330a27c78f9e888b96ed723c564a25bc9a15e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 5 16:37:00 2014 +0100

    Fix tests, cosmetic.

commit e65f8c9102abfd8a0b8229fa408c5d32476eb8c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 5 13:42:38 2014 +0100

    Bug 26307 should really have documented these...

commit f28fdd8180407494ca177c16bfe9d7885d9985ed
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Aug 3 08:44:52 2014 +0400

    Simply refer to the type spec

commit c7a8a35b5c00d74ed8c2972a0dcc40ec124e1333
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Aug 3 08:42:27 2014 +0400

    Replace outdated comment

commit 8565cc098098dc33dddeaa22098343dfe3d92511
Merge: 5c45fed93 2e0ca6cc2
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 12:22:22 2014 +0400

    merge stable into default

commit 2e0ca6cc280b6a660d2de0a1a3da927da88ba5d3
Merge: acccf9bf9 95c9cd577
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 12:03:15 2014 +0400

    merge bug26313 into stable (again)

commit 95c9cd57756aadc9dbbbeef8f6312f338ed7cf8e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 11:55:09 2014 +0400

    Let exception handler do all the handshake failure logging

commit 5c45fed93c5f56dc1d48d59c8210127ca0723bdd
Merge: ee238be37 acccf9bf9
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 11:42:34 2014 +0400

    merge stable into default

commit acccf9bf90fae52d7a3936f11caa360ce6f1c7c0
Merge: b6cf9ae52 3af6703c3
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 11:41:49 2014 +0400

    merge heads

commit 3af6703c3cbdb80e85600aac7072ecebffcf3822
Merge: a3022d616 a95edc85d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 11:37:30 2014 +0400

    merge bug26313 into stable

commit a95edc85dd84c3b0d86c78268c764e2d0b44f4a1
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 10:59:21 2014 +0400

    Explicitly log handshake errors

commit e974144d83ba8845c0cc34c768d63c9131b766a2
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Aug 1 10:41:16 2014 +0400

    Enforce server-side value when client provided one is 0
    
    Keeps bogus clients such as node-amqp from ignoring the channel_max
    limit.

commit f62580c5a0284375a8a65e6129f460aaf061eef2
Author: Blair Hester <bhester@gopivotal.com>
Date:   Wed Jul 30 19:27:40 2014 -0700

    Try again, with Debian changelog comment files

commit 01b004d3e443657e6ac4079bb574283dd2a57179
Author: Blair Hester <bhester@gopivotal.com>
Date:   Wed Jul 30 19:08:47 2014 -0700

    Add dir for Debian changelog comments, comment file for 3.3.5, and template file

commit ee238be375ac8d4b892a25becd18c5e6d610aab6
Merge: 682619116 3eeafd5d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 16:13:23 2014 +0100

    Merge bug26307

commit 3eeafd5d6e65a8bfe821ca3ef7168ebc19ed5ff1
Merge: b6cf9ae52 f6bd7e745
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:51:28 2014 +0100

    stable to default

commit b6cf9ae52c07a8af3128c2c2e1ce34bb68abf53f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:51:15 2014 +0100

    Actually, let's rename that. Yes, a plural, but one that makes more sense.

commit f6bd7e7457bcfb9081e62072783720eca327fe9f
Merge: 5aeb17386 fa4d0482f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:41:13 2014 +0100

    stable to default

commit fa4d0482f44df4bd8b86f1cf2cad9364b2d63814
Merge: a3022d616 21a7355f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:41:01 2014 +0100

    Merge bug26311

commit 21a7355f0ab01704aeb0fedc51d740e8fed8e606
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:33:30 2014 +0100

    Try again, adding a module this time. Find stuck processes with heuristics.

commit 8df5c91b90c326030ec5f4beb68cc53e926e6c9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 30 12:31:17 2014 +0100

    Find stuck processes with heuristics.

commit dc4155f2f35ea960c16501f897d638a9408346a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 17:16:16 2014 +0100

    Rethink how we do this. Previously we tried to manage bytes exactly the same as len, and ram_msg_bytes the same as ram_msg_count. The trouble is that means they only account for ready messages. It would be a bit of overkill to start tracking bytes used for unacked messages separately, so instead we now only track bytes for all messages.

commit a54486750f93b512024c51c81c5a962243a01c8f
Merge: 0d8fec06e 682619116
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 16:30:50 2014 +0100

    Merge in bug26307

commit 68261911619de7ef9d11f079cafab746b6bc1cd3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 16:30:24 2014 +0100

    Make sure the tests pass again!

commit 0d8fec06eaaa60b892f068285d16637ab6bba831
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 13:32:00 2014 +0100

    Also...

commit fc10dc703bf082b29ef59aea9a6d95116d44a933
Merge: a381af1b6 7ac673e39
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 13:26:43 2014 +0100

    Merge in bug26307 and update.

commit 7ac673e39c549c543160a9197136ccde33995eb5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 13:09:02 2014 +0100

    Make some of the more interesting bits of the VQ backing_queue_status an official part of the BQ API.

commit 5aeb17386a1199013cd20c21ab584812658061d4
Merge: a3022d616 28010a818
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 11:02:51 2014 +0100

    stable to default

commit a3022d616cf878c81b8dc0694f0fc66971186dad
Merge: 3c7edeb45 0e32feb1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 29 11:02:41 2014 +0100

    Merge bug26159

commit 3c7edeb459cb853d6461ca62af0ec43bd8d2e22d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jul 29 10:56:10 2014 +0400

    Cosmetics

commit 7132caf0fc799891c956b11acf0a346620dd4821
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jul 29 10:54:50 2014 +0400

    This code will naturally be called just once, eliminate the guard

commit 28010a818a8f7b7a4f05daaa7cb9b76c3f32017d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 19:00:04 2014 +0100

    force_boot requires no app.

commit bba4e132d5394d3e76645f8680f9ace2ead7c618
Merge: 9df18b1f7 0e32feb1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 17:01:29 2014 +0100

    stable to default

commit 0e32feb1e29996f6df3ac662483ec45781a429e3
Merge: 44ab6399a 2f0619022
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 17:01:18 2014 +0100

    Merge bug25921

commit 9df18b1f7ba7345d816a7c47df3f5e54dd98ba7b
Merge: f61f1d476 2856bc945
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 15:53:12 2014 +0100

    Merge bug26242

commit 2856bc945e742d531e3fb79025efe4c79610bf5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 15:52:43 2014 +0100

    Nicer formatting of error message.

commit 1142e5d0a3948178c37ff9118a606f864c63bc3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 15:52:21 2014 +0100

    Refactor: move ensure_app_running inside the big catch block, then we don't need to duplicate error handling.

commit a381af1b67d7bdd7c866ba727b5c648966c649d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 14:00:47 2014 +0100

    Oops!

commit eb02041e5602d4c09a151827c7a80e3535ea0938
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 14:00:39 2014 +0100

    The expectation is we will only return details for persistent messages here.

commit 97b7295000ce77bfd70c443323976b4b979aec7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 28 14:00:06 2014 +0100

    Update VQ unit tests.

commit 8c1088a4be2fb28a6b681a3972e47223efea4712
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jul 28 09:03:01 2014 +0400

    Don't report nodedown issues as rabbit app not running

commit 2f06190227bf3a7444f511eb8ff1f551b6da88d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 17:32:52 2014 +0100

    Explain

commit 558afe32703aa49fe59dd1cb8adf38376ff8eab8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 25 19:15:51 2014 +0400

    Catch errors in vm_memory_monitor:get_total_memory/0 and return 'unknown'

commit 00f7c16f36348107fc050d1ecb236e22d34f1014
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 14:43:47 2014 +0100

    Don't allow rabbit_misc:is_process_alive/1 to hang indefinitely if a node is incommunicado; we use this in rabbit_amqqueue:on_node_down/1 in a loop!

commit 5448b62f585533538c19db312942e8e0151e0893
Merge: 44ab6399a 07be80d89
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 14:38:53 2014 +0100

    Merge in stable

commit f61f1d476637c087a81509cd2c5bdf1ecfc59ba6
Merge: 44ab6399a 60a9a26dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 11:38:24 2014 +0100

    stable to default

commit 44ab6399adee599db992c3d9ab679fce3fb6a0fc
Merge: c93350253 d273b83fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 11:38:10 2014 +0100

    Merge bug26290

commit d273b83fdd17591d57658cb7868cb077c3dee3ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 25 11:37:52 2014 +0100

    Inline

commit 60a9a26dc410239b005e5139a7fd3db87d49bb51
Merge: c93350253 b14084f50
Author: Blair Hester <bhester@gopivotal.com>
Date:   Thu Jul 24 20:46:25 2014 -0700

    Stable to default

commit c93350253ae10bccde39903a0f29493990fd7475
Author: Blair Hester <bhester@gopivotal.com>
Date:   Thu Jul 24 20:45:10 2014 -0700

    Uploaders field change in debian/control to announce Debian Maintainer change from Emile to Blair

commit 7c2c47a254ee61df5f30f9e82d43fd016de75309
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 25 02:52:58 2014 +0400

    Make vm_memory_monitor:parse_line_linux/1 parse lines w/o colons
    
    Happens with some broken kernel modules.

commit cc2e5e9dfc931db82c79b813891595580db592e8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 25 02:50:47 2014 +0400

    Tests for vm_memory_monitor:parse_line_linux/1

commit 0ff5c08ce301338aec482909b662c924a30b2d10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 23 16:20:17 2014 +0100

    First pass at queue-size-in-bytes. Only lightly tested, and with no upgrade step for QI. But I wanted to commit something...

commit b14084f50457f042dba3629dcdbbbcba1c0d4daa
Merge: 03044fffd ed70ca941
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 22 14:37:45 2014 +0100

    stable to default

commit 03044fffd316333c40885e6ee1da67f3976c43be
Merge: 460223224 13cec157b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 22 14:37:31 2014 +0100

    Merge bug26293

commit 13cec157bdf77ed373795187d3df2349d823e4b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 22 13:45:01 2014 +0100

    Actually, hold on to confirms when pausing. It's not inconceivable that we might get a false positive from pause_minority_guard, in which case we don't want to throw data away.

commit 5d339c4f90d0472c083f99ce867cc4f05aa20f77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 22 13:34:31 2014 +0100

    Check for pause minority mode being about to cause a shutdown before sending confirms. In this way we can get rid of the effort to kill all network connections ASAP.

commit ed70ca941d9a81364333b89839356cada29d89a6
Merge: 73fbabd55 076abd829
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 21 10:50:45 2014 +0100

    Merge bug26295

commit 076abd8299009c84a280c088eb2923696d426d5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 21 10:50:18 2014 +0100

    Fix await_startup/1. Change its design from "figure out what apps we should be running and wait for them" to "wait for the boot marker to go away".

commit 73fbabd55d0775a229396ce53623a00746df38ef
Merge: 460223224 556f66fa8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 16 11:50:05 2014 +0100

    stable to default

commit 4602232242d25a53b5cdca344f95f47e9896ba67
Merge: fec7d6219 920e2c27e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 16 11:49:47 2014 +0100

    Merge bug26292

commit fec7d62195553db9c3037e665f4a1427aca0b582
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 16 11:39:07 2014 +0100

    Further documentation of this approach.

commit 556f66fa81fe06bf0fddf3e471b536e1c68deb43
Merge: cd7e12c7f be4e13e6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 15 11:57:49 2014 +0100

    Merge bug26286

commit be4e13e6e3e9f7b6f4cfe4efaa998ddf1be516cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 15 11:57:30 2014 +0100

    Don't expect GMs which have not yet joined to take part in messaging.

commit 76f7d781db623d121096adaf57d4fd0af3929b0f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 15 11:57:08 2014 +0100

    Unused.

commit cd7e12c7fa2d8aed6e84f6ddc9cde47584339a05
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 15 10:32:46 2014 +0100

    Improve self-documentingness.

commit 3f5f753966162d819aefc9a5e065ba9c5d58f7b8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 14 18:08:44 2014 +0100

    Revert bug26171, and ignore messages before the initial catchup.

commit 5090d6984085aa3e893b634512996103780b878c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 14 17:23:53 2014 +0100

    It's probably a good idea to reset "restarts" after we get the message, not when we send it; we don't want to jump back into restarting things as normal just because we have scheduled a restart.

commit c991045c5e01a1d921b1a2ddfe3f1c5f637125ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 14 16:54:10 2014 +0100

    Reset restarts before we go round again, otherwise if MaxT is large we will keep looping until it clears.

commit 98d6ac5ffd2af9784164eae6aa51ff95ebc18781
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 11 14:18:47 2014 +0100

    Oops, silence.

commit 0238f84deba57fe7b00175a4ecdb8eff6eabb685
Merge: 00817a982 67ff462c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 10 14:51:35 2014 +0100

    Merge bug26192

commit 67ff462c80d97792c7236fc021695585699a93a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 7 13:50:52 2014 +0100

    Start a dummy node first to ensure epmd is running.

commit 00817a9821b737f417d23df8f6d3d5679163240a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 4 16:15:00 2014 +0100

    Resurrect default

commit 2547743c5806c8679ed54fe72e71b00d4210aebf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 4 14:48:43 2014 +0100

    Remove these that were merged by accident; we do distribution by hand now.

commit 7faa8b43e9fdbeedbfef8172ae5d96da3d8ab4c9
Merge: a1e58bf7f a6cd1ef25
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 4 14:07:14 2014 +0100

    Merge in default

commit a1e58bf7f480218c0dc8c8812a58028b19069652
Merge: 4ee7a251d 4b22985c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 4 14:02:54 2014 +0100

    Merge bug26256

commit 4ee7a251dd823114ae62905eacc045c36e276179
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 16:19:17 2014 +0100

    Oops

commit a6cd1ef25ba833c1a77acdf525773b9c8991facd
Merge: 20c436197 109b9628f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 15:58:13 2014 +0100

    Merge in bug 26256

commit 109b9628f404a00139d4fb19d47dea7f268d3151
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 15:32:15 2014 +0100

    Only force load if the app is actually down.

commit 808473257bb974f394e8b940d3ae9859f892fe76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 14:59:08 2014 +0100

    Tweak text.

commit c2e262c6d17d4f649c2590022fe387fbf622abd1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 12:45:04 2014 +0100

    Add docs.

commit 46bbaddccee1c4d968dec854d9af9b59267cd11c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 3 12:08:05 2014 +0100

    Port script Mnesia dir changes from bug26192. Add rabbitmqctl force_boot.

commit 0e0a03bb71f43ba7e08527c794b3c98e34c6e8d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 1 13:07:29 2014 +0100

    Cosmetic.

commit d4e20adbf53e7fb86fc0f6a9ddca52792a96fa78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 1 12:56:56 2014 +0100

    Reduce distance to default.

commit ca8807ce9dbc9a01607cfdfdb9d5c5a434f37551
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jul 1 10:32:11 2014 +0400

    Use rabbit:is_running/1

commit 4b22985c11dab92f396dde4891718be2f2d2daaa
Merge: 1ae4b5e74 bbdb05f80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 17:48:07 2014 +0100

    Merge bug26193

commit 1ae4b5e74b01e27d7ac6feecdaed54af8b69438a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 16:26:40 2014 +0100

    Export something new

commit bbdb05f809ba9af2890795e68b7bf69333685d0e
Merge: 249efaf39 5b4152707
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 15:24:52 2014 +0100

    Merge bug26171

commit 5b4152707c71281fbb89c993d2ec244b3955b173
Merge: 55389296d 920e2c27e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 14:25:14 2014 +0100

    stable to default

commit 920e2c27e53984e8af880f69dc6737974c9e875a
Merge: 96682191f 2441ab6f3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 14:25:01 2014 +0100

    Merge bug26272

commit 2441ab6f33e5cb7ef433555e61e56f8c715d4a1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 30 12:09:03 2014 +0100

    Emit an event when we modify a global parameter.

commit bc1ddef59d631a754a9b995623f9b685abe0ec29
Merge: 89c0e213f 9ddb90eed
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 29 22:16:09 2014 +0400

    merge heads

commit 89c0e213f669e9d22777195d516df92a25bb1897
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 29 22:12:44 2014 +0400

    Use rabbit:is_running/1 here

commit e42ae4941cd8f60ec9dfbd59265763899a0b4d58
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 29 22:09:58 2014 +0400

    Use a list of commands that do not require rabbit app to be running

commit 20c4361971594d93787de2a653cf1c9f0a8fe119
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 17:40:12 2014 +0100

    Update rabbitmqctl.bat in the same way as rabbitmqctl - set mnesia dir and basic sasl log, don't set sname.

commit 249efaf39abb97e183483d057ec54ba14069d05b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 16:32:16 2014 +0100

    Remove some unreachable code - members_state will be filled once we have joined, and now we join immediately at startup.

commit fabe615f03ce12cdfa7ddf1a8ed0a5eb1c23ce32
Merge: 32d6e5501 96682191f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 16:19:50 2014 +0100

    Merge in stable

commit 55389296d79610ad8c362133e9b3a59112823c24
Merge: c5698ab71 96682191f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 16:12:52 2014 +0100

    stable to default

commit 96682191f028615959994aca91b2d0dd73591b95
Merge: 317d2fdf3 df91fb3f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 16:12:43 2014 +0100

    Merge bug26225

commit df91fb3f036e84995a943251e61e7e3c712d850e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 14:49:09 2014 +0100

    Separate out responsibilities in the various node state detection functions. Only ping_all/0 is allowed to establish new tcp connections (and thus take significant time for them to time out if necessary). This removes a significant delay while waiting for pause_minority to start.

commit c5698ab71444741254c97340770e067ec66ca48a
Merge: 937b1ae85 4920458b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 13:38:58 2014 +0100

    Merge bug26255

commit 4920458b5c1a60aef27b2278b0850193d9a23407
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 27 13:37:16 2014 +0100

    More descriptive name.

commit 9ddb90eedc59b91fc805711820a27e1414355ec3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 26 17:58:14 2014 +0100

    It's easier to specify the commands that do not require the app than those that do. Also reduce name verbosity and remove a stray call from action/eval.

commit 937b1ae85933558bbbca1fc7a05f3ff674e07f70
Merge: c23c95839 5b09b3ad3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 26 16:22:21 2014 +0100

    Merge bug24929

commit 32d6e55012f7db98b7a40ee06e943e063ddd49c7
Merge: e255e8c51 5b09b3ad3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 26 15:17:37 2014 +0100

    Merge bug24929

commit 5b09b3ad354f86ea2e3abcbcbcb2442edb3fdb6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 26 15:16:55 2014 +0100

    Control max_size, and remove some broken premature abstraction from the Makefile.

commit 9f7e6855f146750ea91e052eb95ba583d5d1b912
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 26 15:05:32 2014 +0100

    Simplify message assertions, don't use timestamps.

commit 400c1a9a5e269bbe03510517242ff1a46315bece
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 21:07:01 2014 +0400

    Refactor

commit 460e1170515031fd3af7dc473ec57dd3843648fe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 25 18:03:51 2014 +0100

    Minor cleanup.

commit bf3f04322d1b849d09f6c2f91570750980ed0678
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 25 17:08:12 2014 +0100

    Hard-kill all connections and stop all listeners as soon as we decide we are in a minority. Also remve an export from rabbit_networking that was unused (probably dated from era of unsupervised plugins).

commit c8a057d6be1cb8a39f3d12cb8386747db2d9dd17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 25 15:24:44 2014 +0100

    Documentation.

commit 221491507fb104df718794b4e28b993ebf12412e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 25 15:14:06 2014 +0100

    Small tidy-ups

commit 831e65295113a5e38b45d75612affde866914d60
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 25 13:59:48 2014 +0100

    Make "rabbitmqctl forget_cluster_node --offline" impersonate the node rather than require you start one in the background.

commit bbd58779e635e47f5d297e2f3f71d00554cb1c0e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 16:34:49 2014 +0400

    os:timestamp/1 return parts can be 0

commit b571fb4c85e610341147190fa6d32faf8fbf024f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 16:30:22 2014 +0400

    Add spec for rabbit_misc:timestamp/1

commit e073590b78cb96cffdba1ccd2aada3a98552ac5a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 16:02:32 2014 +0400

    Move timestamp formatting fn to rabbit_misc

commit ce96592fb98a7967d01efb6e9b5963a9ac0da621
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 11:54:52 2014 +0400

    Exit early if rabbit app is not running on target node (but not for all commands)
    
    Some commands can be (or should be) used when the rabbit app is stopped,
    e.g. stop_app or reset.

commit b790c84072312707cfe8f3d46c607faf11570b5d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 11:02:19 2014 +0400

    Wording

commit 3b2792fc200f5410c8dd847d72df533819d5d5c8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 10:47:13 2014 +0400

    Convert connected_at to timestamp when bound since it is immutable

commit 4e7c21cd1ebea5ed30b650e4a843e875dc1ab586
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 09:30:37 2014 +0400

    Timestamp cannot be unknown

commit 78718897fc8a314e4868ea60966e682637389219
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 09:30:02 2014 +0400

    connected_at is a timestamp now

commit 15711b97524e5f405547850a4b3aedfa14325f41
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 25 09:29:03 2014 +0400

    print/2 is no longer used

commit c23c9583976ef7d1408f776e284ea083e3c75d1d
Merge: 3125b4f25 9099f9d24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 16:46:58 2014 +0100

    Merge bug26169

commit 3125b4f25cb1f64ec9d27e3a910abcba31957100
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 16:38:38 2014 +0100

    These are binaries

commit 9099f9d241e3dfbe3ea5e0257881434e80553aa2
Merge: 33ba62ae1 7ce5d5d43
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 16:19:01 2014 +0100

    Merge bug26148

commit 33ba62ae1578b79e47a59136580743f34d665080
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 16:17:30 2014 +0100

    Cosmetic: unwrap several lines. Remove some more binary_to_list/1.

commit 7ce5d5d4387ea49cd51c355bdd1f0ba5f4f88972
Merge: 317d2fdf3 4538d0939
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 14:02:20 2014 +0100

    stable to default

commit 317d2fdf3858dc9fd838d9b913faf253c47e58bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 13:43:33 2014 +0100

    Added tag rabbitmq_v3_3_4 for changeset 8e9bc23a55ea

commit 0286d688c2facc308d3165c6a1cbf2a68de11b5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 24 13:43:09 2014 +0100

    Changelog for 3.3.4.

commit e255e8c51c2d0a111c81714d7d845bb4a5c3a3eb
Merge: 93f42fbe1 02d64e655
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 19:54:14 2014 +0100

    Merge bug24929.

commit 93f42fbe153e37851c5cd4014e1d752734a4317d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 19:53:42 2014 +0100

    Add instrumenting for monitors and Mnesia transactions. It actually all seems to work now.

commit 4538d0939a9db5ad7a222b56530d2df5591cd674
Merge: 5c1c20e4e 531ccb0d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 16:55:19 2014 +0100

    stable to default

commit 5c1c20e4ee3289ecb7948aacac262ca6d2b8c43d
Merge: 51080c0d3 461affc1b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 16:55:05 2014 +0100

    Merge bug 26258

commit 51080c0d3e881bc8597e4966d28501447bd3f355
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 16:54:49 2014 +0100

    More explanation.

commit 531ccb0d732f25ad2adae7c3597ca4f4f50c23bc
Merge: 257422409 1001a4d7c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 15:42:18 2014 +0100

    Merge bug25848 again.

commit 257422409566786303f11cf877d53e1e879476b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 15:42:01 2014 +0100

    application:get_env/3 is not available in R13B03.

commit 28cfe22305371f4355cd88c6d930e236bf4b06e2
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 18:41:59 2014 +0400

    Don't use -e for a portion of rabbitmq-env that uses readlink
    
    readlink exists with an error when its argument is not a symlink.

commit 33c535229a276b83f3615b54f7d008e41144eee0
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 17:20:07 2014 +0400

    Remove connected_at from the default list_connections key list

commit b6b12bc0157371e6fa86f6718d0dbb818b419b49
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 17:15:56 2014 +0400

    Make rabbitmqctl list connected_at as a machine-readable timestamp

commit 1001a4d7c31d44b63029d38bf937861c21a7e2e5
Merge: 4381f36fd ecaecb26f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 13:58:15 2014 +0100

    Merge bug25848.

commit 4381f36fdaf0cdd5e40004aadba5026f9e986a3b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 13:55:55 2014 +0100

    Format as number, don't explicitly convert to string then format as string.

commit df0342301396f743e24a8f36c7798b68e6cc292f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 13:53:16 2014 +0100

    Cosmetic: these can all be rolled together, and be a bit terser.

commit ecaecb26f4801e70cd552797a7c034b6bf29d152
Merge: f8038e61c 9c433d6df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 13:24:05 2014 +0100

    Merge bug25279

commit 9c433d6df68c54ba678679f6b53b9adbf6af6ef6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 23 13:23:08 2014 +0100

    Whitespace

commit 26152750120f3960ebb7e72eab73655ded61aade
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 15:38:25 2014 +0400

    Improve error messages from rabbitmqctl when the rabbit app is stopped

commit 51137e3d1dc0712a46ce39f72fae2b10fe1541c0
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 10:05:44 2014 +0400

    List connected_at in rabbitmqctl usage

commit 0c81662c90b54b41af6be00b1187476518c6e076
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 09:37:16 2014 +0400

    Include connected_at into default keys displayed by `rabbitmqctl list_connections`

commit 01fad94d5084fc4320668b73ee14ad9543918138
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 23 09:36:45 2014 +0400

    Format connected_at to a human-readable date and time

commit b81be9311d37b82450746914f3b3d308d44b9019
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 15:52:59 2014 +0400

    Use proplists:get_value/3 here

commit c940f44dd1d272d94c4e6cbea912532341b28775
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 15:50:04 2014 +0400

    error_logger:warning_msg itself returns ok

commit 96fbaa577212ca23bb296b9fd21e8846deebd7e1
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 15:41:41 2014 +0400

    Accept SERVER_ADDITIONAL_ERL_ARGS from rabbitmq-env.conf

commit f27535a9a07b714b2d1417dadfe0d2ede7a3169a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 15:16:48 2014 +0400

    Wording

commit 78a7a34c7046df837e2237040258c4e169bc6691
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 14:46:47 2014 +0400

    Eliminate a compiler warning

commit de73452639b2fab6bc21cd26a54214342b62ba60
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 14:45:45 2014 +0400

    Formatting

commit a5a5239d2f8437c54b4a3c3435ea950f3b800902
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Jun 22 14:44:04 2014 +0400

    No need to convert to lists here

commit f8038e61ce1866c342efadbe00160c4db318e22d
Merge: 7bcc0a9c5 2d64c2e9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 20 13:59:05 2014 +0100

    Merge bug26254

commit db589f0f97cbab1e546132cad90db7b7f3280638
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 20 11:30:43 2014 +0100

    Cosmetic.

commit c69f3c4428484dd88646ccfe4382b0bd94cd5434
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 14:27:16 2014 +0400

    Add connected_at to the list of statistics keys

commit 1022fb2f136a35f1702d8c0b30d338d21a5d81b9
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 14:10:09 2014 +0400

    Format connected_at info item

commit dbd01a10f5bf289c175385672ba20bea05038009
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 13:30:49 2014 +0400

    Track connection timestamps

commit b566da35cab1faf00bbb227076fd71560c142b31
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 13:01:49 2014 +0400

    Warn if Nagle's algorithm is enabled by default

commit 75a5ef0a505df4a9146babfb84354636a8eb5a17
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 12:19:51 2014 +0400

    Cosmetics

commit a4bb6e9387b0a7359ae682c9446f12fd13e00d44
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 12:13:32 2014 +0400

    Make sure RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS has effect on Windows

commit 9447629717e621454ee2f8735f2772f8455390e5
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 12:00:40 2014 +0400

    Add RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS to VM arguments

commit 8b375c0f757121ccb61a3f7a76fcaeeb84920617
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 11:56:34 2014 +0400

    Formatting

commit 641368895d3f298e317a4d720d5ec0feee3527de
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 11:47:39 2014 +0400

    Don't log SMP support, async threads, etc

commit 7f588927cc42aba3e687361b91f2e46867da878d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 11:44:47 2014 +0400

    Remove single scheduler warning
    
    It's not entirely clear what the heuristics should be.

commit 6d3ff26670a8283c9fd733c4c49f7daab5dce387
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 20 02:54:07 2014 +0400

    More consistent connection formatting per suggestion from Matthias

commit 7bcc0a9c5accbe8a96772304c925384904d63b26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 17:59:47 2014 +0100

    Promote down slave to master if the master gets forgotten.

commit 2cbdbbb1b03636ca74ba172dac3fc211dc9ab076
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 16:57:15 2014 +0100

    Maintain down_slave_nodes so we might have a clue where to look to recover from.

commit 2d64c2e9ff42ac3a78b2c12396cfe23af5e24775
Merge: bc1770149 461affc1b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 14:09:42 2014 +0100

    stable to default

commit 461affc1b9a2082bf61315a04f3e24956c05b96b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 14:09:28 2014 +0100

    Oops

commit bc17701495e941d8f22e985a89d8e5884cd15c70
Merge: 1365c57ce 44223923d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 14:02:38 2014 +0100

    stable to default

commit 44223923dca97f71fae4f4836871c8ae14796f04
Merge: 4619ec0c6 5eb2935de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 14:02:22 2014 +0100

    Merge bug 26253

commit 5eb2935de9c40b2c3b369960a96eb817f2e502bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 19 14:01:11 2014 +0100

    Don't explode if we have a file with 0 or 2+ Erlang terms. Also remove TODO, actually I don't think we can do better.

commit cb140d99308dfc892899f347dea4916b1a1420fd
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 16:56:02 2014 +0400

    Include channel into trace messages

commit 26af5d38fc8e7c4b620be93230108740879bd3fd
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 16:00:48 2014 +0400

    Mention that it includes TLS connections

commit 2e4893d300fb4457827b43e2fd13185008443d1e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 15:45:13 2014 +0400

    Fix handshake_timeout docs in rabbitmq.config.example

commit d7dc1f5b8eb57cb883e0a09e194328ea7bc6a56e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 15:36:22 2014 +0400

    Re-format to 80 characters wide

commit c0ca703b243fddf4664e07ad7395368aca6edf2c
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 10:23:36 2014 +0400

    Log a warning if running with < 8 async threads

commit cf60977badf3d8d2feae9d8c127782389d82d0ce
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 10:16:52 2014 +0400

    Add SMP support to the info banner

commit f1e7b12828864e764d4f53a31053ea7a97a5549d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 10:15:48 2014 +0400

    Add async-threads to the info banner

commit bdf5a7da7de3da82d1088569f241f3b52c949d1a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 10:14:19 2014 +0400

    Log warnings if kernel poll is disabled or VM is running with just 1 scheduler

commit c69f13285074b856a9239967ad46ac376e74c843
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 10:00:44 2014 +0400

    Log # of schedulers and if kernel poll is enabled on start

commit 99ea86634445a944686323a24f86e47ed761a6f9
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 19 06:57:50 2014 +0400

    Move user and vhost closer to connection info

commit c065a1ec147c326c64548229bc9b0deecf6f4192
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 18 23:13:32 2014 +0400

    Mention connection name, user, and vhost in connection error log messages

commit 701ff629afe71ba16ea9b2f9de0e5ca2ec8f668a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 18 22:20:11 2014 +0400

    Mention connection pid in channel error messages

commit f3115189bf0bdc74d02ea99d6e2f0d0e68f4e138
Merge: 1365c57ce b4c3797f6
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 18 22:04:08 2014 +0400

    merge default into bug26148

commit 1365c57cee0fde3f3414e123f82e64766092e046
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 17:23:53 2014 +0100

    Hopefully clearer.

commit ad47331ebb7b9fde0a8cc4c69ad119ffbfe052d9
Merge: 2bbd5a7e8 fe2064370
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 17:10:44 2014 +0100

    Merge bug25446

commit fe20643701ecc350293810a0937861f92948e7e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 17:10:22 2014 +0100

    Maybe clearer.

commit dc20aebe8e0b11b07ab1d04077395c15a1795869
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 17:08:35 2014 +0100

    rabbitmq-plugins set.

commit 2bbd5a7e862e7c83471701b4dda4d639ad1d3f52
Merge: 4619ec0c6 d81bd490c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 16:05:00 2014 +0100

    stable to default

commit 4619ec0c663ff0083fa0e0039ff60cff22c4b709
Merge: d5a245805 a5e394ddf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 16:01:23 2014 +0100

    Merge bug26247

commit d81bd490cfc847dc5fafb91a5b1b7778643ef99b
Merge: eecf4c1a4 f1916ba9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 15:56:45 2014 +0100

    Merge bug26251

commit eecf4c1a4204da6fdced6827865de5e66a972830
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 15:19:47 2014 +0100

    Give sensible error messages when plugins are missing.

commit d5a2458053273ed4d5a9c5ca11db993cc4a76cf5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 18 09:58:29 2014 +0100

    Allow prelaunch to return error code 2 without failing.

commit 2ac0be969e0ce12905d6c2a4ca0cace40b18c4e0
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 18 05:04:14 2014 +0400

    Add handshake_timeout to rabbitmq.config.example

commit c8ab9c94dca40cb5dc364652a337d16c28ae7a48
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 18 05:04:01 2014 +0400

    Make [AMQP] connection timeout configurable

commit f1916ba9b4e479bbe247f2d04bdb4522446aa7aa
Merge: a5e394ddf eb696ac84
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 17 12:12:16 2014 +0100

    stable to default

commit a5e394ddfd8a0affcd96320051451300e7bf8b76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 17 11:09:02 2014 +0100

    Added tag rabbitmq_v3_3_3 for changeset 7cbb21091d12

commit fdade2dc585ecd9347eec5518e318b865574a4df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 17 11:08:46 2014 +0100

    changelogs for 3.3.3

commit eb696ac84024078f5d8137acfa63c1e0ba375f4e
Merge: a6bd73381 7546e86e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 17 10:31:26 2014 +0100

    Merge bug26221

commit 7546e86e6eedb87736a81e7014cb89eae92581a8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 17 10:31:12 2014 +0100

    Simplify.

commit 5380e7e6867bf8aa5fdb52c47f79453152b57668
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 12:35:33 2014 +0400

    Add ssl_handshake_timeout to rabbitmq.config.example

commit 43058ba723b3e075ecb18a9a736ca7ab8bb6c2a0
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 12:35:19 2014 +0400

    Add default for ssl_handshake_timeout

commit fa7a520d499c5e601ce21aa6c3079ac403c4dfbf
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 12:35:08 2014 +0400

    Fetch SSL handshake timeout from app environment

commit a6bd7338162a1a0a1c92c5f7411c1ed3dc531dc4
Merge: c312212fe e26d6c860
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 12:08:29 2014 +0400

    merge bug25678 into default (again)

commit c312212fe7e265a9d522eda11be169dd26b459e4
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 12:06:48 2014 +0400

    Oops

commit b4c3797f62ba7db688a2d2a47e8e29c9adf77997
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 11:16:03 2014 +0400

    Re-format based on feedback from Matthias

commit e26d6c860e5db05e0bfc1a73e8a605bdac841088
Merge: 8dc223446 20e68d667
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 10:41:36 2014 +0400

    merge bug25678 into default (again)

commit 20e68d667ed409f7df673136977e7f1ca4e2e1dd
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 10:41:10 2014 +0400

    Mention mnesia_table_loading_timeout in rabbitmq.config.example

commit 8dc2234465296701bbcbc1169b1030d0319727b9
Merge: ae3beeba0 737382004
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 10:32:34 2014 +0400

    merge bug25678 into default

commit ae3beeba08f11c6ea3dacfeacc96be5d3adcd6f4
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 10:23:13 2014 +0400

    Make mnesia:wait_for_tables timeout configurable

commit 9cda8cc3eac21a411f13f45f84ae00ec4608aa72
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 10:04:07 2014 +0400

    Include connection name into trace message headers

commit 4c8f870823b329332bb7b3e10386780de3e42846
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 09:35:46 2014 +0400

    backout d57075513277 (wrong branch)

commit 639b03bd7e823d90bd3c35a821593926a1ce368d
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 09:34:38 2014 +0400

    backout bd87cb0026c5 (wrong branch)

commit 1691fbaadecd52e3b0075aed2e7f70c19a37302b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 08:40:37 2014 +0400

    Include username into trace message headers

commit 35d8256700c50c456ca4072400a9e5a9f6cbc6d7
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 08:40:37 2014 +0400

    Include username into trace message headers

commit a55774c5227ffbe5f102382f1443f0f0c71c9dc6
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 08:12:13 2014 +0400

    Include vhost into trace message headers

commit 94bc8593108dc28ce1c620bbf238f54cf2227a80
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 08:12:13 2014 +0400

    Include vhost into trace message headers

commit de12430efcda4a49ccb2d5577061a2a72576bc88
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 06:25:11 2014 +0400

    Include vhost and username into channel error log messages

commit f8bc55318701eb6bc52ddca4f348d94b06312363
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jun 17 06:07:24 2014 +0400

    Log connection name instead of pid for channel errors

commit 856ee85dcfef3c34c0daea119a4a21780fa64d43
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 16 19:08:00 2014 +0400

    Cover passive = false case

commit 7373820046d4ecfe5de444e161ebfce4d20926de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 16 11:53:39 2014 +0100

    Update docs post bug 24926.

commit cb2937e873e5fc2e2c7395edc0127e659177b705
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 16 10:39:13 2014 +0400

    Don't stat() queue when it is declared with nowait = true

commit ae5d4a37cbb15d1899c7a2ceaabf24ac72aac76e
Merge: 12af6ff38 0b4a4021b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 13 12:01:52 2014 +0100

    stable to default

commit 0b4a4021b7204bfdf895cc085c6b20184e4c4df5
Merge: 6a3c0121b e7209a8cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 13 12:01:37 2014 +0100

    Merge bug26241

commit 6a3c0121bbc445fecb926e2f0fef360d924a6783
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 13 11:39:43 2014 +0100

    Ensure the limit field is always a number so we can't miss the need to interpret it. Yes, this means we won't update mem_relative if the size of the machine's physical memory changes at run time. I can live with that.

commit 12af6ff3832d650737674d5ec18362e28bd7d72f
Merge: 4168d4d9a e7209a8cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 12 14:16:32 2014 +0100

    stable to default

commit e7209a8cf272adf887233800de973240f9028936
Merge: c2ffb7b61 8d9e9c814
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 12 14:16:19 2014 +0100

    Merge bug26236 again

commit c2ffb7b615caec5e81ca133fe18582ce9f0feffc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 12 14:14:34 2014 +0100

    Since a crash in handle_event is so disasterous, and since gen_event handlers are not very supervisable, let's wrap everything in a try/catch. Prinitng to stdout is not great but we just failed to log properly - better to give some indication than none.

commit 4168d4d9a108989db40faa10980cbb025da345c7
Merge: 8d9e9c814 2ba5b91ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 17:14:21 2014 +0100

    stable to default

commit 8d9e9c814de4ad8d7fed502607723efb7e33f643
Merge: ac0a857ab 28ca0b344
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 17:14:08 2014 +0100

    Merge bug26236

commit 28ca0b3441bfe24132ef461144203291652cf984
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 15:41:35 2014 +0100

    Oops

commit b612e094804224a97ab732caf537004a65e0b6ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 15:39:25 2014 +0100

    Don't fail if asked to truncate a reference. And go to having a catch-all case.

commit 2ba5b91ea92c88fda04346ed072aa7e1e0d19bbe
Merge: ac0a857ab b113a1359
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 14:23:24 2014 +0100

    stable to default

commit ac0a857ab85ec5f640a415cddfed6f641c16621f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 14:23:11 2014 +0100

    Resurrect stable (without bug 26230)

commit b113a1359fe942ea3fd1c7392e2ef089d2f43bc7
Merge: 65e089254 89fc16916
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 13:54:26 2014 +0100

    Merge bug 24926

commit 89fc1691633540d11ebe8f7e56d02d10a85d0052
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 13:08:48 2014 +0100

    Move these down (ish) from federation.

commit 0e668a2af26824a4157cbe183b096f28385067ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 12:50:32 2014 +0100

    A few last clenaups

commit 1c0f232bf18b90d78bfc024bf9dca3432252082f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 11:22:57 2014 +0100

    Show a warning if list fails to contact a node.

commit 7c2f77516c88e6de2174db0759694caeb041c963
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 11 11:15:38 2014 +0100

    Report errors from the server (such as mismatched plugin files) correctly.

commit 39626c1edc5e73ae8e595cb73ffc98aecbb2522d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 10 17:53:31 2014 +0100

    Oops.

commit c449eae0a256326228e69207dcb72154274d4815
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 10 16:41:55 2014 +0100

    Init the stats timer again on force_event_refresh, so that if stats have become enabled we do the right thing.

commit 625f9dc7737b4b02f39c22f0e3f2739416b24a5b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 10 16:14:13 2014 +0100

    Add online flag. Get the running broker to read its own plugins file rather than tell it which plugins to run. This necessitates various bug fixes to rabbit_plugins.

commit 3e78152cf063abef4639d3502297bfc5758eae70
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 10 13:29:02 2014 +0100

    Make sure all code for both added and removed plugins is loaded when we send the notify event.

commit a92b3a42e45f848499fd3c00ede80e7249a43fca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 10 10:27:04 2014 +0100

    Tweak text one more time.

commit 85188c32ccb997b59f3b50092ef192fbc6608a1b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 18:08:16 2014 +0100

    Add (deliberately) undocumented feature to just trigger the sync without updating the config file.

commit 23b7693b359ae58db7e9b7f04b8d29e2963c6317
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 17:57:13 2014 +0100

    Tweak text a bit more.

commit 22880bea834370b13c83efe74760bceca9514401
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 17:48:30 2014 +0100

    Support updating decorators correctly when plugins start and stop.

commit a1b510bad714e565bb12b95b5952b1793b94dc46
Merge: ef2118aa9 65e089254
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 16:28:45 2014 +0100

    Merge in default

commit 65e089254f4a6fead5b6adfe425ec59690ae893d
Merge: 5d0170fe3 100cbbbfa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 15:56:51 2014 +0100

    stable to default

commit 5d0170fe32a56a802d9a3c97b5e056f65799dfb5
Merge: 2ef1660fe c34c3b4f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 15:56:38 2014 +0100

    Merge bug26230

commit 2ef1660fea393de46710e5b452e9543af0d787dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 15:37:35 2014 +0100

    Ensure rabbit_exchange funnels all updates through a single function, like rabbit_amqqueue already does. Ensure that decorators is set to 'undefined' in the durable record so any inadvertent read without setting it will cause an immediate explosion not a subtle bug. And remove report_missing_decorators(), there is no longer any sane context in which it does anything useful.

commit 100cbbbfab4267ada8f68d46adfbcc279a252624
Merge: c34c3b4f2 f034f403f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 14:35:25 2014 +0100

    stable to default

commit c34c3b4f243ac37387532f53d4a6f2dc81dce40c
Merge: 34f041ab8 0b6055add
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 14:35:13 2014 +0100

    Merge bug24759

commit 0b6055addeead36bcd3f62bbfcf754884a1a168f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 14:34:53 2014 +0100

    Ensure we don't fail if that file is missing.

commit f034f403fc743c58959e955fa493519d6794d17c
Merge: 34f041ab8 04aec1387
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:54:19 2014 +0100

    stable to default

commit 34f041ab87438baaf32e2007a55a2166cbf5c680
Merge: ef1e9b01f 96c2d78b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:54:10 2014 +0100

    Merge bug24759

commit 96c2d78b324ec90f3fc3d1f3909652d865e90755
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:53:57 2014 +0100

    Use '-e' for all shell scripts.

commit 04aec1387dd686cec8ba7e605c95d56ae4eb2362
Merge: 6929b6792 ef1e9b01f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:47:19 2014 +0100

    stable to default

commit a7f4b5a2d37048979a4601ca8d48a9726253dd2a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:47:05 2014 +0100

    Inline those since they're special purpose, and add a missed call to queue_decorator:set/1 (which won't matter until we do another policy-invalidating upgrade, but better to catch it now...)

commit 0071a21def22ecb1e368be8699f52a11bf6a6b45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:45:43 2014 +0100

    Make decorators field in exchange and queue transient, i.e. we recalcualte it on recovery in case plugins have changed. Also document a bit more clearly what the lifecycle is of the different fields in these records since that area is becoming confusing.

commit ef1e9b01f3e9c1d823ee186471135623d0c090d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 13:42:48 2014 +0100

    Fix tests for 32 bit machines.

commit 6929b6792e3b625cb2dd99e8082f61f119462b9e
Merge: a7ba63510 0fd835edb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 12:03:42 2014 +0100

    stable to default

commit 0fd835edb068935ffbc4efb61e5086decd778317
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 11:28:36 2014 +0100

    Added tag rabbitmq_v3_3_2 for changeset 9ec4d3a2498a

commit 792e739f652296c4db7c3dea8ccff27fe2d1a0d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 9 11:28:06 2014 +0100

    changelogs for 3.3.2.

commit ef2118aa90bccfaf7e29bbfe1b23f39f23f6f6f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 17:28:45 2014 +0100

    Move the code-unloading thing to rabbit_plugins, and remove the unpacked plugin after doing it, so that it actually allows us to reload modified plugins.

commit d037853e220b9845760e119709c671713f084ec1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 15:42:31 2014 +0100

    Documentation.

commit a61207d830278093bca592200c36409b5c53ea8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 14:46:18 2014 +0100

    Remove a couple of buggy changes from default, make start_apps/1 and stop_apps/1 more symmetrical in use.

commit 16c680b78c0e6f02cf7b06b37cd762216beb4327
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 14:07:03 2014 +0100

    Various bug fixes in generating command sequences.

commit 2289a712a4e2c6a69fcbcdff207a056cfe12fc4d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 12:20:32 2014 +0100

    Be more correct about dynamic vs symbolic state; this gets us back into a position where we are actually testing sending messages :-/

commit 0dcab260a496731d6d21b3883e8afe99126e4f18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 6 11:07:12 2014 +0100

    Wait until a GM has actually left before forgetting it.

commit c05bce8f3d553d30497824a7907b87fd2ce13499
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 19:14:27 2014 +0100

    Rewrite the changes to rabbit_plugins_main/enable,disable. Now we just change the plugins file exactly as we do on default, then contact the server and say "I want you to be running this". This has cut out quite a lot of code, and I am pretty sure fixed some bugs.

commit 7be51e0fd9fb32369dc62400b2abb6a3e091d54b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 17:11:54 2014 +0100

    Oops, we do need sync_notify - reinstate it.

commit 7ee15f72a6a617f78c524169b99e73aed3fbc5ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 16:31:57 2014 +0100

    Remove sync_notify, it doesn't seem to be needed.

commit 4ae397a5a1a2edb7cf7dfbde8b27bb0ff1c58818
Merge: a7ba63510 5ee048ee4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 16:17:13 2014 +0100

    Merge in default

commit a7ba635108e67d213a516ac56fe755ac95477f09
Merge: 660e907d2 f6361b51c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 11:42:18 2014 +0100

    stable to default

commit f6361b51c99f9a48180d45d9b92ffd8512f0bf8d
Merge: b159b4b77 a3b0fabed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 11:42:06 2014 +0100

    Merge bug26227

commit a3b0fabedc0f8d76b738e183549c3a20bb8cbd2c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 5 11:41:51 2014 +0100

    Don't show misleading information in the Windows service case when the service has not been reinstalled.

commit 660e907d23ec3c82415ccf08a3403803d7f4bc55
Merge: fa9cd5b14 b159b4b77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 4 12:15:19 2014 +0100

    stable to default

commit b159b4b773a86816e6bdb9256a0219b91fa62e32
Merge: 192e47d99 a856fd5e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 4 12:15:08 2014 +0100

    Merge bug26226

commit a856fd5e382c4c4637242f74d8332c5dd1ed6313
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 4 12:13:54 2014 +0100

    Don't crash if Mnesia is starting or stopping

commit fa9cd5b140727f200c4c5dd3e76c331df255d86b
Merge: 46474125f 3b30ac865
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 4 12:02:27 2014 +0100

    Merge bug25590

commit 46474125f27ac435682ca85e4d621697bcd0b2dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 17:12:01 2014 +0100

    Remove some unneeded complexity.

commit 3b30ac86592db72435340f92354c47be0d3375fa
Merge: 192e47d99 4ef1656c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 16:21:09 2014 +0100

    stable to default

commit 192e47d9926e98c01c04cd114c677444f5b2b1ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 16:20:54 2014 +0100

    Oh, the shame. Changeset 54ad947f3b9e happened after I'd been playing with Wrangler - and I accidentally committed some random refactorings. So at least we know Wrangler is correctness-preserving. Still, I feel rather stupid.

commit 4ef1656c97790151d79d5c14d1c9ee1308a6f6b7
Merge: f8521c855 300f58245
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 15:12:02 2014 +0100

    stable to default

commit f8521c855b20a1a5b96ef1038e7b375259d6d176
Merge: 0873df502 30926c249
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 15:11:50 2014 +0100

    Merge bug 26179

commit 0873df5029f09fc04101c8fea9ebd212b6109ac1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 13:51:45 2014 +0100

    Add a README file explaining this directory.

commit 300f58245bc6781c2f00e51e56b3dd3c2105eab7
Merge: ab19eab04 30926c249
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 13:15:24 2014 +0100

    stable to default

commit 30926c2493f801bc3da81acb3ad3b3492a8bb5ca
Merge: 04104dfab 7c6ef8a28
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 13:15:13 2014 +0100

    Merge bug25550

commit 7c6ef8a28712501d263f325748445f4fc63eebab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 3 12:28:38 2014 +0100

    Rebranch bug 25550 from stable

commit 34016e318d7e19aa92d07a3bf6f79e655fc0984b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 18:34:26 2014 +0100

    Oops, 3d7b7d85df74 got us into a degenerate case where our tests only ever consisted of joins.

commit 5978e68936e0106de436964e65ee2957c6be2ad6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 16:58:49 2014 +0100

    Don't expect message delivery until we have had the joined callback invoked.

commit 5272fae5383a912a72342b28d78c28f417448e0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 15:40:19 2014 +0100

    Don't explode if the pid vanishes during is_gm_process/2. Keep on handling instrumented msgs while we are waiting for things to shut down, so that... they can.

commit a50ca1da5dd78305807c3dca225f69fcc02f2c9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 14:52:02 2014 +0100

    Even better

commit 02d64e655e1838bf817fee228f3b04a7a903c32e
Merge: 503ecb21e 99be0e0d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 14:27:10 2014 +0100

    Merge in bug24929

commit 503ecb21e21c6d7769ea4e128fde553df2ab6f01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 14:22:16 2014 +0100

    Better cleanup

commit 00689f9af041a667f9404413bd520df40d84092a
Merge: d5ecd1810 04104dfab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 13:16:21 2014 +0100

    Merge in stable

commit ab19eab04038f180a69ffb0fbd69c252ab9e11b9
Merge: 38faaef4b 04104dfab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 13:12:53 2014 +0100

    stable to default

commit 04104dfab65029426bff43ead277946a51b47705
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 13:12:38 2014 +0100

    Small refactor

commit d5ecd1810c1eec0b70cd9d2915b3e0c87efc2e75
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 13:01:58 2014 +0100

    Do "randomness" properly, trap exits.

commit 1be9ca92828ef68581a999a563832e49cde84afc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 12:45:17 2014 +0100

    Oops.

commit 38faaef4bed2c38e76115923e3d83e653ee8f722
Merge: 398680a13 4f16ade1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 12:20:11 2014 +0100

    stable to default

commit 4f16ade1e73e8cbb940a9d2f949ad213761e3e15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 12:19:57 2014 +0100

    Silence warning

commit 5bdfcd5b2069e4ef9a9c6eb0fc2c6ddf5ab45d17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 12:19:08 2014 +0100

    Don't be so intrusive into gm.erl.

commit 398680a13aaa5f16c158a3bc071f13eb12f6781a
Merge: 48f534edd 7a3ffda8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 10:59:50 2014 +0100

    stable to default

commit 7a3ffda8e1f4de1bc52b79c2ca48985b4c78a17f
Merge: c40e02dcf 75c7fa93f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 2 10:59:39 2014 +0100

    Merge bug26210

commit 48f534edd07a5b9229cf0962eac9b10837c5b359
Merge: 6d120926e 1c23c20d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 30 12:17:14 2014 +0100

    Merge bug26204

commit 1c23c20d7c9cead521b7c2dfb2e337e536fa768f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 30 12:12:01 2014 +0100

    I think we've determined that we don't need that check.

commit 6d120926e6020cb827704280840be464ee15484a
Merge: fb861712d 75c7fa93f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 30 11:50:23 2014 +0100

    merge stable into default

commit 75c7fa93f6499026cac7d233934dd32991f168d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 30 11:50:06 2014 +0100

    optimise

commit 1e1ea54173ddcd546b770bb12c0cd77de01fc649
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 29 16:00:37 2014 +0100

    Instrument certain calls to gs2:call/3 and gs2:cast/2, and allow PropEr to determine when they proceed. That makes things a lot more deterministic (although not fully) and lets us reproduce bug 26171 (small whoop).

commit f51c08553dda5fabb2fcb01e07dc6143d82bcbbf
Merge: c40e02dcf 61db51426
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 29 12:43:38 2014 +0100

    Merge bug26210

commit c40e02dcf6be936bc746902efe2a74006a77fea5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 29 12:13:27 2014 +0100

    Don't prioritise DOWNs from the left. Also explain why we prioritise in various ways.

commit 61db51426b622d5bff0031234f56236b5dd8bf45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 28 18:03:04 2014 +0100

    First go at some PropEr tests, which join and leave a group, and make sure messages don't get lost.

commit fb861712d07ec9d31be357f68be00a3ed08d7df7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 28 11:06:54 2014 +0100

    Display errors on failure.

commit ecdb21a6b5e02000b293b20b14dcf96ef910c410
Merge: 045bad63a b3339ca12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 13:09:45 2014 +0100

    stable to default

commit 045bad63a17da8334a8b9dd5b97cf26231a8d3c3
Merge: f04a7b82e 357f9ddc9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 13:09:33 2014 +0100

    Merge bug 26184

commit f04a7b82e41dd7217456dca5e1188b4f3c69c1f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 13:08:54 2014 +0100

    Actually, let's count in bytes rather than words-but-bytes-for-binaries.

commit b91c9906c2186128ff1fdb041965bedeb371912d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 12:45:28 2014 +0100

    By making lim/2 handle soem more limit_exceeded cases we can simplify everything else. Also only invoke tuple_size/1 once per tuple.

commit 1d4498707eac0904e660b1836f6fb552019e9f1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 12:32:39 2014 +0100

    Avoid tuple_to_list/1.

commit 826a9c08b36460927bcbec72425b00078f0ce404
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 11:56:16 2014 +0100

    More tests.

commit 30887043d2636fbefbe79768eab7459af9d291b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 11:56:04 2014 +0100

    Remove a terminal case it's not possible to hit, and make sure we wrap lim() everywhere we need it.

commit b53642848b355fde102e3d9a8a79337ec61562c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 27 10:08:46 2014 +0100

    Limit the amount of time we spend seeing how large something is.

commit 22e6405fbef7026a0e72e33ca03e4dfaed302375
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 23 17:31:35 2014 +0100

    Oops

commit 26d12f877e31f5830f09e70b95018974a50d2aaf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 23 16:21:47 2014 +0100

    Support long timers.

commit b3339ca123dd13b0725e42e508c257ca3789b8ea
Merge: b47e05e03 357f9ddc9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 22 17:58:49 2014 +0100

    stable to default

commit 357f9ddc9c8a89c5e96121c6145daf85039c67ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 22 17:58:19 2014 +0100

    Don't function_clause in terminate/1.

commit 561559eba20b8b91f5c5dce5d84fab34dcf64568
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 22 16:12:15 2014 +0100

    Don't truncate "small" things at all.

commit b47e05e03bd3c07bb4d0370a4b90c3121dfbad44
Merge: 7ab9f4b1c 7713d27e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 22 14:35:53 2014 +0100

    merge stable into default

commit 7713d27e5d00e3db79ee4c781cf147f9cb6d4036
Merge: fc6ea9db9 f51b22e32
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 22 14:35:36 2014 +0100

    merge bug26000 into stable

commit fc6ea9db92fd606206dde638e56decd07c69edec
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 22 14:29:42 2014 +0100

    pretty-print non-inet errors
    if it's not an atom it cannot possibly be an inet error

commit 7ab9f4b1caba2fa34ed505c870d08605b0a779f8
Merge: a1881d7e0 3a7b6c7a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 22 13:32:47 2014 +0100

    Merge bug26150

commit 3a7b6c7a3d32dc610c3b67f4bb26b83bea38cb38
Merge: f51b22e32 648f53aca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 19 11:48:12 2014 +0100

    stable to default

commit f51b22e32cdd59c7d4a468298bd2d1184e2dfbac
Merge: 40d461b50 37fe19d9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 19 11:47:55 2014 +0100

    Merge bug26180

commit 648f53aca6aa6de9b57ab459b8021c929c791f84
Merge: a545f4a13 b4e69fd5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 19 10:40:41 2014 +0100

    Merge bug26107

commit a545f4a13b6f19adcf1f075c482003660561e98d
Merge: 822f520ae 37fe19d9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 16 17:54:02 2014 +0100

    stable to default

commit 37fe19d9e0b0d073c074beac63faa9f961bb5c45
Merge: ffd8347b8 6ea5e2fe6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 16 17:53:50 2014 +0100

    Merge bug26178

commit ffd8347b81af66c42af7811d05a7f7cd195db1e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 16 16:04:37 2014 +0100

    Cope if report is not a list.

commit 40d461b507f0c5818f79e7892627a71327d0ad49
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 16 15:54:00 2014 +0100

    Make with_handle/{1,2} into part of the fhc API, and thus hide the extra obtain/release/transfer variants.

commit 2404a944c7c2e3b2fd1cb07da915b463a5c9198b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 16 14:53:56 2014 +0100

    Add a file variant to fhc:obtain() and friends so that rabbit_file can keep working even when we have hit the socket limit.

commit 822f520ae60b6efff7144e8b5f6c03949bbf34ce
Merge: 6ea5e2fe6 d00af4e21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 15 16:56:16 2014 +0100

    stable to default

commit 6ea5e2fe65c8823db2fee9a11ca2a006bdb39cbb
Merge: e7b826989 44e1aca07
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 15 16:56:01 2014 +0100

    Merge bug26176

commit 44e1aca07b15215dd90ec44f78007e10706e97cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 15 14:43:16 2014 +0100

    Notify about policy and parameter removal after the vhost is deleted, not during the attendant tx.

commit d00af4e21c16f83fc650fd662fd0da52439b2d70
Merge: 46c70debc e7b826989
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 13 15:13:59 2014 +0100

    stable to default

commit e7b8269891eadfde6e94def99572d2f26afc4990
Merge: 30429a73e 194b3ea47
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 13 15:13:43 2014 +0100

    Merge bug26172

commit b4e69fd5a032f8beff6b26b82e1d921ace08e6ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 13 13:58:08 2014 +0100

    Update example config

commit 99be0e0d4a0af914efdb9610b1e2172d4271fa9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 18:29:50 2014 +0100

    Abstract the initial catchup into its own function. Make sure we call check_neighbours beforehand, since that sets left and right.

commit fcb6c0de33a961df2a545d4d67c8778351e0b0bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 17:07:59 2014 +0100

    Short-circuit the initial catchup message from the left, so that we are sure we receive it before we consider ourselves joined.

commit 46c70debcbaebd19c291939e34aeb9f9480e7af1
Merge: 6b9273670 194b3ea47
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 16:36:56 2014 +0100

    stable to default

commit 194b3ea47e3c9d2c485fee583f9ac7f19710ae6c
Merge: 57bc69b68 6a456b6c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 16:36:45 2014 +0100

    Merge bug 26173

commit 6a456b6c791c65d4701f716abd9889dbf82db143
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 16:35:50 2014 +0100

    Fix broken invocation.

commit 30429a73e4ab47ed32203290d46fb2e2ce4fa4ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 13:48:04 2014 +0100

    Monitor GM when going into a receive block.

commit a1881d7e02c1b36ef449b2268fc3afab064d005c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 12:45:19 2014 +0100

    Cosmetic, and log a warning

commit 70922db8f152a15a19deb5c80eadbc4d78008edb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 12 11:03:51 2014 +0100

    Add boot step!

commit 6b927367091d058247aa4d0f4c2ec93a5cb8999d
Merge: a272278f6 e787dcfda
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 9 15:27:34 2014 +0100

    Merge bug26120

commit 335d4e7bbe641e6e1112f6b89899fade9c251b90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 9 14:56:49 2014 +0100

    Add a policy for this thing

commit a68bfc34e544ce0fb66088f5c0ad6e213dbe2528
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 9 14:56:26 2014 +0100

    Actually, slaves should always delete_and_terminate; when shutting them donw in this case we still don't trust their contents.

commit 70962d101a1421af06ce28ac262d3c82b943fdcb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 1 16:50:31 2014 +0100

    Stop the whole queue if the alternative is to fail over to an unsynced slave.

commit e787dcfdae7bc055e2ee13c70ed14b3eacba5a9e
Merge: d8dcf2be2 57bc69b68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 1 14:27:04 2014 +0100

    stable to default

commit 57bc69b6895cf0f6aca14082386e01666ceef48f
Merge: baf710fad f54b1dcd7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 1 14:26:52 2014 +0100

    Merge bug25468

commit baf710fadbc7391cc607862246c388c747dbcd46
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 1 14:01:12 2014 +0100

    That's not needed any more.

commit 3de4990d5c9fc960f87f20a58cf3578e06d40c84
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 1 13:45:13 2014 +0100

    Remove coverage workarounds.

commit a272278f6762be5a96a494b4d228d0b184466df0
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Apr 29 16:38:25 2014 +0200

    internal_error -> precondition_failed

commit c17e55f07e5e6f15c4739222084a8258c8146a8b
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Apr 29 16:29:34 2014 +0200

    updates intercept callback signature

commit d8dcf2be28a9b95809525c26ce306693a9708e87
Merge: f54b1dcd7 5bfb24f75
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 29 13:48:43 2014 +0100

    stable to default

commit f54b1dcd7761618b37a8980abfa38f028d5adc1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 29 13:40:50 2014 +0100

    Added tag rabbitmq_v3_3_1 for changeset e92ab5c9dd47

commit d26384bc698eaa788dabe68db246ce7752a5315b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 29 13:40:26 2014 +0100

    release changelogs

commit 5bfb24f75fa69940019c74b78f9b897db68be478
Merge: 3e3430b38 673d7048a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 29 11:26:48 2014 +0100

    stable to default

commit 3e3430b38775bb87e37c5be12d4e96007a76e72b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 29 11:26:36 2014 +0100

    Attempt to make diagnostics even clearer.

commit fc8065c864518fee2aae8fb8366159f4c81e2e45
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Apr 28 02:49:24 2014 +0400

    Respect RABBITMQ_NODE_ONLY env variable on Windows
    
    Originally contributed by Marek Stój:
    https://github.com/rabbitmq/rabbitmq-server/pull/34

commit 673d7048a9bb6a6e7f98b011281aef88ea112b2f
Merge: 5cd079199 fa19f516e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 25 17:08:19 2014 +0100

    stable to default

commit fa19f516e243240151c172951cfce2644d228dd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 25 17:07:55 2014 +0100

    Resurrect stable

commit c427ed18eab5e01a191f08257c9f3208277c43d1
Merge: 5e8c5b0c3 7fe75bcbb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 25 15:03:07 2014 +0100

    Merge bug26114

commit 5e8c5b0c33f85753ab2b09bfd13981d0effc7ef6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 25 15:02:51 2014 +0100

    Decrease less as we descend.

commit d242dc103060c57049caaf2157a10b86ba40800f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 24 15:38:56 2014 +0100

    Ensure we don't start treating a list as printable half way through it, or if it was originally a tuple.

commit 5cd0791997bd13008ff312b329cfc9d3a75fe126
Merge: b249628b8 7fe75bcbb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 24 13:23:27 2014 +0100

    stable to default

commit 7fe75bcbb7f49d8779fd07ce1b0999ead02c0457
Merge: af2406096 0da58fd7c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 24 13:23:17 2014 +0100

    Merge bug26125

commit b249628b8264f02d8653fb8ae3276f828222de0c
Merge: 1239f35a3 0da58fd7c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 20:22:01 2014 +0100

    merge stable into default

commit 0da58fd7cbfab33ae35ed07bc039a04c69c6329f
Merge: 0cf5ce34c a9cc4a35c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 18:37:36 2014 +0100

    merge bug26084 into stable

commit a9cc4a35ce8eb34a1715478d6911f49f393e1cbc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 18:37:13 2014 +0100

    blank members_state before maybe_erase_aliases
    thus reverting b01e5808866d
    
    We are the only member left. So our usual alias erasure condition of
    "acks = pubs" needs to go since otherwise erasure could be deferred
    indefintely, waiting for acks to arrive that never will. Blanking the
    members_state effectively sets acks = pubs for all aliases, thus
    enabling their unconditional erasure.

commit 6da64f0957d5424f8bf7277f9a693783f40c1584
Merge: f3167cc36 0cf5ce34c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 18:27:55 2014 +0100

    merge stable into bug26084

commit af240609644b7c3df17a313232d68c127e2787c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 23 14:57:50 2014 +0100

    Introduce a new function for the case of dropping a master because we synced - remove a deadlock.

commit 1239f35a390aabe72091dfd749c63251845b7d45
Merge: de6383d10 0cf5ce34c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 12:53:50 2014 +0100

    merge stable into default

commit 0cf5ce34c085a47107337b6bbb65b5f147659f95
Merge: bbf2de025 fc4904396
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 12:33:40 2014 +0100

    merge bug26119 into stable

commit fc49043962f29e1968d9697448e1cccbddb28934
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 23 11:26:57 2014 +0100

    don't erase aliases quite so eagerly on DOWN
    since that can result in completely forgetting about a member when
    there are still acks making their way around the right.

commit de6383d100e02428e3abbdd44ead89ce9bf6e013
Merge: bbf2de025 375ac259f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 22 19:09:50 2014 +0100

    merge stable into default

commit bbf2de0254c8db4236845e8a6d4e2cb651cdd88e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 22 19:09:19 2014 +0100

    maintain gm ?GROUP_TABLE abstraction
    in yet another place

commit 375ac259f413bd82bb9fd401e36225551a219777
Merge: 14542e04e fab78c5b7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 14:37:58 2014 +0100

    merge stable into default

commit fab78c5b71de4c44a52819d33da43a98217e7b9f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 14:37:33 2014 +0100

    refactor: extract gm view change handling

commit 7e06dab05bf2ef18c5c3691be52c1566a021ed6b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 13:35:51 2014 +0100

    cosmetic: consistency

commit 7feb36559aaf72e90c9f675a10c2d060fae693e6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 13:33:45 2014 +0100

    make gm record_new_member_in_group tx side effect free

commit a6ada3ac666042b98aaefc8b19c8febddab1c1d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 13:25:03 2014 +0100

    refactor: tweak and push through gm read_group abstraction

commit 9ad70e964076feeb693448889b1087228f552422
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 12:57:30 2014 +0100

    simplify: get rid of tmp var

commit aa2f796b06bb912c58c4ed1e032103bfc223255f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 12:49:43 2014 +0100

    enforce gm GROUP_TABLE abstraction
    ...by using mnesia:write/3 instead of /1
    and generally abstract mnesia reading/writing and make it dirty reads
    obvious.

commit 14542e04e78dbdb892046cb2f7134aac24ba38b7
Merge: 1b6a32995 d59cae70c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 12:18:25 2014 +0100

    merge stable into default

commit 1b6a32995b1f42b789ab5c30ba19193121eb2a02
Merge: f3167cc36 75a6526ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 12:18:10 2014 +0100

    merge bug26084 into stable

commit f3167cc36fedce6dab37e4aa443d5549afaff6f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 12:17:15 2014 +0100

    blank members_state after maybe_erase_aliases
    since the latter operates on the former

commit 3f7d850cbf6faab0f4ca4593ecc30de6c1c3742c
Merge: 75a6526ee cc5c1404c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 11:57:18 2014 +0100

    merge stable into bug26084

commit 75a6526eee44a9b1322d997154d83b0bfcdac153
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 21 11:56:22 2014 +0100

    refactor: simplify gm:internal_broadcast
    eliminate branching

commit 149932f5f1f2d5209df925bfe39c099cdeefca05
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Mon Apr 21 09:54:09 2014 +0200

    updates intercept callback type

commit 9f7effa36d1efbc58c9e0785686f17e80f08ea85
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Mon Apr 21 09:49:01 2014 +0200

    internal_error -> precondition_failed

commit d59cae70c95cb90e9d59b8ebb1d9ea2a9d474213
Merge: 51f9459b1 58c8d894e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 14:48:59 2014 +0100

    stable to default

commit 51f9459b13af014da82ab742302d6c3d798e298e
Merge: 26bbb663d 139c2ea6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 14:48:41 2014 +0100

    Merge bug26117

commit 58c8d894e39c07e6208bce298329ba682b9ca80a
Merge: 3977d87cd 26bbb663d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 13:52:59 2014 +0100

    stable to default

commit 26bbb663df965453592a377f1854d11d4f31a40b
Merge: cbdbd9f82 8028ed34e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 13:51:52 2014 +0100

    Merge bug 26123

commit 139c2ea6b09472cddc0c48e716989cc3f204f362
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 17 13:17:34 2014 +0100

    explain

commit 91930f998e2864a890246bd5dd6400df276ba163
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 17 13:01:24 2014 +0100

    go back to from members_changed/4 to /3

commit 3977d87cd6869d2d30afb9ad61683ab72a745e63
Merge: cbdbd9f82 abeae97fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 11:50:28 2014 +0100

    stable to default

commit cbdbd9f8223e0e0f3744b69c9713536e15cc64a7
Merge: 61ea15805 f4d79ac01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 11:50:16 2014 +0100

    Merge bug26127

commit 61ea158058ebd5ec6c8c507a6533a8bf8bafd00d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 17 11:24:42 2014 +0100

    Remove rabbit_amqqueue:force_event_refresh/1 synchrony

commit 8028ed34ef6f27f84ed66c2f69a2945bcea6787f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 22:43:15 2014 +0100

    monitor workers
    In a way this is a damage limitation exercise...
    
    When a worker dies while working it is not in the pool anyway, so
    noticing its death is a no-op.
    
    When a worker dies while idle, it will not return to the pool when we
    next submit work to it. But obviously the submitted work won't be
    carried out, and the submitter will get an error (unless they
    submitted the work asynchronously).
    
    All the monitoring does is reduce the likelihood of the latter
    happening. It cannot eliminate it though since the worker may die just
    as work was being submitted to it.

commit 66b47b1c017ac6e813aee6310b1dfeee57335bd9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 21:45:20 2014 +0100

    track workers by Pid instead of name

commit a6439b55f8611dec9c0c9fab4e543f206a6e0360
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 21:14:00 2014 +0100

    record workers in a set
    ...instead of a queue.
    
    That way when an idle worker is restarted (and sends an 'idle' message
    to the pool), it won't end up in the pool twice.
    
    Note that we always hand out work to the first worker in the
    ordset. That is actually more efficient than the round-robin strategy
    we had with the queue since it keeps a smaller number of workers busy
    while others can hibernate.

commit 798732aa0eed105bcc93161c36ac5fc1503d4d6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 17:36:36 2014 +0100

    always return DeadPids, so that all deaths are logged

commit e8aa4bf019e36c11b0b047484020e2a34cd10130
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 17:05:55 2014 +0100

    gm_pids is the source of truth
    We base promotion decisions on the sub-set of [QPid | SPids] that is
    referenced in gm_pids. In particular, QPid may be missing from that,
    if another slave previously noticed its death.

commit abeae97fbdb2b405cfff02488f5a5e1cb81470d8
Merge: fb6532985 f4d79ac01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 16 13:25:53 2014 +0100

    stable to default

commit f4d79ac0137ae0a8c82f8aaf275636eabd33c9d9
Merge: dd51f2253 d322055e2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 16 13:25:38 2014 +0100

    Merge bug26118

commit 5ee048ee4f108a241c3c5595564e530c4c00d14f
Merge: fb6532985 e199d1bb8
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Apr 16 12:28:03 2014 +0100

    Merge default into bug24926

commit e199d1bb85989b6868a704bcb584786994fa4251
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Apr 16 12:26:40 2014 +0100

    Better RPC diagnostics when the node is down

commit 0736e034a0cdae785aa3268db588d9586deaf93d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 07:42:52 2014 +0100

    drive remove_from_queue with DeadGMPids
    ...instead of LiveGMPids
    
    The latter may be out of date s.t. it contains fewer pids than are
    actually alive, due to new GMs having sprung into live recently. We'd
    then, incorrectly, remove the corresponding entries from the queue's
    mnesia record, causing havoc.
    
    DeadGMPids can be out of date too; it may contain fewer pids than have
    actually died, due to GMs having died more recently. That is harmless
    though since it never leads us to remove an entry that we shouldn't,
    and we will learn about any new deaths eventually.

commit d322055e28be2bfbee71e9400d2aa55752795cf3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 16 07:00:18 2014 +0100

    cosmetic-ish: add a missing ?TABLE abstraction

commit beb47817caa0f0a4a72a1588062b7b9c8a05f673
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 15 22:13:13 2014 +0100

    cosmetic: prevent trailing whitespace in log message

commit dd51f2253093ebb1c03779915145fb47a6876fe4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 17:18:53 2014 +0100

    Handle hibernation in our pre-go state.

commit fb653298540df8236f85e7b014ecf68a863041df
Merge: 7e4c23e4a e31360fc7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 15 11:13:10 2014 +0100

    merge stable into default

commit 7e4c23e4a008e78d89645723c8ebd3794298f348
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 15 11:12:56 2014 +0100

    helper for starting a background rabbit

commit e31360fc7a6d3ab6b0574246908a1a8e6bf18451
Merge: 8ab07853c ac1cc9032
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 11:11:11 2014 +0100

    stable to default

commit 8ab07853c408af4d85baaaa7e2d2264eba19668d
Merge: e2ff06ff0 1160d0658
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 11:11:01 2014 +0100

    Merge bug26115

commit ac1cc903263992633ab20920931d9b0c02d67862
Merge: e2ff06ff0 46f18b751
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 11:09:08 2014 +0100

    stable to default

commit e2ff06ff0405957c3dfee42905de295273123d49
Merge: a84c01e0f 6932c1ddd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 11:08:58 2014 +0100

    Merge bug26113

commit 6932c1ddd8fa897cbbb58648beb313d1208f3ed3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 15 11:04:37 2014 +0100

    Add a capability for it.

commit 1160d065888258946f9585b3aa40c00d3470728a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 14 23:08:39 2014 +0100

    eliminate accidental, crash-inducing assertion

commit 46f18b751a053080ec3099e382136f97a8a450ea
Merge: a84c01e0f 83046f8b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 14 15:29:43 2014 +0100

    stable to default

commit a84c01e0fabb44880dcad7ac593053e7f12e9de3
Merge: 2af72fc23 cc5c1404c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 14 15:29:18 2014 +0100

    Merge bug26084

commit cc5c1404c97c0b9d22ce91bb50a1c33572a2794f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 14 12:36:06 2014 +0100

    eliminate comment duplication

commit d9f1c1b064708d94e4bbcaea885cfcadf51c9b11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Apr 13 19:45:06 2014 +0100

    ensure propagation of master death
    Previously slaves were monitoring the master and sending a
    process_death message through gm in an attempt to get the updated gm
    state propagated (and thus members_changed callbacks getting invoked
    on slaves, which in turn trigger promotion).
    
    However, the DOWN notification for the master may well arrive and be
    processed, and the process_death message sent around the ring, before
    GM has noticed the master death, thus rendering the process_death
    broadcast ineffectual for its intended purpose.
    
    With the recent GM changes we can guarantee that at least one slave
    will be notified of the master death via GM. So we emit the
    process_death message then, and not on master DOWN (and ditch the
    master monitoring as a result). Since the new emission is triggered by
    a gm notification we know GM is aware of the master death, thus
    avoiding the aforementioned problem.

commit 56f423fcbe7c9a67a92de2a86cfdee02bb29e927
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Apr 13 19:22:01 2014 +0100

    less lazy death notifications
    When we receive a DOWN, it's possible that there are no messages from
    the dead member floating around anyway. So rather than waiting for
    some other activity to occur first, it is perfectly safe enough to
    always call maybe_erase_aliases. That way we get slightly less lazy
    death notification in this case (i.e. we can then be certain that
    either the dead member is fully removed immediately or there must
    still be messages from the dead member floating around. No other
    possibility exists).

commit 6f560a10337d8a066f460d5c044380b25bfb2473
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Apr 13 19:14:36 2014 +0100

    ensure callback_view_changed is called whenever the view may have changed
    We had missed a case here.
    
    Ditto for check_neighbours.

commit 40323d836174c45509c17d7be3b2520f6e3f2647
Merge: c445d12b2 83046f8b0
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Apr 11 15:51:15 2014 +0100

    Merge default into bug24926

commit 2af72fc2332394ffbbcf98b358cd1d8a353e791f
Merge: 7d6ec3a30 6be053f7c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 11 12:20:28 2014 +0100

    Merge bug26102

commit 7d6ec3a3032949feaf69affc2e01ecbaa289d399
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 11 11:36:15 2014 +0100

    Actually let's move the unlink/1 back, not convinced it is any clearer.

commit c445d12b23c7641d6d40fd0673db37101f2620d1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Apr 10 22:10:18 2014 +0100

    Cosmetic (consistency)

commit 72eb87f052151649ddb1924d4736cd43145b5de9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 10 17:23:56 2014 +0100

    Monitor and wait for 'DOWN' from our own GM as well as the slaves, to make sure our GM does not try to update group info after we have called forget_group/1. Also ensure we unlink from the coordinator when shutting down as well as when stopping mirroring, not strictly necessary but clearer.

commit 83046f8b0054c38f5a8d842fd270115bcc333f60
Merge: 815f55325 6be053f7c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 10 10:23:07 2014 +0100

    merge stable into default

commit 6be053f7c42f39f1d043822c3e421b6d3804fdb6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 10 10:22:47 2014 +0100

    update copyright notice year

commit 815f55325a7cd489b7c6b2742043e2352c6fefd5
Merge: e87e5662a 17af4bf6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 16:45:16 2014 +0100

    stable to default

commit e87e5662aebd6f5e1efb3c2da3c3c1da38e5e4d6
Merge: 996b36fd9 2a0f78f8a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 16:45:03 2014 +0100

    Merge bug25855

commit 2a0f78f8a3b3c24831d656c68a2eb16914b61025
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 16:44:46 2014 +0100

    More unique atom

commit 17af4bf6b439edf3177565bec85e61851ff52f95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 16:14:17 2014 +0100

    Explain

commit ab7fcbd00e0bbbf25bb0920c17c78f97054094a3
Merge: 996b36fd9 f49f95ccb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 15:13:55 2014 +0100

    stable to default

commit 996b36fd97dab845ddef31864ebf881e020fae3d
Merge: efeaf63c2 11010df4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 15:12:49 2014 +0100

    Merge bug26100

commit efeaf63c2b30cb8e11238130ff929683b5b4d833
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 14:18:11 2014 +0100

    Oops

commit 57027f571a2173d738ade566cfab899fc207fc64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 14:01:04 2014 +0100

    Delayed restart of the disk monitor.

commit 6badfa64a071d66ba28c8049bca6f8465276a278
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 13:29:16 2014 +0100

    Make sure we have complete command output if we actually can't parse it.

commit f49f95ccb3d3c42bc494095c65918224e1250a1f
Merge: 11010df4c 6332538b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 13:09:29 2014 +0100

    stable to default

commit 11010df4c155accf9823947097272e405aff3636
Merge: f9e5f0632 5edd44a40
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 13:09:19 2014 +0100

    Merge bug26103

commit f9e5f0632d5c5c2a586fbb5b7f29e7d040cf25bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 13:05:35 2014 +0100

    Maybe simpler

commit 6332538b6f65e8164c02d04f6da6fcec2a658372
Merge: 9dd8eb562 5edd44a40
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 12:03:01 2014 +0100

    stable to default

commit 5edd44a40b5bcd009aa24bdd3388a120c209b55f
Merge: c9e4bfe34 e23c5e503
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 12:02:51 2014 +0100

    Merge bug26104

commit e23c5e503047a962dbd8b797ffc167c6d74646d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 9 12:02:37 2014 +0100

    That ~s should not be there.

commit f8f665a065468201bbb42dcc5cd5143259219e34
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 8 18:08:39 2014 +0100

    Only allow cycles that contain reject.

commit 31b789c99f4d27f800ecb354147da4b07899fe67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 8 16:03:24 2014 +0100

    Oops

commit 7a8bca9e5d990aefbf89008e2413fe740533486c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 8 16:00:55 2014 +0100

    Allow parameter validation to know about the user making the change.

commit 9dd8eb562d1c338dcdcc810aad9e100c4832c830
Merge: 4b77de972 c9e4bfe34
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 8 15:07:43 2014 +0100

    stable to default

commit c9e4bfe348348dd34afb48243c80d04a31781a97
Merge: 98d272508 3d225d06d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 8 15:07:26 2014 +0100

    Merge bug 26098

commit 82e9671524a2620869807b028906a771b46bdcfe
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Apr 8 13:55:36 2014 +0100

    Fix management extension enable/disable handling
    
    When notifying about 'enabled' plugins, limit to explicitly given.
    When handling 'disabled' plugins, call the event handler(s)
    synchronously (while we still have loaded modules) prior to stopping
    and unloading any apps.

commit 4b77de97228c275ebd3e7a1a8cd9727e0a5dbd3f
Merge: 3d225d06d c56b4e6c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 4 14:57:18 2014 +0100

    stable to default

commit 3d225d06da9bc1b23ab4660a44a5a586f7c7fa4c
Merge: 930a5a622 68b21e786
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 4 14:57:06 2014 +0100

    Merge bug26096

commit 98d272508e4c9760bb66e010c8a6f8b10f0dda70
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 4 13:47:50 2014 +0100

    Bring back impersonator tag.

commit 68b21e7867aafc95dc212c44d7b28fd20e767079
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 3 11:32:50 2014 +0100

    Improve diagnostics when the node is up.

commit 930a5a62228de03ac5e2eed8fe2b895f348e768a
Merge: c56b4e6c7 b6658c324
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 16:22:27 2014 +0100

    default to stable

commit c56b4e6c733e067140ef0a917b34a40abb17d065
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 16:22:01 2014 +0100

    Changelog for 3.3.0.

commit 6a42a40bccea265162f809f95fb7b241f44cccdf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 15:17:44 2014 +0100

    Added tag rabbitmq_v3_3_0 for changeset b07baed34a12

commit b3d3f23284a7a8b8f00940b087f664318730a3a6
Merge: 7dfb660d4 527d2de59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 14:02:16 2014 +0100

    Merge heads

commit 527d2de59be18d796301b8af25ad678389e8a131
Merge: 387136a41 432207172
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 14:01:42 2014 +0100

    Merge bug26094

commit 387136a41e10142cee801dd1702816b8ee0c52d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 14:01:06 2014 +0100

    Remove some generated files so we can build twice.

commit 7dfb660d428917f9e3d390fc6d6e6919105a92c0
Merge: 86280b41b 9fabe6331
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 2 12:25:04 2014 +0100

    merge bug26093 into default

commit 86280b41b740e18c4cfba1ec8fe2adfd679d429e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 2 12:24:46 2014 +0100

    remove DM-Upload-Allowed, as per new debian policy

commit 432207172de62396541487c003d075e568147961
Merge: ae213faeb 9fabe6331
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 12:24:45 2014 +0100

    Merge bug26092

commit ae213faeba86c3ba0019dcf9e07808d6b226162f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 2 12:03:06 2014 +0100

    Updates for the new way of doing mandatory.

commit 9fabe6331af9d7111c920f5353cbcfead3aea42e
Merge: 00f4e9f32 fc53b92a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 1 14:26:05 2014 +0100

    Merge bug 25786

commit 00f4e9f32aad34348910c3ba6ce0b725acddce08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 1 13:31:19 2014 +0100

    Cosmetic

commit 57585dd37be7f79be6d1858de482049bdca17f26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 1 11:45:33 2014 +0100

    Events for login success / failure.

commit 59cfadfd108e8760d87d845754ca5190acfe279d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 31 15:25:02 2014 +0100

    Events for policies and parameters.

commit 461d726beb8250bb590fef5e9495a9f649e1903b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 31 14:44:34 2014 +0100

    Events for users and permissions.

commit fc53b92a0a00b4330366387ca61687e1e42256f9
Merge: 63dcc9f6b b795aeb8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 31 13:25:42 2014 +0100

    Merge bug26088

commit b795aeb8dd38c59cdcf225f05a9b7dbd4eb4d76d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 31 13:21:27 2014 +0100

    Explain this formula.

commit 2f7757f491c04cbc69034ed6ebf85dd88200e4c4
Merge: 150836099 fa1a89ba3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 31 10:54:21 2014 +0100

    Merge bug26082

commit 68acf42bd81a7db4d30605a4c5f99fdc48c4f9d9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 28 16:14:58 2014 +0000

    Calculate the enabled set properly and tweak the UI

commit 2065371e2ee52ef62752ffe82b4b7969e523b1fa
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 28 16:04:00 2014 +0000

    Keep online and offline plugin changes separate in plugins_main

commit b809cbf1b9c099ddb44a359a426a4411501cafff
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Mar 28 13:46:10 2014 +0000

    Ensure start_app considers plugins when using RABBITMQ_NODE_ONLY
    
    - always start all enabled plugins, regardless of startup type
    - only disable plugins that are currently running
    
    The latter incidentally fixes bug 24941.

commit 63dcc9f6be8a3a76772fd6a24fcad36e9e48266d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 19:12:04 2014 +0000

    handle amqqueue:delete errors gracefully

commit fa1a89ba3957db35b88a3c8da153fab17c59495b
Merge: 6acf7eb8f 23b224600
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 18:52:24 2014 +0000

    merge bug26087 into default

commit 23b224600f20fc391515773baedcaa97905091df
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 18:50:47 2014 +0000

    give in to dialyzer

commit a86d7a16b9a70f7835f95687c5b1eb9020e4bd77
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 18:05:35 2014 +0000

    suppress no_return warnings

commit f7ec9cbfea237dd5483f3b6789d65b07236c79d6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 17:55:26 2014 +0000

    appease dialyzer

commit e5bd3c73097d4bb130c09080929d4ee4d45ff444
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 27 17:19:06 2014 +0000

    more precise spec

commit 88d9ce922535a77ac07e6e83f03b4ef2686bca23
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 27 15:50:39 2014 +0000

    Remove pointless branches found by dialyzer.

commit 15083609978287180683934f7b3ed916bd12e74d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 27 15:47:30 2014 +0000

    Allow specification of the node to use for the queue, all else being equal.

commit 6acf7eb8f62368dd6ec248a3834925cc9d1c3ffa
Merge: 56f7693ec 8c17f027a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 13:32:14 2014 +0000

    Merge bug25989

commit 56f7693ec88fbfcf61742a60bd7fe280616be380
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 13:30:34 2014 +0000

    Put the example config file in an appropriate location in the users's data directory.

commit 8c17f027afa932f9616ac0851df88a7d0bf37377
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 13:09:20 2014 +0000

    Very important fix.

commit e3d6ddd4f649e0f259a5efa25565af7069638e8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 13:06:41 2014 +0000

    Put the example in the correct place.

commit aad44bb0666ce5ac75743e7355dfde763d7317d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 12:18:30 2014 +0000

    Remove dubious comment

commit e708a1c80da812922a77f2289ba4370ea8abdeaf
Merge: ebdad8749 8c3f12165
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 26 12:17:13 2014 +0000

    Merge bug26069

commit 76bf5a2869a908a8f128b751bfcdf0c659ebc91d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Mar 26 12:05:38 2014 +0000

    Oops - set up options/commands properly

commit 488c286b2216191697c856012dd6199a478f0660
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Mar 26 11:51:25 2014 +0000

    Crash when node is down and --offline is not given

commit ebdad87494317287f0d4bfda25f2adc46cb06454
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 16:37:12 2014 +0000

    Tweak values based on some testing.

commit 8c3f1216532b37e2b82c6838cd3ac9e915d1699d
Merge: a06dc3177 2aa5a53f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 15:14:27 2014 +0000

    Merge bug26070

commit 2aa5a53f9537b3bcbcd5dffa6c1e0479177b9f8f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 14:18:45 2014 +0000

    Monitor consuming queue regardless of whether the consumer is CCN capable, only decide whether to send the CCN on that basis.

commit cf427cb45b9035e0b0a9642e78d16ba5f90d56fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 13:42:28 2014 +0000

    Oops

commit ecc44cae3836de27288f56615e60ee2e45ce1e25
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 13:16:08 2014 +0000

    Our other consumer arg has an x- on it. Also, let's validate.

commit 2be4181c21818969df1a268f10754fd2bfcd8495
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 25 11:58:41 2014 +0000

    Swap the default value for cancel-on-ha-failover.

commit ddcff987f4d8a2dfa6d690d1081a55e0f10d41f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 17:26:40 2014 +0000

    Have a completely separate counter for content size vs structural size.

commit d2f1a2c3d22ba2de8739684b7811c5a248848a1c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 16:52:03 2014 +0000

    Fix bitstrings, export term/3.

commit bb62b9ed85c3d2026e9233555ddac2c0e5b2749b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 16:36:39 2014 +0000

    tiny tidying

commit 9fbe13b18ee33790d0b0610235b3cc26942060dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 16:30:43 2014 +0000

    More robustness in the shape of unusual events.

commit 3a3f5c9dfbe5ec7b877ac40a7fea212891d5022f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 16:25:16 2014 +0000

    Those aren't log events

commit 1110c4acc1c1dd64b99c61c3ea54c7209d38089a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 15:42:19 2014 +0000

    cosmetic

commit 7fdc39ba7375f834101378b71ba5dcda5806c881
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 15:39:39 2014 +0000

    Several more changes:
    
    * Remove the special tuple handling, it was trying to not reduce depth as we went "along" a tuple, but that goes badly in real world tests with gb_trees and gb_sets. In fact we just want to treat a tuple exactly like a list.
    * Simplify and correctify a bit by only having one termination condition for depth.
    * Add some more tests, and correct some existing ones.

commit e9a91df05bf8aa2feac91e81fe5e2535c6b14b7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 13:44:54 2014 +0000

    Something of a rewrite:
    
    * Allow choice of how much size to "eat" each time we descend
    * Fix at least one more recurse-indefinitely bug
    * Try to reduce the amount of copying we do, and use more efficient techniques
    * Add some tests

commit 926ccb4ef183b8cd3523aaf8b559dc70bdc86ab6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 12:33:00 2014 +0000

    Remove obsolete TODOs, fix a rather substantial bug.

commit 52bd01074df2f0cda87a171229b617901e2f9117
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 12:24:49 2014 +0000

    Don't let the truncate module have any opinion on how much to truncate.

commit 9a28e7a4daab049a9d360b91c74006b948d60111
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 24 12:16:37 2014 +0000

    Rename module and functions to be shorter and more generic. Remove quickcheck tests. Wire into the non-sasl error_handler, but don't wire into handle_info and handle_call functions since those should not be logs.

commit a06dc317783881e53346e8e8b8718acf655e8889
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Mar 23 12:00:41 2014 +0000

    cosmetic: easier to read and keeps emacs happy

commit 4f03611983a19490db48ce8e85ed37dfde75368b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 15:22:20 2014 +0000

    Tweak a bit more - attempt to handle bitstrings properly

commit 681b97c8bc4eb1f28c14ff533df26acc242852f2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 15:10:19 2014 +0000

    Tweak list handling

commit 0084ada496b343cd2fce7f8332acb787666d6c30
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 13:54:29 2014 +0000

    Avoid crashing as we approach Len == 0, improve test output

commit 7fd53f128b16fe9655e0a3885e9058569b7f4063
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 13:12:01 2014 +0000

    Reduce the size of the test inputs
    
    Don't hit 110% CPU (thanks for that PropEr) and get usable failures sooner.

commit 2343f2ea7c755a8fd02a9b0c2b0baa510c3d71c9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 13:09:19 2014 +0000

    Skip tests in a more operator friendly way

commit dd3173b92c039f7e2ca8c62b0d3a70b37fb0c0c5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 13:04:26 2014 +0000

    Start testing this properly

commit ccd7bc22c4bc2153ee42f71b6f229b1691a6c0d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 21 12:47:22 2014 +0000

    Add a comment, and rename the thing to correspond more with words we use already.

commit 015b6abd50031939521566e1a27569f8d9d12a6d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 21 12:26:02 2014 +0000

    Avoid binary:part/3, since it isn't available in R13

commit 87313aeca1599a580d96b880a9d2b56108a38dfa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 21 11:44:25 2014 +0000

    rabbit_amqqueue:basic_consume() will wait for recovery anyway, we don't need a special function for that.

commit e8ae6a47f5bb867950988d114b3da55fbb59c6fb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Mar 20 14:04:32 2014 +0000

    Initial stab at limiting term size during logging

commit 17ed6872d4f94ba3077f7850d58ed334c8300867
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 20 13:52:22 2014 +0000

    Attempt at error checking the basic.consume.

commit b4ce6c28f3f3f3569435953865f848d8a38ff4c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 20 13:33:53 2014 +0000

    Abstract the waiting into rabbit_amqqueue.

commit f60c79ae1b13150e449a50c5a01bafa5b8ba074f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 20 12:58:51 2014 +0000

    Rename variable (and catch a case I missed before).

commit 2103ece8fdaaa7aead5252d4f96c3fbe0c4cab75
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 20 12:48:37 2014 +0000

    Don't show diagnostics after "node already running" since diagnostics are meant to be about *not* being able to connect to a node.

commit eb51e28dd80bfd3e9dc799f2592813318a2ccbfb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 16:44:43 2014 +0000

    Tidy up the progress output slightly.

commit 7866628eedbf92a14ebdda48e3786ccf25705071
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 16:28:18 2014 +0000

    UI tweak: look more like the output of dpkg, with two separate characters to indicate desired / actual status. Also refer to a plugin as being "running" rather than "active" since "active" and "enabled" might get confused.

commit c73380465ebeefb3d1d305646d9b3feda50898c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 16:04:07 2014 +0000

    Remove -A and -I options, they are a bit too minority-interest.

commit 2c6069a2380191a18af5bc77dd26492766c6ea7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 15:56:48 2014 +0000

    Oops, complete renaming that function. Also remove some exports that seem no longer used.

commit 9df6da77c6199b5f1f9a4bc951fbdd3c2678ef61
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 15:43:12 2014 +0000

    If we refactor rabbit_misc:build_acyclic_graph so that we don't assume the arity of the functions we pass in, then it's easy to build the complete graph then filter it by application, rather than the other way round - avoiding rather a lot of work.

commit 073db28b0718b66850b0d1e823b997329f46a16b
Merge: a640f74dc c4a5d3eab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 13:52:10 2014 +0000

    Merge bug25374

commit 8fded918b57511ea8f2a03c637db01495e7dfa78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 13:03:41 2014 +0000

    Oops

commit efb74c528487925219cbf3d079bb610f8935ca77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 11:28:04 2014 +0000

    First hack at recovering consumers.

commit c4a5d3eaba2fa34a8ff71a3f36496ed82b46c16e
Merge: 3ebd4a76c bde36b523
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 11:21:33 2014 +0000

    Merge bug25722 (again)

commit bde36b5232cfc1c1d0eef87fbf10789971476262
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 19 11:21:13 2014 +0000

    Better error catching.

commit 73712a5a450c201307eafc9ebfd2d819b50ca06e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Mar 18 22:16:40 2014 +0000

    Get rid of app_utils:app_modules/1

commit 7b22230f14be9f69e9bfecea84fd99d21567c3b6
Merge: 3ebd4a76c 73999b3da
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Mar 18 20:25:11 2014 +0000

    Merge default into bug24926

commit 3ebd4a76cd498acdc287b4c9403f77ee7cc765ea
Merge: b68204baf dc8ac0e5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 16:04:25 2014 +0000

    Merge bug25722 (again again).

commit b68204bafb8a2fe4c0b16c21f814fa6331efc413
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 16:04:00 2014 +0000

    Don't explode on "rabbitmqctl stop_app ; rabbitmqctl status", and fix tests.

commit dc8ac0e5e67e31352ca8c8d5daf556728b5ac629
Merge: 85506c113 db5fe7348
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 14:59:11 2014 +0000

    Merge bug25722 (again)

commit db5fe73482c746da36915bcafcbf47ba0f146eed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 14:58:51 2014 +0000

    We want reuseaddr otherwise starting the same broker twice in quick succession can fail for no good reason here - the real distribution mechanism obviously uses something similar.

commit ac3ebb15712fa3add56c40c0b87216ad94cc203d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 14:58:00 2014 +0000

    Don't export anything ever from this script, it gets inherited by any processes started by the broker - which breaks a bunch of our tests.

commit 85506c113f88092ffd4f544a43123715f5d9212f
Merge: a20c6cd90 7a7c1a3c0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 13:43:45 2014 +0000

    Merge bug25722

commit 7a7c1a3c0757353319c17a9567a6340185905491
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 18 11:55:07 2014 +0000

    Oops, we need RABBITMQ_CONFIG_FILE to be set for prelaunch to do its job properly.

commit 73999b3dafca5a0ec27343bb22ee971a54c7a856
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Mar 17 21:09:46 2014 +0000

    English

commit 09c1d873358fe0c1cf73ac974f9f54046e24667a
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Mar 17 21:08:47 2014 +0000

    A slightly nicer (more explanatory) UI for rabbitmq-plugins

commit 833d83ab86b55d7aa3fa7f80b31145e041d825c8
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Mar 17 19:52:29 2014 +0000

    Refactor (inline a little bit more)
    
    app_utils:which_applications/0 => inlined,
    rabbit_misc:all_module_attributes{_with_app} => unified

commit a20c6cd9018645d65f7ee7009208feb4ebf8f9e0
Merge: ec1a74fc6 2f6b97a5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 17 17:37:27 2014 +0000

    Merge bug 25940

commit 2f6b97a5dfa4b20f3b12f90de7180dcac762f23d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 17 17:25:24 2014 +0000

    Update copyright for 2014

commit 4f49d35cc51548a1c1015fd2b63b1557682772b8
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Mar 17 16:03:26 2014 +0000

    Calculate enabled vs. active correctly for 'list' operations

commit ddca9baeeae77bc4d575b9bd77421ce6a270a30e
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Mar 17 15:58:47 2014 +0000

    Inline app_utils:update_running_apps/2

commit a640f74dc8d5dcd667fd9154bb323765fbf3e863
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 17 12:28:21 2014 +0000

    change AMQP codec field type 'b' interpretation
    from unsigned to signed, in compliance with the spec and most
    clients.

commit ec1a74fc6df2e451d1a332df2e2f00b1230c9867
Merge: 73671f1ba 20b3190e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 17 12:10:38 2014 +0000

    Merge bug25589

commit 73671f1baf4a3561e1998398df024ab57da34587
Merge: af094bde0 20b3190e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 17 07:03:55 2014 +0000

    merge default into bug25589

commit 56af31d64fa1d71a112cb4483b4eb5d33e4a8523
Merge: d6205e917 20b3190e5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 14 16:32:55 2014 +0000

    Merge default into bug24926

commit d6205e91720c0181a581e805969cb4e3555d192d
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Mar 14 16:24:13 2014 +0000

    Update rabbitmq-plugins usage

commit 3795341c511dc444a906d542afd1f1ae744d2052
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Mar 14 14:58:20 2014 +0000

    Improve synchronisation between plugins file and running broker
    
    Since multiple brokers (on a host) may share the enabled-plugins file,
    we may get out of sync. Diff any changes stemming from enable/disable
    operations against the plugins actively running on the broker.
    
    Extend the 'list' operation to display plugins that are [A] active
    but not explicitly (or implicitly) enabled in the file and [I], those
    that are explicitly (or implicitly) enabled but not actively running
    in the broker.

commit 20b3190e58168699efa8e644fd6fae68bd6e1abd
Merge: fb40d4bf2 0751818de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 13:02:03 2014 +0000

    Merge bug26043

commit fb40d4bf283c74c00f73aa30f4f4baad52d027b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 11:57:48 2014 +0000

    Explain

commit b5d09e956ec31db9053c69a5bac6481194a920c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 11:54:54 2014 +0000

    Fix stupidity, and rename.

commit 0751818deace20ec336a5bcf7c0d2f376896f85d
Merge: 478afcc66 4918d0ecb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 11:43:28 2014 +0000

    Merge bug26066

commit 4726590ca19591d81984f4a2b0df2aa8177b5d50
Merge: 7ba780d84 478afcc66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 11:35:30 2014 +0000

    Merge in default

commit 478afcc66ecf20ee75345fb669e0818a8e0abedd
Merge: 442cc36f9 f3de6d05e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 14 11:34:57 2014 +0000

    Merge bug26065

commit 161fd648b75a14008f2e0543eb7e7cb6e3250f54
Merge: 442cc36f9 4a743ceba
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Mar 13 22:51:57 2014 +0000

    Merge default into bug24926

commit 4a743ceba66a1190f5bcc445615e8e3f0641f080
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Mar 13 22:49:16 2014 +0000

    Refactor: Simplify boot/cleanup step handling and unify modules
    
    Isolate boot steps to a set of applications and avoid using ets to
    track which have run. This also simplifies cleanup step execution.
    
    The force_reload code isn't needed, since the real issue preventing
    updated versions of modules from being found lay in the proper
    expansion of (the correct set of) .ez archives, which was fixed in
    revision 1918e77.
    
    Unify all the boot handling code under rabbit.erl once again and now
    completely remove rabbit_boot, since it's no longer needed. Remove
    unused exports and tidy.

commit 4918d0ecb0e3c73386775c4b65a505026a747938
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 13 19:32:13 2014 +0000

    correctness++

commit fbf3d9e94290b5efc6488d1e512d0246cc461b21
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 13 19:25:59 2014 +0000

    turns out that cleaning up 'clients' in client_terminate is bad
    since it breaks clean shutdown/recovery, which relies on the CRefs in
    'clients'.

commit d84c12bce47f00cec45f10eddb78f22adea5e0d2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 13 19:14:21 2014 +0000

    invoke credit_flow:peer_down on, err, DOWN. *only*
    Thus preventing potential leaks and deadlocks.
    
    Also, clean up 'clients' in clear_client, and thus client_terminate,
    which was previously missing and thus the source of another potential
    leak.

commit af094bde07bc22885d86195d22e78d3c9e334423
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 13 18:46:02 2014 +0000

    add bump_credit to vq soak tests

commit 7ba780d84aae4dfb8b88ff997ca100512b8025fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 17:10:56 2014 +0000

    Check the config situation when installing the Windows service.

commit 8cc1b2be40b52617a36804c41c98a313f4e3c6dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 16:28:08 2014 +0000

    Update the batch file.

commit d84937fc9b103d82df3e2dd972321c6111a3c011
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 15:52:45 2014 +0000

    More robustness

commit 0f410206ae6bd47acd9f71644eb04f78d3d13b7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 15:07:48 2014 +0000

    Move dist arg to the end so that if the user has set it in RABBITMQ_SERVER_START_ARGS then we take their version not ours.

commit 04e7180928dc3bb53427436dcc058e3b62178d00
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 12:45:54 2014 +0000

    Check if dist port is available since otherwise we will create a horrific error message. Also refactor a touch.

commit 6b4696c44fcf22d119ec051ba76777e06ba02075
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 11:25:06 2014 +0000

    Cosmetic

commit 342bc891e742190d29204c6aecc1732f46aa4c35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 11:25:00 2014 +0000

    Somehow that actually worked on OS X. Oops.

commit e78640fb05b483c245773ec331cdf8491437a549
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 13 10:06:41 2014 +0000

    Try to be marginally smarter about getting the epmd port, it is set as an init argument from the environment variable.

commit f3de6d05e9eec7afffc05e469602742b219fa708
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 17:11:03 2014 +0000

    Log the config file's expected location according to the environment varible if it cannot be found.

commit 636bb978672614ad4c8546afdf742b4a50ad32c0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 16:50:17 2014 +0000

    Present epmd errors a bit better.

commit bb16142f7da91b61aed3e044837682b745382f21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 16:22:44 2014 +0000

    Display diagnostics when rabbitmqctl clustering options fail due to nodedown.

commit ddaf3e5c1353b80f7a25673eb7b7fc726239ddcb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 14:18:30 2014 +0000

    That should probably be a define, right?

commit d80d4bfd791f9aeb80d4d876b7b9fbb29d85ed60
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 14:15:57 2014 +0000

    Irritatingly I can't find a way to figure out the difference between these programmatically.

commit 3008f907568cd3441b0013b33f0366612e3c2e5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 14:10:45 2014 +0000

    Slightly cleaner than iterating through families.

commit 0502a0ba05691bcaef29633d7727f53d8c171e7d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 13:38:57 2014 +0000

    Don't suggest using the kernel params here.

commit 1a71f9e96b9ab25b8d539e0192062fb7fec487df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 13:17:26 2014 +0000

    Set the distribution port range to the first of these that matches:
    
    * Not at all if it's mentioned in the config file
    * $DIST_PORT if that's mentioned in the env file
    * $RABBITMQ_DIST_PORT if that is set
    * $RABBITMQ_NODE_PORT + 20000 if that is set
    * 25672 in all other cases

commit a86fa2c99f93e238ad5a5186ebf16f0873d82657
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 12:07:34 2014 +0000

    Just in case the error is not an atom.

commit 9e97c091e4bafddda68f40753cc1f9225e129572
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 12:03:54 2014 +0000

    Various formatting tweaks.

commit 82c33971e06d8787950ad323965d0a15f79688fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 12 11:58:33 2014 +0000

    Since we always show the raw error and the expanded error let's get format_inet_error to do that.

commit 6a97a3b818b116e3b2eceb4f45477a9e7b07d3f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 19:07:32 2014 +0000

    Try to be a bit less verbose.

commit 940b88072a7cbf37e2ba3afcde21b1853d7bb700
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 17:58:37 2014 +0000

    Improved diagnostics.

commit 155e05c87c70bcdd7a8f96cd80363a7ac7191dc8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 16:48:52 2014 +0000

    Slightly simpler, and more polite.

commit eb32f905251b50dfeefc2b720e25f8daebcbedef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 16:31:29 2014 +0000

    Add listeners to rabbitmqctl status.

commit 7df4645efca85bb3f04b5586eef37d9ea3a4579d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 16:16:35 2014 +0000

    Show the distribution port as a "protocol" in management.

commit 07be80d89e1d55fbc7e08727fbfb0069b574f9de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 14:07:40 2014 +0000

    Avoid connecting to nodes that are down.

commit 442cc36f9f76d73f5af8e5c33a223fa8648521b0
Merge: 55c2a86fd b6658c324
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 12:24:11 2014 +0000

    stable to default

commit b6658c32427ca90f0b63bcced03ea158ef412e94
Merge: e9c50cf72 155aa4ddf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 12:23:57 2014 +0000

    Merge bug 26063

commit e9c50cf72b58a61e0f5f4336e72e3862f217ad95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 11 12:23:38 2014 +0000

    Don't corrupt the node montor state even if we are about to shut down.

commit a1d7686e12f0c2d6b9eb5c8cb53a3f49fbb1c3a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 10 14:18:56 2014 +0000

    Get the leader to transition directly to winner or loser state if that's where it's going, or wait in a special lead_waiting status if neither, so that if we get any more autoheal requests we can ignore them.

commit 55c2a86fd2eda42e307e1ac741ee8bb94f92707e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 10 12:17:14 2014 +0000

    Be a tiny bit more correct

commit 9f2e87b4ed8bfce1d167fb55bb0aacd16652cff0
Merge: 8e43637d8 155aa4ddf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 10 12:16:41 2014 +0000

    stable to default

commit 155aa4ddfcebfbe7682d9fc4ad78479fc11479ae
Merge: 1b1582f83 1d495f786
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 10 12:16:04 2014 +0000

    Merge bug26058

commit 1d495f786513397a7f2ae4a93fc7c4803211c602
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 10 12:09:18 2014 +0000

    Fix memory calculations: we were erroneously removing the mgmt db from the plugins bucket (although it was never counted there) and not removing it from the 'other plugins' bucket (although it was).

commit 8e43637d877a07aeff5cd46380b8e3bb2012c93c
Merge: 5b40f9de4 9d92c442c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 7 10:55:55 2014 +0000

    Merge bug25957 (again)

commit 5b40f9de44234ee193254239a89279afee724635
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 7 10:55:33 2014 +0000

    Update API

commit 9d92c442c52d608b3721f82fbdea5fb2854018c1
Merge: da544b761 22873bc8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 6 17:19:14 2014 +0000

    Merge bug25957

commit da544b7616c65fdf29f32305124e25b2efb1ec41
Merge: 1bf14fc95 defcba9da
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 6 14:49:34 2014 +0000

    Merge bug26056

commit 1bf14fc95d24cb1502684f2c6fe7ef3074c777b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 6 14:49:15 2014 +0000

    Start the consumer utilisation average at active 100% of the time, since when we first add a first consumer it will not be blocked.

commit 22873bc8e09e73c9cd95204b09f5d554d94d9032
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 6 14:34:12 2014 +0000

    Rename info items

commit defcba9da9a168ebe775a8c85bcea2c75ab32b76
Merge: fec03ef2e 7d6d19f94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 5 14:07:30 2014 +0000

    Merge bug25603

commit 5308e763c10b31e8becef7ba7b26bd507fa404b2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Mar 5 13:49:48 2014 +0000

    We missed another change when moving code back into rabbit.erl

commit 5f53cd7b8c0b40c1da3bb31ad9acd5723b645996
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 14:35:45 2014 +0000

    Strip out support for x-prefetch.

commit 6244e717481bc2cc92ab321fab7dd1b2baa3e8cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 14:29:23 2014 +0000

    Management information on per-consumer prefetch

commit 2ac7c1b4abb4b7e27dd5289387a78d3d4dff6885
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Mar 4 14:02:59 2014 +0000

    Fix an oops in rabbit:stop/0 and apply consistent parameter names in r_plugins

commit fec03ef2e4938b5c7fbb0d8bd1c16daca090de4a
Merge: 1b1582f83 c43130f14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 13:40:10 2014 +0000

    stable to default

commit 1b1582f839c13614925158397f1e9f0562357882
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 13:36:23 2014 +0000

    Added tag rabbitmq_v3_2_4 for changeset d44905fa517a

commit 93fa34e483847e238c26f2dbc2f2d4f4fee931ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 13:36:07 2014 +0000

    Package changelogs for 3.2.4.

commit a42de7dcc49f3d34a5415d81d8e7cc0e9f74aa72
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 12:52:42 2014 +0000

    Added tag rabbitmq_v3_2_4 for changeset b93445fda35c

commit bb17a6e526b7bc179d22483e9b436b4a79e5dda4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Mar 4 12:15:35 2014 +0000

    Inline some more and get closer still to default

commit 3097000acdf5ba1fc507bbdbdb1eeb19a17edc23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 4 12:09:34 2014 +0000

    make tests work
    - 'hole' generation is sensitive to IO_BATCH_SIZE
    - need to handle credit bumps post publishing and prior to status
      checks

commit 7019d0856fabeaf04dbdb6a62ed77af4d5c91251
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 4 12:06:37 2014 +0000

    beta->delta conversion rate is naturally limited
    which means we don't need an explicit upper bound, which in turn would
    have required some interaction with q_process.

commit f0ecdaaf4876ff78fa1d99725d9de5193331c8ee
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Mar 4 11:37:56 2014 +0000

    Reduce the distance to default a bit more

commit 722b14b5002d1d22fd0dbd32ad22406987199750
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 4 11:13:00 2014 +0000

    increase IO_BATCH_SIZE
    ...so that beta->gamma conversion can keep up with alpha->beta
    conversion.
    
    Also correct comment - beta->gamma conversion can happen in a lot more
    places than 'publish'

commit 4a0a415bd3b0a7dae6e1596cb0101fbe0f80a915
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 10:53:01 2014 +0000

    Change the semantics of the basic.qos global flag to switch between per-consumer and per-channel prefetch.

commit d8a0d777bfed7eb45589a7118cb8f3573e917e18
Merge: 38b940dc5 c43130f14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 10:42:35 2014 +0000

    Merge in defaul

commit c43130f1411908cb62bb6af1f1ff79a1f5e5338f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 10:39:34 2014 +0000

    Oops

commit 38b940dc5f6088fd6ae22a39bb9f9cc3e0c310c7
Merge: 4e31d6c7f 1f6e7c720
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 4 10:27:48 2014 +0000

    Merge in default

commit 3e171fbea1586efc2558e69f1cd73dbc852acf9a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 17:01:43 2014 +0000

    reduce_memory_use now only does one thing

commit 44ba6477ce505fccb565aa6662036cc36f080e46
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 17:01:16 2014 +0000

    propagate BQ API change

commit 303eca58d45ee72467a6eebbe08ee51fbaaad029
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 16:35:45 2014 +0000

    explain (reduced) impact of IO_BATCH_SIZE

commit a0b046de111331fa8227c12fb3990a7744e60323
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 16:29:55 2014 +0000

    decouple syncing from paging

commit 8bc5daa7c408bd832f289313f6cd545de2efa310
Merge: 9bb49c602 1f6e7c720
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 15:24:20 2014 +0000

    merge in default

commit 1f6e7c72043b6734b9fe6e5ad48285b1091b9b46
Merge: a6406fd92 b86c0f50b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 15:24:01 2014 +0000

    merge bug26049 into default

commit a6406fd928d54f7751725312319ba47ad00641b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 15:07:54 2014 +0000

    clamp duration to infinity when all rates are very low
    ...so that the memory monitor excludes the queue from avg duration
    calculations, which would otherwise get massively skewed.

commit b41aa6b23290d2febfa4b13e4509f66e3de134be
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Mar 3 13:33:34 2014 +0000

    Publish plugin changes via rabbit_event

commit 9bb49c6023792b059bbc8c335f1ef7a5b21a2b82
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 3 12:50:40 2014 +0000

    limit alpha->beta conversion through msg store credit flow
    we also bump the IO_BATCH_SIZE; it's only used to limit beta->gamma
    conversion, which is a fairly cheap operation (it only touches qi,
    which has a very compact on-disk representation), and we want to make
    sure that such conversion can keep up with the alpha->beta conversion.

commit b86c0f50bc584b8e1912226af2701db672fc8c4f
Merge: e739ce919 9d9a9b690
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 28 10:45:59 2014 +0000

    Merge bug26042

commit c3e63dbe92ce947e3c0c8d63de0a38d4c3ca4cce
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Feb 28 10:02:34 2014 +0000

    Fix plugin expansion during runtime configuration changes
    
    Blowing away the plugin expand directory when we make runtime changes
    is wrong and we don't need to strip away expanded plugins when they're
    disabled, since the directory is cleaned on each restart and leaving
    the files in place isn't an issue.

commit 9d9a9b690bef3b70a3d6627df7276e9d6283209f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 27 16:54:59 2014 +0000

    Make mirrored queue logging configurable.

commit e739ce9196bf38b8e4ac765242155f7c60ff68c8
Merge: e873408bd f568aafc1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 16:58:35 2014 +0000

    Merge bug26027

commit e873408bda20f0248ff1db10d185b1c193c12e1f
Merge: be684578e f568aafc1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 16:42:44 2014 +0000

    Merge in default

commit f568aafc19c3e7fc5e7226c25e7a91df7eeef33d
Merge: b1b04a6bc 403bbedce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 16:40:43 2014 +0000

    stable to default

commit b1b04a6bc2c9848810db538c26665206506a9e8c
Merge: 949aedbf4 f47e34edf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 16:40:29 2014 +0000

    Merge bug 26038

commit 403bbedce9f9c32663cd8ff45de3df9055d8998e
Merge: 05b62c271 5f638764b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 14:31:34 2014 +0000

    Merge bug26039

commit 5f638764b15436ffa4ffb7fa458a7845c1f85719
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 14:11:29 2014 +0000

    Don't quote node atoms, it makes the resulting string harder to use in shell scripts.

commit f47e34edf544655fea45b1c6a92919437d69a3d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 11:53:49 2014 +0000

    If we abandon autoheal while in winner_waiting then let the losing nodes know they can carry on.

commit be684578e27d0a9dda192b226de235cce723b27d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 10:25:16 2014 +0000

    Update comment.

commit 354a4927cf2ba39b01804c7b0430b7571b2088b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 10:18:24 2014 +0000

    Eliminate the node_stopped message, since it is possible that a badly-timed stop_app could lead to us missing it. Instead just go based on whether the rabbit stops - if it stops for any reason other than autoheal, we just send it a message it will ignore and continue.

commit 05b62c27143e980529da39c552c90aae0f810539
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 26 10:11:08 2014 +0000

    Refactor: distinction between handle_dead_rabbit and handle_dead_rabbit_state is not very useful.

commit e901def37a635b16a4d45b557fecf6409ee35d00
Merge: 3412999ec 8a7e56ca2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 24 15:37:05 2014 +0000

    Merge bug 26004

commit 7d6d19f94cca9ec284af77ae61f1a3f2438109b3
Merge: 3412999ec 280708cdb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 24 14:46:43 2014 +0000

    Merge in default

commit 3412999ece989f7a7020e244361b75e2dc7262b9
Merge: e290c32a7 2ce81391c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 24 12:55:53 2014 +0000

    Merge bug25994

commit 2ce81391ce7e74a9d316d26fd5ef72c8ad3b3891
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 24 12:55:37 2014 +0000

    Sort by descending priority order, and add a comment.

commit e290c32a76046e14b4e629391f8743ea030d1eab
Merge: f64397eb1 949aedbf4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 24 11:17:40 2014 +0000

    merge stable into default

commit 949aedbf489a8c700040d243bd9776f50e52288b
Merge: 992ee0b1a 82395545b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 24 11:17:25 2014 +0000

    merge bug26013 into stable

commit 650fff1b3a839decd9bb4842fcc199936ef16e26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 24 09:25:32 2014 +0000

    always prioritise acks (and resume)
    The former, so that we preserve ack ordering which, while of no
    semantic relevance, is good for performance since it allows us to
    optimise for the common acks-in-order case.
    
    The latter since it unblocks a queue from delivering messages and thus
    is conducive to keeping queue lengths short.
    
    We prioritise acks higher than most other messages since they are the
    only high-frequency message which is guaranteed to free up resources.
    
    Prioritising ack and resume all the time is safe since flow control
    places an upper bound on how many of these we can get, thus preventing
    starvation of senders of lower-priority messages.

commit 41477f4c37db75e85fd19830fbc3fbed7bb3a13a
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Feb 21 12:50:14 2014 +0000

    Simply application:get_env calls and reduce distance to default again

commit e9e54f327d0139a9e0dfa53858767308ac3dea8f
Merge: f64397eb1 a2f7fcc83
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Feb 21 10:45:38 2014 +0000

    Merge default into bug24926

commit a2f7fcc8366699a95c3536f191c0e0aa77cebcc3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Feb 21 10:45:11 2014 +0000

    Cosmetic - reduce the distance to default a bit more

commit 82395545bd8b827fd8e3c364265a9d9f6a5b6af8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 20 16:05:56 2014 +0000

    improve clarity and correctness
    - introduce blocked_by_alarm state predicate which makes it easier /
      more obvious to detect the transitions to/from
    - do not send 'unblocked' when the client doesn't have the capability
    - ditch superfluous true/false return from maybe_send_unblocked (now
      send_unblocked)
    - detect the transition into blocked_by_alarm that can result from
      handling conserve_resources (the original purpose of the bug)

commit b1610274952ab7c76327e18750ce364dba3f4dca
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 19 20:28:39 2014 +0400

    Eliminate a compiler warning

commit 3667a3b9a01db7ce1088bb6adfe18137b5de13c5
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 19 20:28:20 2014 +0400

    Send connection.unblocked when connection is no longer blocked or all alarms clear

commit f64397eb1861eceb6eb3052358ab6bfb64c78e20
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 19 15:04:52 2014 +0000

    Bug 25939 broke AMQP 1.0; fix it.

commit 1b3ae5554b91e5977a542c4679f916e5ac8c6df4
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Feb 19 16:22:21 2014 +0400

    Make connection.[un]blocked independent from flow control

commit f7f03e00d6759273942a39d4fbb88f30c3bde42f
Merge: 992ee0b1a c2518d148
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 19 11:33:15 2014 +0000

    stable to default

commit 992ee0b1ae73e71cbb120157bb034769589d0a14
Merge: b07aa8761 0e0f1cbd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 19 11:31:18 2014 +0000

    Merge bug26006

commit c2518d148d2384f0ec1528a5bab261b38dc559b2
Merge: 8de7c0b32 703df9f52
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 19 11:11:29 2014 +0000

    Merge bug26022

commit 8de7c0b32950e8dcfb48fd93964b71b8315c9cb3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 19 11:09:17 2014 +0000

    Add LDAP timeout to example config

commit 889eebefbd4bdd60e14a4413024127fe487bd6f4
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Feb 18 15:10:32 2014 +0000

    Fix various oopses and reduce the distance to default some more

commit ea4d5071524810f46e1c5dbeef8fbb51eeae232b
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Feb 18 15:01:19 2014 +0000

    Try and reduce the distance to default

commit 4e31d6c7fbd65b337329d1152ea638f4144b0ff5
Merge: 54b5de37c 703df9f52
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 14:20:33 2014 +0000

    Merge in default

commit 9f6e7e7719883fa2e4c445ccdc73e4a162bfcea0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Feb 18 14:05:05 2014 +0000

    Add a type spec for prepare_boot_table

commit 08e583a2f127e151ed8ba8eda3dfd1abf1f545a9
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Feb 18 13:55:51 2014 +0000

    Simplifying refactor
    
    Since the "rabbit" process /always/ starts before everything else,
    handle boot table creation at that point and avoid the ets ownership
    issue and corresponding messiness. The previous worries about handling
    situations where we want to run rabbit_boot code whilst rabbit is
    offline aren't an issue for us.

commit 703df9f52c08029827c1fe7ea369ecb58a0d273f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 18 13:30:23 2014 +0000

    cosmetic

commit 552e1481ecf74c6040b135d251537ba14c8d7a1a
Merge: 66db57e40 a8356b646
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 18 13:28:57 2014 +0000

    merge bug25868 into default

commit 66db57e4014b70b2d36c7789f5322f41ed37a100
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 18 13:28:24 2014 +0000

    clearer
    I think

commit a8356b646c52a024560e69363dea7400baee1c9e
Merge: 57733ee43 5b501ee3f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 13:14:35 2014 +0000

    Merge bug25868 (again)

commit 5b501ee3fe26a12855a2d9f1b42ae4a8f65bd69d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 13:13:49 2014 +0000

    Only ever return 'flow' if there are no alarms. I think in theory it's not possible for there to be an alarm when in flow control, but this is more correct and no less clear.

commit 2df0129a194acf85173705cef6f1a136b6ef2596
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Feb 18 13:03:29 2014 +0000

    Use a gen_server to keep the boot steps table around

commit 280708cdb69be5a45221e70d5782448a394db9ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 12:52:13 2014 +0000

    Oops

commit 77cd6ab1514d1a4cc2891c9fa99cc7ca65d156f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 12:49:00 2014 +0000

    Allow checking an IP address as well as a socket.

commit c678d3abdb729e201a1db0ac481f945b8987e984
Merge: 57733ee43 6f22f6593
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Feb 18 12:47:15 2014 +0000

    Merge default into bug24926

commit 57733ee43e4600fdcc76bdb942e523a23263e2c0
Merge: 630307a84 5534d8c64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 18 11:33:26 2014 +0000

    Merge bug25868

commit 630307a8437b3a5972e0d50e66dbcb55a59004b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 18:54:45 2014 +0000

    Oops

commit 5190a47505b69575091bb5db781ecfd848ed2ec0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 18:47:08 2014 +0000

    ...but only do that if we are not also alarmed.

commit e0d87da8e30ab3a8d99b908bad5916fdb86b2ee2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 18:44:20 2014 +0000

    Show state as 'flow' if we are currently flow blocked and have been so for more than 5s.

commit b07aa87612d8920ca41994d7dc845edb96803ce9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 17:57:12 2014 +0000

    Inform autoheal that a node is down on nodedown not rabbit app down; therefore stop ignoring nodedown in winner_waiting.

commit 6f22f6593c74fd9f543160f368407f21fb4fde0b
Merge: e831fe918 5534d8c64
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 16:06:53 2014 +0000

    Merge default into bug24926

commit e831fe91845f4649925a8dbafda2b6ea50c728b1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 16:06:16 2014 +0000

    Avoid verbosity

commit 5534d8c648a8083f5faeb43f58d4ab6fa6ccc2e3
Merge: 6c8aeb51f a6f9f6542
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 15:07:54 2014 +0000

    Merge bug25627 (again)

commit 6c8aeb51f83950dff052f72f6de31748ccc5de7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 15:07:39 2014 +0000

    Don't crash if the alarm gen_event server is not there (i.e. app is not running).

commit 753f9ff2e5f395618ec9295cd6056f58d129429b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 13:59:07 2014 +0000

    Don't bother printing out reload errors

commit 77bdfef9442629cdb27b5df771898684bd7faee5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 13:58:23 2014 +0000

    Simplify

commit b2d03a73b533d905b939bfc95d2d51bafd096ad6
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 13:57:20 2014 +0000

    If you're going to catch, actually handle failures

commit 26a38dc95c6909a3cf8d268c831a619ec4ede9da
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Feb 17 13:54:28 2014 +0000

    Cosmetic (ish)

commit a6f9f6542d940e350b75426ed5e03b034cd39771
Merge: ed20f8d60 8f9325962
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 13:21:28 2014 +0000

    Merge bug25627

commit 8f9325962f0712533eafc9532f657f9a54757949
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 13:19:18 2014 +0000

    Cosmetic; move near call site

commit 1099f6c33fd06a75de4113b0bf6b30e23917d055
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Feb 17 17:13:59 2014 +0400

    Filter out alarms for other nodes

commit e4d3663b404be91810ff5d8c8e0d4867e91d3695
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Feb 17 16:39:06 2014 +0400

    Format alarms in rabbitmqctl status

commit 63e8d9ce0c1b459aa02d7f4a9191bf35f46b373a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Feb 17 16:36:30 2014 +0400

    Backed out changeset 14b04256557c
    
    Introduces unwanted whitespace changes, will re-apply.

commit ed20f8d6015d218f98553ae1e3e087dcb708176a
Merge: 1c3952bcb 0e0f1cbd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 11:55:05 2014 +0000

    stable to default

commit 0e0f1cbd65ebaea5000282352896412cc789a9be
Merge: 07c42e02b cd88a6baa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 11:54:37 2014 +0000

    Merge bug 26014

commit 7378ab1917ecfd6b1eaaa80f1cf331d2756e0a2f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Feb 17 15:16:34 2014 +0400

    Format alarms in rabbitmqctl status

commit 07c42e02be961a83762c8677bf25f6ba74597854
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 17 11:07:58 2014 +0000

    Don't call InnerFun and remove/3 if the binding was not there.

commit 33456dd1890cfc64c3a21f76a5356c5b81b9b394
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 14 17:47:47 2014 +0000

    Refuse access for guest via non-localhost by default.

commit 1c3952bcb5a2a9c239defa56ae8bf867fe749892
Merge: aefb7b579 f58db3053
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 13 16:34:50 2014 +0000

    merge bug25853 into default

commit aefb7b5797bf7c5b76f171d1ba4bb3861b21b5e7
Merge: 987931b05 22a7230bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 13 15:12:21 2014 +0000

    stable to default

commit 987931b0596907aaa795db118574d665df12469b
Merge: 8df07d4a7 7c2cebd2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 13 15:12:11 2014 +0000

    Merge bug26005

commit 8df07d4a70d3e5c225df8d97d0f2ed5ffced1935
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 14:07:56 2014 +0000

    Handle down messages from the delegate, since that's what we're monitoring locally. And make sure that cast/2 has cast-like semantics - don't blow up if the gen_server has stopped.

commit fe580f6c9163eb1da6cc951790cadb68a6a084a9
Merge: d49c2fa1b a5042edb4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Feb 11 11:36:06 2014 +0000

    merge default into bug24926

commit 22a7230bd868534aa4add9f3317334af70cd4495
Merge: d49c2fa1b a7503f1a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 10:52:14 2014 +0000

    Merge bug25985 (again)

commit a7503f1a11145c8628be39cf3f634b44b945cb0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 10:50:47 2014 +0000

    Allow username without password after all.

commit d49c2fa1bc55c4ba49b998704eba1e3805382a41
Merge: 7c2cebd2d e41320ca0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 10:31:51 2014 +0000

    stable to default

commit 7c2cebd2dc3e41e74c887ead75577391e493aad8
Merge: bc54e90db 2164f0e8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 10:31:42 2014 +0000

    Merge bug26000 into stable again

commit 2164f0e8df6689aafab5fdc7d2179ad5bb7dc178
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 11 10:31:23 2014 +0000

    More documentation, slightly stricter types.

commit f58db3053df80431e35d8c093f484a3456df46db
Merge: 5ebcd9b95 e41320ca0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 21:43:59 2014 +0000

    merge default into bug25853
    since the previous merge pulled in a breakage

commit e41320ca057affaf76f09bd5c39ed87f40b966b8
Merge: 5339f0a0a da3701909
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 21:42:18 2014 +0000

    merge bug26000 into default
    again

commit da37019095a31189136fa4232e28c95e8beaffe5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 21:41:36 2014 +0000

    fix tests

commit 5ebcd9b9555e62d1a32bf3410d89790af588b3a7
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Feb 10 20:24:19 2014 +0000

    rabbit_file:wildcard/2 should return [] if the dir is non-existing

commit f0f1ee9784b28cc39e0fa2553ec1ba8c9f6daf65
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 19:30:56 2014 +0000

    oops

commit eddc6987afbf130c709fe0170f111e236e66f4fd
Merge: 362a5b666 5339f0a0a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 19:23:08 2014 +0000

    merge default into bug25853

commit 5339f0a0afbe4fe1fae656ecf6222c52330a6147
Merge: bc54e90db 8eb42f47a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 16:07:42 2014 +0000

    stable to default (noop)

commit bc54e90db2f5e61624e3ec7e99bd5720f97cd253
Merge: 03bcc8902 d0ec1f306
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 16:05:55 2014 +0000

    Merge bug 26000 (into stable this time)

commit 8eb42f47a10f084fbc3d9e36b8b562d7f3c590b5
Merge: 03bcc8902 8e2791065
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 16:04:09 2014 +0000

    Merge bug26000

commit 362a5b666c1a9148ed5ccb040d25d37d36c68ccc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 10 15:50:04 2014 +0000

    cosmetic

commit 8e2791065b6954931b6ec985dc63bab57d7f281e
Merge: 058332283 5cb24141d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 15:19:46 2014 +0000

    Merge bug24738

commit 058332283daf8a7b846d479f775d15e49d04f83e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 14:43:21 2014 +0000

    And after running dialyzer...

commit 791baeba6490b9712110c5c93a0548c5d615e21a
Merge: e0ef32db6 5cb24141d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 14:38:34 2014 +0000

    Merge in default

commit e0ef32db6808756e85aac8480c7a6cdd4a03d1b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 10 11:01:34 2014 +0000

    Include a reference in forced event refreshes.

commit 5cb24141d912924d25b51094e8d4cb8bcabb78df
Merge: f0e9e280f d51788d08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 7 13:16:28 2014 +0000

    Merge bug25985

commit d51788d082fa92316638c401c5d637f37311f586
Merge: 7dbbd35b1 92e5e8b24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 7 12:21:42 2014 +0000

    Merge bgu26001

commit 7dbbd35b10310218ce8acf7c5e5af76086f8207a
Merge: 5d3d29173 a30b39109
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 7 12:15:21 2014 +0000

    Merge bug26002

commit 8a7e56ca25fab69127ed5575ecce6fe8d74eae51
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 7 12:02:55 2014 +0000

    trigger rate calculation in all the right places

commit 5d3d29173995d6181764246685d5f30c469de5b8
Merge: 67dcf0dbd d0ec1f306
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 7 11:39:03 2014 +0000

    stable to default

commit d0ec1f306c408719dff0717d0ac5024a625e5d53
Merge: 6cda03580 49f1566fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 7 11:38:50 2014 +0000

    Merge bug25762

commit a30b391098fe92ae34b80440a842ce1eb26ca608
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 20:11:50 2014 +0000

    bail on coding bug

commit 5a69daa6f29858bf046af426472a287ef570d67a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 20:04:41 2014 +0000

    don't use amqqueue:with/3 in mq_misc:{add,drop}_mirror
    since we don't actually interact with the master QPid here.
    
    Also contain errors from the mq_slave:go invocation.

commit 67dcf0dbd653e5da027ed124cbd9777c63f21f0c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 19:21:36 2014 +0000

    remove an abstraction too far

commit 92e5e8b24041e81a860ca2b3ebaeaab7f1b9663d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 17:51:21 2014 +0000

    don't sync so often

commit 49f1566fd55be58654070b61e5c49b0710d1681d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 17:24:33 2014 +0000

    minimal fix

commit 03bcc89029dae7ab611b3436a1a139a0a071f1a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 6 15:36:06 2014 +0000

    Allow specifying a tx-fun.

commit 08dc3c58e8059df75c717bcd8577996f551d9db1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 13:02:09 2014 +0000

    cosmetic

commit 9b96f69d77e7030446e10895bb4cf7783eef9bfd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 12:37:30 2014 +0000

    rename misleading variables
    ...and fix a counting error

commit eef1bfb6d8d1a6c01fea2dcf76d4db3860cdba04
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 12:22:55 2014 +0000

    simplifying refactor

commit e0e28f90ac19ed3732fd574a19cd4211f8a7c0ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 6 12:04:30 2014 +0000

    cosmetic(ish)
    - sensible order of exports / specs / functions
    - remove unneeded exports
    - inline some functions

commit 08301a125c6c189a2cd74c013e7426f974557dc0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 5 18:55:45 2014 +0000

    preeeeeeetty

commit 4cfff0dccbfb5286a1704004beeb4ca1c1f9cb38
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Feb 5 16:57:55 2014 +0000

    Use dirty opts to find durable queues during startup (and optimise)

commit bb4ccbfbfda1efead3c2dbae3f0cf06d2697e7d0
Merge: 70d58983f 642664dd4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 5 16:24:11 2014 +0000

    merge bug25980 into default

commit 70d58983fe9fc30b1c818e61666eaaaca1bee662
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 5 16:22:08 2014 +0000

    improve docs

commit f0e9e280f361a8ba710439b04a5e71f2b20ad9b6
Merge: 823fde279 642664dd4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 15:20:35 2014 +0000

    Merge default

commit 642664dd4162f29503df8ce771f2ce03c34fa96d
Merge: b925f14ca 71c50ccd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 15:12:40 2014 +0000

    Merge bug25979

commit 71c50ccd55b1d53b09b85ad6e764fb2703247998
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 14:48:52 2014 +0000

    Assuage dialyser. And possibly myself?

commit 781cbcd3caf767daa7435b001e1a5143e6fd7df4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 14:36:29 2014 +0000

    I don't think we do need to notify. Also, add specs.

commit 823fde2791262ccf701db82ee8ccb98482e882d1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 13:17:01 2014 +0000

    Get rid of the impersonator tag, only let the magic user do it.

commit 188ed47526204f00778f87624ce8c45b66a61536
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 5 13:16:41 2014 +0000

    Introduce dummy user for direct connections without users.

commit df11b4e85f31a8a39097e40f5c0f6046f0394d06
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Feb 5 12:07:49 2014 +0000

    Simplify durable queue recovery and avoid a dict lookup on the results

commit b925f14cac1ccf8b643309a2f93827e3a6df2032
Merge: b61853e2f b6f050c9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 4 16:50:49 2014 +0000

    Merge bug25992

commit 54b5de37ca389d02045ea8ac7b69836414279aba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 4 16:42:28 2014 +0000

    update_counter--
    correctness++
    
    And also re-construct the prefix correctly.

commit d57b7c85df9518de125644a517e1f91cbc7c0754
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 4 15:41:57 2014 +0000

    Don't reinvent orddict:update_counter/3.

commit b61853e2f97e914826bace1b84d9b016c7e14263
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 18:32:13 2014 +0000

    refactor: more obvious correctness
    don't modify the State in the fun passed to queue_consumers:deliver.
    At least in one of the call sites.

commit 490cabc31adbfec7aaee8403de9306ffbe1cb905
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 18:03:54 2014 +0000

    cosmetic

commit 7d4fb0f0a6b021525dc990c888713af26c0c220d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 18:02:21 2014 +0000

    refactor: don't carry around so much state

commit e83b38912bf9ed5dd812656f8b97cd87410da80d
Merge: 285e8e1d9 aa81f3531
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 17:47:22 2014 +0000

    Merge bug24408 (again)

commit 285e8e1d9407842f1834a21d486e9a9a377d7c18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 17:47:04 2014 +0000

    This optimisation only makes sense when the message is neither mandatory nor confirmable!

commit d8ba5cdff69e30c25b36e4d68206121d611b0fd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 16:47:11 2014 +0000

    Log a warning if the cluster name is picked from several candidates.

commit b6f050c9f573b24dc65d8e8ca9cbfdcb719a23e0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 15:26:43 2014 +0000

    optimisation

commit ed7b399c105b8f10f2c44eb23fb5f212b7662321
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 15:23:01 2014 +0000

    Manage AckTag -> Ctag mapping in rabbit_queue_consumers, leave the channel out of it.

commit 76658beb9c6f7015b75024753f3fd7808c07ffb8
Merge: aa81f3531 7597e6871
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 14:23:45 2014 +0000

    Merge default

commit aa81f3531d6e7d65809d7369adbec57aab490dae
Merge: 8f72010f8 8807b832f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 14:21:34 2014 +0000

    Merge bug 25991

commit 7597e6871940458eccea7592e73a021da0021725
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 13:44:19 2014 +0000

    If given Credit=0 then don't accidentally return Unblocked=true.

commit 8807b832fc99da9d78d6f6750c4e996ecad2264b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 3 13:09:56 2014 +0000

    Take account of arguments in rabbit_topic_trie_binding.

commit 8f72010f8db07304bcbefe7cfb0c3e8c288773a1
Merge: 49a3fbf97 0e2ab9f35
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 01:11:55 2014 +0000

    merge bug24408 into default

commit 49a3fbf9792c823d8eabf082b4bac7f8b423925f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 01:10:44 2014 +0000

    missed one instance of the switch away from msg_seq_no as confirm indicator

commit c94d25c225de70e72d29e1d8305b31be2a06363f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 01:08:08 2014 +0000

    cosmetic

commit 0e2ab9f35a35ae44393d89749f0a366cd83b70df
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 3 00:43:50 2014 +0000

    oops
    this wasn't wrong, but it looked odd

commit da0bc7ada287a9298a102e125f0ded680acc7f40
Merge: 1ecb5b9ea 1fb4024f5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Feb 2 23:08:12 2014 +0000

    merge bug25817 into default

commit 1ecb5b9ea5993a0ad654eb8aeafda7fb445238d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Feb 2 23:06:16 2014 +0000

    don't intercept performance critical methods
    This improves 'PerfTest' by ~10% when running with one scheduler

commit 1fb4024f58185859060ce998fe947beb297a7544
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Feb 2 15:47:57 2014 +0000

    shut up dialyzer

commit 0e37e829315d198e3352158189f7f36e336f9828
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Feb 1 18:03:11 2014 +0000

    cosmetic

commit 6b0cb1000c40bf8eb9a5aeb86d6ca765a912b6a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 31 15:55:54 2014 +0000

    Upgrade.

commit 5861d56059ab4f7655a4399f04ca859f91264f15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 31 14:33:02 2014 +0000

    Language

commit 6943499e92b0e6ff085eb3e9b5efa3275d10c711
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 31 13:54:56 2014 +0000

    Document set_cluster_name.

commit 46804cb5ccff54aaac0bcbc8b717fa503698c302
Merge: 5e42e02a1 60ad234db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 16:33:01 2014 +0000

    merge bug25888 into default

commit 5e42e02a1cf2c86812d323c56647dcd30ecdccb5
Merge: 63f5b98dc 41ac44a32
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 15:58:41 2014 +0000

    merge bug25827 into default

commit 63f5b98dcd2bb558983f5f90482eefca24f11d72
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 15:58:19 2014 +0000

    unbreak durable queue dir cleanup
    all_queue_directory_names returns just names, not paths
    
    Also, gain some efficiency by performing just one invocation of
    rabbit_file:recursive_delete/1, with all dirs.
    
    And some cosmetics.

commit eec669407e0c7ce029068d544291e3304b540d3f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 30 14:22:38 2014 +0000

    Perform (and wait for) queue recovery in parallel

commit 41ac44a32e1e33cc0c3f3678415af5be58861e46
Merge: 82aa2ffce 0a3c22baa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 14:03:30 2014 +0000

    merge bug25827 into default

commit 82aa2ffcef9906a91fe33a0b469275edd9b0a43a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 14:02:51 2014 +0000

    oops

commit 60ad234dbb3fb4636cc6632fa107ac7c8393e0b9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 30 12:47:58 2014 +0000

    inline

commit 839faa45c948bfdb6cb17562c3e31febae2e7176
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 30 12:41:16 2014 +0000

    Don't reinvent the wheel

commit 01e93a9e8619ea1469eabdf90440117f790914a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 30 12:30:54 2014 +0000

    Consistent ordering, and only take account of publishes when deciding whether to update rates (since it's only in conditions of high publish rates that we care).

commit 289ad50c1cbd2a42a49883f00a99eed0662aaa34
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 30 06:55:43 2014 +0000

    Refactor the tests just a little bit more
    
    Extract a helper to wait for process exits we're expecting. We ignore the
    potential race (when establishing the monitor) since the exit reason is
    irrelevant here, we just want to know the process is gone.
    
    Instead of hitting 'nonode@nohost', which is slow (perhaps due to DNS
    querying), we pull the current hostname and combine 'nonode' with that.

commit 0d50f68d5bf4956f1ff769080955707a5b6b056e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 29 23:20:17 2014 +0000

    proper cleanup
    this should ensure that all process registrations etc have disappeared
    by the time we return from the function.

commit a64528edf03a042b2ae9436b4c8508c4f5b0ace2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 29 21:58:16 2014 +0000

    Rework mcall tests
    
    Perform registration in the test process to avoid races.
    When we expect a process to be dead (before mcall), ensure it is.
    Ensure the last surviving test process is killed on completion.

commit 88f21a9b75934e004f060a1c9acd211e261a28ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 29 18:15:24 2014 +0000

    cosmetic

commit 18f90d287fe7d9c8314b1d06b9634861f2fd8269
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 29 15:10:07 2014 +0000

    First pass at cluster name.

commit ee877b2e2f6c05aa3d602a262e9261d0c4a1dc7f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 29 14:22:52 2014 +0000

    Unify the test cases and cover all bases

commit 02f0f4361853dfe32627f2be5a5a0b0b8596f0a2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 29 12:57:28 2014 +0000

    refactor: simplify

commit 9b52df5430c042492fea8fe84d97d36293dbccf5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 29 12:45:07 2014 +0000

    refactor: lift do_mcall casing to head

commit 600efc0174f2ea0e43fc606b5faaed2d7ad55ffd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 29 12:32:48 2014 +0000

    move mcall docs to correct place, and improve them

commit 2acaff593e0c490fb1eaeb93737f2408ec163b15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 29 12:24:55 2014 +0000

    Based on some testing, we can reduce this somewhat.

commit cf18153da09f9bc6d26d39c3fe4c3656ef1357a2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 29 11:28:10 2014 +0000

    Return the correct exit reason for unknown global registered names

commit 1d425b899a2a65d09f973be50f3f80b53cf6a89e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 29 10:54:33 2014 +0000

    Cosmetic (ish)

commit e723f80e7e0ecbadec6be3afe7bd7598e340d4a1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 29 10:44:07 2014 +0000

    Remove rabbit_misc:multi_call/2

commit b476e17a326293f97a9101ad54a44b3732cfdf1d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jan 28 16:50:30 2014 +0000

    Fix multi-call tests

commit 53bec884155eae0b2947338a52f4c1805fa39cc6
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jan 28 16:37:58 2014 +0000

    Use gs2:mcall/1 in r_amqqueue:force_event_refresh/1

commit 656e2861dc19fe0649145598a229ca3d9ee22d62
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jan 28 16:29:20 2014 +0000

    Add a note to the gs2 essay

commit e3159b1f4f2977a9cf6d1e1f9beb4ff3e634e17a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jan 28 16:25:49 2014 +0000

    Handle varying destinations in mcall/1

commit 81bd7f7e2600a30d7473a512487a3d33a1c8a4af
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jan 27 17:57:20 2014 +0000

    Refactor: tag replies safely and avoid using erlang:demonitor/2
    
    For efficiency reasons, instead of demonitoring (which leads to scanning the
    entire mailbox), cope with duplicate monitor refs when collating gen_server
    replies.
    
    For safety, tag the exit signal (which we treat as a result) with a unique
    reference instead of the middle-man's pid.

commit c8fba9bc81323100b2998034397c73dada1f25f4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jan 27 16:50:00 2014 +0000

    Introduce a new parallel (multi-server) call API

commit fd808007acc610af6f5f63f99cf62c852358d984
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 15:07:23 2014 +0000

    The existing value can be 'undefined'.

commit 8c2ba1d9452766e4b07999cb936d4198f8b5ed6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 15:05:01 2014 +0000

    Try to get the weighting factor right.

commit 53fb73589a03be113306c317aee6bf4b94534944
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 13:59:16 2014 +0000

    Rates on exponential moving average.

commit 652174132674b4a44a9e837d67f35e2a2b240472
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 13:36:58 2014 +0000

    oops

commit 16f952240b9d8acd48a94da98926bbed6bc8b020
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 13:18:22 2014 +0000

    Cosmetic

commit 8e6c77ac6de3711caad09391a6f80da6e6de3679
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 27 13:16:33 2014 +0000

    Unify the #rates record so we don't duplicate as much stuff.

commit b481bb397c875bca942c2aae5dfa339599f306bc
Merge: 0a3c22baa f575a533a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 24 20:33:25 2014 +0000

    merge default into bug25853
    containing the recently merged bug25827

commit 0a3c22baa344ba5a4c85811cf0a30fe2ebe03695
Merge: 6dfdedb69 923837c74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 24 20:29:32 2014 +0000

    merge bug25827 into default

commit 923837c74ced836fe903f3d55f7255f1d29c1259
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 24 20:26:15 2014 +0000

    turns out we needed recursive=true after all
    ...but actually do this whole thing differently

commit 6dfdedb69d5b9b7132c1c0fbc57d4a44c5d2aefb
Merge: eefbc57b7 6ae700cec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 24 15:43:54 2014 +0000

    Merge bug 25817

commit eefbc57b7839b2650a561ff3b9db12af9760aaa9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 24 15:41:09 2014 +0000

    Whitespace

commit f575a533acaeb9f9b9fcc3684a73188c5baa008c
Merge: 6ae700cec c52ac3fc5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jan 24 15:14:52 2014 +0000

    merge default into bug25853

commit 8e543e954f5b3f2259976baeb7780f08e0777216
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 24 13:55:54 2014 +0000

    Update rates every 1000 messages or at the ram duration timeout, whichever comes first.

commit c232b0fd7664db4e3a33424665aaec5f910397e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 24 12:54:55 2014 +0000

    Explicitly target an egress/ingress ratio.

commit a18f10901e9db0038b71274f7eaadcaef35f6312
Merge: 6ae700cec 974789eb3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 24 12:50:40 2014 +0000

    Merge in default

commit d60152edecb769371f3f102040eff987129e07f0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jan 24 12:11:29 2014 +0000

    Ignore clean.dot read/delete errors during upgrades

commit cd88a6baa8678be738d8d2867a7fe1ba442f796c
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jan 24 13:33:06 2014 +0400

    Fix a syntax error in config example

commit 289cdb4fcd5f1e96194dbba16c2b6b3aa65a42a5
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 23 20:39:40 2014 +0000

    Improve recovery terms upgrade handling
    
    Use a more specific regex to locate the old clean.dot files.
    If reading an old clean.dot file fails, simply log the error.
    Ensure that we close the dets table after our upgrade step has run.

commit 9a4ecf490da2b5b5519508c5f97a1415811898bc
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 23 19:42:38 2014 +0000

    Refactor rabbit_recovery_terms startup
    
    Rename rabbit_queue_index:{recover => start}/1.
    Rename rabbit_shutdown_terms{recover => start}/0.
    Stop handling supervisor child-start errors explicitly.
    Add {rabbit_recovery_terms, rabbit_queue_index}:stop/0 variants.
    Introduce a `stop’ code path from BQ:stop/0 to qi:stop/0.

commit 6ae700cecbe147708baa795ccd14bb523ee433d4
Merge: 9d95f9d19 07a1bab90
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 23 17:11:10 2014 +0000

    merge bug24408 into default

commit 9d95f9d193706d5ae6ce153a2eda3518cf6e90b9
Merge: 6cda03580 d25db8a1f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 23 15:53:52 2014 +0000

    Merged stable to default

commit 6cda03580045f384d13271f8088a564714c8a4df
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 23 15:45:18 2014 +0000

    Added tag rabbitmq_v3_2_3 for changeset 915404021814

commit 871d548c43cb8fb82be04c6fbb17c891d5bef007
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 23 15:44:34 2014 +0000

    Changelogs for 3.2.3

commit ea9cbf46e5660d23dd0fe896022e4957990f22ec
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 23 15:24:00 2014 +0000

    Refactor (recovery-terms restart strategy)
    
    Use rabbit_sup:start_child/1, since a transient restart is fine.
    Match on rabbit_recovery_terms:recover/0, since we want to crash if that fails.

commit bc69688a7dd662441754b4f284d2067e65d2e323
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 23 12:48:21 2014 +0000

    API consistency, clarity and cosmetics:
    - store/2 took a full dir path whereas read/1 only took the basename;
      now they both take the basename.
    - clearly separate the public API and the internal API in exports
    - don't have specs for internal API
    - remove unused UPGRADE_TABLE define
    - ditch rabbit.hrl include - it was only needed for ?MAX_WAIT
    - sensible order of function definitions, plus some separators for
      clarity

commit 07a1bab90e0d4cbc9da8e532f1ec10cf2832c055
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 23:25:27 2014 +0000

    some drive-by inlining
    not strictly part of this bug but easier here than on default

commit 8d32aad6f2d4a3c668bb77dcd92be59636fcbdde
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 22:29:04 2014 +0000

    some inlining, cosmetics, and more explicit sequencing

commit eff6c36a04bf76d0751a63d876660062c5be14ea
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Jan 22 19:34:13 2014 +0100

    updates interceptor behaviour spec

commit 6657b20d1fa1f0f4e8f1f7cad62c3ed1b59a4442
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Jan 22 19:05:21 2014 +0100

    passes vhost to interceptor

commit b1b8e9f8a638fc05bd60b141a0da7f0f83b9bf31
Merge: e6c9d5f2d d25db8a1f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:45:14 2014 +0000

    merge default into bug24297

commit d25db8a1f5eb9df5d4db0e4ea656c3071578149b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:42:40 2014 +0000

    refactor: make 'reject' arg order consistent with 'ack' et al
    cherry-picked from bug24297

commit e6c9d5f2d9547753275c9c6e297db44a5f1725d9
Merge: 140f3de39 b8cc1fcd8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:23:32 2014 +0000

    merge default into bug24297

commit b8cc1fcd86c9e293a9a6930b5ec96ce7da03f745
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:21:28 2014 +0000

    refactor: genericise

commit a70de561186ba349914e54206566ba293f05f776
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:20:07 2014 +0000

    brevity

commit f107ef4aae3de114031c2ddc26ef2e6bdeb0c68f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:16:41 2014 +0000

    cosmetic

commit 7de3307efd10d6bbdab51c4106e83a3d452780c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 15:14:38 2014 +0000

    s/confirmed/confirm/g, fix a test.

commit 140f3de392804f2f069411317c3325dacb59fe3a
Merge: 0363ebd8e 32e9645e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:14:00 2014 +0000

    merge default into bug24297

commit 32e9645e513b2b9180810dc4dc344bd7bef9e3ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 15:05:39 2014 +0000

    refactor: basic_consume/10 -> /9
    cherry-picked from bug24297

commit ae93c0f462a554980dc4af0b3f5bd5cdab78da8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 15:03:36 2014 +0000

    Remove some duplication.

commit c52ac3fc5b0f76d13605cd54163c7ab77de9d093
Merge: a7b2e1b7f fa4968970
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 22 14:56:28 2014 +0000

    merge default into bug25853

commit bbc22e03e053bb970266a51f7b1908bacc1f5b26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 14:50:37 2014 +0000

    Fix drop/2.

commit d50ad0890e5096f0ae466d5868682d0a23f79916
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 14:33:38 2014 +0000

    Don't stomp on timeout when receiving mandatory notification.

commit 30c6b56390d72880b634cafba931a5abcb86d065
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 13:44:34 2014 +0000

    Don't think that needs simplifying, but the comment is now not relevant any more.

commit bf1eccfbcc8d94134f591102d722baf5b1f7df13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 12:22:46 2014 +0000

    Fix basic.return stats, and fix various problems found by dialyzer.

commit bc9eca45e6df30f8eb76f4f19901514b10f58615
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 12:03:00 2014 +0000

    Don't explode when there is more than one queue to route to!

commit 8295c1acb90cac66ab159c2bd5c1aa66019666da
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 11:57:11 2014 +0000

    Oops

commit 3d4deca7dd5d70e2fbfe58c2cd2491b0e7d5cfa6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 22 11:55:35 2014 +0000

    Substantially improve both performance and correctness: 1) really don't treat presence of MsgSeqNo as a cue we are doing confirms, and 2) get the right dtree function when we receive a MsgSeqNo.

commit 0363ebd8e391931635725a23c9372e6752bcf52b
Merge: 6a07ff8c1 fa4968970
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 05:33:08 2014 +0000

    merge default into bug24297
    (and resolve merge conflicts in limiter)

commit fa4968970f6160afdd64cceb07021a669e51f57c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 22 00:02:55 2014 +0000

    inline

commit 7bced52c8cffa8b46cf383aad02dfbc0d99bdaaa
Merge: f7431d5f4 4735326a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 21 17:55:37 2014 +0000

    merge bug25962 into default

commit 4b5b7601f506286db3fce4fd9c0f293e8be5eda3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 21 17:49:44 2014 +0000

    Get dtree use right: we want take_all/2 when we get a mandatory ack (since one queue getting it is enough). take/2 on DOWN is correct.

commit 38e5b687de76739b5419c1f0f6ddf0d8262ea16e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 21 17:23:19 2014 +0000

    Quick-and-dirty version of pipelined mandatory publishing

commit 4735326a076ac5f00d11118bd223a6079b7262e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 21 10:25:35 2014 +0000

    cosmetic

commit a03e0db9127d215ff2ac7c619513201e818e04c5
Merge: a0c2c4cc3 b47325e38
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 20 20:30:55 2014 +0000

    merge stable into default

commit a0c2c4cc3421352532898432255f2edb7968408e
Merge: 219dd70ac d3cddfd66
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 20 20:24:45 2014 +0000

    merge bug25929 into stable

commit 219dd70ac7b83da1fd899d35ac5c9c6401e281c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 20 20:21:41 2014 +0000

    handle setopts error gracefully

commit b47325e38b578b8e629baaeb2ab04040b273634f
Merge: daf661458 fda8454b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 20 15:58:42 2014 +0000

    Merge bug25654

commit daf6614588124114c42a9fabbcbb7c4d219a73d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 20 15:43:22 2014 +0000

    Placate Matthias.

commit 27caee24f04cac0ed557678ef09e9a9dab1a3591
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 20 15:11:14 2014 +0000

    Uh, give the second head a chance to match.

commit a7b2e1b7f665eed36c953cfaebf15774a7f91f7f
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Jan 20 14:02:58 2014 +0000

    Optimise queue index initialisation
    
    Avoid loading the journal when the file doesn’t exist.
    Also try to avoid flushing the journal unless necessary.

commit 0684f084ffab0b969880877aa579159f056f7027
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 16:51:41 2014 +0000

    Separate modules for authentication and authorisation

commit fda8454b956dd9762233a44880eacb0c27ed522b
Merge: 24392afff d3cddfd66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 14:36:12 2014 +0000

    stable to default

commit d3cddfd66ab5bc8265f268a3b7d54b79bbf7a9f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 14:31:20 2014 +0000

    Fix type error

commit 66b5b6f4b2edb4acb9b35b6de9942029974c6f78
Merge: a19c32cc6 11f359b49
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 14:28:52 2014 +0000

    Merge bug25965

commit 11f359b49e3449e891def6d4be19ff3c20f29ab7
Merge: 910581a84 86b381b24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 14:26:34 2014 +0000

    Merge bug 25952

commit 86b381b24e150d7c1ff2c239ba57086235654f21
Merge: f1890a32b a7ff2227b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 14:25:55 2014 +0000

    Merge bug24927

commit a19c32cc6b499679d5b0f3e8eec15e36d9d3437f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 12:12:07 2014 +0000

    Oops x 2

commit df47096989170af03831a1bbd1f1a7a3dcc361ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 12:02:56 2014 +0000

    Oops

commit 0e78304aae0c0640a64208d7c59cc03866c442a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 11:50:57 2014 +0000

    Limit maximum message size.

commit 910581a849499be0cec89bf9cd8f0ad044aa66b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 17 10:59:41 2014 +0000

    Remove inanity.

commit d7e1e23a587479afb542966b22d578fadabd0f7c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 16 19:18:10 2014 +0000

    cosmetic

commit 06ea36b5aa6b3578e02b1432258a7b8c06e68fe2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 16 18:54:55 2014 +0000

    Fix the BQ interface comments pertaining to recovery data

commit b3511325e13a58e5850c712f2d1d7b8779236d81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 16 15:51:26 2014 +0000

    Avoid "Absurdly large distribution output data buffer" death.

commit 8145e83a43c3bcc558e2fa0ab279cfe8ad4ab2ee
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 16 13:26:04 2014 +0000

    Fix type spec and modify backing_queue_qc to call init correctly

commit 6a07ff8c1d76b0bb4d4c807d0c65968656d73c10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 16 12:34:51 2014 +0000

    Capability

commit f1890a32bc4ba8eda4524361fd4d52e1312f9eb3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 16 12:34:16 2014 +0000

    oops, wrong branch

commit 45e35b21ec24f9c688123abbbbff2d50b48376c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 16 12:31:01 2014 +0000

    Capability

commit 3236faa1d3b0ec16f8d4172077f3eb1f3d6e5667
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 16 11:57:37 2014 +0000

    Revivify branch from earlier commit.

commit c1f8c5ad83199682c0c68fae6dbde1d8addd4175
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 15 19:14:23 2014 +0000

    cosmetic

commit 2d1b5490c105a81cb77b81187dc8b20b7cfc8294
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 17:23:49 2014 +0000

    Staunch the flow of "Discarding message..." log messages

commit 0ccf565a3f4608665b57dd562ec3f6874b4ebba7
Merge: 24392afff d4a87ce31
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 15 16:53:09 2014 +0000

    merge default into bug25827

commit d4a87ce3127983137ddb2a92350aae156e2de028
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Wed Jan 15 14:30:56 2014 +0000

    Refactor - simplify BQ/QI interface & reduce the distance to default

commit 1319b15e5be2ba398624bed7ef0830a2355b70aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 14:21:40 2014 +0000

    Update essay.

commit 3564ac37dbe67a3ad24788e2ef057e8cb67ade90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 14:14:00 2014 +0000

    We can't have drain=true and mode=auto so let's unify to a single mode: manual/drain/auto.

commit 969764b187eff634eab8aeba759b59b392262906
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 13:54:24 2014 +0000

    Unify rabbit_limiter:credit/5 and rabbit_limiter:set_consumer_prefetch/4.

commit 1fe25e1a3b83eef969e1ce38c37742fd846465cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 13:37:42 2014 +0000

    Move credit args parsing into rabbit_queue_consumers, to reduce some nasty arities and increase locality.

commit c65a78ddee736dd6fedeffa3de88b3d346b08e19
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 15 13:21:10 2014 +0000

    Undo gratuitous rename.

commit f7431d5f427441aa457cffcd202a25283233f8ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 15 12:47:16 2014 +0000

    eliminate unused var warning

commit 7bb311753307dc77d96bb0b0e8c44de9a49273ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 15 12:15:13 2014 +0000

    drop support for channel.flow{active=false}

commit 3f653824a5dad71af774dcc55b3bfaa989adc5e0
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Jan 14 17:32:18 2014 +0000

    Cosmetic (ish)
    
    Strip extraneous comment lines and remove an unused function.

commit f541e6b0c1cbb888629501ae8bb9c7345c802591
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Jan 14 17:28:10 2014 +0000

    Refactor: reduce the distance to default

commit 0841aecc6986964c701afe323baa7fbdde0880cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 14 15:21:03 2014 +0000

    Treat prefetch=0 the same as basic.qos does - it means infinity not a broken consumer

commit 0678a6538ecd860e5aef6a5baddfd44124b1c00f
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Jan 14 15:17:00 2014 +0000

    Cosmetic (ish)
    
    Spelling, and do not shout in comments.

commit de50e31fb1fa20b5e5cdecd1617617b271ef7c9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 14 14:49:32 2014 +0000

    Rearrange order of function args in ack/reject/requeue for consistency.

commit 4319c2ac9797400324c39ed05db4821751120bb3
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jan 14 18:41:47 2014 +0400

    List alarms in rabbitmqctl status

commit c8160b6dd4b7a3d1a7c58af66bc2599e613f8969
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 14 14:32:53 2014 +0000

    Simplify / make it clearer that we always go through the invariant.

commit dc23dce3c64329ab9a00877ba47be12ed0a1d6ff
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Jan 14 14:15:13 2014 +0000

    Refactor / maintain a clean interface to the backing queue
    
    Instead of passing amqqueue records to BQ:start/1, revert to passing
    queue names and return a list of queue recovery terms ordered
    identically to the given queue names. As a result, we can go back to
    keying recovery data off the unique queue directory (base)name and no
    longer need to track the queue name in the qi. We now also only need
    the queue directory name to lookup recovery terms.
    
    Also update the BQ interface documentation and callbacks/specs.

commit 06e1ba388e8a39295d0b0edc75a965503d25c11a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 13 17:10:45 2014 +0000

    Undo accidental unification

commit 253e8e3aab9f4b134b7f2d8930ad80a9e06b2a59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 13 17:01:02 2014 +0000

    Unbreak basic.reject, basic.nack and basic.recover. Fix up specs.

commit 092c4ce6f11b99ad12044a52ab8ed46589277405
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 13 16:12:39 2014 +0000

    Ignore prefetch in autoack mode.

commit fc549b40576836a381d738d36e98652d58be893b
Merge: 90510a5b8 24392afff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 13 15:32:44 2014 +0000

    Merge in default.

commit c42b9cdcfee2e3cea6d9ae29a864bbfde56d654c
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Jan 13 15:22:59 2014 +0000

    Refactor to avoid O(N*2) lookups during queue recovery
    
    We remove knowledge of queue directories from rabbit_amqqueue, opting
    to key index recovery terms off the amqqueue record name (which is a
    resource record) instead. Although this simplifies the code somewhat
    and avoid a potentially costly lookup during queue initialisation, it
    does require a change to the backing queue API, since we now wish for
    r_amqqueue:recover/0 to iterate over all the queues (paired with their
    recovery terms, if any) and this means passing #amqqueue{} records
    around instead of using a #resource{} and/or directory name as keys.
    
    Also see rabbit_recovery_terms:read/1, which has gained an extra
    parameter, since during upgrades we have no access to #amqqueue{}
    records and /must/ therefore key any upgraded recovery data on the
    queue directory (basename) instead. This double keyed lookup is
    particularly gross since we could look the dirname up ourselves in
    rabbit_recovery_terms:read/1, but doing so avoids the need to export
    queue_name_to_dir_name from the qi _and_ calculating the MD5 on the
    queue’s name twice, since the qi (which is calling into read/2) has
    already done that anyway.

commit 24392affff5e048899e712806e7f70e4540e7604
Merge: fb03f9145 731cce10e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 13 13:35:52 2014 +0000

    Merge bug 25954

commit f4cea4aea45d19284ccbd1500f003fd52366575b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 13 11:23:16 2014 +0000

    cosmetic

commit 8054ea6c4faa3885a1bdfd676720cdeba3b13164
Merge: d28bd218e 731cce10e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 13 10:54:43 2014 +0000

    merge default into bug25827

commit a5042edb4caa3383f5460f34b535d83ca50e5e20
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Sun Jan 12 15:10:59 2014 +0000

    Refactor - remove unused functions/comments/todos

commit a52d9b5eef47ac86551f48640b641ea6cbc68b64
Merge: 15ddd5a5e 731cce10e
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Sun Jan 12 13:02:22 2014 +0000

    Merge default into bug24926

commit 15ddd5a5e6bcee80e0065112fb156fe14112b5f7
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Sun Jan 12 12:38:38 2014 +0000

    Refactor (simplify application stop handling)
    
    The offline plugin handling does a fine job of detecting which apps
    need to be stopped/unloaded when disabling a plugin at runtime. We
    previously had problems accidentally stopping things like stdlib and
    mnesia by accident, but only because we went searching for the app
    dependencies ourselves! Instead, we stop only those applications
    (i.e., plugins) that rabbit_plugins_main has requested. In doing so,
    we remove a considerable amount of (new) digraph hacking from
    app_utils and reduce the complexity of rabbit_boot somewhat.

commit e52fb99e9b38ae2845d51951ac66dd8cb0e32c5d
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Jan 10 23:48:46 2014 +0000

    Handle hard vs. soft boot step dependencies

commit 731cce10eb4e10db0d96c567e2edf1a95bcf3e7d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 18:12:29 2014 +0000

    tiny simplifying refactor

commit a80b21122c9e40bb02f4687d4f7e31f66ee47e63
Merge: f7834aa14 d31640186
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 17:27:32 2014 +0000

    Merge bug25910

commit 8c4feedd9c119240cfe1d24977e3183edde657d7
Merge: 8b397e93f d31640186
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Jan 10 17:07:46 2014 +0000

    Merge default into bug24926
    
    Merge conflicts in rabbit.erl, pertaining to app startup procedure.

commit f7834aa14431400cba3d2f2f1ff6cbc7e94a1e18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 15:17:36 2014 +0000

    Revert changes to add proc_name via gen_server2, instead do it explicitly with a helper macro.

commit d28bd218ef421090d0a91cf778af0c0fe1764bfa
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Jan 10 14:57:25 2014 +0000

    Stop using the full path to the queue directory as the recovery key

commit 7c3f256df2045dbfd1f7e717e467c12a2bcfbc0a
Merge: d31640186 3c9230410
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 14:54:18 2014 +0000

    Merge in default

commit fb03f9145fd1717e4c3622296902af883ba64414
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 14:49:44 2014 +0000

    make draining part of r_limiter:credit
    which makes the contract more obvious and is also more efficient since
    we no longer trawl through all consumers in order to find drainable
    ones.

commit 3c923041050e473a8578f686c8881d3e8a8b9906
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 14:00:36 2014 +0000

    This code can now be invoked in the context of the Erlang client, in which case we are not guaranteed that the env key will be there at all.

commit e47a2844081265fd83451548ad49e252e9e677ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 13:23:50 2014 +0000

    Automatically update process_name on become.

commit a0563673e60e67e139a7f69e5ff9ded5768dd5dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 13:11:35 2014 +0000

    Cosmetic

commit d31640186232bdab187deafdf4885aaae685df66
Merge: 55835a9c5 70b50cf61
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 12:30:25 2014 +0000

    Merge heads

commit 55835a9c58002e762312608479355877a2aba6ee
Merge: 60413cd2a 2185bebde
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 12:28:15 2014 +0000

    Merge bug25817

commit 60413cd2abca9d5369cae6fb13444d6689d6acf6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 10 12:27:10 2014 +0000

    Cosmetic, inline.

commit 70b50cf61708c5294794385a9fd8bda15e3da895
Merge: 0c8434e99 2185bebde
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 12:13:55 2014 +0000

    merge bug25938 into default

commit 0c8434e9963d6f6b05755bf6be1d69baa26626b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 12:05:41 2014 +0000

    revert most of http://hg.rabbitmq.com/rabbitmq-server/rev/5fddc5198854
    since it was wrong. except for the var renaming in r_queue_consumer:add.

commit 2185bebde3722a50499afb612c88b424c32b68e3
Merge: fa264cc57 a7ff2227b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 11:33:16 2014 +0000

    merge stable into default

commit a7ff2227baa6dab919c1529789b771fd8c2e24bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 11:33:04 2014 +0000

    simplify even further

commit fa264cc579d1ab65d81eba07fe1c9ed24e0f8693
Merge: 21f0c4baa 8e99b4b64
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 11:17:42 2014 +0000

    merge stable into default

commit 21f0c4baabb162270791088d07312afaf4b96b5f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 10 11:17:19 2014 +0000

    simplify, remove redundant code

commit f7b5d91bfdb03339f23c90902992a50d00bdd109
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Jan 10 11:54:32 2014 +0100

    fixes broken qpid tests

commit 7ddbff08e14cbc66529a3005df0268b9fcb81b68
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 21:41:10 2014 +0000

    Oops - relocating the recovery file broke our lookup function

commit 308eea3e92576ab2057a4ce9cd67c5a410d37b2e
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 16:53:58 2014 +0000

    Improve the backing queue API module documentation

commit caa4a6a5a50994a317cf7d52992c541907e82c03
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 16:41:45 2014 +0000

    Avoid unnecessary cosmetic changes (reduce the distance to default)

commit 80866d890f55d6ceb2b537e01c28a543df8494df
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 16:39:56 2014 +0000

    We don’t need to ensure the mnesia_dir is present here

commit cc674e2dfc89253c62cbc847a1c4ecce3fd05ddf
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 16:39:19 2014 +0000

    Store the recovery terms directly beneath RABBITMQ_MNESIA_DIR

commit b4c73670dba5499aee4158da9775ff4bfb01e892
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 16:38:19 2014 +0000

    Cosmetic (ish)
    
    - upgrade_recovery_{indexes => terms}
    - improved and consistent parameter names
    - uniform and properly aligned spec attributes
    - better naming convention for queue-dir / key handling

commit 8e99b4b64dc22f807b9f09a294642c734afa1fa3
Merge: ba34b18ab ecbaa181d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 14:49:51 2014 +0000

    Merge bug25938 (again)

commit 90510a5b8fa65650139a75345b55fe86a0259058
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 14:38:48 2014 +0000

    Upon unblocking, unblock, and run message queue.

commit ecbaa181d79d14740ad038a05d9707ddc7bfeba0
Merge: 0ade17719 a099333a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 13:46:25 2014 +0000

    Merge bug25951

commit b033a551918b101b4dfc3d422a0ad32c3501b6ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 13:12:11 2014 +0000

    Verticality

commit ba34b18abb076fcfaef3120970363034256ad411
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 9 13:02:46 2014 +0000

    fix credit handling
    This cannot go via possibly_unblock since that deals with *channels*
    becoming unblocked only, whereas here we care about possibly
    unblocking a consumer on an otherwise unblocked channel.

commit 8b4edbf20fc350575f12ce9ac9c11071f09d2b24
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 9 12:50:22 2014 +0000

    Make sure we're storing the queue dir name not the old clean file name

commit cba3c505f6933469cb3478a932706d76698312b8
Merge: 123093fa3 a099333a6
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 12:29:45 2014 +0000

    Merge default into bug25827

commit 123093fa3c1be7706cfe46681010bddeb67e97c9
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Jan 9 12:23:11 2014 +0000

    Better handling of file system directories during shutdown/recovery
    
    Ensure the ‘queues’ directory exists before attempting to sync the
    recovery terms dets table. Drive qi recovery off the durable queues
    we’re passed, rather than relying on the existence of queue dirs,
    which are created lazily.

commit f807378722d273a0375bbd71e98b566816577cae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 12:17:15 2014 +0000

    More consistent naming

commit a6979c1c49e0cd97c37df215c9c281510ca943c0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 11:56:43 2014 +0000

    Fix various bugs that prevented this form working at all. Also change the "OtherArgs" we pass through to Args (since it's there to be reported, it makes no sense to hide args we have parsed out).

commit 90aede2579804732b07e0ac223b5ebd7833e8f49
Merge: d094617b1 a099333a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 9 11:32:36 2014 +0000

    merge default into bug25938

commit a099333a6db6f2fcb53435b8640818c9d0b6a838
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 9 11:32:08 2014 +0000

    cosmetic

commit d094617b184b34fea32ef61528810f068191f0af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 10:52:30 2014 +0000

    Oops, don't explode in the empty=true drain=false case!

commit 7aa7642d3231e14341f759f64e578075085763b4
Merge: 3c6b98854 2087c70d1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 9 10:35:57 2014 +0000

    Merge in default.

commit 3c6b988542c3e1abebf4128eb528a43e3955bc7c
Merge: 1bec9a9b6 042b68a96
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 9 00:07:00 2014 +0000

    merge stable into default

commit 1bec9a9b613e2a8f9d83a2429e6f6de44c306976
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 9 00:06:35 2014 +0000

    tiny refactor: better function name
    ...and more sensible case order

commit 2087c70d119e8a90faabf1d61438215679d77a6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 18:34:22 2014 +0000

    Add initial support for x-prefetch consumer arg (basically auto-credit). It's faster than basic.qos but not as fast as I would like. Also reject / nack is gratuitously broken.

commit 042b68a966e22ece0cf117b61488916864079bd2
Merge: f4006a696 3d8472465
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 17:53:57 2014 +0000

    merge stable into default

commit f4006a6963c08ec6568f9443e50e6656e3a4cf7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 17:53:41 2014 +0000

    cosmetic: whitespace

commit 0ade17719b27df700f4d600e8248478eee2165fe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 17:09:52 2014 +0000

    extract dead-letter publishing from rabbit_amqqueue_process

commit 3d84724655ef0ca56ba07cf5ef9dbcd296ca04e1
Merge: e0e6620e0 ad0c76b26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 15:46:28 2014 +0000

    Merge bug25948

commit e0e6620e0bd285292efa170b46ea2778c5a068b6
Merge: 13e10b7d3 ad0c76b26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 12:34:04 2014 +0000

    merge default into bug25948

commit b0638c9bf379bbe9aae5a0205b5401a13b5b90dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 12:05:31 2014 +0000

    API tweak for the AMQP client

commit ad0c76b269d7cd5f0796e1e8644beb998cd24ba9
Merge: 6b46162e3 48b9cc0ee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 10:47:52 2014 +0000

    stable to default (noop)

commit 48b9cc0ee47a110483a960857edd4b49ebf31fb8
Merge: 87b610340 3f4fed973
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 10:47:21 2014 +0000

    Merge bug25936

commit 6b46162e339934336cbb673c7a3db45891d723ba
Merge: 3463bdf21 3699370b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 10:45:38 2014 +0000

    Merge bug25937

commit 3463bdf21448821798b154d366c7a19f51aced1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 8 10:36:50 2014 +0000

    Rename this again

commit 13e10b7d36fb77d164f4b4b6744c9ee948c686dc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 09:43:20 2014 +0000

    simpler and more efficient

commit cc5a62e3beab33e4badaff3595e9a696500c21ed
Merge: e06ae86d3 137b40cad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 8 09:42:20 2014 +0000

    merge bug25937 into bug25948
    and largely rewrite it in the process

commit e06ae86d300e26c6665b26989897a4ac0fe353f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 23:51:41 2014 +0000

    simplify

commit 3699370b2d4eff410280393a32d5d5823aad0aff
Merge: b44db9d41 007dac881
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 23:14:08 2014 +0000

    (re)merge bug25942 into default

commit 007dac8819f056bcad409768f922a8bd8ddb83a8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 23:13:45 2014 +0000

    grrr, forgot one

commit b44db9d414e255735af6b408272b4314edb33f12
Merge: 1d184016c 169bf6c7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 23:11:01 2014 +0000

    (re)merge bug25942 into default

commit 169bf6c7b605420ad131089ede674e90c18e906a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 23:10:34 2014 +0000

    it turns out that dialyzer dislikes improper lists
    ...and spits out "Cons will produce an improper list" errors
    *sigh*

commit 12a1bdca454231ad355c63c9773c099ed5909eaf
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Jan 8 00:08:20 2014 +0100

    checks the interceptor returns the right method

commit 574ab9062d6fb85992badee0248ace3dfc0bf65a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 20:54:13 2014 +0000

    simplify rabbit_queue_consumers:deliver even further
    turns out we can ditch another parameter to both that function and the
    FetchFun we pass on.
    
    Also reverted state shrinking in attempt_delivery call site. While it
    is the right thing in principle, I am not convinced the resulting code
    is actually easier to grok.

commit 246d0e802b50214ea3bf6a2e53aab417717a8c9d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 20:31:06 2014 +0000

    better helper

commit 2ae6dac565820db7df2b98f5dbf0acaf84b191ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 20:23:14 2014 +0000

    keep State out of one of the FetchFuns
    This is cleaner.

commit 3f40a98fe1dcf62a875499fb258f7284c63468e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 7 20:08:22 2014 +0000

    make rabbit_queue_consumers:deliver deliver at most one message
    ...which makes the control flow more obvious

commit 2c1e9c6630acd0f6896d523bd397c6e162e480f5
Merge: 30225096f 1d184016c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 16:57:22 2014 +0000

    Merge in default

commit 1d184016c7f65e921c2a35cc9b277d40b0b461e5
Merge: 4209365b5 9346d202c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 16:30:47 2014 +0000

    Merge bug25935

commit 9346d202c6fb15992fd87d44a0318cf85caff752
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 16:04:18 2014 +0000

    Accept this from federation.

commit 59193ac193fb72b6d1a22d2f943f15de35de9ab9
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Jan 7 16:51:39 2014 +0100

    expand_shortcuts clean up

commit 373d51007ef017f48c42cbdf6de27a68cde9390d
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Jan 7 16:28:47 2014 +0100

    renames handle_expand_shortcuts to expand_shortcuts

commit 4209365b5ec4b7a9efe6a26b40ab80c47f02f4fb
Merge: 53434e868 3f4fed973
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 14:22:27 2014 +0000

    stable to default

commit 3f4fed9733cbd87c339ea8b01b3682a3cdedd8bf
Merge: 089ee7eb5 5f6d22c26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 14:21:50 2014 +0000

    Merge bug25945 again

commit 5f6d22c26a1720532b3e0d1a43da6466e69d87e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 14:21:27 2014 +0000

    Uh, that function needs another header

commit 87b6103404d6868f841027fc819ada99c7d1951a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 13:52:59 2014 +0000

    consumers/1 returns a list of 4-tuples now.

commit 137b40cad669bff50a8508f3fe61fae3e9be1187
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 13:16:58 2014 +0000

    Even clearer?

commit 65e5cc1a5f6debd0d5ed89734131d25e8accf78b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 13:11:14 2014 +0000

    Maybe this is clearer?

commit 0984a13df722a3546e4694f657c3b2a5cc9eefa8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 13:05:37 2014 +0000

    Simplify further, don't use a proplist

commit ab21c6474f680a1a90cf0906fbfcbc7a932b369b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 12:58:25 2014 +0000

    Simplfy (although perhaps not as much as we had hoped) by only informing queue decorators when the active consumers may have changed, rather than trying to give them more information about what is happening.

commit 53434e868baaad58076cd4d2b899a3a9f262d754
Merge: 6d47b7016 c2bd02f50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 12:35:52 2014 +0000

    Merge bug25938

commit c2bd02f507ffbfbb55b138753c2bb5839ae16e0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 12:32:41 2014 +0000

    Multi-heads

commit c1a592baafe49c22f4dea021a6abf406bb9ad50c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 12:06:33 2014 +0000

    Fix handling of credit arriving with drain=true and an empty queue - we need to not really add the credit (since it is "used up" immediately and thus not unblock if needed).

commit cd26dc92cdeb002b71f6c9e0d43aed449004be9a
Merge: 801e91764 6d47b7016
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 11:29:33 2014 +0000

    Merge in default

commit 6d47b7016c44b9c235ab110af19f5506d3c8fc10
Merge: 089ee7eb5 cde6c63c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 11:20:47 2014 +0000

    Stable to default

commit 089ee7eb5d70ab867e892dab4312b36eb2c1e6db
Merge: 10aec532d df61129d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 11:20:36 2014 +0000

    Merge bug25945

commit 10aec532ddb744e1576d3ef6b1a5af4810cd5efb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 11:17:33 2014 +0000

    Notify on channel down.

commit cde6c63c53dcd6d78adf516810a6e425c98186a0
Merge: 2455a378e 55dd809cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 7 10:23:41 2014 +0000

    Merge bug 25943

commit 801e917644cd577db8b5ab5e612a5483e223795e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 6 19:18:33 2014 +0000

    move consumer_use calculations into rabbit_queue_consumers

commit 45b1c46a06eb92ac6bff8ca536a30706c7d345ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 6 16:54:08 2014 +0000

    refactor: prepare for more state

commit 2455a378e5554e18ac11f7041aee7156b69a15a2
Merge: fb3ac9a44 f53fb385b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 16:36:05 2014 +0000

    Merge bug25939

commit fb3ac9a44e295ca5731c8a09279aa834f47ac80e
Merge: faeb544f2 cfe67ed47
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 16:30:31 2014 +0000

    Merge bug 25942

commit f53fb385bfdaa1b986e86d17594b517300ded7c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 16:21:16 2014 +0000

    Simplify binlist_split from /4 to /3.

commit cfe67ed478d2096d203dc093e603fbcf1fe4bfda
Merge: e4d615a41 df61129d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 13:47:42 2014 +0000

    stable to default

commit df61129d41af4c90645e7f3153060bb25feb2f5c
Merge: 8e2b7f2c2 71435519e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 13:47:28 2014 +0000

    Merge bug25928 again

commit 71435519eea1139d363ed0b403eb3346e4f779ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 6 13:47:15 2014 +0000

    Revert the changes to the error thrown.

commit 0dfb3dae8fcf1b90f3d1382b3b6323a62256a035
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Jan 3 16:54:37 2014 +0100

    passes the right argument type to rabbit_channel_interceptor:select/1

commit 55dd809ccd105b6a3a5402ec2ce30b912bd4afe7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 3 11:12:53 2014 +0000

    cosmetic

commit a152349b0d560c98a7d0402ffb01b9720f25f0e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 3 11:12:10 2014 +0000

    lift buffer vars from state
    
    This improves performance by reducing state update and also makes it
    clear that these vars are only updated in the two loop functions.

commit 1c00688e155ea5e1aa8ea3af68f67d8d4ef90f12
Merge: 8e2b7f2c2 d07f86c9b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 3 11:02:41 2014 +0000

    merge bug25939 into bug25943

commit 0186d763494044dfeb436ae3f4ff88f85996dbc0
Merge: be7748479 e4d615a41
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Jan 3 10:32:19 2014 +0100

    merge default into bug25817

commit d07f86c9ba0eacab62833877a568195e1f3831c1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 2 21:39:19 2014 +0000

    become 1.0 with the correct state

commit bdcce61b945df2b095f7e0cca17d3633fdeebdf6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 2 19:36:09 2014 +0000

    eliminate unnecessary state modification
    amazingly this actually yields a few % performance improvement

commit faeb544f2e71828daa73a70509b5813efd3f89d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 2 15:48:36 2014 +0000

    some small codec optimisations
    - encode and decode field types as characters rather than strings
    - construct shallower iolists by cons'ing instead of appending
    - avoid construction of intermediate binary for tables and arrays

commit 82edc6c3f97367a3a11103510800ed771800707f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 2 00:04:40 2014 +0000

    further optimise frame reading
    
    Handle complete frames in one go, if possible, rather than header and
    payload separately. This essentially halves the amount of binary
    splitting in the framing code.
    
    Note that we only do this when the buffer contains just one
    binary. Tests have shown that attempting to introduce this
    optimisation when the buffer comprises multiple binaries hurts
    performance for large messages. That's presumably because we end up
    constructing larger intermediate binaries.

commit 4a6ebfd2fda6dbdbcdcde5e797b98cb688c55a1b
Merge: 8e2b7f2c2 65d820335
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 1 20:17:36 2014 +0000

    merge stable into bug25939

commit e4d615a414a4816cf33aff1e97720052f3eb866f
Merge: 8e2b7f2c2 a8c96b3ba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 1 19:42:35 2014 +0000

    merge stable into default

commit 8e2b7f2c2e90fdd294b0863501b1c4eedfe58946
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 1 19:41:35 2014 +0000

    simplify

commit a8c01d8f7a30b01b932e35f8987e14587cf947ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 1 19:36:35 2014 +0000

    small refactor: simplify AMQP version negotiation a little bit

commit 9a59807171653acf0f4792f0c01a702bfeb35c16
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 1 19:26:30 2014 +0000

    correct typo in comment
    This was introduced in http://hg.rabbitmq.com/rabbitmq-server/rev/4852382b462b

commit 7510115f60ebe1ccb77090b0e4d1f4e2321d1382
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Dec 31 14:16:47 2013 +0000

    Scrub un-used code and introduce a lookup-by-recovery-key API

commit 65d820335306e9e6a0b4593309f6ab6f94b59841
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 27 19:26:01 2013 +0000

    refactor: better var names

commit ad75ad01948b3f93333f35f6e287dc90b4f9f507
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 27 18:58:37 2013 +0000

    restore short message performance
    it turns out that short message performance had actually gotten worse,
    but this was masked by the scheduler.

commit e086fc1d6b8fce678a9263abec89e8c8da4d92ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 25 11:47:47 2013 +0000

    more efficient data splitting in reader

commit 99ff4f69085053f9c5f2e043f28f4a5436e6528c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 13:05:00 2013 +0000

    refactor: better var name
    DeliverFun wasn't deliverying anything. It was just getting hold of a
    message *to* deliver. -> FetchFun

commit 1741bbd334a2fb826ed2c2e2c1c63b004a4523bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 12:59:05 2013 +0000

    specs

commit 143554f993ba5b148aa732cd0fe4d53ab908c8cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 10:39:46 2013 +0000

    refactor: re-order and re-name

commit f84aeaaf056e01b92846c4dba0e59587653311c5
Merge: a8c96b3ba fc9376777
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 08:49:56 2013 +0000

    merge default into bug25938

commit a8c96b3ba35314387e543a8de6d9f53d38b63d09
Merge: c1eb91f30 8e98fa3d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 08:38:36 2013 +0000

    merge stable into default

commit 8e98fa3d5af09d5efe859c0f60930068d6466835
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 08:34:56 2013 +0000

    refactor: inline

commit fc937677757e4fcf2a3ad0d8851282ba4f290d24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 00:57:53 2013 +0000

    reduce distance to default
    this got lost in the merge

commit d070eed911fe67b5cae760c5f3478a24082aa5ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 00:54:43 2013 +0000

    cosmetic

commit 63cf4c1e42a4042d45b78d0b7d08a03c74c83983
Merge: 6aac57a4c c1eb91f30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 00:49:52 2013 +0000

    merge default into bug25938

commit c1eb91f30cb3d67af89d825e1dd74b2941ba2d0a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 24 00:39:35 2013 +0000

    refactor: introduce helper to simplify update_consumer_use call sites

commit 6aac57a4cdc4cd88c2931b6d3d7debaa702e43a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 23:29:24 2013 +0000

    oops

commit d8049e9d5b93d513ea458a8720425d63744bf07d
Merge: a69954357 914f214e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 23:24:29 2013 +0000

    merge stable into default

commit a69954357bdfec1367de17c201757e90e0c62d60
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 21:52:36 2013 +0000

    various simplifying refactors
    these are actually all quite trivial; the diffs are large mainly due
    to whitspace and renames

commit aad3ae051270e14e580fba3de5e16e9263439cdf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 21:44:13 2013 +0000

    tiny refactors

commit 83d30ed75c9f5e79dd6cdfef02d671075f508a85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 21:41:09 2013 +0000

    cosmetic, largely whitespace

commit 00ed34bc626f7135fe90a5e30754269da3f3e69f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 20:26:10 2013 +0000

    cosmetic

commit 8e4a15d5ba40deeb1f138e657b342b48e35548bb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 23 17:09:41 2013 +0000

    extract all channel and consumer related queue functionality
    
    design decisions:
    
    - all limiter interactions take place in the new module. The
      alternative would turn into spaghetti and leave more code in
      amqqueue_process.
    
    - asynchronous channel interactions - namely delivery of messages and
      'drained' events - happens in the new module whereas all other
      operations - really just sending of replies - takes place in
      amqqueue_process. I'm still in two minds about that. It would
      actually be simpler to have the rabbit_channel:deliver code in
      amqqueue_process, albeit in an existing closure, but send_drained is
      rather deeply embedded.
    
    - we need a few functions in the API that manipulate the channel
      record. They all require the same kind of post-processing to invoke
      decorators, run the message queue, etc. I decided to make this
      pattern explicit in the API by having just one function there -
      queue_consumers:possibly_unblock - that takes a closure. It has just
      one call site - amqqueue_process:possibly_unblock - that contains
      the post-processing logic. The closures are constructed by four
      separate API functions.
    
    There are a few complications...
    
    1) event emission and decorator notifications
    
    These are deeply embedded in some places and need to be lifted out so
    they are all in the one logical place where they belong, namely
    amqqueue_process. In some cases this complicates the API and code a
    fair bit since we, e.g., need to collate information for subsequent
    decorator notification. This is doubly annoying since the existing
    decorators don't actually make use of that information, so we should
    really consider simplifying the decorator API.
    
    2) message delivery logic
    
    This is a fairly complex piece of code and it gets more complicated
    still because a) of the above, and b) sending a message to a channel
    requires the queue name, so we need to pass that in. We also need the
    state, and indeed modify it, though this is done opaquely. And it
    looks like we could just pass BQ & BQS instead.
    
    3) handle_cast/credit
    
    I reckon this should have been implemented with possibly_unblock. It
    is now. The behaviour isn't obviously equivalent, so this needs
    careful consideration. The old code would invoke 'unblock' when "(not
    Drain or Len /= 0) and updated channel record is not blocked". By
    contrast, the possibly_unblock logic, which is what the new code
    invokes, invokes 'unblock' when the old channel record is blocked and
    the updated channel record is unblocked. This would seem to be
    logical, and it would be weird indeed if the credit code relied on any
    different behaviour.
    
    4) queue_consumer:add is a nine-arg function. urgh. Mind you, so is
    the handle_call/basic_consume message.
    
    There are some minimal refactors and cosmetic changes which should go
    straight onto 'default' and thus reduce the distance to changes in
    this bug.

commit b74ce00920bc9f8165fd3d493f4ae88c81be2d38
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Dec 20 13:43:16 2013 +0000

    Trap exits and ensure we close the table on shutdown

commit be7748479a93e180511477eec8360dd9c6598276
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Dec 19 23:38:14 2013 +0100

    basic.publish performance degrades if called with intercept_method
    
    ./runjava.sh com.rabbitmq.examples.PerfTest -y0 yields around 75k msgs/sec
    
    without this change it yields 62k msgs/sec max
    
    and that’s without any interceptor registered

commit f59e3eb920d82dc52cb3f467dabb2e418bc45f5e
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Dec 19 23:32:52 2013 +0100

    fixes handle_expand_shortcuts

commit dd6f5a53b014dbf6b1fb1090c55827f7cdc9eeac
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Dec 19 23:19:08 2013 +0100

    refactors intercept_method error handling

commit 67adf2465cbf852317fd6ade0c0d6892bd1a1850
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Dec 19 22:18:57 2013 +0000

    push down recovery index handling into qi recovery

commit 6e505050521c1f361ef7339c65f586b324c84509
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Dec 19 12:39:20 2013 +0000

    Tidy of specs and further re-working of tests

commit 914f214e95f93f44063f3590fea636b873e8050b
Merge: c477cc038 cd079cd7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 19 12:12:55 2013 +0000

    stable to default

commit cd079cd7aa5a78ab4782d79eefa622296a9eb692
Merge: 861ab0922 d8f0de1b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 19 12:12:32 2013 +0000

    Merge bug25928

commit d8f0de1b1d49b95f3aa28f743c8a13f86a3201c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 19 12:10:21 2013 +0000

    Keep the two handle_exception()s together.

commit c477cc0389a86d6405b992ef3b60970ad5eae771
Merge: 861ab0922 475e1bb50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 19 11:40:36 2013 +0000

    stable to default

commit 861ab0922be69f7394dd7b94651e53502df315c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 19 11:40:27 2013 +0000

    Scarier warning

commit cbb9c58daa773ab765c57d99ae0974174c12351d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Dec 19 11:35:33 2013 +0000

    Adjust vq tests to the changed API

commit 156fda04395ae9e853205cbe5f5d3ffa9c186709
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Dec 19 10:19:44 2013 +0000

    Rework/Refactor to handle recovery terms up-front
    
    We process all the recovery terms up-front, during qi recovery, and
    clear + sync the dets table immediately afterwards. The recovery terms
    and keys, based on the queue directory’s ‘basename’, are then passed
    throughout the initialisation process and checked in the various
    places they’re used.

commit 2c685640a362ed8e06e728ea2c16b813086d1aa0
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Dec 18 19:22:38 2013 +0100

    handle interceptor exceptions at the channel level.

commit 799eb05f0ab41fd1edd4e38531ea93f2b87db55f
Merge: 475e1bb50 7f868c910
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Dec 18 13:19:40 2013 +0100

    merge default into bug25817

commit 7f868c910b1f1815616bd89c6d7c7456598027fe
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Dec 18 13:17:37 2013 +0100

    refactors channel interceptor

commit 30225096fee903c63b6083bcb96d895a78705ea7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 18 11:58:19 2013 +0000

    Document

commit 45817870930aff31097fce5c9801e50199c0faa0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 18 11:18:42 2013 +0000

    Rename the module too

commit 81eea71bbeca2d0a320e686534095175feba7dc0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 18 11:17:48 2013 +0000

    Refactor: rabbit_recovery_indexes => rabbit_recovery_terms

commit 2debc45865fcbb4c37847eeb9f510868988effd4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Dec 17 17:34:18 2013 +0000

    Ensure old clean.dot files are removed during recovery
    
    We also ignore the .dets index file whilst processing the old shutdown
    term files, since the names no longer match. If file deletion fails, we
    log the filename and posix error.

commit ed96d17433b5ca3c9add19c91117ae1648072e9a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Dec 17 16:57:52 2013 +0000

    Rename the recovery index file
    
    We've decided on "recovery.dets" instead of "clean.dot" - remove the
    CLEAN_FILENAME macro since the terms are only used in one place.

commit 421ce43b4588d2902dcff3e79ef0cd37082958f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 17 15:42:06 2013 +0000

    Treat connection errors on write the same as on read.

commit c00442b82bd636a8fff0242db0963837c7faa177
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Mon Dec 16 19:06:05 2013 +0100

    moves the expand_* functinos to happen before handle_method

commit 8b397e93f589e6c57182b76e941cc02274656885
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Dec 16 16:06:12 2013 +0000

    Tidy/Refactor boot step handling
    
    Simplify the boot step loading/application code and switch from using
    a discrete rabbit_cleanup_step module attribute; We now search the
    regular boot steps directly for ‘cleanup’ entries.

commit c980a814de40c464fae76efb783f5bba0a6003d2
Merge: b4fe9f500 475e1bb50
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Dec 16 12:34:13 2013 +0000

    merge default into bug25827

commit 475e1bb50be8f3f756bc0df5677691b1ee1fe31c
Merge: 80bab3993 695445755
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 16 10:22:35 2013 +0000

    Merged stable into default

commit 6954457553913500a7674d581bd2a62ff581283b
Merge: 1d86bb10e 6a9df7eed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 16 10:21:58 2013 +0000

    Merged bug25925 into stable

commit 1d86bb10e23c658127f450b34c86af3d8412c36e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 13 16:13:47 2013 +0000

    Strip extra parameter when installing service

commit 80bab399342bd8c00f5ea0c7047890c873b868fe
Merge: c6579be6f ba77d893a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 12 17:40:54 2013 +0000

    Merge bug22525

commit ba77d893a77e7e9311d62b7f17c28eb42f3a8c13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 12 17:40:41 2013 +0000

    Fix type

commit fc54c63b1746f904f9a98aaf74ee6baa42cccdb3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 12 16:35:51 2013 +0000

    Simplify

commit c6579be6fd71de1db80511e95a9ec80a0a721183
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 15:16:40 2013 +0000

    maintain consistency of process dict channel entries
    (just as we used to)

commit ba27272b077f24c4ba3553fbe57ceb40b58d255b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:52:57 2013 +0000

    correct another return

commit d59b178941c58619e487e252f8174f6884957a6c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:50:55 2013 +0000

    cosmetic

commit dd6f527c8fb75a7ce0294998f29a9afb267baf48
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:45:34 2013 +0000

    refactor: take advantage of channel_count to simplify maybe_close

commit 0b487c1c3301c2ba801e2ef13d88dd533e8ec111
Merge: bbc050e78 3fffd4b42
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:42:19 2013 +0000

    merge heads

commit bbc050e7877d06861f2af7b56cfe756780d57a54
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:42:05 2013 +0000

    refactor: take advantage of channel_count to simplify terminate_channels

commit 3fffd4b420de79100b5b92b926764532db52613e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 16:35:34 2013 +0400

    channel_count is initialized in start_connection
    
    which is invoked as soon as we get a valid handshake

commit c9ce44150b1e787c041e33b21cba2ea968facc4c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:35:04 2013 +0000

    refactor: remove superfluous code

commit c0f3d6ff29d700da173ee17d2487ad8f25a01780
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:34:39 2013 +0000

    refactor: two heads are better than one

commit ed837f80b9188234d2e1b466b66acc2fb3a55545
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:28:40 2013 +0000

    correct return value

commit e82494447e900485b673a0a2ded12d080d964839
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:17:51 2013 +0000

    refactor: simplify and reduce distance to 'default'

commit 6a861b01259c556e61f44fd4522453d3c227384d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:14:23 2013 +0000

    refactor: simplify & consistency

commit 0cbe22c51d63e305fb4e8a3eb5e4ff157c7f9eef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:09:29 2013 +0000

    cosmetic: correct spacing, eliminate spurious diff to default

commit f6565baabee42c64ea585047a7421ed837827e99
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:07:01 2013 +0000

    simplify (and stay below column limit)

commit 6dca0e6a6169eb346dcf6bf25fbf29aa5a48dc65
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:02:32 2013 +0000

    correctly thread through the state

commit 30cbee1ec392dac0749ddab8b8b472b2ab192c5a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 12:01:15 2013 +0000

    correct handling of channel_cleanup return value
    plus some cosmetics in the area

commit 808120d5aac49dd26cc67168313f4903e7fadd3e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 11:57:16 2013 +0000

    refactor: simplify and reduce distance to 'default'

commit 12c1faf6b58fd9b51ff51c4ed26e2472ed6d2803
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 12 11:53:40 2013 +0000

    cosmetic: consistent field ordering (with start_connection code)

commit 3a46ecff17a708bb144447e1ee087d76d257a7a8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 15:43:27 2013 +0400

    If channel pid is not in the process dict, don't decrement channel_count

commit f9b06b44acebf15b6726f9a17d0137178310a3d1
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 15:10:36 2013 +0400

    Decrement channel_count in channel_cleanup

commit c2801fded13614c1358699fc4d7dceb02ace9f5f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 14:09:30 2013 +0400

    Nuke some unnecessary code

commit 6b680104a035d47bb20b4dc9fa39ce965583d130
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 13:35:35 2013 +0400

    Init channel_count correctly

commit 1699f506fbb422417fe752316a77b51e83fdebdf
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 13:03:21 2013 +0400

    Compile

commit 9f23f517d3d0a377a9e6c7d0c875d6d41e8ba636
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 13:01:55 2013 +0400

    Decrement channel counter here, too

commit d3b1edbc7880d4e0aca6b222615ef6bc97eaa516
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 12:59:06 2013 +0400

    Rename ChState back to AState
    
    for assembler state.

commit 5775931e54d56f5285faeafd4050423409b1cccd
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 12:58:43 2013 +0400

    Decrement channel counter when handling channel.close

commit b4755059dd271fd7e4c4501425dca1150a5e0d5f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 12 12:57:56 2013 +0400

    Move channel_count to top-level reader state record

commit f820e6649b6407bb6d2ec39eb1b260901e990b73
Merge: 8856091b8 6a9df7eed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 11 16:09:53 2013 +0000

    Merged stable into default

commit b4fe9f5003220b459abe16f1566d2ea5cb80440a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 11 15:49:50 2013 +0000

    Add upgrade path for recovery indexes

commit 5bfde2116ad9f0e5e537058eaba6bb73cf38d817
Merge: 66f86dcbf 02b599d2a
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Dec 11 15:38:57 2013 +0000

    merge default into bug25817

commit 6a9df7eed2e04c153b2177d3aa900b127499ea91
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 11 14:44:00 2013 +0000

    Added tag rabbitmq_v3_2_2 for changeset d3f84b20c376

commit 27fdf603ba44760195277bc32bcd475db5eb107b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 11 14:41:30 2013 +0000

    Add changelog entries for 3.2.2

commit 9da02f6e74c3cc5c1d91559b86969cc26bf55fc8
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Wed Dec 11 14:13:26 2013 +0000

    Further refactoring
    
    Inline check_clean_shutdown for improved clarity, move index table
    recovery up into rabbit:recover/0, fix/update recovery index specs.

commit 0a93735b7e860f14fc9a31219468ac565c6d0441
Merge: 8856091b8 93c296971
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 11 13:50:55 2013 +0000

    Merge in default

commit 93c296971b70835cdc8b49ad975f4a57c1328f2f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Dec 11 15:47:52 2013 +0400

    Track # of open channels with a counter in connection state

commit 8856091b8230dd12c06f5453bee940f0d7b4aca9
Merge: 60099f7c0 02b599d2a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 17:28:01 2013 +0000

    Merge bug25922

commit 60099f7c051c608a203d80b46b0e2bbc4af29d78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 16:33:40 2013 +0000

    Log nodedown_reason.

commit 02b599d2a01c8a756cbe67d8318d3db7b94890bf
Merge: bb74a8e22 e5c6081fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 14:30:02 2013 +0000

    Merge bug24829

commit 68889272e0d87742060e886a5fbdede8c4b64a77
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Dec 10 14:22:57 2013 +0000

    Handle recovery index startup errors cleanly

commit 744591f820f56cf13a6d478160c5b6dca4e5ab64
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Dec 10 13:53:55 2013 +0000

    Minor refactoring
    
    read_recovery_terms hides unused keys, better name for clean shutdown
    checking and comment explaining why recovery_indexes is a gen_server.

commit 66b5be1ac35b9b2f57553d7d5fba16f32517b16c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 12:42:03 2013 +0000

    Add queue_coordinator / queue_syncer / gm. Shift to getting gen_server2 to store the name in most cases.

commit adee130e6ea34f86421dd34d1ae902de6c64221a
Merge: 8623d3964 e5c6081fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 12:03:22 2013 +0000

    Merge in default

commit 8623d3964f6d5b3a8891e05bed88f534963a1c90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 11:47:12 2013 +0000

    Rename

commit f934268059d3adadf5becfff8ea66ccdc0c8e523
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 10 11:34:29 2013 +0000

    A bit more abstraction, plus identities for heartbeater /
    queue_collector / limiter.

commit 022e5fd2d2c1a2b555a640d0bd0de4ec1595cfce
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Dec 9 14:21:42 2013 +0000

    Reduce distance to default (again)

commit 4c91cb6320895ec3cd33ed3ddbfa724e11a1ae07
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Dec 9 14:19:52 2013 +0000

    Track queue index recovery data using dets
    
    We now hold a single dets table with all the queue recovery data.
    This is synchronised after we've started up (at which point all
    recovery data should be deleted) and just before shutting down,
    after the queue indexes have writen their recovery data to it.

commit e5c6081fc2a6bdbecbb74c45b0e3220b0ed97fa7
Merge: 72310eb23 4f8ce9027
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 18:06:41 2013 +0000

    stable to default

commit 3e5f358ee33807ad153b1cb0cb61978de82b3494
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 17:56:48 2013 +0000

    Oops

commit 72310eb23070e1417fd808a7cb47302eb27decfb
Merge: 099661209 fadc9f333
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 17:18:26 2013 +0000

    stable to default

commit 4f8ce9027cc4a41971f745e648fc8e2288bd5edc
Merge: fadc9f333 3f48840af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 17:18:12 2013 +0000

    Merge bug25899

commit 9abeb0c74354c440ae6a8406cc84ac5357ddd5c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 16:25:42 2013 +0000

    Store connection name in server writers (but not Erlang client ones)

commit fadc9f333a6223077068acda0a35c3bd7570e062
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 6 12:50:28 2013 +0000

    Remove unnecessary test.

commit bc424015aaa9f7bd78410808d02e0eb14e06bec9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 6 12:31:22 2013 +0000

    Undo some changes.

commit bb74a8e228cc973bae418e503c8e516028164682
Merge: 099661209 c1a73fed1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 11:33:28 2013 +0000

    Merge in default (noop)

commit 0996612099bcc06235a0d1ab02abd7e91c11d2c4
Merge: 160092e8e 3f48840af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 11:32:21 2013 +0000

    stable to default

commit 3f48840af18cd67cdf5888e6eaa827a537502840
Merge: f5c931f21 0d52fabc5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 11:32:03 2013 +0000

    Merge bug25912

commit f5c931f21a9d04f89443d7f49949ad5b4132cd88
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 6 11:31:32 2013 +0000

    Explain

commit c1a73fed1088a84abe61b0003bc2f4e466a2c3cc
Merge: a8a0dfe74 43f8b1073
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 18:30:57 2013 +0000

    Merge in bug25912

commit 43f8b10733a55e81a43ccb2a2ff932db6e732630
Merge: 2e2d170fa 160092e8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 18:29:19 2013 +0000

    merge in default

commit a8a0dfe74fab4bbf0850abd771496f70336fd6ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 18:23:11 2013 +0000

    Make sure that our last event before going sorta-idle is not one in which we claim to be in flow control.

commit 160092e8eab3b9e7eca59cf9ce30ca9f25fc1d5b
Merge: 9e4a5706a 83fc59eae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 16:01:35 2013 +0000

    Merge bug22525

commit 9e4a5706ab1abfdce9f2e3b84de4d17d5d4aef17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 15:50:33 2013 +0000

    Clarify

commit e8ef273acb72c54ca11c16f1de49178f0956bd95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 5 15:33:49 2013 +0000

    Store some process identity in the process dictionary.

commit c6e9e35f5f511f94db6d026dd309845ed2e1f8a2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 5 14:39:16 2013 +0000

    refactor for clarity

commit 6fa11245b95f5190366e012e4a8823dd33a23187
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 5 14:32:57 2013 +0000

    cosmetic

commit 794950f70e3207fd7ea8a80d65e1a43152f1f230
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 5 14:28:00 2013 +0000

    cosmetic

commit cb09e46dd8eeb798d65d953702c8a22b92cb47cd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 5 14:27:08 2013 +0000

    better

commit fd4531cd514ce54af8d3951606617f9bf165a727
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 5 16:59:09 2013 +0400

    Add channel_max to rabbitmqctl(1)

commit bc7493846ec641166d5f690bb672eddb168dbbd5
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Dec 5 16:58:05 2013 +0400

    Disambiguate return values

commit 1c9568d77a37df64356da48dcb9d6d7f6e69c13b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Dec 4 17:22:22 2013 +0000

    Rather than just querying a single remote node, query them all, and accomodate remote nodes that might be running older versions than ourselves, provided we can find someone who is running the same as us.
    
    I did try just limiting Nodes to Nodes with the rabbit process running on them. That seemed to break the tests, and trying to figure out why by looking at rabbit_mnesia made me want to slit my wrists and other body parts. Thus I wrote more code instead.

commit fbd5e5b95ccc256d86f969cc976f57a8abff7eb1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 4 14:58:48 2013 +0000

    Cosmetic

commit 83fc59eae51889459dd53b5e4ebcff62e7bbb1c3
Merge: 0d52fabc5 600da2a34
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 3 17:14:55 2013 +0000

    stable to default

commit 0d52fabc51c172076ed3e6005881130e03782418
Merge: 3fae90992 42ad70942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 3 17:14:42 2013 +0000

    Merge bug25901

commit 2e2d170fa382c0eea224e4e7c7bbd74f4451dcaa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 2 14:57:08 2013 +0000

    Announce credit flow state for channels and queues.

commit af6926d4371aedfc892a317392935ca6d92c7e0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 2 13:46:22 2013 +0000

    Move determination of flow-ness into the server.

commit 992c1aad364834e8fb98b46e146e352de415298e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Dec 2 12:46:15 2013 +0400

    Indicate channel creation errors via returned value

commit a6bf74be373657f003d551e146684bb5f6d29abe
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Dec 2 11:38:26 2013 +0400

    Make this message fit in 80 chars

commit 716972dc2872aa858922c02abce74aed09136c04
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 16:14:40 2013 +0400

    Formatting

commit 2872eb25695a35d4f767255cf32fa73eb67354e7
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 15:51:58 2013 +0400

    Cosmetics

commit de9628f18732de3faf3c197b9896fc0096ff663f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 15:49:48 2013 +0400

    Missing fn head for channel_max

commit a23fba9e76234d00fd51002d7253f7069736cbec
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 14:27:00 2013 +0400

    Add channel_max to info keys

commit 6ec91e29092944196159c0f64d4acfa70e2abec1
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 12:51:46 2013 +0400

    Narrow down try .. catch here

commit 193e12b86a8ea4d8903371a92649a1437b2fac12
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 12:49:34 2013 +0400

    Use rabbit_misc:protocol_error and catch exits

commit b27bb04b250e1a921e6975b102c7e86ab8115701
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 12:45:18 2013 +0400

    We don't know what method caused the problem, so specify it as 'none'

commit 0a4519531c573db43efdf6123634842c40cef3e8
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Nov 29 12:44:54 2013 +0400

    Fix off-by-1 issue

commit 3fae9099235e12a5aba7bbdd78d11606fe3767f6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 28 17:20:56 2013 +0000

    Ooops.

commit 584e30e1612b797edc70a9a2e74f408a24e004ef
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 28 16:51:15 2013 +0000

    Introduce halt_on_upgrade_failure app env param and set it to true. Only throw an error instead of halting if it has been set to false.

commit 600da2a3419ab92a1a584f6d29faf835d7239988
Merge: 6472f3c07 42ad70942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 28 14:47:30 2013 +0000

    stable to default

commit 42ad709421ed9dbfc231d19144bab8ae70301380
Merge: f9b863a68 9b8cf840c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 28 14:47:10 2013 +0000

    Merge bug25897

commit f9b863a683311026b717c11b9983396a1fb0c446
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 28 14:13:16 2013 +0000

    Ensure that we always interleave start / stop / start / stop.

commit 18610063d068a39fd58f0335bd7863b8d2c639e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 28 11:20:09 2013 +0000

    Do nothing if the rabbit application is already running. Similarly, don't explode if the boot marker is there, just do nothing.

commit a047d93c78916776978fc5365f3d81095973424a
Merge: 04988dd32 5edf4f188
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Nov 28 14:56:43 2013 +0400

    Automated merge with ssh://rabbit-hg.eng.vmware.com/rabbitmq-server

commit 04988dd32e9aeec7342243bf8ee5d114f4384679
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Nov 28 14:55:17 2013 +0400

    Reject channel.open when the total number of open channel goes above channel_max

commit 5edf4f18814da9f3a181fad22df6a1216165513a
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Nov 28 01:29:27 2013 +0400

    Update config example

commit 320126490654e585255f0e4442f280cb89b232d6
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Nov 27 18:00:13 2013 +0400

    Reject channel.open method with channel number > negotiated channel_max

commit 87a5ab558320df7d12ac84677ce46c6a80a2985e
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Nov 27 14:01:05 2013 +0400

    Set CHANNEL_MIN to 1

commit fd3b8c9445b734b93393d7300bf58c0cb18e474f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 19:16:56 2013 +0000

    cosmetic: reduce vertical space and distance to default

commit 01aa550a0d1c3d42090c3836825cd88dd61e8b13
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 19:16:26 2013 +0000

    refactor: consistent order of handling configurable params

commit 129871a6ceabc41d18603e1b3ba67034abf45f6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 18:45:24 2013 +0000

    refactor: make handling of server config values more generic
    and shrink the code as a result

commit 88589c3fa786b71fabff81e787f19dea9b1e1452
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 18:37:36 2013 +0000

    (really) don't use ~p unnecessarily

commit 4c226a1bde431ce3b0da6c6d09d823b37e01de08
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 18:37:05 2013 +0000

    refactor
    - more sensible order of arguments
    - less vertical space

commit a00a34b1e37f9f1796413fe5e9fbb3fc353cade5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 26 18:31:32 2013 +0000

    various fixes and refactors
    - replace two 'case's with one
    - the opposite of 'lower' is not 'greater' but 'higher'
    - eliminate unnecessary intermediate var
    - use rabbit_misc:protocol_error/4 instead of
      rabbit_misc:protocol_error/1 + rabbit_misc:amqp_error/4
    - don't use ~p unnecessarily

commit c4cd76dcd462b64458fc25889d3a7a0b554d3d22
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 22:09:19 2013 +0400

    Eliminate warnings

commit 49c99e6e683dc312a30c9997196c458a1a637d3b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 26 12:56:19 2013 +0000

    refactor (renaming)

commit 2e8ddf161965fbf33f18b6d862bc2d91f1a6ad9d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 26 12:17:28 2013 +0000

    De-duplicate dependency/graph building functions

commit 304757182980764a3739ce20cfc36d52cb29958b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 16:02:44 2013 +0400

    Don't send connection.close when connection.tune negotiation fails
    
    This keeps us spec-compliant. It only happens with bogus clients and
    there will be a sensible error message in the log.
    
    Per discussion with Simon.

commit 40612c20f440f971dd7f97af8b77dcd208432829
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 26 11:29:21 2013 +0000

    Remove lots of io:format debugging and tidy up rpc error messages

commit cefce1d5dc3821943673fbbdbc98ca26adfe7437
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 15:29:02 2013 +0400

    Extract function

commit 50f22c3489dd4a3a28b666b69351852273059d60
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 15:17:53 2013 +0400

    Refactor
    
     * Passing State allows the function take one less argument

commit 66530295f89363994b1697a1dd8cabb28fa05e41
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 14:58:21 2013 +0400

    Pass socket around instead of the entire state

commit 0621903cda51796a87b87d2aa62b2fdf71a8e605
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 14:30:37 2013 +0400

    Extract function, improve error messages

commit f392589d742d6555fafbb75e1d316efe3291fe35
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Nov 26 13:25:02 2013 +0400

    No need to handle undefined case here

commit 3accb086e56e70786308e72dcc95cc4a118edd6b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Nov 25 15:20:11 2013 +0400

    Add channel_max default

commit d799ebb5bdd967bad0c92328f2188da9e4eaf4cf
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Nov 25 15:19:50 2013 +0400

    Make connection.tune.channel_max configurable

commit 6472f3c07a2624e6c1a62ea70479d2b9cb693ceb
Merge: 4132f065a 9b8cf840c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 12:48:47 2013 +0000

    stable to default

commit 9b8cf840ceef4369ddcc17f48f542e993aa73ee1
Merge: 6422bdf40 2f06b594e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 12:48:12 2013 +0000

    Merge bug25873

commit 6422bdf405bfdb96d8aa877f834da78d059c90fd
Merge: 2f06b594e 715a0a89c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 12:47:50 2013 +0000

    Merge in stable

commit 2f06b594ec97793e1e734c169e61c3f6c7682a22
Merge: d736db72a 74c70cf2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 12:46:21 2013 +0000

    Merge bug25867

commit d736db72ad3a043adf8300db010b01d6fa3069a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 12:45:58 2013 +0000

    More explanation

commit 4132f065a08788551f0b0004b32dc5823b110040
Merge: 47aedfb2b cbdd77583
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 22 11:02:03 2013 +0000

    MErge bug25882

commit ac2bac239d424ab71c565d8137607e5cc1768d6f
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Nov 21 21:59:55 2013 +0000

    Re-work boot step handling
    
    We need to support interleaving plugin boot steps with rabbit’s own
    (internal) ones during the boot/start sequence, and also running them
    independently during runtime activation.
    
    This commit also drops the use of an ets table to track which cleanup
    steps we’ve run, and simplifies the boot step execution procedures.

commit 33cbee5b3799ef2b301cf513f6fef1103d26bc32
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Wed Nov 20 12:24:49 2013 +0000

    Refactor (de-duplicate) module attribute search

commit bc371b7de17216b213ac3ef3638b42d31fcc7b79
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Wed Nov 20 12:13:05 2013 +0000

    Various boot procedure improvements
    
    We ensure that all dependent applications are stopped, but also that
    dependencies shared by multiple applications (e.g., amqp_client) are
    not.

commit 47aedfb2b6c1587f0320da4e24cf414d16493fbb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 20 11:17:33 2013 +0000

    Don't return consumer utilisation when idle or there are no consumers; no number can be particularly meaningful.

commit 974789eb3cadffe083b7abba13e7f469714e3f4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 20 10:51:26 2013 +0000

    Don't prioritise 'reject', it could lead to observable reordering.

commit 7fd478e90f6e63b6290f3c624c1fc4486ed3c565
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 19 14:20:12 2013 +0000

    Update doc

commit 8f3ad9f8056519c421a5712ee7b8ba634d038899
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 19 14:10:21 2013 +0000

    Simplify and remove magic numbers from the i/2 bit by treating time since last change of state as another timeslice. Also return a float between 0 and 1, not a string between "0" and "100".

commit e309e92599e5b42b1bfcc414167d8f55523b0f4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 18 14:37:48 2013 +0000

    Improve comment.

commit 3f557dc14fc766f50e371a469aa092767acb98e3
Merge: 063126a71 cbdd77583
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 18 12:13:14 2013 +0000

    merge default into bug24926

commit 063126a715524cb39ed8f1173cf8e96e2c91f005
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Nov 18 12:12:05 2013 +0000

    Rework boot step handling

commit eee9e0c52b6c07d128d7c96c0628e81b43c77352
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 17:44:02 2013 +0000

    Cosmetic / unused variables.

commit ba3e88c1760ab4a7a6009e6bfb27bf8891d6c397
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 17:34:43 2013 +0000

    Simplify: less state, less records, more pattern matching.

commit fa79daa768af025d9a434fb3827f045b3fcaee31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 16:43:04 2013 +0000

    Store timestamps as integers.

commit 8d6e62060652766cfa24090bc240e2493a4110fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 16:29:49 2013 +0000

    Missed one + cosmetic.

commit dd0ba1901b6ae231dec583b0fe2e57a346cbae16
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 16:28:10 2013 +0000

    CU for "Consumer Utilisation" not CB for "Consumer Bound".

commit cd19a0961f775abe1b189bfddd020ac2f7288605
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 14:35:07 2013 +0000

    Prioritise everything we used to before bug 24966.

commit f2bc5ebe36a2ae2ef5c05d722bdac442007bcde5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 13:40:40 2013 +0000

    Add a BQ function for this.

commit bfdb6491ade85e63c238a469987eb0b6c906ccb3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 12:30:53 2013 +0000

    Matthias' strawman patch: prioritise notify_sent based on current ingress / egress rates.

commit 649c2928511c843602bbba177310a06de39414b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 15 11:46:28 2013 +0000

    Maintain an exponential moving average of the utilisation.

commit a37c1617caed10288856ee9442a849347a8ab3c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 14 17:09:09 2013 +0000

    Experiment with the idea of "consumer utilisation". Still far too lumpy.

commit 655d872d0d9b0ff29bba5ecbe2402c2b66e949f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 14 12:03:10 2013 +0000

    consumer_bound info item.

commit cbdd7758327e497d9a5285d3333da4625a73daf6
Merge: dc6e5801b 74c70cf2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 14 12:01:15 2013 +0000

    stable to default

commit 74c70cf2f2dfe3c496861970a43e45d6c7bad6bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 14 12:01:05 2013 +0000

    Oops, that should have gone in bug 25415

commit 715a0a89c552004585e1084a945173c41bc5f658
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 12 15:06:45 2013 +0000

    *cough*

commit 63b44aeaa874cc59a33da1df975bde4e907213d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 12 15:03:12 2013 +0000

    Restore synchronous addition of slaves in the queue.declare case.

commit dc6e5801b3439e7fdb83a2c245b3ac1660fe5066
Merge: 9ae837b3a a9b1019b8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 12 11:58:09 2013 +0000

    stable to default

commit a9b1019b8819ab83a27d331f5b36298ed77695b3
Merge: 2fb7fa971 e95bab137
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 12 11:01:56 2013 +0000

    Merged bug25860 into default

commit e95bab1372a58ca24b231f9abdfac253bf0686c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 12 10:02:04 2013 +0000

    Use xmerl rather than maintain our own UTF-8 validator.

commit 9ae837b3a33084a722939f984d748e1529d11130
Merge: 694ffa57a f2d5379d6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 11 16:55:55 2013 +0000

    Merged bug25870 into stable

commit 191c2a79496363737c51a4896d3497fc45ec218d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 11 15:01:37 2013 +0000

    Forgot to add a spec

commit 0928791ed9b96000febeb33d9ae7d441a66cc07f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 11 14:22:57 2013 +0000

    Re-add the log invocations we lost. This does lead to the stale master pid warning getting logged on a different node (the slave node rather than the node that attempted to start the slave) but I doubt we care about that.

commit ccb1b07a582dc47a9498cc7958ce2ccf277e0a65
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 11 14:08:08 2013 +0000

    Port the deadlock-breaking code from bug 25852.

commit 694ffa57ab8f23ea5f34f3f10af2fb539f427e0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 11 12:56:03 2013 +0000

    Remove 'evil' receive block.

commit 2fb7fa971adc6df8d816d2a3bcffdfcabbe7129d
Merge: dda70faaf f2d5379d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 11 10:30:22 2013 +0000

    stable to default

commit 547971e5374193d70ff737f65c2994b0a1cfc361
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 8 17:47:48 2013 +0000

    Cope with clients dying.

commit f2d5379d6e91a5f3e233aa2e24e338e27b6eae4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 7 15:21:59 2013 +0000

    Added tag rabbitmq_v3_2_1 for changeset fde7d8bb464a

commit 78f00b12bd31c7b868b0d8579a5447124c85cb66
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Nov 6 14:55:12 2013 +0000

    handle cleanup steps properly

commit 7a62b7b238895bd24beacec47c6e2b85befb8900
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Nov 6 11:51:07 2013 +0000

    track boot status throughout a node's lifetime

commit 81a46584d294ae6c1bbb834939d61f3c266c300d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 6 11:43:11 2013 +0000

    Explain

commit 902275142718816646ec4bdd4ef20c6b5743a8bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 6 11:39:20 2013 +0000

    Maybe sync on slave promotion.

commit 66e789074020d0697bbdd47a53a012b5f047fdfd
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 5 16:30:40 2013 +0000

    Allow offline plugin re-configuration

commit ff99195d974bfc048db42a03b0d93b3d687fdd21
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 5 15:13:03 2013 +0000

    Ensure we pass the nodename on windows

commit e94fa2b9b5793400d49d2ea74fc430fdc831903f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 5 15:10:36 2013 +0000

    Allow for runtime disabling of plugins

commit 05fbf763c5fd19ae15de69a22c8382362d46239a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 5 14:50:33 2013 +0000

    Restructure our boot procedure for more flexible boot-step handling

commit 2307326ceeaeb2bdf9e7762b40ba11ca2d8d6a15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 4 14:55:34 2013 +0000

    Validate utf-8-ness on the way into rabbitmqctl too.

commit 221e4179322f55d953dfb4a7986dbf17f458299c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 4 14:35:35 2013 +0000

    Derp / cosmetic.

commit 2a838a16a6b92acf023234ff79610abc16735694
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 4 14:33:33 2013 +0000

    Check UTF-8-ness of shortstrs in non-content-bearing methods. Note that we use the previously developed "fast" checker to avoid a dependency on xmerl, not so much because it is fast.

commit dda70faaf01d677d75cdc930b333bc9bb476c7f4
Merge: 6712c606f ed38ad757
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 1 16:25:13 2013 +0000

    Merged stable into default

commit 6712c606f7b35dddc3ca10901abdd02a750a57f9
Merge: 7987ede18 0abea4c4a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 1 16:24:58 2013 +0000

    Merged bug25849 into stable

commit 0abea4c4a1ebbf35ec0c45e117730da01112169c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 1 16:23:05 2013 +0000

    sp.

commit ed38ad7570525133c1c05e56cb49e9eeb2094608
Merge: 04e61dbc9 7987ede18
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 1 13:53:16 2013 +0000

    Merged stable into default

commit 7987ede18f54014c397f217751aeff82909c8ffc
Merge: cd35e5939 851bf5a58
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 1 13:52:30 2013 +0000

    Merged bug25618 into stable

commit 04e61dbc9dc24a9cd14e941b8cf8c49bfe0a1b88
Merge: 1fd10eae6 cd35e5939
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 1 11:47:36 2013 +0000

    stable to default

commit cd35e5939cbcb7693fa1acd408e095f7bedbe942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 1 11:47:08 2013 +0000

    That async_dirty is not needed, there's one in rabbit_runtime_parameters:list/2.

commit 1fd10eae66036d7264494dceb071291511263095
Merge: 1d8c1c3a7 5a8c39738
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 31 17:31:13 2013 +0000

    Merged stable into default

commit 5a8c397387f27b9b3923662fc144a11963cdcf55
Merge: 22664aff3 c5644183a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 31 17:30:28 2013 +0000

    Merged bug25846 into stable

commit 1d8c1c3a71a62481e94d59a51a780ea128949023
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 12:08:05 2013 +0000

    Rename + cosmetic.

commit a17e61eae4f83a6c1eb331c79d2f5bb659303da1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 12:05:50 2013 +0000

    Simplify

commit dad0aa96c3478200dc1041964c8bf643651d3675
Merge: c5644183a a87df1916
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 11:53:18 2013 +0000

    stable to default

commit a87df191697830b81cb44ec4c6eed00c228e986c
Merge: 9d8bf8465 1709e7155
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 11:53:09 2013 +0000

    Merge bug 25836

commit c5644183a8329416b5a8f137ab8d409ad41ed273
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 11:52:26 2013 +0000

    Revivify stable

commit 9d8bf8465b5797170af9a53f7e72c144e17ccfe1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 31 11:48:53 2013 +0000

    Better error message.

commit bcf38184778ec9d974294c7892878e666fcac910
Merge: 1fe7da7e0 620b59a17
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 31 11:22:39 2013 +0000

    Merged bug25842 into stable

commit 02f9801704955c89e88a885a0fad09cbea366c7d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 30 13:35:22 2013 +0000

    Don't allow deletion of "amq.rabbitmq.*".

commit 620b59a17f68efb11bb635e3d4e2b78dc92c2d6f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 30 12:03:49 2013 +0000

    Non-Windows 32 bit platforms tend to only give you 2GB address space per process.

commit d43728a8042884ba689ac795e368ab5e79f31073
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 30 10:40:19 2013 +0000

    Make log and trace exchanges internal.

commit 851bf5a58ca22f15f204c483e493ccfe1ce7fee9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 17:37:36 2013 +0000

    Remove use of gm:leave/1: it does almost nothing, master does not invoke it, and it's racy anyway.

commit 5b3ce06996f3825013227bf603149182b64f1225
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 16:18:39 2013 +0000

    Attempt to clean up actions when terminating a slave. Slave termination now never deletes a queue.

commit 22664aff3de92f696398d31a2ce05ca6eb27c7f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 12:53:06 2013 +0000

    Table locking -> O(n)

commit 244b20793c1a122d44aa4ce8522181147c6695aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 12:20:19 2013 +0000

    Eliminate list_tx variants since async_dirty is ignored in a tx.

commit 1709e715558913d8b91347076ceb598ebe3ef6a2
Merge: dc37e725f 1fe7da7e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 11:44:54 2013 +0000

    stable to default

commit 1fe7da7e0cf7a626f11b0ec519ec8dacff710acb
Merge: ac2680f5e 574bbf9c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 11:44:44 2013 +0000

    Merge bug25845

commit ac2680f5e4923cbfbc004191c40e96d991dbf800
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 29 11:44:19 2013 +0000

    Remove tab, ignore .tmp

commit dc37e725f535861f6d98e7b9c4592978aae57a04
Merge: e82e5e446 af209b9d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 28 17:27:07 2013 +0000

    merge stable into default

commit af209b9d55c9e9dff7a63372c129e39ce8efeb73
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 28 17:21:02 2013 +0000

    cosmetic

commit 58ce0e3957c288beb29c753abe956d63eb87cdb0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 28 17:08:55 2013 +0000

    Use mnesia:async_dirty/1 to reduce copypasta.

commit 148713418492bb03737cba1c5a5bd45ab4033844
Merge: ee755aab4 23f162d40
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 28 16:43:55 2013 +0000

    Merged bug25838 into stable

commit 7814f339a31050d0db92f2907f06979c08ed22cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 28 15:04:45 2013 +0000

    We can get down_from_gm twice in a row, don't blow up if we do.

commit 23f162d408ba51af2789c885d791333161095952
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 28 14:47:25 2013 +0000

    simplify

commit 574bbf9c961bf00407f555277d1360cc0c68fc28
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Oct 28 18:01:49 2013 +0400

    Use 580 seconds as default heartbeat interval
    
    240 seconds gives a theoretiacl 2.5 decrease in server load
    (over the previous default of 600 seconds), while
    580 gives a ~3% increase.
    
    In a test that involved watching CPU usage 1000 idle connections
    I observe effectively no difference between 600 and 580 values.
    
    580 seconds is enough to cause network activity every 290 (< 300) seconds
    and hopefully make F5 gear with default timeout settings happy.

commit ee755aab44c0da918adbdbb98f94d80d0b26256b
Merge: bb20670bb 7bf5ffb92
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 28 12:23:27 2013 +0000

    Merged bug25835 into stable

commit bb20670bb2e145342b7c5ba07dafb4e9b6b4cf82
Merge: 4163613eb dcb789ec7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 28 11:34:03 2013 +0000

    Merged bug25826 into stable

commit e82e5e446746ed8d45b80a9946c577ade916bea8
Merge: df153fea8 dcb789ec7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 28 09:29:37 2013 +0000

    stable to default

commit 7b28e1f0128f8170f7aee9ccb9b4d098aa4faf43
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Oct 27 18:37:14 2013 +0400

    Lower default heartbeat setting to 240 seconds
    
    F5 load balancers by default will close TCP connections
    that have been idle for 300 seconds.
    
    The choice of the new 240 seconds interval is not
    particularly scientific: any < 10 minutes interval
    would work, given that heartbeats are sent at
    roughly 1/2 the interval. As far as
    performance overhead from heartbeats goes, 240
    is about as good as 590.

commit c6419d92f99d97ca08c687d3cfa5e22bdf84515b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Sun Oct 27 18:30:23 2013 +0400

    Ignore .tmp files

commit 5ccfaebca6b8d93b556d921b73d0dfe103fba085
Merge: 97980f203 dcb789ec7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 25 18:26:18 2013 +0100

    Merge in stable

commit dcb789ec73460ca7339eea8dea6a39d6f0e84ffe
Merge: 18ffa083c b4d32d99a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 25 18:19:47 2013 +0100

    Merged default into stable

commit 97980f20323416911ae3cb05a49b3bf3b42ebb99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 25 17:12:33 2013 +0100

    Fairly nasty copy-and-paste based approach to making this more transactional. (Again, this time branched from stable correctly.)

commit 7bf5ffb92f5fe963927fdabec911730071767508
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 24 13:04:23 2013 +0100

    Write a very basic README that will hopefully point people in some vaguely useful directions.

commit 1c3491c5690930d33970841e5d0d03e42be088b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 24 12:19:23 2013 +0100

    Eliminate use of gen_server:call/2.

commit 625e274a8efe2a59dabfea7d7592d82b6ff8f1e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 24 12:12:00 2013 +0100

    Treat calls to gen_server:call/2 and gen_server2:call/2 as errors.

commit 5c5c49c4c1591b1a32e202e64cfa26d6f1fc1dd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 23 14:14:23 2013 +0100

    And wire the README into the RPM. The cp is sort of ugly, but I couldn't find a better way. Once again, this took far too long just to copy a damn file...

commit 05463e4c3febae15b37caaa28a9aebaecf99ce6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 23 13:38:05 2013 +0100

    Provide our own readme. You do not want to know how long it took me to figure out how to do that.

commit df153fea8da3d0431150340a51c1fc776d9fef1f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 23 13:22:02 2013 +0100

    Added tag rabbitmq_v3_2_0 for changeset b327b72a299d

commit 18ffa083c68e95590e1592db115a95bd55ff254b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 23 13:16:11 2013 +0100

    Add changelog entries for 3.2.0

commit d176bf38ed1423b1bf47debdf723439f42737a90
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 23 12:42:52 2013 +0100

    Use same disk free limit in sample config

commit b1be2e0c6555190cc4830939927b2c7e20172bb0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 22 12:25:13 2013 +0100

    Get Erlang version format correct for RPMs.

commit 762d4d9ea4467ddbff28a4261056f3a270a603e5
Merge: f7cd9c5b8 c5b760b48
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 21 14:58:26 2013 +0100

    merge bug25804 into default

commit 4163613eb274f851ae0e83038ea0a906491720e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 21 13:35:14 2013 +0100

    Sync before rename, since the rename is not affected by the sync and doing it this way round means we can't expose the results of a half-written but renamed file by crashing after the rename but before the sync.

commit f7cd9c5b8bccbac96befc78d18cd471cad34f5ef
Merge: 22cfcea21 b4d32d99a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 17 13:03:54 2013 +0100

    Merged stable into default

commit b4d32d99a0f8cc8e171885f8de6a404f882de1e3
Merge: 44d7b96c6 43174291f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 17 13:03:37 2013 +0100

    Merged bug25822 into stable

commit 44d7b96c6d24c48359f16ef757694d21120f21f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 16 13:33:12 2013 +0100

    Oops

commit 66f86dcbffbb259efdc0649d2801578faa8383de
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Oct 15 16:55:31 2013 -0500

    adds missing interceptor calls

commit 18db8599e02bde4d18602dd07dbc570495b60fac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 15 18:17:43 2013 +0100

    remove unused function

commit 78b420cd72bdfd399215af02942373ae22409a74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 15 18:17:28 2013 +0100

    cosmetic

commit c8a90952df754e8ad2242acff09304abfc1a0356
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 15 17:41:19 2013 +0100

    Remove from the semi_durable table when removing an exchange even if the routes are not in the durable table. And rephrase a bit in remove_routes/1, it's RAM vs disc that we care about here.

commit 22cfcea2131719d4b83ae3fbaa708a437394fd99
Merge: afdbfdb80 43174291f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 15 17:17:28 2013 +0100

    Merged stable into default

commit 43174291f04fd170f1ec4647f0edeb64f433170b
Merge: 70dacbf8b 1fef1a3cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 15 16:35:46 2013 +0100

    Merge bug25815

commit afdbfdb80732fa21b8615e57607e386d60ebf61b
Merge: 325253ef8 713548f76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 15 14:35:28 2013 +0100

    Merge bug25809

commit aaa1eb833ba63c25b9c87655814db8da223fc4f8
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Oct 15 00:14:02 2013 -0500

    passes intercept_method() to intercept function

commit 70dacbf8ba9d2289d9d053c5b42911bf35a39ee9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 14 18:59:49 2013 +0100

    Always check message expiry when queues start

commit 325253ef86a68af5a1091966394c0b029169a1c5
Merge: c3c3bcf19 a7c459b35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 14 14:13:03 2013 +0100

    merge bug25404

commit a7c459b354216d6b0b91ea91409588370058dfda
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 14 13:49:36 2013 +0100

    Consistency

commit 8fba65da66022255ec8d772d423d3f0bad64f716
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Sun Oct 13 22:48:55 2013 -0500

    improves interceptor priority handling

commit 85c61821c0ffe4a542029dc06a5268c54bbc0bde
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Sun Oct 13 18:23:22 2013 -0500

    adds channel interceptor

commit e9c79caa595cc705221e541228f58480d0e76468
Merge: 35e28b63b 72f59edd5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 11 17:24:31 2013 +0100

    merge heads

commit 72f59edd5906df7b18fb4434e92e55a5f2cb88a2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 11 17:23:49 2013 +0100

    do not pass the queue collector to amqp_1.0 reader

commit 35e28b63b37c6ad9e808ea18f3b5b926458bd9df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 10 16:56:05 2013 +0100

    ...and remove the old API.

commit 16dbfe86eaa89b5bf3cf83ccada75273231349f4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 10 15:15:05 2013 +0100

    Introduce rabbit_heartbeat:start/6 API

commit ef6b36517a4463e3670162c1d8e10f8ea9743101
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 10 10:40:54 2013 +0100

    Unify the intermediate supervision tree under r_connection_helper_sup
    
    This deprecates r_intermediate_sup and transitions the chan_sup_sup and
    queue collector processes into the helper sup, as well as providing an
    API for starting both.

commit ee72323127b5cec01b75de7b4ac4b846a52a43dc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 9 16:45:39 2013 +0100

    Defer starting a queue collector until we've received tune-ok
    
    By waiting for the connection to be fully opened, we reduce resource
    usage for abandoned connections and DoS vectors. The collector is
    started as a child of the connection_helper_sup, thus avoiding a
    potential deadlock with the parent supervisor during shutdown.

commit 29ed81dc1972946abec0dc016d5427cbed3a7fcd
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 9 16:22:54 2013 +0100

    introduce another intermediate supervisor into the connection tree

commit 713548f768884f130dbd2739ff0f92584fc08c53
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 9 11:57:50 2013 +0100

    erlang:apply is not necessary since the arguments are known

commit 2bdf8dd372549df15dae03e60ebf1819b1b6fe06
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 9 11:29:59 2013 +0100

    Support only historical verify_fun signature

commit 4b4cf07b62f2556a8ac3d754fe5791b98c7fa58b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 8 17:30:06 2013 +0100

    Support config-supplied verify_fun in tuple-format

commit c5b760b48b6faa03174b78dc2b74a3319369db2c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 4 14:43:15 2013 +0100

    Introduce flow controlled versions of send_command() for the Erlang client to use.

commit c3c3bcf197529825975a62bcd107e89351a22e5a
Merge: 289bd73de 0df81f837
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 3 11:34:45 2013 +0100

    Merge bug 24094

commit 289bd73ded0f6abbab109f5707df974780309461
Merge: e2b12e062 fb22bdbb8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 3 10:18:20 2013 +0100

    Merged bug25726 into default

commit fb22bdbb894cec6d23cb293a9eb0b51cee347653
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 2 15:47:05 2013 +0100

    Move up the publish_fields and show an example of using that to control where the message goes, that confused me for a moment...

commit 011b7942ce1f172fe71a2d11b8b2a8e8905aa9a4
Merge: f31c89e24 1fef1a3cd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 1 16:22:55 2013 +0100

    Merged stable into default

commit 1fef1a3cd8433dd91c43bb98f51302b3262c0b0e
Merge: 9359c05eb 44da83019
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 1 16:21:39 2013 +0100

    Merged bug25780 into stable

commit f31c89e24c4dee691512d9ae1be6f10f5ce688b5
Merge: 9359c05eb e49cec5e2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 1 15:37:19 2013 +0100

    merge stable into default

commit 9359c05eb2a22033a8b3ecaef08210686964cb6c
Merge: 9353190cf 335f55819
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 1 15:37:09 2013 +0100

    merge bug25685 into stable

commit 0df81f837fdcdabee1c00b0e80ac4534a1b7133e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 1 15:27:00 2013 +0100

    Return verbose message when refusing  to authenticate

commit e49cec5e28556724a1e5e6d6693c4e3a41138b08
Merge: 011da2fb6 4d3c7c897
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 16:48:10 2013 +0100

    Merge bug20384

commit 4d3c7c897225ac4637945fbc7da2845ed6f84d9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 16:47:48 2013 +0100

    A couple more things that should be documented here.

commit 01049a2a850bdd16406a60702d21e4dd869d78dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 16:12:36 2013 +0100

    I tried uncommenting everything and trying to use the resultant config file. Fix syntax errors thus found.

commit 7e8e9c95d0e43ad8fadb62a3893ff7176c43b3c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 16:00:28 2013 +0100

    Further tweaks: section headings with underlining, correction of plugin name, wrapping, minor language tweaks, comment out the kernel config, reorder and break up LDAP

commit 4546614a036b67b83c07a116c6e8ea37032b5d85
Merge: da0439897 6a65acee2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 15:47:07 2013 +0100

    Merge heads (hopefully without breaking too much, that was horrible)

commit da04398977847019724334dba41807018fddc28a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 15:15:34 2013 +0100

    Add a load of missing LDAP configuration and documentation

commit 9ff30404b608b8c30c35f9986d3c1619e0df5131
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 15:06:22 2013 +0100

    Add section on sample retention policies

commit 64e0e4adba9662544be477cec91ae1654b994d59
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:59:27 2013 +0100

    Cosmetic

commit fb02d739e8d470e073ced35f0950a0eff1e92914
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:55:13 2013 +0100

    explain implicit connect for stomp

commit 5cda15aed6496306e563211c197a45016d5beee1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:51:29 2013 +0100

    Explain default user/pass settings more thoroughly

commit 3c165080626991054b9f82a8048d55917e6c5390
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:48:33 2013 +0100

    tidy/refactor ssl_cert_login_from

commit dfa635e032ea1b374c5b500458583eb5b0b9a4f9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:47:17 2013 +0100

    remove the file_handles_high_watermark setting

commit 09f38f619da7ad137b3497a51b38a291a4663d84
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 14:46:51 2013 +0100

    Move ssl_cert_login_from to the correct place and add further comments

commit 6a65acee2fcd3f9545717af070519e78d17d45fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 30 13:57:47 2013 +0100

    Add Erlang mode for emacs. Change various listeners to use the default port. Alignment. Shorten and clarify the default_* config items. Try not to end non-sentences with a full stop. Try to be consistent about whether blocks of comments begin and end with "%%" by itself. Try to be consistent about not having a trailing comma on the last definition of each group. Rework LDAP.

commit 5c7c98a2968949f29623eb0229074dea4e87a2d4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 30 11:06:39 2013 +0100

    Enforce DOC_INSTALL_DIR during install

commit 5f97630f24b0eb8c15b9ef18a063ad17967b2fdb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 16:51:15 2013 +0100

    Document the fake DOC_INSTALL_DIR in the rpm spec; additional config and documentation

commit 59923ac4903635a1f5ee473e698dbf493fd6e8ed
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 15:18:51 2013 +0100

    Further tidying of the sample config docs, make DOC_INSTALL_DIR mandatory

commit 011da2fb610e16bc7e93683d27d66eca32de4d59
Merge: 657093d39 335f55819
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 27 14:50:30 2013 +0100

    merge stable into default

commit 335f5581956714f901b2ba799f025d230531af47
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 27 14:50:14 2013 +0100

    cosmetic(ish): remove superfluous module prefix

commit 300ee929700b61d6ed7ad580f5ee49209d690901
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 12:48:24 2013 +0100

    Since the rpm install the sample config magically, fool the build into using /tmp/ as DOC_INSTALL_DIR

commit 0dfe07f00c2e0486e025b67bd48e56b4d50f11cb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 12:47:48 2013 +0100

    Go back to explicitly installing into DOC_INSTALL_DIR during packaging

commit 63bbc95c38d9c968df30733edaf686501af2379a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 12:47:23 2013 +0100

    Tighten up the sample config a bit more

commit 658808b46a84f4acaea60dbc24b36eb8a70c459f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 12:32:22 2013 +0100

    Explain the user of default accounts where appropriate

commit 95171b5fce36c1f74a502fafd26912cc8de98498
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 27 12:20:12 2013 +0100

    Explain the cluster_nodes config in a bit more detail and point to the auto-config documentation

commit e2b12e062b7e1bc47355dcbd87bd9542ce8f96bc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 26 18:24:18 2013 +0100

    minor refactor

commit 434a3ea0b5db9481452f3a435702b55c33ae56dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 26 18:20:29 2013 +0100

    inlining

commit ee3419c9ead7ad301fcbc710eda4ca75fe479cdd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 26 18:07:54 2013 +0100

    Just one predicate.

commit 972b94caf7db1af8a4d2e4266fc9955f84e0b77f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 26 17:27:43 2013 +0100

    Ahem2.

commit 4b69650126de40cc4b141715635eaf6981ce85b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 26 16:54:50 2013 +0100

    Ahem.

commit e74026fee1deb40e59a1bcbffd777093538bcac1
Merge: 7584d140b d2f4d1423
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 26 16:25:40 2013 +0100

    Merge heads

commit d2f4d142370b99160275d7ddbbe6a886ed2acefb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 26 16:24:26 2013 +0100

    Shorten / simplify by abstracting over a duration-comparing predicate.

commit 7584d140bc267abb6d047c2a76be1ae7565ee195
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 26 14:08:49 2013 +0100

    cosmetic

commit 44da83019dd09b696d7ee4355bc7462f418c548e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 25 16:51:30 2013 +0100

    Fix stupidity

commit fbc6bb5b1842cdd23a613b59a9c9d40119a6897b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 25 10:01:06 2013 +0100

    Genericise network messages

commit 878494d437d87aa5e06764f4f6be480a77e7f3f9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Sep 24 16:06:03 2013 +0100

    continued adventures in configuration file improvements; take out DOC_INSTALL_DIR for now

commit 9bcf475c2181e651cd583e9e768072c848153a84
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 24 12:05:37 2013 +0100

    Report authentication failures by sending connection.close

commit 13bbe2eab8cce64d38efbfb9171bc9a55141f866
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 23 16:34:47 2013 +0100

    Slightly better comments.

commit e6b81396e4c6deed2c2fc59f056544dabae77a09
Merge: 657093d39 7b704ec3f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 23 16:25:50 2013 +0100

    Merge in default

commit 4a657f8d74c1e7369dee4450dc29dfd90f7e54f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 23 14:40:56 2013 +0100

    Don't go through the legacy code path when not dealing with a legacy file; don't arbitrarily rewrite the disc nodes field of this file at startup.

commit ee34fbf0e6e97195ed475784349f7f1fa2aeacd0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 23 14:40:03 2013 +0100

    node_type() should check the cluster status file rather than ask Mnesia - in the early stages of RAM node startup Mnesia might tell us we are a standalone disc node.

commit 520b49ab4e57b613be96d2e296218fdbe7f6efb9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Sep 19 13:19:15 2013 +0100

    provide a bit less info about advanced config, and link to web site

commit eaa443883f15764fdc36c6d4da53e32d3c000626
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Sep 19 13:14:30 2013 +0100

    improve explanations of things and fix layout

commit 0b39873c502244078699a1dcf1660cb1ba511cff
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Sep 19 11:27:01 2013 +0100

    cosmetic

commit 93b7d6fc5da6eb2ed92044c03434d1a0703526a4
Merge: 58ae98c86 9bee1a191
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Sep 19 10:58:04 2013 +0100

    merge heads

commit 9bee1a19105998d904078e338a0b212257b1d79d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 18 18:13:09 2013 +0100

    cosmetic: unconfuse emacs syntax highlighting

commit 621e90a5b2e1a2c9a05595c9dc14c8e468f48feb
Merge: 059c427bf 50e906bf2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Sep 18 14:45:29 2013 +0100

    merge heads

commit 059c427bf5f57ddf65474fbc10a00f4ef062a978
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Sep 18 14:44:52 2013 +0100

    relocate sample config on generic-unix/standalone

commit 58ae98c86a4337509809314f3830b00acc58bb68
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Sep 18 13:17:41 2013 +0100

    improve comments in sample config file

commit 9353190cf726948ad7e7efc13a22114e2d395f3c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 16 16:40:11 2013 +0100

    Cosmetic to be closer to what's on default.

commit 5cbce0789a61357ddbca7be50831c87915a56b6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 16 16:39:54 2013 +0100

    Don't restart the node, and add a comment explaining what's going on.

commit 657093d39de55913ef256c3cfe33547e3feb66e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 16:55:23 2013 +0100

    Dialyser points out that this branch can never happen; maybe_forget_sender/3 is always invoked with down_from_* as ChState.

commit 9238917bc83c1453e3f681af5fc85ce9be485301
Merge: ad7e01e4d c38d93c24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 16:43:23 2013 +0100

    Merge bug25749 (again)

commit c38d93c249be790f8cc6a036f05a4c3062e5edb6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 16:43:03 2013 +0100

    ...and again.

commit ad7e01e4d490ff93b69063fab1921bc6ac7f0d30
Merge: f364d25b2 90c41ce26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 14:50:23 2013 +0100

    Merge bug25749 (again)

commit f364d25b259a8006dc6b3f4a91659e916761cf3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 14:50:06 2013 +0100

    Oops, we completely broke HA there.

commit 7b704ec3f85fc78405cc561ef12c71a7732404e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 13 14:34:05 2013 +0100

    FAST_RATE based dynamic disk check interval.

commit 50e906bf2ade70a49adaed36ac19e9a1433cf364
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 13 12:37:41 2013 +0100

    do not pass MAN_DIR to the .spec after all

commit 90c41ce262530f64f4c93df87498dd626c8753b7
Merge: 09cdf8e5a 4c3c1420f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 13 11:35:02 2013 +0100

    Merged bug25749 into default

commit e785a0510ab03083438ec6de21d505c6915fe04f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 13 10:23:34 2013 +0100

    resolve merge conflicts

commit 330cb4de45aa966a6570018fa17a612329ac2b4e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 13 10:27:54 2013 +0100

    tweak handling of the doc install dir

commit 09cdf8e5ae8b7662931ae32082f60da20b946208
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 17:45:15 2013 +0100

    That "optimisation" is actually buggy since table_lookup/2 returns a 2-tuple on success. And by the time you correct for that you realise it's not even an optimisation any more.

commit 4c3c1420f3920c1337b6f158d52b2f9fd03af501
Merge: e7122ee09 0c5d186db
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 11 17:20:03 2013 +0100

    Merged bug25276 into default

commit 7b693d10162e9dccd5d848c99eada7192c0a582c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 17:14:25 2013 +0100

    Version TTL and expiry messages, and ignore the wrong ones. Also stop timers and then start them again when re-initing.

commit e7122ee098a535a4b1b0bcb3a4551b53bf0c104b
Merge: 0f4bc201c 0c5d186db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 16:54:19 2013 +0100

    Merge in default

commit 0c5d186dba75fc29d8b8899da78d5cb7608c3cfa
Merge: cdfa75f63 de9ef21fb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 11 14:57:44 2013 +0100

    merge stable into default

commit de9ef21fb0e34acf70116c6e4994fa13d7afbeb3
Merge: 139b0097d 881c119ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 11 14:57:26 2013 +0100

    merge bug25757 into stable

commit 139b0097d6c34fc016cb6599a8c8613c9be7010a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 11 14:53:46 2013 +0100

    cosmetic: remove unnecessary FQ call

commit cdfa75f63eb33159d6a185531ce19110d53b876a
Merge: 1b83153e0 baaa07ec1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 11 13:26:42 2013 +0100

    Merged stable into default

commit baaa07ec15fd9abbb9fa7e40c02a79878d1132b3
Merge: 98e8bb795 cca49430f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 11 13:26:19 2013 +0100

    Merged bug25745 into stable

commit 98e8bb795cfa53d99240789dc673beaff3ba15f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 13:21:24 2013 +0100

    Oops

commit 881c119ad14d9f410d68a845d0dbe1c37438f59f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 13:00:52 2013 +0100

    Remove the warning message, it's not very interesting. Also fix an unused variable.

commit c08e236d27707fc343ca6ff2ba41be1a07131b48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 11 12:20:04 2013 +0100

    More consistent naming.

commit 5ed4abf5a8f86a0a10b56f2ab1e5f62240f2302c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 17:23:11 2013 +0100

    Expires cannot be 0.

commit c9fb26e4bf615fb48814af971ae975747b141185
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 17:06:40 2013 +0100

    Allow use of the new policies.

commit 785698efa0498734fe68ee1209ab626b990875d5
Merge: bee1ea63e b96e08fa0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 15:34:14 2013 +0100

    Merge in bug25748

commit b96e08fa059c5faa30a619468a3757810438f964
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 15:32:50 2013 +0100

    Fix removal of DLX policy

commit 0f4bc201c33e7d6ca3c5a35f342b8f7d65f262d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 12:27:30 2013 +0100

    Explain a little.

commit 28664ff349dbdbd0c2738d9e286eebe68f7a25bf
Merge: 1b83153e0 b71468d7d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 12:23:02 2013 +0100

    Merge in default

commit 5418fefa83b501841156c21b6af47a7ed30ce0ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 11:53:12 2013 +0100

    Introduce a new return code for this case, since {new, Q} is going to mess up recovery by claiming we recovered something we didn't. Also {existing, Q} would make the channel enter an infinite loop, and {absent, Q} would return an AMQP NOT_FOUND which might be bewildering to the client if it managed to receive it. So we need a fourth possibility.

commit c1b4e6f0eac25349982939a5991f2b32da31f0d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 9 11:20:49 2013 +0100

    Reply with something the channel is going to know how to handle.

commit 1b83153e0a87b419bd7bff51de8fc4a350cf0624
Merge: cca49430f d8e4f56a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 9 06:35:42 2013 +0100

    merge stable into default

commit cca49430f9c9243800de6bcdca56b22ed915b630
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 9 06:35:22 2013 +0100

    correct erroneous comment

commit d8e4f56a9375000f5aba654880c728b6f957c865
Merge: 2e92b56d7 3b2160e17
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 9 06:05:12 2013 +0100

    merge stable into default

commit 3b2160e1735d112c22eee279f43153b117478848
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 9 06:04:52 2013 +0100

    correctly prettify exclusive owner dissappearance warning
    WRONG: Queue "queue 'amq.gen-FQZtyp6mpRdmm3-on_LAOQ' in vhost 'urhyfncz'"
    exclusive owner went away
    RIGHT: exclusive owner for queue 'amq.gen-FQZtyp6mpRdmm3-on_LAOQ' in
    vhost 'urhyfncz' went away
    
    This got broken in http://hg.rabbitmq.com/rabbitmq-server/rev/f9f4919656ab

commit bee1ea63ef56dd2382dde0240b4f2bb38edcdf3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 6 16:37:20 2013 +0100

    Hook TTL / max length / expiry into policy system.

commit c6ef3024e79d45fe6ba80ce7c49e4d73c1762ac5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 5 16:12:39 2013 +0100

    Reduce the default disk free limit to 50MB.

commit 9d5967ac9e273d757d39f277185474d23f3f08ce
Merge: 9b0c63db7 2e92b56d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 5 12:25:48 2013 +0100

    Merge in default

commit 2e92b56d76be85d12813a52b891bb7555d6e9672
Merge: cfcf0ef4e a0c79f5d1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 4 16:59:45 2013 +0100

    Merged bug25553 into default

commit 0dba1f88d2b173c92525be4c4826a70cc6c15e68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 4 16:02:09 2013 +0100

    Don't page when the disk alarm has gone off.

commit 9b0c63db7458de39bdd4198a991c4393b1fce824
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 3 16:45:19 2013 +0100

    Oops

commit 12658e577a52e8edc9a171606810694218746e87
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 3 16:12:05 2013 +0100

    Dead lettering by policy.

commit 811f68d763152413809a50584deb13378fedf1fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 3 13:13:37 2013 +0100

    Oops

commit ccef51f21eaaac9a247d199a60db8712d5853a92
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 3 12:47:13 2013 +0100

    Reinstate optimisations, plus a bit of abstraction. This entails an API change in the return type of rabbit_policy:get/2.

commit 7da554f11615a5ec18a21659bdae08e406cc952d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 3 11:49:13 2013 +0100

    Configure AE by policy.

commit 711cbbdbbd1d1748fa1971046a0b881c8b6fa6f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 2 15:40:57 2013 +0100

    Take GM's view of the live members each time we have a death message; don't assume the master will always be able to write updates to Mnesia.

commit a0c79f5d1f5941c9cb855f90180b071b23f0ef90
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 2 11:16:12 2013 +0100

    add missing type export
    this somehow got lost in bug 23958

commit cfcf0ef4e57ac3a5c71153e0e3624eaf3a7c7fe1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 29 16:25:21 2013 +0100

    Announce consumer priorities.

commit 635e9c87b3b19be0d6a028b7a4188526d230e31e
Merge: 000551380 29525cbba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 29 14:00:26 2013 +0100

    Merge bug25733

commit f00552788a9eb8e9a11e2bc4bf515cbacbc26a99
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Aug 28 14:09:08 2013 +0100

    fix install task for standalone packages

commit 000551380173f54e7b9c7f8a8db4081ce3127974
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 28 12:53:09 2013 +0100

    Relax headers type constraints

commit db01278996f7ddaff3de6cb8086bdd65469c7d01
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Aug 28 09:44:48 2013 +0100

    tweak the location of the sample config file on windows

commit 29525cbbac1d4885ae9780b23054b801f9c169a9
Merge: f56940c61 bffe6a085
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 23 12:10:44 2013 +0100

    Merged bug25725 into default

commit e0ee6a34cf342aae1613853bbc21fbbe080df0c8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 23 11:06:53 2013 +0100

    Log reason for restart

commit 719e5e176b438a383f7ce472a8c29516ca8f2558
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 22 15:44:39 2013 +0100

    Solve startup conflict between nodes by restarting slave runtime

commit 5c0c63fe41e4efcd13bbe385881ac3af54fdc3f7
Merge: f56940c61 ac9facc5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 22 12:06:50 2013 +0100

    Merge in bug25725.

commit 1b05a24da98633644d3fd39f058b99605c2f61f3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Aug 22 11:53:35 2013 +0100

    Comment out all options and simplify

commit f56940c612a31ec2cfb4b5e279eda9839411fc0d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 17:05:03 2013 +0100

    Add consumer arguments to events and rabbitmqctl.

commit 3230f44cd88f97c0703c4ae2fa0edefb2e2f7e76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 16:36:43 2013 +0100

    Consume arguments validation.

commit ea3c837291b2d0effe31db7d8fe269adff51c636
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 15:50:27 2013 +0100

    Transplant consumer priorities from bug 25553.

commit ac9facc5a898e835ac85d1b872f11e374fdac3aa
Merge: bffe6a085 9ca20c848
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 15:41:43 2013 +0100

    Merge default

commit 9ca20c84888e90ba06ff99eb5440d48198b9312a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 15:25:46 2013 +0100

    Rename notification_requested to refresh, and emit queue_empty rather than queue_run_finished - we don't care if the queue run has finished and we are not empty, but we *do* care if we have become empty by some other method (purge, TTL).

commit bb5b1540d9680eb39d5d1cd0f668b8c1c6708b01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 13:21:35 2013 +0100

    Notify "startup" when we fail over too, that means the federation links will fail over with us.

commit c2f2ebdfd32793516cf2a7c199f7aa2a3f5fd750
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 12:11:22 2013 +0100

    Slightly clearer?

commit bffe6a085ce5b52cdcbda4cd23378b5b828edabb
Merge: 87b092779 6dee43219
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 21 11:20:52 2013 +0100

    Merged bug25716 into default

commit 08d0d87ef93d092d935d7df5739bd4e18177c873
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 21 11:09:34 2013 +0100

    Small changes: Don't reevaluate consumer priority on every delivery, refactor a touch, realign, fix test, more specific spec.

commit 5c38d4daf77f403351380f2c63ff34974d8ca059
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 20 15:29:46 2013 +0100

    Tighter and slightly more self-documenting.

commit 4b7e9ee0b54f923d237a5f8f9df9189462afc70f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 20 15:22:18 2013 +0100

    Push everything through notify_decorators/3.

commit 5ac7cd34f072af5a57ba682cd7660abf146edc6c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Aug 20 11:38:39 2013 +0100

    additional comments in the sample config file

commit 87b09277919be1b9ec9615d471c365baa226f09a
Merge: 33d7248fe 1a4b08bfa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 19 18:49:26 2013 +0100

    merge stable into default

commit 33d7248feb0be93fea931958d3a9edd65d0f6077
Merge: 93ea1fd92 5cc86a30a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 19 18:48:32 2013 +0100

    merge bug25721 into stable

commit 5cc86a30ac59d52608f06e387ba6f6840b9b703e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 19 18:47:30 2013 +0100

    banish side effect dependent code

commit 483f683cd7507c7600f67799b065b95bea8fcd64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 19 18:16:19 2013 +0100

    fix spec

commit b71468d7d6d708c167ffd4f56a96b178f8faedfc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 19 17:44:31 2013 +0100

    Prevent exclusive queues from being durable or mirrored.

commit 1a4b08bfa2efbbb38af9f17d01624b0a267a4383
Merge: 884f218cf 06768e211
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 19 15:55:23 2013 +0100

    Merge bug25602

commit 884f218cf07a940ed6c1f2a2cb7fe8796f596c44
Merge: ec7e8cd13 bd3cc6682
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 19 15:04:54 2013 +0100

    merge bug25714 into default

commit bd3cc66822b7ed06887b22172c0f2a4268ffd2ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 19 11:30:23 2013 +0100

    refactor: make proper use of gb_sets API

commit 28a0f963f7d201895964b6c8328dc0935b431806
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 19 10:09:04 2013 +0100

    Use gb_sets rather than sets for performance.

commit 687b6cc913351b42ffdb4fda883e6c1243beae4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 17 12:42:56 2013 +0100

    cosmetics, better var names, and optimise 'DOWN' sending

commit d6f951c8d605486199b0209f92f4f059a75f2bde
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 17 12:28:30 2013 +0100

    we don't really support demonitor/2, so rip it out
    due to the aggregration of all monitors of a single pid into a single
    monitor, the semantics of demonitor/2 is decidely dodgy

commit e6dea0cc8a3b1b809715d6ef4be817b211003c85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 17 12:05:19 2013 +0100

    we only support process monitoring, so enforce that in the API

commit 1b53e3eff5bea74297a04aad95655fc37da6a8b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 16 16:03:19 2013 +0100

    ahem

commit 026696c0626343c8f335d3f3af51f6fb9fdda384
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 16 14:37:04 2013 +0100

    Simpler to maintain MonitoredPid -> {Ref, MonitoringPidSet}.

commit 1bbbfd0ea15d5101589e17dfe1dfe4c055ac6cc1
Merge: ec7e8cd13 2b1e42c66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 16 11:16:28 2013 +0100

    Merge default

commit 6dee43219aa266ab132c215be13497d41df65186
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 17:33:18 2013 +0100

    Make delete and unbind idempotent.

commit ec7e8cd13cf701787117004a95d958b3724f7fdf
Merge: 93ea1fd92 a3c95f846
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 14:56:52 2013 +0100

    stable to default

commit 93ea1fd923f3312ee6c54c0c7bea634d3ed48a76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 14:39:16 2013 +0100

    Changelog for 3.1.5

commit cbdbd692fb38fccf1833d0ef04b7ae3b6f687c55
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 14:37:32 2013 +0100

    Added tag rabbitmq_v3_1_5 for changeset 6504d305d9a9

commit 7c29ef4857bc3dbbda917d49b4a1476842024b9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 12:51:21 2013 +0100

    Explain what this is.

commit 0891f2f55b47f77fa6a45ff8860d89e17908173d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 12:49:32 2013 +0100

    Store monitors correctly, with a two level dictionary, mapping MonitoredPid -> MonitoringPid -> Ref and MonitoredPid -> Ref -> MonitoringPid.

commit 1eff7dc504d93cf736fb1f2f2be9ebfbebc9f7da
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 12:47:18 2013 +0100

    Revert b2db7048b839 (which in turn mostly reverted dd08c9204760), i.e. return to the broken bug25644 implementation.

commit a3c95f846127af005cff467a8d825c9859d93077
Merge: bdba44b9d 8ce31bd7e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 15 12:44:51 2013 +0100

    Stable to default

commit 8ce31bd7e3cbe510b0af558fbded2fd74d2112e4
Merge: 01b80ec8a 471692ab1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 15 10:54:48 2013 +0100

    Merged bug25713 into stable

commit 01b80ec8a3eb5865f40216d9e408e838790c8add
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 14 17:12:44 2013 +0100

    Revert dd08c9204760

commit bdba44b9d3d032b852e1e35fb4e3147a73cd4268
Merge: 1d8025b94 a791b1906
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 13 16:18:01 2013 +0100

    Merged bug25572 into default

commit 1d8025b947b85f19f30b993209f13e928c5d493c
Merge: 471692ab1 7d2c1b90c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 13 15:39:34 2013 +0100

    stable to default

commit 471692ab160059c131ca6b91f0aa4dd0d4036adb
Merge: 5e326de89 74e134a56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 13 15:39:20 2013 +0100

    Merge bug25710

commit 5e326de89ff8c11ee0bf03ea763ea752817fa7b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 13 15:39:02 2013 +0100

    Silence the badarg on two near-simultaneous pauses.

commit a791b1906d4557fe63d4fa65e9ee53d6cb3dbcbd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 13 10:39:39 2013 +0100

    Fix inadvertent match of Args. That's what you get for only running the test suite.

commit 5eaf4e2e3f5783ad248df4f59ec41e8683cbe8d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 9 12:18:58 2013 +0100

    Man page updates

commit e5c273013a5ce720bc1c59ae9155dd5ce35889b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 9 11:54:36 2013 +0100

    So it turns out that the policy tests fail, since we now depend on rabbit_misc:parse_arguments() to fill in defaults for us. But that's not at all unreasonable I think, and in fact rabbit_tests:control_action() does some rather odd things around options. Rather than rewrite everything, just introduce a new variant that is rather closer to what rabbitmqctl actually does, and use that for policy tests. Oh, and add some more tests, that's always good.

commit 7d2c1b90c0a0f862d9058d506e3364def6056978
Merge: d75c3c969 555671358
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 9 07:50:02 2013 +0100

    merge bug25704 into default

commit 555671358dabe274308932d0184325b50cfae1a7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 9 07:38:10 2013 +0100

    refactor: better name for function application
    plus lose the type check; we are not that paranoid.

commit b073b835b77f2b27211faf3df5066d8a06a6b108
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 8 18:44:22 2013 +0100

    Add support for setting apply-to via rabbitmqctl. Switch to using option for priority rather than optional positional argument, with two options now that approach was starting to look confusing.

commit 06768e211042f7f3199c464f4ed8869dc6faf40c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 8 17:23:13 2013 +0100

    Rename and remove duplicate credit handing on peer down

commit 513711585c23c48a3e8b55d19b46b779ab3d63cd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 8 16:23:26 2013 +0100

    tighter specs

commit 53b95b0f187ece9548c793a9d68a66b5d4298f19
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 8 14:57:49 2013 +0100

    Remove delegate beam compatibility check; we don't need that any more.

commit be27eb446545e8c8ee04753edee2638166366492
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 8 14:57:27 2013 +0100

    Use MFA for call and cast, hence avoid sending closures across the network.

commit 5a6e7c15d7a279dc307a72be668fa9672f8d8534
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 8 14:56:31 2013 +0100

    Support MFA in delegate:invoke/2 and friends.

commit d75c3c969a9b19b51d85c8e872c6e9db8887ec23
Merge: 0073e42d1 74e134a56
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 7 15:44:54 2013 +0100

    Merged stable into default

commit 74e134a56d0194c5d182ed3aaf74f2e408bc9775
Merge: d1ffc752c 02bb0813b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 7 15:44:34 2013 +0100

    Merged bug25700 into stable

commit 0073e42d1ebf5bd558034237917899f8f12c6ed6
Merge: d1ffc752c e8e4e8abd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 7 13:33:50 2013 +0100

    stable to default

commit d1ffc752cf1facdbdf2f6a11ce0ad0669a5fe857
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 7 12:22:57 2013 +0100

    Added tag rabbitmq_v3_1_4 for changeset f0c729980bc9

commit 02bb0813b4c05e116f62dc6dfad45ba50a2441d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 7 11:05:14 2013 +0100

    await_cluster_recovery/0 should return ok.

commit e8e4e8abdd8a2e1754680ea8bd2dfe8ccb02c36d
Merge: 7ad66d0ca ed2940527
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 6 17:33:20 2013 +0100

    stable to default

commit 7ad66d0caf1ea3abf7e7345b4fca04ae64a78770
Merge: e99bb3ea4 f7b891f53
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 6 17:33:09 2013 +0100

    Merge bug25689 (again)

commit f7b891f5396e2681f132102e5910d3f5c554ab5b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 6 17:32:49 2013 +0100

    Fix embarassment perpetrated in 97f0e3842c04.

commit b5b1a41a3779acc1072673a98189db490dec75e3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 6 16:45:33 2013 +0100

    Delay clearing of state in slaves
    
    until sender down notification is received from channel as well as GM
    in order to avoid messages being enqueued more than once

commit ed29405275d8ba6c25604678b3e79c74acf09f8a
Merge: 3ec23a2d7 e37eee10b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 6 15:32:02 2013 +0100

    Merge bug25191

commit 3ec23a2d7725fd01b2340b8ee225e48017ae0d77
Merge: 217224e3f e99bb3ea4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 15:22:55 2013 +0100

    merge stable into default

commit e99bb3ea4832648f5b613b9f19a895a7edd161f6
Merge: 982ab1bc5 6448f98ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 15:22:34 2013 +0100

    merge bug25686 into stable

commit 6448f98abe1f344be7857538e3c1f2a170e2d3da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 15:17:22 2013 +0100

    refactor type spec

commit 20dbf2c54fe6281f2b2510bf25dcfe8cd09d2071
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 15:02:09 2013 +0100

    simplify

commit c1c23908c5412df620004bc4e63af96ca41b9db1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 14:56:51 2013 +0100

    remove unused function

commit 217224e3fa90540db072516031949cd1071dbe6f
Merge: f54f1943a 982ab1bc5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 13:10:17 2013 +0100

    merge stable into default

commit 982ab1bc5aef51ff375b8239fb15545e6aa215ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 5 12:51:15 2013 +0100

    refactor: rpc:call already optimises calls to local nodes
    plus get rid of an unnecessary 'case'.

commit 6ea08b611d49a643628dcbfe47e741e3fc3ec3aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 2 17:07:36 2013 +0100

    Gross stupidity.

commit b10cc9ed88c3bb4daded9c8fd4acf1c4c3a1d21e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 2 17:05:15 2013 +0100

    Show apply-to in rabbitmqctl list_policies.

commit 0b35c07d84d678790ee0b31fef40b6e3e6032d39
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 2 17:00:19 2013 +0100

    "all" is clearer than "both".

commit f54f1943a0f219f40124b4db3c7b1a0b096769ad
Merge: c8c08dd17 65a9d9203
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 15:36:09 2013 +0100

    stable to default

commit 65a9d92033e021c3c0449eaef3b86829a79019b2
Merge: d3700b8a3 4b7c1cfb1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 15:35:56 2013 +0100

    Merge bug25617

commit 8ba5b69642e698e58ba5e553ce14cacf2646a98f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 13:32:24 2013 +0100

    Reevaluate reified policies on upgrade.

commit bc9228f5fe100b33e17dfb533c4f2d07caf7e4d4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 1 13:04:47 2013 +0100

    Type checks for alternative exchanges in the same way as DLX

commit d3700b8a3241bb7641285715223a066e64ed2b27
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 1 12:06:01 2013 +0100

    Transplant of bug25617 to stable

commit c8c08dd17fa690fcd9ecdfba4a5308a5aa098619
Merge: 4b7c1cfb1 0feec6665
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 11:54:33 2013 +0100

    stable to default

commit 4b7c1cfb1b04e5d3a3d3e59b9879f7dd942acd46
Merge: b11b7b056 467819557
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 11:54:21 2013 +0100

    Merge bug25594

commit 391744851de3859848c443a031910afc667502bc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 1 11:51:36 2013 +0100

    Better error message for DLX type error

commit 0feec6665bdd9257165eebd98c8cae5442c2c3ae
Merge: 5e98c2eed 467819557
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 11:45:47 2013 +0100

    stable to default

commit 4678195575732473c9b607e2b858653d968bd42e
Merge: 201e4a5a2 bc062feec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 1 11:45:28 2013 +0100

    Merge bug25693

commit bc062feec10a8b9507ca1a91477c4ced11f93d0f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 1 05:52:37 2013 +0100

    handle errors returned by boot steps

commit b11b7b056212d4a018da11c0ac1a53ef840a7153
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 1 04:58:32 2013 +0100

    add/remove log handler at precise point in system lifecycle
    Previously the handler stuck around for too long in the event of
    failed startup, resulting in spurious errors.

commit 2d30c6309f66a0467eba13e999bdf6e60cac68a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 1 04:55:26 2013 +0100

    add helper process for lifecycle hooks

commit 50f5b407b29a01c06e05e4fa7c89015d2d015beb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 17:39:37 2013 +0100

    Check dlx type while checking permissions

commit 5e98c2eedafc818f15627f291aca4aa9a7152fce
Merge: e01296c67 201e4a5a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 31 17:11:51 2013 +0100

    stable to default

commit 201e4a5a2f88c707f67427e00f7a8363891370db
Merge: 76cb6f971 0ae69c00f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 31 17:11:51 2013 +0100

    Merge bug25689

commit 76cb6f9713234136a1873445abbbdbb83f25fda0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 31 17:06:51 2013 +0100

    Integrate win32_cmd/1 into rabbit_misc:os_cmd/1, so that we have just one function we can always use instead of os:cmd/1.

commit 7c38f773bd38a3fd939df570c565eec0ad07cd0d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 16:15:01 2013 +0100

    Check DLX permissions on queue declare

commit e01296c673ec97e432a26cd5bec1f747d940ba34
Merge: aa1110251 0ae69c00f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 13:57:30 2013 +0100

    Merged stable into default

commit 0ae69c00f3eecef96e55891be875e6d816235238
Merge: 460f14c0b ba092e1e8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 13:13:10 2013 +0100

    Merged bug25538 into stable

commit 460f14c0bbcb431ae2a74ae6d6f9ea5b9a63d31b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 13:09:46 2013 +0100

    Update copyright on added module

commit 2dde2df7e97ceadabba80ac8b993b23b0db5e5d3
Merge: 2af61b7e9 ba092e1e8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 13:06:16 2013 +0100

    Refresh branch from stable

commit 4b193f84cf4099e655c5e40bdf5917258cfe34b1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 12:30:25 2013 +0100

    Add space for clink os cmds separately

commit aa111025195734269a3b9b32cc0ec70adc7f1190
Merge: 812d6a210 9e3a9f1be
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 31 10:05:17 2013 +0100

    Merged bug25675 into default

commit 812d6a21068d5c9b97d67211092bb42136aee7a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 17:57:46 2013 +0100

    Remove redundancy.

commit 38a9c93af978b11028d7791354afc03429e7edec
Merge: 9e3a9f1be 86cd6f042
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 16:47:08 2013 +0100

    Merge default

commit 86cd6f042b678357c38a1a7653a7bde148a5503d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 16:46:46 2013 +0100

    Pick an apply-to value heuristically.

commit e37eee10b958b90ab3b0c040a35d3e6ad492609e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 13:29:45 2013 +0100

    Convert Event set / clear to Alert true / false since that's how it is everywhere else. Further simplify. Remove a no longer true comment.

commit 0f6cf22f8b5fd0caf32462a9c9426865cfe39259
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 13:23:49 2013 +0100

    Inlining and cosmetic.

commit 9050fad042d9d34772261f80f7d8d8acddbef261
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 13:12:26 2013 +0100

    Untabify

commit 0b0fe5f12778b18643f24808755a68e6f30ce15a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 30 13:07:14 2013 +0100

    Work around Clink shell issue
    
    This shell fails to suppress its copyright banner if there is no space
    between "/c" and the rest of the commandline.

commit 9e3a9f1bed8c545b6df7c0db3e7f872ff3c0b84e
Merge: 031886bc8 3b260c705
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 30 10:49:37 2013 +0100

    Merge bug25617

commit 031886bc85d21fd82ecb8096481d202e467b9274
Merge: a34e43b30 a0f119a66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 16:09:38 2013 +0100

    Merge heads of default

commit a34e43b30639b3a6454357dd38d2afca083e6cb4
Merge: ba092e1e8 a89d46276
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 16:04:17 2013 +0100

    stable to default

commit ba092e1e82fbb26e6f7da5153fdbbd66ae6b72e3
Merge: 627ce4060 b37198049
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 16:04:02 2013 +0100

    Merge heads of stable

commit a0f119a669650b7a3b8f4c7fc8c8c5e5c792f710
Merge: 627ce4060 09067e2f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 16:03:06 2013 +0100

    stable to default

commit 627ce406058688e728bba7dbb4dfe574003b6ae5
Merge: 124c698ea a55b42191
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 16:02:48 2013 +0100

    Merge bug25670

commit 09067e2f1548c93bd9caadcb2f27a60af2b598fa
Merge: a55b42191 13e273383
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 15:43:28 2013 +0100

    stable to default

commit a55b4219197ace8dabc6135c920bcd7dfecf724f
Merge: 27c3ec5d1 5032e2f6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 15:43:17 2013 +0100

    Merge bug25668

commit 27c3ec5d16bd07c3f2cf96c82d5164efd78f252a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 29 15:43:02 2013 +0100

    cosmetic

commit a89d46276dd2e9fe8b70eca72698823dc137cd24
Merge: b37198049 13e273383
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 29 15:42:49 2013 +0100

    merge stable into default

commit b37198049c236d4d4712ae1e266efee729f7a1cd
Merge: 5032e2f6c 6833871a5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 29 15:42:11 2013 +0100

    merge bug25651 into stable

commit 13e2733833b71e06e95db878dbbcfca92486efd4
Merge: 9efcf2ec3 5032e2f6c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jul 27 04:21:05 2013 +0100

    merge stable into default

commit 5032e2f6c063d5b4438bb399ef9adecbdb97df74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jul 27 04:20:44 2013 +0100

    placate dialyzer

commit 124c698ea57108f7bd087a646290d5a792b87b68
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 26 15:27:06 2013 +0100

    Backout 3b5a3e3d2feb

commit 3b260c705223d8432b0b57c626b6fcf24eb0950a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jul 25 12:21:22 2013 +0100

    Re-order

commit c3b4938c5dc32a22ceeb94ac0ad76446b72a7c85
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 24 18:18:01 2013 +0100

    Avoid use of 'file' module in rabbit_file

commit de8baa212e5c47b01d131f9f06e049ab1b14e54e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 24 14:50:12 2013 +0100

    Write file using rename

commit 2b1e42c66aca94aa9fc84b4c412d8d140cc219f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 24 14:28:55 2013 +0100

    More symmetry; notify on basic consume and consumer unblock as well as basic.cancel and consumer block.

commit 43ff8b4e88e50fad95f043bd367c53a1166c3942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 24 14:07:13 2013 +0100

    Slightly clearer names?

commit 719b08e6b54f24ad28509f6c189c6274da91bc32
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 24 14:05:33 2013 +0100

    Don't emit random bits of the queue's internal data structures in events.

commit 9efcf2ec354e275d74ce45cba4c64125fd182405
Merge: 81efcf193 2335f5375
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 24 11:59:43 2013 +0100

    Merged stable into default

commit 81efcf193975ad4b42b5b50e58e1d0b1eae30f27
Merge: 57dfe7ff5 d50a6ac05
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 24 11:59:21 2013 +0100

    Merged bug25644 into stable

commit 8037d957e3de92782aa2d3a2439b1a0f9fe5b468
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 24 11:51:49 2013 +0100

    Support system messages in heartbeater.

commit b2189f4f08e96756e9eaa1cc1babc86ff35afa94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 23 17:57:50 2013 +0100

    Oops, missed one.

commit 56efe5b06c5b1eabd4a0c599a5e296db0d11ec12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 23 16:13:04 2013 +0100

    Wire in support for system messages.

commit d50a6ac0548c8ef5b23fd5a3573cea51a939e8ac
Merge: 57dfe7ff5 9338ced21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 23 14:53:09 2013 +0100

    Merge stable

commit 9338ced21cffb440eeb434a2d9b91b8c933a3582
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 23 14:33:17 2013 +0100

    Make monitoring via delegates async. This has the downside that you can't monitor the same pid more than once from the same process, but that is enforced by pmon anyway which is the only client of this code. The upside is that cross-cluster basic.get doesn't deadlock...

commit 9692092729663c29e78ec550ac59bce51ca4b3a2
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Tue Jul 23 15:20:55 2013 +0400

    Rename #throttle.conserve_resources to .alarmed_by

commit 9be893a12ed0ea76216dfcdadb9c071753bdc5ba
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Mon Jul 22 21:19:34 2013 +0200

    introduces ssl_apps as a env parameter

commit 2335f5375b0bf39176dfff6bd992faf9e9b89871
Merge: 57dfe7ff5 c1d517775
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 22 14:12:47 2013 +0100

    stable to default

commit 57dfe7ff58313476d5b786f4bde3e0e3ab4b9fc3
Merge: 5319f96ac 1ecba3019
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 22 14:12:28 2013 +0100

    Merge bug 25671

commit 21ca74af618e17eb9663d9b83d0f99f689e448de
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 19 13:50:17 2013 +0100

    Checking gm_pids is a better way of filtering out HA queues

commit 1ecba3019d48b1d9dd51bf65086c1a62662afce4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 19 13:40:45 2013 +0100

    Don't roll over to a lower GM view version than we have ourselves

commit 61e69ebee4861b7fa87344f5b0f010ecb6f62593
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 19 13:23:10 2013 +0100

    Slaves detect stale master pids on startup

commit c1d51777577a7afa4cfd073a7b5c7916dc3cafcb
Merge: 2e0f78bc6 5319f96ac
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 17 12:25:26 2013 +0100

    Merged stable into default

commit 5319f96acdc71838d89bd763f369697aed8ed50b
Merge: d614af371 055b2a496
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 17 12:23:36 2013 +0100

    Merged bug25584 into stable

commit d614af371f311a3f92969c65e77ccfff89e1cc0a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 17 10:25:58 2013 +0100

    Add version.mk, avoid sed when building srcdist, allow VERSION to be provided

commit 4ee05e6853631411bd4a87ba7fdd55292bb9a77c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jul 9 12:02:25 2013 +0100

    ensure that srcdist inserts the correct version into the bundled makefile

commit ff94ad3c3b91eda8e42e7aea4f6094d75a2bb48b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 5 17:26:02 2013 +0100

    Extend queue decorator interface, break dependency of server on federation. This is still a bit ugly, bits of queue state leak out in the events at the moment, and events are still exactly those needed by federation rather than a carefully thought out set. But it works.

commit b6085dd103e49734ec1a2cc08b15cac125939221
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 5 14:47:42 2013 +0100

    Start of queue decorators.

commit 2e0f78bc61ac6056ceb306dfd9bc68b63d9a8122
Merge: 82d4f1b49 055b2a496
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 5 13:24:06 2013 +0100

    Merged stable into default

commit 055b2a496e32f959fc8ed06fa0f8f60f6dcfed3f
Merge: 04f8ad3fc f5a71ecfe
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 5 13:23:37 2013 +0100

    Merged bug25659 into stable

commit e9fb1de87ce34aa5f07899aa272f4c7efdc15eb0
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jul 5 16:11:19 2013 +0400

    List connection.blocked in server capabilities

commit 63745eca45728ee51a7907a81f8592b8edfcae77
Merge: 82d4f1b49 d64433bfc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 5 11:11:46 2013 +0100

    Merge in default

commit 6833871a537d2fb95a19d3ec3ec5a77a47afdd03
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 4 17:03:21 2013 +0100

    More sensible API for partitions, do not return errors.

commit f1c394837d0a23c63242e38b6a199f66d9fd08a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 4 14:56:48 2013 +0100

    Get amqqueu_process to montor via delegate too, tighten delegate specs, simplify pmon parameterisation.

commit 82d4f1b490756b7649910c821938bd88c5364170
Merge: 7531a4d43 f5a71ecfe
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jul 4 13:09:41 2013 +0100

    Merged stable into default

commit f5a71ecfeec07e99fb1baa5e15de3118d72b6f0a
Merge: 2eac5dff2 6745f7f97
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jul 4 13:08:36 2013 +0100

    Merged bug25648 into stable

commit 2af61b7e9bb98204fcec6745082e0aaeb50342f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 17:37:53 2013 +0100

    Revert changes to the registry key "HKLM\Software\VMware, Inc.\RabbitMQ Server", which we want to keep constant.

commit be0e424afd86adbb74993d84dfd4d0185aa61f2d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 3 15:07:56 2013 +0100

    bundle the sample config up in the broker directory on windows

commit 7531a4d433dfa1537850baa0cf4473736f2befbc
Merge: 5f349bb06 6745f7f97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 3 14:55:52 2013 +0100

    merge stable into default

commit 6745f7f97c5766431daea3f7a8d3a3260f8c4d7b
Merge: 43b8141a3 671607f23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 3 14:54:23 2013 +0100

    merge bug25631 into stable

commit 04f8ad3fca3c1cbbe8d0bf2c5c29c35b3b0c7f43
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 14:26:12 2013 +0100

    Ensure that after we have done forget_cluster_node --offline we will boot the next time.

commit 6df8f72977b602ea8f07eb0241fe6d8c6f93ac72
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 3 14:25:32 2013 +0100

    fix missing newline handling in generic-unix packaging

commit 6d60dffb6971b39427c1646187240822ead4011b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 3 13:39:16 2013 +0100

    pass DOC_INSTALL_DIR during generic-unix packaging/install

commit 2eac5dff28ada94679b087060cca23cbb117748e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 13:22:56 2013 +0100

    Make join_cluster idempotent.

commit 00a8e5d3f8f5717e6124f1da8fa218da3a0e0841
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 3 12:49:46 2013 +0100

    re-instate the MAN_DIR variable on install

commit 147b529a3ac3e8c6b80cc2a0572017407cb6e3bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 12:04:07 2013 +0100

    Warning.

commit af37227c6ce39545d7b85ec85edb969ed8eb66ee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 11:48:02 2013 +0100

    Remove the constraint that forget_cluster_node --offline requires the second-to-last node to be up.

commit 43b8141a3474e9bfcb4eb7756a3f015d9145a85f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 3 11:17:18 2013 +0100

    Stick in yet another supervisor to get shutdown happening in the right order.

commit 6a5c3a6c8e8ebcc8e2bbf979bfb81b2409f2442a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 2 15:01:10 2013 +0100

    Guard aganist the case where a delegate-executed function does some monitoring.

commit 5f349bb0659c65e3b301e01ee6b59b4fe2d4ddad
Merge: 3f412c00b 671607f23
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 2 14:36:16 2013 +0100

    stable to default

commit 671607f23fb4fad384610e02f2e5236350c9a637
Merge: 0f6f997a9 e1bf460ab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 2 14:36:03 2013 +0100

    Merge bug25625

commit c7bf242421ae71b81c0b892f711c5fe079178245
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 2 14:20:29 2013 +0100

    Make the delegate monitoring API a drop in replacement for the built in one, and thus parameterise pmon and remove dmon.

commit e1bf460ab5670e2e17171311ef7ba96b6ce3aaa9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 2 10:49:05 2013 +0100

    Further refactoring

commit d64433bfc76b60b9f463200186029a93d1a44c01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 17:20:29 2013 +0100

    API change.

commit 8ea0fe60ad33aa8f1ee0823a82640d894d54fb48
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jul 1 16:32:17 2013 +0100

    Refactor

commit 3f412c00b18b3a7f2e864273d3b62a4027d046fc
Merge: 0f6f997a9 1c43cf58f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 15:13:35 2013 +0100

    stable to default

commit 0f6f997a98872f63502ac0537fc3a47e2838f7ff
Merge: 79c481b26 42a670f95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 15:13:09 2013 +0100

    Merge bug 25649

commit 42a670f95bc58cc8a0dc85446f6e2c0ce23d66e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 15:07:32 2013 +0100

    Cosmetic

commit 367e0da95c0d7004651e3ed49944a47561d0edbf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jul 1 15:01:52 2013 +0100

    Correction and contraction

commit 3abeb128258dd6f7e901eeebef365be842a7017e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 14:13:27 2013 +0100

    Ensure that if we fail over / reconfigure federation while running, we ask the qproc to remoind us what our running state is.

commit 16b9100350f8d1b7aec46a5450a98d8a303f7ce8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 13:58:27 2013 +0100

    More consistent and correct nomenclature.

commit 487bf03023c1d922b3df959b8b04bf1fc54cad3a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jul 1 12:52:00 2013 +0100

    Add hipe modules

commit e769d7446faf49ab0714997c1cb5a0d200e61ad3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 1 12:18:11 2013 +0100

    install sample config manually on debian

commit cb7027982ae4c4c35908f619e7e3223dd9d24953
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 1 10:49:14 2013 +0100

    s/VMware/GoPivotal/g

commit 104c8c8931d9258dd0aba9cffb8f6f4387625b51
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 28 16:37:47 2013 +0100

    Oops

commit 1c43cf58f02d7c1c96f502435d18f61d3942a493
Merge: 64e819e61 7c2114623
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 28 16:30:17 2013 +0100

    Merged bug25597 into default

commit 64e819e614219977b8f0c39fe55951d932896087
Merge: eb632e5ab 79c481b26
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 28 13:49:24 2013 +0100

    Merged stable into default

commit 79c481b26c6b32efeab7b1c05754f2b4a562370f
Merge: 54ad910e0 fdadf7a4c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 28 13:49:04 2013 +0100

    Merged bug25645 into stable

commit ce9cd372257d75498130baf3e297c25170277db8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 28 11:38:58 2013 +0100

    Move hipe modules list from macro to environment variable

commit 61be4875979bbdfd232d6008b22dc71f3011eec5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 27 17:51:38 2013 +0100

    Ignore missing modules when performing HiPE compilation

commit 66ba54bc346a140ed9b1a1a8ba78653518286b9a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 27 17:48:40 2013 +0100

    Optimisation for handling discarded deliveries

commit eb632e5abcec20c51710fc8ea739d304fe473f36
Merge: 2398b2528 54ad910e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 27 15:15:51 2013 +0100

    stable to default

commit 54ad910e0b6ba58b88ed42da7e7a0802ddafb6ea
Merge: 7f362fed0 05389d125
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 27 15:15:40 2013 +0100

    Merge bug25624

commit 475f9ea3182902e9f2b67c910819f5f63b15ba5d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 27 14:02:17 2013 +0100

    Stem leak when master deals with discarded messages

commit fdadf7a4cb1117839ba6055a59cc3da5a172f0a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 27 13:03:34 2013 +0100

    BQ:is_empty/1.

commit 8907aa7c8cebb20f7208a50944e2c8f0461f2d21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 27 12:49:10 2013 +0100

    Recreate that assertion up one level in the call stack, since the callers may still care about it even though VQ itself does not.

commit 09f2662b458c32bf714491d0a4f217ebf1d026a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 27 12:40:07 2013 +0100

    Remove unneeded assertion.

commit 2603ee565e09d196b4b24ce0bd88c84d721249df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 26 16:43:14 2013 +0100

    TODO-- yes it could be faster.

commit f33d2ab02311bfe23b7c450a8ca604b5619109a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 26 16:39:09 2013 +0100

    Oops

commit ea62758fb589b689a939d4da129d1e74ea8280e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 26 16:31:39 2013 +0100

    Convert the x-purpose hack into a bit less of a hack: consumer priorities.

commit 06a8b1ffcf633ba10c177736db33775636c9a20c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 26 12:59:33 2013 +0100

    Do the monitoring on the correct node(!) and remove all that nonsense about node-wide monitoring.

commit 7f362fed07be9504213e414c228154cb8345c43e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 26 12:41:17 2013 +0100

    Added tag rabbitmq_v3_1_3 for changeset d61b25171094

commit 638ce362f1cfb2eca99fe534f7b7d34a02d3c439
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 26 12:39:28 2013 +0100

    update package changelogs for 3.1.3

commit 05389d125bb79a6db801cc25647bcaebdbf25c09
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 26 12:34:16 2013 +0100

    Discard previously-discarded messages correctly

commit 9f586c509a82b9999034634a30d94f1315967776
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 25 17:43:57 2013 +0100

    A bit more faff, to deal with genuinely dying nodes.

commit 3a3df05da017d4738c3d644d23c30baead383326
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 25 16:35:24 2013 +0100

    Delegate monitoring, with a fairly glaring hole.

commit 4671d7388e4d01b2eafbdc4abb9900f0aca5ede2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 25 12:47:26 2013 +0100

    move sample config into docs, set as %doc for rpms

commit 21ee511c03443d13e515fe8761045a52c730f95b
Merge: 2398b2528 9e72ef147
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 24 17:50:27 2013 +0100

    Merge in default

commit 6371de0dbef8c04b0cda394c8eecdb08bcdd9605
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 24 16:58:07 2013 +0100

    Most of policy apply-to.

commit e9ba72ed59ecada718fc415ba47879ac22982dba
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 24 17:43:46 2013 +0400

    Deliver all alart notification to handle overlapping alarms
    
    connection.blocked requires us to track resources we are
    conserving. This means the old logic of determining
    edge state transitions for alarms does not work any more.
    
    Instead of using the old strategy of comparing alarmed
    node collection sizes, instead of pass around what event
    the notification is for and simply deliver it to the
    relevant nodes.
    
    This requires that rabbit_alarm event consumers
    handle duplicate notifications. They already do so
    after earlier changes on branch bug25191.
    
    This makes connection unblocking work correctly
    in the following sequence of events:
    
     * memory alarm set for node A
     * disk alarm set for node A
     * memory alarm cleared for node A
     * disk alarm cleared for node A
    
    as well as other similar scenarios with overlapping
    alarms.
    
    This slighly increases internode and intranode message
    traffic of alarm notifications. Since alarms occur rarely
    in well-monitored systems, this is a reasonable
    trade-off.

commit 19ca23aafc70361ffa0137966baa98793661c45c
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 24 17:36:38 2013 +0400

    Ignore *.orig files

commit 51fe2d5a17ac6ce3828734b651f870743ac8a26f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jun 24 13:33:53 2013 +0100

    Added tag rabbitmq_v3_1_2 for changeset bd3040292e1c

commit db9757b3255865f1df2e51397f16e0429a5a1756
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jun 24 13:14:46 2013 +0100

    Updated changelogs for 3.1.2

commit 2398b25282e9a8516b074c8ca322d5b7600311e3
Merge: d6c429f8f a3fc8002e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 24 11:01:15 2013 +0100

    stable to default

commit a3fc8002e074b8391b6b6cf3468734dfdd0b3447
Merge: 85973878a d0a9d6ed3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 24 11:01:03 2013 +0100

    Merge bug25640

commit 85973878aed3f8430359085066b1b1e3a5547f8f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 22 01:12:20 2013 +0100

    prevent invalid state transition
    from 'dormant' to 'active' w/o registration
    
    This was very hard to trigger, but nevertheless possible.

commit d6c429f8f153273d668e6f2120fa8bd1401578cd
Merge: 3510e978e d0a9d6ed3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 21 15:49:05 2013 +0100

    stable to default

commit d0a9d6ed3c337ce62ae8a918fc684926467f935e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 21 15:48:50 2013 +0100

    Make it clearer what I meant.

commit 3510e978e52975f752a0ecdbd051336c3d067e89
Merge: 485016c34 1001ba601
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 21 15:42:33 2013 +0100

    Merged stable into default

commit 1001ba601f49d6f4d0c4515f7f06c7e0b5bb8b21
Merge: a4b9c8249 e1509dec5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 21 15:41:56 2013 +0100

    Merged bug25638 into stable

commit 485016c3457a0fe24e89f45ccd6de22f263a0253
Merge: 75c1a0d61 e1509dec5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 21 15:00:42 2013 +0100

    Merged stable into default

commit e1509dec5b847feb273e97d9fea7ebb454484bc3
Merge: 88add9c39 8829856cb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 21 15:00:03 2013 +0100

    Merged bug25615 into stable

commit a4b9c824910f9e2793b5938b8e365eb5c70da7ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 21 11:28:32 2013 +0100

    Add a TODO for if we are ever unbusy enough to look at removing this code.

commit 9b61963c76fc05aa4209960e7a24c9bc334cd9ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 21 11:26:15 2013 +0100

    Don't persist gm_pids; by definition when all we have is the rabbit_durable_queue record the cluster has gone down completely so there can't be any pids. Fixes gm_pids leak. Since we're here, fix a similar but less severe leak in sync_slave_pids. (Less severe because rabbit_mirror_queue_misc:store_updated_slaves/1 has the effect of cleaning it up periodically. But it's still wrong.)

commit 15c630abe5b26e5f912554d639ebf73f41fb430b
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 21 00:13:08 2013 +0400

    Use lists:keymember here

commit 4d74c0c97d3eb15ba0f14cc9ee3df9fa6d192f83
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Fri Jun 21 00:02:48 2013 +0400

    Correctly determine duplicate alarms when alarm is cleared
    
    Also, don't bother doing anything on duplicate alarms, per
    review feedback.

commit 75c1a0d61894626a6446aded6218a079d4d986b6
Merge: 88add9c39 e4cb7ad19
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 20 18:35:53 2013 +0100

    merge stable into default

commit 88add9c39df1c0b7ea29ec553481ff691d93f318
Merge: fecd3865a 97f271b98
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 20 18:35:10 2013 +0100

    Merge bug25636 into stable

commit fecd3865a31ad05bf97c1c16d12afb5cad45386f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 20 16:50:55 2013 +0100

    Start asn1 too.

commit 0c9691e756f2ca98811cbbd359133fccd7751cd3
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 20 18:46:11 2013 +0400

    Don't log duplicate alarm warnings

commit 8829856cbf65acfdfb43f64a75ee3647f459b5c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 20 15:25:25 2013 +0100

    Umm, be less than 100% wrong.

commit 9fcbb9b80dffb6ea979e16563e1a8ea56232ab45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 20 14:48:31 2013 +0100

    Do not "recover" queues if there is already a rabbit_queue record for them. If we are restarting quickly it could be the case that we have a slave alive that has not failed over yet. Don't usurp it.

commit 38c688b657cf8a629317e868b2b9977e3887093f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Thu Jun 20 17:36:10 2013 +0400

    Make sure the list of alarm resources is unique

commit 8b8bfec0573f0ea9c406467c13142ec74472ef0f
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 19 16:47:33 2013 +0400

    Make sure set_alarm is idempotent
    
    By making sure alarms list is unique.

commit 4ccdfa1d20739de1daf65f79826556c61bbb74d7
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 19 15:57:00 2013 +0400

    Don't crash when an alarm is cleared when there's nothing to clear

commit 52e22ebdbfaea3cd34565b31f8739859fa97dbd5
Merge: e4cb7ad19 af875ad87
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Wed Jun 19 13:35:29 2013 +0400

    Merge default into bug25191

commit 7c21146234b3d312a7958809a27a2c0925b438ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 18 17:45:13 2013 +0100

    Oops, I forgot that going back to vm_memory_monitor:get_memory_limit() means we can now have a limit of 0.0.

commit e4cb7ad1963482de4e5988f37888343ea7b86e9a
Merge: b47d8173c 97f271b98
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 18 15:59:48 2013 +0100

    stable to default

commit 97f271b98959bddb9d30761b31c694df15a1ecf5
Merge: 2807f37a5 20b2579d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 18 15:59:27 2013 +0100

    Merge bug25612

commit 8a42493141070e7dd86430f371064dda900dc973
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 18 13:33:43 2013 +0100

    Matthias convinced me to go with ratio-of-a-ratio.

commit 41d867ee02c06db584b3a71ad65169e197dd71e2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 18 12:29:54 2013 +0100

    Put sample config in the broker repository root

commit 413dd11bda0b1c06f3577f555094859777fe016e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 18 12:29:30 2013 +0100

    Eliminate ?MEMORY_LIMIT_SCALING and make the ratio at which we page configurable. Note that I have changed the representation from a ratio-of-a-ratio to just a plain ratio (i.e. propertion of total memory, not proportion of the high watermark). I believe this will be easier to understand. Hence also the name vm_memory_paging_watermark, chosen by analogy with vm_memory_high_watermark.

commit b47d8173ca58fb4939edbdd35ab51e2ae347eb85
Merge: c4acf73d0 20b2579d4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 17 18:04:25 2013 +0100

    merge stable into default

commit 20b2579d49b94073c45ea12e192a3d48bb62c61f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 17 18:04:06 2013 +0100

    cosmetic: state the not-immediatly-obvious

commit c4acf73d03824c83b4e3f7c4ae09130cbc6dacfb
Merge: f2e321591 6f7065945
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 17 16:59:43 2013 +0100

    stable to default

commit 6f7065945494a8dc49324e446e55352dec2b7a59
Merge: 3676e3f2f b390a52c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 17 16:59:30 2013 +0100

    Merge bug25611

commit 3676e3f2f7d2dba706c79f8cd74e0765ce0bbd54
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 17 16:38:59 2013 +0100

    Throw the key too. And if the server side still fails try to fail with more information.

commit 2807f37a599b0a1d0d8c921dda1ed707769a1e51
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 17 16:34:23 2013 +0100

    rabbit_node_monitor should depend on rabbit_alarm

commit af875ad870b8e6b293c984eabfdf15e988669f72
Merge: f2e321591 32f7ee005
Author: Michael Klishin <michael@rabbitmq.com>
Date:   Mon Jun 17 17:39:26 2013 +0400

    merge default into bug25191

commit 589c666e89dcffb5bf596f0682339286622869b4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 17 14:01:51 2013 +0100

    Check value when clients update flying_ets

commit f2e321591a3ef7decd7639185b7bfbe3a63866e5
Merge: 901667032 b390a52c7
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jun 14 14:35:41 2013 +0100

    merge stable into default

commit b390a52c7a576ff79b466ae7b2ffea8c95f306d4
Merge: 2e14763f5 20370276a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jun 14 14:33:44 2013 +0100

    merge bug25600 into stable

commit 9016670328bc46e9df8ca7a9108f70f35f027629
Merge: 2e14763f5 b4a52daea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 13 15:42:57 2013 +0100

    stable to default

commit 2e14763f5334c4ef0efb26e965420b1f0a3dc346
Merge: 8903e7855 486eb2861
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 13 15:42:46 2013 +0100

    Merge bug25599

commit 486eb2861c26c82fbfc4aa51695eed057f8587ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 13 15:06:44 2013 +0100

    Adjust comment location

commit fcb1066dd0220e125674127321c775f79ed8fe1c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 13 15:00:30 2013 +0100

    Comments, gen_server-like termination reason and less unnecessary delete guarding

commit 2c4e8b98d50d95eb105d4718819110cdd1ed30dd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 13 13:47:08 2013 +0100

    Refactor

commit b4a52daea89b91e08fc0990237cff1c3c4056089
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 12 12:06:23 2013 +0100

    "This can be removed after 3.1.0 is released." -- well, let's do that then.

commit 6b2571b094a3aaca5dc04cb82870f5aff88d0fba
Merge: cd4b0d827 4a7ee069f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 12 11:16:10 2013 +0100

    Merged bug25581

commit 20370276a5dd52b3fba2d397420a5e716a86859f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 11 18:01:33 2013 +0100

    Emit consumer_deleted from the channel when we see a consumer go down, to cover the case where an HA queue master dies and is thus not able to emit the consumer_deleted itself. This means we can emit consumer_deleted twice in some circumstances I think, but that should be fine.

commit 4a7ee069f49ca0aaac2624fc408c332f17e953a7
Merge: e2e31c8b6 32b711cf1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 11 14:15:59 2013 +0100

    merge bug25604 into default

commit a5997d74847ad79fadcb393e392b3c343aaec0e4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 11 13:56:54 2013 +0100

    Omit emitting stats for non-existent queues on termination

commit 32b711cf16acc8261d16bf957832b14b88e3c023
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 11 12:38:03 2013 +0100

    Remove some vestigial events.

commit e2e31c8b60f22fc5c49fe37c2bad2aece3d8494a
Merge: bd578c117 8903e7855
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 10 16:12:16 2013 +0100

    stable to default

commit 8903e78550e21577492b43afb9ccecdf592f3d70
Merge: 707afca8d dcc666dae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 10 16:12:04 2013 +0100

    Merge heads of stable

commit dcc666dae0f9ae6813bfae2a054de1dd13596cda
Merge: 9da03ca29 09f6aa740
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 10 16:11:42 2013 +0100

    Merge bug25588

commit 09f6aa74094a0d0708d33b7619f326832fe9e795
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 10 16:11:27 2013 +0100

    Simplify (and don't bother parsing to integer only to convert back).

commit 707afca8de5391de9be71251fc061870e23ed7fc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 10 14:42:58 2013 +0100

    Display pretty missing exclusive owner log message

commit b9b0d99c9a49e756a223c3deaf7aaf9216397801
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 10 13:27:39 2013 +0100

    Clear exclusive durable queues on boot

commit cd4b0d8276cb1ce29d0f323f0c093ae87d8b43af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 7 13:46:39 2013 +0100

    Remove redundant workaround.

commit 8c51f18527beee3b661b32f985458f4c87f11fb5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 6 15:07:03 2013 +0100

    allows log the per-msg-ttl if it is present

commit bd578c117c8517a12dcfeea4eb54fe20879a1c04
Merge: 9da03ca29 348d153ee
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 6 12:53:12 2013 +0100

    Merged stable into default

commit 9da03ca296d3b143056f345a167da7c953f699e1
Merge: 818fa1245 e7ef7741e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 6 12:52:49 2013 +0100

    Merged bug25576 into stable

commit 6d3e65ee9b9c57d2965280591d0b0f3894c287b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 6 12:43:30 2013 +0100

    Cosmetic.

commit 3a3f3e89228d9bdcd5f95fe1e3f07e4541d7f80f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 6 11:38:54 2013 +0100

    do not attempt to parse expiration from missing properties

commit 348d153ee1149c2c0911940e658d87abe06eeb48
Merge: 8775d3f9c 818fa1245
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 6 10:40:01 2013 +0100

    merge stable into default

commit 818fa1245361271114ffc66d418ea6f8c9d5f10e
Merge: a8d762e8e bc7d5a6d8
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 6 10:39:44 2013 +0100

    merge bug25573 into stable

commit 72097478eb948bec654af86f6b235bdb89a7c47a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 6 10:31:09 2013 +0100

    add original expiration to x-death headers on per-message-ttl expiry

commit 8775d3f9c7a36cbc6a06a1fe13a217df0d0f479a
Merge: c82adf254 a8d762e8e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 5 17:16:56 2013 +0100

    merge stable into default

commit a8d762e8e87b6893796895df576a0ced19cc1574
Merge: 548f560d5 77b9dc8f0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 5 15:53:35 2013 +0100

    merge bug25567 into stable

commit ad70c448410dd02df6a357374a2977cebcbda706
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 4 12:23:14 2013 +0100

    Remove expiration property from dead lettered messages

commit 9e72ef1471822ec8cb6c7053bccb4b0cd9993a42
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 3 14:55:00 2013 +0100

    Inform fed queues of policy change and termination, and abstract startup a bit more.

commit 5ea455fedfea9027f4bc0e2097e3bd3fc65e2883
Merge: c82adf254 aa512398d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 3 12:59:03 2013 +0100

    Merge in default

commit ee7a58a7fbbe9bebf5f0d17b256a7b715d1a9e9c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 1 22:39:33 2013 +0100

    fix types
    (transplanted from eec14a745dd738a98cfb83e86a2b077d4280e314)

commit c82adf254aa23e48df0c3d34a02646e6042bff71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 1 22:39:33 2013 +0100

    fix types

commit 85f7e06bcbcef8c4e374aad032ce3c89a7f42f17
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 1 22:32:14 2013 +0100

    cosmetic(ish): tighter signature for rabbit_direct:connect

commit 809e2445dfd1f61e7922c168db1af49dbeb5f873
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 1 22:16:29 2013 +0100

    refactor: replace <module>:F with funs
    the former is evil

commit 17499fa2429c349c9bd2996e3d7b677f61fa5267
Merge: 146b306c8 77b9dc8f0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 31 15:12:57 2013 +0100

    merge stable into default

commit 77b9dc8f07935f5fe474a549f635f1b055f1d74c
Merge: 38380258b 783ebdf23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 31 15:12:37 2013 +0100

    merge bug25571 into stable

commit 783ebdf23d2f791aad5d78740dfff3f643353644
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 31 14:55:48 2013 +0100

    graceful handling of application:which_applications() timeout

commit e7ef7741e9e3b1989e9d8c0f80d0184f5e0fc694
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 31 13:31:39 2013 +0100

    Attempt to deal with missing segment file.

commit 146b306c87aa8aa2d090200cbe26690ade55f0cd
Merge: 38380258b d0eac028c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 31 10:50:19 2013 +0100

    merge stable into default

commit 38380258b363e7e345c997302fb9fd08d953be63
Merge: 1ad39bfc9 e7058f4cc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 31 10:13:20 2013 +0100

    merge bug25571 into stable

commit a39b555ef73b1cda4e8dd5583f3f26362e71f1bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 30 17:47:30 2013 +0100

    Remove mochiweb warning.

commit b332e0770d2a5fa02bcf6ac7c0fc26dffbe3b5aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 30 17:47:14 2013 +0100

    Use os:timestamp/0

commit 52cdd4781d429d257979c8cb7f37b5da91c65f9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 30 17:46:37 2013 +0100

    Rewrite a frankly slightly dubious TODO

commit 59ddfb4dd60ea2a9eb9e3593b988e9c6c5383b4e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 30 17:27:12 2013 +0100

    Change version dependencies for the RPM and deb files. And for the Windows installer in case any Windows user is crazy enough to be running R12.

commit bc7d5a6d84b788e209fc529b0a780f810890332e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 30 16:37:14 2013 +0100

    Don't use andalso here, it breaks LDAP when compiled under R12.

commit d0eac028ceb128be50b23954034423f59321a450
Merge: 1ad39bfc9 3f957b985
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 29 17:18:52 2013 +0100

    stable to default

commit 1ad39bfc97bcff4256e15963382a1083fb215ae5
Merge: 984c84678 0a4dc3b24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 29 17:18:39 2013 +0100

    Merge bug25575

commit e7058f4ccdeb3183117a2ac7f7303dc88fb8d9e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 29 16:40:14 2013 +0100

    Just in case this times out, let's not explode.

commit 548f560d55de9f6bb0e584f0366e34eb9e2f9126
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 29 15:45:54 2013 +0100

    Dehydrate prospective betas on requeue

commit d84242c9c8cd4c57a00d7be0d4f669e38e6386ac
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 29 15:31:37 2013 +0100

    Test to trigger VQ assertion failure (ram msgs =< len)

commit 984c84678df92deab8f175b01381309b744e1d11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 29 08:48:48 2013 +0100

    cope with empty rabbit_serial file

commit 3f957b98565606dd199cc2e174e55e31d8055e79
Merge: a8f622b89 0a4dc3b24
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 28 12:35:34 2013 +0100

    merge stable into default

commit 0a4dc3b24d63895efd469a4b39e96e956c5966b0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 28 12:09:14 2013 +0100

    Added tag rabbitmq_v3_1_1 for changeset 37858d51cf99

commit dc15c81266c919dea3b4e85f344d080f633ee3cc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 28 09:45:33 2013 +0100

    Removed tag TAG=rabbitmq_v3_1_1

commit a591e05fc180677fc7fa1e95cc5e4500d1cb6fc1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 28 09:43:48 2013 +0100

    Added tag TAG=rabbitmq_v3_1_1 for changeset d5b2b16c71e8

commit a8f622b89420688912740ffda94c39566aebb14d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat May 25 21:57:33 2013 +0100

    simplify error logging

commit def17a1af52eabe02954ae92c6d1e5ffbd9d49ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 24 15:35:57 2013 +0100

    Look for the rabbit process, not the rabbit application.

commit 1b823c17054e5e63ea039cd39b186806a368e8bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 24 15:18:57 2013 +0100

    No infinity timeout, we could deadlock with the application controller on shutdown.

commit aa512398dd05cbf0dd28f5499fa645d0ccf06d81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 24 14:12:09 2013 +0100

    If we have local active consumers, ignore federated ones.

commit 3a6b32ec637d3bd5cb0d4a22dd43c69103b16750
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 24 11:37:15 2013 +0100

    Make sure we update the federation state when a consumer becomes inactive or is cancelled.

commit 2c8f1e389a7f771d4826d4ec845160571e2177b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 23 17:46:11 2013 +0100

    Tell the federated queue about basic.get.

commit e56cacba6b3f19e028f688578abbdc958f46a1a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 23 14:33:58 2013 +0100

    Rename this

commit 0d39831fe6d4e1835912c4a079803ce8b1f25ce0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 23 12:53:08 2013 +0100

    Distinguish between federated consumers and others.

commit fe5782434bbf1c9ad1235d41e59a1c5bf1f5ca88
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 22 13:04:38 2013 +0100

    Only consume if we are empty.

commit 74e34296803726ef6cff499825286d143c77c3b7
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 21 14:21:31 2013 +0100

    update changelogs for 3.1.1

commit e131c02baf0e881d162e23b9cd7abc67251c7f14
Merge: 26a98ace5 9158d8c44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 21 14:19:43 2013 +0100

    Merge bug25563

commit 26a98ace5311e26f2a26122d4f1754d33a1b6723
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 21 13:17:57 2013 +0100

    No, that broke upgrades on RAM nodes. Third time's the charm...

commit 9691cb24a5014c7f25c12c5cfa08a127eb1529ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 21 12:24:22 2013 +0100

    Only wait for tables once local upgrades are over, not mnesia ones.

commit 79fa16ea0568274cab2981ccc24d01472a4c947b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 21 12:13:17 2013 +0100

    This may be the last Mnesia restart before we boot, so let's make sure the tables are there.

commit 9158d8c444f0a9f7532a83a6abc0a85b73661f14
Merge: 3be4cdfc5 6e1809e54
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 20 17:17:17 2013 +0100

    merge (default) heads

commit 6e1809e5497c14cb4ae176ad7eb5eaf4f41fdf39
Merge: 040a6ffbf 54d75b7c6
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 20 16:17:18 2013 +0100

    merge stable into default

commit 54d75b7c6650303d6e288ed23f06d9fbeba4affc
Merge: 5bdfd30b8 47b44d3b0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 20 16:16:49 2013 +0100

    merge heads

commit 3be4cdfc57b16137cf3dfe1f6148f86b6d2838f6
Merge: 5bdfd30b8 06946547e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 20 15:44:44 2013 +0100

    merge stable into default

commit 5bdfd30b851bf02a341df5871b723affa4b914ad
Merge: 8b4fb2cba da29b1922
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 20 15:44:29 2013 +0100

    merge bug25560 into stable

commit 040a6ffbff8d2d38fde6bec97615510907ef5dbd
Merge: 06946547e 47b44d3b0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon May 20 13:46:48 2013 +0100

    merge stable into default

commit 47b44d3b0d073d5f5600643fbeb58ce0fa9f89bc
Merge: b7df1b1e0 da29b1922
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon May 20 13:45:55 2013 +0100

    merge bug25561 into stable

commit 8b4fb2cba65e52c611dca43cef028cd46aaacb94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 20 13:13:36 2013 +0100

    space--

commit 9ec40741bdc00a2548771cf9741386bb672e7226
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 20 12:57:36 2013 +0100

    Ignore autoheal requests if we are already autohealing.

commit da29b1922180b558cb0c5098589c86e3278e7423
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 20 12:53:19 2013 +0100

    Remove obsolete and wrong comment.

commit b7df1b1e014eb2e46d7e5b40831ac20b9264c818
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 20 12:23:11 2013 +0100

    Pass through tx'ed acks and rejects in the correct order.

commit 06946547e1c48da955faf01a10bed62ea221cad1
Merge: fcd8d610c 97494a765
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu May 16 12:13:28 2013 +0100

    merge stable into default

commit 97494a765a8bef90b202357f04d96e4b39cc255e
Merge: 08877efa7 ffeb160ed
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu May 16 12:13:19 2013 +0100

    merge bug25537 into stable

commit a336134f94a4aecb8f7eddc1668b241cb39cea66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 15 17:50:25 2013 +0100

    Quick and dirty hooks for federated queues.

commit fcd8d610ce5d6dc6f9e1dc98f9642daee0ecf9f5
Merge: a62c475c3 ffeb160ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 15 13:48:51 2013 +0100

    Merge stable into default

commit ffeb160eda7a99d5d8935d1b2f90798a39782c13
Merge: 35137e819 8ecca24a0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 15 13:47:18 2013 +0100

    Merge bug25555 into stable

commit a62c475c3f3b66251783235c4209cfac736e0292
Merge: e7996f92e 88548854a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 14 16:33:40 2013 +0100

    Merge bug25390

commit 88548854aec0fd482b2a42993507ae9583669466
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 14 14:31:42 2013 +0100

    Implement feedback

commit 35137e81980cc67ac737b166ef31112a09ba0f1f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 14 14:17:29 2013 +0100

    Tighten up HA policy validation.

commit ccbbb9d5309c1f45e3b06a72312ae11cfff3f6a2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 14 13:10:37 2013 +0100

    Cope with trailing zeroes in journal and segment files
    
    Makes the on-disk journal format tolerant of runs of zeroes at the end of the file.
    This could occur if file operations are interrupted by a crashing server.
    
    Also changes the definition of segment prefixes so that runs of zero bytes will
    never appear in a valid segment.

commit e7996f92e43a99f74dec6d25f70cff865134aed5
Merge: e9a332345 8ecca24a0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 10 13:35:36 2013 +0100

    merge stable into default

commit 8ecca24a06da7b46b8d6e8b6c06de591180a840e
Merge: 7b22cb674 355ee7dec
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 10 13:35:22 2013 +0100

    merge bug25546 into stable

commit e9a332345c910e3d0f0a8852d5d4cc71adf35b54
Merge: 70d5d5db9 355ee7dec
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 10 13:32:12 2013 +0100

    merge bug25546 into default

commit 70d5d5db9eae985c9d4a1afee5c4b347832cbe58
Merge: 7b22cb674 6d3fe1ccd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 10 12:55:04 2013 +0100

    Stable into default

commit 7b22cb674ca2cfc300445e0f60e20671137c9667
Merge: ba2fd1444 48cf514c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 10 12:54:31 2013 +0100

    Merged bug25548 int stable

commit ba2fd1444124246d4d98d2a597894405e765ad16
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 10 12:42:37 2013 +0100

    Move the ignore of '_'.

commit 355ee7dec9b7586ed37efc1a6328d10890da975f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 10 12:39:54 2013 +0100

    TODO++

commit 6d3fe1ccdf4df529f4b80d29bdd9be184bcb90ca
Merge: 81e8c1903 48cf514c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 9 17:23:33 2013 +0100

    Merged stable into default

commit 48cf514c121fd0adfc536709712a0bf2c4e44b09
Merge: e495b62df c56e6463c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 9 17:23:16 2013 +0100

    Merged bug25545 into stable

commit 81e8c1903e0e33df4cbe6ddb757331150233d00c
Merge: 1b6e041ec c56e6463c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 9 16:19:25 2013 +0100

    stable to default

commit c56e6463c6c47abbf04fb6b96ed883411e97018c
Merge: d30daa5b4 3c717c4ed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 9 16:19:13 2013 +0100

    Merge bug25549

commit 1b6e041ec6f62b3cfcf79fc831e31ab5767fd033
Merge: 03c61eaa7 b365a8065
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu May 9 16:06:43 2013 +0100

    merge bug25537 into default

commit 03c61eaa7b23fe4c5aa902504715236bc4abbb64
Merge: 08877efa7 b365a8065
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu May 9 16:03:24 2013 +0100

    merge default into bug25537

commit d30daa5b4d04c48b61e4307332df57f665d97752
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 9 15:42:22 2013 +0100

    Clear queue expiry timer ref when fired

commit adf7b996952af88c0d73abb7b063f9bf8a8a8639
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 9 12:42:41 2013 +0100

    Refactor.

commit e62c7e859e2747d50392093c0eea05e84daa3067
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 9 12:37:32 2013 +0100

    Validate on list

commit a7ca9e9727b98566f09866ed9c6c89a49a08bb46
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 9 12:16:46 2013 +0100

    Validate on clear.

commit b6e87d7cd2245dd75d9fb3d6cdaaa7a5792b9908
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 8 17:08:57 2013 +0100

    Wrap the update in rabbit_vhost:with/2, so we error meaningfully if the vhost in question does not exist.

commit e495b62dffe7c4a6503accc516c7360ca0094585
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 7 16:31:40 2013 +0100

    Allow x-match header to be missing.

commit 79005d6a9394cc40e3700331614669cad90c0939
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 7 16:31:26 2013 +0100

    Treat missing / garbled x-match header as "all", like we used to.

commit 4e60556fbd437e4fc0042124b259da16c92c354c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 7 15:20:40 2013 +0100

    Remove assertion; it's not always correct if prefetch has been set before. Instead, only set the volume when we have not set prefetch before.

commit b365a806570224761307a3bdd25b1417d2746ce1
Merge: 132118ea4 0c27a741d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue May 7 07:53:03 2013 +0100

    merge bug23958 into default

commit 0c27a741d665cc7e3e7b3251aa1dc1644ed1c6a7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue May 7 07:52:19 2013 +0100

    remove R13-ism imported from upstream

commit 3c717c4ed24f7d0b398f46edaf4cbb457a1dcdac
Merge: d8b1eed89 9832d2636
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 3 11:26:15 2013 +0100

    Merge 3.1.0 into stable.

commit 132118ea4697b489d2b97f1b0a89895229d93c08
Merge: 365894701 5b566b996
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 1 16:09:12 2013 +0100

    Merge heads again

commit 36589470124f87216e54dbdabd7c5c62a4acac6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 1 15:15:12 2013 +0100

    Added tag rabbitmq_v3_1_0 for changeset 73a4d86e24c3

commit 5b566b9969e8825786ed4e08cf5a75d04e79e5be
Merge: 9832d2636 691722c42
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 1 15:08:03 2013 +0100

    Merge heads

commit 9832d26368fa6518f837d22b4c0a4754f40d510e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 1 15:06:30 2013 +0100

    Changelogs for 3.1.0.

commit 691722c42438c3e19fc201748deb1b263d449405
Merge: 6356f5eb2 300c15fd0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 1 11:39:45 2013 +0100

    merge bug23958 into default

commit 300c15fd0eae73e3b9722b75421ce65edaf13daf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 1 10:59:16 2013 +0100

    ever so slightly clearer

commit 6356f5eb2755eb010db444c0e4c505073ee13a0f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 30 12:40:32 2013 +0100

    Typo; fix compilation on <R15.

commit 08877efa78ca44cb0324d1d4242e01d4dab92933
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 30 12:30:40 2013 +0100

    Don't silently fail if we can't build deps.mk.

commit 4440416570c54cd25e13c94cce098c73a8bdbdc8
Merge: 2470be2a2 26090fde0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 30 11:28:48 2013 +0100

    merge bug25501 into default

commit 26090fde00b49ab78b6030aa46bba4d50b652f74
Merge: 4974768a6 2470be2a2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 30 11:28:02 2013 +0100

    merge default

commit 4974768a6ecfb6a4041e2dfc76b3be2c4c40816b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 29 17:13:04 2013 +0100

    Comment

commit 2470be2a21c1300ee8b7c3b9f7162325d3f0d628
Merge: 13080927d 52d424afd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 29 16:56:17 2013 +0100

    Merge heads

commit 13080927daa79f895f2d907ee094b5ce95395fc7
Merge: d8b1eed89 e96e33e40
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 29 16:55:31 2013 +0100

    stable to default

commit d8b1eed89dbf13485e197257c2af75b0522ec661
Merge: 30fe849a7 8b84368f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 29 16:55:17 2013 +0100

    Merge bug25535

commit 30fe849a798c5f5aa00eec1beaa8c81c829a4577
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 29 16:54:58 2013 +0100

    If there is no password, refuse access rather than blowing up.

commit 52d424afd8fb0aac540ae3ca2ab8fc80c36bb0c4
Merge: f34513d61 e96e33e40
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 29 11:01:45 2013 +0100

    Merged bug25527

commit f34513d6134c923dfc468133bc49307d2d733b08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 26 13:38:25 2013 +0100

    Use the credit extension.

commit f16fde200d4bf5b017f06142d3b9e642ca48bd4b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Apr 26 12:39:40 2013 +0100

    Minor variable renaming, document subtle one_for_all child deletion clauses

commit e96e33e405974fd83dc36a35b03353c0915b22c4
Merge: 4cac01d7c 947011613
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 25 17:33:08 2013 +0100

    merge bug25107 into default

commit 94701161309c565dbd336b9df03eedccdfd8bbf4
Merge: 2c1e6011e 8b84368f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 25 14:13:48 2013 +0100

    stable to default

commit 8b84368f50f2a792bed88fc330bd2cba49491a17
Merge: 1c8350183 ffcbd1220
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 25 14:11:09 2013 +0100

    Merge bug 25502

commit 1c8350183cf431a33709a32d3dc6eec04314f805
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 25 13:19:19 2013 +0100

    Receive fixed number of bytes from socket synchronously

commit 2c1e6011e789ae5b2c122d6186ada7679f13728c
Merge: 289d4eb55 3e1deb156
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 24 15:45:03 2013 +0100

    Merge bug25512

commit 3e1deb156086fa71c246f160d79b055b99978921
Merge: ffcbd1220 d4d6e4156
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 24 14:46:49 2013 +0100

    Merged stable into default

commit ffcbd1220b02de9c78aa4cef40e90b46b4100ec6
Merge: 1435e1e95 eb93f42e6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 24 14:45:55 2013 +0100

    Merged bug25524 into stable

commit 1435e1e956196cc333bda8ca55bfd1a72fa93850
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 24 14:45:14 2013 +0100

    Move the peer_down handling to sender_death, since that's when the slave really
    gives up on a sender.
    
    Transplant of 55f7c6afabe0

commit d4d6e415612253469532409b5e74aa9f12657fce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 24 12:15:43 2013 +0100

    Add explanations to pmon:is_monitored/2 invocations.

commit a4dd333d8ff85ca55650cae0a8d535e00d4d62e5
Merge: ac95d8819 935c8a3ca
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 23 13:12:03 2013 +0100

    merge bug25471 into default

commit 935c8a3ca3ca3dd2563c2cb734c006228455fd26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 22 16:23:54 2013 +0100

    Switch pause_minority mode to making its decisions entirely based on node-upness, not rabbit-application-upness and explain why.

commit 8e071bad43f2b7ce7fed65685337f0cfcd0aa5ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 22 16:10:51 2013 +0100

    Move those functions to their own place, and replace the autoheal all_nodes_up check with all_rabbit_nodes_up since it will depend on the rabbit application running to DTRT.

commit 289d4eb556def790ae0c8e1729246fd095865a6b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 22 09:47:26 2013 +0100

    add some specs and docs

commit 1c2ee9db31837ac5cd15e47e3e9798a3ec08e4d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 22 09:47:09 2013 +0100

    fix a (harmless) bug spotted by dialyzer
    the original code only worked since orddict:to_list is implemented as
    the identity function.

commit 156514bd38bb8b8d6aa7be2b7d26155d896d8d70
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 22 09:45:09 2013 +0100

    leave OtherProc info as is

commit ac95d88196cd56ffdc2923bbaea6e12567801406
Merge: cdb2bca27 eb93f42e6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 19 16:30:55 2013 +0100

    merge stable into default

commit eb93f42e6c2d178fc76955fc6777e1dc62650f2d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 19 16:30:37 2013 +0100

    fix typo

commit a86f48a1f864e90e473f44b54abbd88b9fba463f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Apr 19 13:46:38 2013 +0100

    back out of f608b9df9a14 changes supervisor2_tests

commit 021bd17e0b2d10c244af2ff9721ad06b258b3bb8
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Apr 19 12:36:55 2013 +0100

    Refactor restart handling
    
    Avoid logging restart (failures) twice. Do not reset {restarting, Pid}
    to 'undefined' as this deadlocks the supervisor.

commit cdb2bca274f94dc50be3311b594ae7828dc6dbfa
Merge: 7b67296ad 8d8b3af03
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 19 12:07:22 2013 +0100

    merge bug25513 into default

commit 8d8b3af0305b485379ce771aa84db0952cfc365e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 19 12:05:21 2013 +0100

    cosmetic

commit 59181a919269d25ef2fb95911c9b5e505550b31f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 19 12:03:45 2013 +0100

    Tiny test

commit a937859367923e5e7c38bd3c1bf92e8c83f5d252
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 19 11:44:03 2013 +0100

    Move to near the other system message and simplify.

commit 85b268ec1dbae4a84f1efa0f185463d7ea8d1066
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 19 06:31:51 2013 +0100

    lists:keyfind/3 is not in R12B-3.

commit 497e8f85bb5d61eeb68dece2b0496b8cc4b6f72a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 18 22:39:53 2013 +0100

    deal with plug-ins
    ...and rip out the now unused sup traversal code

commit 25435a9c2ef136dd369f007f07761a0f855a5aa9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 18 21:52:02 2013 +0100

    wire in sum_processes for all non-plugin process memory

commit 482615b416f96b28265f2e3c91f6689690565229
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 18 20:45:44 2013 +0100

    include the named processes in the sums

commit 8a29dba37b9c2253eed0b4b1d864d367c086bd4c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 18 20:44:53 2013 +0100

    cosmetic

commit 7b67296addad2d01cb5663782cf3cfdbc52b6f3d
Merge: 2d0d0abb8 22b54150f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 18 17:33:09 2013 +0100

    Merge bug 25517.

commit 8470077e5f74807fb65f3a3f6ab672e1c0fdafa0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 18 17:30:44 2013 +0100

    Less magic, more essay.

commit 736fc20bce1c835ee5ea53b440eee14379f3ee2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 18 15:18:07 2013 +0100

    I suppose it would be polite to add specs here.

commit 51c980e8b5e54abddf4f4da037346bb8543a6e4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 18 15:14:15 2013 +0100

    Have the leader decide what to do and then just tell other nodes (rather than have them request a winner). Substantially more reliable and shorter than previously.

commit 2d0d0abb8e2037fa8e822654f946c09847ad9a95
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 18 10:30:54 2013 +0100

    Obtain beam hash reliably

commit 5d5a2daf20e022576c3edc95ab1ca1ddba2af5d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 16:55:39 2013 +0100

    Rename states to hopefully be clearer; add more comments.

commit 0a019cb9c56c0574119b00cc714e266c40ed0f98
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 16:26:34 2013 +0100

    First pass at splitting all the autoheal stuff out into a separate module.

commit 22b54150fb2f8b3976b179e9c81f683b3e4d9360
Merge: f3001bd14 7d3c5b327
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 14:42:12 2013 +0100

    Merge bug25494 (again, after unmerging bug25517)

commit f3001bd1420e9474e87f45908390888cbf4c7845
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 12:33:40 2013 +0100

    Cosmetic

commit ddc0b20ee78d91884327a6683dc8f81f809ce18d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 12:08:05 2013 +0100

    Remove exchange_not_durable as, err, it would never be returned. And strip leading exchange_ since this is rabbit_exchange.

commit 6d4166ed1a1e53d45638125d913554edd44e6cfd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 11:16:28 2013 +0100

    Magic call handler to debug the state.

commit 78844b48ccb693c1c65e8bb0c40b5e40ff9897b8
Merge: 7d3c5b327 b0f3b4eb2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 10:42:33 2013 +0100

    Merge bug25517

commit b0f3b4eb229a975e657439f43948412134255e62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 17 10:41:20 2013 +0100

    Explain why we are doing this.

commit 04cda78c1cf636517bc84952445d4143d83730cf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 17 09:46:29 2013 +0100

    Abstract

commit 88381e38e3b3e017e36ceae3a1a9e1e6cc0c0f86
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 17 08:17:53 2013 +0100

    Change exchange update return type

commit af20ed629155cd47f7ce768d61affe24fbc8f23e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 16 17:36:34 2013 +0100

    Further modifications implementing feedback

commit 1b4e4aed5e6e2618837b316f8505ba644eb24f1b
Merge: 240e6cd84 7d3c5b327
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 17:07:09 2013 +0100

    merge default

commit 32f7ee005661a138adfe001015d5d6d4b957ee2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 16 16:29:28 2013 +0100

    We can end up hearing about a reason we have already heard about, because rabbit_alarm *both* returns them from register() and immediately calls the MFA during register(). Tests now pass.

commit 2c98ca0d63744953b9b005aef5bc7e02d688fe13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 16 15:50:11 2013 +0100

    Cosmetic

commit 7d3c5b327ffa04fbe95a00b08cc4c202c8c07bd1
Merge: 910a47c5d 2ca3205ea
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 15:48:13 2013 +0100

    merge stable into default

commit 910a47c5d0bd566cbeb34a07b897452dc4b8f122
Merge: 570ffdff5 2677e563f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 16 15:44:21 2013 +0100

    Merge bug25504

commit 240e6cd841cba670821efc46ab156814cf45174e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 15:38:02 2013 +0100

    rationalise restart handling

commit 76c58c073ee011186eabd25c13892eed3e67be13
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 15:32:24 2013 +0100

    simplify restart_if_explicit_or_abnormal

commit 646c4baf5de2e2b810086765ed3e3fb63820da83
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 15:28:32 2013 +0100

    drop function guards from restart_if_explicit_or_abnormal

commit e085ab910bae91d7821804c8a771f82f2d817d3a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 15:27:06 2013 +0100

    relocate is_explicit_restart macro

commit a70b9ec087bb5cae485af7f88b9fdde923e523a4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 16 15:08:51 2013 +0100

    Handle potential incompatibility

commit c56b053a088ac7eaf520016df4ddfa4f5f3a2f53
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 16 14:57:48 2013 +0100

    Further tweaks

commit 2ca3205eafc6c54ef6cb4ade1f35fddae1af7080
Merge: 974dad425 a9d2b823d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Apr 16 14:41:39 2013 +0100

    merge bug25518 into stable

commit 2f91e127d6654f4e157c9e9a2852dabe31aec5de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 16 13:35:02 2013 +0100

    first stab at summarising processes by their ancestor chain

commit 2677e563f4086168b6ab0345c93e707c964259a6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 16 12:45:12 2013 +0100

    Further excisions

commit 84d39b300d7120862f7d8c4ea46c4168f385c8b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 16 12:02:21 2013 +0100

    Don't wipe the slate clean each time we get a conserve_resources message.

commit 35cba8b2110d12e08b959ec241cfd68ed98bc361
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 16 11:59:44 2013 +0100

    Updates

commit ff1a88ea9e14987f876e7d24f7b2cf2dbcb9d099
Merge: 570ffdff5 558a162cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 16 11:59:32 2013 +0100

    Merge default

commit 46c993c708b742dafae8a80c92a36ba125bde771
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 15 13:49:55 2013 +0100

    Ignore missing exchange decorators

commit 2fd4ad1946f21bc0a49c38a261b5c871379781ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 15 10:58:24 2013 +0100

    Cosmetic

commit 96bac3bd8d8fc1b2387a192a394f6a03b135328e
Merge: 570ffdff5 4b394cc6e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Apr 12 17:19:33 2013 +0100

    Merge default into bug25494

commit 4cac01d7c192380e1f8f30320b59db1b4b2ca27e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 12 15:44:55 2013 +0100

    Maybe clearer?

commit 72e06711ea2b0889eee0c860e5ba3419aec0ef44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 12 15:42:27 2013 +0100

    No, the newest dead letterings are at the head.

commit 7ac2ba0411d729669b0eaf1f1caeafd1ad972204
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 12 14:42:11 2013 +0100

    Only ban cycles that are entirely due to expiry

commit 4b394cc6eb5d4cb8660c574505d4dfe313e61520
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 11 17:53:15 2013 +0100

    Changes

commit 1e75029b48d9cdb9d986f849ea567ebd90ac19dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 11 15:37:59 2013 +0100

    Move mirrored queue modes into a behaviour and implementations thereof.

commit e5c580885cf8cf6e20b0992c3e4c7306504aa1c7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 10 18:13:38 2013 +0100

    Changes

commit 691657e3816f516bd797046c663bc1f4c6831ab3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 10 13:59:47 2013 +0100

    Alternative implementation of bytecode compatibility check

commit 570ffdff5f53e63c3ddbba8cc60abebadb8f1ac9
Merge: 7fabea777 6ede39eb5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 10 11:57:54 2013 +0100

    Merge bug25519.

commit 6ede39eb503ce74f64baebf5703fa879daf5c6f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 10 11:57:29 2013 +0100

    Allow use of esl-erlang

commit 7fabea777688d2ae191e35d63e9dab77a2205160
Merge: 974dad425 2d7e253cd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 10 11:12:30 2013 +0100

    Merged stable into default

commit a9d2b823d1b77578d9bf2ddeed3c7da2a6ca2b8a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 18:17:05 2013 +0100

    Be rather less arbitrary. But still a bit.

commit 594c0677a78186eeeb7820ed4886b0ee54b9edbd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 18:08:23 2013 +0100

    Excuse

commit 1d65afdd7fb0a97d7c304b0506f1b01b2c840686
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 18:04:52 2013 +0100

    Explain a bit more WTF we're doing.

commit cd871e1295b1c94ffe853417a0cc6dbb265bfdce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 18:04:28 2013 +0100

    Add support for UID. No, it's not in public_key.hrl. Grrr.

commit b66997a3ae025864399b216617219d7378879ecc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 17:55:11 2013 +0100

    Also RFC4514 suggests we always use = even if we don't recognise an OID.

commit 3d1b5cb54cd1104f0e29ff44ca0f9ee829915714
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 17:48:31 2013 +0100

    Insert a hack.

commit e09f08fc727f03c7bb931f7c36bdf0003e85f816
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 9 17:19:43 2013 +0100

    Replace all uses of io_lib:format/2 with rabbit_misc:format/2 - we want something that returns a flat list.

commit 974dad425efc3e25d35c49b988973569f63a8b61
Merge: 1977e9490 9c2fbd300
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 9 15:06:22 2013 +0100

    Merged bug25514

commit ebd8d7212f534511aa76c67dc09a205e2d917db1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 8 15:56:29 2013 +0100

    Remove io:formats

commit 5f2a82571655fbd0534773f652a3eee80ef5894e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 8 15:56:18 2013 +0100

    Deal with partial partitions.

commit dec8a32b5a308eb16d96ff53c5d1d6d2f9e4d796
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 8 15:56:01 2013 +0100

    Umm, order by *best* partition first!

commit 9c2fbd300ff5e6a16978e7b11f3e221d2756616f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 5 17:26:01 2013 +0100

    Only queue up for GC at most two pairs of files at once, since we lock files as soon as they are queued; no point in having them locked for ages as they wait to get GCed.

commit 2d7e253cd6d6ede93be67a1631a57d63380aea0c
Merge: 733926005 af04fb7a5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Apr 5 13:28:30 2013 +0100

    merge bug25487 into default

commit 4c34dc69c16181f0600862d56fafe98cd09d4fd2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Apr 5 13:24:10 2013 +0100

    Minimise diff

commit af04fb7a597f9c02cfd83dcdd8ceff123327850d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Apr 5 12:41:28 2013 +0100

    client_sup API change

commit 7a0476196235cee922b24d9bd7ad62c21b2ae110
Merge: 733926005 541d6950b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Apr 5 11:19:07 2013 +0100

    merge default into bug25487

commit 541d6950bb76846bcd2f759a2461b0cc29d92bae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 4 16:47:29 2013 +0100

    Change client_sup API

commit c6ac0edbe633990b46c3440e184aadee9e6d47d0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 4 12:45:41 2013 +0100

    DLX without confirms

commit 52c9c27b596534f24228a7f7d4eae2d05c3c84b5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 28 17:26:07 2013 +0000

    Wrap

commit 4c87d702413394ec945cb74871cb0e51004e6e71
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 28 17:24:13 2013 +0000

    Mnesia upgrade for exchange decorators

commit aa9bf5fd8bca669a703a4f5fb46c3b76ff3e8e18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 28 13:26:30 2013 +0000

    WIP commit: start to deal with non-consistent partitions. all_partitions/1 needs attention though.

commit 769327764891b1e17a26316daaaec0cb44bf18db
Merge: 733926005 0cfeea715
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 27 15:56:58 2013 +0000

    Merge default

commit 0cfeea7155d410946491246237e7025eb6aee2dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 27 15:29:51 2013 +0000

    Cosmetic

commit 7d7eb1139d82bab1d041565cf85c5d2827995cf5
Merge: bb9cc7951 44cedcc53
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 27 15:27:16 2013 +0000

    Merge in default, add a touch more logging, and don't restart autoheal if it's already started.

commit 7339260059b0efca30fbf7f5335c6418077c60f8
Merge: 44cedcc53 abe750022
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 27 15:17:39 2013 +0000

    Merged bug25499 into default

commit 44cedcc53c3ebcf1893cf973b3a4b9eefc253288
Merge: 9f6dbf726 98e62a23a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 27 14:22:34 2013 +0000

    Merged bug25491 into default

commit bb9cc79517e4b45d25f23eaddef673e110e2627e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 26 17:54:00 2013 +0000

    Simplistic way of selecting a winner: order by the number of connections, then the size of the partition.

commit db1d9c716204ffe2a21b7d2b2969ff628dc3f596
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 26 16:49:15 2013 +0000

    Figure out a global view of partitions.

commit 1f0524c6af28678cc72e033b8843dc44118e8f36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 26 16:48:57 2013 +0000

    Add some logging

commit f88c523309fcaf9572e71e4d21ae0c8f9220c08c
Merge: b454596d4 98e62a23a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 26 15:20:28 2013 +0000

    merge default

commit 98e62a23af26fb9fa5350f3a47223c6cbcfa32a9
Merge: 128e8a9c2 99bdfa3ca
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Mar 26 10:56:02 2013 +0000

    Merge bug24114 into default

commit 128e8a9c2b046424ccdaddf99ca2367d7a9b35f0
Merge: 9e30dc1f3 99bdfa3ca
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 25 15:51:12 2013 +0000

    Merged default into bug24114

commit 9f6dbf726f7edb6852629768919e7ad3d8b035f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 25 14:39:53 2013 +0000

    Don't call rabbit_mnesia:cluster_nodes(all) as much, don't use floating point if we don't have to.

commit 28df408b038834489398abe8fff5967518a30d57
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 25 14:24:59 2013 +0000

    Use a macro

commit 087f9bf2e5a06be7253d410b05439d3a19e36356
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 25 11:12:54 2013 +0000

    Cosmetic

commit 99bdfa3cab648e5c3cb6a7f92fecdf6063360bf1
Merge: 182e79897 04731852b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 22 19:01:16 2013 +0000

    merge bug23749 into default

commit abe750022b5fbe822e031da5039e0f54918bcb13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 22 14:40:47 2013 +0000

    Check if the rabbit process is running and thus avoid deadlocks in the application controller.

commit 026f30970d9d0b4bd89200b329f32b02d3f1ff95
Merge: e1681753f 182e79897
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 22 13:45:03 2013 +0000

    Merge in default.

commit 182e79897974f410d16bab9bfdd96d8135419e2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 22 13:43:07 2013 +0000

    Backout e2d962df4128 until we can make that work properly...

commit 6fa8df03f5de1bfcdef7ec9beeebdbe0b910aee2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 22 12:47:21 2013 +0000

    Move decorators to exchange record

commit 04731852bd75e91e606fd3fdce0e15d56f21748b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 22 12:05:17 2013 +0000

    Update essay for credit (and fix a few typos I couldn't be bothered to separate out).

commit 479572a192a2e910c8b74b4e86dd1453e2ac6ec9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 22 11:17:33 2013 +0000

    Move serial arithmetic out of the broker.

commit 815ea53beda7609ea98ddeba94cac8c7df0183ae
Merge: 9b8ca7c15 9893d8f9d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 22 10:09:10 2013 +0000

    merge default (again)

commit 741ecb2d9ccd77dd4e7d2330d37d5b1e66c083e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 17:29:33 2013 +0000

    get rid of unused imports

commit 0d6a7caf4ca1bb856d5054a107205e96cff655b4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 17:28:32 2013 +0000

    fix typo

commit 3dc0e6e04cb71ed1b8de0da64e0cd71909cb9d19
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 17:22:31 2013 +0000

    cosmetic(ish)

commit 74d8c999d08da1acc7e190738f5dc6210fa4930d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 17:01:54 2013 +0000

    re-introduce state-transition optimisation for possibly_unblock

commit 2b92d88ef576b8fb78bdef5ce6415595f3bd86c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 15:32:34 2013 +0000

    Do the pinging in a separate process so we don't block the node monitor.

commit a5760b4d14d6bdbf32320f9f4abe6af6ac656b08
Merge: bff7916cf 9b8ca7c15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 13:41:15 2013 +0000

    Merge in default

commit bff7916cfc8c8805359ec8f8bb19c7c15c8120ff
Merge: f1c7eec60 03efd4928
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 13:40:05 2013 +0000

    Merge bug23749+bug25461 into bug23749

commit 9b8ca7c15dd1ec0402dc4f9f989a4ec60907c4cc
Merge: 2e87f6f48 5633e033c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 13:39:34 2013 +0000

    Merge bug25461

commit f1c7eec6049268b8480b2888da19fe4a11d3542d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 13:22:03 2013 +0000

    suspended =/= has run out of credit.

commit 5633e033cbccac337486d617953051aa2ac5dfee
Merge: 06c3c5142 34978ae2d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Mar 21 12:44:35 2013 +0000

    merge bug23378 into default

commit 34978ae2d48a94f62c129ca0096c529955486802
Merge: 9cb77b20d 21608266f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 12:29:04 2013 +0000

    merge bug25384 into default

commit 21608266fad873775822c7066de939ed50dddf63
Merge: 44cf515f9 4a9bc15f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 12:27:47 2013 +0000

    Merge heads

commit 44cf515f9087cfd32da40dcbc79ecfe414018f6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 12:27:25 2013 +0000

    Make CheckVHost actually do something.

commit 9cb77b20de03c2c036fc106ba1c35d34626fae1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 12:05:20 2013 +0000

    correct comment

commit 0c58baad2ef4aad18a76409c80a95351feb44cc8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 12:03:31 2013 +0000

    simplify

commit 392d1fe99fb99ccf8ceb2b80bb94294895a8bda5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 21 11:57:00 2013 +0000

    cosmetic

commit 640e3797e15f62c206a8fc4b914268d5ea8cc27e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 21 11:40:42 2013 +0000

    Comment

commit f4a121331825d9d9aa7603d8084feb4099a3d34f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 21 11:33:40 2013 +0000

    Modify decorator routing comment, variable and whitespace

commit 2e87f6f48caeab50ba768960d5d39d5fdccbf454
Merge: 77d144b31 0b1d68aa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 11:23:16 2013 +0000

    Merge in default

commit cb905fbed332f3a8f800027c8430d9bec928d616
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 11:22:14 2013 +0000

    Cosmetic, reduce distance to bug25461, remove dead comment

commit 12bb946e0b6c31ac59515bb72439bd2a010a6726
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 11:10:52 2013 +0000

    oops

commit 4a9bc15f0705abafcdc5b31359a9de4dda29acfb
Merge: e1681753f 77d144b31
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 21 10:51:32 2013 +0000

    Merged bug25499

commit 06c3c514203278557cc8a9f356a3a443e49dfef1
Merge: 563ffd537 77d144b31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 10:42:41 2013 +0000

    Merge in default

commit 6865cf090888f2b1df33ef022d3b4fe77a39c561
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 21 10:41:42 2013 +0000

    Merge the two can_sends and tidy up.

commit 40adb4684052c10643f7f88787754d2a6ad5ca3f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 21 10:02:31 2013 +0000

    Exchange decorator routing improvements

commit b8d6e32193dae71b5af8680828ea288edaab0f35
Merge: 0b1d68aa1 03efd4928
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 20 17:28:29 2013 +0000

    First attempt at merging these two bugs; this compiles at least.

commit 03efd492833d407eb8530d5149097331cf31342b
Merge: 77d144b31 c89269101
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 20 16:47:23 2013 +0000

    Merge in default

commit b2fda93a52018e50b46924e170c7482f9803eec3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 20 16:24:45 2013 +0000

    First attempt at pinging that doesn't really work well.

commit 0b1d68aa1eba5d6d2a8e8f8f579528b1b668aab3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 20 16:08:48 2013 +0000

    better names for the prefetch related part of the limiter API

commit bdb5239b384f266424c6f3e1dbad4f28f49fc801
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 20 15:05:58 2013 +0000

    always hold a valid limiter in queue's channel records
    This is less fiddly, but does mean we have to pass the limiter pid in
    basic_get.

commit 77d144b31b1cce83eebe6e73a7c32d28dc8492bc
Merge: 1977e9490 e6cd73e32
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 20 11:08:28 2013 +0000

    stable to default

commit 1977e9490ab0a909a861fb9ee2804824e4b2523a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 20 11:08:17 2013 +0000

    "source" is also an architecture - and a very important one.

commit f3bfe1e4ab43c8317317be4b2159b81704505247
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 19 20:21:50 2013 +0000

    some documentation

commit e1681753f9c7aaa30d196e3229716040f701b51c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 19 17:41:53 2013 +0000

    A node counts as down if it is not running rabbit in this case.

commit b454596d45cd96904edf9dfd25f3fb731d12bb05
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 19 17:15:07 2013 +0000

    First pass at autohealing.

commit e6cd73e32bc88fe464cdc9a285d15c5104b5032f
Merge: ace35ee0d fdd65e30b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 19 14:57:54 2013 +0000

    stable to default

commit fdd65e30b65489cfa69fed3f42bd339afeafca6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 19 14:57:36 2013 +0000

    These log messages do not necessarily make their implications clear enough; I can imagine people's eyes glazing over them. Try to deal with that.

commit 30339e71c3f4a3b6c244ccf5195bba518b490861
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 19 14:45:32 2013 +0000

    niggles--

commit ad5aeddb95b3fb47ed45c73ca9f4880b2baf2560
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 19 14:08:50 2013 +0000

    correctness++

commit cbbe139eaf0de198b54ffb56f207a9cc2f37d4b4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 19 13:38:27 2013 +0000

    limiter API revision - part 2/2 - queue-side API

commit e51e5d37c9d5c4d4d7ab4de8a41615997809850c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Mar 19 12:49:57 2013 +0000

    Cosmetic

commit 7d2da0429ec8df75abed511f86a95a4d7b41cd34
Merge: 2c8e21655 ace35ee0d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Mar 19 12:02:58 2013 +0000

    Merged default into bug25384

commit 2c8e2165592d838bb94064699801a60d36fa7b8f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Mar 19 11:56:41 2013 +0000

    Perform route decoration differently

commit 8614b6e32381b6b499483d689afd4db6c9bc3856
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 19 11:10:40 2013 +0000

    limiter API revision, part 1/2 - channel-side API

commit ace35ee0dd04aa2f0d3dbba811c2ed8cbb3da19d
Merge: 7c25a669c c50a3bb4b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 18 16:20:24 2013 +0000

    Merged bug25474 and bug25486

commit 7c25a669cc01dd7c51941ef0b48b8a4b4a3cfd8b
Merge: 1650b7a20 45bf97160
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 18 14:59:51 2013 +0000

    stable to default no-op

commit 45bf971600afb021554a41073d24a77d4d91189a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 18 14:59:29 2013 +0000

    Bug 25497 really should have been branched from stable, so backport it.

commit 1650b7a2057d5aba9f9efab6ea48c21797d457b9
Merge: 545dc4c40 8db8ef103
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 18 14:57:48 2013 +0000

    Merge bug25497

commit 0dd60e5e6cd4cf6ad2b538ad12e44e32640e70a3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 18 13:59:51 2013 +0000

    Different registration of exchange decorators that modify routing

commit 8db8ef1033ebc7c9d89c6c1bbdebb51836184fde
Merge: 8375956ef b28fcb26a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 18 12:46:56 2013 +0000

    Merge bug25495

commit c50a3bb4b0bf39c609543a698584d3dcee0c05d6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 18 12:01:48 2013 +0000

    Code comment about clearing partitions

commit 545dc4c401ed7783206a9b832113cb57d1779b8f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 18 11:17:02 2013 +0000

    More archs

commit b28fcb26a4a1d403719c36bae6bac47bcc1f5454
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Mar 17 20:14:47 2013 +0000

    cosmetic: make callback function def order match usage

commit 06d8ef8eba973c257cb589fab2343f96e14b73a1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Mar 17 20:10:07 2013 +0000

    get rid of superfluous serial() arg to {XT,XD}:policy_changed

commit 8375956ef7c6c8d5132d747ea408ef09af93c428
Merge: 4483bdae3 2044dbea2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 15 16:01:49 2013 +0000

    merge bug25488 into default

commit 2044dbea2b28cf9fc4dad1769b64ba0114efe497
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 15 14:38:19 2013 +0000

    correct a spec error discovered by R16B dialyzer

commit 4483bdae31468f7e7acc9d12bf68aa311f2f00b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 15 14:24:46 2013 +0000

    move spec expansion to right place

commit 3a15aa6bb7769f79a90b76129e96907b77c512ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 15 14:00:15 2013 +0000

    Push protocol errors closer to the edge.

commit 9bacf2cffe11c2663570d5be6b27a75ee34e835c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 14 17:27:24 2013 +0000

    rabbit_client_sup accepts supervision options

commit 0817fc1b68545b2efd98b14cc4e0cdbf5135db75
Merge: 2c7de7c02 30de9348b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 14 14:01:55 2013 +0000

    Merged stable into default

commit 30de9348b000e844caeeccf629d6f697fd3ec10a
Merge: 11ab9bf84 2351c884c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 14 13:57:30 2013 +0000

    Merged bug25490 into stable

commit 2351c884c163400206241ea09a8a5ef232fc1416
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 14 12:46:15 2013 +0000

    Cache the result of the external command

commit 6f5b3310893709302ba32b0086af2639001075be
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 14 11:35:07 2013 +0000

    Move the check inside the tx - this means we only lookup the exchange once and there's no possible race. It means we have to convert the exception to an {error, #amqp_error{}} which then gets converted back to an exception, but never mind...

commit 2c7de7c02d503c1c465ed560ae2d56f1b91a411b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 13 18:34:05 2013 +0000

    cosmetic

commit 8cb9a20250b51583e8ff75398807cb910725a330
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 13 17:41:27 2013 +0000

    Take advantage of the new mechanism to validate x-match.

commit 86c611621ffcc68243b9d7ed731c101d3ec883f3
Merge: bb3df9077 f5b54bf29
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 13 17:24:19 2013 +0000

    merge bug19375 into default

commit 78c26476e879dfdb42c562c28f1b9ed0f77e0e29
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 13 17:16:41 2013 +0000

    rabbit_exchange_type:validate_binding/2.

commit bb3df90773bedd67ba790bc5f3a9d45411428181
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 12 18:43:24 2013 +0000

    don't leave garbage behind in policy validation test

commit 0d3096e565d3697994bd87242cf82fbf7d9f2c78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 12 17:56:18 2013 +0000

    If we have been partitioned, and we are now in the only remaining partition, we no longer care about partitions - forget them. Note that we do not attempt to deal with individual (other) partitions going away, it's only safe to forget *any* of them when we have seen the back of *all* of them.

commit 105da1d64c8faf57930e448a42958901db55908f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 12 17:55:05 2013 +0000

    Treat {inconsistent_database, running_partitioned_network, Node} as being sort of like {node_up, Node, NodeType}. It's not perfect, but it's the best we're going to get.

commit 410e42ce463c15e1a24330eff92e1688f6d73f53
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 12 16:57:29 2013 +0000

    Oops. This was part of an (early, wrong) attempt at bug 25474 which got committed as part of f1317bb80df9 (bug 25358) by mistake. Remove.

commit 11ab9bf8428c49f221a5f21538ee22828a31c441
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 12 15:26:46 2013 +0000

    Added tag rabbitmq_v3_0_4 for changeset 2e15f381d3a8

commit 5f092253469a0b54271917d8c2a4197ba6e07fae
Merge: 4d1cc5a40 b7ee67079
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 11 17:23:08 2013 +0000

    Merge bug 25384

commit 4d1cc5a402cd2d4f08524bc8fbac831422271a3b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 11 17:22:52 2013 +0000

    Eliminate a foldl

commit 129eba4232074a57c31ab644c14936f800a0cfff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 11 16:59:29 2013 +0000

    Cosmetic

commit b7ee67079a268a5077339ef5371fd098f5915941
Merge: 98b4200d5 7d38fba3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 11 16:15:03 2013 +0000

    Merge bug25271

commit 9893d8f9d3b7e23fef600724928f1af5423e436b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Mar 11 14:34:39 2013 +0000

    track repeated attempts to restart properly

commit 734b61abe4f5b4f281034ac00672003909a36569
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 11 14:16:32 2013 +0000

    Minimise routing exchange decorator API

commit ee3ced19b97d93ab09fd8426d8a5b8ac3f0c5968
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 8 20:23:10 2013 +0000

    Translate return from do_restart properly

commit 10482327277ef337966ecf07fd01d945fd5465bf
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Mar 8 16:22:19 2013 +0000

    Align error reporting and restart handling with OTP

commit 844d1918acf1c3b691f5dab06ea75257794d4be0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 8 12:18:26 2013 +0000

    Mostly callback description

commit c3ff3a26c3c82ba798b1464ef18abc518f3a9509
Merge: da0756242 2e665ace9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Mar 7 15:10:49 2013 +0000

    merge default into bug23958

commit 98b4200d5de503f5acc0fb474698cfd599faed66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 7 12:26:09 2013 +0000

    Oops

commit b72de64061b38dd8896f0e393c930b66efaf6069
Merge: f43fd15f6 2e665ace9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 7 10:39:56 2013 +0000

    Merged bug25358 into default

commit bfa7c13c13fda70322617530a19465ea6e977bbc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 7 10:01:39 2013 +0000

    Optimisation

commit 7ed42b79ac27358b9f2bdc00aa31f5ce0799853a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 6 21:07:31 2013 +0000

    Permit exchange decorators to modify routing decisions

commit da0756242b2a6790ef975cf36ea48e8b064c4dda
Merge: 6b3d442b6 1c13e04c7
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Mar 6 20:31:01 2013 +0000

    merge heads

commit 6b3d442b64b8b8d84c78a913e616bb83184225fe
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Mar 6 20:29:50 2013 +0000

    Refactor try_again restart handling

commit f43fd15f643023586167dee33db8dd31861e3863
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 6 15:45:47 2013 +0000

    Register the process name to make sure we only have one running at a time.

commit 253f0858725a9a7fa0904cfa4ed163da668b70f0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 6 15:32:29 2013 +0000

    Unused variable

commit 553b643067473a87e978b66ad9b6c55a4edeebff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 6 10:45:48 2013 +0000

    Added tag rabbitmq_v3_0_3 for changeset a97b4179e26f

commit 1c13e04c77c634b4509434f21f7585c16368af9d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 6 03:52:01 2013 +0000

    correct comment

commit 0d97f2734063a6d2380d3c67d3ef3be4e8f941c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 5 16:01:56 2013 +0000

    We don't need this - net_adm:ping/1 will not return pong for nodes that have gone down before net_ticktime expires (it will hang for until then instead).

commit ea7c95cac616ed554a5135fde6e5d6c41bd902b1
Merge: f5e8223a6 2e665ace9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 5 12:46:02 2013 +0000

    Merge in default (umm, again)

commit f5e8223a6f4c5b239cda4bd5f80f86d81351180f
Merge: f947bb170 24393b7bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 5 12:38:51 2013 +0000

    Merge default

commit 2e665ace9e3202b0e89fdfb6910b74b9646e88ff
Merge: dd7fc282e f947bb170
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Mar 5 11:42:29 2013 +0000

    Merged stable into default

commit abc09f496008249790b3831eb078b072db00e746
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Mar 4 14:20:33 2013 +0000

    rebase with R16B

commit dd7fc282e97adda4b71a8b3f3674bcb1e422d307
Merge: e04f3ae8a a1314b98b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 4 13:09:03 2013 +0000

    Merged bug25472  into stable

commit e04f3ae8aae871092b05da62720e3339ace2b591
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 1 17:38:10 2013 +0000

    Allow subscribing to node down events from the node monitor.

commit 24393b7bdbf6996a596b82a04a54fa75470fa653
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 1 14:47:47 2013 +0000

    Rename this thing, to make space for bug 25471

commit f5b54bf297c2a77d5623794f1a65858a39d74453
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 1 14:34:35 2013 +0000

    Check queue length using correct version of backing queue state

commit 7d38fba3defaf06a1fd2386d8e55c30ff8f7e7a1
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Feb 27 15:46:53 2013 +0000

    adds missing patch

commit a6fb196bd94f0a504eae72d3b4b327eab443c6b4
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Feb 27 15:46:12 2013 +0000

    removes sed invocations in favor of patch

commit 29d0c5c5e52e355903372f69f4b1d302779f9e10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 27 15:30:43 2013 +0000

    We no longer need two different death detectors since we no longer look at Mnesia for majorityness.

commit b006debdc23f863ad1ca533c7547bb0f51805540
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 27 14:47:03 2013 +0000

    Simplify

commit d2babd48ec5775c1df4fb132d13641fc2c4e608b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 27 14:43:44 2013 +0000

    Base the whole thing off net_adm:ping/1 - because we might see other nodes come back but also be waiting (in the no-majority case, and RAM nodes). Better to detect they exist and come back than to stay stuck because they don't happen to be running Mnesia.

commit 118bb6da9778ffa0f7b6ac01c5df385e3a9434f7
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Feb 27 14:27:24 2013 +0000

    reorders sed calls

commit e2c834649a0a470507a0891d47e3f021eeaeea4d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 27 14:25:12 2013 +0000

    Filter out all those events that look like:
    
    =INFO REPORT==== 27-Feb-2013::14:17:46 ===
        application: mnesia
        exited: stopped
        type: temporary
    
    since they are not very interesting and this bug makes them appear to a highly verbose extent.

commit 69a1c4611abddf846d45689b2e579863f01d092e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 27 14:20:07 2013 +0000

    When we lose majority, stop the applications and wait for the cluster to come back.

commit 19694943479d4238697d3b432fc61f14d46a1f2b
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Feb 27 14:18:25 2013 +0000

    adds realpath to erl mac script

commit f947bb1700f40f5176ead3ed085a0cac1586a9a2
Merge: 3b8e66fb9 fa6c27d92
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 27 11:56:11 2013 +0000

    Merged bug25463 into default

commit 3b8e66fb902ecd44581a87600bf7e42535ac5583
Merge: a1314b98b 0ab505c82
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 27 11:38:59 2013 +0000

    Merged stable into default

commit a1314b98beeae614927666131a900a4a77a9ac3c
Merge: b4bc1344f 0350dd0b8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 27 11:38:28 2013 +0000

    Merged bug25432 into stable

commit bad1bff0c9df1ba042d87d754ca56818431e6550
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Feb 27 11:37:07 2013 +0000

    fixes Erlang FINAL_ROOTDIR

commit 0350dd0b865465ac3402df06282f3b2e62d644f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 26 18:04:45 2013 +0000

    Remove concept of strictness, thus renaming list_strict/1 to list_component/1 and removing list_strict/2 altogether, plus a few bits of therefore dead code.

commit eb8028b3e8cb8e28cd95fc179bfea99fa33d6666
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Tue Feb 26 17:58:01 2013 +0000

    specifies boot file for rabbit_prelaunch call

commit 0ab505c822b1079ed116977cfa716d1d058b4654
Merge: 49d25fc29 2482fb050
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 26 16:21:21 2013 +0000

    Merge bug25467

commit 2482fb050318ee7bc69e3b8b5ee1bf6fa4ab0fe7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 26 15:31:01 2013 +0000

    move socket buffer tuning into tcp_acceptor

commit 49d25fc299f22cd4faa509f036e40ee0af9b041d
Merge: b4bc1344f 2ba2833db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 26 12:30:34 2013 +0000

    stable to default

commit b4bc1344f8a8f2e47ca2fd98222897009f970d37
Merge: 169bb8744 8eff49938
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 26 12:30:10 2013 +0000

    Merge bug25465

commit fa6c27d92bf518196291d7c785a9161f842ebe67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 25 17:25:45 2013 +0000

    Keep name around for logging / info item.

commit 563ffd53724177a8d2ce9544753de6bd8e9787e7
Merge: b2bd9d180 2ba2833db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 25 12:41:31 2013 +0000

    Merge in default.

commit 169bb8744a7b58d0d65fd7c77f9b8787615eefce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 25 10:48:04 2013 +0000

    ignore early enotconn, and report early socket errors more nicely

commit b21dbefcf4be2f3395e903828da7beb713fd9ade
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 25 10:32:29 2013 +0000

    continue accepting when client sends RST before we accepted

commit edb5c71eefb44ff97230ecdd89d572b88209b733
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 21 18:05:35 2013 +0000

    Enforce queue limit with requeue

commit 4a99be7e63efe4530b0663eafef7e52291198813
Merge: dd202cc08 2ba2833db
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 21 13:44:59 2013 +0000

    Merged default into bug19375

commit c89269101b601cc9c196cfbfb361cefa9b04e243
Merge: 62d3a5905 2ba2833db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 21 12:45:41 2013 +0000

    merge default into bug23749

commit 2ba2833db6964c376ae631e4e2c2077035a32d04
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 21 12:43:50 2013 +0000

    simplify queue's basic_consume handler
    backported from bug23749 branch
    - the call to update_ch_record in the is_ch_blocked(C1) == false
      branch was superfluos since the preceding update_consumer_count
      calls update_ch_record
    - all the checking whether the channel is blocked, and associated
      branching was just an optimisation. And not a particularly important
      one, since a) the "a new consumer comes along while its
      channel is blocked" case is hardly on the critical path, and b)
      exactly the same check is performed as part of run_message_queue (in
      deliver_msg_to_consumer/3). So get rid of it.

commit 62d3a59058ded20cb191a8f4a298daafa85084a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 21 12:27:31 2013 +0000

    Well, that was embarassing.

commit ae8dfc196f980a6409893e6b9cffb0ba359b5611
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 21 12:21:26 2013 +0000

    simplifying refactor

commit f5884fa83a0e97dbd45095aa790ae75ddbae9800
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 21 12:12:51 2013 +0000

    Correct use of gb_trees APIs...

commit 23b3dd6d65668cbd5ba6ae0ed0bf6dc63b66fa18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 21 12:10:31 2013 +0000

    Oops

commit 8e91e6ed08765d69c6df439a3f8f876b6a6124fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 21 12:00:16 2013 +0000

    Use gb_trees rather than dict for performance.

commit 1c23a5cddbb7ffb07e816a196e602af0e8f18d6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 21 11:50:19 2013 +0000

    Remove blocked_ctags, and a few knock-on simplifications.

commit 07827524a7b9a6c2ca1ebf3561e5c2839bec3aba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 21 11:38:53 2013 +0000

    simplify queue's basic_consume handler
    - the call to update_ch_record in the is_ch_blocked(C1) == false
      branch was superfluos since the preceding update_consumer_count
      calls update_ch_record
    - all the checking whether the channel is blocked, and associated
      branching was just an optimisation. And not a particularly important
      one, since a) the "a new consumer comes along while its
      channel is blocked" case is hardly on the critical path, and b)
      exactly the same check is performed as part of run_message_queue (in
      deliver_msg_to_consumer/3). So get rid of it.
    - the is_empty & send_drained logic can be invoked earlier, which
      allows us to use the #cr we have rather than looking it up again. We
      can do this since the only case we need to catch here is that of a
      consumer coming along while the queue is empty already. If it
      becomes empty as part of run_message_queue then send_drained will be
      invoked in 'fetch'.

commit c000bc9b2632615828f92d2dbf79f02cc8aa4a1e
Merge: 12d1932d0 f4675d201
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 21:55:19 2013 +0000

    merge default into bug23749

commit f4675d2018e859f1d6c5b4b264c30e9e92644b71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 21:54:45 2013 +0000

    oops

commit 12d1932d00c3c23d418d64e90706eae67693e118
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 21:29:04 2013 +0000

    optimise possibly_unblock
    when the channel is blocked there is no point going through the
    expensive consumer re-partitioning

commit fd2221d04a6b2947fb269260ad7d1582f727e543
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 20:47:45 2013 +0000

    refactor
    it's convenient for callers to have maybe_send_drained thread through
    the state

commit 0877212d305d56c6a99d9dce85d68d8256d8a1c1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 20:42:27 2013 +0000

    cosmetic - reduce distance to 'default'

commit 59ab1fbd1c5d03818e5b8fc44213f62ec05d08ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 20:24:32 2013 +0000

    oops

commit 20f7d7340f1b28e38c12ba30733e3e53891dfb41
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 20:11:20 2013 +0000

    cosmetic
    move functions to a better place

commit d1fadba8c2da7cdc90133d458a1f474ed2b77720
Merge: 08caf176e 5278b6354
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 19:59:45 2013 +0000

    merge default into bug23749

commit 5278b6354ad6d3cc3dd59abe5afdd5a36ed96d2b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 19:54:22 2013 +0000

    introduce is_empty(State) helper in rabbit_amqqueue_process
    ported from bug 23749

commit 08caf176e4b073894ee65a9c8cc65116661d75f9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 19:45:01 2013 +0000

    get rid of maybe_send_drained_cons
    and optimise handle_cast/credit along the way

commit 19e317017b68cb59ebe1af25313dc633ed2c1b95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 19:42:27 2013 +0000

    refactor possibly_unblock

commit 835ad67371107e0472bcee501aa1c715c3fcd1d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 19:41:11 2013 +0000

    introduce is_empty(State) helper
    and in the resulting refactor also remove a non-linear BQS access in
    handle_info/drop_expired.

commit 25ea70d8552fe86e2f9583e36a31c0a594260a83
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 17:55:23 2013 +0000

    cosmetic

commit 8bc84307e155d6eced4e1c304d82efda586b26f1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 17:54:00 2013 +0000

    cosmetic

commit 6df47321a59db5d423e37955ff60a36ce7b80f59
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 17:49:03 2013 +0000

    eliminate non-linear BQS usage

commit 7ccf5c1d2600f780effd59e5b885f4f7b0fbadfc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 17:48:37 2013 +0000

    cosmetic

commit 8deb47bafa6ecf59b208c5975c26f927724fdf36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 20 17:33:35 2013 +0000

    Only send_drained if we have become empty...

commit cdfecd188e858aa7b9d4e0b00a7c67249baf1eb0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 20 17:23:39 2013 +0000

    Ahem

commit e3bf1f0363f36719dab626b7643de187aac489fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 20 17:20:02 2013 +0000

    Be more careful about where we send_drained from.

commit b23d6f0e56009abecc1943803e0ca8bd89d41313
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 20 14:57:53 2013 +0000

    Neatness

commit 64ec9e47eaede81267966ef7b4c4ae086d5884bd
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Feb 20 14:27:17 2013 +0000

    revert test timings back to exactly what's on default

commit df110e0e138f9c6aa615f48cd344c9c7c13103c2
Merge: 6752bb761 c013b26de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 20 13:04:39 2013 +0000

    merge default into bug23749

commit c013b26dee7786fb8846e6a2ad431ed4537ee26f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 20 12:05:22 2013 +0000

    Remove spurious blank line in the logs.

commit 855824569737bdb00f35cd519ff0b21b26b5086a
Merge: 0e49854f2 e29e8ccbb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Feb 20 11:17:45 2013 +0000

    merge bug25418 into default

commit 0e49854f215e0a0eee3c8a7c1aa35293f835c83d
Merge: 5e7d0a330 8eff49938
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 19 13:16:14 2013 +0000

    stable to default

commit 8eff499387fe01afeeb8f6d22ab06a919918b779
Merge: 481d63588 8cf672bad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 19 13:11:39 2013 +0000

    Merge bug25457

commit 8cf672badbd1570eb7e079b872ca6b892c833d27
Merge: 81c92d528 73fc255b3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 19 12:55:50 2013 +0000

    Merged bug25456 into stable

commit 73fc255b30001084aa5a201de2a5e8f1849db18e
Merge: cb4b76b94 9b2e2d226
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 19 11:36:01 2013 +0000

    Merged bug25453 into stable

commit 481d635889adaa7d1fdfe884453ae42b19d6c89b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 18 18:34:20 2013 +0000

    Ensure that we resume socket reading in all edge cases
    Specifically in all the cases where handle_other might have changed
    the connection_state.
    
    This is most straightforward and obvious to guarantee by always
    invoking recvloop after handle_other, unless we are stopping.
    
    This does expose an inconsistency in the various non-throw/exit
    termination cases: two of them were returning State, the other
    ok. Let's go with the latter; it's easiest.
    
    We also take the opportunity to eliminate 'Deb' from the handle_other
    signature. This is only needed in the {system, ...} message case,
    which we now handle specially.

commit ec805b6b663515a9aad7d8f4b4f3deb30aab613f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 18 16:47:40 2013 +0000

    cluster_cp_mode

commit 81c92d528d80ece38df966905e7ed48592778019
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 18 14:37:00 2013 +0000

    Remove rabbit_runtime_parameter:validate_clear/3, and instead just validate that the parameter exists.

commit 5e7d0a33022b12cb128356c35b0fd601e457bf17
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 18:55:47 2013 +0000

    explain a reader sublety

commit 25118198ee266ce6864eef53740fa9346d97af45
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 18:55:22 2013 +0000

    refactor: more symmetry in rabbit_reader:handle_dependent_exit/3
    It makes no difference whether we call handle_exception before or
    after control_throttle, so lets use an order that more clearly calls
    out the similarity to the controlled exit case.

commit 9028ebe3094681fdf6f2efb9f98c36cb155f8b02
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 17:27:47 2013 +0000

    make reader's handling of channel.close_ok more obviously correct
    by re-introducing a call to control_throttle.
    
    This was present in 3.0.x, and is needed there, but is actually not
    needed here, due to other changes made in the area. But the reason is
    quite subtle...
    
    For control_throttle to do something here, the channel_cleanup would
    have to be called for a channel for which we have run out of
    credit. Now, credit is only consumed when sending content-bearing
    methods to the channel with rabbit_channel:do_flow. There is a
    subsequent invocation of control_throttle in the code which will set
    the connection_state to 'blocking'. But this is immediately followed
    by a call to post_process_frame. The frame we are looking at must be
    the last frame of a content-bearing method, since otherwise the method
    would not be complete and we wouldn't have passed it to the
    channel. Hence that frame can only be a content_header or, more
    likely, a content_body. For both of these, post_process_frame invokes
    maybe_block, which will turn a 'blocking' into 'blocked'. And from
    that point onwards we will no longer read anything from the socket or
    process anything already in buf. So we certainly can't be processing a
    channel.close_ok.
    
    In other words, post_process_frame can only be invoked with a
    channel.close_ok frame when the connection_state is 'running', or
    blocking/blocked for a reason other than having run out of credit for
    a channel, i.e. an alarm. Therefore forgetting about the channel as
    part of the channel_cleanup call does not have an effect on
    credit_flow:blocked(). And hence an invocation of control_throttle
    will not alter the connection_state and is therefore unnecessary.

commit 6ed0fcc1dfa1b3bd0fd4149722fe08715aa050ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 16:14:14 2013 +0000

    make reader's handle_dependent_exit clearer
    - handle the no-op case (controlled exit of a channel we've forgotten
      about already) explicitly
    - better clause order and formatting.

commit cb4b76b9434af1f2ac04523e9a5728b95c91ba94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 15 14:30:38 2013 +0000

    Take note of RABBITMQ_SERVICENAME, same as rabbitmq-service.bat does.

commit e19046ef3d6763bec4a1bdcadf3c7eec3b107f0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 15 14:21:30 2013 +0000

    It's 'name', not 'key'.

commit aca93ada1d1dbfe6e3c425640a226261963a872a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 15 11:44:05 2013 +0000

    Typo

commit 54d8919bebeef38d0e11e2e429388432706ee097
Merge: d26fd217e 4451bd6ab
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 15 11:26:39 2013 +0000

    Merged bug25247

commit 4451bd6ab8050c9b401c8a49b794ff704495a19d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 00:02:52 2013 +0000

    tweak

commit e35933247f536b7ffd089853f3d26757f1b0f9fa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 15 00:02:15 2013 +0000

    explain

commit ccbc2ff0c5e452f1c290d2bea33db35765c7e35f
Merge: 9b2e2d226 4790be2e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 15:32:32 2013 +0000

    merge stable into default

commit 9b2e2d226cbedf57ed1fbe11d8b9c32fb31239c0
Merge: 8f9b7086d c1d018841
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 15:32:15 2013 +0000

    merge bug25419 into stable

commit 8f9b7086d36b92f899e14feba9664bbc002b072e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 15:31:58 2013 +0000

    cosmetic

commit 595071076098351072c72a01a029094413d635a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 14 13:09:38 2013 +0000

    In case the containing process is trapping exits.

commit 65f048d2a3ea11e99440756853a7ad8572ac30a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 14 12:51:11 2013 +0000

    Don't stomp on the (possible) registered name of the thing that invokes boot/0 or start/0, create a new process to hold the name instead.

commit 57afadecee8ac16a90c14449e86854eb2d0a5b09
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 14 12:24:53 2013 +0000

    If we try to stop while starting, wait until we have stopped starting before stopping.

commit 6752bb76125d50c0e69c2ea9367f017c0fca40b2
Merge: 16c725b4b 4790be2e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 11:47:04 2013 +0000

    merge default into bug23749

commit 4790be2e427a1e5d0b429edb4166d4a71797d11c
Merge: 94bc4059a 5209bbcfd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 11:45:42 2013 +0000

    merge heads

commit 94bc4059a2a34dc1b9136dece10ba4db9bf53b4b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 14 11:44:47 2013 +0000

    remove superfluous vqstate field

commit 5209bbcfd8757073220ee75cf5e1c676f8aba163
Merge: ce0244cb0 443d7b880
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 14 11:41:15 2013 +0000

    Merge bug25451

commit ce0244cb0ca2338e92884f54cae5af0a984e7e1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 13 21:25:44 2013 +0000

    drop_expired_msgs only when the queue head changes
    And on recover. And when the timer goes off. That's all we need.
    
    new call sites:
    - in deliver_or_enqueue/3, when enqueuing a message (that we couldn't
      deliver to a consumer straight away) with an expiry to the head.
      the queue. NB: Previously we were always (re)setting a timer when
      enqueuing a message with an expiry, which is wasteful when the new
      message isn't at the head (i.e. the queue was non-empty) or when it
      needs expiring immediately.
    - requeue_and_run/2, since a message may get requeued to the
      head. This call site arises due to removal of the
      run_message_queue/1 call site (see below).
    
    unchanged call sites:
    - init_ttl/2 - this is the recovery case
    - fetch/2, after fetching - this is the basic "queue head changes"
      case
    - handle_info/drop_expired - this is the message expiry timer
    
    removed call sites:
    - run_message_queue/1 - this internally calls fetch/2 (see above) but
      also invoking drop_expired_msgs at the beginning. This now happens
      at the call sites, where it is necessary. Which actually only is in
      requeue_and_run, and not the others, none of which change the queue
      content prior to calling run_message_queue/1
      - possibly_unblock/3 - unblocking of consumers
      - handle_call/basic_consumer - adding a consumer
    - handle_call/basic_get, prior to the call to fetch/2.
    - handle_call/stat

commit 9df36f314073d5e174b18d637399fd49587dbeec
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 13 21:22:54 2013 +0000

    don't invoke run_message_queue in handle_cast/run_backing_queue
    Since that would only be necessary of the BQ:invoke modified the
    consumers, which it can't, or added messages to the queue, which it
    shouldn't.

commit 443d7b8806d63579364b59b2e56b58774c548179
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 13 15:20:34 2013 +0000

    Today's arbitrary startup banner change: centre the rabbit.

commit 4281b92a3ee33e668a392faa45b7d8d30be5fb10
Merge: 214cb62d0 c1d018841
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 13 11:21:35 2013 +0000

    stable to default

commit c1d018841c239e06eb2634a0964555831a79efde
Merge: d4ad5d0e1 efba058a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 13 11:16:50 2013 +0000

    Merge bug25448

commit e29e8ccbb9447565613055dedd5ca1c98141c799
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 13 10:57:31 2013 +0000

    Auto sync when policy changes to require it, in case we are already mirrored but have unsynced slaves at that point.

commit d4ad5d0e15e6d5a885aac2539939469e6e7cb7e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 12 22:34:33 2013 +0000

    drop expired messages post basic_get
    ...so messages with an expiry that are at the head of the queue after
    a basic.get do not get stuck there in the absence of other queue
    activity.
    
    Rather than simply adding a call to drop_expired_messages/1 after the
    call to fetch/1 in the basic_get code, we insert the call into
    fetch/1, which allows us to remove it from the other call site. Thus
    fetch/1 preserves the invariant we are after, namely that whenever a
    queue has a message at the head with an expiry, there is a timer set
    to drop said message.
    
    Note that the message count returned by basic.get does not reflect the
    dropping of expired messages after the fetched message. That's ok
    since we make no guarantee that messages are expired straight
    away. And note that on 'default' (rather than 'stable') the behaviour
    is actually different; due to various other changes there we will in
    fact return the reduced count.

commit d26fd217e64a1f28a4a4e5667c13c3d7c21fe7d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 12 21:57:24 2013 +0000

    remove icky use of element/2

commit cd41df2496814386fb0ce16127f5a7566af27399
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 18:04:31 2013 +0000

    Tweak nodes policy to allow master removal and thus queue migration

commit 214cb62d06a9aca9e1f6531404b403e8552fb5ae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 12 17:46:50 2013 +0000

    optimise

commit 16c725b4bff4b00193eeb843bd5da328b6430f7e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 12 16:50:25 2013 +0000

    simplify & optimise maybe_send_drained
    - use BQ:is_empty instead of BQ:len
    - make use of Stop flag

commit c0d67a8548145383d3f62076e855ba97209d916f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 16:26:23 2013 +0000

    Clear drain flag when we run out of credit.

commit 4620410d0be26a38b0224b6a1faed51da8459451
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 14:57:59 2013 +0000

    Remove tags from blocked_ctags when a consumer goes away.

commit ae37cc66edccd148e8112be56a719f8d5b51b722
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 14:55:13 2013 +0000

    Move blocked_ctags into the limiter.

commit bee039366958ff6643e5d7fc8701581103749854
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 14:39:23 2013 +0000

    s/q_state/credits/g

commit fa52eaf48bb26bb8439e41b405bb4c0a0efab3da
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 13:30:30 2013 +0000

    Move rabbit_channel:send_drained/2 invocations into the queue module, and make sure we send drained for all consumers in drain mode.

commit d0bb738c7a499ad75f3fab54947ce01ce8397940
Merge: 2e23ff2c1 0b2f9fe97
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 12 11:48:48 2013 +0000

    Merge bug25044  (fa1429850857)

commit e2333d618ee4afce1b2a7a8fca869af8b5c4d928
Merge: 0b2f9fe97 bde44f20e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 12 11:44:23 2013 +0000

    Merge default

commit 0b2f9fe9775bb04bfdde3d6cabf0cfcc5df1fd9d
Merge: 9e10a9db2 179256f56
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 12 11:39:47 2013 +0000

    Merge heads

commit 9e10a9db2a9c1d6589e72059c3f0cc80e4d01bea
Merge: e8297a461 2ba43b474
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 12 10:46:11 2013 +0000

    Merged bug25044

commit 179256f569b4d9cb730ff0868e708d57fee9e6e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 12 09:35:45 2013 +0000

    startup logging tweaks

commit bde44f20e8bb44411eec6a1dcdfb20f4fb290aa4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 11 18:38:49 2013 +0000

    minor optimisation

commit 89d1e2e531278af9bcd0813970d809fb07404bbe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 11 17:44:40 2013 +0000

    Tweak the message to make it slightly more obvious if it has hung.

commit b928b4570ee97ebfd60df6cbfbffd91c406ffb5f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 11 14:16:29 2013 +0000

    some inlining and moving around

commit 4eb1daea4720b59d33e421cc1287ad9c614f789b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 11 13:57:48 2013 +0000

    a spot of inlining

commit 0d320d66d5f5e63adc564f37006869364795bbc0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 11 13:13:50 2013 +0000

    First pass at ha-sync-mode.

commit 79e6a959e132a14ab9cfd497149c446fd18be140
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 11 12:01:18 2013 +0000

    a little bit of refactoring of channel.flow code

commit 2e23ff2c130fad7ec30ee5587ffd45d6b20d1212
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 11 11:22:24 2013 +0000

    That doesn't need a name either (in fact even less so, since it never ends up in the registry).

commit e8297a461f9f5024ad104ea4b15557d5aff22f80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 8 16:09:30 2013 +0000

    Don't repeat yourself.

commit 2ba43b47431249ef7d5ec79941bbc1a7c5ca050c
Merge: 9e8ce2d52 efba058a3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 8 11:15:09 2013 +0000

    Merge stable into default

commit efba058a32c682fdb29012d987405c246cb9ed07
Merge: deca12701 65f0066ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 8 11:09:56 2013 +0000

    Merged bug25443 into stable

commit 9e8ce2d52f79f8cfdc11120eee45e83f2eb7d8e8
Merge: 74b0c9eda 6792f0d4d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 8 10:53:02 2013 +0000

    Merge bug 25429

commit 6792f0d4d92a22b9e569d2c4abdecfd04e572c62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 8 10:52:46 2013 +0000

    Change to 'confirms' | 'other' | 'false'

commit deca1270111b0cac2e7a8afb2105b9b65951d407
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 6 17:31:27 2013 +0000

    Only delete queues for which no HA policy exists.

commit 6f61770dcc3a38fe20b8db06723671a7bc65018b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 6 17:11:20 2013 +0000

    Remove durable queues based on a node while forgetting that node.

commit 74b0c9eda2321ae8385b56742e63560aabece8b1
Merge: 20da9e08a 5fd0526da
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 5 11:38:59 2013 +0000

    Merged bug25433 into default

commit 5fd0526da693d44954724cdd24ac64681616c5ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 5 11:12:48 2013 +0000

    Spelling

commit 20da9e08a9f5f9ed6c666801f25c100a453f44e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 5 10:48:33 2013 +0000

    Slightly cleaner logging at startup: make the plugin list look nicer.

commit 65f0066ed900aa59d5a6b0b3f764a96c1aa97f7b
Merge: 99f461bbb 4d39eb3f1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 5 10:43:21 2013 +0000

    Merged bug25435 into stable

commit 5a7b5b339a592e23a216f290d08a16b114bdef8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 5 10:42:25 2013 +0000

    Slightly cleaner logging at startup: don't repeat the RabbitMQ or Erlang versions, and split copyright out into its own log message since it is not like the other bits.

commit 4d39eb3f134919353491601a208e86d3a362f2fe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 4 10:56:25 2013 +0000

    We depend on xmerl via mochijson2.

commit 2aeb9b45d09c9f29c4395854d7a34f3e85751249
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 1 16:34:51 2013 +0000

    rabbit_parameter_validation:enum/1

commit 3d30fad7656b6a7bd2576ed7b87a9116f63f2816
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Feb 1 14:02:49 2013 +0000

    avoid badmatch in handle_info/delayed_restart

commit e88fa5a99ea20cf779889cb3f432a2a885e241bc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Feb 1 11:02:19 2013 +0000

    Ensure supervisor try_again_restart observes delayed restart

commit f6279e1ade3cd11cc92231d363a82216702a7aa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 31 15:23:50 2013 +0000

    Avoid always going through with_exit_handler/2, since that's what the comment says!

commit 99f461bbb7d69db05bfd35258c99a5c005cc68d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 31 13:26:42 2013 +0000

    Added tag rabbitmq_v3_0_2 for changeset bf11b947abb9

commit b7341801db96959927882c82848eb491e3c4f0a0
Merge: 61e3f3ab3 cd85e92c7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 31 12:32:06 2013 +0000

    merge bug25428 into bug25429

commit 819bc71fe544f8d26cf5c7c704bd7b3b663e1c5c
Merge: cd85e92c7 eeccaf341
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 31 12:26:52 2013 +0000

    Merge bug25428

commit cd85e92c73b441b208df700ac0a372761f88fba8
Merge: 47e4a4047 eeccaf341
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 31 12:24:54 2013 +0000

    merge default into bug25428

commit 61e3f3ab3d504fd7b489208076c082679b06d6de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 21:16:03 2013 +0000

    ask qi whether it needs sync'ing, and why

commit 96de0eae275554b09499860a24b8f923b14245ee
Merge: 47e4a4047 6c0546e98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 20:56:45 2013 +0000

    merge bug25428 into bug25429

commit 47e4a40472cddee7e00ddaed8817ee9c7235b3bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 14:29:16 2013 +0000

    reduce the default qi journal size
    a large journal size improves performance by
    - writing larger blocks to disk in one go (since in many scenarios we
      end up writing the entire journal in one go)
    - reducing fsync frequency (since in many scenarios we only sync when
      rolling the journal)
    - records for messages which get published, delivered and acked in the
      lifetime of a journal don't need to be written to segment files. To
      the point where we may be able to skip writing segment files
      altogether.
    
    BUT a large size also has downsides:
    - increased memory consumption
    - increased amount of data loss in the event of a crash
    
    So how do we pick a figure? Well, ultimately we may want to
    dynamically adjust the size based on memory pressure, but that is a
    fairly involved / risky change. Meanwhile, what would be the *lowest*
    figure that still delivers all of the benefits, just somewhat less
    than currently?
    
    A single qi segment holds entries for 16k messages. We want the
    journal to be able to hold at least an entire segment's worth of
    publishes, delivers and acks, which would be 16k x 3 entries. That way
    the aforementioned segment write reductions can happen when the queue
    is small.
    
    However, with a size of *exactly* 16k x 3, we would generally
    only avoid whole segment writes when messages get published, delivered
    and ack'ed straight away, which only happens when consuming in noack
    mode from empty queues. So we want to add some headroom in order to
    extend the benefits to a wider range of modes of queue operation.
    
    Hence 16k x 4 is a good choice. It should allow most "near empty" fast
    moving queues to avoid segment writes.

commit da3e951457e40a45d78f89995654e7434a3736c9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 14:05:08 2013 +0000

    don't hold on to 'complete' in-memory qi journal entries
    When a pub, del and ack for a message are all recorded in the journal
    then we don't bother writing any of that to the segment files when the
    journal is flushed, since the message is well and truly in the past
    and forgotten. So... there is no point keeping the entry in the
    in-memory journal either, where it just eats up space until a flush
    for no good reason.

commit 3f15c30196f250ebb2d76e604a0bce7d72b2a056
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 13:41:28 2013 +0000

    only keep track of *unconfirmed* unsync'ed messages ids in qi
    ...so we don't bloat memory with stuff nobody cares about, and reduce
    the qi->queue callbacks (to zero when no confirms/tx are used)
    
    This does expose qi to a bit more messaging semantics, but imo to an
    acceptable degree.
    
    related changes:
    - rename the state var to better capture its (revised) meaning
    - only invoke the OnSyncFun when we have something to say

commit 9e30dc1f3fbb472356a18d12577c974e11815492
Merge: 0b2e42480 ba3596c93
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 30 11:09:17 2013 +0000

    Merge in default

commit eeccaf3415daf5dbc76d6ed4ca9a52d7624f0cbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 30 11:07:10 2013 +0000

    remove out-of-date comment

commit ba3596c93db546433e466a43b4f4d66bd665239b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 29 17:50:12 2013 +0000

    remove spurious generality
    after spending hours trawling through the qi code and its history,
    Matthew and I are convinced that qi:add_to_journal/3 is unnecessarily
    general, handling a case that can never arise, namely adding an 'ack'
    when we do have an entry for the given sequence number but that entry
    does no contain a 'del'.
    
    add_to_journal/3 gets called, indirectly, from four places:
    
    1) load_journal/1. This is always called with no segements in the
    State. So all the segment journal entries originate from the very
    add_journal/3 code. And the only way we'd end up with an entry of the
    form {Pub, no_del, no_ack} and get an 'ack' is if the journal
    contained a pub and (later) an ack, with no del inbetween. That can
    only happen through a misuse of the qi API. Which doesn't happen. And
    there are plenty of other cases (e.g. duplicate dels or acks) where qi
    insists on callers doing the right thing.
    
    2) publish/5
    This ends up adding a {?PUB, no_del, no_ack} entry, so is of no
    direct concern to our investigation.
    
    3) deliver_or_ack/3
    This would hit the aforementioned {Pub, no_del, no_ack} & 'ack' case
    only if we lost a 'del'.
    
    4) recover_message/5
    
    this only adds an 'ack' to the segment journal if either a) the
    combination of the segment entries and the segment journal produces an
    entry {?PUB, del, no_ack}, or b) it's just added a 'del' (thus making
    a {Pub, no_del, no_ack} entry impossible). Re (a)... for there to be a
    combined entry of {?PUB, del, no_ack} when the segment journal
    contains {Pub, no_del, no_ack} (which would trigger the case we are
    concerned about), the segment would have to contain a 'del' w/o a
    'pub', which is impossible.

commit 555069111963b59f8feb96146b55491c9987d694
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 16:06:46 2013 +0000

    rabbit_limiter:initial_credit/6.

commit 15d41a310fd23b8feacf8e5a9816e4912e8ea9e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 15:39:15 2013 +0000

    Derp.

commit 9559dc0143da62ce572f0b0a199573f9f7615931
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 15:26:16 2013 +0000

    Reduce distance to default.

commit 3454f1e2f1f187bd8f700f3f70f4621703a8367d
Merge: 7cc742936 491c87da8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 15:22:38 2013 +0000

    Merge default

commit 7cc7429362a997d4885da65f10c8f282f5656d12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 15:21:29 2013 +0000

    Unify the various checks before sending, and make sure we don't drop the new limiter on the floor.

commit 14a229f670e17e99d85053c094f71eadcd71fa7e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 14:50:16 2013 +0000

    inform_limiter -> credit.

commit 11c1fef51cdab63e056f3e2b455d671b73c8400a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 14:03:20 2013 +0000

    Remove knowledge of delivery-count from the broker.

commit 8eb5de94d06a81c04f3a1cfb7ec2f7ef96f52d6f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 13:56:24 2013 +0000

    Simplify: convert basic.credit_state to basic.credit_drained, which implicitly asserts that credit is 0, length 0 and drain is true, and tells you how much credit was discarded rather than the new delivery count (so we can soon remove all delivery count code from the broker).

commit aaa4d25d211830ee24495401eb96752538e1d472
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 13:39:03 2013 +0000

    Get rid of credit_map, allow initial credit setting through an argument to basic.consume.

commit 491c87da87ea7df63b6b2022e700742abbb48417
Merge: 9d4bdb413 6c0546e98
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 10:53:19 2013 +0000

    stable to default

commit 6c0546e98e8637c9eb0a3f4a74bdb902b58235d4
Merge: 551f1d441 88e48f584
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 29 10:53:00 2013 +0000

    Merge bug25420

commit 9d4bdb413b0212d615d0748c61e50e853d9cabde
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 28 20:48:06 2013 +0000

    single io:format in order to prevent output interleaving

commit ec24650af66d60c46833ba158a1349b1fee4edfa
Merge: 583c8f266 88e48f584
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 28 17:37:48 2013 +0000

    stable to default

commit 88e48f5842748c41229f6ec9df3a8b3454426cdf
Merge: b0e579e85 7d0c8669e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 28 17:37:33 2013 +0000

    Merge bug25422

commit 7d0c8669efeef28a0ce04d37c3991ac887670f8b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 28 16:17:44 2013 +0000

    ignore 'invoke' on different module
    rather than exploding.

commit 551f1d4417f019fafde2d92436a229a074904c14
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 28 13:35:18 2013 +0000

    handle all returns of mnesia:system_info(is_running)

commit b0e579e850496165fed8da9885ba4ed5b777fb80
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 28 13:19:47 2013 +0000

    remove unused function

commit d69e1c6cd680b4184460a0c29d08a407d91f3d72
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 28 13:01:27 2013 +0000

    eliminate superfluous double call

commit aefbad458fa089f1f5f9d29d4e39d97b1097695f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 27 19:29:40 2013 +0000

    move find_child implementation to a better place

commit e1ac8e04de996a44e98ae403c74b5bc59a0f181c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 27 19:29:15 2013 +0000

    cosmetic - indent like OTP

commit df2982a23d8a8872209198d968afcb405a92b3a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 27 19:28:51 2013 +0000

    move bits of docs around
    in order to eliminate "forward references" to new features

commit 2f62660e38ea34a44dbf92feba56bc6b437d31c4
Merge: 583c8f266 e16c805aa
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 25 16:48:16 2013 +0000

    Merge default into bug23749 (causing no changes)

commit 583c8f2664cb6eb119d7abd01af6701d2c6a073a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 25 15:47:22 2013 +0000

    Swap SASL and TLS header codes

commit e16c805aa3db291cd00c8be59e8e11fae439b17b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 25 15:41:15 2013 +0000

    Swap SASL and TLS header codes

commit 653437cf6c1b211a1aa30b70bd4989ba55e6eb82
Merge: f38822a99 5c8aa8095
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 25 11:57:00 2013 +0000

    merge default into bug23749

commit f38822a998f568271679bb5fedaafbf7f095c567
Merge: cd17bbf75 a3b55bafe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 25 10:55:50 2013 +0000

    Merge bug25415

commit cd17bbf75d7bf7c4107a69fdbe84f9ab9b714f73
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 19:10:26 2013 +0000

    nuke active_consumer_count

commit a3b55bafe81509b3ee6723ae7cf9f869a4bcf128
Merge: fbe6e716b 0e595a058
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 15:24:52 2013 +0000

    merge stable into default

commit 0e595a058d9851a337faaf3b5f7845d11c2ca66f
Merge: 76000f2f9 f43c487a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 15:24:29 2013 +0000

    merge bug25412 into stable

commit f43c487a9b48a386fe1f9883fec8f97f94ccf830
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 15:15:06 2013 +0000

    Don't just {reply, Cmd, State} since that will end up going into send/2 - which will decide not to send...

commit fbe6e716b9a685c1e2cab1bd58787a1ab43c91f4
Merge: bf8e9909e ec6dec590
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 13:55:35 2013 +0000

    Merge heads

commit bf8e9909ebee628de74a5e3b950571b63677a348
Merge: 2100dafce 76000f2f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 13:15:54 2013 +0000

    stable to default

commit 76000f2f9b232e4c28ab1fb48223b0710433a6d2
Merge: 4c987a1e8 b629976a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 13:12:26 2013 +0000

    Merge bug25343

commit 5c8aa8095c2b061a976c993e18c41bd18679c94f
Merge: e7d3e1c9e ec6dec590
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:10:27 2013 +0000

    merge default into bug23749

commit ec6dec59081089d9c203ef4fd139b55664044047
Merge: 2100dafce 339240846
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:09:55 2013 +0000

    merge bug25383 into default

commit 3392408467d1b3925d76dcdeb72739c95c31c182
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:09:35 2013 +0000

    improved connection refusal logic / error message
    plus some tests to go with that
    
    And a tweak to the "become 1.0" API

commit 91cce8296c69a7185aaf3bd8c6c0121bcbe05799
Merge: 2100dafce b57baf7ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:07:19 2013 +0000

    merge default into bug25383

commit e7d3e1c9e61e131afddb198651846e43729d02a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:04:19 2013 +0000

    s/become/init

commit 934cef82e3e03095cdb7c86782d44aa3bc4333da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 13:01:30 2013 +0000

    recommend sasl

commit 2100dafcef3d010d7bdef50bc968f622ef87e6b4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 24 12:50:00 2013 +0000

    Quick patch to backing queue quickcheck correcting fold fun arity

commit da2b912c353b91c34be6fa94fce189ce312b4a64
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 12:37:39 2013 +0000

    add some tests for connection refusal
    some of this is also tested in the Java client, but I'd rather have it
    all in one place here.

commit c6c1a1fb609fbbc4ed2fada1dadff18c7900d9fe
Merge: 4c987a1e8 7d255f537
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 12:03:28 2013 +0000

    stable to default

commit 4c987a1e8f80ae14d00fc952b30f59f282fd5f07
Merge: 6fdc8875d b7751b9d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 24 11:46:18 2013 +0000

    Merge bug25412

commit 51ccb4b6ed87e292b0b1f5a8360801e47c85f950
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 24 11:35:17 2013 +0000

    improve/fix connection refusal
    - respond with a 0-9-1 header when the supplied header is not
      recognised *unless* it is a 1-0 header *and* the 1-0 plug-in is
      enabled
    - respond with a 1-0 header when a 1-0 header with an unsupported
      protocol id is supplied and the 1-0 plug-in is enabled
    - log a more informative error when a 1-0 header is supplied and the
      1-0 plug-in is not enabled

commit b2bd9d180c237636e8b1894eaf7d190872fbf4f2
Merge: 7d255f537 7cb774218
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 23 16:55:19 2013 +0000

    Merge default

commit d9a16fd51273f2ba9f6d71d960fbe6b7ded44188
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 23 16:19:50 2013 +0000

    Reject AMQP 1.0 TLS requests specifically

commit b629976a61a799081d4938aaae87ee5edc8e0453
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 23 12:03:02 2013 +0000

    Update copyright 2013

commit 7d255f537200ecd16a7a706f5f773b6299606827
Merge: afe81fd2e 6ffb639c0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jan 23 11:05:43 2013 +0000

    merge bug24980 into default

commit afe81fd2e1472b59080ce2bf130562e42c1c2c25
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 22 17:53:06 2013 +0000

    Call me sentimental, but reinstate the idea of an ASCII-art rabbit...

commit 6ffb639c0684136c94ece4f1dc196bc9198a197d
Merge: 6b76cfa55 2d16aa5e0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jan 22 15:51:33 2013 +0000

    merge bug25394 into default

commit 6fdc8875d205347db625f978511c69c9eac4d980
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 15:09:33 2013 +0000

    prevent channel from sending anything after close/close_ok
    The "we have sent a close/close_ok" state is indicated by
    state=closing. Well, not quite...
    
    The channel gets into the 'closing' state via notify_queues. That is
    called in three places:
    - 'terminate' - uninteresting since we don't send/do anything after
      that anyway
    - handle_exception when encountering a channel level error, i.e. when
      we send a channel.close
    - when receiving a 'channel.close'. Note that this isn't quite the
      same as sending a channel.close_ok. That in fact happens later,
      after a handshake with the reader. But for our purposes it's good
      enough. Certainly logically it is perfectly ok for us to stop
      sending things to the client once we have *seen* a 'close'.
    
    So how do we prevent sending in the 'closing' state?
    
    Firstly, we introduce a 'send' helper that replaces all
    rabbit_writer:send_command/2 invocations and is a no-op when
    state=closing. There is one notable exception - the sending of
    'channel.close', which happens when state has already been set to
    'closing'.
    
    rabbit_writer:send_command/2 isn't the only way to send commands to
    the writer though. The channel uses a few others:
    
    - send_command_sync - this is used to send channel.close_ok. We are in
      fact in the 'closing' state at that point and nevertheless must send
      that command (this is the tail end of the aforementioned
      handshake). So it's fine to leave this invocation as is.
    - send_command_and_notify - this is used to send messages with
      basic.deliver. We make that entire code a no-op in the no-op case,
      i.e. any messages sent by queues to the channel while it is
      'closing' are simply dropped on the floor. This is TRTTD since it
      results in a minimum amount of work and is perfectly safe - no
      different to the channel terminating while those messages were in
      flight.
    - send_command/3 - this is used to send a basic.get_ok. That entire
      code - part of handle_method - is already guarded by a 'closing'
      state check that no-ops. It is also used to send basic.returns,
      which only happens in handling a basic.publish, which in turn is
      subject to the same handle_method guard.
    
    Finally, we add some optimisations to the 'confirm' and 'tx' code, so
    that all the logic for aggregating confirms and sending acks/nacks (or
    tx.commit / tx.commit failures) gets skipped when closing.

commit 2d16aa5e06577ca683ecd05787eeb2f50fc0d383
Merge: 1fc12a71e b7751b9d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 13:59:47 2013 +0000

    merge stable into default

commit b7751b9d8fa31ccc289a5708d9b0618581496b58
Merge: 6a84c254f 8e9c6fbf0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 13:59:13 2013 +0000

    merge bug25360 into stable

commit 8e9c6fbf09a85522815c70683b2d2a3ecbf2c288
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 13:58:49 2013 +0000

    one test writer is quite enough. and make it work.

commit fe93d74e591786c93f357d4fb2932657d5d57433
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 22 13:06:44 2013 +0000

    Oh yeah, specs.

commit 6367b8326aeb82d57390a370932891a4ef8ae1f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 22 12:59:04 2013 +0000

    Remove knowledge of AMQP frames from the limiter. (attempt 2)

commit 1fc12a71e1f7767d33a48ff5a17121a70a171707
Merge: 6a84c254f 0eb6e5d4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 12:50:50 2013 +0000

    merge stable into default

commit 6a84c254fc2a911a1d38383037362733841c2222
Merge: 139c8d896 c5fda3bbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 12:50:35 2013 +0000

    merge bug25360 into stable

commit c5fda3bbd210352df208df0135bbea6d02ec8f65
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 22 12:50:15 2013 +0000

    our test writer needs to do a bit more now

commit 875a3e7002880af0bb6447a49900ebc7ab635519
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Jan 22 12:16:09 2013 +0000

    revert spurious changes to test timings

commit 0eb6e5d4f9afc994d5c011fb0717bb5f5cf8897b
Merge: 78eb377dd 7a7ce2fae
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jan 21 17:08:46 2013 +0000

    merge bug25395 into default

commit 7a7ce2faee98e694f85ef754ea168deef471add1
Merge: 139c8d896 50b29333a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 21 16:38:39 2013 +0000

    stable to default

commit 139c8d89689c949fe1e82cda58ed2478354f47b2
Merge: 847da0318 d84207ac2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 21 16:38:10 2013 +0000

    Merge bug 25360

commit 50b29333af35f4a895dded6c5ef40197d82af17d
Merge: 8506db255 0ea2bd3e6
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jan 21 16:06:08 2013 +0000

    merge bug25397 into default

commit 847da03183212409889b95d9211da11d01fe0cbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 21 14:59:55 2013 +0000

    get the channel to flush the writer
    when the former is asked to terminate by the reader

commit d84207ac26d202a77def6f897bd269173ca42507
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 21 14:58:13 2013 +0000

    Backed out changeset 0ca8cbef9720
    accidentally committed on 'stable' instead of bug25360 branch

commit 6400f06e344cf98eb9174e26064513e876616ad6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 21 14:45:51 2013 +0000

    get th channel to flush the writer
    when the former is asked to terminate by the reader

commit 0ea2bd3e6d3ed5a94a60754b673fc82224a1d0b8
Merge: 757c22979 eaae2a8ff
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jan 21 14:28:05 2013 +0000

    merge bug25409 into default

commit 0fc600830c6e640c2ea67cef66f7a3fed7c9650d
Merge: 757c22979 7bb6bbe5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 21 13:07:16 2013 +0000

    Merge in default

commit 757c22979b3eed9ec19170c6b4e7de1c78f84d2a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 21 13:06:59 2013 +0000

    USe pg_local rather than an ets table.

commit 785dbad7489bd767da160e7bd7495c2f37559f1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 20 13:20:53 2013 +0000

    cosmetic: move spec of internal function and make it more precise

commit 6b76cfa55a1f512dd7cfa80f5f3394fe0778d33f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 21:32:01 2013 +0000

    populate slave's msg_id_ack with sync'ed messages pending ack

commit 7b669af1adb86025a75ae26c0821ec370b77ca5f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 20:16:22 2013 +0000

    eager sync of messages pending ack

commit 12156ae73dd2f5dcb16f3045e9b52620eddcbca4
Merge: eaae2a8ff c691aa985
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 18:58:45 2013 +0000

    merge bug25409 into bug25394

commit c691aa9855c028aeb435120c0377e467b466e0ee
Merge: 78eb377dd c8c2fc51a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 18:58:18 2013 +0000

    merge bug25395 into bug25394

commit 78eb377dd8932e56184d1ea47809f0ad2ef51288
Merge: a79781409 8506db255
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 18:49:49 2013 +0000

    merge bug25397 into bug25395

commit a797814094da8b3876d958327c1f6a088dd56efe
Merge: c8c2fc51a e65ed3d80
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 18:43:24 2013 +0000

    merge default into bug25395

commit 8506db2551ca0b4b4c457a116281fc21b140f802
Merge: c8c2fc51a 1cf724495
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 18:22:30 2013 +0000

    merge default into bug25397

commit c8c2fc51a17e913fd4c27b9793a7234899068838
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 17:03:56 2013 +0000

    add xmerl to plt so we get fewer 'Unknown functions' in dialyzer
    mochijson2 depends on it

commit 96b7f507da729af3b9cf974b3eb75f85e572bee2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 15:46:43 2013 +0000

    eliminate "Function X has no local return" dialyzer errors

commit b34e93ce0108a982fc1fe6ac94e893187dd532e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 14:56:58 2013 +0000

    cosmetic

commit eaae2a8fffcf7be00936b52507e124995556415a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 14:43:56 2013 +0000

    add a test

commit bd35f8ec214743a1f96b7a5ddd29cf1f905fd8ae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 14:20:51 2013 +0000

    add BQ:purge_acks/1

commit b0370eb8cab1251b72780f0884bc70d174c3f351
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 14:19:43 2013 +0000

    tiny refactor on variable_queue_with_holes

commit 88f1c4487b75dddf8bd21692ae4ed86fefa35038
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 19 14:17:31 2013 +0000

    cosmetic

commit 7bb6bbe5c1bad6dc4c34ff26afaf813c98dd982a
Merge: 7d3474ce5 fb3070509
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 18 14:27:43 2013 +0000

    merge default into bug23749

commit 7d3474ce5c8994e105cf6088fedba27f050d1dc7
Merge: b57baf7ef d8ebb900a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 18 14:27:06 2013 +0000

    merge bug25383 into default

commit b57baf7ef94bde1f1b16bf558892d3ef25813ad1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 18 14:04:08 2013 +0000

    fix test
    connections only show up in 'list_connections' after the protocol
    header has been sent

commit 90fa7f36263fe8d86b037628d65a87915f1a3c91
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 18 13:59:14 2013 +0000

    various reader related changes for AMQP 1.0
    - mechanism for the reader to 'become' a different reader.
    - become the 1.0 reader if an AMQP 1.0 header is presented by a client
      and the reader is present. That way we can support 1.0 on the same
      port as 0-{8,9,9-1}.
    - defer starting of the channel_sup_sup and do that in the
      reader. This allows the AMQP 1.0 reader to start its own versio of
      the sup. It also makes aborted connections less costly.
    - track connections in an ets table rather than implicitly via the
      supervisor. That way AMQP 1.0 connections can exclude themselves,
      since they are already tracked via their direct connections.

commit 81b0209f77d224e4f50c65e3f2bfc6cd94390663
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 12:34:27 2013 +0000

    Formatting tweaks

commit 18d88b9600bf8481c7482f9d57a698f5c1909b6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 12:32:50 2013 +0000

    Not sure that's worth special-casing

commit 0a3b8a3dbb9b4b7f7f8ff8820b1a6d29ac4feb76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 12:21:59 2013 +0000

    These should go to the log, they have no excuse.

commit 5f89ef77e0735125fc9ee512282bed4b77325156
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 12:18:05 2013 +0000

    Remove that.

commit 444b5278f4d2235acc327c5b76a5b92c6e872047
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 11:53:05 2013 +0000

    Don't io:format the HiPE compilation warning.

commit e32a511f94f008b8676eb85d72655ba7de4cbd93
Merge: 540ba12d7 d8ebb900a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 18 11:43:22 2013 +0000

    Merge in default.

commit 1cf7244955134036d27bc79231cdfe8846b8ad3f
Merge: d8ebb900a fdd0b49c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 19:44:35 2013 +0000

    merge default into bug25397

commit d8ebb900ad0477e737e5d20c4337e1837508348a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 18:47:34 2013 +0000

    simplifying refactor on rabbit_mnesia:discover_cluster

commit fb30705097ab61c9bc1e00b4e424353c3724348f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 17:45:03 2013 +0000

    refactor: encapsulate rabbit_connection table

commit 769508786a368ba8e02a0a9bb640d263144f8946
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 17:35:25 2013 +0000

    cosmetic

commit 1cb0327a907729c202ef6cd5fdf91da95cd9a7b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 17:32:28 2013 +0000

    cosmetic

commit f82424746f7c0ea7ca0a1f5e2c1d210752073a8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 17 17:16:46 2013 +0000

    Stick "real" 0-9-1 connections in an ETS table.

commit 5b862d05d12add1bd5c984761c6b6655ff2cddfb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 17:04:09 2013 +0000

    delay starting of channel_sup_sup as much as possible
    which makes abandoned connection attempts less costly

commit 2c8c3a0f78c16eaa0063524748a90d7d88b1f847
Merge: 6924ebe38 1161f12f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 16:55:34 2013 +0000

    merge default into bug23749

commit 1161f12f6bff0358ee91e0f9717e0a6d9a46dfb7
Merge: 5fde25524 1b485828c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 17 16:47:20 2013 +0000

    Merge heads

commit 5fde25524195896fc1d48d61b4fa8ec4c7604e7b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 17 16:46:35 2013 +0000

    Start the chan_sup_sup later, once we have committed to 0-9-1 - one less hack.

commit 1b485828c9f30e068aea69004469889b34d15835
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 17 16:43:07 2013 +0000

    allow 'become' to return, and become something else

commit d9333897e5c9e372ce849173d95b5689bea5630f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 17 16:21:19 2013 +0000

    Unwind the stack before taking that one-way trip.

commit 6924ebe38a97333bbed404e4d6ff87bb5d1dfbbe
Merge: 14853a854 dc096040f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jan 17 09:44:36 2013 +0000

    merge bug25400 into default

commit 14853a854485a3f20096eb73f03d31046e6f445f
Merge: b3431dbec 755be5f05
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 17:56:37 2013 +0000

    stable to default

commit 755be5f05eb0c5c7339e29846edf37e78cab2ab0
Merge: f0ed21ba4 f649f7e82
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 17:56:24 2013 +0000

    Merge bug25401

commit f0ed21ba4ce5a005a1dc1fa4f7657fc9acf4829e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 17:51:46 2013 +0000

    Prevent explosion if someone passes a list.

commit b3431dbec544fe3196bf79bc931c134f9cff7b60
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 16 17:17:06 2013 +0000

    cosmetic

commit e37de576a5ac321aa5e0a27f23141783c649fb21
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 16 17:11:50 2013 +0000

    remove superfluous condition

commit dfb3b2040d080c940dd71e412664f1c22c03c282
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 14:13:03 2013 +0000

    This guard is not needed.

commit d09cc2baab245168b366c0e2a1cc9490b0f828f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 13:38:01 2013 +0000

    Unbreak

commit 85e7c981bb4f289aa53a00c6220954fd1423b341
Merge: 7fca26b8c 8bd48a992
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 10:56:32 2013 +0000

    Merge bug25393

commit 7fca26b8cf85bac3270b676d2ebbedd2079501c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 16 10:55:59 2013 +0000

    ...and do the same thing here.

commit 8bd48a9921ba30f86133f6b7266af0f0d2088813
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 20:53:07 2013 +0000

    some more reader connection state abstraction
    and a slightly more logical (and efficient) handle_frame clause order

commit 215673836d360d6c385c544bbbb146127dcb70e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:50:56 2013 +0000

    API consistency

commit b30ea64551f6ee90749bd529b9970be4027279e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:49:13 2013 +0000

    cosmetic

commit bc5dba9862c7b3e39111745768c17ca53aa49e00
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:46:52 2013 +0000

    neater xref fooling

commit 27ced3c51d3bfafdc1019381ae4cdda8fa92913f
Merge: 686f29629 ddb36af57
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:42:04 2013 +0000

    merge default into bug23749

commit ddb36af57a556b9e72a43ae2a2c2f98840c7c667
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:41:10 2013 +0000

    optimising refactor of check_xref

commit 28404f68152ebcc66b43381ba9af8a3c462138b7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 18:39:00 2013 +0000

    make check_xref work when plugins dir is empty

commit 686f296296d037f9941c06ad25ad74aee5174ea5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 17:43:30 2013 +0000

    simplify bad_version error handling

commit 563d5341e9cfe609e5fc586d5613e40939aaa0e6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 17:40:06 2013 +0000

    fix typo

commit e65ed3d806d81dfddecae8ca91ad0f7266f4589c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 16:29:36 2013 +0000

    pass 'unacked' flag to BQ:fold fun
    so it can distinguish between 'ready' messages and those pending ack

commit 57e0fb90d698aefcb2aa5338bc531bfd95a2a3c4
Merge: fdd0b49c8 225a96de1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 15:46:14 2013 +0000

    merge bug25397 into bug25395
    which involved tweaking the variable_queue_with_holes result slightly,
    and ripping out a whole bunch of now-redundant test code.

commit 225a96de193daecb69ba510529186c38f7195c7b
Merge: a040c0ee3 ac9970ae9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 15:25:20 2013 +0000

    merge default into bug25395

commit 83fa71da2ee8fd01752d5be4ee2536fcb2c4f86a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 15 14:58:43 2013 +0000

    Fix the case of sending credit state back when changing credit when there are no messages in the queue.

commit 1cc0badad8e12e37850ea7903a2ad5e342c28e5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 15 14:00:28 2013 +0000

    Separate out can_cons_send.

commit fdd0b49c893b396481778951e71e1ada5e7a403a
Merge: dc096040f 2a927d330
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 13:40:51 2013 +0000

    merge bug25400 into bug25397
    which is rather conflict-ridden; essentially requiring the rewriting
    of the crux of the change in bug25400 in the context of new iterator.

commit e8dc31d0963a58283c07cd8349f12dcce1384f1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 15 13:40:02 2013 +0000

    Specs. And a function I forgot to write.

commit 407f1fef4558c23122fcc1bdd0409d5a5123157f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 15 13:28:26 2013 +0000

    Cosmetic

commit 2a927d330d2c83981e034a27474c1e9d73a104a9
Merge: 77334763d ac9970ae9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 13:25:35 2013 +0000

    merge degault into bug25397

commit dc096040f3e3fd7bf90f1935690281b3e9433a43
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 13:23:37 2013 +0000

    filter out pending acks when folding over delta

commit b3124b066dd2a3bb7138eb180e0cdf00923665cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 13:17:38 2013 +0000

    test

commit ac9970ae9bc892a75bcbfee556795cf0be39b3ca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 15 13:05:54 2013 +0000

    much more thorough testing of vq:requeue
    improving code coverage

commit b0e8c079b447a56807580781f61ae3804fb5500f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 14 17:02:50 2013 +0000

    Allow setting credit for a consumer tag that does not yet exist, since the adapter wants to do that. We leak if you set credit for a ctag and then don't consume... but the adapter never does that.

commit b2b0d1a1006c32aab0afb89430ee666e46c7cc68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 14 16:00:38 2013 +0000

    TODO--

commit d2949cfd2f4e98c4e4ea387cebae8402c5611f48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 14 15:50:45 2013 +0000

    No.

commit af8c4eb0c9a3368052235a1d61b58be52a73a019
Merge: 89803c4ff 245789cfe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 14 15:47:18 2013 +0000

    Merge default

commit 245789cfe151110e27db35ffcfd2e20cd2f59f25
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 14 15:42:00 2013 +0000

    Improve workingness further. We now should be handling multiple blocks for different reasons correctly.

commit 23bc781095fe6ef6fe886f5847bf61cb188fcdb2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 14 13:35:05 2013 +0000

    improve assertion in vq:fold test

commit 77334763de357c5f1d2db77be9d7a041c8124d51
Merge: 30654ceb0 5ac7b2885
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 14 11:40:54 2013 +0000

    merge default into bug25397

commit a040c0ee3a557103dd6965f0a694dff039b02cfb
Merge: 30654ceb0 353159a58
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 14 11:25:49 2013 +0000

    merge default into bug25395

commit 30654ceb07114057169e568ad1d99dfd217d4014
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 14 11:25:16 2013 +0000

    improve vq:fold test
    by placing some messages in q1

commit 353159a588a1481e7ead62452bef1932ecab2d5b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 13 10:59:59 2013 +0000

    refactor

commit d12b4d8e08005f97c5557f0948b3d03c15ef8c1b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 13 10:49:08 2013 +0000

    include pending_acks in 'fold'
    we implement this as a zipper over three iterators

commit d2e4fff191483fd69a5fc3eee03ba0a10a15008e
Merge: c925948f9 5ac7b2885
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 13 10:22:07 2013 +0000

    merge bug25397 into bug25395

commit 5ac7b28855c59a3e10667f372198ccd90a2105b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 13 10:21:13 2013 +0000

    cosmetic

commit 89803c4fff6febe10e582a3c2d7ef5ee003fbb70
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 23:46:19 2013 +0000

    oops; nuke unused var

commit c925948f9b22268f948a5ff0bc888e9e2a77c935
Merge: f553fc420 1bae55aeb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 23:42:31 2013 +0000

    merge bug25397 into bug25395

commit f553fc420e9b74fac660ecf8cf37a09ef926176a
Merge: bb0605e3d 41f78d737
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 23:42:13 2013 +0000

    merge default into bug25395

commit 1bae55aeb6b8222b89649809e235c7edbdbcf223
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 23:41:19 2013 +0000

    only pass the minimum necessary state to 'next'
    i.e. the IndexState. The remainder of the State is encapsulated
    inside the iterator state. Technically we only need q{1-4} and delta,
    but it's simpler and more obvious to just pass a read-only State
    around.

commit eca57a2bc9108b1b4db51e8f1a3a5d2864cec6ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 16:18:48 2013 +0000

    return MsgStatus only from iterator
    leaving the message reading to the fold

commit 388b5045e9d9329ab8a42063115dd4584a5ee866
Merge: 41f78d737 1017506c4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 16:15:44 2013 +0000

    merge default into bug25397

commit 41f78d73795134f11554072f7409f40f1a2167d2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 16:15:06 2013 +0000

    extract a vq helper fun for constructing a msg_status

commit bb0605e3d608e549bf06be2f23091dda4c9e31ae
Merge: 03865fb54 1017506c4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 12:32:30 2013 +0000

    merge bug25397 into bug25395

commit 1017506c47ea3830f5f97266b51fba2749650284
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 11:35:24 2013 +0000

    pass State to iterator
    We want to be able to zip this iterator with other iterators that also
    manipulate the vqstate. Hence we must pass the State explicitly rather
    than keeping it opaque inside the iterator state.
    
    Also, some refactoring on read_msg.

commit 5b51d0192fd863e8378c6459096942957f01e017
Merge: 03865fb54 35ab26cc3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 10:20:30 2013 +0000

    merge default into bug25397

commit 03865fb5438e067b26aa08827eb405a54d146187
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 10:18:45 2013 +0000

    cosmetic

commit 8cef73209ab118d022578de35880d80b26d9ac25
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 12 10:18:28 2013 +0000

    unmodalise vq:read_msg

commit 35ab26cc3df4935f189677ad018d10a36cfc7f99
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 11 19:39:34 2013 +0000

    implement vq:fold in terms of an iterator

commit 55920f3ff2eefe6965ca87b66445eac14522b0dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 11 18:01:16 2013 +0000

    Right. There were a lot of bugs. This fixes most of them. One major confusion was that both the adapter and the credit impl were trying to normalise against remote count, now it's just the adapter. Also when we get credit we need to unblock. Also there were various things that assumed our local credit could not go negative - well it can and we just need to wait for it to be positive again.

commit a82c107ce5fd652688811b8af057243e8086159e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 10 18:01:16 2013 +0000

    Second attempt at moving credit into the queue. This time we pretend the limiter is still doing the work.
    
    While testing this I note that the credit calculation is crazy when testing with Proton. But it was just as bad before, so let's commit.

commit ff143cf6d294182f19854cff564b7ecd76178033
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 10 15:54:35 2013 +0000

    consumer_mapping changed since this branch was last worked on.

commit 558a162cd2f02b8599a24e5cde0eb75ff3f257cc
Merge: 6a1911d8d 6ae7799ae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 10 15:38:28 2013 +0000

    merge default into bug25191
    and some tiny refactoring

commit 6ae7799ae252bbaebbff8f161b100f1312f86a1c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 10 15:34:49 2013 +0000

    cosmetic rename

commit 6a1911d8d51727ff1e882af43bb221f6ba4714ac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 10 15:12:46 2013 +0000

    send connection.{blocked,unblocked}

commit dd202cc0856298f5b04dc45e1b7a72b16b0bcc11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 9 16:09:26 2013 +0000

    tiny refactor

commit c6144b41c06e7d2c01614ae549f49073fe8af6b3
Merge: 1b9198d70 43ebab39d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 9 15:36:18 2013 +0000

    merge default into bug19375

commit 1b9198d704a32627b9190d0e9446f51af4be9f0b
Merge: 848b18968 7d1ad8a49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 9 15:22:12 2013 +0000

    merge bug25345 into default

commit 4014babf9c436b985a190baa5fc05ffc1db05783
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 9 14:52:41 2013 +0000

    I added that clause early in the history of this bug and it's always been wrong. The semantics of that line are just "set is_limit_active to false if the limiter is disabled", is_blocked (which only deals with the channel.flow case anyway) has nothing to do with it.

commit 43ebab39dd210852a71fbc9b2a6ef0ab89fa3bcd
Merge: 7d1ad8a49 6d9ab0f01
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 9 12:27:09 2013 +0000

    Merged default into bug19375

commit 6d9ab0f01da5f12ac82dad14553f07dc849df582
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 9 11:15:16 2013 +0000

    Add queue max length equivalence condition

commit 12b0dd78c7efe863ad1b0f6ccf1e0e8c12375746
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 9 11:10:56 2013 +0000

    Update dead-lettering due to queue length limit

commit 569d2d42f5c9954641b05ba22bcb7155600529d1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 18:04:47 2013 +0000

    rationalise timer maintenance
    - introduce a couple of helper functions and use them wherever we can
    - pay attention to the result of timer cancellation, to prevent
      duplicate timer creation
    - stop all timers when a queue terminates. More out of politeness than
      necessity.

commit 7d1ad8a494c051d2629c8931a3079d801c9173b2
Merge: 9d38131fc 6c04eb980
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 17:35:25 2013 +0000

    merge heads

commit 6c04eb980db74f45d1365f76eae6259f2bf17238
Merge: f649f7e82 3706818cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:48:46 2013 +0000

    merge stable into default

commit f649f7e82c2d08a57d7cf7efe8d04752bdbb4046
Merge: abd42f6c7 e72d22811
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:48:27 2013 +0000

    merge bug25353 into stable

commit abd42f6c74e17d0372bea603145a2cc3166018da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:48:04 2013 +0000

    tidy up

commit 3706818cb60bdb4372fb750d9ffd23ec93f32ecb
Merge: 78086d1cc e72d22811
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:45:24 2013 +0000

    merge stable into default

commit e72d2281129b64cb49b039bdffd882d0b0df9c87
Merge: 398f83c28 f884136a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:28:40 2013 +0000

    merge bug25353 into stable

commit 398f83c28589493ee303a33c11fe4e76c8e0ec6f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 8 16:28:13 2013 +0000

    copy change from rabbit_amqqueue_process to slave
    for consistency

commit bc0a8e7f3727db383f0cc6748dcadcc6f6dea23c
Merge: f11a139e7 1483fe09d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 8 16:10:08 2013 +0000

    Merged default into bug19375

commit 848b189689e1bc30d4e8b7b7779a0305d3511cac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 8 15:12:21 2013 +0000

    Fix docs and specs.

commit 9d38131fcd58baf8aa58b289e6b8716a6beb2a93
Merge: 78086d1cc 1483fe09d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 8 14:51:19 2013 +0000

    Merged bug25327

commit d5d767375b99934047b6f12e99ea63a7d414255c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 8 14:39:48 2013 +0000

    Stub for 1.0 support.

commit 78086d1ccf8ac89eb88d1f61d476b2b81ef6b20e
Merge: f0545ce7e 2951deede
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 8 11:30:00 2013 +0000

    Merge bug25388

commit 2951deede9846a6ff413dbb3b95a8667186ef85f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 23:05:17 2013 +0000

    optimise vq:reduce_memory_use/4 invocations
    by suppressing the call, and thus the closure creations, when
    target_ram_count == infinity

commit f0545ce7e84691d86273db3fa367efffc24f574b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 22:19:33 2013 +0000

    get rid of vq's ram_ack_index
    and instead track ram and disk acks in separate gb_trees, which is
    more efficient.

commit afebcd8aaa467f0a4f8ade278d9b4c019bf96275
Merge: 1a663a176 d9f5cf966
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 18:07:56 2013 +0000

    Merge in default.

commit d9f5cf966390120506e78265c18ac29dd9a50034
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 17:37:40 2013 +0000

    Resurrect

commit 1a663a1760ab67d00805ecb9394456586dfbde07
Merge: 644d87ace 63ecb3206
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 16:01:57 2013 +0000

    Merge bug25386

commit 711e6f221839103916de2821f6d34e8051bab4ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 15:16:20 2013 +0000

    tweak: make use of rabbit_misc:rs/1

commit 343a59f7a693ce4bad4286e2a12187946c86167f
Merge: 624ac5e44 63ecb3206
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 15:14:10 2013 +0000

    merge default into bug25345

commit 63ecb320663ff4475b7d3465eb1e8e60157c1207
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 15:13:44 2013 +0000

    tweak: make use of rabbit_misc:rs/1

commit 6ff4654eb2ff3a74d09ef79398ed2925d0540e17
Merge: d6376fbdb 47fb62495
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 13:04:25 2013 +0000

    Merge bug 25385 (into default, although it was branched from stable).

commit 624ac5e44c6b3b036bd3c059ccb193ffe217aad3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 12:39:21 2013 +0000

    Idempotence

commit 991431757e40f37cbaeccbfaf2c1ed3830f3defc
Merge: fc8ae626a d6376fbdb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 7 12:10:46 2013 +0000

    Merge default

commit 644d87ace4fd2e1f1f80925492d4d34fd35058ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 11:58:54 2013 +0000

    oops

commit de1715d5cc4dcf903d160061d6005b49aba1014e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 11:53:54 2013 +0000

    get rid of #tx{}
    and fix uncommitted_acks info item

commit bc03b828fe0e28365a88182b74fe0d4bd1a7ee6c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 11:35:28 2013 +0000

    simplify & document ordering

commit fbe14837b9dd29b9d17f542a815bac00fcdf5fe1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 7 10:52:55 2013 +0000

    record pending acks in a queue rather than set in queue process
    Just as we do in the channel; this is more efficient for the typical
    ack-in-order access pattern.
    We depend on tags being passed to the queue process in order when
    ack'ing/rejecting. This requires some slightly fiddly code in the
    channel.

commit d6376fbdbed5b36dc435cddc99a7beaa18dbe4f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 05:33:26 2013 +0000

    optimise ack collection
    for the common case of ack'ing/reject'ing the oldest tag

commit 32a50f9cebbc31b7b2a8bac295563ab9ad1907fa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 04:48:18 2013 +0000

    optimise rabbit_channel:ack/2
    - moving the ?INCR_STATS call inside the fold_per_queue fun reduces
      consing when stats are disabled
    - since this was the only call to fold_per_queue where we cared about
      the result, and we no longer do, we can switch the 'fold' to
      'foreach'

commit 18603e0edaa3c889197b27a5eb16cf5a97499e54
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 04:43:14 2013 +0000

    restrict previous optimisation, for better workingness

commit 2aa7309902c5c117ac06a16f33ea466e66ffd1b5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 03:55:13 2013 +0000

    cosmetic

commit a2c69d87b0825cc2ccbab00852c18c8426f1ba27
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 01:31:31 2013 +0000

    optimise "no confirms" case of rabbit_amqqueue_process:discard

commit 7f12ebe6bea5e2c996420870037e312a3a1cff2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 00:44:35 2013 +0000

    optimise "route to no queues" path

commit ed83bfbfc488aca848f5e554e33a7af469a0d981
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 6 00:35:11 2013 +0000

    common-case optimisations for delegate:invoke[_no_result]

commit 6081ccf5a9b438f9dd3d0bd478dc2facb79348e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 5 23:47:50 2013 +0000

    optimise rabbit_amqqueue:qpids/1 common case

commit ee0e699acdd21895d3d319d9d50be3059884852d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 5 17:04:20 2013 +0000

    optimisation: improve performance of permission cache
    Don't update the cache when the permission is already in it. This
    saves list munching and a 'put' at the expense of no longer being
    strictly LRU, but that only affects pathological cases.

commit faf6f1ae7b5423a48950104b9f762e8b0514feaf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 5 16:14:20 2013 +0000

    refactor gen_server2 debug handling
    - more uniformity
    - less code duplication
    - less closure creation -> performance increase

commit 81e79ba214082855cba118ffd9d1ac025a96ee28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 5 15:24:51 2013 +0000

    optimisation: shrink gen_server2 state slightly
    for a (very) modest performance gain, and slightly neater code

commit 47fb62495864ff3a4ef57087e85bf092f6356a79
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 21:15:57 2013 +0000

    assert queue dlx arg equivalence
    and restructure code to make future omissions less likely

commit f11a139e7a2c3d35f456c87d145220440a27530c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 20:05:51 2013 +0000

    cosmetic

commit 9bcf58e863f5f5aa7a40484c4aad810c3798eb5d
Merge: 082d22e69 fa297d929
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 20:02:36 2013 +0000

    merge default into bug19375

commit 082d22e69efb8c8593a2c0f179e3a644192196ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 19:59:55 2013 +0000

    refactor queue initialisation
    - get rid of all the 'undefined' setting, since that's the default
    - extract commonality of state initialisation

commit fa297d929f33e2bb52cacc95ca4b801d5295bf7e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 19:44:45 2013 +0000

    refactor: disentangle head dropping and publishing

commit 1483fe09d3629d88a2dce73fc23d56b4d781eddc
Merge: f2fb98dfe c95a42d52
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 19:31:13 2013 +0000

    merge default into bug25327

commit f2fb98dfe3f177d7a9a761d301eeb881b0105618
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 18:38:12 2013 +0000

    some more control flow abstraction

commit c95a42d529303180620e7075a76153160a76d0ee
Merge: 6a54dc451 75688f41e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 16:11:19 2013 +0000

    merge bug24407 into default

commit 75688f41ec73904c5f408219380222b7f6de2690
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 16:10:42 2013 +0000

    tweak logging

commit b36bf1256e3431bcfd53900318b7897a42b5a3c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 4 15:42:55 2013 +0000

    Ignore queue depth for maxlen

commit 030a92e87ecf22bb61c2bd97827be0ed7bd2d16b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 4 12:33:11 2013 +0000

    Rename depth to length

commit fc8ae626a9b2ec20af0a3fe82e3b059b2c7555c0
Merge: 563329470 34ef24463
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 4 12:24:44 2013 +0000

    Merge in bug24407.

commit dd2144243f4cb9f497a223b38dc409614cb3247d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 4 12:16:12 2013 +0000

    Remove confirm_all

commit 53d1500939b92f09c599805aafe8d5a4be1799a7
Merge: 6a54dc451 18045c8bd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 4 12:12:11 2013 +0000

    Merged default into bug19375

commit 6a54dc4518b5cc22dcbe2468ae8d99ecd06fd984
Merge: f884136a0 3fa23a6ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 02:35:53 2013 +0000

    merge stable into default

commit f884136a0ccb5462f53f83559d544297f667198d
Merge: e9fa1775f eb28ff95e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 02:35:31 2013 +0000

    merge bug25378 into stable

commit eb28ff95e06e3c335684e2d3ddf75654d0b0e129
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 02:35:08 2013 +0000

    correct and/or confusion

commit 56332947000072fcfa785a4d52384b687d5df05e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 4 02:21:40 2013 +0000

    cosmetic(ish)

commit 4ca5bdf3fc45a7e413fec1e4c4cebc3528606f01
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 22:37:00 2013 +0000

    cosmetic

commit 35f6b42368f855363d62fa931fb959bfea71d71b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 22:29:56 2013 +0000

    simplify syncer
    we don't need to track monitors

commit 60b6ee19fb3389efb24bc6d9dc2584e3486979db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 22:05:17 2013 +0000

    make credit waiting less brittle
    We were relying on running out of credit for all slaves
    *simultaneously*, which requires in-depth knowledge of the credit flow
    logic and that no other credit-requiring messages are sent to a slave
    prior to this.
    
    Fortunately, since we are running in a fresh separate process we can
    simply handle *any* credit bumping message and *any* DOWN message.
    
    As a bonus we can revert to making the type of the bump msg opaque.

commit ea2df79dbe2d66aa73ee39f576f4570d62e33ddc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 21:54:35 2013 +0000

    fix bug found by dialyzer

commit 3f082a2c3bf9292895a8f4c414ecb7a3655afb97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 21:10:51 2013 +0000

    bring up to date with 'default'

commit 0c058c97d0c108981e9d0b3188743719a78b7819
Merge: adb1808ae 3fa23a6ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 21:09:43 2013 +0000

    merge default into bug24407

commit adb1808ae2f6b57cbf9c814d46f649dc1d36d5cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 17:38:51 2013 +0000

    Specs.

commit 01cf4d99f0b32c525b07689c137db1dec29aa8e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 17:15:33 2013 +0000

    Don't use a closure for the usual cluster upgrade reasons.

commit 368f5605e9f3943dcde0f81a85af1b4e45142626
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 17:03:59 2013 +0000

    API consistency.

commit 838341fad8b34ae7457bc0c1f6b01374a32a2fa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 16:51:09 2013 +0000

    Consistency with the real slave.

commit 5746d836027a31886d4059728f0b8d7d8229a1eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 16:49:46 2013 +0000

    Explain why

commit 3fa23a6ea47e18a406281db75e5728aa8d503e25
Merge: 7d59f2418 a1141a8aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 15:11:32 2013 +0000

    Merge bug25371

commit 7d59f2418c58b9b92f4f077c59f475eb34e4745e
Merge: ec140ce9c bca38ca70
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 14:47:11 2013 +0000

    Merge bug25369

commit bca38ca706223d3469be965240ab3facaa6dc641
Merge: 4b00a2685 a87b072b8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 14:08:07 2013 +0000

    Merge bug25370

commit 4b00a268595100079effa82823c9e3607f1c4482
Merge: 4f8749372 97503565a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:58:34 2013 +0000

    Merge bug25368

commit 4f8749372ea37b0d7b83232aaf376a9495b8b621
Merge: c8a584169 377d06ff5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:38:51 2013 +0000

    Merge bug25366

commit c8a58416901a80528e97fbb528ccf01922b95759
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:36:06 2013 +0000

    Typo

commit cb8dc17ad78d0c5f99d97a9bf6e0d81e2578276a
Merge: 0a9d7e308 b7abb638b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:32:16 2013 +0000

    Merge bug25364.

commit 0a9d7e30834a15bdc89a2c20ce1a12d81dda3194
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:32:01 2013 +0000

    Explain

commit b7abb638b5b321554208aea551c5d2f83c10d5fa
Merge: 159f26245 30e4f328b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:17:37 2013 +0000

    Merge bug25367

commit 30e4f328b8625f1caf3ec305be3a3d719de13b10
Merge: 4bc282f04 a0e08a207
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 13:05:49 2013 +0000

    Merge bug25365

commit a0e08a2070a531372b6c31f1b686d8d26ba5e5e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 3 13:02:06 2013 +0000

    oops; put exception handling back in

commit 4bc282f0441ae9913b761e84c79808c8ef2ace34
Merge: efcdd4448 4ee0e6adb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 3 12:51:01 2013 +0000

    Merge heads

commit 4ee0e6adb7ce125e494aa85d8c792de7795b06a2
Merge: 0159fffa1 66c77fd41
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 3 12:47:15 2013 +0000

    Merged bug25373

commit efcdd4448dce2f72d7a610f8b2127c5b87af9229
Merge: 70817ada3 0159fffa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 3 12:46:28 2013 +0000

    Merge bug25363.

commit 66c77fd4129cbaf0f7a9c6ff83baf9b6c5a854ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 16:58:55 2013 +0000

    only retain ram msgs when inserting into pending_ack
    which keeps memory use constant during fetch operations

commit 0159fffa1ebf37b31dc97bc6e0b5a81cdb336168
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 14:54:51 2013 +0000

    refactor: return less from vq:remove

commit 02fcc0b8c7475708c818f28a8a8c9022b6f012fb
Merge: de298c26d ada42944f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 13:41:28 2013 +0000

    merge bug25372 into bug25327

commit de298c26de4b68707da041e6e4726356569f0915
Merge: c66866995 91766fb42
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 2 12:12:55 2013 +0000

    Merged bug25372

commit c668669952bb313b661d530438ea40b26dd71964
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 09:33:15 2013 +0000

    refactor: rename vq:intern_fetch to 'remove'

commit 915c84903d9850db135eafca62df86058832a3c9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 09:17:47 2013 +0000

    cosmetic

commit 05d49b4e6d0489873e5911ec64b8037172e5215d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 2 09:16:18 2013 +0000

    cosmetic

commit ada42944f5931ca278ff48009181baf6c1c68398
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 22:48:49 2013 +0000

    refactor: extract dead lettering commonality

commit a94b5a7efa82d2bab165cdc416be905616e3f4f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 21:41:29 2013 +0000

    don't send dead-lettered messages to self() during 'reject' handling
    since they all end up in the mailbox, consuming memory

commit 7ae8b196c3c1ff45e6e4c0848da0d2114f82ba4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 20:46:17 2013 +0000

    rename

commit 7fe40edd67f0a9c6b74663c0d1dbc764b72d95f4
Merge: ef8df43e7 f310b99f4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 20:26:17 2013 +0000

    merge default into bug25327

commit ef8df43e75b5002f67f4c212dd8ae13bb417c7eb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 20:25:53 2013 +0000

    cosmetic

commit 3b5d3f725c4c55f7a5cdb75ba38e2de916c506c9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 20:24:36 2013 +0000

    refactor: rename drop_expired_messages to drop_expired_msgs

commit f310b99f440b00c7c486ed53f1ba0a19b3a82692
Merge: 7ece20506 91766fb42
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 20:13:03 2013 +0000

    merge bug25372 into bug25327

commit 91766fb42e53b8f7dba65b2aaace0f08377a3787
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 19:55:38 2013 +0000

    drop IsDelivered from bq:{fetchwhile,ackfold}
    since we don't need it

commit 278b1ed237fcccf4a2af8afaa2a3c1d83ed69b9c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 18:56:06 2013 +0000

    replace bq:foreach_ack with a more versatile ackfold

commit 7ece2050636e32bb0aadc834d439db954984c207
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 16:22:57 2013 +0000

    don't send expired messages to self() during bulk expiry
    since they all end up in the mailbox, consuming memory

commit aeb7e9718835df389f993f47859c2ad9ceabd7cf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 15:06:09 2013 +0000

    refactor: less passing around of State in dl publishing

commit 9e528d69d40d101b3fba1512a988d0d5038dd36e
Merge: 55ec7b64c fe96f197b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 14:34:11 2013 +0000

    merge default into bug25327

commit 34ef2446341123de05f387f0d8e675316464e040
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 12:44:45 2013 +0000

    refactor: extract stop_syncer function

commit b7ca1bca9067ce37fd5b835c9b4d57a0a12f0185
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 12:40:17 2013 +0000

    oops

commit f1b004ae8b933a0a6a9e27a9842181cdd3ff88d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 1 12:37:23 2013 +0000

    better fun names

commit 41eb7345ced6296d445bd8cc04cc1ecacb9c0991
Merge: d02d5e93b b514728bc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 30 18:34:11 2012 +0000

    merge bug24407 into bug25345
    ...and move Info{Push,Pull} into Args, where they belong

commit d02d5e93b5fcb8b7bb4d4a5a8860c77308f491a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 30 18:13:16 2012 +0000

    cosmetic(ish) refactors on mq_sync:master_send
    - more sensible arg order (a folding function should generally take the
      element first and the acc last)
    - somewhat neater handling of the acc

commit 99e87f9d31ffed91fc049382feb3cebb7ea2e1f0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 30 15:52:33 2012 +0000

    correct docs to reflect idempotence

commit 89f781c1a191cc1ddc89b3c023c40101cc902a9d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 30 15:22:22 2012 +0000

    consistency

commit ec140ce9c61eb52c013976d42f492f4797065fd2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Dec 29 22:10:25 2012 +0000

    optimisation: macro-fy rabbit_channel:incr_stats/3
    so we can avoid constructing complex terms for stats when stats
    emission is disabled

commit 95dd596cde0a86f77e593cfb49f7a003764c3979
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Dec 29 20:40:49 2012 +0000

    small refactor

commit a1141a8aaef966c7385a7f92556e57898c0e4eb7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Dec 29 15:49:15 2012 +0000

    change rabbit_exchange:route/2's traversal order
    from breadth-first to depth-first, thus eliminating the queue
    data structure and hence simplifying the code and improving
    performance.
    
    Plus a little bit of refactoring in the area.

commit a87b072b8bf3a677bd7630024b6a9dbc22e6b18a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Dec 29 13:02:02 2012 +0000

    move tx related state fields into sub-record

commit 55ec7b64c67491976ed6be90dc449e29f756da52
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Dec 29 05:00:27 2012 +0000

    cosmetic

commit 47ed99009df40ab6e41e9fe23d0663a0447c17d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 22:29:25 2012 +0000

    optimisation: ditch guards on rabbit_misc:r/{2,3}

commit f2a3b0b709583065dfa46c8bc1c88bcff79ab775
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 22:19:47 2012 +0000

    optimisation: inline rabbit_guid:blocks_to_binary/1

commit 16c4c92f462794de9d20c24aeb8f95f7bfb8e976
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 22:03:28 2012 +0000

    optimise rabbit_trace:tap_{in,out} common cases

commit f2c3b6f40dd78ff325d3fdf3a77b2c52a9dfd202
Merge: 0ca1defab 5f3fed858
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 21:59:17 2012 +0000

    merge default into bug25369

commit 5f3fed85835ad73689d7960c148485a06e964a63
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 21:58:33 2012 +0000

    refactor: shorter/better names for rabbit_trace functions

commit 0ca1defabb8f297feb3404a208539fb67a7403e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 21:37:55 2012 +0000

    optimise rabbit_amqqueue:lookup/1 common cases

commit 9fdea0838480095fcf967a777ca63336d0a25918
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 21:29:12 2012 +0000

    optimise pmon:monitor_all common cases

commit e0c4599482c38d250269f59e76076d9841e143c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 21:15:46 2012 +0000

    optimise rabbit_channel:process_routing_result/6
    - put most common clause first
    - inline record_confirm/3

commit 97503565a78311de5dddc03e5dd6cfe764da9268
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 18:46:06 2012 +0000

    move throttle related reader state into sub-state

commit d719f0e5a2bbbaf78d1c504ecc6780fd51965eaf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 18:13:05 2012 +0000

    move some more reader state into #connection
    and also clear auth_state once auth has been completed, so we don't
    hang on to some potentially large piece of state.

commit 3c3648180b6b448ea021b8d93c9062d2813f3259
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 17:59:38 2012 +0000

    move a bunch of reader state fields into 'connection'
    These fields are constant, seldom read, and associated with the
    connection.
    Also, move #connection definition from rabbit.hrl to rabbit_reader -
    nothing else is using this and it is really private to the reader.

commit 159f2624555f552059ed855910ec538bc01352ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 14:30:10 2012 +0000

    make reader react to flow control sooner
    ...by blocking when encountering content headers/body frames, rather
    than method frames of content-bearing commands.

commit a8b7441c5a8565e71f62d804ac3ac35a296a7ea6
Merge: af5d90915 4028000d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 14:27:33 2012 +0000

    merge bug25365 into bug25367

commit 377d06ff5f61d1909024c15cb37d71270ab3458c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 28 13:40:44 2012 +0000

    get rid of rabbit_channel MASKED_CALL macro
    which simplifies the code and eliminates a performance hotspot

commit af5d9091583a1d79976cd527e0bdab28a7fda9f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 27 23:25:38 2012 +0000

    only invoke control_throttle when necesseary

commit b3620ebe26131d41c85abc7b921e9592140d28ec
Merge: 84b1ba45f 70817ada3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 27 23:24:30 2012 +0000

    merge bug25363 into bug25365

commit 84b1ba45fa38350d3ddab7b56ad9b2ec6395968f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 27 23:24:08 2012 +0000

    create branch

commit 83b38d54fc0a88b7ea42330b66be8b21a980f06c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 27 22:30:21 2012 +0000

    replace credit_flow:update/3 with a macro
    un order to eliminate closure creation and thus improve performance.
    
    Also...
    - get rid of a 'get/2' call by processing result of 'erase' instead
    - inline remaining get/2 calls for performance

commit 70817ada3cad3102d63600bc9341f9469633b2cf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 27 21:57:29 2012 +0000

    get rid of bump_reductions
    it hurts performance in some cases and credit_flow does a better job

commit 18045c8bd27a9967e4024dda79f05b35edab30d1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 18 17:34:11 2012 +0000

    Inline

commit 9e51c84f93f5c08d3e9c90b49ca744d29b32e50e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 18 17:27:44 2012 +0000

    Maxdepth argument checking

commit 0a91a8b0d65917ea6a462802ccbcb27c74c502cd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 18 17:20:02 2012 +0000

    Confirms for HA

commit 7cb7742188164cc0ce0927ee5d4983e5345e58a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 18 13:46:27 2012 +0000

    Emit final stats event for connections, queues and channels just before the deleted event.

commit ba81766281d417d1b99e7dd621766c46636f05bc
Merge: a5fc42f5a 4028000d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 18 12:46:12 2012 +0000

    Merge in default

commit a4261e5e16a10c7ea044325ecf4f2467398c92ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 17 14:08:15 2012 +0000

    Remove unused variables

commit f74b19e40ac726bc7ace43d920282da3e11febc6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 17 14:05:15 2012 +0000

    Dead-letter persistent messages differently

commit cb05332ae9ed6744d7edfc7c83845b569b59a7b4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 17 11:54:27 2012 +0000

    Whitespace

commit 5f9456cd2db7077fe368a16412f5fc6d8d3cb54c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 17 11:52:57 2012 +0000

    Ensure TTL conditionally

commit 2ddc94916b10351843664d34490fe12938afb160
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 14 16:47:14 2012 +0000

    Shortcut

commit ac195255233defa27ca4319ecba2dee6e0278991
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 14 16:26:07 2012 +0000

    Maxdepth checking with confirms and DLX

commit b514728bcce18852d5d29659ee9b383acb133d12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 15:16:43 2012 +0000

    Emit an info item as soon as we start, for greater responsiveness.

commit 134fbbc3b618a628d1323eaad618c0b84862df3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 14:25:44 2012 +0000

    Fix accidental change

commit 8b1fafcca7fe80084f12b4740366c850e748de79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 13:07:21 2012 +0000

    Cancel sync

commit 4b3c6121f420fbfadce4ca5202d53558bb0ff506
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 11:53:25 2012 +0000

    Shorter

commit d4d051ae0b5b7cc91195fc330ef7efd2532cc659
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 14 11:51:41 2012 +0000

    Better maxdepth checking

commit 2c35646ffc45c7ca262fe1c00600e0866b991c80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 11:36:02 2012 +0000

    Ensure rabbitmqctl list_queues remains responsive during sync, and emit stats events too.

commit 54082cc9333d45e2063cfe1c13a3e52a23d30e89
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 14 11:33:45 2012 +0000

    It's important to respond to this too.

commit 4028000d5fa36e4216cd8db3ad0902e02f126970
Merge: 5c6210956 e9fa1775f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 12 18:11:53 2012 +0000

    stable to default

commit e9fa1775f42a4a31ffe3ac2952edbaa979275acf
Merge: 5076a8ac8 3b4789453
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 12 18:11:40 2012 +0000

    Merge bug25353

commit 3b4789453a25f377e09bbe4d5646b9d6fc92cc83
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 12 18:11:24 2012 +0000

    Reminder

commit af9ee097d7ba21fa8d5d5069ac149c8758dd3486
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 12 17:48:56 2012 +0000

    Limit queue depth
    
    Without dead-lettering yet

commit 001dff7d25ed8b8d9f3f94b976ba6b1e1afc71c9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 11 21:55:00 2012 +0000

    make sure the stats and rate timers don't keep each other alive

commit 5076a8ac8595ab061924ca84104c5b9693146751
Merge: 1a23273b1 ddcd0a2f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 11 14:23:31 2012 +0000

    Merge heads

commit ddcd0a2f5a0d77da91701dcf56365b3ec11666bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 11 14:22:51 2012 +0000

    Changelogs for 3.0.1.

commit 1a23273b1c28ec4f2049ad159a59acfd7e0f40c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 18:15:29 2012 +0000

    Added tag rabbitmq_v3_0_1 for changeset 91df77f12b7f

commit 50ea4f716bee4fb9f4417032dd6baf9fe4bfda96
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 18:15:14 2012 +0000

    Removed tag rabbitmq_v3_0_1

commit 5c62109563c053732ccda664f30d7ba1bc4df050
Merge: ae16c7fff 387751f26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 10 18:15:01 2012 +0000

    merge stable into default

commit 387751f260096f27bc3a54e4ea8110f299ac2be7
Merge: f75987094 f5d472a1a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 10 18:13:35 2012 +0000

    merge bug25351 into stable

commit f5d472a1add8bbb2d159099d96fb8eb1f460a05b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 18:09:45 2012 +0000

    Those catches do no really do anything.

commit 066471f728bee64f29309c3c261a02e14e557e49
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 14:51:40 2012 +0000

    Call application_master:get_child/1 more like OTP does.

commit 97853ffcafcc2e93cfe918a701e5b959402d0b7f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 13:57:48 2012 +0000

    application_controller:get_master/1 can return 'undefined'.

commit ae16c7fffdb6e58ff7840d9bbc512cf8db162c8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 10 13:30:19 2012 +0000

    Fix a couple of partition-related specs.

commit f7598709411deccc072178f86c995d661800226e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 7 16:23:28 2012 +0000

    Added tag rabbitmq_v3_0_1 for changeset d538aa1bb716

commit 6058dbdf01a442e11c548ecbf739115c572f929d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 7 16:23:04 2012 +0000

    Remove spurious 3.0.1 changelogs.

commit 62b6fb9804b2c29b4583b69e11bb55fb40e0ecad
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Dec 7 13:15:38 2012 +0000

    remove compiler warning

commit e84088109e997e7f47ea723a4dba7a8795471963
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 6 17:33:01 2012 +0000

    fix spec bugs

commit 2974edf85e0bc72441ae6d6ebb09bbd64b674a21
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Dec 6 18:07:00 2012 +0100

    passes the release OS as a variable

commit c9666a0ae4fec4ea2b73a067d5c58376108acd0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 6 17:00:37 2012 +0000

    Make syncing idempotent.

commit 01c21a1fac5b5b44f5dd1ee66bcd05ee1f8155c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 6 16:52:13 2012 +0000

    Add rabbitmqctl sync_queue, and make it synchronous. Also fix the fact that we were treating "no queues to sync" as a 'normal' crash of the syncer, which... no.

commit 3d8282fd56a5bf769d08cc3040ffebb9b9c9845f
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Thu Dec 6 17:18:51 2012 +0100

    cosmetics

commit 0e1e2828748efbbe56931e682a677598bbab117e
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Thu Dec 6 16:46:54 2012 +0100

    refactors the sed bits inside the Makefile

commit 16af780fe3f698a7e4aef7a53ed33cf313206ea2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 6 13:55:06 2012 +0000

    Added tag rabbitmq_v3_0_1 for changeset 43f92e93c7d0

commit 531171498c0e682218c7b7949208d05c2f1fafb7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 6 13:50:47 2012 +0000

    Package changelogs for 3.0.1.

commit fe96f197b1cb8229a66ca337b84e64c1169b61c2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 5 16:28:25 2012 +0000

    send expired messages to self() one at a time
    which simplifies the code a fair bit and also means we don't build up
    a potentially huge intermediate data structure.

commit 2f3d6d8de8323e39ea6199db16e25503d35ee021
Merge: 753753290 2964916c9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 5 14:34:10 2012 +0000

    Merged stable into default

commit 753753290e81acfae7fa652438864c8a8590870a
Merge: 7ba4b784c c5aece619
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 5 14:33:26 2012 +0000

    Merge bug25330

commit c5aece61989043b3ce1f33bde8bc48ebadf264dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 5 14:08:22 2012 +0000

    Tweak the regex, align, and a test.

commit 29890303973a75f5afc86e902ff55dd138412577
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 5 13:50:04 2012 +0000

    Normalise credit flow quantities.

commit b2c8c2546ce85abc116b47a1da89ea508c1d1012
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 5 13:10:12 2012 +0000

    Special case the 3.0.0 version check.

commit c128db2586153123a1128a02c3dbaf7e2cd85ce4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 5 13:01:58 2012 +0000

    Move the version check fun to misc, and anchor the regex.

commit 2964916c9699ce2dde24b4fa42325d0817e4ef6e
Merge: 9bac300b6 7ba4b784c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 5 12:33:45 2012 +0000

    merge stable into default

commit 7ba4b784cc6a1c9fd38eddbb3d5a7086eb20b288
Merge: d1b51c5e4 3a3983597
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 5 12:33:12 2012 +0000

    merge bug25341 into stable

commit d1b51c5e40185e45481971d02d11f01f1cf97d2a
Merge: aced16529 278fc54f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 5 12:31:30 2012 +0000

    merge bug25340 into stable

commit 3b39bfeee1e27ad1821c22bbc42a740744e9a42b
Merge: 6299f9673 aba3e9e41
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:23:37 2012 +0000

    merge heads

commit 6299f9673cdffdf2f8a5973a5f61f00949fc881f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:15:56 2012 +0000

    infinity is always a valid shutdown reason

commit 8884581308663f55aad4cc9a1097e2c3d1b4de27
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:14:19 2012 +0000

    reduce distance to OTP - pattern match in case, not-found is always 'false'

commit b7c99598c9abdeaf46b15461796ac5f8abd9c9e4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:08:09 2012 +0000

    oops - remember to guard specs for R12B03 compatibility

commit 66272487d4e137c63189e54c82783b802583cf0f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:07:08 2012 +0000

    reduce distance to OTP - {temporary, Delay} is not a valid restart type

commit bad1ed887a1b96c7efec723b07991f9b7254500c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:04:59 2012 +0000

    use ?MODULE macro when appropriate

commit ea5440861e88527e32413ce14fe2d21cdd57f7ab
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Dec 5 12:04:08 2012 +0000

    cosmetic - reduce distance to OTP

commit 3a39835972ce47b2c394561a7df4925284f9605d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 5 11:23:27 2012 +0000

    Don't blow up if we end up talking to not-a-supervisor.

commit 278fc54f6ff9250432e140d2a8459a0a39504a05
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 4 19:57:53 2012 +0000

    reduce wrongness

commit d2ad8d29513b133ef20fee530fe820e71a8a9c42
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 4 16:37:37 2012 +0000

    Send messages immediately if we are not busy.

commit aba3e9e41069eb9eb9ca4fd54795e2db847f4065
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Dec 4 14:13:42 2012 +0000

    change comments to reflect merging with R15B-03

commit 9bac300b60ed73c9f48a4f40dde5bc2761c24adb
Merge: aced16529 6b3e481ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 4 14:00:12 2012 +0000

    stable to default

commit aced165290575062a98f6e5774c3780f40ee3dc0
Merge: 61c5c608c f0d85a5fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 4 13:59:58 2012 +0000

    Merge bug25335

commit 6b3e481aca00738b87054f4b73f44718e4d43f0a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 4 12:01:14 2012 +0000

    remove pre-0-9-1 cruft

commit 9064a1a3cee6b09d769e2725148ba8808873b579
Merge: 75356277a a1ee89152
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 4 11:17:25 2012 +0000

    Merged bug25328

commit a1ee891529c4ba0983c0fe1656211bd1f5bf8620
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 3 19:14:41 2012 +0000

    yet more tests

commit fc54e261a24bb106f06aff7c3f4585aabcc341be
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 3 18:56:33 2012 +0000

    test more

commit d11cfe841600dfdc8815790951fc1183e5a0ae95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 3 18:44:11 2012 +0000

    add test for vq:fetchwhile

commit 144e395a6d39c71371c7a1b60d1a0f11ffbec382
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 3 16:22:49 2012 +0000

    Compare RabbitMQ versions ignoring the "patch" version (as semver.org calls it). Not that we are full on semver, but close enough.

commit 61c5c608ced2897829af7ff7b6a7612728783d47
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 3 14:26:14 2012 +0000

    get rid of last remaining cross-node fun in rabbit_amqqueue
    There was no need for the rabbit_misc:with_exit_handler in
    safe_delegate_call_ok, since the error condition caught be that is
    also being caught by the check in 'filter'. Getting rid of the
    superfluous check allows us to just invoke delegate:call and thus get
    rid of the funs. Plus inline the lot.

commit 9cafb938e6f0566f324570a08751f33c79338b68
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 3 13:51:43 2012 +0000

    move generic cross-node funs from rabbit_amqqueue to delegate
    since the latter changes less frequently

commit f0d85a5fb8de75df5ea33cfc9dd9e1efe0014f9f
Merge: 79c9fa62e 490accde1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Dec 3 13:10:10 2012 +0000

    merge bug25321 into stable

commit 79c9fa62e486e073bb1dc2eb45fad2f16c254cde
Merge: 301607e1a 490accde1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Dec 3 13:08:41 2012 +0000

    merge default

commit bfc6745a292dd257348a205a627a7e97fc6ce49d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 3 13:02:30 2012 +0000

    Whitespace

commit a5fc42f5ade2eb481d0a7fe9c2c562d1be9b50c0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 30 16:37:45 2012 +0000

    Emit events on vhost creation / deletion.

commit cdd36abcd70e1a07fdd88fa1a454a7bb9ab406a5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Nov 30 11:01:16 2012 +0000

    document addition of find_child/2

commit 4e9705cbde44d7c683be725871792fff01cb8dcb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Nov 30 10:55:31 2012 +0000

    oops - we mean 'not is_permanent' here

commit b81bdd5bb6c605a03a82712cb793bd64fe33553d
Merge: 75356277a f7d037706
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 30 08:22:04 2012 +0000

    merge default into bug25328

commit 75356277a95fbd6c492e9e1370296b9a5209fc55
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 30 00:53:15 2012 +0000

    unbreak qc (hopefully)

commit f7d0377067b1abf3a113aae129b8a87452fb102d
Merge: 5ca9cdffe e3fe968b5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 30 00:36:51 2012 +0000

    merge default into bug25328

commit 5ca9cdffec98dc57e8621b479028269b88288f7c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 30 00:28:05 2012 +0000

    remove unused state var
    We were diligently maintaining ack_msg_id, but never actually using it
    for anything. And it's always been like that.

commit e3fe968b5a5df583b6d0cfeca687e1dc9b7a8893
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 22:51:37 2012 +0000

    return to a simpler, better BQ:dropwhile, and introduce 'fetchwhile'
    ...to cover the remaining required functionality, including the
    ability to process messages along the way, pass around an accumulator,
    and get hold of the IsDelivered flag (not needed in our use case but
    included for similarity with 'fetch').

commit fbdb50453c4cd746a39da27d0a6d78b12d952015
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 29 14:43:54 2012 +0000

    handle {permanent, Delay} for dynamic children

commit 11a7d24eef45f72c4b6cd6e102a8010ceb63be8e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 14:39:17 2012 +0000

    correct docs for final handshake

commit 9d493c571541575ad9e56bcd17bba28563cf31ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 14:37:13 2012 +0000

    handle the case of the Syncer dying right at the end
    which could previously leave the master blocked, waiting for 'next'.
    And move the unlinking, which allows us to ensure we don't end up with
    stray 'EXIT's.

commit 239e152a26edf7ead90bb778d8424497279f1ebb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 14:11:56 2012 +0000

    cosmetic

commit e29c8a6e7a24215179bc316612d9afa885b8805a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 14:00:16 2012 +0000

    extract logging

commit 1ad9e2cbd142ec99f6f49403c67765a208bcfb81
Merge: 1469e0a0e c29c2fcf1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 29 13:25:49 2012 +0000

    merge heads

commit 8548e950572a59635d3253c68f6f4f39e0516551
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 13:25:38 2012 +0000

    no more unused vars

commit 1469e0a0ef7f024c332bd5d42bc498ee24bc35bb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 29 13:16:04 2012 +0000

    observe use_specs

commit d15c17e58e21d831aa7619d726ef4c77296460cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 13:09:15 2012 +0000

    Don't do anything if we decided not to do anything.

commit 5a32c418160228e44db3a1845c3aadda5ee9f417
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 29 12:58:40 2012 +0000

    explain why we're not using lists:keyfind/3

commit 1fb5bcd81132bfcfc19e8c92c36edd1ee2651896
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 29 12:57:37 2012 +0000

    reduce distance to OTP

commit 8a5c69c0254bf7360b53721e501a80799ca72e04
Merge: 8deff82cb df3f4861d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:55:13 2012 +0000

    Merge heads

commit 8deff82cb919b813e4ce954ce84f62cfc1683c01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:54:28 2012 +0000

    Set depth_delta to undefined if something goes wrong. Or indeed if something goes right, but in that case we are about to overwrite it.

commit df3f4861dde951e70323c01de9ee84c44d865601
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 29 12:51:21 2012 +0000

    cosmetic, plus correctly identify provenance

commit b6bcb05215c036c67b6724bc7d9c4ababf5ed034
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:36:24 2012 +0000

    Update diagram.

commit e8b1d3b7a299c09f0d1866acf63d90b7bddb3c68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:35:00 2012 +0000

    Make sure newly-started slaves don't respond and confuse things.

commit ac19894dee2c633375bb025eab8a1806561f4b71
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:14:13 2012 +0000

    Call get_parent/0 less often...

commit 4b678aea456b4dcfb32b1d58051a6d8cd0be3a0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:09:57 2012 +0000

    Respond to FHC.

commit d663453d1e18dc36935557014756a6c7441f8c0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 12:05:23 2012 +0000

    Only respond to 'EXIT's from parent / syncer.

commit 694611f2830d0a1882f7ea065bb552a043ef75d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 11:49:28 2012 +0000

    Have slaves determine whether they need sync.

commit 46dc5f9d22bda3d4f3565b6df83aaced5ef097ab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 11:24:47 2012 +0000

    Reverse master/syncer communication.

commit 65b0ccdd03729d4fa44096f36f36868d2b864140
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 11:22:07 2012 +0000

    Oops, didn't even compile that last one.

commit 02cf4f8c70db8516b6b809b89b776da3a4bd08d1
Merge: 423fbb589 39c5bb32f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 29 11:08:18 2012 +0000

    Merge in default, and use the fold-stop thing rather than throwing.

commit e0bcb416cd7e0ec8726353e1fbee810c0300dae7
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 28 23:49:58 2012 +0100

    moves sed invocation to bash script

commit 39c5bb32fb6f61566f977ca6fde9750216237a78
Merge: f34deb61f 615ff0d8f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 19:40:20 2012 +0000

    merge bug25303 into default

commit f34deb61f904f7432b169cc5203415842920691f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 19:40:01 2012 +0000

    expand test coverage to at least two iterations of delta_fold
    previously it had no test coverage at all
    Also, re-use the same vq for all fold tests, for efficiency.

commit d65832eab1802b00f3e3553294a3052d2c9602e8
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 28 18:46:19 2012 +0100

    renames package to include "mac" in it

commit d3a94c13aff494ace39170ec02d8c4b9ab1c8320
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 28 18:33:21 2012 +0100

    cosmetics

commit 6b000267f8877d243e5e87345650a2e66a3ce9db
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 28 18:30:34 2012 +0100

    removes empty folder from the release

commit d37e9fbe5e285a1aec22045326b016519c5da51d
Author: Alvaro Videla <videlalvaro@gmail.com>
Date:   Wed Nov 28 18:09:27 2012 +0100

    refactors code to extract/load plugin code

commit 5f41c2fe2ae511e73a4d15913658964c3e65374c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 17:01:30 2012 +0000

    tweak

commit eca9f863acbe0dbeca9355cb1e14f221e72684ec
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 16:43:47 2012 +0000

    cosmetic

commit 943a738e09f5fb9bdc05dbc05c885d6e3381d0e5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 28 16:37:06 2012 +0000

    Better quickcheck test of interruptable backing queue fold

commit 1e4b9b5a71484717c43c2915ee3179cd00993d28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 16:06:53 2012 +0000

    cosmetic

commit 423fbb589dc4fbf0cb9be363a15de8f2bfbf57b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 28 15:33:48 2012 +0000

    cosmetic

commit 9518438a0a90cd9e1fdafccfca61b53e93d64466
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Nov 28 15:52:20 2012 +0100

    removes unnecessary comment

commit c108d7a983becfdf6655f23b4b464747b14787bc
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Nov 28 15:51:43 2012 +0100

    removes unreachable expression

commit 836e7f3709527e4fb4c8576d6c151e8b2614b15e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 28 14:37:44 2012 +0000

    Provide early termination for backing queue fold

commit 5e106df68b867ec9723565b2347fab9b5c69664d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 14:24:39 2012 +0000

    There is no TRef1.

commit a0de55fc6513ebdced5c325efb47f1efad9a5e03
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 14:23:33 2012 +0000

    Unshorten name.

commit 5caf83928ae3c3a047297104cf454fd8bf6a26ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 14:04:18 2012 +0000

    We should flush here too, to not leave a junk 'DOWN' message when the syncer exits. Also there's no sync_complete_ok any more...

commit 8e24822eb87de494ae875b4cfd8ee2eb25d6dde3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 13:57:24 2012 +0000

    Oops

commit fc70be4c312bfffc661840a265730f6faecc11ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 13:56:50 2012 +0000

    Diagram.

commit df6b71313d1cf383a4dca02a619077cbb28e11e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 13:41:34 2012 +0000

    Don't expose the BQ to the syncer.

commit 4eb5c2c0aac7910dc52dc23c3ebbc0ffcfaebfd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 13:02:50 2012 +0000

    Spawn a separate process to send out messages from the master. This lets us simplify some monitor and credit_flow handling. Thus also stop sync_receive_credit from being a spinloop.

commit 06ad8fde700795a99363410a41ee1875ec491191
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 12:09:37 2012 +0000

    Oops

commit 7e349890ba327d634d5771fff6ea3877f03f802d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 28 11:45:33 2012 +0000

    Various QA cleanups

commit fb167b72174df758dc35d04787f220a6947c1752
Merge: 615ff0d8f 0a808bbfd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 27 18:30:03 2012 +0000

    merge default into bug24407
    ...which involved a minor tweak since #message_properties.delivered is
    gone

commit 615ff0d8f91b95112616c9af05b48bec93e5377b
Merge: 3b58d435d 42d19be46
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 27 18:23:13 2012 +0000

    re-merge bug25303 into default

commit 3b58d435d3a5fe4775d810af4ed4c53a5034def7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 27 18:22:45 2012 +0000

    fix bug

commit 0a808bbfd471334b3a4467e44ef4f07ee1869fc2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 27 18:20:34 2012 +0000

    simplify errors

commit 554f549a691cbd5d3057ef98914f34d396370012
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 27 16:41:39 2012 +0000

    Handle update_ram_duration correctly.

commit c29c2fcf1a8b3b2ceda3e688de802b5a359edcaf
Merge: d96242128 42d19be46
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 27 15:13:11 2012 +0000

    merge default (again)

commit 42d19be46fbcc0381a0076c40ddea7d9ce212134
Merge: ac20bd9ca e3a5033d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 27 14:09:12 2012 +0000

    Merge bug25323

commit d962421283155fc580cbe59ffda2713ca30503aa
Merge: 0d91e6d00 5c6785ffd
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 27 12:48:02 2012 +0000

    merge default

commit 0d91e6d0007ac7c08b3137eb41e0da1a89a2a434
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Nov 27 12:42:10 2012 +0000

    tweak for {Mode, Delay} restart types; tweak test timings a little

commit ac20bd9caed0af14e472db3858c255dbddd8d981
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 27 10:46:33 2012 +0000

    cosmetic

commit d215ea6e9fd86d83310b130f0246c69f7c041dce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 18:08:47 2012 +0000

    Move the sync stuff to its own module

commit b53ae6dfdcc843b61b6214428157c6699027f975
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 15:58:02 2012 +0000

    Don't hang on shutdown

commit d987881d1c2e870c7acace7186ab7465ec97c2ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 26 15:36:10 2012 +0000

    remove cruft

commit c3d2001e5d60f43a6a909b2d9d9827608bc18fb4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 15:02:53 2012 +0000

    React to memory monitor and FHC messages.

commit 4f849e262b7ff7327e913b27d00ce83a6b4e0e43
Merge: 7686980bd 596aae238
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 14:30:55 2012 +0000

    Merge in default

commit 596aae238c097155b24fbc81810be33d96c63388
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 14:23:33 2012 +0000

    Improve progfess logging.

commit ef23ef410fa80c73cb84d43bde8cd80a994e6fcd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 14:13:54 2012 +0000

    Send the sync_start over GM to flush out any other messages that we might have sent that way already.

commit e3d8fac887180e047fffcdb2d1524b2a65eb8c1f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 14:03:09 2012 +0000

    Fix bugs in previous commit, and be rather more thorough about monitoring and cleaning up credit flow.

commit f8cec4d22bb841c3796a97b2b42eecb7f0817333
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 26 13:21:26 2012 +0000

    managed restarts, try-again-restart, cosmetics

commit 7686980bd151e5d3c46220bfcfcdc1b01d25b821
Merge: d51c61ebe 490accde1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 26 13:03:02 2012 +0000

    merge stable into default

commit 490accde112e4f6946705d33507b5e8af46bd358
Merge: 3df24fea2 4b084b603
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 26 12:30:36 2012 +0000

    merge bug25309 into stable

commit d51c61ebedc2bf1066d0a7176921c3b07a116568
Merge: 64f8ebd5f 0adc2020d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 26 12:08:42 2012 +0000

    merge bug25303 into default

commit 0adc2020d3665b024e3ebbca464dc0d48046d282
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 26 12:08:21 2012 +0000

    cosmetic

commit 4b084b603220019dfa9c5b161b79a803d949c5d7
Merge: d53bd76ec 3df24fea2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 26 12:07:29 2012 +0000

    merge stable into bug25309

commit fc09df6b4b12e10020ebb2a78235ffd15d7c0cbe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 12:06:20 2012 +0000

    Cosmetic

commit d53bd76ec645815b7eb04eb9415d5209b8f43730
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 26 12:04:27 2012 +0000

    recover for accidental merge with default

commit 49a8392111d5ce1e1b87e4d831a4f61f114ed9a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 26 12:02:53 2012 +0000

    Add spec, fix API, refuse to run if there are pending acks, return status, don't throw away state.

commit 64f8ebd5f654fd15c83341785680aa9995ea324d
Merge: d6da2d643 5c6785ffd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 26 11:57:18 2012 +0000

    Merged bug25311

commit 21f11548b4d0a829f207403b6882318f25ef8c49
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 26 11:36:57 2012 +0000

    Untuple fold function

commit e3a5033d09468661d401ec465b509c7e8a14f638
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 26 10:44:36 2012 +0000

    mark all messages enqueued in the slave as 'delivered'
    which is a much better than the set_delivered logic, which we can now
    get rid of.
    In doing so it also becomes clear that having the 'delivered' flag in
    the #message_properties is less than ideal. It is mutable and we never
    bothered updating vq s.t. it sets the flag correctly. So lets get rid
    of it and add a parameter to bq:publish instead

commit 5c6785ffd469f781deed3968f5e8f316eb8782aa
Merge: 417e51a28 e6cb0a71a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 24 10:14:34 2012 +0000

    merge bug25324 into default

commit e6cb0a71a160ef1ff60a4773ab16401528973cf3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 24 10:14:09 2012 +0000

    'pid' is a valid INFO_KEY
    and some code, namely the clustering tests, rely on that

commit 29cdb59f55490ee190a393b9fc03dd29fe08f142
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 17:44:01 2012 +0000

    Fix expiry

commit 108376a9fffbe57e12b39ee71ba25f7f04134b12
Merge: 187737477 fdae19d2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 17:40:37 2012 +0000

    Merge bug25303

commit fdae19d2bef119ff8652fa7a74d3e2b063ac8437
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 17:28:35 2012 +0000

    Oops

commit cfe5aa3fbf644ec69bab8a50e2c6e6bd531b1e5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 17:19:03 2012 +0000

    Flow control for the sync process.

commit 613bd3c3b1178da56a6b414f84ddd4724a8fd775
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 16:52:59 2012 +0000

    Log progress, and an important optimisation.

commit c0b8d853327b6a066bed78c8723f470a4bf9027e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 16:33:30 2012 +0000

    Cosmetic / clearer.

commit 18773747748160b411fd4cd0cbd8abcf274fc40d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 16:28:26 2012 +0000

    Add message properties to backing queue fold

commit 90d9c7cf87012a919ee8115f11017c1febf99381
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 16:00:41 2012 +0000

    Eager mirror synchronisation.

commit 417e51a2880c0b05a54a7f3c20dc93baff93d839
Merge: 78f3a848f 583e60d98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 15:29:40 2012 +0000

    merge bug25303 into default

commit 583e60d984c8eabb9de3d9e5eda9d2f1841fcca2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 15:28:45 2012 +0000

    cosmetic

commit 78f3a848f0b345d892f8cb9f07696c69d3a05dd8
Merge: 4eded04c8 5c7469091
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 15:19:31 2012 +0000

    Merged bug25315

commit acfdcf3467c90ff02f8ea14765879d5549f0f392
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 15:09:28 2012 +0000

    more precise signature

commit d6da2d6436b56dca14f89b35c1de5ded168d321c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 14:59:47 2012 +0000

    don't evict messages from RAM when inserting them into pending_ack

commit 5c74690915d038fd4c9041ba9191935cecbb29b4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 14:43:23 2012 +0000

    refactor: vq:ram_ack_index doesn't need to be a gb_tree
    a gb_set suffices

commit 51c00304584bfae6a162433821cd1ecb3e40fadb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 14:25:56 2012 +0000

    Better type signature
    
    ...and rollback amqqueue_process changes

commit e4f69d19eee26710b72aa0d94b12754cf26f005d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 13:50:37 2012 +0000

    Propagate API change

commit 301607e1af36ebe619f10821364ce3b8345f30c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 23 13:31:21 2012 +0000

    Wake up all queues after policy change.

commit 8cd3f70d0c49c6312787b0705b943607fb6488bf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 13:22:12 2012 +0000

    Backing queue fold tests

commit feef8a1342821b7d8b0810f23a2b3e4401992de1
Merge: b5a8b195a 16bb43a74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 23 13:06:47 2012 +0000

    merge bug23625 into default

commit a41217c866e8aa8edf644a81b894951b80b272c0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 23 12:28:48 2012 +0000

    Refactor backing queue delta fold

commit e7909a38340f9dc55b8c01893916ca5b6b42e368
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 17:30:21 2012 +0000

    QC test for backing queue fold

commit 16bb43a74b9e79f90f47ab75fef28b842928acb9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 22 15:50:14 2012 +0000

    Explain

commit b9f041a345223707cbb915e5ea5df132aafefb6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 22 15:50:08 2012 +0000

    Don't duplicate name.

commit 394a2efd48a336f0a9ad2927d3b6fc0db61cbf58
Merge: 262492ede b5a8b195a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 15:47:04 2012 +0000

    Merged default

commit b5a8b195a0377791c61daff9d7cb2c6b70822028
Merge: 3df24fea2 9d896f396
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 22 15:26:54 2012 +0000

    stable to default

commit 3df24fea2351d4b88b6df6cf98f4ba48d2a52c9e
Merge: cab870120 3bbc5d6b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 22 15:26:36 2012 +0000

    Merge bug25305

commit 9d896f396c3c3755769ec62ef695695eec75152b
Merge: b7cee4fca fae659cd9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 14:26:07 2012 +0000

    merge bug25314 into default

commit b7cee4fca91e4742bc06db8fc3432da330cd6f7d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 13:54:19 2012 +0000

    Rename backing queue fold

commit 4eded04c8b7e95f242801a1140f079989ad5bd6d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 13:38:36 2012 +0000

    propagate API change

commit 6127c8eb3414705077cdc3fc4d89392d4f1742d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 13:32:14 2012 +0000

    bq api tweak: don't include remaining message count in fetch/drop result

commit 262492edebca6bc504bd08201949842e80b3a24e
Merge: fae659cd9 a7bea4a0d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 13:13:08 2012 +0000

    Merged default

commit f99023b923d4670bc49578321c23798bb12e061f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 22 13:10:24 2012 +0000

    Fix a race where we decide on the BQ before writing the #amqqueue{} to Mnesia, then the policy changes and we are therefore not notified. We now only make the initial decision after we can be assured we will be informed of subsequent changes.

commit fae659cd9f15af9a9c4d4528072059b12d60af26
Merge: 3bbc5d6b5 a3d76edce
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 12:57:15 2012 +0000

    Merged stable

commit 3bbc5d6b5360ae2dfd6cde34f4b4b0049f5e9c2f
Merge: 477e71bbd 8d15d6cbe
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 22 12:55:30 2012 +0000

    Merged bug25306

commit a3d76edcebaf3abf0f1a24b0c2c5acce122467fe
Merge: 477e71bbd 567c69fb3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 11:24:39 2012 +0000

    merge stable into default

commit 477e71bbddbd6d146d285519b0d3fe54b0ceb4a3
Merge: bb7e0241a 958d777ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 11:24:25 2012 +0000

    merge bug25301 into stable

commit 8d15d6cbe7e640d7aa2d9d129b890f6f804a5d02
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 22 00:20:28 2012 +0000

    leave the ram_msg_count unchanged in BQ:fold
    since we are not moving messages *into the queue*

commit 82aabb2b759fa58403f030a24bf8f6b9382e9c6a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 21 23:51:51 2012 +0000

    add test for invoking bq:fold when messages are on disk

commit fe99c0f21a1f2207f21ce2890c1b9857aaa5d6c7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 21 23:46:19 2012 +0000

    assert after fold

commit a7bea4a0db4d7097be2257bfff797c4595955cda
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 21 17:53:18 2012 +0000

    Minimal backing queue fold

commit 567c69fb37cc569107b8e779d43d01d929772e5d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 21 15:47:05 2012 +0000

    refactor: simplify rabbit_exchange:serialise_events

commit d0b37974ecbad5d7286b16212a48c2339121ce1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 21 15:19:00 2012 +0000

    simplify & optimise rabbit_exchange:callback/4

commit 156e38650dcd268971b72314ddf3fdff13b2c85f
Author: Simon MacMullen <simon@babysimon.co.uk>
Date:   Wed Nov 21 14:52:20 2012 +0000

    Carry on if an individual notification fails.

commit 958d777ffbdd5cd534496b91ab5911852abaa37f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Nov 21 14:27:51 2012 +0000

    branch from stable, expire messages eagerly

commit 9559027eb68041f94f8e1a3021b829f2d7c3ff13
Author: Simon MacMullen <simon@babysimon.co.uk>
Date:   Wed Nov 21 14:21:54 2012 +0000

    Useful guard.

commit 7b35d72d0ef602f62389d46d08af5bd70b125f5f
Author: Simon MacMullen <simon@babysimon.co.uk>
Date:   Wed Nov 21 14:09:43 2012 +0000

    Don't try to assert result of {add,drop}_mirror.

commit 23b8a88afb18ffd5146a9b145e05dd4a110d8460
Author: Simon MacMullen <simon@babysimon.co.uk>
Date:   Wed Nov 21 13:02:16 2012 +0000

    Make start/stop mirroring into a cast not a call.

commit fa10acbf67866799453b4a697e13643951d4091d
Merge: 50d2f0084 823905219
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 21 12:52:13 2012 +0000

    Merged bug25302

commit 50d2f0084bb88dd88641c97d4081b898820ac6e3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 21 12:25:05 2012 +0000

    BQ quickcheck postcondition for drop

commit e219e395b8858db6dc02aeea23fef960c64c79c2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 17:51:33 2012 +0000

    some quick check tests
    all work ok, but then again that's also the case when I completely
    break vq.

commit 1d1bae42b0e1eba071f8893935761e8a9c02373e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 16:54:53 2012 +0000

    add test of vq:drop

commit fd950f4dceb64dfc146c7648046b1cd0c4f7f5dc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 16:12:06 2012 +0000

    assertion

commit cab8701204c13f2675d6787f88f3d094e0e0be0c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 15:54:54 2012 +0000

    ack unroutable dead-lettered messages straight away
    thus plugging a leak

commit bb7e0241a18e38c78b305f22483480b2c15dd69b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 15:33:59 2012 +0000

    create 'stable' branch

commit 8239052194cfb3881c4be4d4903204b8001a2916
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 15:12:06 2012 +0000

    remove unused vqstate field

commit b8a7a8dd6af079d250d187af7341a0085a89f112
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 20 13:34:59 2012 +0000

    introduce bq:drop/2 and use it in slaves to prevent msg fetching
    - 'drop' is the same as 'fetch' except it doesn't read messages from
      the msg store
    - slaves never fetch messages, they only drop them
    - technically, mq_master:drop doesn't need to exist, since 'drop' is
      only invoked by the slaves, but we provide an implementation for
      completeness.

commit de0d9b6a23d1ac6bcdea17d5d201cf4d3e588faa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 19 18:16:49 2012 +0000

    format mq slave message queue
    to facilitate debugging

commit b8533a53ac6fe2288ba453bca8a7537f104753b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 19 16:15:26 2012 +0000

    cosmetic

commit f78ed1078d86fc879b00c050fb1b10eb381cfe21
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 19 12:18:13 2012 +0000

    optimise "no messages dead-lettered during expiry" case

commit 0922d853ec6c8b5e8035c0f76517399371e5fc8a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 19 11:08:26 2012 +0000

    Added tag rabbitmq_v3_0_0 for changeset b7a660ce4855

commit 100b64db3d02bdce28dd13db3c090d3ff5243c60
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 19 11:07:59 2012 +0000

    Changelogs for 3.0.0

commit 471a7ab4d4ebff003cc96fb6ec1e5c7c6079a3b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 17:43:42 2012 +0000

    optimise
    this brings perf roughly on par with default

commit ece39797579874b9f53ef9829c28b662bcd48b67
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 16:53:56 2012 +0000

    identify queues by name rather than pid in channel stats
    - in deliver_to_queues, take the result of rabbit_amqqueue:lookup and
      use it to a) add entries to a QPid -> QName mapping in the state
      for all master pids, and b) setup monitors for all master pids
    - for the stats creation in deliver_to_queues, map the DeliveredQPids
      to the associated QNames, via the mapping in the State. Note that
      this will ignore slave pids, hence we only get one stat per QName
      (which is good). Also, in the event that the master died between
      lookup and delivery (and the delivery was 'mandatory'), we will not
      record any stats at all.
    - in monitor_delivering_queue, which is called by basic.{consume,get}
      we add to the mapping
    - in ack/2 we use the mapping to obtain QNames from QPids, and use
      that in stats. Since a queue may have vanished prior to the
      ack/reject arriving, we need to handle the case of no entry being
      present in the mapping for the given QPid.
    - in record_sent we have the QName anyway, so can just record stats
      against that instead of the QPid.
    - in the 'DOWN' handler we use the mapping to determine the QName from
      the pid, and pass that to erase_queue_stats, which can now remove
      entries based on the QName. We then remove the entry from the
      mapping.

commit 563b7403ef81cc761ebe39d0ed52057a871cead3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 14:54:28 2012 +0000

    propagate API change

commit c27f29a31c3e96aacc75740127db1a03e393dad7
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 15:19:23 2012 +0100

    cleans up unused/duplicated functions

commit 97f0568a869f0d31d4003d826c2bdebc8d76cb59
Merge: feffedf04 116feee56
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 14:05:28 2012 +0000

    merge default into bug23625

commit feffedf04f39664caee3d9a596650666bc764294
Merge: 56123b5fb a71184292
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 14:04:49 2012 +0000

    merge bug25297 into default

commit a71184292a78ca8dc8988652189ed84178c736e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 14:04:27 2012 +0000

    plug leak

commit 797d6d77ef2ad6a483d91fa6e3e8fe65ccae3f70
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:58:30 2012 +0100

    cosmetics + comments

commit 8357937e45f3978580e8ebe64ca22fb571d6e18c
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:30:44 2012 +0100

    removes todo comment

commit ae0e04946a83118bfdb186cad8d27de88acf62f4
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:27:59 2012 +0100

    moves the sed invocation to its own target

commit 116feee561847b945342a806a8577085199e58cd
Merge: adc9ff2ec 56123b5fb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 12:24:53 2012 +0000

    merge default into bug23625

commit e9ec553db5ec644e0122c3fed7e83e9a764e87ab
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:24:29 2012 +0100

    fixes erlc invocation for rabbit_release.erl

commit 56123b5fb924bd12be614d00ebdc59cdcb7a9133
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 12:21:05 2012 +0000

    fixme

commit b2f9d51bb666ace2212795857504a053911253e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 12:18:27 2012 +0000

    refactor stop_later
    - s/stop_later/stop
    - since it's always called with Reason=normal there is no point
      passing that around / storing it

commit ed962e5599b0ea9a932f33d2447225821820b28e
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:09:49 2012 +0100

    moves rabbit_release to the standalone packaging folder

commit ae6dc3556a2fb6995d4ce91093ae2b04befed5d5
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:09:12 2012 +0100

    renames generated tarball

commit 716cd537e680878fe5f00cdd28a1556531d8ed98
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 13:00:48 2012 +0100

    renames release folder to standalone

commit 0200a8c1803aa3fe72e3728fa89c4cc1df0a04a9
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 16 12:43:06 2012 +0100

    moves files from mac folder to release folder

commit a36ab07e92eb61af12fefea45f1eff8328654116
Merge: b9561f4c9 43a62fc9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 16 10:28:22 2012 +0000

    Merge bug25295

commit b9561f4c97a7504beb3e940238077df5a1223e11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 03:29:11 2012 +0000

    refactor: extract some helpers
    ...to make it abundantly clear which queue operations amount to an
    ack/requeue.

commit a1e21bf18db6563f3e45178cfa4da34bf1446615
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 02:23:45 2012 +0000

    refactor: simplify dlx logic top half

commit 3b432ffe15bf40647e2c63352614703cc1e34fef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 16 02:22:50 2012 +0000

    cosmetic

commit 5e2aec2b42ae5e2e74a17d556afde870cdc1d804
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 18:34:14 2012 +0000

    cosmetic

commit 5731ddd078a5223f555ccead4af5c8e901545db3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 18:05:55 2012 +0000

    inline (and avoid misleading var name in the process)

commit 43a62fc9e99894da8bef56e2e3ba536989edf88b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 15:13:16 2012 +0000

    always monitor queues from which we are (possibly) delivering messages
    so that stats associated with these queues are cleared out from the
    channel's process dictionary when these queues disappear.

commit adc9ff2ec5b21037892928ab4fe5abe50729e0d2
Merge: 124d0ac98 852e924a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 14:14:09 2012 +0000

    merge default into bug23625

commit 124d0ac98444b44caab8ed92b16174658f6d1656
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 13:53:46 2012 +0000

    refactor stats recording in channel
    - specify stats type explicitly rather than inferring it from the
      structure of the key (yuck!)
    - s/maybe_incr_stats/incr_stats

commit 852e924a06c72d5f225a865776ff5efd50ab20f3
Merge: 9df33892f e2fdce6be
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 13:04:53 2012 +0000

    merge default into bug23625

commit e2fdce6be567eb2d0cd505447a4b649e9ae0dadd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 13:04:30 2012 +0000

    inline

commit 9df33892f4d767b41a524cd96bfc361298d922ed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 12:18:32 2012 +0000

    reference queue by name in consumer events

commit 7dcae7a19906e28153410c477f6edbedafaa51e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 11:56:11 2012 +0000

    emit names instead of pids in queue process' queue events

commit c763298aba43c3f3fdc141f8fe25e9827ad3682f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 15 11:47:47 2012 +0000

    restart branch

commit 2e371d8b34ec99cffd0302ee80628b1b09c050c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 14 11:14:39 2012 +0000

    Work on older Erlang versions

commit f7405cce978ae12868927910a6fdfe1d0c2d44df
Merge: 03160aa26 7346a8252
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 13 16:33:27 2012 +0000

    Merge bug25251 (very late!)

commit 7346a8252ef5b6b9a32161a7e03b228daac062db
Merge: 7ebb283bd 03160aa26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 13 16:31:56 2012 +0000

    Merge in default

commit 03160aa26d0906212808be93fddb7879ea81a8c0
Merge: af0c3ea98 167b73311
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 13 12:58:02 2012 +0000

    merge bug24915 into default

commit 167b73311d0e38a693d822b4388c76912106a67d
Merge: 68404afcd fddfdf6e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 13 12:56:45 2012 +0000

    merge heads

commit af0c3ea98cbc8df2b63ba939455715ba8ac828c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 13 12:42:54 2012 +0000

    tweak
    - garbage_collect(self()) -> garbage_collect()
    - rename some funs / msg tags
    - cosmetics

commit 68404afcd0341ada064b985598a0c7c90b9bf772
Merge: 6948da77c 9d173072c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 13 12:03:51 2012 +0000

    Merge bug25178

commit 6948da77cff27d10171ca256f77bf465ec902570
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 13 12:03:36 2012 +0000

    And, err, this thing isn't needed any more.

commit b7e92e332963fb3259b89a57cd6781823fc6d7fe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 13 12:02:44 2012 +0000

    Explain why

commit 8fbea86ff5cc355b29fe39b6414b069a3170b515
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Nov 13 11:48:12 2012 +0000

    rabbit_node_monitor traps exits, so shutdown allows us time to flush any
    pending file system operations before the process dies

commit 04f6012ae8b04580e5e323c05a18f5971e5e0581
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Tue Nov 13 11:46:59 2012 +0000

    roll back to (almost) default - keeping the extra error information when
    corrupt cluster status files are found

commit 8b5b3eea9aeabc199322488886a96f890d1c1f7b
Merge: e0509b42a 9d173072c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Nov 13 11:37:30 2012 +0000

    merge default into bug25178

commit fddfdf6e311e65af181e52022066e939a8e29001
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 13 11:19:02 2012 +0000

    test triggering of memory alarms

commit 294ce06ff9a351e5a1ab2e7c3f004de5dba10eef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 16:55:09 2012 +0000

    Don't hibernate, GC self instead.

commit e14960e373df720bff1ec9fc3d90533b1bf6de4b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 16:52:08 2012 +0000

    Start background_gc earlier

commit 2f15c21ee37a282078b03160dd25ef972b09aaf9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 16:51:18 2012 +0000

    Remove define, change message, silence dialyser.

commit 8765d5500a52d69c029264209cae50305d455942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 16:48:47 2012 +0000

    Specs

commit adb1e775d4c02657248f37e17a1e13e9ac53a9dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 15:59:28 2012 +0000

    cast not call.

commit a4778edbbf873a8172fb4c00b8730d9c534200a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 15:44:41 2012 +0000

    Use background_gc when the memory alarm goes off.

commit bbff74af803829caa3f42b526338dd97731dabd7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 15:37:35 2012 +0000

    Decrease geometrically as well.

commit 8029ba58784e1708312fe3bd2c47f5e69db89448
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 15:37:20 2012 +0000

    Profiling suggests that garbage_collect/1 is in fact far cheaper than processes/0, so just GC all waiting processes. And therefore reduce the frequency we call this with.

commit c8df9d8ad0c7a6b500f32c71601a7daee98cc6a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 14:39:39 2012 +0000

    Only GC idle (waiting) processes. Filter tiny processes from the list (to make generating the list more efficient when there are huge numbers of processes). Probabilistic process selection.

commit 647c9680951ff1c38306672b4d92ab3fdec3e9a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 12 13:16:08 2012 +0000

    Background GC.

commit e0509b42a7cf96c393c7c1b82cac819e33923358
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 9 15:58:26 2012 +0000

    Fix idiocy

commit 3aee178e6b4371259456db72d58325af8643c466
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 9 10:58:28 2012 +0000

    replaces boot files accordingly in rabbitmq-defaults

commit 99589569dfd42c5a035bb10b750074f3761887c0
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Fri Nov 9 10:56:47 2012 +0000

    specifies boot file for erl calls

commit 0bf34e6a033b1f37f21c1e69f6c45efe74214fa8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 16:58:16 2012 +0000

    Take two monitors into the shower.

commit 804a4e3b6172b3951f929f2cb5796c41b1773af9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 16:36:35 2012 +0000

    Explain

commit 6c341072bf67f3776389f5564937686c20830611
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 16:20:26 2012 +0000

    Make the app marker into a gen_server

commit 86bad8fd00201ee7b0e3ba2ccc59382f4ae86d35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 15:11:36 2012 +0000

    Further clean

commit a8ea696e4d2d9c9c4df85f5f95ab30bf24a496cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 15:09:50 2012 +0000

    reduce distance to default

commit 3b3ca785f1e2e8ad1d3cb67f7add6e971f27b577
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Nov 8 14:52:05 2012 +0000

    introduce a noop process at the head of rabbit_sup's children,
    which we now monitor instead of the rabbit application's pid

commit 9d173072c4a3883141692c5eed3a5e09b82f87df
Merge: f1b18a480 964812a59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 14:45:25 2012 +0000

    Merge bug25260

commit 964812a5905c695ce0d75e5128d36db3097a9120
Merge: 55f56ebee f1b18a480
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 8 13:52:09 2012 +0000

    merge default into bug25260

commit 0b2e42480c62060654a5978a8724a443eb0e0cb2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 13:47:01 2012 +0000

    Make priority_queue:len/1 fast.

commit 9a91700d512aa5c8488fce8dfd1dc44892a12d99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 13:42:44 2012 +0000

    Doesn't make sense to drop calls.

commit 2c3252a5cde68ce04a579225ee0b8303667dd5ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 13:34:10 2012 +0000

    Fix arities, support 'drop'.

commit 55f56ebee232c2cbcede34d4fb31bb260ca80286
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 8 13:08:55 2012 +0000

    fix tests

commit 5a4ab1b1548638698878d435acbfe3e9e02a78ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 8 12:53:27 2012 +0000

    Pass length to prioritise_*

commit f419596afaa8229a82560577f4a43f68b95e88d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 8 12:41:39 2012 +0000

    pass q records instead of names between recovery phases
    That way we can guarantee that the qpids we are talking to in the
    start phase are the same as in the recovery phase

commit 370a0d16297e9926c08df7b0e75322c771dc2d54
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 8 12:11:25 2012 +0000

    defer final phase of queue recovery
    until routing recovery has completed
    That way dead-lettering during the final phase has all the correct
    routing in place

commit f1b18a4801eddfdcb00e54faaaccbf1d3d9a7af4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 7 21:46:02 2012 +0000

    cosmetic

commit 3720d8d32de65e33d57a4af30965d0650cf245a8
Merge: aaba39a9a de14a6616
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 7 17:53:25 2012 +0000

    merge bug25260 into default

commit fa54fcc3e5809194c3b4e474f980bb3652b71ead
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Nov 7 16:24:22 2012 +0000

    adds file to generate the erlang release

commit 985b4a10c77888e7b8f51aaaf0cf73ef0bb1fb28
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Nov 7 16:18:32 2012 +0000

    adds Makefile for standalone mac release

commit 91e3be324c5772d4d50639c2f37e3ebc0d1cc6fb
Author: Alvaro Videla <alvaro@rabbitmq.com>
Date:   Wed Nov 7 16:17:50 2012 +0000

    adds the erlang base dir before calling erl

commit de14a6616da7743104a5258d5b35898b92cdbf6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 7 14:54:33 2012 +0000

    Apply TTL after DLX, during recovery we want to have a working DLX when messages are expired.

commit aaba39a9aeb52f0b63a5e76581de8e8516ea117d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 7 10:24:59 2012 +0000

    inline

commit a23cdb3cb6ddb0bfe54ba39717722dff2d1e5894
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 16:00:07 2012 +0000

    remove cruft

commit d247248e0cb845784ba9e378c0a87cb96eb4fe5f
Merge: 646e527dd b42a7f3f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 13:06:42 2012 +0000

    merge bug25277 into default

commit 646e527dd10a18b465788a0dcc0b35b0ee2aaa2a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 13:05:40 2012 +0000

    propagate result

commit 9053f5396f955d4e63792475a648292be51de4bc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 13:04:31 2012 +0000

    send out the alarm event before gc
    so subscribers can react to it quickly

commit 75bd209f86712c07178cc737af6d86c9a68b73db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 12:57:35 2012 +0000

    cosmetic

commit b42a7f3f71386163b3cd063f2f04e3a65334ef23
Merge: 8206c8adf a0c982011
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 12:53:09 2012 +0000

    merge bug19376 into default

commit a0c98201114c44e8ece77d5385ee595fe54315fc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 6 12:52:42 2012 +0000

    use ~p after all
    otherwise we end up with {leftover_string,[102,111,111,98,97,114]} in
    the logs

commit 60b57dfff407d03b3c5245e80f5f79a98f2c1906
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 6 12:46:15 2012 +0000

    Simplify

commit e882a4ed8a411ef9f237f3c2db1eb2071a6e8d9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 6 12:33:56 2012 +0000

    GC the world when memory alarm goes off.

commit 8206c8adfa9f1dd28f740c9e827d850677f36b52
Merge: 1a6f20020 bc78eea54
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 6 12:04:20 2012 +0000

    Merge bug25273

commit 1a6f2002019b2b50b13f68cd5b8ead8141a8c946
Merge: b8de90325 42fd60855
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 6 11:51:57 2012 +0000

    Merge bug25266

commit 42fd60855b6ce60730ea89909095f0db283b5938
Merge: eabc69cc7 204965901
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 6 11:50:05 2012 +0000

    Merge bug25269

commit bc78eea54e970f5e5c25a1fdf620eef825199b46
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 18:07:34 2012 +0000

    macrofy

commit 274663ef88a8fe219f59c9746915541b5eecbd05
Merge: b8de90325 6fbb6dc87
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 17:55:50 2012 +0000

    merge bug25266 into bug25273

commit b8de90325428e9278a3b3c64e32b87d88b30b6be
Merge: eabc69cc7 486b736a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 17:45:29 2012 +0000

    merge bug25269 into bug25266
    which entails switching from funs to macros for all the new property
    decoders we introduced

commit eabc69cc78d0cb183835e80242cdbf4f923ccdb4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 17:24:58 2012 +0000

    switch back to using macros
    in order to eek out a bit more performance
    but at least make the macro signature uniform and pull out the conditional

commit 49e569d2549a60f8c73028a1c86b8a1760565024
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 15:00:50 2012 +0000

    cosmetic

commit 780c08a8557938b1395ef298552a542d5c685b6f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 14:55:54 2012 +0000

    tweak

commit 20496590140ebaf57461db4da1c1f6dfe0a5675e
Merge: d5cc6642b 596a7d9b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 5 14:48:24 2012 +0000

    Merge bug25268

commit 6fbb6dc875e75ed8c797b1a028cbcfb4c60695f9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 14:08:13 2012 +0000

    fix bug

commit c9cf8fbbbb5442e800b670d3cf18ff14707dc68f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 13:21:59 2012 +0000

    drop property codec tests
    since that part of the code is now internal and code gen'ed
    but we can still test the table codec

commit ec58eb9caf0b399afbd2c7e37c3f79d47d1fbdc0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 12:22:21 2012 +0000

    code gen property encoder
    pretty much symmetric to decoder
    Involves renaming of the decoder helper funs, since those names are
    more meaningful for the encoder

commit 91a212abeb9d6dff75d075593c6835336bd9fc5e
Merge: 596a7d9b6 486b736a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 5 12:16:26 2012 +0000

    merge bug25266 into bug25273

commit 881de92e1a3eae96c5e12e3012e2119cea62b4cc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:36:35 2012 +0000

    check_expiry_size => check_expiry

commit 566a9af96c6e3432893772a859e96ce3f9fa9dbf
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:33:24 2012 +0000

    simply >= 0 checking

commit a28877f8db894102a0eb0ff981bd3945bd8793da
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:25:10 2012 +0000

    better function names for ttl and expires checking

commit aa8f5f7605af87b50e6e5e3a39b038b43c9d5989
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:20:56 2012 +0000

    fix type specs

commit cf41870967cd5e058cab1a439b82256d02374c2d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:03:01 2012 +0000

    refactor parse_expiration

commit 7ab7f6fdd600db691c15b40787f93a1e7cb973e7
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 11:01:01 2012 +0000

    consistent error messages for invalid params

commit 8d11baeb05432146e4a2681416b03fa7db1d777e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Nov 5 10:57:53 2012 +0000

    use precondition_failed for error notification

commit 596a7d9b69eff73238b90fb9e594d21b1c04680c
Merge: 73a617fbd b797765a5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Sun Nov 4 22:05:03 2012 +0000

    Merged bug23935 into default

commit 486b736a35966898ea66a567073bda409377be24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 4 16:48:13 2012 +0000

    handle all types in property decoder

commit 58eb07c88e04999f463192dd62bd152e337593d0
Merge: 95192cea6 a6e6884e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 4 16:04:05 2012 +0000

    merge bug25269 into bug25266

commit a6e6884e1df61b19788abb57cd028541d4ff0ead
Merge: 73a617fbd d5cc6642b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 4 16:03:28 2012 +0000

    merge bug25268 into bug25266

commit 73a617fbd52d39eb0fbb7916d6e6fbdff30a5aa3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 4 09:32:01 2012 +0000

    be more assertive in property decoding

commit 95192cea6754df464c4989bdbde1143185ebdd85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 4 09:29:58 2012 +0000

    simplify property decoder
    functions instead of macros, which gives the same performance in
    the fast "no properties" path and only causes a tiny loss (if any)
    otherwise.

commit d5cc6642b8bb0d3da3899c28ffb47395087210e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 3 21:09:33 2012 +0000

    fix tests

commit 66c0c406dca52e1779a112c337ecde96c08ab503
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 3 21:04:32 2012 +0000

    ditch superfluous type mapping in codegen

commit ee42bbe7c2fb736559989c24fa3fdcf0cc8792a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 3 19:13:37 2012 +0000

    cosmetic

commit b6cee004b97505fec99980fb2f9b78d2b5a22180
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 3 17:28:54 2012 +0000

    cosmetic: vertical alignment / shrinkage

commit 4a6551ec61175cff245acdf01d88986d4e5049e6
Merge: 8ccfd23d1 1a2c5738e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 2 16:09:22 2012 +0000

    Merge bug23225

commit 1a2c5738e764a7df0361b62a3d23c5d138a08bc4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 2 09:13:44 2012 +0000

    only trigger stats emission from writers in the server
    (and not the Erlang client)
    
    The server (and *only* the server) starts channels with
    rabbit_channel_sup:start_link({tcp, ...}). Writers are created as part
    of that. We pass an extra argument to rabbit_writer:start_link in
    this case, indicating that the reader wants be told by the writer to
    emit stats.
    
    Internally, the writer handles the stats/no_stats distinction by
    initialising the stats timer differently. We introduce a new function
    to create a disabled stats timer, thus taking advantage of all the
    existing logic in rabbit_event that suppresses timer/stats operations
    when stats are disabled.
    
    This approach requires inclusion of rabbit_event in rabbit_common.

commit 8ccfd23d1792cc790e92a1d8a92c5a247f19b22d
Merge: 6d842bce6 b3e862291
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 1 16:39:46 2012 +0000

    Merge bug25262

commit b3e86229124a44ea41abcb3883abe6cce9ba7044
Merge: b83628a8a 5d7a72f96
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 1 16:39:39 2012 +0000

    Merge bug25263

commit b83628a8adaa6f057f5e4526d14b290599cdf7f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 1 16:00:01 2012 +0000

    fix heinous bug

commit 6d842bce6217a344514a4a660f3c1b8d7d78783b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 1 15:24:39 2012 +0000

    sort list_* results

commit bcb4dd60658b3095511cbf2532c5ac102926c672
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 1 14:45:10 2012 +0000

    ensure connection stats emission for write-only connections
    We set up a stats timer in the writers but rather emitting any stats
    directly from there we just get them to 'ping' the reader, which will
    then emit stats based on its own timer.
    
    The timer in the writer is created when a socket operation has been
    confirmed.
    
    a little bit of drive-by refactoring to make implementation easier:
    - move state creation into one place
    - move reader into state
    
    TODO: suppress all this when in the Erlang client

commit b797765a5a319efd96a9a01512b8775bae18a857
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 1 14:32:03 2012 +0000

    I know, why don't we get those the right way round? *headdesk*

commit c6cf0905546bd0fbe53630b5a556e3ac0e647e42
Merge: 5d7a72f96 8e9ac24d4
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Thu Nov 1 14:31:50 2012 +0000

    Merge default into bug19376

commit 55688ba8257a069f0108c473dc88beb100bb2dd1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 1 12:10:36 2012 +0000

    feeding of vertical alignment obsession

commit f454689f360fcbd748c5660b7c194c669e053186
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 1 12:03:59 2012 +0000

    Unify address and host. Stick ports in the state, just because we're grabbing them anyway.

commit 5d7a72f96fee293a263a1ae02d789aa145c1b044
Merge: f8b41a777 15a994ef5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 1 11:06:21 2012 +0000

    Merge bug25164

commit 15a994ef52d3a0ef075ae0a0161264246e9ac524
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 31 23:37:06 2012 +0000

    refactor: s/lookup_absent/not_found_or_absent
    and s/not_found_or_absent/not_found_or_absent_dirty
    and make the signatures match

commit d9bb3ce96b0993294375bb432d57319aeb75dd0b
Merge: f8b41a777 321e09804
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 31 18:24:32 2012 +0000

    merge default into bug25164

commit 8e9ac24d45f6d593630848713b3c7418e8558e23
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 31 16:45:43 2012 +0000

    revert 6982ce6874b3 => this broke ttl handling for rejects and ttl=0/immediate equivalence

commit 7ba0593d45d53027cd0e6e74c93f43e3d894dd85
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 31 16:17:52 2012 +0000

    if per-queue ttl is enabled, don't skip dropping expired messages

commit 73fb60c63752a2b266d0eb52a83b84fc660b499a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 31 13:24:30 2012 +0000

    More clarity.

commit f8b41a777442309c24e8184d5ad07caab75a6e50
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 31 12:39:54 2012 +0000

    HA optimisation: don't broadcast 'drop' when nothing has been dropped

commit c791885aaa816f35a2c77079cd96486a84aaf181
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 31 11:42:48 2012 +0000

    messages can always 'potentially' expire

commit 97213c7634ffe082b8796d6ae3f17b532e6292a4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 30 16:33:48 2012 +0000

    verify the basic.expiration >= 0

commit d60f3123d902980d6abfe5ca775070db78c3917d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 30 11:56:31 2012 +0000

    Store name, host and peerhost as binary in the first place.

commit 1c7557a22d5b354c4c2e8a2268536511d020e689
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 30 08:12:56 2012 +0000

    fix R12B-3 build breakage
    looks like one cannot define two macros with the same name but
    different arity

commit ddf5d66639d70ed426362d3688bf59367ba2a0ce
Merge: e2a63a01e 821978040
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 19:08:20 2012 +0000

    merge default into bug23935

commit e2a63a01e779bc8ef7c326ad04d4d4aaa7b23e6c
Merge: df08b1e7d 9138f81d6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 19:04:04 2012 +0000

    merge bug25258 into default

commit 9138f81d6c73ac0c82a30f7cb743f3e746cb8a1c
Merge: 0609c5bfa f0acd6ad8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 19:03:21 2012 +0000

    merge heads

commit df08b1e7dc57b0ae48dc8dd0fd144a2484dbb6ac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 19:00:06 2012 +0000

    keep track of connection name in reader state
    That way we won't trip over socket errors when obtaining the name
    later on. Should also be more efficient.

commit f0acd6ad8ed9752697ca9176dc641d93ba12363d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 18:28:22 2012 +0000

    cosmetic

commit 82197804063e6fb8aac1cac1085b553b97b492f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 17:37:56 2012 +0000

    These should be binary.

commit f389dbe03d78bde9dbb5cfe2b9450d907edd7cf6
Merge: f774e7ba2 0609c5bfa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 17:36:07 2012 +0000

    Merge default

commit 0609c5bfa368cae3724feac2da26b9436e6e5d36
Merge: 817e2485e ff3b80a8a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 17:32:00 2012 +0000

    Merge heads

commit ff3b80a8a568cb060160ff8536567b350e0997b0
Merge: b44e758c2 7f9698515
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 17:31:42 2012 +0000

    Merge bug25244

commit 7f9698515b5e061d12fc86970e50b448e03bb368
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 17:28:03 2012 +0000

    An extensive list of transformations lead me here. I think this is more readable.

commit 817e2485e012d139b64010121ad17ef988af6995
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 17:11:25 2012 +0000

    cosmetic

commit c417ee10611f36b0ffd91c2ab569a8bb1fd0b6d9
Merge: b44e758c2 6e314d499
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 29 16:14:26 2012 +0000

    Merged bug25236 into default

commit edd3cc0767d4d61d220868de76bd22288b2acdee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 16:02:05 2012 +0000

    Rearrange args to put the big structure we're working with at the end; more OTPish. Yes, rabbit_misc:table_lookup and rabbit_misc:set_table_value get this wrong, but we should not copy that.

commit 9cb4ef45d4690f32418a4b57a909e25970f3faca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 15:57:52 2012 +0000

    Refactor a bit

commit 9a9417ada26840ecbc81f4abf9b1e99623352728
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 29 15:40:20 2012 +0000

    make basic tests fit into rabbit_tests a bit more cleanly

commit 5c88036ba652073f6701a3465d10e81cd9236322
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Mon Oct 29 15:14:10 2012 +0000

    no more simple_one_for_one_terminate; include support for dynamic_db

commit b44e758c2a64ff7ad3f82488071298b74b390f8f
Merge: c2849df93 fb48a3ea6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 14:38:58 2012 +0000

    Merge to default again

commit fb48a3ea69980e742d6845f6aab9b2d6fa485e2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 14:38:23 2012 +0000

    Formatting

commit c2849df9341c9f78e7c8fa2f3b628a24b0cdb8af
Merge: 69f884d6d 215e6c108
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 14:23:12 2012 +0000

    Merge bug24719

commit 215e6c1081de22c9e556f5ce6f2a59b7e051063b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 14:22:58 2012 +0000

    Shorter.

commit 003d51dad374a8a15e993087797eb87ce26b5b73
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 29 14:22:38 2012 +0000

    refactor

commit 5156c3c5a15403876d1df9d817fd471d2c9b3510
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 29 13:59:40 2012 +0000

    migrate rabbit_basic tests to rabbit_tests

commit 69f884d6d964b0104e5a6da378715e9078c336a8
Merge: eb219699c b92e86efd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 13:15:19 2012 +0000

    Merge bug25254

commit b92e86efdd89398654c3be20ff8185761ad96059
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 29 12:51:33 2012 +0000

    stop reading when losing frame sync

commit 7ebb283bdce77b248b81acd47bdd1e98d9fb01e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 12:46:47 2012 +0000

    Remove if_mirrored_queue/2, it's not buying us anything in terms of avoiding races.

commit eb219699cfefaba0704a62cc5c46cfaac8601abc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 29 12:29:16 2012 +0000

    Since bug 25243 we can never have the situation described in that comment - so remove the extra call to update_mirrors0/2 and get start_mirroring to start the mirrors itself. I think this is clearer.

commit 41137e320d1f20c39bcd990938b370c50e78fe28
Merge: 4ac8dbc57 40e39047c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 19:09:48 2012 +0100

    merge heads

commit 40e39047cece59c5b022a855e557b33d2547b1d4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 19:08:33 2012 +0100

    remove incorrect/out-of-date comments
    - the failure type of {un}bind was corrected to a channel-level error
      in 0-9-1
    - bindings to internal exchanges are ok; publishing isn't, and we
      check for that
    - bindings to the default exchange *aren't* ok, and we enforce that

commit 6e314d499660a0e4702e862d938a3ba13a0e18e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 26 15:31:50 2012 +0100

    Yet another way in which add_mirror / drop_mirror "failing" can be OK really.

commit 7058786b213138102cb8cccf551f250dd7d3a550
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 15:11:05 2012 +0100

    correct docs

commit f6eb544d340162a4b6076bd2f4621a80729308c5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 14:30:20 2012 +0100

    remove cruft from display of missing plugins

commit 89713129dc241d41ab80bf34ce55133ed424cbc7
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Oct 26 14:23:33 2012 +0100

    Work in progress. Lots of (reverse) costmetic changes, pull over
    count_children/1 and move things around a bit. The OTP style of dynamic
    child handling hasn't been merged yet, so we're not even compiling yet.

commit d72af6641100d0f3d31ad09d51598cc1da03b43e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 14:15:50 2012 +0100

    we can have both missing plugins and missing dependencies

commit f1d5012b74e199b10269e451ad762d978e4c879e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 14:00:37 2012 +0100

    simplify

commit 4ac8dbc57a53f293251784c28a403429efa52dd7
Merge: c968e9913 b9c4358dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 26 13:43:46 2012 +0100

    Merge bug 24991

commit 8888992c942abde35808eb39fd802f906b46e0c5
Merge: 10c649436 efefd7fe3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 13:37:57 2012 +0100

    merge default into bug24719

commit c968e9913efb533fafb0bbf2c9dc4a3e484b0b36
Merge: 841c4624b 10c649436
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 26 13:36:00 2012 +0100

    Merged bug25243 into default

commit 4f074a9e5d57d5f3af696983665a812aecc8aaca
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Fri Oct 26 11:10:29 2012 +0100

    (un)cosmetic - reduce the diff

commit 76c7c19899830fb2ff9bfc8d54f5ed389e30caba
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 26 10:30:59 2012 +0100

    re-order things a bit and pretend use_specs doesn't exist for now - closer diff with otp supervisor

commit 10c649436a44687d7145da58c2562cada6991b23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 26 10:26:44 2012 +0100

    fix typo

commit 338ae4dc6e821b2211c5840458c7022439841248
Merge: 603999b07 9b46e7564
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 26 09:56:57 2012 +0100

    merge default

commit 603999b07745f04876f18c7e4e200230a06d9798
Merge: 54248e766 099750612
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 25 21:57:20 2012 +0100

    merge bug25203 into default

commit 099750612de88e09b5f74925f7bedbe36bd64c28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 25 17:11:05 2012 +0100

    consistency

commit 0c58fe684072503f6bbb594a3efe238dd4a07d7a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 25 17:06:14 2012 +0100

    refactor 'reset'

commit f76b2cbda309680e0af73ce192b8f321dddc9337
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 25 16:35:23 2012 +0100

    betterness
    - remove debug logging
    - actually log something - rabbit_log isn't operation at this point
    during startup so we need to use the plain error logger
    - be less clever about config format checking - if it vaguely looks
    like a legacy config then assume that, otherwise assume it's a new
    style config.
    - be more helpful in the warning message

commit 0bbe4546de3382df9b300116256178717ef3626a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 15:31:01 2012 +0100

    fix spec

commit cb10222f66a5f5d51304d1299fe6ab753b795857
Merge: 54248e766 07aaf10b2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 15:21:04 2012 +0100

    merge default

commit 07aaf10b22c033bcf0d23e7a9e5db7f36de7765d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 15:19:05 2012 +0100

    accumulate invalid headers carefully, considering even misconfigured x-invalid-headers

commit 97464ec933e5fec86bd7294d32c4cb7712328cdf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 14:44:35 2012 +0100

    typo

commit de218f1e33bebeeeae70ea66e94305b31d1174fe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 14:20:11 2012 +0100

    better error message for `join_cluster'
    
    When `force_reset'ing a node, if we want to re-cluster it with the old
    cluster `update_cluster_nodes' can be used, but we can't simply use
    `join_cluster' again, because the rest of the cluster still thinks the
    `force_reset' node is in the cluster.

commit b291ac0e4b5385c824c39490d76e2466e5ca390a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 14:04:56 2012 +0100

    oops pt 2

commit 5dd9a491de0a3451e0c6ab096de43438ee9ea337
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 13:49:40 2012 +0100

    `cluster_nodes(all)' instead of `nodes()' in `force_reset()'

commit 09338e61ea7835308d43eab3226357aa723d3529
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 13:48:25 2012 +0100

    handle legacy `cluster_nodes'

commit 1b7271085b6c190091a3658a3289dfff10a44ffe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 13:37:10 2012 +0100

    oops

commit fdfd7e3309554eefc48eebb83bd03d219c7af3fb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 13:24:37 2012 +0100

    we do not 'append' to the list

commit 3d1aa7e6204d5436c0c8a2c24172745f464e9964
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 13:21:54 2012 +0100

    test for correct prepending of table headers

commit d1b74a5eb768e76f5a233b0fd8df6fe4e5d3dbc2
Merge: 9d672ce2d 54248e766
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Oct 25 13:10:45 2012 +0100

    merge default

commit 54248e76629b351561d770208036ffbaedf962a6
Merge: 71044851c 964876078
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 25 13:00:09 2012 +0100

    Merged bug25053 into default

commit c3f8d28f324fa8df99253e12ed36f6225c27cfee
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 25 12:59:11 2012 +0100

    move invalid headers into a special 'invalid headers table' header

commit 9b46e7564d8d61ccfa46b3b9279a130925f36290
Author: Tim Watson <watson.timothy@gmail.com>
Date:   Wed Oct 24 17:32:09 2012 +0100

    re-order record definitions so they match the OTP supervisor

commit 964876078c29a04b6dacd6f77e50e533d607ea39
Merge: 7e2a8111e 4bb0bf2b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 24 17:19:09 2012 +0100

    Merge bug25167

commit 7e2a8111e6cb62b84e80df3eef2e34cc1737bc8e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 16:44:15 2012 +0100

    remove the `leave_cluster' refactor

commit 4bb0bf2b19d977ed11678f0f6955a827df9c058f
Merge: 49de8c92c 4f9e0563c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 24 15:40:00 2012 +0100

    Merged bug25237 into default

commit 02877b21dfbc818e90f1a970d2fa5c451a420f6c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 15:18:48 2012 +0100

    post merge cleanup

commit 8cdaef0b4498e295217558a763bebfb1d6dc0e02
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 24 14:44:18 2012 +0100

    don't crash when appending table headers if the previous header wasn't an array

commit bc506928f65ac4a70c84b95068679f1b3f1e718f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 14:35:26 2012 +0100

    oops

commit 321e098043c2414e8e5934c615c7c8747e4e605a
Merge: 49de8c92c 8f77a615f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 24 13:29:33 2012 +0100

    merge default into bug25164

commit 8f77a615fa0d3bf285cf31150a351f94777ad117
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 24 13:29:15 2012 +0100

    better error messages for 'absent' queues in binding commands
    - change binding:call_with_source_and_destination/3 to replace {error,
      source_not_found | destination_not_found |
      source_and_destination_not_found} with {error, {resources_missing,
      [{not_found, #resource{}} | {absent, Q}]}}.
    - the change ripples through rabbit_channel:binding_action, which can
      now produce nice not_founds.
    - We now only report one of the errors when there is something wrong
      with both source and destination. I reckon this is acceptable; we
      could do better but it would involve a fair bit of extra code.

commit 841c4624ba48ba2a14720f2e1be81b4ba6c3364d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 24 13:25:03 2012 +0100

    If the current master is currently not in the nodes specified, act like it is for the purposes of suggested_queue_nodes - otherwise we will not return it in the results.

commit 2e24635a80bd400c9a4a5e6d489acd455136190d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 13:09:18 2012 +0100

    comment

commit e9067279cbe4ff8e17d6c607fe68bd0d7b16401f
Merge: 49de8c92c 6ba23fbc2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 13:08:54 2012 +0100

    merged default

commit 9d672ce2d6cc7b255a2513568b1dc7130809dfd5
Merge: 1a1fb95a7 49de8c92c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 24 12:00:14 2012 +0100

    merge default

commit 4f9e0563c0d50e16f3f84b4d702fcf4281ff19c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 24 11:24:43 2012 +0100

    More accurate specs.

commit 49de8c92cb93a763f53592214e10d70ecbc934b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 24 11:16:28 2012 +0100

    Fix policy info items

commit 510bca3c6df527f3b926bbad8200da3cbe741db3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 24 10:25:22 2012 +0100

    Slightly surprised that compiled on R15B02 - but it doesn't on R12B-5. Fix CI + nightlies.

commit f7511a7a7578c7f8661e96687ed5193894085ac9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 24 09:37:04 2012 +0100

    better error messages for 'absent' queues in various commands
    - move channel:absent/1 to misc, since we need it in multiple modules
    - change amqqueue:with/3 s.t. the error fun is invoked with
      not_found|{'absent', Q}.
    - let this change ripple through to with/2, making it return either
      error. This in turn has just two call sites
      - in 'queue.declare' in the channel, which we expand to handle the
        'absent' case (producing a descriptive not_found error, as per
        above)
      - in mq_misc:if_mirrored_queue, whose callers currently do not
        handle errors at all - see bug 25236
    - let the change also ripple through to with_or_die, handling the new
      'absent' case as above. This takes care of passive queue.declare.
    - with_or_die is called by with_exclusive_access_or_die. This takes
      care of basic.get, basic.consume, queue.delete and queue.purge

commit cf76d65579f423be08b2365614a9fd51d6256f10
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 24 00:07:12 2012 +0100

    better error messages for 'absent' queues on declaration
    - change amqqueue:internal_declare to return {absent, Q} instead
      of 'not_found'
    - let this ripple through amqqueue_process:declare, stopping with
      {absent, Q} instead
    - that in in turn will end up in in amqqueue:declare/5. Instead of
      inovking misc:not_found(QName), which was EXITing, we make {absent,
      Q} part of the API.
    - at the call site in the channel we handle the new {absent, Q} case
      and produce a nice error message.

commit 8ab21b8c0f26c38c29af7b0b682f61e9b0cf8f53
Merge: 6c7c60ebd d6e17b836
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 23 14:24:20 2012 +0100

    merge bug25227 into default

commit 6c7c60ebde56a3cd4f16e0da39918fdefe63bc39
Merge: b22b967f9 d6e17b836
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 23 14:23:16 2012 +0100

    merge default

commit d6e17b83681d56cff15559ddbe4df96476077ead
Merge: 8ae4a92c0 4e563743e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 23 12:47:16 2012 +0100

    Merged bug25142 into default

commit 8ae4a92c007ded5f2851c0c36877e8ebae2a1f83
Merge: d1e2339a7 e88475ed3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 23 11:50:01 2012 +0100

    Merge bug25168

commit d1e2339a7db38f5ce8c537cf6e89fc905cfd66ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 23 11:49:46 2012 +0100

    Typo

commit e88475ed3dd1a53839051a05e18f359bad1e65f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 23 11:14:02 2012 +0100

    Everywhere else we say "disc" when clustering. Note that change_cluster_node_type will actually accept either spelling.

commit 2a82416ab050a890c16090b85b42b32d0a11ca23
Merge: 266a3e955 ebdcbe583
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 15:42:05 2012 +0100

    Merge bug25220

commit 4e563743edb66b669bee004dc755d5f734c435d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 15:05:49 2012 +0100

    s/key/name/, and a couple of other minor tidyups that I noticed at the same time.

commit cfc326804804673a06eb8dbabc83e7854139708d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 12:14:49 2012 +0100

    Cosmetic + show non-string nodes params + display "none" when params missing.

commit 266a3e95547de6e1184debcb189d6b50325d3025
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 12:01:55 2012 +0100

    Abstract base64url/1.

commit ebdcbe583bfb7856dd9a28ba5f24061d2f123a1c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 11:56:18 2012 +0100

    Wow, I think that's the stupidest thing I ever did. Added to test bug 25205, then accidentally committed.

commit f774e7ba2fd8e478ddacc11729175f64344a71cf
Merge: 825041338 2c591c35b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 22 11:08:29 2012 +0100

    merge heads

commit b366f63c75d1afe0fa335e51d03581730623f39c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 22 10:09:19 2012 +0100

    cosmetic

commit 2c591c35baaf693789fe4a4d2e14e978d9f9e482
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 16:34:56 2012 +0100

    I feel a great sadness.

commit 22bf1a9f1b567dd1a2a8e93e4bb52089f283cb18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 16:31:28 2012 +0100

    Move host and peer_host to creattion since they will not change now.

commit 825041338135d90671e0187252fc916c4de82d31
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 19 16:15:15 2012 +0100

    cosmetic

commit 4a82b2ea9e5b5c3bcf798f40e8d004914008a7bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 16:14:45 2012 +0100

    Oops

commit 1854e8cade228217341fdc7e8bdd1c2255a0f23c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 16:01:51 2012 +0100

    OK, I prefer this. Patch the dns lookups into connection_string, this makes names come out correctly for channels, stomp, mqtt and means we can remove some special casing from mgmt. Remove the extra process. Add a mechanism to disable the whole thing in case people have broken configs.

commit b3ac2eab52f8625153155e1d42bf9f2155885694
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:58:47 2012 +0100

    Symmetry. Link to the spawned process. Remove i/2 grossness.

commit 15985c7db0b98b63bbddd3887388f0352eba77b1
Merge: 2c4710bb8 f2f9ece9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:37:47 2012 +0100

    Merge default

commit 2c4710bb8632e81e1f0491ed701491e3aac27c8b
Merge: aa1817344 70a3dd987
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:30:46 2012 +0100

    Merge bug25215

commit aa1817344b5124f76bcee40abb3919f18ceb6e67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:30:31 2012 +0100

    Rearrange order of args to gm:start_link/4 since it seems to make invocations more compact. Curiously I did not need to rearrange the spec as it was already that way round :-)

commit abed65a0a313901c1fd75ab2ce5dde697a167cc2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:19:48 2012 +0100

    Cosmetic

commit 70a3dd987670b989770e0b95ff4ae704136a985f
Merge: 72cf2665a 094b0bdc4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 19 14:14:25 2012 +0100

    Merge bug25205

commit 7d2840a3111a3f6aecedaef80bad59f0ce6857a5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 19 14:12:37 2012 +0100

    fix qc tests

commit 385382492b754d2976c0b48866eea469d484fa81
Merge: f713d9848 094b0bdc4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 19 14:06:33 2012 +0100

    merge default into bug25168

commit 094b0bdc46fe0670bb42ac9bb2816d4b9d84a9a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 19 14:05:51 2012 +0100

    complain when running 'proper' and there are no tests
    Twice already I wasted way too much time tracking this down.

commit 72cf2665acdde2d33adbbd14cf2015505c4bae42
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 18 17:50:43 2012 +0100

    reinstate rabbit_vm:memory/0, accidentally stripped out whilst reverting changes

commit 0c9c139b5e328ef66699a109e5a3282f6d383bb0
Merge: 4160f21cd 66217363c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 18 17:04:25 2012 +0100

    Merged bug25230 into default

commit d59eed2f4b2e1d6e0ddce2007b1f1e8afca93c43
Merge: 2e2abcb36 66217363c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 18 11:52:51 2012 +0100

    merge default

commit 4160f21cd0a6435fd8aae29f424840c7ea8d8ccb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 18 11:45:55 2012 +0100

    Log Rabbit / Erlang versions on startup, and fix the stop message.

commit 05eb34284c50e74d555092acdcc30c4667aad3ce
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Oct 18 11:31:17 2012 +0100

    wrap the whole start after all, and use local_info_msg/2 to avoid duplication

commit 66217363cd194531b3fa345fcc037c62978e95ac
Merge: 7e0f44f2a bbd45f3d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 17 16:54:23 2012 +0100

    Merge bug21413

commit 2e2abcb3616d0a0d37d479739c80f1cbc00a051b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 17 16:48:40 2012 +0100

    oops

commit 6111d956cd72b9f600424f65cccd2a13a5ab57bb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 17 16:25:40 2012 +0100

    do not couple gm with rabbit_misc

commit 1021784c9d4258099607aed3c72b536f720e8d48
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 17 15:36:19 2012 +0100

    use the worker pool for gm mnesia txns

commit 486b13c0f458051c848d79f2751740a6a486084a
Merge: bbd45f3d8 644a4f767
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 17 13:57:55 2012 +0100

    merge default

commit 644a4f767b7d4ffcd2072ecb9447efe93484d725
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Oct 17 13:56:54 2012 +0100

    revert to a79f54b909f

commit b72fd884b0fb3872ccc1e81e21eaf7185b0630eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 17 12:53:52 2012 +0100

    Add policies and parameters to "rabbitmqctl report"

commit f713d9848a529f97b7bfb9ec88acf8d56ace1299
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 17:41:24 2012 +0100

    no more blind confirms

commit a00e05261cc178cf967b7a4917e3c094a966e489
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 17:39:53 2012 +0100

    publish_delivered(false, ...) -> discard
    The two really are the same.
    Since 'discard' doesn't need the message or props, there is less stuff
    to pass around over GM.

commit bdb1acfdb09222740b9339c1ebf0b0c298628f19
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 17:33:04 2012 +0100

    As far as I could tell validation for "exactly" was completely broken. Remove attempt at abstraction. Also validate that mode=all does *not* have any params.

commit 019755b4421b3d3a2fa13ad991a7890eaff6a900
Merge: bbd45f3d8 891299f7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 17:23:08 2012 +0100

    Merge default

commit bbd45f3d83621c78df930ab03864de04f65daacf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 17:22:32 2012 +0100

    Fix formatted error handling as broken by Matthias in 891e659f0e77.

commit 891299f7a239f9db95bb1f084868328ccf370938
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 17:10:21 2012 +0100

    I think it's clearer if priority is always set.

commit 4069e17692185018bda1ef05237cfdd1bb66c403
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 17:00:12 2012 +0100

    Define rabbit_policy entirely in terms of parameters, don't go mucking about in mnesia.

commit 78690e72efb16c5d777af3fab4f16048d2d1a34d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 16:48:32 2012 +0100

    cosmetic

commit 176f751deceed995322698a3c427adc9010f4fbf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 16:34:04 2012 +0100

    one less place to equate mirrors with nodes

commit 02961bbf081afdaa64c88d52d203ba4e1fe4b206
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 16:24:14 2012 +0100

    Cosmetic

commit 049c5820c93c11e78c7f5c96946a0b3a1ba2a2c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 16:18:39 2012 +0100

    Another lurking "Tags"

commit 0f196e9c16b585a63a06933ae98dea26f6ef7c7a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 16:16:04 2012 +0100

    We call it "set" not "add" everywhere else.

commit 4aa14e3ec802fe89a661f05a55380e7d99043f0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 16:13:26 2012 +0100

    Refactor

commit 3da58cb2821ddb24e1336e40c54c3a92c15637c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 16:08:52 2012 +0100

    Refactor a little bit. And they're Keys, not Tags.

commit caabf35ddf68881b0d04f652fbfd9cc6c8ee511f
Merge: 723774ec4 08cc587ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 16:06:24 2012 +0100

    merge bug25202 into default

commit 08cc587ce65a1d0650a039eef7d1d2536bfec183
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 16:04:58 2012 +0100

    cosmetic

commit c0ffcf0ef8ee3be181574f888bf737818ed2dd8c
Merge: 0fef7a0ec 723774ec4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 15:20:09 2012 +0100

    merge default into bug25202

commit 723774ec48a0d6643dc33e65782a9da9f386b743
Merge: 527f4e295 1e44da5f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 15:14:57 2012 +0100

    merge heads

commit 1e44da5f708f5c1be16adcb1398f123516a864d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 15:14:07 2012 +0100

    compare pids instead of nodes in slave's handle_call/gm_deaths

commit 527f4e295dc00f5e869ccb649247f762a177fe18
Merge: 77c08d8f1 c9f1b667d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 15:12:37 2012 +0100

    Merge bug25225

commit 77c08d8f1407aff5055423e0a7049b276fbc4a5b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 14:07:57 2012 +0100

    remove comment that doesn't make any sense and is irrelevant

commit e29d474206abe733001917ee7a53355e42260121
Merge: 180b2eae9 44f4940b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 14:03:41 2012 +0100

    merge heads

commit 180b2eae902db2710bee5db4a8f089a82f76d37b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 14:02:41 2012 +0100

    refactor: don't track slave's master_pid separately

commit 44f4940b6cffb50c1cf59662e3ba97d32babea15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 13:59:16 2012 +0100

    Typo

commit 0fef7a0ecc69193712706e8b325d6ed6d7fb8fb5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 13:36:28 2012 +0100

    Make sure we don't stomp on GMPids if a slave manages to get to Mnesia before us.

commit fa3ab5eac41ec0d00eeed03ee2e841d6eee34a1c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 16 13:09:21 2012 +0100

    We don't need the 'existing' records, and without them we don't need to compare GMPids for sameness.

commit 58046f0d23e868dc5dac86ba275cdf4e0be71661
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 12:31:30 2012 +0100

    simplify

commit bf30a77325d614eab5ea1964c8d2536c7f7c947f
Merge: 62dc3ebde 811f35cee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 12:24:08 2012 +0100

    merge default into bug25202
    ...and in the process inline mq_slave:forget_slave and fix a bug in it
    (it was looking at the wrong element of the tuple)

commit 811f35ceeac31ab66e8c57bb0962b97c2209896c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 12:12:31 2012 +0100

    refactor: slightly more sensible signature for add_slave

commit 33022ae6dfefacfac492ef2087a31e1178fd4b40
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 16 12:07:34 2012 +0100

    refactor: correct confusing variable naming

commit b22b967f9edf101d0beeaf555834f7f6857d8def
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 15 18:11:38 2012 +0100

    We can be partitioned from more than one node. And ignore the starting_partitioned_network, it seems to get copied across the network without marking which node it is from!

commit bc808e8e703da107d73db6172a4d8a0472d96cd8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 15 17:46:25 2012 +0100

    Rename and refactor policies

commit c9f1b667de3d4da5c7b68f136ed9bfa57e8b06a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 17:34:43 2012 +0100

    merge slave 'confirm' decision making and action
    similar to what we did in rabbit_amqqueue_process

commit 9ebad4995a7a3354cb43c9868cc61144b84d95dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 16:29:48 2012 +0100

    refactor: handle all msg statuses uniformly

commit efc62091ec50587b7d18f1d6d80dca6702f95fd8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 16:25:34 2012 +0100

    refactor: deal with 'publish' and 'publish_delivered' in separate clauses

commit 56995d925ba4eb84171d23a9aa4ebb0ba7db4a8c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 16:13:50 2012 +0100

    refactor: extract commonality between 'publish' and 'discard'

commit 27ed7815d8e52a5c8ca9e6d9cc9920622add4ba7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 15 15:37:32 2012 +0100

    Subscribe to system events, receive inconsistent_database.

commit 6e6a26dc2aa07a403629a0b3fbbb46f6470149f0
Merge: c35a82384 c280fa22b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 15 15:20:37 2012 +0100

    merge bug25207 into default

commit c35a823847ac2654a073d57edbf825e2012e4a83
Merge: 90e9462d0 c280fa22b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 15 15:20:05 2012 +0100

    merge default (again)

commit 7f0aee461d9405e900cacd0219407912bc13698d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 15:07:28 2012 +0100

    deal with confirms in slave 'discard'

commit 90e9462d0e2ebeea41756a621c4bd14ac50f78c9
Merge: fc7846ce9 9db422ac2
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 15 14:26:36 2012 +0100

    merge default

commit e7872cf315403471338d75cf93da611ea2aed740
Merge: bd55c3342 c280fa22b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 15 13:00:17 2012 +0100

    merge default into bug25225

commit c280fa22b043a39a9bf1ef9a0fd20409b7d4b5ed
Merge: 562ec81dd 9db422ac2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 15 12:16:13 2012 +0100

    Merge bug25226

commit 562ec81ddde2527bcf653ae1ce19171547e02486
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 13 08:44:47 2012 +0100

    plug leak
    always remove from PendingCh when we receive a msg via gm that we
    previously received from the channel.

commit bd55c33423e579a1dac6899429f283bd1d4cddac
Merge: dc36279e3 9db422ac2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 23:42:06 2012 +0100

    merge default into bug25225

commit 9db422ac20c8b5c995d05b0846a3379049799cd4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 23:31:15 2012 +0100

    correct essay & comments regarding the 'delayed confirm' rationale
    Matthew has confirmed that the "we don't know the msg_seq_no until we
    receive the msg from the channel" reason is bogus. The msg_seq_no is
    allocated by the channel prior to routing and thus is the same across
    the master and all slaves. Hence the 'publish' via gm contains all the
    information we need to issue a confirm.
    
    Nevertheless we cannot actually issue the confirm until we've received
    the message from the channel. The essay now explains the real reason.

commit 913d27ce8ac9af86c1b6f109fb42780bd7f2e9aa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 22:52:40 2012 +0100

    store less in the slave's msg_id_status
    There is no need to track the ChPid of 'published' and 'confirmed'.
    
    Also: neater conversion of msg_id_status on promotion.

commit 4ae5a59d888758dbb2e8a7f831aa272711e6929b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 20:56:41 2012 +0100

    refactor: simplify confirm handling in queue
    three functions into one

commit 9c9043f14619f75e38fc1d323542766fa8b05aa8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 20:17:17 2012 +0100

    cosmetic

commit d045d0a85090caf1647c9bf0042e3eafe15a184a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 19:36:17 2012 +0100

    re-instate TODO

commit 9c1261bd1f2395795cc0046d5ab7ed508ed7aeff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 19:32:26 2012 +0100

    a spot of inlining
    ...and refactoring; exploiting the fact that
    maybe_record_confirm_message is a no-op when Confirm == never

commit dc36279e3207c731e28ea0f489046ba57c3c7d24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 19:16:49 2012 +0100

    optimise x-message-ttl=0 & confirms path on queue
    changes to slave still to come

commit b6993a910f971ddaf7cf37b15b7cee1105b8ede6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 17:09:50 2012 +0100

    Simplify policy validation tests

commit a609c4a9a93b317df53c0b09998fb90a0ff29029
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 16:58:12 2012 +0100

    Simplify setting of policies

commit f03fb1de8aee88b9cf06559e20bee41ccc58a867
Merge: df71d93c4 422b8598e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 12 16:51:23 2012 +0100

    Merge heads

commit 422b8598e54a25b1b868092e2c454e86eaebf807
Merge: 30c88fec4 80931756a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 12 16:51:02 2012 +0100

    Merge bug25222

commit c5974574055244d590d054ce81b74e89d1c98a20
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 16:43:10 2012 +0100

    Delete policies with vhosts

commit df71d93c434f7e0eafe8ad4d0f75da6da3e926e8
Merge: acf7fb247 8ede09e9b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 12 15:11:36 2012 +0100

    merge bug25192 into default

commit acf7fb2471fb9759fd903da58b57923335ab4f14
Merge: ccf04a627 8ede09e9b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 12 15:11:20 2012 +0100

    merge default (again)

commit ccf04a627726923015e723a384c0acb677b4f3fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 12 13:54:46 2012 +0100

    Unused variable.

commit c3b5f0e9404fb26695c779b18a754c1b1d16f8c4
Merge: a343eb68a 80931756a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 12 13:53:10 2012 +0100

    Merge in default

commit 8ede09e9bf0224dcc89e2b28a98d3192bffb07a1
Merge: 144fe815b 80931756a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 13:47:15 2012 +0100

    Merged bug25195 into default

commit 44d3986d64d5db6db9d58824c08f538116c741b2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 10:27:15 2012 +0100

    Duplicate duplicate detection

commit 30c88fec4edcc57b7e24f5778fdeb762fb00d9c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 12 08:57:15 2012 +0100

    monitor channel on discard
    just as we do for publish/publish_delivered
    w/o that there is a 20s delay in slaves cleaning up after channel
    closure if all the messages sent on the channel were discarded.

commit 83219fa0a4dfd859d0a1b67d6ad669c19a92f248
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 12 00:11:40 2012 +0100

    Remove hints, spaces

commit cb95b5a2215142af74f8fa2369f76da1f8b08c51
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 11 18:05:08 2012 +0100

    Parameter API renaming and policy tweaks

commit 80931756a9ec0b45ed6a75ae5ce24e2ee4de4449
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 11 15:50:40 2012 +0100

    Bug 25110 broke ability to invoke "rabbitmqctl stop_app; rabbitmqctl status". Fix that.

commit 2cb4ef50dc89da1c1574ed027d1c323f428707b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 11 14:46:35 2012 +0100

    remove a remnant of 'immediate'

commit 49965c60a8896416e5a508859c2f00c4f0aa6f43
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 11 14:30:19 2012 +0100

    better types

commit bb20a1dc728798d24507fd9c840b2159babb6e98
Merge: 1d50ebd51 ed73628f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 11 12:34:12 2012 +0100

    merge bug25110 into default

commit b74d3b85c6bc49fa84f35456c0a1848331ff5784
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 11 10:20:17 2012 +0100

    Tidying

commit 5b763a50a533201060ec911ee39fe5c0affd06f1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 10 17:54:49 2012 +0100

    Policy interface updates

commit 1d50ebd511df4319a6bd7ed81656c5f6f5c610cc
Merge: 59d940728 9bafe13b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 15:51:43 2012 +0100

    Merge bug25216

commit 144fe815bd42469521fa032d6d4e4f2e44b744b6
Merge: c0fb4152f 9bafe13b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 13:59:17 2012 +0100

    Merge default

commit 62dc3ebde75180415710d216b3bd16680b6bae2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 13:57:49 2012 +0100

    Make sure we update Mnesia when only the gm_pids have changed (i.e. we are cleaning up a spare GM pid from when we found an existing slave at startup).

commit 24086877b2130a053e4069726abb1ae47aac3e62
Merge: f317da6bb 9bafe13b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 13:27:00 2012 +0100

    Merge in default.

commit 59d940728559019b0439fd6109599fdfd4c8400a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 10 12:54:11 2012 +0100

    throttle index walking to the rate at which we can process the results
    Thus preventing excessive memory use on recovery

commit f317da6bbce0c4bc61a6f92443c77a1dec964ddd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 12:47:32 2012 +0100

    Clean up after we stop mirroring.

commit 9bafe13b2749fef1cab4ca965ef59ae1477fb073
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 12:13:27 2012 +0100

    Fix spec broken by bug 25212

commit 327d68f38cc4ac0506d929344d4387620634898e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 11:50:29 2012 +0100

    Nicer.

commit 58fd4622070b2be270440c7b3e1e54f3f7b6f269
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 11:49:31 2012 +0100

    Cosmetic

commit 5bdc5f602df423aec1d215eb405e24eb65bb3658
Merge: c0fb4152f 746c1bf04
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 10 11:48:19 2012 +0100

    Merge in bug25195.

commit 92a6cec4a23feb4b21b4e04bd3e236e0d2950092
Merge: 195dde877 acd5e2f0c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 9 17:53:02 2012 +0100

    merge bug25210 into default

commit 4111c686a463d69d9f55e7f24049b16fc0c9a7f8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 9 17:52:51 2012 +0100

    Policy interface updates

commit c0fb4152fe9b9f7451be268f0816ed5ace098c2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 9 16:46:52 2012 +0100

    Unused var.

commit c82f022be7f60ae5ee9e6abbd78721d5eac04819
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 9 16:06:39 2012 +0100

    Remove this master_changed nonsense.

commit c5e6f0a71dc2845737122a4ad705917c5f6c1600
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 9 16:05:35 2012 +0100

    Ignore process_death, explain why.

commit b4827a1d249d60fd9c67a64f8761b5295eec6c2b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 9 15:44:47 2012 +0100

    Simpler policy interface

commit 0aeb1b2cfc99b6cbaa250d64db7f8c207c062350
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 9 14:19:39 2012 +0100

    Stricter HA validation

commit ed73628f21e17100241f7e9a34c26cf23afb0128
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 9 13:10:47 2012 +0100

    Remove rabbit_misc:interval_operation/3, it doesn't really work.

commit f8e6eeb066da7419eb056b1c2a9881f0d14c5490
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 8 18:03:15 2012 +0100

    Policy validation updates

commit 195dde877975aeccccfd8ead7a295d6f7ffcd321
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 8 18:02:16 2012 +0100

    Removing the ExtraNodes stuff unmasked another bug: we weren't cleaning up slave_pids when stopping mirroring.

commit ab854f5cc03c6b8fe032ff91bc3c34d069405efc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 8 18:00:49 2012 +0100

    Remove debugging code.

commit e80de6d3eb76d4171a00a661f269423fee684282
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 8 15:55:57 2012 +0100

    WIP

commit daa881bc6c2e64a1dea212c5a3288a5599dabaf0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 8 15:51:29 2012 +0100

    include the error term in start/boot exits and refactor the tests to handle 'EXIT' instead of 'throw' for start/boot failures

commit a343eb68af4b46c10c3f6055ca940ae9a3de4d3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 8 12:47:03 2012 +0100

    R12B-3 compatibility.

commit d412d9a89e6d89323dac7d4b9aab9a1fd947334e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 8 12:24:30 2012 +0100

    cosmetic: trains station

commit a463ad559522dc703f8f375c458655b286f3ed55
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Oct 8 12:24:23 2012 +0100

    wrap the whole of start/boot in the same error check

commit 4ae5fd8f97082d70fa3ae2547b8b7615359eff83
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 5 18:20:10 2012 +0100

    Updated policy validation

commit acd5e2f0caa9781affacbd7e1724172c50025933
Merge: 79d193af0 12558dfe9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 17:09:50 2012 +0100

    merge bug25212

commit 1608ff1dcbfc8f4583fcde9da2f93a6473b8a7dd
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 14:50:23 2012 +0100

    don't try too hard to get the output errors looking nice

commit 9ab055a4caebc30f030eb6bd47238ec8a59b8f3c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 14:27:45 2012 +0100

    start log handlers first, so we see the output only once

commit 79d193af09218dfa3baee00dd48a2a76fab0d466
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 5 14:26:19 2012 +0100

    Don't fail if the queue is already mirrored, tweak return values a bit.

commit c5a4437bbe65dafe4117d6528c669386f7bb64fe
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 14:25:29 2012 +0100

    also handle cluster status file prep failures

commit d48b26b89cf36536f2a85af99784883177413da1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 5 14:13:10 2012 +0100

    Do not start slaves in init_with_existing_bq/3 since we will only get here via rabbit_mirror_queue_misc:update_mirrors/2 which will start them anyway.

commit 883b004a371e37b29c5478d6afd46df42cf6c0e3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 13:43:27 2012 +0100

    oops

commit 0a45dd710b681b65c14df7f39b4820f2062facd3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Oct 5 13:37:05 2012 +0100

    treat cluster consistency check failures as boot errors

commit a88d5acc178290e3f2d3251b2d0803d3ad4aad48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 4 18:18:35 2012 +0100

    That wasn't actually very random

commit f963474c1923ac8fcefe45e0f9e304a7ef4a1a9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 4 17:58:49 2012 +0100

    Clearer

commit cf2a634008a622e90178404efb6696e0edd0c63c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 4 17:57:05 2012 +0100

    Shuffle candidate nodes when we want to add some in "exactly" mode.

commit 7e0f44f2a8d4c602ad25d574ebb6fac2e9e3b1b5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 4 15:32:53 2012 +0100

    Further spec correctness for RPM

commit fc7846ce92827668ce154eeac4d6ebc47b5ec9f3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 4 11:35:03 2012 +0100

    Add a policy info item for queues, and make sure we return '' when there is no policy for both queues and exchanges.

commit 6569080b1126ba41a967847015451f94d81d7cd5
Merge: 12558dfe9 74cb4d597
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 4 10:39:44 2012 +0100

    Merge default

commit 999068a45bf161fb9f12fe63eb11baef4d5a71d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 4 08:56:30 2012 +0100

    correct type signature

commit 008f98e69b6f2ed0029065f1d70e00c0a7b7944a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 4 08:52:36 2012 +0100

    cosmetic

commit 12558dfe9c50017cf3e3b009805d2ba911b2e9e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 3 21:10:17 2012 +0100

    consistency

commit 746c1bf0404f71520a32bc972644af2b57cff7e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 18:06:27 2012 +0100

    Progress towards storing a GM pid -> queue pid mapping. This is dependent on not feeding the process_death message into remove_from_queue - bug 25195 suggests this might be TRTTD.

commit 1256051aaa8466aefe058d7a1ac0b233ae6661b7
Merge: 0144b3ac3 5358502d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 3 13:21:13 2012 +0100

    re-merge bug25200 into default

commit 5358502d77b771f38d9fc1116fe3ef60c0b1b20f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 3 13:20:28 2012 +0100

    cosmetic

commit 731e06ac54ae1d9b34ea19e1eadb225d6e3eda50
Merge: 0144b3ac3 41a3896a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 13:10:42 2012 +0100

    Merge default

commit 0144b3ac3ed1a9c19ff067be4ae1349e641a595d
Merge: cd4bfd94f 1aef908aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 12:55:34 2012 +0100

    Merge bug25200

commit cd4bfd94ff3b1023fc6adada6c14ec274f1f34a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 12:54:38 2012 +0100

    Explain

commit 1a1fb95a782a65d4150696bfb8a0afed2818bf14
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Oct 3 12:52:17 2012 +0100

    sanitize the contents of `cluster_nodes'

commit 1aef908aaf60adcbd3ef49f67baa8186a8ac4931
Merge: 06d8fc293 c9c16fd96
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 12:10:55 2012 +0100

    Merge bug25199

commit 06d8fc293c2061b1c3ee995239242823f2d2b795
Merge: bb87426c7 afeeb9e94
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 3 12:00:53 2012 +0100

    Merged bug25193

commit afeeb9e94bcef3bd591d6715818017a88486d44d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 3 11:31:01 2012 +0100

    More reasons.

commit 604ddf89db268300ec82597436403c5a77cdf6ba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 3 09:20:39 2012 +0100

    distinguish between deliveries to masters and slaves
    ...thus allowing us to set the 'delivered' flag correctly for messages
    that were in flight during a promotion

commit bb87426c775813281470c2841c781efdd203db2c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 2 23:01:33 2012 +0100

    cosmetic

commit b5e0bc248a12fc32fcd73395359bc5846ff9ec9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 16:53:06 2012 +0100

    Various tweaks.

commit 7a9045fccf3044a1256a2daf4fc0f81a012b5568
Merge: 2561b470c f06a17d60
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 16:32:48 2012 +0100

    Merge default

commit 2561b470ccf0b3975228b763aada519cee0b3b2c
Merge: eff816b49 17733334d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 16:25:28 2012 +0100

    Merge bug25198

commit eff816b496613def3b6ad420a41daaa86eaab752
Merge: 17733334d 66f5e47bb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 15:58:34 2012 +0100

    Merge in default

commit 17733334d2c3a439ade264ab44f4e073ceda3a6d
Merge: fcee57b13 6e2c400e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 2 14:55:27 2012 +0100

    merge bug25184 into default

commit 6e2c400e968efd06aca696c1d344a6bc7870dbc6
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Oct 2 13:51:52 2012 +0100

    comments, also wait for tables right after you load them

commit e6b19f44a9a91a2f0977c594a102bbc218f1c547
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Oct 2 13:43:53 2012 +0100

    cosmetics

commit 41a3896a48ef3cb3a9f6b7c950bec2f2929c12ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 13:39:06 2012 +0100

    Don't let the GM hang around. We exit(normal) it rather than tell it to leave/1 since it really shouldn't be there, we want it to stop ASAP.

commit 4c6880edcb8a66145cf8601d3f4f60ea790cd7a4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Oct 2 13:31:03 2012 +0100

    wait for tables, not for mnesia

commit 1cd6f5880c9e137504dcdd3f4b9f87f1c7cc4d3e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Oct 2 13:16:40 2012 +0100

    simplify `leave_cluster/0'

commit fcee57b131d64ba96d44add15409e087b53496de
Merge: 7f35eab89 acdee4f17
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Oct 2 11:42:08 2012 +0100

    merge bug24908 into default

commit acdee4f17d15cbc3036a96d2aede6e483a92b7fd
Merge: 7f35eab89 f247cc348
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 2 11:36:31 2012 +0100

    Merge default

commit 66f5e47bbe62ceba1cfb894a9183955f5c9286a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 2 11:35:11 2012 +0100

    remove gratuitous ack numbering
    the sole purpose of which was to sort the acktags by that number,
    which serves no purpose whatsoever.

commit 74cb4d5975c10bf2ca2275157999798626e14d6e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 2 10:17:17 2012 +0100

    First draft of policy validation

commit 7f35eab89ef91db53de9c76195b00b03e69c9d37
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 22:20:24 2012 +0100

    cosmetic

commit 76ae76fcf3a2e939c8aef7d01bc7ecc43a92100a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 22:19:35 2012 +0100

    cosmetic(ish)

commit e35260836fc68c2ada9ea2ee8428e0e256d67b0e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 20:04:48 2012 +0100

    requeue unacked messages earlier during promotion
    ...so that the set_delivered marker is set correctly.
    Note that
    - there is no need to sort AckTags - BQ:requeue doesn't care
    about the order in which it is given the tags.
    - we don't need to 'run the backing queue' / 'run the message queue'
      when requeuing since there are no consumers. But we *do* need to
      drop expired messages; process_args takes care of that already.

commit a67e3c137b7a7be0431202c8c9c293cabb55f3d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 19:35:26 2012 +0100

    remove superfluous comment
    We already say that stuff from MA gets requeued. Furthermore, the
    master doesn't have an 'MA' field as such - the information is kept in
    the backing queue.

commit 2491d4c36339d44c8e7c82e7e0b54876b3536660
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 19:13:15 2012 +0100

    cosmetic: remove comment that no longer applies
    This should have been done when consumer cancellation notifications
    were introduced.

commit f2f9ece9e3ac06883a3573c0a0288ada4632b416
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 1 18:33:50 2012 +0100

    First pass at reverse DNS lookups for clients.

commit c9c16fd96427d6e9a860b55fdd28294ec8fe6159
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 17:02:26 2012 +0100

    get rid of all but one use of run_backing_queue and inline the latter

commit e02c8abb6f344b0f157ddf53c8203ae1ad45bbea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 1 16:21:22 2012 +0100

    Clearer?

commit dd652aef225523c85e866718ca53a349548a2acb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 1 11:28:32 2012 +0100

    stylistic consistency

commit f247cc348ec350e31d75bf7427937cdaf73e8714
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 16:58:40 2012 +0100

    Don't throw, rabbit_amqqueue:with/2 will eat it.

commit 8cf46d75ddf80121a7c1da695ba493e0e3275236
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 16:53:25 2012 +0100

    Ignore if the node is down.

commit 49cc7ceb0cbff85ce9e14b862a75ada132902fe0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 16:52:53 2012 +0100

    Assert a bit here too.

commit 3a686b45e1aa7e1d9be2741c19e35c218168b51c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 28 16:33:19 2012 +0100

    Change RPM service launcher

commit 0366817f197859e589b7bc2c812c9cc45ab64cec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 16:29:53 2012 +0100

    We want to catch here, if sup:start_child exits the rabbit_amqqueue:with we are in will convert any exit to not_found. Which is unlikely to be helpful

commit 3e99bb62947e810e974ff61421628671b6078791
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 15:21:42 2012 +0100

    active_consumers info item.

commit a8883a13999beeab4cc415d920a7e788cbbad295
Merge: e15ac86a2 a4dbeee91
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 15:10:20 2012 +0100

    Merge bug25179

commit 2c373f430d998925ef51f937946f1cf816777c19
Merge: 4fd6cabef e409a0d89
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 28 12:57:26 2012 +0100

    Merge in default

commit 8fad9b7b6d8e8ef91dda74bc623ed4580ed74647
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 28 12:39:13 2012 +0100

    Lintian warnings

commit f06a17d60713b1bd8d801445608921d8649855d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 27 15:45:48 2012 +0100

    interval_operation/3

commit 92822c51ca66b296ce7c09e435dd3a8b648f606f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 27 15:45:37 2012 +0100

    Work on older Erlangs.

commit a4dbeee912a963f291c75e1b6d42523aa299734f
Merge: ca84c4068 1b7203f91
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 27 15:00:53 2012 +0100

    merge bug25145 into default

commit 1b7203f912f99ba6a894121c8b6b94ffb4cb6f6c
Merge: 4fd6cabef a4690b9d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 27 14:58:55 2012 +0100

    merge bug25185 into default

commit a4690b9d08e729e51945ebc63f2a6132bfe7702e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 27 14:58:11 2012 +0100

    undo spurious change

commit b8ef6c26e0d705746dd1ed943d2913c69a362cea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 27 12:49:21 2012 +0100

    cosmetic

commit 009d7a377a3841faceac1cab53ecf06fd6082fd3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 27 12:15:16 2012 +0100

    Don't change the signature of init_with_backing_queue_state

commit 4fd6cabef0fb6ae6ab47b9039c5ffc73a2897f7c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 26 20:26:27 2012 +0100

    correct comment following removal of 'immediate'

commit e264fb9476ed2d7b9e01006187f56f9f70b849ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 18:16:00 2012 +0100

    s/redelivered/delivered/g

commit ca84c4068b51e6417cbe488e63b7bcc0432a8cdc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 18:12:03 2012 +0100

    I put that on the wrong branch. And it's obsolete now anyway.

commit 1fc1f219f7b966f486c580fbcd2fd0da396fc3d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 18:09:06 2012 +0100

    Stick redelivered in #message_properties, which makes the diff rather smaller.

commit a02a11aeaded8132d8ded2d070e2851071166efe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 16:51:40 2012 +0100

    API change

commit 735ff076a50ced32157b56cba2a6db5ce649ef67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 16:34:30 2012 +0100

    Let's try that again: we no longer need to use confirmed_broadcast here due to lack of immediate.

commit 54fd0701e1e2fcba4c2aa7def75622f641f2e23c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 16:33:42 2012 +0100

    Mark enqueued-on-promotion messages as redelivered

commit e15ac86a20f4daa235587b4fd8ca2fa663ac8804
Merge: 732b7b8da b77710749
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 26 14:06:10 2012 +0100

    merge default into bug25179

commit b77710749b536980d7530680c6605830047b8ab1
Merge: b8bd0e50c 88ca2c94a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 26 13:57:55 2012 +0100

    merge bug25160 into default

commit 88ca2c94a844de52ddf6bd7561cadd93a502efd0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 26 12:05:57 2012 +0100

    simplify forget_cluster_node/2

commit b8bd0e50ccd97d1e115ada92f2ca50a8e4432c9f
Merge: 1e23216be b7c77eb3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 11:13:50 2012 +0100

    Merge bug25182

commit b7c77eb3de9c10e112ca68643e74408b8227d70a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 11:12:57 2012 +0100

    Fake rebase: 8ebdcd9a5d2e (which bug25182 was branched from) got junked. "rebase" from 5859a8e6d682.

commit 1e23216be1a04e83e512d21760d5edf3e3d72e36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 26 10:50:29 2012 +0100

    Bring default back to life

commit fee39b15d9d08ffda26ea043a20eae408341812b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 22:19:52 2012 +0100

    another assertion

commit 9a3f41d67fd49d29ac21a88e29429f14a17f1b7a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 22:14:54 2012 +0100

    neater

commit 50afbee9c539463a25727b28b9469a96f35775bb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 22:00:52 2012 +0100

    Is this better? I'm not sure.

commit 5ac9f506ec23b288600301d98dda205d6a84af2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 19:10:30 2012 +0100

    cosmetic

commit f6435ff72188456378082408da4bfa32c1445082
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 19:08:27 2012 +0100

    put the assertion back. This time more explictly.

commit c1f2e81ec9029fcd289d48c600cf71bf2d0713df
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 18:47:13 2012 +0100

    improve correctness

commit 536ba1882a89473af6cf0d59a4963f7ef0409167
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 25 18:27:09 2012 +0100

    Rename set_synchronised to update_delta. And remove that nasty little arithmetic-based hack. We should be explicit about the fact that we treat depth messages from the master differently when we don't have a delta.

commit c39e6a0085a570074526c9d39ef1a83e89334608
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 25 18:07:03 2012 +0100

    Refactor which I find clearer. Yes "DeltaChange". But it's a delta of a delta, and "deltadelta" sounds silly.

commit 8524d6f2b83f16d8aa16ae6061139ecc540b757d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 17:00:03 2012 +0100

    oops

commit 465dce6122f67bef6f196f6ec99281245d0daf31
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 16:37:36 2012 +0100

    take a stab at making set_synchronised less obscure

commit a6d350089ab6f558a0db11598ae8eff3144fe0c3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 15:37:21 2012 +0100

    remove unnecessary calls to set_synchronised/2 in 'fetch'

commit 7af521a8b81f2d3b9988b2dc44e59e77588c0b30
Merge: e542da0a5 d15e42809
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 25 14:54:04 2012 +0100

    Merged bug25145 into default

commit 12a3cf10c46f910c08f95cce0fb25a25c4db9ab4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 14:19:55 2012 +0100

    track monitors explicitly

commit 0890b6713d44307a5e9bf95ee4507c665913d92d
Merge: d15e42809 23df5c0af
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 14:18:34 2012 +0100

    merge bug25160 into default

commit d15e4280956622c6ad07930abd383ffc63a5ce6c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 14:18:13 2012 +0100

    generalise pmon

commit 23df5c0afbea63924ed3fe70b08c3c85b6d41e98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 14:06:23 2012 +0100

    cosmetic

commit 01dbe432a5e7287fda5fc9f9e9f394cc2da55635
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 14:04:34 2012 +0100

    replace cluster_multicall with gen_server:abcast

commit a9737143118b90ee7f1c515aa3d47855c5b824da
Merge: a10b1f4f5 26e97fac8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 13:45:05 2012 +0100

    merge default into bug25160

commit 26e97fac83b5707510bd39538aa832f682a9852d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 13:42:53 2012 +0100

    fix a bug

commit e409a0d8906093b212e9ad836d494ef01e01bf77
Merge: 4db1f439d 68a220c3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 25 12:33:43 2012 +0100

    Merge in default

commit a10b1f4f5e1fe55926b32f93a963194256c0e611
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 25 12:12:35 2012 +0100

    it's a disc

commit 3abb3169343c6177ee504e19a3da7d5b8f1c5caf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 23:21:28 2012 +0100

    more workingness (and efficiency)

commit 0fdf84d0394ecf55c7be591662a3e9aa297d374b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 23:15:39 2012 +0100

    cosmetic

commit d4e44ca0596f589b9f8783152926b0415b2b78ca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 23:10:01 2012 +0100

    cosmetic

commit 632271ab03bbc4dba1979fc19994dae0ec29d61b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 22:48:23 2012 +0100

    cosmetic

commit e542da0a5b29f5df74e8fd0ae12d435f3b199f18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 17:53:33 2012 +0100

    No longer need confirmed_broadcast if immediate no longer exists.

commit 66976f9bc12194eb81d002fe62399030d58aa939
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 17:39:07 2012 +0100

    appease dialyzer

commit 9c7a8993f202477a4e2ddd93e40df680d1b6f1be
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 17:38:36 2012 +0100

    improve workingness

commit 732b7b8dafc1126570cc686b2b8a14f73dcdaa64
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 17:24:59 2012 +0100

    move table handling code from rabbit_mnesia to rabbit_table

commit c1363545bb40ab30211f6078d6157be7454e10ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 15:42:00 2012 +0100

    You would think I would at least compile it.

commit 4a4bd43ab4cbf1aff1605d9a306bbbf494e71fb6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 15:37:36 2012 +0100

    some more inlining

commit abe09fafd79c8addee98e62e401f4d5a0ac93e94
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:58:49 2012 +0100

    inline is_only_node

commit e68fe7faad31792350177d99ca9f3dc82fd79d55
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:58:38 2012 +0100

    cosmetic

commit cfa205bdedd7b4bf9ce6a1314f75733f60b41042
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 14:41:04 2012 +0100

    Never display negative memory.

commit c1b26f1ec58130434c927444a7e44a92e463292a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 14:26:13 2012 +0100

    Plugins

commit 4db1f439da5b7da45ca27da1f3533948924bd667
Merge: b8d5a0ca8 70de5d805
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 24 14:25:58 2012 +0100

    merge bug25148 into default

commit c73677f5650c2693e14c81121e81a68c564f999a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:17:11 2012 +0100

    cosmetic

commit e2b1bb1b5012a49c6a7927258da338dde471e243
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:16:47 2012 +0100

    simplify forget_cluster_node
    and get logging right

commit 8b319a7263ed9361b2d3986caa3169a4c1acd71f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:15:03 2012 +0100

    simplification around various node list functions
    - cluster_nodes/1 accepts 'ram', eliminating cluster_ram_nodes/0
    - introduce is_only_clustered_disc_node/0 helper and get rid of
      is_disc_and_clustered/0 and is_only_disc_node/0 in the process
    
    Also inline disconnect_nodes/1.

commit 4d2e1606cdb8698dee0a4313408f6860289f5deb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 14:06:47 2012 +0100

    logging and error reporting consistency

commit 12ea184cc5b844f92abe48c7135e0a8b4f2aa5d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 13:59:48 2012 +0100

    inline init/2

commit c6a9501266c39d0efb085e6ae541114531c060dc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 13:57:37 2012 +0100

    tidy up exports & specs

commit 151b71f70bd6c930846450b7cf46fdde696d8622
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 13:56:57 2012 +0100

    cosmetic

commit 1a5d9a3a1630292cdcd72853a4284f2c9cf28f05
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 24 13:43:28 2012 +0100

    cosmetic

commit 6061a00dd5ae820a12ac9899f2495b07b7808eed
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 13:31:22 2012 +0100

    Add in memory used by SSL and outgoing connections to the connection / channel total.

commit 4f403fba9217a3c96a385ab75213f7aa3ffce576
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 12:57:06 2012 +0100

    Ignore dead processes.

commit ef36a52dbf54560de4bb4fa23758de027ea97942
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 24 12:54:19 2012 +0100

    Move this stuff to its own module

commit b8d5a0ca8a62dcd14062821faedf2ec3a0cec216
Merge: 61f0808ed 70de5d805
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 24 12:17:23 2012 +0100

    merge default into bug25148

commit 640b52e89e949df03f4129739591c78e617c0d74
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Sat Sep 22 11:05:46 2012 +0100

    Go to an entirely supervisor-based way of counting process memory. This has the disadvantage that we need to combine channel and connection memory, but we are far more inclusive, accounting for limiters, writers, supervisors etc. In particular this helps a lot when we have thousands of queues since the queue_sup ends up taking a lot of memory in its own right. This seems to bloat rabbit_mgmt_external_stats less (although still some) in the 100k queue case too. Also measure memory use of mgmt_db and msg_store processes and add them appropriately.

commit 6ba23fbc2a9b9ecdb2fa79838f1f6b58a417a6c5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 16:50:59 2012 +0100

    fix in change_cluster_node_type

commit e64ee91685d6d7a5c59992f7bdaedbe8dc53bd50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 21 16:41:25 2012 +0100

    Rename this, since it can include memory which does not still belong to a process (e.g. after GC).

commit 40eeb8ce5526933ba0a6e3908493737f74f63a85
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 16:16:52 2012 +0100

    forgot about the other thunk

commit 279855cc7cf459a1dc0525a0f2f9c00d7ec7fb46
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 16:09:32 2012 +0100

    not a thunk anymore

commit 9c8aaa2223981431466f01d1e91c4384f7c3d6ba
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 16:01:08 2012 +0100

    reverse to using `system_info(running_db_nodes)'
    
    We noticed that our function is never necessary.
    
    Doing these changes, I also noticed that `running_db_nodes' does not do an
    rpc call if mnesia is running, and instead records the running node in some
    ETS table.  This makes the clustering management tests racy, since we don't
    know when the information about the nodes which are up/down will propagate.

commit 4a4e9c37f572d96746f786df80957b88694f3a9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 21 15:55:38 2012 +0100

    Account for the mgmt DB as another category, since it can get quite big.

commit 70de5d805e9165a80c570d0edab52b203189a5a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 21 15:30:11 2012 +0100

    refactor for clarity (I think)

commit eb5266ce5d4a48c672dbf36abe8babc4456027dc
Merge: de4e9a848 34e2cc95f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 21 15:26:23 2012 +0100

    Merge bug23896

commit 34e2cc95fd2819256f42a08e0ead701101fd4630
Merge: d288b524f 47acddb87
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 21 15:05:59 2012 +0100

    Merge bug25089

commit 8902551c7e0e811716aeb3a6852489dd84509381
Merge: 78d7a739f 47acddb87
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 13:13:07 2012 +0100

    merge default

commit 78d7a739f4d23ec5dbba80381809fd82506a72af
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 12:34:08 2012 +0100

    unify the various functions to get the cluster nodes into one

commit 9a30798a2e81178013c87ca505ce94ff49fc11de
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 21 11:15:00 2012 +0100

    revert all the ordsets operations to lists

commit 68a220c3aa2dd247a2ee73c87608cfb07da69bf3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 20 14:47:52 2012 +0100

    Handle the case where we go from unmirrored(A) to nodes(B, C).

commit 99ad4ef213496348b1c7af5591b48c637baa1522
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 20 13:47:33 2012 +0100

    "nodes" policy should not suggest nodes which are not running. Also if nodes policy is completely unconnected with reality, just keep the master alive rather than blow up.

commit a47462c0ba909d3d2ea729b0affbeae5c06b330d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 20 13:32:22 2012 +0100

    That case was originally written to cover the unmirrored case - but actually the queue might be mirrored but with no slaves, or about to become mirrored, or whatever. And our is_process_alive() check serves the same purpose.

commit b9cc36b548530900d2b5c1cd53aa72e8a3b3d1ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 20 12:05:07 2012 +0100

    Start new slaves in response to gm deaths a bit later, to prevent deadlock. Also remove {add,drop}_mirror/3 as not used, and don't export drop_mirror/2 as not used outside the module.

commit 06e4d02237e014ec68eace85357cb1a7e116517f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 16:06:22 2012 +0100

    better specs

commit 611129fe726188a466f1f736e4132f192d5505ae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 15:59:03 2012 +0100

    simplify

commit a8d5e5a02de3750ebb04668c61fe14a5d86fba8b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 15:40:50 2012 +0100

    cosmetic

commit 4fc730e8acf966bcb06a312adea3d0b5bd3d365f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 15:39:06 2012 +0100

    eek

commit 8e4055e3e8d543480ac26c7a4550813f39e8e3d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 15:26:08 2012 +0100

    inline

commit 221e0fbf39e49fb8135599c8fcdeac948d9c7395
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 14:34:59 2012 +0100

    That hack should not be needed any more.

commit 664def6c6c23748683af48c1e74f8b5e10c33664
Merge: dedee233d 47acddb87
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 14:32:52 2012 +0100

    Merge in default

commit 47acddb87bb50de2552a7a81da79b74037c23e1e
Merge: 7844be19f c28efc0f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 14:29:00 2012 +0100

    Merge bug25167

commit c28efc0f79592843eb8d71a893e9978b1a8588b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 14:28:33 2012 +0100

    Simplify

commit 7844be19f3f24bc6d92cb5e329692a4872f5187f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 13:01:36 2012 +0100

    fix `rabbit_mnesia:is_virgin_node/0', was checking only for one status file

commit 0073cf5fdd3b3be0c17d3717251b2aa14be6f8a3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 12:50:49 2012 +0100

    oops.

commit 53a7fa17dfa2c5dc4a6aa5266d76d69cae31628e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 12:41:48 2012 +0100

    ordsets instead of lists in `rabbit_upgrade'

commit 667cf37e691c148e18e0d7a4cf6cd361e459c2c1
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 12:31:58 2012 +0100

    ordsets, not lists, in `rabbit_node_monitor'

commit 6be4a23d896de4a54db54e156f08f3d4317d8d72
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 12:16:33 2012 +0100

    revert to manual rpc for running nodes, but use mnesia to check if nodes are running

commit c17909257993767785c088001276c87cb7da3a05
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 19 11:48:52 2012 +0100

    use `system_info(running_db_nodes)' instead of rpc+application to detect running nodes
    
    This makes half of the tests to fail.  I rember encountering problems, but I don't
    remember wheter I had understood what was wrong or if I was happy with the other working
    solution.

commit 5293ded9f0d57719419a0a53fd3920ce7fbe4345
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 19 11:23:52 2012 +0100

    use the correct type

commit c6ac018beadf3c5198d24d199de25906eea81377
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 10:45:10 2012 +0100

    Reinstate atoms

commit 763e7ad5ee770e54dd5489e74a926b89777fac2e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 19 10:40:21 2012 +0100

    Simplify

commit e50659e7018eddd6658471eeb06b89c7f0334d44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 23:46:58 2012 +0100

    As far as the user is concerned, atoms and code are really the same thing for memory use.

commit 3905e4284e5f695a3d1191e1867af8f3aabb5ec7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 22:30:37 2012 +0100

    Move to rabbit.erl, and only invoke erlang:memory/1 once so we do a better job of showing results from a single point in time.

commit c002a17f3a9be74388e4845d3f1eb5770a55957c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 21:34:07 2012 +0100

    Consistency

commit c713245a23fcd0a6d3d6b5272181c7fb79d7b56f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 18:29:08 2012 +0100

    Try to keep our categories disjoint.

commit 0ea7e3149d81d1f52d744ca4f5ece15c375fa789
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 18:08:32 2012 +0100

    rabbit_misc:memory/0.

commit 2e74276bffccb0156eadbcdf7d90b1bcdf95a432
Merge: af518c9a0 b2000dae4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 16:03:00 2012 +0100

    Merge heads

commit b2000dae4e222fa0a4c219fcfc04848559d72d0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 15:59:46 2012 +0100

    Oops

commit 2d024373c6791988ba707d2b80c91786819be00b
Merge: 20a051f19 13c794e13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 15:51:09 2012 +0100

    Merge bug24997

commit 20a051f19cb338823f488c02a7d07c51d4f75066
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 15:50:57 2012 +0100

    Swap arguments of transfer/2.

commit af518c9a07917831fab0e76c82465f58a2455195
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 18 15:41:44 2012 +0100

    get rid of a helper

commit a85d916b3444174f4fe1f43e61a65868728812db
Merge: e5dba1661 16b36d1e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 15:32:17 2012 +0100

    Merge heads

commit e5dba16610aa66242aa9dff731972fee1c9a815a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 15:31:51 2012 +0100

    Rework booleans around init_db() and friends:
    
    * Rename "Force" to "CheckOtherNodes" and invert its meaning, to match
      "CheckConsistency", and since I hate "Force".
    
    * Reduce arity of a couple of functions which are only ever called one
      way round.
    
    * Rearrange order of parameters to init_db_with_mnesia/4 for consistency
      with everything else.

commit 16b36d1e63389efc52fb051ac0ae61b4bf7f0ec6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 14:56:32 2012 +0100

    This got swapped round.

commit 13c794e13636bc9cf4c91d6c44bd58ed3c9d0cac
Merge: 681b4c8c2 35ec3f9ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 14:09:58 2012 +0100

    Merge bug25158.

commit 8e9ccd21664774346cebb2901e3d67f34334e6cf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 18 13:18:20 2012 +0100

    cosmetic(ish)

commit 84dac81cbf3c5f23d06da456382651b68fab52bc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 18 13:15:25 2012 +0100

    cosmetic

commit 9ed9607749539b7eb19b3c014c9140f019aa3aed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 18 13:08:23 2012 +0100

    some abstraction

commit fc771e8571efbf54a9dcc463cb5df60fb62cd40e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:54:41 2012 +0100

    another list operation

commit 7ed395351814b59687be71da5b71b26e8e68af8e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:46:26 2012 +0100

    `of' at the end

commit 35ec3f9ea37b4cb76f8f7c67d382b62afb8ae88c
Merge: 5415e3c6d 1e649b514
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 18 12:43:31 2012 +0100

    Merged bug25144

commit e6df3ef91ce4c9083eca14b8396aa9204a0dd867
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:42:24 2012 +0100

    reorder functions

commit 2868729fb25b8e6586ab078e2ea38ee038b7259a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:40:21 2012 +0100

    remove ?empty_set

commit aba986b01dda17a2a6c56f4c9e2645e11a624f8e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:31:21 2012 +0100

    another list in the wild...

commit 33cdee7e7cd9ca2c1978ffccea4660d3be1ffb68
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:23:12 2012 +0100

    forgot one list

commit eecc909e28b234206f3b33e4526e85f0fc7228cb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 12:16:03 2012 +0100

    never use lists constructs when dealing with ordsets...
    
    ...except in the `is_empty' macro, that cuts down a lot of cruft when ispecting
    sets for emptiness.

commit dedee233dd8699acb283bc55521487b626ba5285
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 18 11:42:55 2012 +0100

    Pull our attempts to list all nodes out of transactions and loops.

commit 155efb9c510a1c818c0c084221d1b9b86820b838
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 11:42:15 2012 +0100

    equality => pattern match

commit 2d2af921b432bc63f621d7eb4f52e95ddb6495db
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 11:40:12 2012 +0100

    update rabbit_app.in

commit bf432ed6131c40efcc26488c86f0830a3f649ea4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 18 10:59:42 2012 +0100

    ditch the booleans to control decisions on disc/ram nodes

commit d288b524f2ffee38386ef58dbb25b63f772df8b6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 18 10:24:59 2012 +0100

    Allow direct connections to supply a password

commit 5415e3c6d24554ecc48156b1c8fdd7eabd0a7dc9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 23:14:38 2012 +0100

    move all the error descriptions to the end
    ...so they don't clutter the logic.
    and some other minor cosmetic changes.

commit fd00609c7b1fc3c3912e22a7b7c66ec84b353e8e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 22:32:23 2012 +0100

    correct comment

commit 02f923f2f21a68023662b5254d1653f830dcb308
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 21:50:58 2012 +0100

    some tidying up
    - normal_init/2 -> init/2
    - DiscNode -> WantDiscNode (when it's a boolean)
    - shrink comment width
    - 'of' never goes on a line by itself
    - save some newlines
    - introduce leave_cluster/1 helper function

commit 681b4c8c2c685ef6576bd53a815ff43a2e9dea42
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 16:14:41 2012 +0100

    ensure that slaves confirm messages when ttl=0
    Fixed in the simplest possible, rather than most efficient, way - by
    removing an optimisation.

commit db0518cb26c6f1bd87708829ed4b24ba017a679e
Merge: 755c6a293 76ec63195
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 17 15:57:59 2012 +0100

    merge heads

commit 76ec63195079209c6a2793a181ec2fbf2e34d8cb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 17 15:57:09 2012 +0100

    refactor the check for the expiry out of `basic.publish'

commit a1962c7aac97c259c82c5336ce081f2626cbc3e9
Merge: b14de0b2a 4f69d8276
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 15:54:08 2012 +0100

    Merge bug25152

commit 755c6a293ca14243860e675cada59faf8143475e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 15:30:25 2012 +0100

    Typo

commit 4f69d8276ea8091788ffe95aa7898a77ca2c182b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 17 14:58:49 2012 +0100

    fix messed up rabbitmqctl usage

commit b14de0b2a797214d00370ee3ae16a12ac4651869
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 14:55:20 2012 +0100

    Increase the amount of symmetry.

commit de4e9a848231d6c7909ff5ab88bcac06dd044dbf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 14:15:11 2012 +0100

    nuke 'immediate'

commit 3921e5e8c6be2b52a6565bc23318a69ceb94f107
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 13:36:48 2012 +0100

    Simplify

commit 07e5e2ad459a13aedaea693c2b647741f0c8ca9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 13:27:16 2012 +0100

    Cope with the fact that rabbit_mnesia:running_clustered_nodes/0 now does not include node() during boot.

commit fba6f8213f2bb993247d961e3b9e50766d5dabd1
Merge: 01814fb6d fcbdb468a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 17 12:35:15 2012 +0100

    Merge default

commit 01814fb6d7eb585841ab15a2c4cb3f709c45e81a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 08:46:04 2012 +0100

    file_name -> filename
    The latter is used in more places and also by OTP.  In the process fix
    a bug - rabbit_upgrade was referencing
    rabbit_node_monitor:running_nodes_filename/0, which was in fact named
    running_nodes_file_name.
    That function was also missing a spec.
    And it was in the "wrong" place w.r.t. the function order in the module ;)

commit d89f4219023d2aac723e9da0a7d2840483199891
Merge: a1da6f1d9 e4c7c2355
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 07:50:11 2012 +0100

    merge bug25154 into default

commit a1da6f1d972e0d4a32aafa049b62015edbd77d94
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 07:49:25 2012 +0100

    1MB = 1000000B for disks

commit e4c7c23552b3d5fc625513d217340193ed941fff
Merge: 08f1247b8 92a6b83f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 07:01:39 2012 +0100

    merge bug25154 into default

commit 92a6b83f2b696560369a6d207ca826239bec5a23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 17 07:01:20 2012 +0100

    correct disk space log message and remove ambiguity

commit 4a0afe5bc30f15a531a98dd1a25973587a4a9bce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 15 20:55:40 2012 +0100

    simplify and handle missing 'same ttl' case(!)

commit 4d96b0517a6e8b8ea52e8dcb6d90357637758641
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 15 13:25:10 2012 +0100

    bring queue/exchange removal cost back down to O(binding_count)
    by performing all mnesia read operations before writes

commit 9fceeb839399a9c6ea14778461840bddd5f27b13
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 15 12:27:20 2012 +0100

    guard deletes on disk tables in order to eliminate superfluos fsyncs
    Unfortunately this makes queue deletion O(binding_count^2), so further
    work is needed.

commit fcbdb468a87736d65da6bd04f473ef0a9eefb787
Merge: 08f1247b8 95a36061c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 14 16:19:31 2012 +0100

    Merge default

commit 08f1247b8a6915e1017527ac860617c49f284f36
Merge: c9719a723 ca2808096
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 14 16:05:46 2012 +0100

    Merge bug24914

commit ca280809689c719f23a775ced0d663b9bc348d5f
Merge: 5946b4feb 5237ec9c4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 14 15:06:32 2012 +0100

    merge bug25118 into default

commit 5237ec9c405ffbb3cd5ac783758d88893de07eb5
Merge: 5946b4feb a4a6a10c3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Sep 14 15:06:05 2012 +0100

    merge default into bug25118

commit 13d2d2aec3ce51b187545b6265176de21dd7bb7c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 14 15:02:09 2012 +0100

    Tweak docs

commit c9719a7239a7be46178a5acc187f4013f633e7c5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 14 13:38:25 2012 +0100

    fix comment in node_monitor, keep {error, enoent} in `try_read_file'

commit de5b2bdf88e37a6c40b1459c73d488776cbdae3c
Merge: 5946b4feb fc08a0cd4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 14 13:00:51 2012 +0100

    merge default

commit 5946b4feb0080b4a53b4b1e9bf3b9795a1592012
Merge: 295fde825 a2fd7f5c3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 14 12:20:00 2012 +0100

    Merged bug25072

commit 295fde825147381823631b2f5f59052be4189879
Merge: 5575fa0bf 6ebf98f83
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 14 12:15:19 2012 +0100

    Merged bug23903

commit 61f0808ed9470cad6146c694e8431b5f19825360
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 14 12:06:08 2012 +0100

    Try to handle startup errors in apps that aren't rabbit at least vaguely intelligently.

commit d7e302dba79122361f7c1caf7f4bc3004886bba0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 14 12:05:10 2012 +0100

    Variant of {start,stop}_applications that takes an error handler.

commit 74258b338d670e0ad4f5343ccdafdd1eb8b91910
Merge: 5575fa0bf 7dbdc5328
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 14 11:54:21 2012 +0100

    merge default
    
    In particular, enforce the limit introduced in bug 24867 with per-message TTL
    too.

commit a2fd7f5c3d52a97cd7f7f3a78720e7136f5ba6dd
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 14 10:59:58 2012 +0100

    fix runtime parameters test, and little bug with them

commit a4a6a10c3030efe2800e143f2ec5d3bcde56215a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 13 17:48:36 2012 +0100

    updated the essay to explain how the sync status works now

commit 5575fa0bfa0bb4a426c24ffb6459dc99b0b17a2a
Merge: c640958ee c6c30e897
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 13 17:39:33 2012 +0100

    Merged bug25072

commit 1e649b5144e6e2b06e2309debe9be062eec0bf67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 13 16:01:10 2012 +0100

    Remove the Mnesia record after we are done with it.
    
    This requires a certain amount of churn - we need the queue name to remove the GM group, but the VQ does not know it. So we end up asking the GM (of all people!)

commit fc08a0cd40a85b109af5d515694590694ee63c39
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 13 15:41:42 2012 +0100

    get cluster nodes from mnesia when legacy/non existant status file
    
    This is necessary because the upgrade process needs to remove the replicas
    of the schemas.

commit 63a9bb6a68d8c04520b077a08d9e7e26368ef51d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 13 13:18:46 2012 +0100

    check the cluster consistency after the upgrade

commit 6ebf98f83b33df44ced1fbc65cee697a30280a92
Merge: c640958ee 6e9b9aa49
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 13 12:20:30 2012 +0100

    Merge default

commit c6c30e8973977a082a07c1ed8662ff7410da7a43
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 13 12:18:55 2012 +0100

    add mochi license information

commit c640958eed29bf74dcc8874db5d9b53a301f78fe
Merge: f60d0fb86 75db54a65
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 13 12:11:31 2012 +0100

    Merged bug24888 into default

commit 7dbdc5328e52846d3473ce18543fbd8eb4c7a91d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 12 17:35:46 2012 +0100

    pick the lowest between the message and queue TTL

commit dbeec1b52b5ee40abf27961ce6945bc91beed1a7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 12 13:24:24 2012 +0100

    always call init_db with all nodes

commit a4b9d2fa172c73b33b3078836bd5d79249b844ac
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 12 10:52:44 2012 +0100

    more informative and useful error messages

commit 98ae9832ab078389217d5ab928a48f9ed45cbf92
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 18:56:13 2012 +0100

    do not give up when finding an inconsistent node

commit 80c35cd00c1f4b87177123bd9be414c5d71d57fa
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 18:49:21 2012 +0100

    oops

commit a86bc080a6d0deae9192145e871a61d73da4d6f8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 18:37:50 2012 +0100

    split cluster status file and running nodes file

commit 75db54a656b13a6d9e2bfd0b7ebffb30b494a42a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 15:07:31 2012 +0100

    cosmetics

commit ba5b3bb9f3405daf71bf8ff40a04ce11eb7d6668
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 15:07:17 2012 +0100

    do not bump the publish seqno when we can't publish DLX'ed msgs
    
    Emile notices that it's not necessary

commit f60d0fb86d6bf3d5ceab9bbb91c9107d5a34c6e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 11 13:25:42 2012 +0100

    cosmetic

commit 6e9b9aa49619835f8fb6392320917ddc83793854
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 11 13:10:01 2012 +0100

    Allow direct client users to provide a complete #user{} record rather than looking it up for them.

commit 97da95f1390d401df3e00accd16af43e87f408d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 11 13:09:29 2012 +0100

    Remove the previous hack, add a check for the "impersonator" tag instead.

commit 765b364c7ebfd913f17dd69b7ede57d3627b291e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 11 10:13:35 2012 +0100

    pushed changes to Makefile by mistake

commit fc8b48639d21d56c573757c694173596cb967616
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 17:33:16 2012 +0100

    Oops

commit 86b61efe83bc009fa642452c7acec1e523caffa7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 17:21:31 2012 +0100

    Attempt at simplifying check_cluster_consistency/0, but I am having trouble with systest.

commit 4a33db73ff8004bff84c6e73893e0c96ae771ccc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 16:20:49 2012 +0100

    increase the seqno when the DLX is not found

commit d893c71442696f854a3e50f8af872c2c7d475efe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 15:22:27 2012 +0100

    Rename

commit 90c5cccca622e9dd256713d6e35338c1d878d7a8
Merge: 7b5c49fe9 347ae507d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 14:51:26 2012 +0100

    merge default

commit 7b5c49fe977af08b37cb56d6f8c2b98a95ccff11
Merge: 2267afef8 c64a86901
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 14:44:45 2012 +0100

    merge

commit c64a869017f46e749c0884ddf8a5f415bb8b78a7
Merge: 456af2293 319aa686b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 14:43:09 2012 +0100

    merge default

commit 347ae507df6d28da169dbef65f1a7f356819e3f4
Merge: 319a486d1 24315f39d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 14:39:20 2012 +0100

    Merge bug25062

commit 319a486d11bb1cc1ea1a3c86933e467fb7f39173
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 14:16:06 2012 +0100

    Simplify

commit 2267afef8ce86ff989fba3db1717065eb35ca0ca
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 13:45:57 2012 +0100

    add mochinum.erl, which is needed by mochijson2.erl

commit 24315f39d4cd4973742fdf83b44a3830f3ac6e40
Merge: 456af2293 120807d00
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 10 12:00:35 2012 +0100

    Merge bug24867

commit 120807d00ac013131a7a941a09c251c75a93c32d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 10 10:32:42 2012 +0100

    check that the ttl values are less than what `erlang:send_after' likes
    
    Since it's an extension to begin with, I think it's OK to limit it.  I doubt
    anyone will ever want a ttl of more than 50 days, and if they really complain
    we can fix it in the future.

commit d4b6f7f3ca063ea4192a6cbb3ae5e107f9ad9d8a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 10 10:29:09 2012 +0100

    Reduce over-engineering of default policy priority

commit 5b9bdc41a322e1d3c8101c741f5387ae070661ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 10 10:04:44 2012 +0100

    Backout changeset 25ee0d6a9c30

commit a4a56513db8ffd999f34976cfe34dc4ca72d7c34
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Sat Sep 8 12:39:33 2012 +0100

    a bit more informative error

commit 85a9fd2dd5c75e80684664276f8b2a8686713d66
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Sat Sep 8 12:32:29 2012 +0100

    check validity of the expiration in basic.publish
    
    Checking it always is not a good idea, since we don't always decode
    the properties.

commit 31c0078c901f8c2254e0a04730a08e6d839aadc6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 7 18:07:57 2012 +0100

    Typos and rephrasing

commit 3082cbd419496f30318b3c0284216051061d1a8e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 7 17:09:22 2012 +0100

    binary, not string

commit 59a6b7762751c5fe4ab5fe0caace55edf7e32435
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 7 17:07:45 2012 +0100

    per-message ttl, based on the `expiration' property
    
    Right now I'm just emitting a warning when the expiration can't be parsed -
    we probably want to reject the publish.

commit 456af22937c237ea04cb529938665564bcecf999
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 7 13:46:56 2012 +0100

    cosmetics

commit 66e27badc649e5d928d59631f8478300171c7730
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Sep 7 13:25:33 2012 +0100

    handle ttl'ed messages in bulk

commit 55c32ad3b6cb2755b524de72594a378b87884057
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 7 13:10:25 2012 +0100

    Add a backdoor to allow the direct client to set a trusted user-id. Yes, this is ugly, but the diff is small.

commit d5adfd080b4693d1c666034fdacc1f101cc6996f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 7 13:09:36 2012 +0100

    Add a boolean validator.

commit 9d667eb5323ed930ded571cf97f1f8e8992a3358
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 7 11:08:19 2012 +0100

    Backout changeset e847a6c6dc9b

commit 837c741e45db6a7741fbf3df9726643559991fd1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 6 18:01:24 2012 +0100

    Constrain policy regex patterns to binaries

commit fce079e8a7f074326bf1156e5e9158450bd4ab56
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 6 17:51:47 2012 +0100

    Permit absent policy priority

commit d299116ef84e207f5131167fb02f7a0343d7a847
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 6 16:50:35 2012 +0100

    Backout changeset 3ac70be8c5a2

commit 89b18aad7a39abbe87cf76da0668435ccd299445
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 6 16:45:36 2012 +0100

    two little fixes...
    
    It turns out that the problems I had with the kill-multi test on default
    was because the messages were start publishing right after the queue was
    created.  I thought that once queue.declare returned, it meant that the
    queue was present on all nodes, but it wasn't, and for this reason we had
    the mismatching messages and the purging.
    
    Once I discovered that, I went back two my code and immediately discovered
    two very silly mistakes.  I feel silly as well now.
    
    I think that bug 25130 still has a reason to extist, but I wouldn't worry
    about it now.

commit b520ec5272f027844e57bd3d58cc673f3d948239
Merge: b6ea31ea6 00bb2bd8c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 6 15:52:34 2012 +0100

    Merged bug25114 into default

commit 00bb2bd8c51bf70ce44b98d91c5f780afc2e097a
Merge: 20d158c5c 5ce0ea8c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 6 14:45:21 2012 +0100

    Merged bug25000

commit 20d158c5cbd4892d228c0f308fb24b3495f1ec08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 6 14:44:53 2012 +0100

    Terseness.

commit 9ede4e7bc4b5acbf035bc11287b0ef4f7ad3bb8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 6 14:42:10 2012 +0100

    Not sure it's worth explaining that, the explanation is not clear and I can't think how to improve it.

commit 2c0acefa81c1a1748540ad24fb0190e863adda0c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Sep 6 13:53:02 2012 +0100

    emit warning when starting detached rabbit

commit 95a36061cd064e866f86c162eb9e60c513bd5add
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 5 15:18:15 2012 +0100

    cosmetic

commit 387b845fdc29dd3e0c335f6aa8f3e5f49e835665
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 14:54:17 2012 +0100

    Also exclude DeadNodes from the list of new nodes to start mirrors on; we have checked for running_clustered_nodes() but that could be out of date.

commit 5f049990899e7646e43296066051de2c578b49e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 13:28:04 2012 +0100

    Cosmetic: give that comment room to breath.

commit f2f0bca55ac5aa772f1e1e781b5943785c8862b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 13:25:03 2012 +0100

    Call add_mirror/2 before drop_mirror/2, and explain why.

commit b6cb093e42aaa53f1ffcf3f5fe7b4d54a7873274
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 5 12:50:03 2012 +0100

    typo in rabbitmqctl man page

commit 881a6f6e1e78f9c9eb40769959fe63c120d8da8b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Sep 5 11:36:31 2012 +0100

    don't record pid when using -detached

commit 31be44cec399122124c16df17baa9f6aa83a9fa5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 10:41:13 2012 +0100

    Gah

commit 170fa80089f4c31072e2313596ed721bde0f276b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 10:39:46 2012 +0100

    No we don't. The point is that if a mirror is dropping out of the queue, does it need to explicitly leave the GM group? The answer is no: the master is linked to the coordinator is linked to the GM / the slave is linked to the GM.

commit acf212e77a8d0efa79f6d5bc0f9d7be08c0c0edc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 10:27:28 2012 +0100

    Add specs, remove misleading "%% temp" comment.

commit ee56fe363387977660d241a37a6b69de5e02eae3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 5 10:08:51 2012 +0100

    Reduce difference to default

commit acd9f8b65671b14bca1d63cbb86a27d907eae7d2
Merge: 5ce0ea8c5 6fa5c4183
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 4 18:35:23 2012 +0100

    merge default into bug24908

commit 6fa5c41837a8c0ac52f0db24458c7fc26a2ff7f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 4 18:13:46 2012 +0100

    more reification, plus cosmetics

commit a9a1448695c35d490e3f92cafb1f7299d096c13d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 4 17:55:11 2012 +0100

    Reify a touch more.

commit 5ce0ea8c5f2c3981fc92fe83329eeb8bcf26b916
Merge: 7624bf5f6 363aacee5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 4 17:54:31 2012 +0100

    merge bug25119 into default

commit 363aacee521f35e32ffbc0a477b967509395dd2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 4 17:53:43 2012 +0100

    tweak test
    - drop eunit - we don't use it elsewhere and it adds little value here
    - lower the TEST_RUNS * CHILDREN count
    - no need to run 'kill' part of test with lots of iterations/children
    - stop on first failed run
    - on failure, return iteration and exit reason

commit 9b03ee1ac4acf2c81d1a258b191d41ac13e6badc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 17:04:27 2012 +0100

    cosmetics

commit 707b5c95544955650a6c45ae76bf55f16e1b3b3a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 15:57:38 2012 +0100

    cosmetics

commit 9c8cd5e0e85f0819d761eaee9168c6ee49860ade
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 15:51:50 2012 +0100

    cosmetics

commit c4ee851eaf792060dbc345d683cd17c6e2b50320
Merge: 21e56db75 7624bf5f6
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 15:50:41 2012 +0100

    merge default

commit 21e56db755e099dc5a3c0bf160acd5843768959c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 15:50:30 2012 +0100

    remove differences with default

commit 7f1963c18af2952ba18826dcb0afeff17720c40e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 4 15:43:59 2012 +0100

    Another attempt at explaining disc vs RAM nodes, and capitalise RAM.

commit 6aa05574966662c78d4ba60474d3718ba7aac669
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 15:42:22 2012 +0100

    track the delta of the depths, and replace `pending_ack' with `depth' in BQ
    
    The kill-multi test is still failing...

commit 39f3bb49022af3e44d79c6d4b285333f3791be82
Merge: 2a788ef66 7624bf5f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 4 14:37:53 2012 +0100

    Merge default

commit 7624bf5f6ec5b90ac30e32c923677988976cefc4
Merge: ff5544e78 7ec27ca5a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 13:38:29 2012 +0100

    merge bug25119

commit ff5544e78cee7bb82a93923bac9633d75a57f143
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Sep 4 13:21:02 2012 +0100

    refactor tests

commit 7ec27ca5a43f58a408176c225d54bf13f910fb72
Merge: e1dac8214 3e4765b5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 4 13:06:57 2012 +0100

    Merge bug 25120.

commit e97a5d7653e72893865b6c87f47acfe0a7a07ecc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 13:00:47 2012 +0100

    was getting `set_length' instead of `drop'

commit 71285b38b5fcd6b8e4a076b43eba7360354c9991
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 12:57:08 2012 +0100

    fix depth delta in the `publish' instruction

commit e1dac8214b4607aa0eb10d3112ac4151ac2fb6cf
Merge: 4bc73caa9 174c2e55d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 12:01:52 2012 +0100

    merge bug25119

commit 4bc73caa9b984191819b83b2dfe2f481be2eca15
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Sep 4 11:23:18 2012 +0100

    cosmetics

commit ebdf3e659a1282736aefa117d339e3d25f2d1314
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Sep 4 10:56:32 2012 +0100

    rework tests for most simple case of child termination
    increase test coverage for whole of terminate_simple_children
    fix bug in timeout handling clause of terminate_simple_children
    cosmetic (trailing whitespace)

commit 3e4765b5df7ea093f35167b6898d467f4869d6c1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 3 18:34:49 2012 +0100

    explain

commit aa4f07f09a22382d6c6f8d3e2ee98140699d5774
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 18:11:21 2012 +0100

    export only what's necessary, cosmetics

commit 819229c61f1d9b1cfb60bbe96991d7248ff3c726
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 18:04:10 2012 +0100

    cosmetics!

commit 132f36715bc0691aeba5771c116cf360fe55a25f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 17:56:57 2012 +0100

    cosmetics

commit dfbbfb9a91528562f1bb7c0d17ba5246d3be253e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:51:22 2012 +0100

    cosmetic (again)

commit e7771360905e7547f9c38733381314bd842212f0
Merge: 696623538 5cad69e53
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:46:44 2012 +0100

    cosmetic

commit 5cad69e5373e89d78b93125d17209a83a7a75f69
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:46:18 2012 +0100

    remove useless test case

commit 6966235384a3ac1451437f5c0aa6ada09a6ecfa9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 17:40:38 2012 +0100

    cosmetics

commit 4e1b2e1a9da7cbc0ffdcc459a04294980aba9445
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:34:39 2012 +0100

    oops

commit c5b0486c271daa62397bb66df809a32b2b498c03
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:17:17 2012 +0100

    cosmetic

commit 2a788ef664e63abafd2cab640ba9c3efa7942bde
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 17:13:04 2012 +0100

    reset and join when changing node type

commit 3fa43eee504f76d897aca47f056e8d06444d09a0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 17:00:02 2012 +0100

    construct child exit reason in the right place

commit ac9354b322fac5ec4207d63feac5e87549e41dbe
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 16:55:07 2012 +0100

    cosmetic

commit 8436f5d0a3e23c645822827371f6473b3d7ae4e3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 16:43:52 2012 +0100

    Introduce additional, non-smp tests (using suspend) and explode the test
    fixture list to create 400 repetitions of the group

commit fc748dc965c33be1906482ffe039aaa500a06ecb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 3 16:31:35 2012 +0100

    attempt to close ssl connections gracefully but forcefully
    gracefully...so that there is a good chance of TLS alerts making it
    through, but forecfully (after a timeout) so we don't get stuck (or
    worse, silently) holding on to file descriptors and processes.

commit 55e90a93be0c4cd8f15290e660ad75e2e061e7f1
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 16:23:45 2012 +0100

    forgot debug line in

commit 7936748bf1639990d0fc1796c3dcc6f7041074fb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Sep 3 16:00:40 2012 +0100

    store the depth of master and slave instead of the unknown pending msgs

commit 0e7e14575d5c820532e80bb9180499257fbbfa30
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Sep 3 15:31:48 2012 +0100

    Test that simple_one_for_one_terminate shutdowns no longer deadlock and
    handle reporting errors not caught during shutdown (e.g., 'killed' pids)

commit 678ca1eb3fa05096bb242113e228194a9765b398
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 31 19:08:40 2012 +0100

    refactoring: make the var match the field

commit b6dcf5f79741b02da0d3534ff0f400052d48a4bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 31 19:05:58 2012 +0100

    refactoring: inline helper function

commit ffd739e80b11c314da8e9abd7755f381078f6a3f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 31 18:55:44 2012 +0100

    cosmetic

commit a56b5d96e1b36ed3d384dcd58b971edd654d9729
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:55:31 2012 +0100

    style

commit 1d1a9f7ab565d606f341374ed1d557d5693625b0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:53:51 2012 +0100

    revert `set_synchronized' => `update_unknown_pending'
    
    Matthias likes the old names better, arguing that the main purpose of that
    function is to do that mnesia transaction.

commit f54ae60148a78d840f09d6f2313eee3d55474ae8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:45:37 2012 +0100

    `set_synchronized' => `update_unknown_pending'

commit ad4dfee3cfff0800f278df166976d53a14dc0f18
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:43:47 2012 +0100

    `set_length' => `drop'

commit 3bf9ed90d6ccaa806008c8bbfd1380dcbdff304a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:42:49 2012 +0100

    `external_pending' => `unknown_pending'

commit e2733fe49271fd4ee6079e272a3309cbdf8e99eb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:40:05 2012 +0100

    use `set_synchronized' instead than manually increasing

commit 3e3c5bcc7eb134d642057ba23ebe226445ce1bee
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:39:00 2012 +0100

    simplify `set_length' case, fixing the ToDrop < 0 branch
    
    The unknown pending counter wasn't updated correctly

commit 02b6daaf817baeef5865f5a335b1cbbcc5f4cca4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 18:26:30 2012 +0100

    add the delta in `set_synchronized', fixes the call in `set_length'

commit 174c2e55dabdf4d37679a18fc5aff12574161c2f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 31 18:06:36 2012 +0100

    minor refactoring and cosmetics

commit 16d006b7d19ac9a152985e8f91b18dd8d840c936
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 17:49:56 2012 +0100

    `set_synchronized' accepts the difference instead of separate args

commit e47c4fc77fa87478635417ac1ee4032a8c2cce35
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 16:03:38 2012 +0100

    do not track external pendings until we receive `length'
    
    Otherwise, we might break some assertions.

commit c32bfbf56428c3a2d6b12eb252034cca113c7524
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 15:51:41 2012 +0100

    actually, it looks like the slave might receive messages before `length'
    
    This is not a problem, since the worse that can happen is that we have a
    bogus sync state in the until `length' is received.

commit 05d369412de0107fdb0c46c49901cd8a50c0cc9d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 15:47:56 2012 +0100

    `length' should be the first instructions, lets assert that

commit bc2b4fe3fe292479da2a0a2f348ddad137499b5c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 15:44:20 2012 +0100

    get the external pending acks at the beginning

commit 1e9b9d5cc27eb7d8aa451274ea56bada1f2c56fc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 31 13:59:09 2012 +0100

    add a callback to backing queue to get the number of pending acks

commit 22f9b9bc211c994a6e76f21ee93025788f60c3cc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 30 17:38:34 2012 +0100

    matthias doesn't like the nested `set_synchronised' :(

commit 9578c4896171a1bef58499542fd3e2a7310557e2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 30 17:05:54 2012 +0100

    take into account requeues when setting synch state for slaves
    
    To do this, keep count all the fetches we've seen that require an ack
    for messages we don't have (e.g. when the queue we have is shorter than
    on the master).
    
    We then decrease this counter appropriately when requeueing, acking, and
    set_length'ing.
    
    Given this, we can deem the slave synced only when the length is the same
    *and* the counter described above is 9 - there are no pending acks
    on the master for messages we don't have.
    
    I might have missed something (I barely tested this) but it seems to do the
    trick.

commit fdd68a9c27e2ba6e44f86b3c38c88c77d23b1e7a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 30 13:56:59 2012 +0100

    refactor
    and always prefer the EXIT reason

commit 34560411a1566f7238c29d6681a6c4b77d3cf03f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Aug 30 13:34:17 2012 +0100

    when terminating multiple simple children, we shouldn't rely on the order of 'EXIT' vs 'DOWN' messages

commit ee0f509c662ddb5978d96ad9186a1af2807b8313
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 30 13:04:27 2012 +0100

    missing spec

commit 263e516cc3092734bed5c1b2aefcea8b29aab309
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 29 16:47:05 2012 +0100

    revert last change (reset when changing node from disc to ram)
    
    mnesia, mnesia....
    
    For some reason, this approach does not in some cases.  For example, starting
    with nodes A, B, and C clustered and all disc, the following sequence of
    commands causes an error:
    
      $ rabbitmqctl -n A stop_app
      $ rabbitmqctl -n B stop_app
      $ rabbitmqctl -n B change_cluster_node_type ram # reset happens here
      $ rabbitmqctl -n B start_app
      $ rabbitmqctl -n A start_app
        error happens here:
        {error, {cannot_start_application,mnesia,
                 {shutdown,{mnesia_sup,start,[normal,[]]}}}}
    
    I have no idea why, but it's probably connected to the fact that we can't do
    those changes when disc replicas are offline, and probably also related that
    operations like leaving the cluster require all the cluster node to be online.
    
    At this point I'd give up and put this limitation in `change_cluster_node_type',
    but I want to make sure that these limitations do not have repercussions in
    other commands.  We should already take care of the "leave cluster when node
    offline" case, but there are probably others...

commit e5a82165b98e93ea0f5999d74d4e20ffec044733
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 29 15:10:52 2012 +0100

    reset when turning disc into ram node

commit 75a5461907ee3b03e6d7ce6a8adc749b401a7757
Merge: 3008ba686 dc48c3a36
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 29 13:15:04 2012 +0100

    merge bug25117

commit dc48c3a364253062250ac9df4c4397897f89158a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Aug 29 11:18:11 2012 +0100

    cosmetic

commit 8738bf3165ecfa92ec709af94fd4455f74863d7d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Aug 29 09:49:14 2012 +0100

    Slaves must join gm before updating amqqueue records, otherwise messages
    received from publishers will become stuck due to diverging sender
    queue state in the slave failing to correlate with incoming messages

commit 1c17447900a4531fa246700b3611713917dbeff8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 24 15:22:50 2012 +0100

    rename branch

commit eeebac2d6a479debbf7eb298a627aa7f27617c76
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 24 15:15:49 2012 +0100

    document the fact that -detached causes the wrong pid to be recorded

commit 50f9622368c9431eb1303a2d0c2468a157ec1eb7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 24 12:05:34 2012 +0100

    Disallow empty patterns

commit 3008ba6860807f29ef3189e49995a0ff2bc28322
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 24 08:56:38 2012 +0100

    tiny refactor: rename fun and clarify comment

commit b6ea31ea66807322e0b1f7e8095212d3ba82f111
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 23 16:19:35 2012 +0100

    Try to be a bit more defensive before looping.

commit 6721e237ba1a45d641dbe0951f34c2ef8dfdf952
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 23 15:59:45 2012 +0100

    Compile regular expressions that will be matched multiple times

commit 319aa686bd737d1ae0189881078baa1022eead3a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 15:29:00 2012 +0100

    accept parameters in JSON format

commit 05ca535913410d1ed7aa5e78a20e8094372847c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 23 15:24:37 2012 +0100

    Suggest queue nodes based on running nodes, otherwise (at the very least) we can immediately try to start a mirror on a node that has just gone down.

commit 39db6e5bcc510bcb43f8a38e7bac17f03445c854
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 14:53:13 2012 +0100

    re-introduced wrapper functions to strip and add the `struct' tags
    
    We can live with the ambiguity of the empty list, since we only use the
    term->json function to display the JSON back to the users

commit a5303e6195bb63d8dc278eeb211e3ca61f8938da
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 14:21:48 2012 +0100

    put result in `ok'

commit 7d18df4abe95b83e40ed23cb345eaa5fb279b59c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 14:10:47 2012 +0100

    wrappers around mochijson2 to catch exceptions

commit a2a5468e87627262d8ebcde7a600e4470815ace0
Merge: bbd9a1d85 de787513d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 23 13:25:10 2012 +0100

    merge bug25112 into default

commit bbd9a1d85c1a5ce86b14cdea86f8926cff647c00
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 12:30:13 2012 +0100

    non-zero timeout when idle for the slave as well

commit 6d6ffaf4487d40ecafcc94bbe7b44b3f0a0b762a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 23 11:36:06 2012 +0100

    Fix broken merge

commit 4c29d8ce2bb3c7901e14e777fa1299b1362d107f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 23 11:28:59 2012 +0100

    Match policies by regex instead of prefix

commit e217f7695d5fe84cdd571b253b4daa979e9a838f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Aug 23 11:24:54 2012 +0100

    little fixes to the automatic clustering config code

commit de787513d717b673e03e182db1c9a669babefe8a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 23 04:55:58 2012 +0100

    cosmetic

commit 52b0976b830b637611086523910d5dc66d35ebab
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 22 17:17:44 2012 +0100

    get nodes and whether the node should be disc or ram from config if virgin node
    
    The first suitable node is picked from the list in the configuration, no
    consistency check is done - we might want to do that?

commit 0e2442db25cc4d4aae6df6e440315ef583320a11
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 22 16:00:38 2012 +0100

    s/at-least/exactly/g

commit d1a918746225d04f0a155f00764c70118ccb8b30
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 22 11:57:05 2012 +0100

    remove commented code - we do not use `disc_only' anywhere

commit 1d1425530bf54a0d65f0672b6b6b484c987ffd24
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 19:11:27 2012 +0100

    remove_cluster_node => forget_cluster_node

commit 48eb4317ceadccb3584beb11ea4ff104c0dbff46
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 18:54:54 2012 +0100

    manpage fix

commit b47f7361fe1f583847058bc466bf64f7252fe193
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 18:23:33 2012 +0100

    more manpage fixes

commit 34b7fd7d9f140c78956024e78cb2cd144c61c3cd
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 18:18:48 2012 +0100

    recluster => update_cluster_nodes

commit 80eccd1bdf09f624ed42a6caf8da214367b1ad15
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 18:13:33 2012 +0100

    forgot about the recluster example

commit 5906ad3a624a4702bd6b1b083f7fb582f85eb6a7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 18:10:45 2012 +0100

    Simon's comment on the rabbitmqctl manpage

commit d433235b25c9a2dfb8e56aea7d66e5ef181ceca5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 17:49:07 2012 +0100

    remove the wrapper functions around mochijson2
    
    In the end it's better to keep the `struct' tag - empty lists are ambiguous.
    I was mislead by the fact that the management plugin removes the outer
    `struct'.

commit afe1bd670c95a633e7bb4c7ac938bafdcad9e43c
Merge: feaa1479b c6805e488
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 21 16:42:43 2012 +0100

    Merge default

commit 8da7e50e891052179304a71c17ef3e599f7beabe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Aug 21 15:21:01 2012 +0100

    add mochijson2 and license, plus some helper functions
    
    The helper functions are there to remove the tags that mochijson2 uses
    to distinguish json objects.

commit c6805e488ab036017e7345780d2ea30eee1b3f46
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 20 15:30:41 2012 +0100

    cosmetic - save some lines

commit 08feeff0ab1fe029380ef4f0f20dfd895986ca0a
Merge: f4dd39582 0757bf493
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 20 10:57:03 2012 +0100

    Merged bug25104 into default

commit 0757bf49366f1f5b89aad655dd42dc9f2d83530f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 17 17:45:52 2012 +0100

    So strip all that stuff out.

commit aa899051e6492dff8a5f743b4689daf885f58669
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 17 17:02:40 2012 +0100

    I was thinking that which_applications needed to come first so that the
    process would be gone by the time we got to is_process_alive. But if we swap
    them round the which_applications check will return false in the shutdown case
    anyway. And of course is_process_alive/1 is rather faster.

commit f4dd395823b0ffedd6d50d371b383fd684b1a61b
Merge: 3ccb7e2bc 64004f89f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Aug 17 15:40:04 2012 +0100

    merge bug25071

commit 3ccb7e2bc7d65038cfdf005d449c8e83f73faddf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 17 14:07:37 2012 +0100

    Mention parameters here. Oh, and bindings, and don't talk about permissions in such a funny way.

commit feaa1479b45ba03286a7e0c8d2c8b67269d4ede2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 17 12:16:05 2012 +0100

    at-least mode can imply that we need to start slaves in response to slaves dying elsewhere. So do that.

commit 7a47cd858fa15d3d665e0c078de9efc5941790b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 17 11:29:22 2012 +0100

    Gotta love those timeouts.

commit 64004f89fbd38bf44e90a2ce52d7ff2b0f5b8af4
Merge: b25dc0d4e 5810929ee
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Aug 17 06:12:26 2012 -0400

    merge bug25105 into default

commit 5810929eef0a4e398697c8cee2a592407969381d
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Aug 17 10:53:56 2012 +0100

    Disable parallel build (equivalent to supplying build.jobs=1 on the port command).

commit 1e85295d242217d44a9562472aae91ffd4172e77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 16 18:07:25 2012 +0100

    Fix detection of mirror removal at clean shutdown

commit c7c2fefe1574878afa951cc76376f47e70609fc0
Merge: b25dc0d4e 8531e156c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 15 17:46:34 2012 +0100

    Merge default

commit b25dc0d4e6b8785c7b49ba96b6c2036b1ea76912
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 15 17:46:04 2012 +0100

    Oops, this got missed in bug 25048 - slave_pids is no longer in both lists so there's no need to remove it.

commit 4f62355431cf5fa0a709733d7b894e8e7e48173f
Merge: 58c2fd25b 7d70c08ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 13 16:48:11 2012 +0100

    Merged bug25097 into default

commit 269dfdf533fa05f463566e865375e8f756b01dc3
Merge: 7d70c08ae d39b2bb89
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Aug 13 15:22:19 2012 +0100

    merge default

commit 58c2fd25b3b65f88410fb6e7d866953b8a8e02a8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 13 15:13:48 2012 +0100

    don't re-schedule timer when the new timer would go off <1ms sooner
    ...since timer granularity is 1ms

commit 7d70c08ae98ee9db54df7c9cc24da77124ae0109
Merge: b3385970d a142b009b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 13 12:10:42 2012 +0100

    Merged bug25094 into default

commit d1200a6f962bae90fe437e6e3624559f86d96dc2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 13 11:46:27 2012 +0100

    prompt expiry of requeued messages
    which may require moving the timer expiry forward

commit b3385970dd766f67768ccdada3fadb8bb8279fee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 15:28:48 2012 +0100

    fix a long-outstanding unresolved type reference
    this was actually completely wrong; the return value is that of
    *gen_server2*:start_link

commit 86bb4c83c1a868023cec79d13185b6fd8ad1f8b3
Merge: b54486ddd efdca8d1c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 13:39:29 2012 +0100

    merge default into bug 25097

commit efdca8d1c4c8502a2c68cf640c26a16bb0af67f9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 13:38:59 2012 +0100

    propagate API change

commit b54486dddcdecc1c1aa65ea711c0b08d176ccd10
Merge: 80a3ee054 f437e3988
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 13:38:05 2012 +0100

    merge bug25096 into default

commit 80a3ee054d5d41e5fd89627ab158b35915d65303
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 13:37:47 2012 +0100

    oops

commit 86b6fe74ff16aa513c9d26a4d80a75e2c09d60b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 13:23:23 2012 +0100

    more correctness

commit ce116151867e52927937f9f0dcf5f07885e22b9e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 12:34:09 2012 +0100

    oops; caught out by daft Erlang scoping again

commit 9af6bffd7d747759f593ad849fab63214f0cf6d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 12:13:52 2012 +0100

    schedule message expiry timer based on expiry time of queue head

commit f437e3988da6ab6da476e683506c64212d434153
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 12 11:30:33 2012 +0100

    don't rely on evil erlang scoping

commit ce1bea188400b7729c89f57dc8093bacf722ee60
Merge: 4d5deab1d 06d8ae22d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 11 17:50:46 2012 +0100

    merge bug25096 into default

commit 06d8ae22df830cb835a683d1b62ebc4041fd9d42
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 11 17:50:20 2012 +0100

    test 'rabbitmqctl eval'
    and refactor the error handling for it

commit 4d5deab1d5cb6b9cc810d5e28d60eacae3df8628
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 11 17:39:24 2012 +0100

    test more branches of 'rabbitmqctl set_vm_memory_high_watermark'
    and leave the HWM unchanged!

commit a142b009b1f6c58fa4e84dfc61a0010d30ea3c9b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 11 09:58:09 2012 +0100

    re-assess coverage suspension in tests
    I took out all the coverage suspensions and then gradually added them
    back in until the tests passed. The end result is
    - reduced scope of coverage suspension in some cases
    - new instances of coverage suspension due to the changes in this bug
    - some useful helper functions for coverage suspension

commit 50de7731bd4f346c91b00dc52e533dd2f20330ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 11 07:41:00 2012 +0100

    be a bit more selective about which nodes we disconnect from
    ...in case we one day relax the restriction that all erlang
    distribution nodes must be part of the same cluster.
    - force=false -> all nodes we are clustered with
    - force=true  -> all nodes we are connected to
    Forceful resets are employed to cope with various conditions in which
    the cluster has gotten into a bad state, so its best not to rely on
    mnesia's knowledge of the cluster state.
    
    Also:
    - some drive-by refactoring
    - nodes() never includes node(), so no need to filter the former

commit 6d1e9ac22c939237e0d81077761f8bfdb6e85103
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 10 17:17:34 2012 +0100

    Prevent possible deadlock when obtaining multiple filehandles

commit 32e5d26c53343fdff2376d557e533d3352f1d839
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 10 13:26:37 2012 +0100

    just connect from all (visible) nodes instead
    That way we don't rely on our current (possibly imperfect) knowledge
    of what the node was clustered with in mnesia.
    This is safe because, as per the comment, only mnesia cluster nodes
    should be part of the erlang distributed system. Note that rabbitmqctl
    et al run as *hidden* nodes.

commit 294c43ee761a13e5087d9a3fe813fe73e8062f14
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 10 13:13:15 2012 +0100

    make unclustering work for ram nodes
    - leave the cluster properly when force=false
    - disconnect from nodes we know about when force=true

commit 1eb981ce52802be45f21cc4471995e92d4b83b1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 10 12:37:13 2012 +0100

    cosmetic

commit 2c78b05f22874da6dc0ae69005862a643b133914
Merge: 76f411409 cd0fb668c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 16:45:24 2012 +0100

    merge heads

commit 76f41140919111631935508eb18cc16db3cb5c48
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 16:44:22 2012 +0100

    refactor: make better use of filename module

commit cd0fb668c5579b7232dbaca0d0f2200dd0d56777
Merge: fdeb9ce34 21bcf2bbd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 8 15:49:08 2012 +0100

    Merge bug25087

commit acc9993d9b91097cbf716b2a51f8870f7f296dc7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 15:35:01 2012 +0100

    cosmetic refactor
    - more informative type signatures
    - move the final phase of setup() into prepare_plugins
    - ditch the non-erlangesc get_ prefix of get_plugin_info
    - vertical alignment
    - get rid of some intermediate vars

commit 078172056e28b19bb367139e760091294a2987a1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 15:21:22 2012 +0100

    cosmetic

commit 563b9eb6a08222dcd8aeef5add89d0c426c8eeda
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 15:21:08 2012 +0100

    fix dialyzer complaint

commit d555baf8b1ac897d41714f2777b43bc4880a1963
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 15:17:07 2012 +0100

    the second half of removing rabbit_misc:quit/2
    oops

commit 21bcf2bbd44573a0326b7b0141aa6cdd5e2eae89
Merge: 348e3a4a0 b28895929
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 13:35:45 2012 +0100

    merge heads

commit b288959293063a16a249bfa3b39b2ad32bb8452a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 12:15:13 2012 +0100

    refactor: less confusing variable names

commit fdeb9ce349f81cf8fcdc1bd9ca8e6e2f3f0b987b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 8 11:35:25 2012 +0100

    More randomness for temporary node names on windows

commit 271e8667a70f68b49b9218290d0b8c665937f134
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 8 11:14:22 2012 +0100

    Revert the part of 942d5ea3c608 which broke all plugins

commit 1ab11acdfcc97577e9fae19f021b81a1a37f148b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 8 10:54:58 2012 +0100

    Update docs

commit 348e3a4a099c4d415e18946cd181f225af2fd98b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 10:29:50 2012 +0100

    refactor: get rid of rabbit_misc:quit/2

commit 0d690137d08af19d9e9f9f42b3a261c2440633a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 8 10:12:22 2012 +0100

    Remove vhost parameters when removing vhost. And a tiny driveby refactor.

commit 094da81a5bc1b6e9e3eb3aa3f62794c30279f1e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 8 09:53:59 2012 +0100

    Stop the clocks! Five and a half years into the RabbitMQ project, and Matthias committed something that broke the build.
    
    (Fixed.)

commit efefd7fe3649776f1a52f95254a0d1756dfd72cc
Merge: babbce724 03b3b2e2f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:50:20 2012 +0100

    merge default into bug24719

commit 03b3b2e2f53031080537577fed4fdc61e9d811af
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:42:28 2012 +0100

    cosmetic

commit bd6524fad6903b93b792a61c38c33e62b1f6fb83
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:41:20 2012 +0100

    cosmetic

commit b9e23db24068075d26f536e3a1b286b8a4edcc57
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:35:00 2012 +0100

    restore docs (but reformatted)

commit 41458dc3f488c441dd2dab32cb465edf2f2e277f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:32:35 2012 +0100

    remove cruft

commit ab21f540889562a436dfc8d2d381965a3c22c854
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:25:40 2012 +0100

    exiting the VM from deep inside a function is uncool

commit a9e9cfdf6cadfe4b8e996bb4db5a919c91f0b1ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:12:35 2012 +0100

    cosmetic

commit 62dcf279ab6c4d2453d4bf0e9afec6e787025180
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 8 05:08:32 2012 +0100

    cosmetic

commit babbce72428af9bccc1394f847c8acdf13839ff4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 7 20:05:27 2012 +0100

    Eric's patches

commit 1d93d5753d441709b7dc214ccc01db3f87651d31
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 7 19:47:21 2012 +0100

    remove more cruft

commit 071e2817abfb5267664a81181d53e69a5d4633bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 7 19:42:50 2012 +0100

    remove cruft

commit 035765465d459615b85ffe7a3aaf5c7e5009f463
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 7 17:36:59 2012 +0100

    Make parameters vhost-specific.

commit 5669123b75c11b743d989ddbfb034952d5fd1364
Merge: d7ffbf0ca ea99d537d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 7 15:28:43 2012 +0100

    Merged bug25083 into default

commit 8531e156c9fea2b2720ce77d29e63f622d55fe39
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 7 13:40:10 2012 +0100

    Reify something that was previously a little bit magic.

commit 18af4808ff28cd7ae7fde42ec355858905482a23
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 7 13:30:10 2012 +0100

    Support changing master (umm, which actually turned out to be a lot easier than expected, thanks Matthew).

commit 4a2f85a6506260cff20a6dd4e747b93a1641823a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 7 12:51:36 2012 +0100

    Take account of the current nodes when selecting new nodes, and some unit tests for the node selection logic.

commit 70a541c7d909f11ce36e357ad567f8e2e1412c03
Merge: d7ffbf0ca 33bc43685
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 7 11:21:51 2012 +0100

    Merge in default

commit ea99d537df561564e163f9b807f77d93dd84310c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 6 12:12:09 2012 +0100

    track vm_memory_high_watermark explicitly
    so we can report it back accurately.

commit d7ffbf0ca698109d61acccb1179ea2594839f62e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 6 11:56:43 2012 +0100

    warn on memory clipping

commit cd051af45b8e6c4058914b4d07b9cf84cbab5a01
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 3 00:09:29 2012 +0100

    tiny refactor

commit eedc6467b83deab47ab39759f67babc67b6df81b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 3 00:06:40 2012 +0100

    make the comment match the code

commit 10526e6519755321ae4c1c4e5c6e27dd30e744de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 3 00:06:00 2012 +0100

    cosmetic

commit a4f26608749ff63aeefa41424f112e76eec0c970
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 2 23:53:56 2012 +0100

    trim fat - don't log the setting of the memory hwm twice
    it already gets logged by set_mem_limits

commit 158e65dc44eaa6db422397f36caec2db18f03bd5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 2 23:36:53 2012 +0100

    inlining refactor

commit d39b2bb892ac9b4f92e27c9aa1ccb11276ec35fa
Merge: 03084f296 e62a381d5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Aug 1 15:59:47 2012 +0100

    merge default

commit e62a381d53e320cb4778cfac94be18f38fb51c8f
Merge: 130551edf 79335fefa
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 30 13:39:16 2012 +0100

    merge bug25048

commit 130551edf0fd2e48d1be01ad960075f0d96edf68
Merge: f106a5259 f45053429
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 30 13:34:19 2012 +0100

    merge default

commit 79335fefac7aec964cc2b313eb838ed47c126b40
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 30 11:14:15 2012 +0100

    cosmetic

commit f4505342994eb97c135bdc9cd43ba2ca12933dc9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 27 15:17:32 2012 +0100

    `store_updated_slaves/1' returns a queue, not `ok'

commit f13225109cb8c47918ba885ae269fa7df2607cf2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 27 13:10:11 2012 +0100

    remove unused variable

commit 03084f29639c7889b6c4d03c4290a9e66f81eb29
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 25 18:18:08 2012 +0100

    add a first draft for the rabbitmqctl documentation
    
    Also, accept disk as well as disc in `change_cluster_node_type'.

commit f106a5259614a47173ff53a844621afaaba1375c
Merge: c9aa1c0d1 b052f69c8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 25 13:50:00 2012 +0100

    Merged bug24971 into default

commit b052f69c8ba08e3b43350f4db519147e0fbb275f
Merge: a7e197c0e fb39be8e8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 25 13:09:18 2012 +0100

    Merged bug24942 into default

commit fb39be8e8150af8ef6ac230ec34af34cf523cdb4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 25 09:52:15 2012 +0100

    NB: is superfluous in comments

commit 1b914cfbed20d1927453a61ad473c78d9842cb5d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 25 09:50:48 2012 +0100

    simplify match on master pids

commit b6928395bb115ce8cc10378e31dce18d2fa3e5d3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 25 09:49:08 2012 +0100

    match on supervisor:start_child/2 return values properly

commit 3cca73829d015418366312979ac7b220e3925b74
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 16:26:52 2012 +0100

    attempt to handle races between remove_from_queue and rmq_slave:init/1

commit 960058bdfb9b507aa6e46b1531c2d2bfd0a1e548
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 23 16:09:22 2012 +0100

    cosmetics

commit adb0c63a30d1683e2481e983375f84deae69a8a1
Merge: a7e197c0e 23d66e500
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 23 15:55:48 2012 +0100

    merge default

commit af469b7691e42449a30b895ab114d72c35361e71
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 14:08:13 2012 +0100

    throw state invariants in the right place; cosmetic

commit acea4d939f3ec04376c11bccb246aa1f31795500
Merge: a7e197c0e 24db39ad1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 12:01:49 2012 +0100

    merge with default

commit a7e197c0e4f284497d1f2573a90b72b2e3e21a24
Merge: 1c9c4ba0e 8a56ebb93
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 11:46:58 2012 +0100

    merge bug25023

commit 8a56ebb9323cb9382b1e5d46febda15041aeb925
Merge: afbcc512c 1c9c4ba0e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 11:46:16 2012 +0100

    merge default into bug25023

commit 24db39ad1c99c2ba9ba5ff1415ca56b8baee41de
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 23 11:26:32 2012 +0100

    log stale master pids properly, remove duplicate stale pid handling from rmq_misc

commit 1c9c4ba0e6132c82a6dd9bc694f882a004454094
Merge: 22971720d 1ac7c6535
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 20 17:15:35 2012 +0100

    Merged bug25059 into default

commit 1ac7c653561ffa8b93bc97e0ede94a4085be3a98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 20 16:45:34 2012 +0100

    make 'rabbitmqctl report' respect '-q'
    sort of

commit ca654948abafc523917d4efecbb42a9b10805f0a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 20 16:45:15 2012 +0100

    remove evil

commit 22971720dd953799a9dfccdfb882b7d101859b94
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jul 20 00:48:00 2012 +0100

    use rabbit_misc:is_process_alive/1

commit afbcc512ca32b6c80fded00e4389f259d20a4a55
Merge: 9911cdf22 0546bc9a9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 19 16:42:10 2012 +0100

    merge default

commit c9aa1c0d163ad2e907c808e546225478e53e5efb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 19 16:14:09 2012 +0100

    enable heartbeats with a 10 minutes interval by default
    
    I tested with 20k connections and the CPU usage is reasonable on my
    machine.

commit 0546bc9a9c062ab244bebf3e0000720596e92ab5
Merge: 315e1b789 62711497f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jul 19 14:08:29 2012 +0100

    Merged bug25035 into default

commit 315e1b7894b319bafcec9730fe5b356b28f633bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 19 10:54:32 2012 +0100

    cosmetic

commit b9c4358dd46d35c20aebbf618596859ad5310f33
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 18 17:46:15 2012 +0100

    use new frame_error function

commit dbc24ef0f0d803077ded2be9c9016cfbf7c61992
Merge: d59d66f9f 6eb276a95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 18 17:43:51 2012 +0100

    merge default into bug24991

commit d59d66f9f158865ebaf08fc3e484b62f3d221fc0
Merge: d29558783 c6a44acb4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 15:24:16 2012 +0100

    Merge bug25056

commit 62711497f6a0ba58aed9f969d0a681bec3e31e4b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 18 15:04:10 2012 +0100

    use %HOMEDIR%%HOMEPATH% instead of $PROFILE

commit d29558783b0686053408968c1de3c53aeff4d057
Merge: 07eddd9ae 3fe9c2e35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 12:44:27 2012 +0100

    Merge bug24998

commit 07eddd9aec054faa53272a1811275b94435b8120
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 12:41:02 2012 +0100

    Minor simplification

commit 1a7c2afb5b7b33c79dda4667290e9cc9275d167b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 12:33:40 2012 +0100

    resource_limit alarms are always atoms, and we don't need quotes around them

commit 7d1ee7d832105f71e4da50cea362cce2896931f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 12:32:40 2012 +0100

    All our log invocations should end in ~n

commit 3fe9c2e35b9a4e7076f41b51f01aa8a3d9c057e3
Merge: f70300be1 d7d72c8b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 18 11:07:58 2012 +0100

    Merge bug24985

commit 9911cdf2208b94078599a5b7e9970cd50dfb4cec
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jul 17 15:06:58 2012 +0100

    change naming from "termination" to "exit". also add `IS_' prefix to macro

commit 6eb276a95c4d4ef370f22ce7b5ba62719a3bbba3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 17 11:26:03 2012 +0100

    allow clients to exceed frame size by a little bit

commit 0008e5f11fa2f3f7b9c36e89dea7a94f85aeef21
Merge: 41e009229 a8aa180d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 17 10:52:22 2012 +0100

    merge default into bug24991

commit c6a44acb4a98863d904b247d91d9bedd831b23fb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 16 14:11:35 2012 +0100

    simplifying refactor

commit f70300be10c1e4f4aa1ec4848585cfad7575e2c0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 16 13:11:18 2012 +0100

    handle shutdown and file system cleanup gracefully

commit 725f4f59b9fc7b06d69ea5c5455fca7c9c62ce26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 16 12:00:33 2012 +0100

    make channel/soft errors easier to distinguish from hard errors

commit 70e39ca6ccf50ae8b2ff10afaff885c2d98edb31
Merge: 6ba236af1 a8aa180d3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 16 11:15:15 2012 +0100

    merge default

commit d7d72c8b93c1d257f923471b51efa414a3daef2f
Merge: 067776e41 a8aa180d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 16 11:01:51 2012 +0100

    Merge bug24956 (again).

commit 4766cd843f7e2e2c6192d738734c8750c34c4456
Merge: 577eab208 a8aa180d3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 16 10:52:50 2012 +0100

    merge default

commit 067776e41e6442f6ab5ef82653f53ce113003b1b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon Jul 16 10:38:31 2012 +0100

    oops - handle heartbeat timeouts properly in closed state

commit a8aa180d3ee05f2bbf2c75aed3b86fad7d070950
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 16 08:28:52 2012 +0100

    refactor: remove gratuitous helper function

commit 1db89582e86ed9aa0ccab6e9559f04ac30828d38
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 17:41:49 2012 +0100

    better epmd error descriptions in rabbitmqctl

commit 36da88eee431c6fe7ab6b9038d23c58d50ce602e
Merge: 75e90b0da ef3a16eb9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 17:13:14 2012 +0100

    merge default into bug25056

commit 75e90b0dae3ae326f76aaafb655463e4545776b0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:58:43 2012 +0100

    refactor: move things around in the reader
    ...for better grouping of functions

commit ef3a16eb98f230e8a575e723a741a20145e5c362
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:46:23 2012 +0100

    more consistent error handling in reader

commit 0cca4ec86a18b562bdf709e410379a5531c44722
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:20:34 2012 +0100

    call the correct function
    oops

commit ba1f5823f8c3b5879b2d25d5c0286e29d8c4b298
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:17:21 2012 +0100

    refactor: precondition_failed helper function

commit 00567102269859a9f6e29e1c21f7c88b9c24a0b9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:15:03 2012 +0100

    oops - 'hg record' diff boundary fail

commit 7542fdefe7a4fe64e1bc2ed0166a3f407563b808
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 15 16:02:19 2012 +0100

    renaming
    ... for consistency with reader, and to better describe what the fun
    does

commit a7463a90fb0229f1a288d0dbbb203f731a53a813
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jul 14 19:27:44 2012 +0100

    cosmetic

commit 1697ec5409d9fe66ec3c8a2c1785b96aba178c5c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 18:13:22 2012 +0100

    do not blowup on unrecognised alarms

commit 4a6891569352f25737bf5063f6c11886d5e7e5ce
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 17:41:54 2012 +0100

    aligning things, part two

commit b7b6e019d7fb092adc09048a8d710b28ec0a773c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 17:27:41 2012 +0100

    because we all love aligned arrows (especially Matthias)

commit 4058fa989eb8e505863e9af1bc90beb28ab4d40e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 17:25:08 2012 +0100

    cosmetics

commit 155a516574aed5f67e9052b5a3f01e1378c90dbb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 17:02:46 2012 +0100

    add a `get_alarms/0' to `rabbit_alarm', equivalent to `alarm_handler:get_alarms/0'

commit 07ea1d8f2b9e88f965a41b94f8cee2ead78162c0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 13 16:36:23 2012 +0100

    `rabbit_alarm' on its own again, added callbacks to fhc and `vm_memory_monitor'

commit 41e009229feab6f1b89a1e0867ace49d051968e8
Merge: 5dc7135c1 f59c70a30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 13 15:07:42 2012 +0100

    merge default into bug24991

commit 5dc7135c1c4d28bff3cc7550b6bb5029adcba38c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 13 15:01:16 2012 +0100

    tiny simplifying refactor

commit f59c70a301e179ce855f408e765c11cc7f50bd6a
Merge: 582ab9e90 1bfe0d753
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 13 14:53:03 2012 +0100

    merge default into bug24991

commit 582ab9e9099373aa2b18fd5d3ad9ab122eca5be3
Merge: 470e83c87 9da492640
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 13 14:14:53 2012 +0100

    Merged bug25052 into default

commit 470e83c87068326c1b6a4965b575deb15598977b
Merge: 35467ac38 63477af92
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 13 13:05:36 2012 +0100

    Merge bug24720

commit 35467ac38fbf9be2084b03967f6ca9151c0b609d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 13 11:55:24 2012 +0100

    I am more dubious about this one. But not enough to take it out.

commit 8ef211effafbfbfdb047fbfeebf36481d186d8fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 13 11:06:05 2012 +0100

    Explain this message.

commit 9da492640eb74ab9fc47ceb457c4f307306af28a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 12 16:56:15 2012 +0100

    blow up if Ref is unknown
    just like the old version did

commit 71044851c7fc988a8cb560fee98f523739705873
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 12 16:55:52 2012 +0100

    When handling emit_stats we should do nearly everything we normally do in noreply/1, just not create another stats timer.

commit 7eae592338a762fde0feef79c97bf80af3a16119
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 12 16:55:38 2012 +0100

    grammar

commit f96d09d436d712cb7481e9940dd6fb09507f6912
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 12 15:39:55 2012 +0100

    Duh, cosmetic

commit a9e03d18a47123231271b9eb909ddabdd853ffe2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 12 15:35:03 2012 +0100

    macro instead of duplicating the guards

commit f2b022b15ac47ccddf0f4f17152f79d19b74f5c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 12 15:31:00 2012 +0100

    Don't reopen file handles in fhc:needs_sync/1, avoid infinite loop.

commit d8b79de606a90dc020d15d41fd6c6abb36ce0677
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 12 15:14:31 2012 +0100

    merge `is_abnormal_termination' and `is_benign_exit'

commit 6f2fbcbb753c045bf7bb0320d187dd087c25e4de
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 12 12:44:31 2012 +0100

    add comment clarifying the need to pattern match in `with_exit_handler/2'

commit d127747f95dd39cf3f5bdd499524f5e11a2b272e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 12 12:31:33 2012 +0100

    do not take place of `alarm_handler', just pretty print what we're interested in

commit f9f1e48cdd5398737f5b6d5d21fdb5baebb89a98
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 11 15:28:25 2012 +0100

    filter benign messages in `rabbit_amqqueue:safe_delegate_call_ok/2'
    
    Sadly I can't use `rabbit_misc:is_benign_exit/1' in the guards in
    `with_exit_handler/2'.

commit e5ad74e22a52bb57cdae07eaecb6c07ed26b0dd4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 11 13:32:28 2012 +0100

    log the resource limit alarms

commit b740677bf32ed4bb92d0373297723ec82cc24afd
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 11 13:16:22 2012 +0100

    let `rabbit_alarm' handle everything in place of `alarm_handler'
    
    No logging on set/clear alarm yet, me and Simon agree that we should do
    logging only on the events that rabbit knows it should be receiving
    (right now the resource limits ones)

commit 95092ed26876699c42118d37fda5222fff137257
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 11 11:29:01 2012 +0100

    we don't need a dedicated handler, rabbit_alarm will do

commit 46f09d33920b620e4c22e8a107d61c7a0c555388
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 11 11:11:26 2012 +0100

    Rename HA heartbeat when master changes

commit 68a0e6655b383a89caa819a91257cdc18112b693
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jul 10 18:04:24 2012 +0100

    add replacement for the stock alarm_handler - not doing anything yet

commit 6353c33a735c699a3f0a48a02e150d96aeede93e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 10 11:49:55 2012 +0100

    Remove unnecessary HA heartbeats

commit 577eab2087dc12d55ff090452730989180573c02
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 20:28:43 2012 +0100

    clearer `rabbit_mnesia:discover_cluster/1'

commit 06608e3aa0c98732a9404ccd3eed542b02401cff
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 20:11:44 2012 +0100

    `cluster_status/{0,1}' now returns the status directly, fails on error

commit 4a6c12e9e9edef71f6fd330fc8e8412818978433
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 19:59:36 2012 +0100

    cosmetic

commit d5d5d6231ce2497195a9374ee09aa044acf650f7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 19:50:35 2012 +0100

    do not update the cluster status file by getting the mnesia status
    
    Instead, just update the existing cluster status file. This is because the
    mnesia propagation time can be slower than the other messages (see other
    comments in the bug)

commit 39d6801677076389f6178558a0e6c068f97d7caf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 19:39:08 2012 +0100

    add the magic `cluster' word to `remove_node' and `change_node_type'

commit 33bc43685c1959040f4ff0851516b590084bd346
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 18:30:52 2012 +0100

    Various fixes.

commit d01e05ef21c97d09e6395d12db214eda4ae75e15
Merge: 23d66e500 b7fdcbec2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 18:01:42 2012 +0100

    Merge bug25048

commit 23d66e5005d2d7a3c80abe34f94e7b0afb040af1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 18:00:08 2012 +0100

    Fix upgrade function.

commit b7fdcbec2b234b57ff297c818f3871cbc957a3fc
Merge: 70b559fde b170895ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 17:57:50 2012 +0100

    Merge bug25048

commit 8a1ea448db2d2696bc3732a6ec72030eec11f416
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 13:16:44 2012 +0100

    `rabbit_misc:rabbit_version/0' => `rabbit_misc:version/0'

commit 70b559fdeb55ec4efa3be26b5a3019f4cd475056
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 12:01:16 2012 +0100

    Be more consistent about always cleaning sync_slave_pids whenever slave_pids is updated, abstract a bit, introduce an async wake_up message.

commit ec880c2e39fbd647b933e2d52f71b42debdbf937
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 12:00:03 2012 +0100

    get rid of `is_disc_node'

commit 7b0a2ad30b2ac08d8edf678fde40493250300796
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:52:21 2012 +0100

    remove useless `all_clustered_nodes/0' in `reset/1'

commit cb330bfe47b9c93db91d04ed96da77c92dba25db
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:51:13 2012 +0100

    split the offline case of `rabbit_mnesia/2' in a separate function

commit ae6c64a8b6204dd6ce28d9c11a96452b0a5afeab
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:43:14 2012 +0100

    `change_extra_db_nodes/2' throws instead of returning error

commit 94c9c29007ec9e3127657d33630a8e60cd93aaf7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:33:14 2012 +0100

    remove unnecessary `ensure_mnesia_not_running/0'

commit 6125a504b545b805b04c3bdb4da98e71b1347697
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:32:37 2012 +0100

    ?SERVER instead of explicit name

commit 6b3d25e4261e09677612a65e2e0be0bd7acacfa9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 9 11:21:57 2012 +0100

    It did work, but we needed to do that in another place too...

commit 53bb3788b8777f0a8c7c706ad3b228512099cae7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Jul 9 11:04:25 2012 +0100

    check that the node selected for removal is in the cluster

commit 0acd0fd882f7a47d3a57897dffafa3152e4394e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 6 18:21:28 2012 +0100

    Store sync'ed slaves in Mnesia. This is not quite right yet.

commit b170895eaf2ec0142f2528a97c7846563aaff219
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 6 16:55:54 2012 +0100

    Dynamic change of HA policy. Promotion from non-HA to master, and demotion from master to non-HA as appropriate. There will still be problems if the policy changes such that the master needs to change - I'm not sure we should even allow this.

commit 7f3944e402602123e7c388a8cac25237274376fa
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 6 15:44:18 2012 +0100

    fix the flags declaration in `rabbit_control_main'

commit bb87a6994495d03fa192260733de9db40d62857e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jul 6 15:01:40 2012 +0100

    correct invocations of `on_node_{up,down}' in `rabbit_node_monitor'.

commit 729d7f6cae44de2627a86575bf82d705bf2bc267
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 6 13:27:50 2012 +0100

    Rename function, remove utter rubbish.

commit 82d7c1aeb5210c85c624f44d1b616a54930faac3
Merge: 54b0b4bc2 14b595b87
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 6 11:19:46 2012 +0100

    Merge heads

commit 14b595b877d0ba721488c8aca164593b321ef514
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 6 11:16:37 2012 +0100

    While this didn't actually crash the VM for me, we generally want to HiPE as early as we possibly can.

commit 54b0b4bc26cb63e8b6d90eb3ce9f1b41180dff9b
Merge: 48c7fa88e 63477af92
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 5 18:28:00 2012 +0100

    merge default

commit 48c7fa88e07b145464c69105242a2d03b94be788
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 5 18:02:00 2012 +0100

    fix `remove_node/1' - do not remove nodes from offline nodes, unless we're "safe"
    
    We wan to remove nodes from offline nodes only when all the cluster nodes
    are offline, and when the node we are removing from was either the last
    to go down or the second after the node we are removing. However we cannot
    know that for sure. For this reason rabbit will refuse to remove from offline
    nodes unless the flag `--offline' is passed.
    
    There is more information in comments around `rabbit_mnesia:remove_node/2.

commit 72cdb42bb7059164c974180ab3633bce8b4d194c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 5 16:00:28 2012 +0100

    Rough sketch of dynamic queue HA-ness:
    
    * Remove #amqqueue.mirror_nodes, we will always derive this from policy
    * Remove everything to do with x-ha-* arguments
    * Abstract a bit more stuff into rabbit_mirror_queue_misc
    * Add a new "at-least" mode
    
    This works! Sort of. Changing policies on the fly, changing HAness altogether, having "at-least" set up a new mirror when one disappears, and probably some other things do not work.

commit 991d7e74919b7c4656e35d967f11953e3035b588
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jul 5 12:31:48 2012 +0100

    fix `recluster/1' - delete the schema and write status before `init_db'

commit d3a0f554826fac699b40af924b4dd3ce2c2cc9c8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 19:01:10 2012 +0100

    don't show the running nodes when down

commit 86a0d47e60de626a01212e259c811d1a97832307
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 18:18:55 2012 +0100

    check if the node is the only disc one in `change_node_type/1'

commit 6ba236af1a5bc4e6c74c932c314d8d73706d4f28
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 4 17:41:16 2012 +0100

    Cosmetic: starting a line with "_ =" is meaningless.

commit 19f554ed69bf144b6d83d86a3ea6cc4eeac41448
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 4 17:39:57 2012 +0100

    Cosmetic: indulge bias against if statements.

commit f060804469e9335ccb67f80ae5132a33d96747a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 4 17:38:13 2012 +0100

    Cosmetic: whitespace.

commit 2e6104bc8a9917c1607c62e42b3d94b3f4ea348a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 4 17:35:17 2012 +0100

    Cosmetic: reduce verbosity.

commit 10a91e93d2733347251c5b3bf6968696f305bd6d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 16:33:22 2012 +0100

    check if only disc node after `init_db' in `reset/1'

commit b426c28811de4813dc9d3b34bda046dd794d485d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 15:57:46 2012 +0100

    do not check for consistency when reseting

commit 63477af925d226c937aee6984c6380699ede0a11
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Jul 4 14:40:20 2012 +0100

    Make make-port-diff.sh work correctly on MacOs and Linuces

commit 006d5eac31c20f1a6ed4876a2cae2af2319d73f4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 13:43:28 2012 +0100

    reworked functions that get cluster nodes to get only what they need
    
    This is mainly do avoid a deadlock caused by running `rabbit:stop/1',
    which indirectly calls `applications:which_applications/1', from inside
    `application:stop'.

commit 33cfd55ff604c5fd54a0f348c9c83aa65b410b03
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jul 4 12:21:44 2012 +0100

    all_clustered_ram_nodes() => clustered_ram_nodes()

commit 62a377a75c47ccfd31a12c275d1618b78b9a057d
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 4 12:12:25 2012 +0100

    cosmetic

commit dbdca3fc6b3fc939f7c1303ae5ed18aca7de437c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jul 4 11:52:14 2012 +0100

    ensure the temp directories are deleted before proceeding

commit 3938ef4501bff3db21d5841d8699e41682de4055
Merge: 675240e3b eeca9492c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 3 16:26:48 2012 +0100

    Merge bug24512

commit 659dd59d9eede0cd8aedb46f452a002910b5f7e8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jul 3 16:23:28 2012 +0100

    wipe the mnesia data before starting if the cluster nodes are inconsistent

commit 4071897cad67b90bf1efc18d1b37eb95c633e1f9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jul 3 15:10:54 2012 +0100

    better `rabbit_mnesia:check_cluster_consistency/0'

commit 675240e3b455511824b2d369726b429c2da2013e
Merge: f42837f18 eeca9492c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jul 3 13:32:02 2012 +0100

    merge bug24512

commit f42837f18df172a41b87cb1431c64128537079a4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jul 3 13:24:54 2012 +0100

    use nohup instead of setsid

commit dbb24b9824d487ae31481a28225d6f29e9b30691
Merge: 030a937e8 eeca9492c
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jul 3 12:45:28 2012 +0100

    merge default

commit eeca9492c3cb7b69d7906922c1a89ef364f4e46a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 2 11:43:58 2012 +0100

    clarify what 'timeout' stands for

commit aac1fb7c53b0fb0dc48dc6c097a264c0a335e16e
Merge: 47927e209 a9dc9a1de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 1 23:50:58 2012 +0100

    merge bug24884 into default (no-op)

commit a9dc9a1de77dbed1fa79fa4a36c8878239f17ac1
Merge: 563ba9852 a54198f5a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 29 13:51:09 2012 +0100

    Merged bug24826 into default

commit 8b43cf3ff563d8c59ea4109c0b79cc748d015bc7
Merge: f125bce39 648efa8eb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 28 15:09:18 2012 +0100

    merge default

commit f125bce3926f2ae57e4a7bc4351e10104459de31
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 28 15:07:33 2012 +0100

    `cluster_status_from_mnesia/0' fails if tables are not present

commit f4c857dd43b91a88ff9685369e4c7b06a73190cf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 28 14:51:50 2012 +0100

    don't use `system_info(running_db_nodes)', check for running rabbits instead

commit 65148f62365b6fcd0f0b7049387686fa6eb27414
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 28 14:06:31 2012 +0100

    instead of manually removing the current node, filter it in `cluster_status'

commit 6cacd4b0696e5eb6341babcefad6c31800d3e396
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 27 17:07:21 2012 +0100

    moved the status file handling to `rabbit_node_monitor', status from mnesia when online
    
    I'm much happier with this configuration, with the exception of one
    problem: `rabbit_mnesia:cluster_status' will happily return the data from
    mnesia whenever mnesia is online, but that gives wrong results when the
    node is a RAM node and it just got online. I have some ideas to improve this.

commit a54198f5a64dd49f5906a784f2c768ddc8110966
Merge: 0d288858e 5b6f240a0
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 27 12:28:04 2012 +0100

    merge bug24912

commit 5b6f240a0fd0e38365bf1986b0d2db7565ac14e0
Merge: d7ff6ea65 0d288858e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 27 12:25:25 2012 +0100

    merge default

commit 22d0abdbcf0d5e5813d68f0094bef47d00413349
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 27 12:21:19 2012 +0100

    change semantics of the cluster status operations
    
    Now they use the file only when offline. Also I change the naming, from
    a `cluster_nodes_status' suffix to `cluster_status_file'.

commit 0d288858e3f4ca5e3111c53ebe44ea1e682d608f
Merge: ba884ed4c 648efa8eb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 27 12:09:19 2012 +0100

    Merged bug24988

commit 25372b6ff24fd32a9f66b8a1f91e114049628e6c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 27 11:55:46 2012 +0100

    change `rabbit_mnesia:cluster_status_if_running' slightly

commit a77becc83e0f9265b1f2d8ef2d3eb04dfc93c879
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 27 11:49:06 2012 +0100

    check if only running disc node only in the required places

commit 563ba9852974db391a35d26b420dd79a89d6489a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 26 16:57:53 2012 +0100

    More spec correctness.

commit ba884ed4cf98519b7a930bc8cee070be4d3a40d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 26 16:41:24 2012 +0100

    It probably makes slightly more sense to monitor before we broadcast.

commit 3ef67c915ebf0f516826f42ff758bc57fea9bcca
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jun 26 16:40:46 2012 +0100

    check that the node is in the cluster in `rabbit_mnesia:remove_node/1'

commit 5a099275fbb2be44752480403f9a944f0281972b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jun 26 16:01:15 2012 +0100

    remove the node from the running node when needed

commit 8343de948157b5888197c0233436c41f73213da2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jun 26 14:22:21 2012 +0100

    notify cluster of new nodes as soon as they join, and not when they start

commit 8f03eeac35af88777f102e9a07e02077a747ec15
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 26 11:40:49 2012 +0100

    Maybe better name?

commit 8b5585b1bdda0e07afe8bc2029d14a23cccfb19c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 18:05:51 2012 +0100

    Explain this a bit.

commit 78dea9b92973e60b72317902be40659f647af5ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 17:19:05 2012 +0100

    OK, we do actually need a special way to determine the difference between:
    
    leave the group    -> normal
    node shutting down -> shutdown
    queue deletion     -> {shutdown, do_not_heal}

commit 8ce0730455dbbda058fb8a2026bdb67612436a74
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 16:28:24 2012 +0100

    Get rid of this with_exit_handler use.

commit 455bb262f1200c4164caef3894dfa967ec9dfd8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 16:03:30 2012 +0100

    normal   -> leaving the ring, change topology
    shutdown -> ring shutting down, do not change topology
    
    gm_tests now pass again.

commit 72cf467993ffa1960a2a46cc532d79821436c89e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 15:52:47 2012 +0100

    And finally, have the master wait for all the slaves on deletion.

commit 03f7405e12b2a1d286114055a23fd6fc6ddb8dd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 15:52:19 2012 +0100

    The spec for gm:group_members/1 says it returns a list of pids - let's do that.

commit c652c08dc32b963d8ea1a24aaa92db7f14d989b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 15:45:41 2012 +0100

    Ignore normal exits; do not try to change the ring topology as it shuts down.

commit bab700b30c7780e328762fce77da82dc0529117c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 25 15:43:27 2012 +0100

    Close down the slave's GM the same way the master's GM does.

commit 648efa8eb736011c9324f024bd9981ba04348114
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 23 08:48:54 2012 +0100

    consistency: leave the 'ok' matching to the caller
    ...like we do everywhere else in this API

commit 750ff0aa801484724bbd8c8742421483ba402107
Merge: d458ae08c c45ddeb63
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 22 18:16:10 2012 +0100

    Merge heads

commit c45ddeb63d1c0255c581d5715cc4d3edf515c2dd
Merge: a6bd7bfbe 2c16b3351
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 22 18:15:36 2012 +0100

    Merge bug25005 again

commit a6bd7bfbe00bedd25e144a9af1d128dad4fe173d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 22 18:14:30 2012 +0100

    Scream

commit e719c4793dd765a0d2b688beb9b69d3635d7f103
Merge: 44343424a a286d0743
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jun 22 18:05:17 2012 +0200

    merge default

commit d458ae08cab606f12beebc553b9e8d833638673b
Merge: 2c16b3351 3b78387ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 22 16:51:20 2012 +0100

    Merged bug25021 into default

commit 2c16b335187f117ba454b2ea70adfad64b5b0b77
Merge: 76a48b956 44343424a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 22 16:46:33 2012 +0100

    Merge bug25005

commit 3b78387ae18fc083856534919aee61becbbcbc2e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 22 16:20:04 2012 +0100

    Revert the wrapper around the copy in append_file/2

commit 76a48b9568f8ab36b0c5630c87d341b0dba06682
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 22 12:57:51 2012 +0100

    Remove whitespace

commit 030a937e8c29b76444d56b8d4bb37832a98971b5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 21 11:05:19 2012 +0100

    Oops - implement the default filter properly

commit 8d490ed2226235ebaa4d7132c19dc204b326ac2f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu Jun 21 10:45:34 2012 +0100

    Run additional xref checks in the broker when plugins-src is available.
    Output full paths and line numbers for analysis. Differentiate between
    warnings and error where appropriate.

commit 44343424af454fcd9995aca011fc958a96259aa7
Merge: f56bcf6af a9cc8c53e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 20 15:54:30 2012 +0100

    Merge bug24956

commit a286d0743d69c0eacc7571ad1e1d1f5c6e913d8f
Merge: e6f8c8cad a9cc8c53e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 20 14:37:27 2012 +0200

    merge default

commit a9cc8c53ed14d83c56bc4a48be58bea287b534a8
Merge: dd3b40804 024f4e573
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 19 16:47:27 2012 +0100

    Merged bug24992 into default

commit 024f4e5735276cb139010f8589cb278c161bebdc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 19 14:35:37 2012 +0100

    Default to 1GB limit, check every 10s.

commit dd3b408045304969b0cbce6ccdc27284c6de2ca1
Merge: 1e4ad9572 ae303c32f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 19 12:25:32 2012 +0100

    Merge bug24994

commit f56bcf6afbb8363e5b3f8709e852c663804b77b0
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon Jun 18 12:21:22 2012 +0100

    revert the log level for error for heartbeat timeouts

commit 1e4ad9572eadbe644913f34ebc57f5dedcde3fb4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 18 12:12:40 2012 +0100

    Cosmetic

commit c2c6b5f5eae8cdcaad7d0e9d2a40d6b27607a26c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 18 11:15:42 2012 +0100

    Only one version of append_file is required

commit f912360897f1abfc76b17f6dcf52dfb7fca2beba
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon Jun 18 10:25:10 2012 +0100

    make the error/reason for amqp heartbeat timeouts clearer in the logs

commit e6f8c8cadabb9ee7487d73974c33c38c4060449a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 18:07:01 2012 +0100

    add a "leave cluster" hook in `rabbit_node_monitor', handle cluster nodes joins/departures better

commit ae303c32ffe9980460fa4b1838475e077e79aead
Merge: 8e5f134a0 e1a34d285
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 17:57:37 2012 +0100

    Merge bug24939

commit a3eca7f28fff2cc11fc678862cd49818e8b57c22
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 17:33:26 2012 +0100

    Actually, it seems slightly cleaner to do this.

commit 8e5f134a0f9ec865b0df97114681307efca3f5f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 16:45:24 2012 +0100

    Strip this out again, we can't make it idempotent and it might just remove the listener records just after we've readded them.

commit 0c10e5b525a1cbd49f6710d7441feb53ba549401
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 16:43:44 2012 +0100

    Ensure we only clear out records of queues that are actually dead.

commit 4ada2c814d82d3eebe7dc78528e9b1e902d5c52e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 14 16:28:10 2012 +0100

    Rotate logs differently
    
    because type file:mode() is not exported

commit e1a34d28526d0d69d58957735820bca2b9a5f9d5
Merge: 737898d65 307afb490
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 15:41:16 2012 +0100

    merge bug24930

commit 307afb49073bd94f2bf749acd8bec53b935c00f7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 15:40:15 2012 +0100

    revert dummy commit

commit 60ece5d3d7e702ed8a9c574c885418d2ce2a34bf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 15:39:43 2012 +0100

    dummy commit to recover default

commit 30c7944dbc3dea789a97b7522b3fb1bac5205c41
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 15:26:18 2012 +0100

    This has little to do with recovery - move to networking boot.

commit 1fba8d2de9c6b591a5cad458b9ef3e0d232c0514
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 15:25:51 2012 +0100

    Improve comment

commit f524ba790c5056c0386de0237cc0c8f83814db01
Merge: 676679813 5ffe2c336
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 15:25:38 2012 +0100

    merge default

commit 8c1fe97b68f01b22d18600559a9abda63ac63149
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 14 15:24:59 2012 +0100

    Rotate logs without consuming excessive memory

commit 138bb19ae3292e32b7286226c49462cae82f7b68
Merge: 517923a52 676679813
Author: Tim Watson <tim.watson@gmail.com>
Date:   Thu Jun 14 15:23:31 2012 +0100

    merge default

commit 93af9aad4ec6f1c77fc2b2d9fa51be2bdcbdfd25
Author: Steve Losh <tim@rabbitmq.com>
Date:   Thu Jun 14 14:59:28 2012 +0100

    clean up listeners during node start/recovery

commit 02512c230e9a3786ef773390e62932c43d8df280
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 13:09:30 2012 +0100

    Disable disk space alarms by default.

commit 676679813d14134f8dad9e9a7a12847ad950aeac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 14 13:08:56 2012 +0100

    Report more clearly when we fail to monitor disk space on an unsupported platform.

commit 5ffe2c336069917ff05303edab91010c699f7f51
Merge: c9ada0cec 72de38987
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Jun 14 12:45:23 2012 +0100

    merge default

commit debf4fc19a51c29585ffe6c6d2000ee85354f1da
Merge: 36dddc914 c9ada0cec
Author: Steve Losh <tim@rabbitmq.com>
Date:   Thu Jun 14 12:22:51 2012 +0100

    merge default

commit fb474d96e5d7eff4ef2cc6968f312f42089ccf46
Author: Tim Watson <tim.watson@gmail.com>
Date:   Wed Jun 13 14:13:55 2012 +0100

    attempt to handle stale slave pids during intialisation routines

commit 1bfe0d7539d8eacd99be19de545b00af6549272d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 12 18:34:48 2012 +0100

    enforce frame_max

commit f832f262672e09b600c60aa04b1cd6df31fb8c11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 12 18:34:34 2012 +0100

    refactor: move constant and give it a better name

commit c9ada0cecf4e86e93071fba7fcc9a69bd098d888
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 12 17:03:51 2012 +0100

    cosmetic: move comment to a better place

commit 72de3898771d339c0475d1ae04e0d41b44726c55
Merge: c3caad5cb 9ed260c71
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jun 12 14:42:20 2012 +0100

    merge default

commit c3caad5cb996d01308f825fb8896c4160dbdee36
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jun 12 14:41:22 2012 +0100

    revert last commit
    
    I had completely misunderstood what fhc does. I'll put the atomic
    changes to the cluster status file in the `rabbit_node_monitor'.

commit 9ed260c716bd3a5dd62cfa8fa47d521da66820f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 11 17:17:47 2012 +0100

    Revert d86c121dfb0d, since, of course, it breaks the test suite.

commit b970203c133deda19e2db961120be68430285fc6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 11 14:24:29 2012 +0100

    cosmetic

commit 2a7b83949052fdec9ef8a528f437b9b6cd69784c
Merge: 0535b241d a0c6198dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 11 14:18:29 2012 +0100

    Merge bug24989

commit 0535b241d93492e9cb9b101ce3527b9c26ef50fd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 11 11:26:48 2012 +0100

    Cosmetic (again)

commit a267bd741f89e2ec4a396be1752baf96b49b41c9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 11 11:24:34 2012 +0100

    No error when stopping a stopped broker, or starting a running broker

commit a0c6198dd9052395c0742d801241730df6f09905
Merge: 5f98dbd0f 707e264eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 8 17:33:52 2012 +0100

    Merge bug24984

commit 5f98dbd0f47f1c68014cec874c6c3919ff2fe50d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 8 16:35:33 2012 +0100

    Unused var

commit 74306f9bb5b1c6132402b724dced28379c24c8d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 8 15:21:08 2012 +0100

    Don't take a write lock if we're not going to write.

commit 432714c7516c59764b3071bc2cde1ac564a844b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 8 15:20:45 2012 +0100

    Needed for tests

commit 3d869f04a20e69c2c9042c6b608a51e5dbcd269f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 8 12:55:44 2012 +0100

    Stop mirror coordinator gen_server when deleting queue

commit de9b7e140e9fd5ef08d374f7f33252efee9fd729
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 7 18:01:13 2012 +0100

    peek_serial/1 should not depend on having next_serial/1 run first.

commit 62e4f7f7f0d9a8c5c94faa99a8b57106bfe7f363
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 7 17:00:38 2012 +0100

    Prevent coordinator process leakage

commit 359d21f94162d451e79f3430be220983652f7922
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 7 15:55:44 2012 +0100

    Strict and non-strict list by component.

commit 6b7c8cb20e31101158667f5040bb7af8bb902367
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 7 15:14:13 2012 +0100

    No, that makes no sense.

commit 5fc84cc1165ef1e45290d18a92d5841ab927282b
Merge: 707e264eb f7760cdee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 7 15:11:16 2012 +0100

    Merge default

commit 707e264eb285811ec61628a14ee24c830055d881
Merge: fd966fb77 82db4cf2a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 7 14:56:39 2012 +0100

    Merge bug 24982

commit 540ba12d7ea23f286d477f665a2b8b74c2289096
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 18:14:06 2012 +0100

    I never saw the point of that.

commit d6bb6ca3339b4eb6d0444d2879dc88a048b74d2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 18:12:15 2012 +0100

    Oops

commit 3573ca053fc36c578582a10bc4f2c789657360ab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 18:03:59 2012 +0100

    Move banner things from stdout to logs. Leave a vestigal banner so that people who have started Rabbit by hand have something to look at.

commit bc64b13637114e8e3720dc7f4f341cc7880854b0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jun 6 16:39:49 2012 +0100

    add node to existing cluster status instead of creating a new one on on_node_{up,down}
    
    This is because the invocation might come before the mnesia data is propagated
    correctly.

commit 737898d650fa0716d888aa8318cc98864864ff35
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 6 16:31:23 2012 +0100

    Background daemon when starting up

commit fd966fb77c2f800b2d31fe9754a3a85e992d1e83
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 15:57:00 2012 +0100

    Probably should have been part of bug 24792 but: now that we start applications ourselves rather than in the boot script, we can write nicer error messages. Let's do that.

commit 82db4cf2abe4bb4b0b6e9a48ace2e4c38b4e5fbc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed Jun 6 15:51:21 2012 +0100

    simply reading pid files in a way that works on R12B

commit 63ec0f32f0b41eca1432b885ed697f60a61b802e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 14:48:04 2012 +0100

    Cosmetic

commit 0a3d2558ed43c25cab990149478ca29c12993e96
Merge: 5c0d55c19 5e79bf36a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 13:59:03 2012 +0100

    Merge bug 24981

commit 5c0d55c19f241668f2c8453af186166bdfe7388b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 6 13:27:45 2012 +0100

    Backed out changeset 6ee929c7f821

commit 3e15fc21e8640a46e449a8c088bea6d6f403ae2b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 6 13:24:25 2012 +0100

    Cosmetic: remove colons from sysv startup script

commit 41f8fcae1cdd0c63ba505481a5a87246eee4a483
Merge: c4cc0f3cc 5e79bf36a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 12:34:31 2012 +0100

    Merge in default

commit 5e79bf36a7b08d88467c5010eea7d865a32404c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 6 12:32:59 2012 +0100

    Revert to the 2.8.2 version until bug 24982 is resolved

commit 34ad79c65a66af83c5b016ef4423599354bb501c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 6 11:45:26 2012 +0100

    more sacrifices to the CI gods

commit c4cc0f3cc0f6689274ff8b6a26cab8bbb47ca05b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 5 13:38:38 2012 +0100

    rename rabbit_control_main:system/1 to run_ps, which more accurately describes what it does

commit d95a4d529eb46501bc4699f074acf689aad291a5
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 5 13:36:28 2012 +0100

    cosmetic

commit e5c46d3bf0043fb0c6e8315dbb6c64b6ff9265da
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 5 12:55:24 2012 +0100

    return the correct value from rabbit_control_main:read_pid_file/2; don't call binary_to_list twice

commit fedee05543002b9f2d8a2ed725e3029bff19812a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue Jun 5 12:45:44 2012 +0100

    capture and swallow all stdio during 'rabbitmqctl wait'

commit 221e9e12bdf2d293259a35def5a6f31d7659c7fe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 5 11:54:42 2012 +0100

    appease CI gods

commit a28c64d437ac94a3d29ec1e897e6f38a76a39c04
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 1 17:01:23 2012 +0100

    Emit upstart events when broker stops/starts

commit 98ac91d73af6149694635523539cb5adf81b4472
Merge: f92f3fea6 604ed1088
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jun 1 16:07:30 2012 +0100

    merge tip

commit 604ed10881dadd53fbf6ed05f9633b1027dff50e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri Jun 1 16:03:12 2012 +0100

    don't use re:replace/3 as it's unavailable on R12

commit 6e8ef1d7853f3b3e4438f56d6999a348dd4412fe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jun 1 15:51:25 2012 +0100

    stop mnesia after cluster operation

commit f92f3fea63d90128af7688223195b04dc7f4086b
Merge: 370dc9583 3ec9c5232
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 1 15:12:44 2012 +0100

    Merge heads

commit 3ec9c52329817b61ca52d95dcf5edbd1d11d41fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 1 15:12:26 2012 +0100

    Look better when running with input enabled.

commit 2c02a3ced57402e72cb645b5e460151b972c5462
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri Jun 1 15:01:34 2012 +0100

    first attempt at refactoring `rabbit_mnesia:init_db'
    
    The only potentially dangerous thing is that I always upgrade locally,
    while before that was only done when we know that we need an upgrade.

commit 370dc9583665107e4433fba90e749cd66148c353
Merge: 36e43c415 e07f7d6a5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 1 13:36:55 2012 +0100

    Merged bug24974 into default

commit e07f7d6a50bca68d7eabb7e017e70b5a15cdd27e
Merge: f4e69068c 5128463a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 1 11:00:49 2012 +0100

    Merge bug24924

commit 517923a521343d24ca36cb32da1b09d1665076e9
Author: Tim Watson <tim@rabbitmq.com>
Date:   Thu May 31 17:54:11 2012 +0100

    print a different error atom when heartbeat timeout's occur

commit 11ed5c9020db92f5065e508f3bb0cb7e8bb0c80a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 31 15:37:20 2012 +0100

    tidy exports and specs

commit f9c06e3475c36490b5cbba75b583a1fc49039515
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 31 12:57:29 2012 +0100

    fix and improve `rabbit_mnesia:remove_node/1' in many ways

commit 36e43c415fea0522f9d0d2102e2a558d32d35b6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 31 12:34:01 2012 +0100

    Add the "safe" SSL-related modules [ssl_connection, ssl_record, gen_fsm, ssl] to the list.

commit 6176bdc808ca79130a433190d24851de34854ca7
Merge: 5128463a7 aa95db632
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 30 12:25:22 2012 +0100

    merge default

commit aa95db63256cc36ad7dba3a89a8b3e7aef55c5bf
Merge: 5d79c2828 0f6800c6c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 30 12:07:13 2012 +0100

    merge default

commit 5128463a7662e355f8a30c27509fb3912ffa5806
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 30 10:53:27 2012 +0100

    Oops, bug 24792 failed to take into account that HiPE compilation was inserted into the boot script by rabbit_prelaunch. So fix that. We need to hipe after ensuring the rabbit app is loaded, so we might as well inline rabbit:prepare/0 now. And we shouldn't really try mnesia upgrades when just starting the app; that feels dubious. Finally, strip out now-unused exports.

commit 14844481d12f17c5b8ddcd4614d9dbd70a51db7e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 18:23:47 2012 +0100

    Those backticks are... not quite necessary. And led to endless confusion with node.js.

commit 83f7abffc9d6bc6b591daf8fe805f2ba400ac412
Merge: 3433af73e 5d79c2828
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 18:08:20 2012 +0100

    Merge bug24918

commit 5d79c28282569b430b0ff90f7bafeacf3127d6c3
Merge: bc147c5ce 02caa69f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 17:39:17 2012 +0100

    Merge bug 24792

commit 02caa69f9cb037c55b0b6aac7c9f6e2155e090d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 15:57:35 2012 +0100

    Don't print the plugin list as output from "rabbitmqctl start_app".

commit 6783405216e83dd89e7f0006cf476733ec54d517
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 15:53:17 2012 +0100

    Cosmetic.

commit 3a9bf6e98b45eed8b19d6477414b61a077252a56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 15:48:15 2012 +0100

    This can only be true or false. Plus cosmetic.

commit bc147c5ce30f696480efce6670f2d2582c45c307
Merge: c6d23545c ade170be2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 29 12:35:08 2012 +0100

    Merged bug24966 into default

commit ade170be26b0f581b1358ec74a0e6b6c57d80ea7
Merge: fbb13a930 4be1d190a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 29 12:15:55 2012 +0100

    Merge bug24872.

commit 0f6800c6c2a0d06db4c31bffb423e3d56085403f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 29 11:48:03 2012 +0100

    set up cluster beforehand in tests

commit 1abcdd405dca863acb8ecb36e0f5158c95f1aaa8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 28 16:35:02 2012 +0100

    remove cluster managment tests, adjust the others
    
    For some misterious reason if we stop/start cover in
    `run_cluster_dependent_tests' things fail.
    
    Also, the proxy is not working and I can't test the qpid suite, but I
    wouldn't expect surprises.

commit fbb13a930053d01466572589b28e73f0160be60f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon May 28 15:43:53 2012 +0100

    refactor: move socket buffer size tuning into rabbit_net
    so it can be re-used in stomp et al

commit 6cf6aa6c33e735d2be28c2e54a6979638875e3da
Merge: 4be1d190a 47f6b3ca0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 28 13:51:17 2012 +0100

    merge default

commit 493de1c28e196038fce63218fe4db90d32acc08f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 28 13:46:32 2012 +0100

    cosmetic

commit 24906814c8e47a4da1a9cc8d123cca8753d0851f
Author: Tim Watson <tim@rabbitmq.com>
Date:   Mon May 28 13:41:57 2012 +0100

    rename rabbit_plugins API calls to be less verbose

commit 4be1d190a719cb32a67adb346e61d69f8e1a41cd
Merge: 38e963b91 5dd0b08e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 28 12:39:36 2012 +0100

    Merge bug24958

commit 5dd0b08e0c5f26248abedb4b36bef6d7ff9f3e01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 28 12:31:52 2012 +0100

    Cosmetic-ish: no need to pre-compile the RE, and use character class rather than range.

commit 38e963b91d43de1d19c7054baa89647e6c710d4d
Merge: 5241f82db 94dce0cae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 28 11:44:24 2012 +0100

    Merge bug 24961

commit 94dce0cae5cb5164b7fff0d39b38828e6647277f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat May 26 11:01:24 2012 +0100

    cosmetic(ish)

commit 02abe1b0afab1c46311b895061dc6fecc14637ae
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 16:16:40 2012 +0100

    Cosmetic changes only in order to produce new head of default

commit 4c2b8814a5255db6fe645f7412024a43b9987a8d
Merge: e5198431d 3bf2cb5eb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 15:17:57 2012 +0100

    Merging bug 24952 into default

commit 3bf2cb5eb2bd7de1e53d778f3dea0c99537fe833
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 15:14:45 2012 +0100

    cosmetic

commit e5198431dbc0565c85ce1e1621d39b13f203edc2
Merge: 9995e34f9 1961b8041
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 15:00:25 2012 +0100

    Merging bug 24946 into default

commit 9995e34f9867f4d2860f202dfdc03d18ac0ec12a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 14:57:25 2012 +0100

    cosmetic part 2 - the one where it actually compiles

commit 17c088e8e15758747518e1a6470e936fdee9c8af
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 14:56:40 2012 +0100

    cosmetic

commit 8a7e06b0678cf901211e967e3295f5a2606cd16d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 14:53:27 2012 +0100

    cosmetic

commit 8822e5bd2e4121c78b677f7b5b62805be126facf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 25 14:47:34 2012 +0100

    Parse disk free space in a language-independent manner

commit aba864887da7a261a8054c438215fe0cb4f1513d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 25 14:19:53 2012 +0100

    Refrain from discarding updated view when no aliases are removed

commit 60b718c4cdf67d6269693ad917a463f14c3320d3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 25 13:57:54 2012 +0100

    Update own members_state as well when sending catchup

commit c6d23545cc3f0ef3288eda845bc47b7a9e851807
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 25 13:48:24 2012 +0100

    Don't prioritise anything protocol-ish over anything else.

commit 47f6b3ca098d6df2b6b57ed12c9ec020a1b1bb21
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 25 13:20:44 2012 +0100

    comments in `prepare/0'

commit e5905ad74a60c95aedc0a92f7724ddfe4ab3f015
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 25 12:23:53 2012 +0100

    forgot `check_cluster_consistency/0' call in `prepare/0'

commit 1716b21b840a559b4d49c38aead6d7a8d1632b00
Merge: 1961b8041 2615ad8ff
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 25 12:19:07 2012 +0100

    merge default

commit 1961b8041f67fe1b34868d7dd0e130cf3caa8179
Merge: bf96c3de0 d953858c4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 11:51:45 2012 +0100

    Merging bug 24954 into default

commit bf96c3de075dac375b8b39c4affbf28f2bc5c56a
Merge: 51fd9083b 67c70e44a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 11:42:07 2012 +0100

    Merging bug 24945 into default

commit 67c70e44aa97b8956f608728a87f5fbeea82c4ba
Merge: 53b98cbda 7bd43a28a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 25 11:38:21 2012 +0100

    Merging bug 24944 into default

commit 5241f82dbdb0fe08b1da53957e6c0d3cc05298f1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 24 16:55:18 2012 +0100

    Allow nodes to start up in alerted state

commit 2615ad8ffad7f5c149bb789b2c7cd35f73a995fe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 24 16:54:29 2012 +0100

    handle legacy `cluster_nodes.config' and `running_nodes_at_shutdown'

commit 7bd43a28ab291c22bc1769721541483ffb90ac51
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 24 16:45:26 2012 +0100

    rabbitmqctl list_user_permissions does not take a vhost arg. Never has.

commit d7ff6ea6573a6ad290edda59a5a4ee61c1d3f697
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 24 16:41:48 2012 +0100

    Add special case for i18n reasons.

commit b4b604ac7f79fc1fe889f71ca8d62609a40e8be7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 23 17:40:47 2012 +0100

    Remove erased memberstate when possible

commit fe8f40694309eaa940dbbe0bc9dca96d6e77d42b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 16:32:13 2012 +0100

    added `rabbit_mnesia:remove_node/1' to remove node from clusters remotely
    
    Maybe I'll add more explicit checks - e.g. whether the node to be remote is
    offline - for better error messages.
    
    Also, as discussed with Simon, we probably need to add machinery to monitor
    when offline nodes leave clusters.

commit d953858c4cfdcbbfb8ae2707d9e0d1e8c243b567
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 23 16:30:49 2012 +0100

    Handle callback replies to handle_msg correctly

commit af5e142900e86b22057fb4281a4669f9d1f1a90a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 15:30:09 2012 +0100

    Cosmetic

commit 04c5b79c1a1140e4d1d2e6cfe076e79323b88093
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 15:17:31 2012 +0100

    Fix dialyzer warnings.

commit 09b981e2cd4b25eb004597ff9d893c01c22bd4a2
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 14:28:51 2012 +0100

    fiddling with `rabbit_mnesia' specs

commit 50a668b2dd9054054882d9d83e3e3be9f32b9229
Merge: 76a4e6f68 9493ee0cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 14:09:23 2012 +0100

    Merge in default

commit 9493ee0cdbeb7aaf994426549672ea43e915cdaa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 14:07:28 2012 +0100

    OK, it's slightly cheeky to pass this as the name of an application. But I think it's better than passing 'rabbit' and having that not mean the 'rabbit' application.

commit 34a57de65caac9c4a0f358111c85ca9578bef9a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 14:06:27 2012 +0100

    Cosmetic

commit bebd710ac582fae402b31fd81d89b7038f79b83a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 14:04:24 2012 +0100

    Cosmetic

commit e8f50568f840e9f9c2ec4971f1115e883b54dc44
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 23 13:37:10 2012 +0100

    Erase aliases more correctly

commit 7476ca3e88fca5e8e95e92a781af29f43b47ffdb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 13:14:02 2012 +0100

    add `rabbit_misc:rabbit_version/0'
    
    also, `get_key', not `get_env'.

commit 76a4e6f689aa0cbe7bb56d1cfb1f054a39466d00
Merge: 8f4377466 350bf271a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 12:59:36 2012 +0100

    Merge bug24919

commit 8f4377466980f35adb8f0e67015f0867f9f48491
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 23 12:59:21 2012 +0100

    Comment

commit 9baf037b3b51460036cd06625ba711fe9d943f38
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 12:26:41 2012 +0100

    deleted percent by mistake

commit b8793d4d03433b1ad7d026365d68a6fc58f2cf8d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 12:05:27 2012 +0100

    stricter cluster consistency check
    
    Now checking for matching OTP & rabbit version

commit b8784f4d1484dbd5a907f14c0e20306203c09bd5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 23 11:12:09 2012 +0100

    on a second thought, it is better to reject options with missing arguments

commit 095b0c42cf7be01b6463becb7bf957656b738c0e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 22 18:47:21 2012 +0100

    incorporate most of Simon's patch changes
    
    It's everything but the removal of global options and the possibility of
    providing just the command atom instead of {command, opts}, + 2 bug fixes
    in the patch code (returning `bad_argument' when there is an option with
    no argument and reversing the arguments).

commit 166124e8c12a2b2dbdd93210b14c43b5dbe67d21
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 22 16:21:32 2012 +0100

    ooops... do not update the cluster status file with its own data

commit 5901596450d8b0f289b5a4cf9b7fbfbac43874ec
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 22 11:34:16 2012 +0100

    fix but in `rabbit_mnesia:status/0'

commit 0e4afa86a0f62d14105c4a94158fe3c9b1adf282
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 16:41:26 2012 +0100

    forgot to replace old function

commit 854c255187a096656a883a90c6c29f05d1a77f5a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 15:47:48 2012 +0100

    get_options => parse_arguments

commit 4edc93aa0e0bca3bfe41fcd43e396bbce4f36b0c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 15:40:26 2012 +0100

    convert to list at the beginning

commit b8c97b3d6cd5571122efc9362f25dd3f4a4a37ca
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 14:38:23 2012 +0100

    change the cluster nodes functions to rely on the cluster status file only
    
    + some other fixes based on the fact that now we firmly assume that the
    cluster status is as up to date as it can be.

commit a86cc7c15fc3d19894158193df7f74cd171e7af3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 11:39:49 2012 +0100

    change rabbitmqctl `join_cluster', add `recluster' and `change_node_type'
    
    also, remove `cluster'.
    
    Description for the commands:
      * recluster <clusternode>
        Instruct an offline node to try to cluster with the nodes provided when
        it comes back online. With "cluster" I mean cluster directly, only if the
        other nodes think the node is in the cluster already.
        This command is useful if we bring a node down and then change the cluster
        while it is offline.
      * change_node_type (ram|disc)
        Changed the node to the provided node type. The change will fail if the
        user is trying to create a standalone ram node.
      * join_cluster clusternode
        Same as before, but only takes one node as "discovery" node. We think
        this is better since we don't really make any attempt to verify that
        all the provided nodes are in the same cluster anyways.

commit 7dfc71f3f2e9a9acc95133ef4429d50045f06371
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 21 01:11:49 2012 +0100

    simplify `rabbit_misc:get_options/4'
    
    Incidentally, it is also much more efficient (not that it matters).
    
    I will probably rename it to something like `parse_arguments'.
    
    `CommandOpts' and `GlobalOpts' could be one, but I think that `GlobalOpts'
    is really useful since adding the global options to each single command
    is a pain. We could, obviously, put them together in a tuple, but then
    it's not that different from two separate arguments.

commit 46fe498a29298816861c13e2447ee680dac55d1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 16:58:03 2012 +0100

    It's really misleading to print "-- plugins running" when there are no plugins running.

commit 70c4ec851e47be695ae57ade9c7e7334923d6e11
Merge: 350bf271a 0b048c70a
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 15:11:26 2012 +0100

    rebase with master

commit 0b048c70ac5daec1eb6f488ea2ed836bd1aa2492
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 14:13:48 2012 +0100

    fix variable handling in rabbitmq-server preventing background node startup from working (rebase foo)

commit f7760cdee478f3b1134516c4580af93565afca0f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 16:05:12 2012 +0100

    We can't now write the serial record when we declare the exchange; an exchange can become federated at any time.

commit f3de805963356e7f572dc538a45045fab4e280a4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 18 12:01:09 2012 +0100

    moved functions around in rabbit_mnesia

commit 53b98cbdaa2d42f0273bf0dbe235003d206ac507
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 18 11:37:51 2012 +0100

    Prevent DOWN messages from overtaking initial catchup

commit 3babc78551fe2d8126c56b26346f9d808d1730c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 11:36:06 2012 +0100

    Move parameter validation into its own module.

commit 7f1bda6108826ee32a4e1019b335734efcf8b478
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 11:16:21 2012 +0100

    Unused variable warning

commit e6a8155834034c60f100ddcf52fce62c792ed162
Merge: bdd62ebd0 350bf271a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 18 11:14:30 2012 +0100

    merge default

commit 350bf271a43b8717f66842a46c967af9160b84a8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 11:00:41 2012 +0100

    How long have we supported pluggable exchange types now?

commit ce4fa1b7d8ddd8ca3a2e9c051b2e024f87c6a6fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 10:59:25 2012 +0100

    Document policy info item.

commit 975aa1d925d16b2c2c1920e28d53f84a200d7711
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 10:51:33 2012 +0100

    Remove decorator:route/2.

commit 119fdcd4ce38fec31d6e2f50d349458d876a3392
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 18 10:50:17 2012 +0100

    TODO--: Update behaviour

commit 51fd9083b5191c0740144cb4d2793e134f5e8ed0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 18 10:23:03 2012 +0100

    Track a member's own last_pub in members_state

commit 25484ae2e09a4ad29520b8e7bed6f55c2e3d595d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 17 17:52:01 2012 +0100

    First sketch of a policy mechanism.

commit 2b8a8875cc60d858c0b4506b15051507ff9842fd
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 17 15:28:28 2012 +0100

    oops

commit 054a8528999a81de83b23ebf8472ae0114b33076
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 17 15:27:42 2012 +0100

    add test for `rabbit_misc:get_options/4'

commit 35421112ef06cf418c38bfb69357cfd19381db85
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 17 11:51:19 2012 +0100

    change to how `get_options/4' handles flags
    
    Now it doesn't complain on flags that should not be there, it simply eats
    only the flags relevant to the command.

commit f213e8a03792c4df233c4d3522812178caed2d2c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 17 11:15:58 2012 +0100

    don't wait (nearly) forever for mirrored_supervisor migrations
    ...and reduce wait time for migrations we expect to fail, so we keep
    the overall run time short.

commit 01c6657cd1b0dca39254bf0bd0f2aa168d6989c2
Merge: d860d6650 b85e47e6d
Author: Tim Watson <tim.watson@gmail.com>
Date:   Thu May 17 10:52:37 2012 +0100

    merge bug24362

commit ee921f6459ce72c51de31fc75f285c7d20dd04f9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 16 18:04:59 2012 +0100

    added checks to `rabbit_misc:get_options/3'.
    
    See comments on top of the new definition (now its arity is 4).
    I still need to update the tests.

commit b85e47e6d4a2599992bd2f08d67694223672996f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 17:39:07 2012 +0100

    start supervisor children as, er, supervisors, not workers

commit 3f5026784eb008175b9fbeab4ae8d010037dd4a8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 17:21:29 2012 +0100

    expand rabbit_sup API with starting of children that are supervisors
    and use that API throughout the code where appropriate

commit 9fef6e6b144a9f5e96d20c8e0ab46ee10131c59d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 17:08:03 2012 +0100

    cosmetic

commit 925479452a4ffeb7f513fa46ee50cf0d7ceb0144
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 16:49:11 2012 +0100

    remove message about re-installing windows service after plugin changes

commit f879bce482e5f97df0a59ed1a270eea4f6b85a38
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 16:26:27 2012 +0100

    be mindful of windows line endings whilst parsing pid files

commit ea345d9a3010edcee30673891191ae8ad3607de3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 16:23:41 2012 +0100

    cosmetic

commit b4787d760abca28c9dff4cd74327a4b2b92656dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 16:22:02 2012 +0100

    add missing spec

commit 5a1ac0ab2e83d9ddbc44571590fc7c278877cfaf
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 15:38:21 2012 +0100

    on windows, die in the correct manner when node name is already in use

commit 36dddc9143f67136fa536c569123796d3ca23a3e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 16 15:22:46 2012 +0100

    get a node to clean up after old incarnations of itself
    ...in case other nodes don't do so in time or, if they themselves
    stop/restart, ever.

commit 87e5459f49ecf8c4a98da1d4570c4a7cfae0efc7
Author: Tim Watson <tim.watson@gmail.com>
Date:   Wed May 16 14:46:11 2012 +0100

    revert to expected RABBITMQ_NODE_ONLY behaviour on unix

commit 519291ca585ffd77fb5178b78a18adc0924e0abb
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 13:59:21 2012 +0100

    cosmetic

commit 08f7151ebeb5366fa6bf753c60f3bc8882d34888
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 13:48:29 2012 +0100

    rationalise rabbit_misc:terminate/1/2 with rabbit_misc:quit/1

commit 52b888ec568f99f9c979076e1fe98042ba8d737f
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 14:10:09 2012 +0100

    fix variable handling in rabbitmq-server preventing background node startup from working

commit 13389eb3fb5b53d5c4d5429f7dc052e528391c3d
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 14:41:57 2012 +0100

    manually merge 3c20079f0601

commit a57dae43426c0a0bbffcd361e84f59eda92c7276
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 14:36:10 2012 +0100

    rework e4649f81c3a6 commit history for renaming

commit 1b69cfee721ce2967cca47a54bfbafcada3453bb
Merge: d643df379 9faa9b7a5
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 14:04:39 2012 +0100

    merge 7dae0f4505ab manually

commit d643df379f9ed7df3ff5e1b996f79e4d070fbb35
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 21 13:55:48 2012 +0100

    rework commit history for bug24792

commit 50b1fd1d481bd617dcd0141b8522e8eff43bb25b
Merge: 21423cc39 d0652f278
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 16 12:35:12 2012 +0100

    merge default

commit 9faa9b7a56b16323deabfbca1bd1c023cce3abed
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 12:02:03 2012 +0100

    split rabbit_plugins into client and server side modules

commit caf1587e03c8bad21ed8f3ed88b3991e35bcc56a
Author: Tim Watson <tim@rabbitmq.com>
Date:   Wed May 16 09:19:12 2012 +0100

    rename bootstrap_environment to prepare_plugins; fix while_process_is_alive activity call

commit bdd62ebd05e37de6bf38eef43d03c4bbca63602f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 15 18:04:32 2012 +0100

    store more info about the cluster on disc, check other nodes before clustering
    
    Now the `cluster_nodes.config; doesn't store a "config" anymore, but all
    the information we need about the cluster nodes. This file is updated
    whenever a new node comes up. Moreover, this file should be *always*
    present, and it's set up in `rabbit:prepare/0'.
    
    Now that we have this file, the various functions regarding the status
    of the cluster (`all_clustered_nodes/0', `running_clustered_nodes/0;, etc.)
    can "work" even when mnesia is down (and when the rode is a ram node).
    Given the assumption that the status file is up to date, with the status
    of the cluster (before the node went down if the node is down) a lot of
    operations become easier.
    
    I'd like a review at this point, the best thing is probably to diff directly
    with default since a lot of previous commits are not relevant anymore.
    
    The most noticeable changes compared to default:
    
      * `join_cluster' works differently. The nodes provided will be used to
        "discover" the cluster, and are not used to determine whether the node
        should be ram or not. The node will be a disc node by default, and
        can be initialized as RAM with the `--ram' flag. The old `cluster'
        command is preserved, adapted to work with the new functions while
        preserving similar semantics (we decide on whether the node is disc or
        not by looking at the list of nodes provided).
      * `force_cluster' has been removed.
      * The `join_cluster' operation will fail if:
        - The node is currently the only disc node of its cluster
        - We can't connect to any of the nodes provided
        - The node is currently already clustered with the cluster of the nodes
          provided
      * On default restart RAM nodes try to connect to the nodes that were first
        given by the user, and are not aware of the changes that might have
        occurred in the cluster when they were online. Since the cluster status
        is kept updated on disk now, the RAM node will be aware of changes in the
        cluster when restarted.
      * Before starting up mnesia, the node contacts the nodes it thinks it's
        clustered with, and if the nodes are not clustered with the node anymore
        the startup procedure fail. We fail only when we know for sure that
        something is wrong - e.g. it won't fail it it doesn't find any online
        node
    
    Things to do:
    
      * Implement `uncluster'/`leave_cluster' to kick out a node from a cluster
        from another node - this is easy.
      * Implement something like `change_node_type', since given how `join_cluster'
        works it is not possible right now.
      * Rewrite the tests regarding to clustering.
      * Think hard about what can go wrong regarding the cluster status file and
        the relevant functions. The stuff in `rabbit_upgrade' is particularly
        worrying, and I need to make sure that things will work when upgrading
        rabbitmq, by reading old file or upgrading them.
      * Split `init_db/4' in various functions. We have much stronger assumptions
        now, for example we should never need to reset or wipe the schema in
        there. In general it's an ugly function, expecially the optional upgrade
        part
      * Probably something else...

commit 693da5ef02e18c9652396e3335c5bd7e3e0d4889
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 15 16:53:50 2012 +0100

    remove ref to old define; document terminate/1 vs quit/1

commit 022dde13ae6f7da2fa6ed31f68cb3046e2ecb295
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 15 16:44:20 2012 +0100

    remove vestigial ERROR_CODE define and dangling TODO from rabbit_misc

commit ae97331c531701e4eccde745cc1974aa912b5594
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 15 16:40:12 2012 +0100

    preserve original 'wait on any app' functionality

commit 01c649e6ef942271d12f6a7620ca2fdbb8c8464f
Merge: 48ed9f2a5 d0652f278
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 15 16:24:27 2012 +0100

    Merge default

commit 841d204c29986228b3af7382a0e2b5e8922a2ea3
Author: Tim Watson <tim@rabbitmq.com>
Date:   Tue May 15 16:20:30 2012 +0100

    rabbit_control waits as long as process is alive

commit 44db2ff0480de4ba4708f24fcdf2cc0c88003f26
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 14 18:08:29 2012 +0100

    fix leave_cluster, update rabbit_app.in

commit da995ecd1dcf6ba8c56b5a2da6ecb185f1a6c456
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon May 14 16:57:28 2012 +0100

    change function to find out about cluster nodes
    
    See comment above `check_mnesia_running/1' in `rabbit_mnesia'. In short,
    the function to find out about all/running nodes in the cluster do not
    work if mnesia is down and the node is a ram node, while we assumed
    that they would always work. Moreover, the functions to get the cluster
    disc nodes require mnesia to be up.

commit 9194ab8cba39c7aec312ec7e9ff0eea3a6744af6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 14 16:15:03 2012 +0100

    Make the list of plugins look a bit more like the boot steps.

commit 9e803afc5cbb04b76fc84dc0b2ae738ef9d3a868
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 14 15:28:45 2012 +0100

    "Activating RabbitMQ plugins ..." is no longer particularly true or useful to report here. And clean up some trailing spaces.

commit d860d66501327b8a5db75a02d7978f33f64bd447
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 14 13:41:27 2012 +0100

    merge e1311dd42eba into bug24362

commit bf183d39cf4d30bdfe438210139c0fc44144c08c
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 14 13:40:36 2012 +0100

    merge f6d1609212f9 into bug24362

commit 9c48760f3dec5e91cd87cb89852cd9012a69dd5a
Merge: 151790422 d0652f278
Author: Tim Watson <tim.watson@gmail.com>
Date:   Mon May 14 13:37:53 2012 +0100

    merge default into this branch

commit 730212794c1629a2425aebb83a31992411e190cb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 11 18:33:14 2012 +0100

    reseting when clustering, `reset' now disconnects correctly
    
    Also, I check that we're not joining a cluster we're already in.

commit 4642c6c238b2e8e85a842829d062e41171f38fe8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 11 17:35:34 2012 +0100

    added `join_cluster', deprecated `cluster, changed the structure of the node config

commit 97cb1abd44115435a199d81fa941351312d6783e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 11 14:20:31 2012 +0100

    remove the bug 24919 stuff

commit b461480f43bc12891229b83d7f8d71a7e8fb8152
Merge: 21423cc39 3e4193fb5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 10 16:24:15 2012 +0100

    merge bug24919

commit 3e4193fb5f489c1bea3a84fb296adb6c332bea3b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 10 15:46:12 2012 +0100

    removed `rabbit_mnesia:force_cluster'
    
    I'll also have to remove the `Force' parameter from `init_db', fixing
    bug 24815.

commit 0e1ed210dbd8f3e942e6d457ca36369278cfa2da
Author: Tim Watson <tim.watson@gmail.com>
Date:   Thu May 10 14:43:00 2012 +0100

    remote TODO and extraneous branches from rabbit-server

commit 01abd002e39cce91137a5eecdc2b45cd7cb2464b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 10 14:42:12 2012 +0100

    remove the subscription to the schema table
    
    Since dump_tables won't work with the schema table (and works different to what
    I had understood anyways) I don't think it's worth it to subscribe to the
    table, and it's probably better to just modify the config file through
    rabbit_node_monitor.

commit d0652f278fc17ed260738b51d6f49a0598d0dd2f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed May 9 22:08:43 2012 +0100

    refactor

commit f01e52c4573fcf86ca57d0c38af26c386db869f3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 9 17:46:43 2012 +0100

    dumping schema table on changes in ram nodes

commit 46ba4d4f986b325625d6b1853fe9eb046fe52a52
Merge: aabd2c88f ced86f27d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 9 17:12:20 2012 +0100

    merge default

commit 21423cc3924cde75c500c575d43b5bb187373c7c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed May 9 15:14:14 2012 +0100

    `proplists:get_bool/2' does not do what I think it did, using `lookup/2'

commit aabd2c88ffeebec4102c6743c29b1984d4b1c2ab
Author: tim <devnull@localhost>
Date:   Wed May 9 13:03:45 2012 +0100

    check for a new pid when registered children die in mirrored_supervisor_tests

commit 9a1a020fc5667f2527fe6c898a115cb858e737df
Author: Tim Watson <tim.watson@gmail.com>
Date:   Wed May 9 12:15:41 2012 +0100

    rabbitmqctl uses rabbit:await_startup/0

commit 244c1ddf76425366f42395c8231bd4e97e6dbd4b
Author: Tim Watson <tim.watson@gmail.com>
Date:   Wed May 9 10:57:36 2012 +0100

    migrate application handling code to app_utils

commit 48f1cb86ae7e1331cbe71d443bf7012163918a23
Author: tim <devnull@localhost>
Date:   Tue May 8 18:07:58 2012 +0100

    do not kill the child explicitly

commit 5bb861fc86301fcf371e77831e15f79da44ab3d3
Author: Tim Watson <tim.watson@gmail.com>
Date:   Tue May 8 17:55:57 2012 +0100

    for bug24362 - assert that worker name is unregistered by the time we get a 'DOWN' notification

commit 151790422eabcbb79d0a5c0a88426f0a0a709603
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 8 14:04:30 2012 +0100

    Oops

commit 764f688edb74e2cc9bbf59ef49e8b47a4a75452d
Author: Tim Watson <tim.watson@gmail.com>
Date:   Tue May 8 09:31:49 2012 +0100

    rename start_cold to boot

commit 68b379dc3134cb4a4a08990bfda2a6fb713eb596
Author: Tim Watson <tim.watson@gmail.com>
Date:   Tue May 8 09:22:18 2012 +0100

    revert deleted comment explaining why we're sleeping for 100ms on startup

commit f4e69068cd1811dec3b9eb612a69a32e071fd442
Author: Tim Watson <tim.watson@gmail.com>
Date:   Fri May 4 17:42:00 2012 +0100

    do not overwrite RABBITMQ_PLUGINS_DIR on windows

commit bfa2b0dda364c7444b499afe6714a9bc781450f4
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 17:08:05 2012 +0100

    apply startup changes to windows service batch utility

commit 0dfa7602240736815ee327d83063f18044d8c72e
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 16:56:01 2012 +0100

    fix windows batch file code path handling during cold starts

commit ced86f27d75e501f4c21f72decdadbe044088524
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 4 16:46:35 2012 +0100

    forgot to change the arity of init_db in the export

commit 3ae8ba8569e5451b1d3f869d366433143a21d28c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 4 16:41:17 2012 +0100

    re-added a boolean parameter to init_db to prevent upgrading

commit 7d36e7bbd1a1a7b6355187cfc6713f818f334ed4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Fri May 4 16:27:56 2012 +0100

    remove the fun argument in `rabbit_mnesia:init_db/3'.

commit 9f1c00388283891d34dd4c82a64f49f4b671a241
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 13:59:45 2012 +0100

    attempt to make rabbitmq-server.bat behave like it's unix cousin

commit 742ba50b4cd079e599aaa03ba2d2518adf26124f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 4 13:55:26 2012 +0100

    pmon is very much hipe-worthy.

commit ed11b19b5662719eb753c5fcb4d8d03cfa300fb1
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 13:31:25 2012 +0100

    ensure that all dependent applications are stopped when shutting down the broker without halting the emulator

commit 45477ebe03ab3cf7a11da7e46b211b79eedbef2b
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 12:28:27 2012 +0100

    move application lifecycle (loading) into one place - rabbit_misc

commit 9a3b945490bcb628a2e4b85cbbca8e00b8f62a89
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 12:04:43 2012 +0100

    plugin environment bootstrap and introspection code moved to rabbit_plugins

commit 8846f10f245417fb445c9d09f01f5ad83bc732a8
Merge: 224d28b89 7a19a9572
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 4 11:59:25 2012 +0100

    Merged bug24889 into default

commit b1543f5ba38accb539241412a5c0e586f1b5f2dc
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 11:19:32 2012 +0100

    rabbitmq-server uses start_cold

commit a59ac79a6f0393cbe59c5afb51cb5be703485a61
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 11:18:53 2012 +0100

    start and start_cold both defer to rabbit_misc to calculate application load order

commit 9d138b35a0a38144f0f475a6cbf7d31af9de2b93
Author: Tim Watson <tim@rabbitmq.com>
Date:   Fri May 4 11:15:40 2012 +0100

    rabbit_prelaunch only checks for duplicate node names

commit 7a19a9572821f58b3ee2b4ceff317fd53ed50f08
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 4 10:25:08 2012 +0100

    cosmetic

commit a7e9320c089bc6c517cec737cec0c6137f21ee2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 4 09:59:06 2012 +0100

    cosmetic

commit 0a8323d0e0b4761c26cfda41763ba276f92ab14c
Author: Tim Watson <tim.watson@gmail.com>
Date:   Thu May 3 18:51:57 2012 +0100

    add rabbit:start_cold/0 without relying on release/boot-script

commit 3629553fcab6de2ea6289bab427ab7e6014efd0a
Merge: 61fb0b9b0 ba0545800
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 18:21:32 2012 +0100

    Merge bug24729 (again)

commit 61fb0b9b0e0c631c1aaf0c43cf0b3e1bd39bc5c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 18:20:53 2012 +0100

    Fiddle with comments

commit ba05458008eab1775ff8642aeb962306d6428ff3
Merge: 119b3e5a4 7de434323
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 17:48:55 2012 +0100

    Merge bug 24901

commit c082306909af0ac9b5cfdc4cb6da8f68cec9d667
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 3 16:37:29 2012 +0100

    cosmetic

commit 8670a5f33b9f45af4a23d46e1d0f1af39c208c9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 16:08:12 2012 +0100

    Don't use an untrappable kill.

commit e98e1040bbeba29fdb5b8aa74ad07fec4c9c812f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 16:07:07 2012 +0100

    Switch to monitoring the overall supervisor.

commit 119b3e5a45151d0fe0ab019d5972030a46e3a8dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 13:21:01 2012 +0100

    Revert 9d59000c4a44, 38eb4652c7e3, f6d1609212f9, e1311dd42eba (timeout changes for mirrored_sup tests)

commit a738fb99ae1e0d29e686ab454846a19a485bd4b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 3 13:18:23 2012 +0100

    Revert aa8a9e4d1bb2 (extra debugging for mirrored_supervisor)

commit c437dffe256626c01330b7e6ccd4b045541bf470
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 3 11:48:10 2012 +0100

    cosmetic

commit c02bfd5a1099c110520ff2318f7afbe1fdfa2697
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu May 3 09:35:33 2012 +0100

    oops, had left io:format in the code

commit ff5300e4f8431c5331bc5823caee9d9694fcd0f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 1 18:19:17 2012 +0100

    Fix for R12B-3 that was broken by bug 24196.

commit 6a9465d21a9990a5dc8afd648a0ad92904673008
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 1 17:35:48 2012 +0100

    fix typo and opt checking

commit 062a447654e60ed89795f3a0de902157393ecefa
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 1 16:39:30 2012 +0100

    use pp flag isntead of re-writing the flag

commit 86319ad6334b26a187ecc67d0350eed4b1ab7052
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 1 16:24:38 2012 +0100

    A bit more debugging information on why we might get an error back from the delegate.

commit fcfabc335acd228b850b7c94b341e19c4fba4ca1
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 1 16:11:21 2012 +0100

    Removed unused types, added dummy -spec to silence compiler

commit 44b806427905f7a2cf3437b5907eee8eb515bb63
Merge: 37c56fa91 f00d2649f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 1 16:06:09 2012 +0100

    merge default

commit 3d1e803d6c6fb2b65d57e48f30d19dccf7b01bda
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue May 1 14:52:01 2012 +0100

    Check that options are not used in the wrong place

commit 37c56fa9171cd3e1d89efe9d0fce766d62ff94b1
Merge: 7e2a6d956 954195463
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 1 12:26:18 2012 +0100

    Merge bug 24196.

commit 95419546392fb9a2fc4d3269a8b35631c0fb7356
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 30 16:01:39 2012 +0100

    Log errors when children fail to start.

commit 3433af73e20ffbd7bcc3e8655165cf44c9555e26
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 30 15:54:49 2012 +0100

    Fix typo in debian control file

commit 5f1fdd38d3463a48df1b7a7bab9e2634c1ea9c48
Merge: 11c085954 86a00d53e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 30 13:08:38 2012 +0100

    Merge heads

commit 86a00d53ee6548a4a5b618368a7d575b074fce35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 30 12:31:24 2012 +0100

    Added tag rabbitmq_v2_8_2 for changeset 4136141f70b9

commit 11c085954b5bce412acd320670360aa4f598d1bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Apr 29 22:08:11 2012 +0100

    another attempt to track down the mirrored_supervisor_tests CI failure
    waiting forever is all very well...except when we *expect* a failure

commit 15b4db21b388a61c9dcfc089c094450031c5e817
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 27 19:52:38 2012 +0100

    cosmetic

commit 7318f2a8fdfc19748fa6bf85ab0bd2896c144c5d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 27 19:43:55 2012 +0100

    let's wait forever
    ...so we can investigate what is going since this fails in CI even
    with a 1 minute timeout

commit 2fbeafa92d363ee9fe3eaf06e4bf2032be12ec58
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 27 19:36:14 2012 +0100

    bug: code_change/3 should return {ok, State}

commit 1cff0800f50874fafd180d3bc39c8f956f4e6537
Merge: bbdf65092 1376aa606
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 27 14:13:11 2012 +0100

    Merge bug24911

commit 1376aa6062d68e3a6790bd4d81aad5e8e6b4a35f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 27 13:17:05 2012 +0100

    another attempt at pacifying the CI gods

commit 224d28b891d3a159e09c436157650a2bda098824
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 27 12:11:05 2012 +0100

    Display things that are strings as strings rather than terms, since Erlang's string-detection algorithm breaks on non-ASCII characters. Assume that ~p's use of quotation marks was a deliberate aesthetic choice.

commit bbdf65092a9cb418101f68e44b09eb9c3496911b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 27 11:10:49 2012 +0100

    properly ignore dynamic children that return 'ignore' from init/1
    thus preventing an explosion on supervisor shutdown when we would
    otherwise trip over unlinking an 'undefined' pid.

commit f6a1c4b9efefc9da018140aea8e75dd3377aa8c5
Merge: 053c5665c 6a7303ef5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 26 14:55:41 2012 +0100

    Merge bug24909

commit 6a7303ef5d723eb0bfd7ef23a3eaca3c1cd3819e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 26 14:23:04 2012 +0100

    Report error better in case disk free check fails

commit 92e0772c5e678b910522b3ad4cae3e2b3591c5e8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 26 14:16:38 2012 +0100

    Correct disk free checking command on windows

commit 48ed9f2a5bbc39ef752c7d698416b1d368c7322e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 26 11:44:12 2012 +0100

    Share the exchange scratch space

commit 053c5665c57e003e9669b7e5904ac4a9b636481a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 26 11:32:59 2012 +0100

    bump the mirror_supervisor_tests wait time to reduce ci failure rate

commit 2269609894a2635691483f211317f0a2b7dcc713
Merge: 9b017b14d 1b43a50a1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 25 15:13:04 2012 +0100

    Merged bug24866 into default

commit 9b017b14d8690661f47ab01219d6d54b568d7071
Merge: 5d2b88085 3d6fda6a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 25 14:17:57 2012 +0100

    Merge bug 24790

commit 3d6fda6a6d20fb4de1f7e248e02561000b9101ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 25 13:35:02 2012 +0100

    One less substitution. Pity RHEL and SUSE also differ gratuitously.

commit 9ceb8aced6dbca5655516f2146fe60da38d7c1a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 25 13:32:27 2012 +0100

    Move the Debian init script to its natural place

commit cce0b20f788bf4fee898c100da555a5db12cdced
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 25 13:32:04 2012 +0100

    Move the remaining common init script to RPMs

commit 5d2b8808592ec5da8d778f8d9b587188c1f3486e
Merge: ed9632692 7b094e782
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 25 12:24:40 2012 +0100

    Merge bug24884

commit d7344855ea74f21140eb63c8aea576906105ea83
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 25 11:49:04 2012 +0100

    Allow stopping stopped; and starting started broker
    
    Consistency and description

commit 47927e2097f65b793923b86fb1e2d5f0a5415127
Merge: ed9632692 7b094e782
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 25 10:52:47 2012 +0100

    merge default

commit e36c827ed6e4e49763196df94ef547e93384591f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 24 18:06:52 2012 +0100

    Add an abstraction for reading the scratch

commit 37b9455d6d0a9342216bc29e47a81eb3deb121e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 24 17:50:00 2012 +0100

    Rework event serialisation thing so that decorators get a say too. It's a bit fiddly since we have to ensure that just because a decorator wants serials, doesn't mean everything else has to get them...

commit 2b9bc34e74021606971c02a619c12a709c22a423
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 24 17:33:26 2012 +0100

    lsb init script for debian

commit f00d2649f4c2efd0686755a7dc265ee678462c4a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 24 16:00:56 2012 +0100

    Add comment explaining why ack() and state() exist.

commit ed96326921f6cd5bafc50b7c4ee4dbbcb0cc2e66
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 24 14:34:56 2012 +0100

    Update the msg_id_ack in set_length.

commit 42c84b030194497f12cceb805ed1cb127375f041
Merge: 7e2a6d956 735b9004f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 24 14:32:57 2012 +0100

    Merge bug24196

commit 7b094e7821e63a70cfd827e8c8ed7525474da0a9
Merge: cef3c28c5 9dc09c683
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 24 13:00:04 2012 +0100

    Merge bug24848

commit cef3c28c5e1ffee63f7b2f5baa8b51b5f0661187
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 24 12:59:46 2012 +0100

    Cosmetic. Ish.

commit 9dc09c6834e12cb97852fc1342a7e2a702aba3e4
Merge: b252e9bb6 1ba7b5435
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 23 17:57:11 2012 +0100

    Merged bug24885 into default

commit 1ba7b54356141099ebdad8c095932fd717091df3
Merge: a14b63475 599fdbe36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 23 17:06:57 2012 +0100

    Merge bug24877

commit b4667e30ddb575a111b8871e770963d00b6d910b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 17:05:51 2012 +0100

    AckMsgs -> AckRequired in master:purge

commit 6d4f4533432aa4db3ab4e7eba17801a8ba225916
Merge: b252e9bb6 ce7ca70ce
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 17:03:25 2012 +0100

    merge bug24885

commit 599fdbe3626264a5a1e831a12c6804fb59288479
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 23 16:59:16 2012 +0100

    755 is wrong, this should not be executable. Somehow it ends up not executable anyway, but we shouldn't say it is...

commit 0bb67c1476c8e92ab6e482c30a4622f5e25b902b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 23 16:58:44 2012 +0100

    I don't think we need a licence header, and it's intimidating. Rephrase a bit too.

commit b252e9bb61d8685a91e2f4993d71706a22485833
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 16:52:31 2012 +0100

    Damn sleep in Makefile...

commit 7407a6c96cce7e61aaafa520ebeef607f8ace3f7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 16:51:06 2012 +0100

    Make rabbit_variable_queue:dropwhile tail recursive

commit 9b3d19faf258c10cc4127ceeab684139516b1e8c
Merge: ec82e9b79 72c55d7ba
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 16:37:28 2012 +0100

    merge emile qc changes

commit 72c55d7baa733915e01bd3e9bd1528c2447d7f89
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 16:35:43 2012 +0100

    Clearer var naming in BQ:dropwhile. Fix in amqqueue_process:drop_expired_messages.
    
    Also, corrected the dropwhile-related comments in rabbit_backing_queue.
    
    For what concerns the fix in drop_expired_messages, I was wrongly generating
    acktags for dead messages not to be dead-lettered.

commit ec82e9b796ad3cbbf25289ebac8bd4b8c2f7d348
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 23 16:04:50 2012 +0100

    QuickCheck follows dropwhile API updates

commit a14b63475c52056de1d4e57e47fd9718e193f641
Merge: d1540add8 e79138700
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 23 14:30:33 2012 +0100

    Merged bug24833 into default

commit 1b43a50a13bb2e95e0f2b6cd5d5e240695d13fc5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 23 14:03:14 2012 +0100

    Increase buffer size for the port driver to match that used by the underlying socket.

commit d1540add80db0fa80a669e2d8ecb92fe0b68f91a
Merge: bf4ed6859 15a4cbf3e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 23 13:52:39 2012 +0100

    Merge heads

commit 7de434323d2c08407eb7d49e0209a5b7d0750ac8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 23 13:49:17 2012 +0100

    Reorder exception contents

commit e79138700dbb18fe6e53ea9252d67c4aac26902f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 13:26:19 2012 +0100

    fix type signature for rabbit_basic:map_headers/2

commit 0383343f92188930a1ed8c7a26705990698b45d5
Merge: 0aad61090 4b172b97b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 13:21:44 2012 +0100

    merge default

commit 2f5cd809a1e3cc743ecc19c0c7f66fb792a9dc16
Merge: f10a86087 4b172b97b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 13:17:44 2012 +0100

    merge default

commit 7289513fc89a19b794ce0e0191c7a77afb741147
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Apr 23 13:15:26 2012 +0100

    Add ulimit default file to debian package installation and source it on server start.

commit bf4ed68591c4f2d4d7dd6e63849e141d41b322c3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Apr 23 12:54:56 2012 +0100

    cosmetic

commit 79c22e245c2bf8d5388ceb94df506e05bc62a2d1
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 23 11:43:29 2012 +0100

    Move node waiting to rabbit_control.
    
    That functionality doesn't have much to do with rabbit itself (we should leave
    it undocumented).

commit 15a4cbf3e3ddd8077ca65cb0783df6e77619972a
Merge: 051c14965 5a76993e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 20 16:44:08 2012 +0100

    Merge bug24860

commit 4b172b97bc583f394d4453fedf5671c19dc27a13
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 20 13:42:32 2012 +0100

    cosmetic

commit aefeb23bc23cd8bd99e803bae0166f21d7b17f6b
Merge: 15a54373e 87a49e073
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 20 13:40:59 2012 +0100

    merge bug24882 into default

commit 15a54373e9fe0b87c3d79371ec4edf87e4c48dcf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 20 13:28:42 2012 +0100

    simplifying refactor

commit ce7ca70ce09c354973d6efca23cecd96d73a57d4
Merge: 24c18e4d3 e3ee22fec
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 18:56:44 2012 +0100

    merge bug24885

commit 24c18e4d3621efe7f2f348c0572def0509362729
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 18:55:34 2012 +0100

    Update comment for bq:dropwhile spec

commit e3ee22fecc5c582ecd45e81cc458018bdaa7dc81
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 18:51:11 2012 +0100

    Explicitly acking/not acking when calling bq:fetch in set_length in an HA slave

commit 9172b8e31f8f6d7c03508cc8849d4a13671bf937
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 18:42:40 2012 +0100

    Fix rabbit_tests - only get the state after calling bq:dropwhile.

commit 4b0c4b8d8014e0da7bd80e166134ca4a149b3feb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 17:34:28 2012 +0100

    Changed BQ:dropwhile/3 to take a boolean arg to decide wether to ack or not.
    
    I'm most likely going to change this to two different functions, the only thing
    that is holding me back is that I'll end up writing one function and then two
    wrappers around it in both instances (variable_queue and queue_master).

commit 87a49e0734d9e671fa2d755c57495ec7e438b179
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 19 17:03:12 2012 +0100

    cosmetic

commit b7943cc5e5cdbedabd6c989c684cc30abb00a849
Merge: c319147aa 9fec1a753
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 19 16:20:12 2012 +0100

    Merge bug24863 to default

commit 9fec1a7539f7c513905836b7d114f556c9a9fba2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 19 16:19:17 2012 +0100

    In general, avoid unnecessary interleaving of mutating state

commit c2cbef7186e47702d5eabc547940b931b16c28af
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 15:16:40 2012 +0100

    ack_nacked_messages -> ack_if_no_dlx

commit c319147aa3caecdcc242499d1c60a50260dd1136
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 19 14:43:41 2012 +0100

    eliminate unused var, and correct formatting

commit 6863ab004adde11fc65a5b7d9551dd6078f02100
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 19 14:14:19 2012 +0100

    Checking for existance of DLX in dead_letter_publish

commit 7e2a6d9569742393e3f63a93fdc4c60dcbf18de0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 19 14:08:07 2012 +0100

    TODO done

commit 2ee3c10053c92b3a36beb30fffd2f5930ac16ef3
Merge: 38c936a7e 051c14965
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 19 14:07:35 2012 +0100

    Merge in default

commit 38c936a7ee2a179592a0e991885858e887df8327
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 19 14:07:20 2012 +0100

    s/app_name/component/g

commit 46431087377e779f61a0478ca8e930fd42eaeafa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 19 13:28:03 2012 +0100

    Defensive programming

commit 6363b121d916793e7ac6122073e1f9c65a50a619
Merge: 1391f8cd8 051c14965
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 19 13:10:35 2012 +0100

    Merged bug24855 into default

commit 051c149653879f522625f4937df6031642346c7d
Merge: 5e34a2b37 7ec07ac11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 18 18:37:24 2012 +0100

    merge bug24874 into default

commit 7ec07ac1182078736a2eaada57040624e295f934
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 18 17:34:56 2012 +0100

    Consistency between dropwhile and internal_fetch

commit 8e28696adc573517e14412c4dc629c09c310e478
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 18 15:56:31 2012 +0100

    Re-creating bug24863 branching of default

commit ee883089b47bf5ecdaf2be37981b1aad9783e100
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 18 10:47:28 2012 +0100

    prevent badmatch in vq

commit f222e1b6eff7a6aef264a49648ea2ec17efc7732
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 17 16:37:08 2012 +0100

    Exiting when modules can't be found.

commit 23a307737d08f94e8bc2ecd92b4e1d52716456e0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 17 16:36:15 2012 +0100

    Added wait_node script to wait for the node to be up.

commit b4c15dffdfb76eb8254b78f53836e5b777d3b542
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 17 15:37:58 2012 +0100

    Only notify if the value has changed.

commit ea37a22b3883eabd7059a936adb015d11b24f2fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 17 15:13:00 2012 +0100

    Various validation tweaks: Report parse errors more nicely, don't blow up with trailing whitespace after a dot, don't blow up on bitstrings, use is_boolean().

commit 1576b49d95dc7e3f55835df4959dd0bd31c45495
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 17 14:58:46 2012 +0100

    Clean up after tests

commit 5d56d9ff1082f7a3264e5d8535568dae7a544f1b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 17 14:44:09 2012 +0100

    Moved various functions that query the status of applications from rabbit_control to rabbit_misc.

commit 5e34a2b37c661187b438bdf7105a3f9af4de72f5
Merge: 18555a6d6 14573283e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 17 12:32:11 2012 +0100

    Merge bug 24871 (as foretold in prophecy^W bug 20337 comment 199)

commit 14573283eabd42f025ceb64b533a05b80829dbf0
Merge: 558c299f5 f10a86087
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 17 11:27:37 2012 +0100

    Merge bug24729

commit 18555a6d67c1c3dd5d4261a1b6a999ab930d6f35
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 16 18:58:43 2012 +0100

    List comprehension instead of map.

commit 2d26ff6b081242243583b06429589a270b207cda
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 16 18:41:36 2012 +0100

    Fixed cycle detection, resources and names were messed up.

commit a47a068e5276ac57f8eae0e302391497829dcbca
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 16 18:10:41 2012 +0100

    Usual Makefile editing... test don't work with 'sleep 1'

commit a54314cea65d76cc00a66e788233c9b27f5b45fe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 16 18:09:57 2012 +0100

    Checking for cycles when sending instead of when receiving.
    
    This seems to be the best options and it should solve the HA problems.

commit 558c299f534bd4dc8952cd3a68be942135065ea3
Merge: 1c468a81a 0e1663efb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 16 14:17:49 2012 +0100

    Merge bug24869

commit 1c468a81a9582a809ba887ad23679791ac57745e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 16 14:17:31 2012 +0100

    eprotonosupport support.

commit 0e1663efbfc9d2e46b7efc91fda62b86fe597bbe
Merge: b38e75354 bd1a13dc8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 12 18:38:34 2012 +0100

    Merge bug24858.

commit bd1a13dc877280ad49482d7a50a2061fe4401c4e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 12 17:07:08 2012 +0100

    Cosmetic

commit b38e753545e97e96d6629db975d7acbc8cf6fedd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 12 14:55:46 2012 +0100

    oops

commit 5a76993e7d97548a2a7391bb3ff8958cf9e9f1de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 12 14:51:35 2012 +0100

    track queues which may have delivered non-autoack messages to channel
    ...so that we can ensure that acks/requeues have been seen by those
    queues during an orderly shutdown by the time a 'close' (in the error
    case) or 'close_ok' is sent.

commit 450052add389a8ab31d5bc389c02894bf87a2f79
Merge: 6ddaa8a9c ed48ba74d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 12 13:59:45 2012 +0100

    Merge bug 24769.

commit 6ddaa8a9cf63e835b37122d3894b36a2078da20e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 12 13:18:36 2012 +0100

    fix bug

commit ed48ba74d0d7dcc1373ac0da363802f5578a2f95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 12 13:06:57 2012 +0100

    tiny space saving refactor

commit f8e88471fcb40017e1649dbb5b456c67c43b4247
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 12 12:36:26 2012 +0100

    backing queue quickcheck updates for bug20337

commit f10a8608799dbc6c264f38e76dd243173777d4b8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 12 11:48:03 2012 +0100

    According to Simon the .hrl files are not worth it.

commit ff46aca6b2e8d12e7995194c7054b7e84ce82d6e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 12 11:33:27 2012 +0100

    Added dummy .hrl files so that we don't break files including them.

commit e96ccbd5c24cc1080d58c14aeaf5c8a0635c1b47
Merge: 753a15b96 79c10b52b
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Apr 12 11:08:48 2012 +0100

    Merged default

commit ada5282d9c8707e0def6f47f492f2bdcdcbfdd6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 11 22:49:16 2012 +0100

    cosmetic

commit acff980b062fd2c9e4dba2b6e0768b46d3c4f4a5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 11 22:40:19 2012 +0100

    fix a bug

commit d7a9a45126c5efa8e479817bafd340e7e8665dd5
Merge: 3509f7245 79c10b52b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 11 22:39:35 2012 +0100

    merge bug24769

commit 8b04d6a5beb3eb3167f710627bf72231fa4f073b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 11 17:44:43 2012 +0100

    cosmetic

commit 34f91555a6477b0845d400446793582afcaf0de5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 17:35:03 2012 +0100

    gb_sets:fold instead of lists:foldl.

commit 79c10b52b2cdae9e53956c17349b94d905825473
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 17:24:05 2012 +0100

    Micro-optimisation

commit 699ab20a3ff343285c883a389ce0f4e134c13f00
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 16:49:30 2012 +0100

    The "blind" difference is unsafe in 'prune'.

commit c2679fa79a9a474a103218548ca7f8602502f003
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 16:36:51 2012 +0100

    Increase the number of Erlang versions this will actually build on.

commit 23327e55def3f045e98e537fe580bca463161cd7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 16:19:58 2012 +0100

    Matthias points out that we don't need to lookup here; we will lookup later anyway...

commit 341edbc3f323d98911a7a202293ef88e3efe5d0d
Merge: 55547d6ec b14d6c214
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 16:03:54 2012 +0100

    Merge bug24862

commit b14d6c21407c994c5bf46327d09962f1e1cecc17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 15:47:39 2012 +0100

    Deduplicate routes (needed for sender routing).

commit cafc912795e31a78710fe8232bcf9bc7026cc574
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 15:17:46 2012 +0100

    Optimise routing for the default exchange.

commit f79ba0fb9e0ca1b52918798ce473e1fb2e06384a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 15:03:49 2012 +0100

    Uff, pushed Makefile change by mistake...

commit edb72f36c0816db07e946eb5ccb0df279f30f312
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 15:02:30 2012 +0100

    Removed rabbit_misc:gb_trees_difference/2.

commit c2e8484866b6277629aeaee131292e5d63d50ee5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 14:58:28 2012 +0100

    Specialised set difference function for dtree.

commit f243a5fb83b3610f7fb138805df8a4edd6a2fdb9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 14:32:39 2012 +0100

    delete_any instead of delete.

commit 55547d6ec850825c11bbde1f0af769d60e54139b
Merge: 0d781d3bb 367bb0fe0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 14:31:29 2012 +0100

    Merge bug24725.

commit 0d781d3bb86398d541eb26cf2f78787526d97c0c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 14:28:58 2012 +0100

    I initially read this as "head 2 is an optimistion of head 3, and head 4 is a different case".

commit 367bb0fe081a019e381c79cbc93d9843f04f00ff
Merge: db7f107b8 7711938a8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 11 13:58:33 2012 +0100

    Merge bug24854

commit 500424e58a18f4edeba3ce01a7935ae791bde807
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 13:35:26 2012 +0100

    Changed uses of gb_sets:difference/2 to our difference functions.

commit 9f7abfa7b80e3e01b961b748cb867b42bb9ff5cf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Apr 11 13:34:15 2012 +0100

    Added sane set and tree difference functions.

commit 7711938a8f2a279b1d64afd106f3bfb724ece927
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 10 21:26:10 2012 +0100

    cosmetic

commit 371faaed57fb9489d768c02666a3b0807c5e88ba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 10 21:19:46 2012 +0100

    optimisation: gm:broadcast earlier so other nodes can get on with work

commit 5a9edce39417f243bbfc08bd2545d1d14ac26c98
Merge: 44d12f107 b4f0c71ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 10 15:36:30 2012 +0100

    merge bug24846 into default

commit b4f0c71ffcce6e3b400942c55c42da738b5fc0bf
Merge: 0aad61090 53afb468e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 10 12:09:36 2012 +0100

    Merged bug24833 into default

commit 0aad6109003d0c45df94704d019a0704b0f92e66
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 10 10:26:13 2012 +0100

    Restore rabbit_basic:extract_headers/1

commit 44d12f1074bcb06d58fa8f979ce9afc2b515e6b2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 5 18:20:15 2012 +0100

    typo

commit 8b41e2695a7450186ad0848662d895095775c657
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 5 17:17:38 2012 +0100

    dtree API cleanup: handle 'insert' w empty secondary key list correctly

commit 17220aa99bd2fb248f5a0946591cba90f5c17226
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 14:16:24 2012 +0100

    Oops

commit 1391f8cd83970262545b4659654f8baf53d2c7c4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 5 13:53:30 2012 +0100

    Current thinking is fold should be master only. Interestingly, this also eliminates bug24854

commit bfd3a4912b06de8d51b1977602003893234ecbcb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 13:29:42 2012 +0100

    list/1 might not find anything.

commit d93fadf1a7d55bb2f705d2859052a5b488e3e7e8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 12:56:26 2012 +0100

    Callback info a la bug 24729

commit 7acdb19d99138cfe38f4f91cf7790c321c334b6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 12:41:34 2012 +0100

    Specs.

commit aced2bf037b94bce4e941d5114e155386b146eae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 12:29:17 2012 +0100

    We should validate clearing as well.

commit 836275663ab8d7e866df6f83b86c920e23c54809
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 12:16:38 2012 +0100

    Tests

commit 53afb468e8ac87998360228a2ee4726b25c6b1c6
Merge: 8e2d85a3d eb417fee8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Apr 5 11:58:17 2012 +0100

    Merged bug24833 into default

commit 1c0b948a2e25331da78ee0e9948e6fe47dd3eafe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 11:48:56 2012 +0100

    In case we just have a single error

commit 1c69dae9fc7a122e3b0471afd5a95bfd37517762
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 5 11:45:37 2012 +0100

    Base validation on returning error tuples rather than existing; thus report all errors (for a given pass) rather than the first error we see.

commit 3b4821e0853cdee5cad94279dd3544f39cab701c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 5 11:32:24 2012 +0100

    refactor: shrink

commit 638b6b4077367205469e32ac7e35073a6ff4c040
Merge: b35358608 8e2d85a3d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 5 08:33:32 2012 +0100

    merge default into bug24725

commit db7f107b83eda5d258cccdf1a36be60b92881e42
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Apr 4 18:10:28 2012 +0100

    Whoopsy.

commit b25b3af939f9a98d3dcbd77b9349f51b36df2514
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 4 17:45:43 2012 +0100

    better(?) dtree docs

commit 8e2d85a3df211648dbde26dcc5f319bd04031e03
Merge: d69bfdaa5 187190e9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 4 13:30:58 2012 +0100

    Merge bug24789

commit 7bcc4d43ecf2161555363c358f4c45c438fbedb9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 3 20:15:36 2012 +0100

    revise nack handling in queue (for dlx)
    - with the changes introduced in bug 24750, the "lost" message count
      logged was misleading since it would not include any messages still
      pending confirmation from other queues. Fix that.
    - normal queue terminations are not log worthy
    - splitting log information across two entries loses context,
      i.e. other log entries might appear inbetween. So now we collate all
      the information into a single log entry.
    - saying that messages were "lost" is misleading - we simply don't
      know what happened to them. Make this clear(er).

commit 8000d9885725e220ea006c332dbcea028cad96d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 3 18:40:40 2012 +0100

    fix nack handling in channel
    When a queue dies abnormally we nack all messages sent to that queue
    and still pending confirms. Any confirms coming in for these messages
    thereafter - from other queues - are ignored.

commit dada89db1746161c7e299c5602a6f3ffa5bc9c0d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 3 17:32:03 2012 +0100

    make dtree:take/3 cope with absent keys

commit eb417fee83596c5ad26ab6190b677c9d41ed3675
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 3 16:05:24 2012 +0100

    Fix in map_headers.

commit 0c9e2fa891b44901dd89593d92840f526258dd07
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 3 14:49:44 2012 +0100

    rabbitmqctl docs. Rather generic...

commit b01ca0c1e8ddcfeba8ecfc615d582b1c8caf202f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 3 14:18:54 2012 +0100

    I think those make more sense there.

commit ec02cf0fd0dd40d213e14bfb2928f6c5ddf258c7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 3 14:05:32 2012 +0100

    Pushed a change to the Makefile by mistake.

commit 395e10ce96708b2a6e3ba3d1fc28289d8ef73e8d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Apr 3 14:04:25 2012 +0100

    map_headers instead of {extract, replace}_headers.
    
    Sadly the final value of the headers depends on whether we have a DLX routing
    key or not, so the code in rabbit_amqqueue_process:make_dead_letter_msg/4 is
    slightly ugly. I still think it's better to keep rabbit_basic:map_headers/2
    general.

commit 187190e9f774bcc6e4f1e0d6c89bf866804db965
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 3 13:35:23 2012 +0100

    Don't invoke userdel

commit d69bfdaa5789e70b9fb2a43558e671358d8b7789
Merge: af70d5a5e d92a974fd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 3 12:24:26 2012 +0100

    merge bug24845 into default

commit d92a974fd5892154db2b49ffe17fb3dd38d502dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 3 12:20:54 2012 +0100

    do not confirm 'immediate' messages that failed to be delivered
    in particular non-persistent messages were always being confirmed
    regardless

commit af70d5a5e3650c2b6f597d9f55d319d9965c8787
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 22:49:15 2012 +0100

    refactor queue's confirm handling on publish
    I think it's a bit clearer this way

commit b3535860829a1d2e26f3cb0b70069db1abb98e2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 19:30:41 2012 +0100

    handle confirms and dlx
    When a dlx is configured we fall back to the normal
    go-via-the-backing-queue route since the dlx logic assumes that any
    dead-lettered message is present in the bq. Indeed the bq is the only
    place in which such messages are kept until they have been confirmed
    by the dead-letter destinations.

commit 856348b89f0ad31f569bc13990bee93f3ffe4bfb
Merge: fd0b3c962 22e42f97b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 18:29:05 2012 +0100

    merge default into bug24725

commit 753a15b96b2e41d4c5ad5bfa94f53c72b779819d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 18:02:10 2012 +0100

    Added callback info for rabbit_backing_queue.
    
    There is a problem: I can't parametrise the callbacks by the ack() and
    state() type - before this problem was "solved" by including the .hrl
    file that relied on those types being defined.

commit 22e42f97bff785d420744c80063b19d5e7439b4a
Merge: 873de93ca d262eaf82
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 17:59:30 2012 +0100

    merge bug24843 into default

commit 873de93caeeb2c5cdba26de755b3e153242eb979
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 17:59:05 2012 +0100

    fix a race

commit d262eaf822d1eac3c226a9cf28b1fc2098bc513c
Merge: 81d6fedfb f281ea9dc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 17:25:40 2012 +0100

    merge bug24842 into default

commit f281ea9dc16b679c85ba7aaed0657b1e83472fbf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Apr 2 17:25:14 2012 +0100

    fix cluster tests to work again in single-node case

commit e487f00d975bb833c2763af5d5116b1e4df79e22
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 17:09:58 2012 +0100

    Added callback info to rabbit_msg_store.

commit fd494df8dd598c0b61055c2a951a510681e7e232
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 16:50:55 2012 +0100

    Added callback info to mirrored_supervisor.

commit d4a3c5a502910ebb7a6e79ad573de4762e75fa70
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 16:37:08 2012 +0100

    Added callback info to supervisor2.

commit 735b9004facf1963c468685bef3648acdb3bbdb2
Merge: b6b89462f daf73ed81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 2 15:23:01 2012 +0100

    Merge in default via bug24196

commit b6b89462fca1b7723831e7884f1aa28d4b8efe05
Merge: 81d6fedfb 1d9fae81b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 2 15:22:40 2012 +0100

    Merge in default

commit 81d6fedfbf64b5141a4e0d9f7f0dff18d89d860c
Merge: c49f49b27 85dd778d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 2 15:00:33 2012 +0100

    Merge bug24808.

commit c2817c3203afbef6e8253e0a65d55dc8110653fa
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 14:24:58 2012 +0100

    Moved behaviour_info/1 export in the same ifdef block

commit 85dd778d974c73d70950c773bf8c944d04af0fc2
Merge: 6e5e46620 0d056295f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 2 14:23:38 2012 +0100

    Merge bug24750.

commit 0d056295fd288e22e8862a5a9a060e270bdf2b6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 2 14:23:10 2012 +0100

    Attempt to flesh out the essay slightly more.

commit f507df98f134401eb6519dc2c82289b73eb5ebf5
Merge: 6e5e46620 33f0fe966
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Apr 2 13:43:19 2012 +0100

    Merged default.

commit 6e5e466200225670927e51076e9cce56e436e908
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Mar 30 12:25:01 2012 +0100

    Typo in rabbitmqctl man page

commit 24066e9fcfdc0a7abd403bd62cf9e4c3665f8b6f
Merge: 9e014251a 4738013b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 17:43:13 2012 +0100

    Merge bug 23463

commit 4738013b9229e2aeb9622974b12e8707fca40ad8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 17:37:15 2012 +0100

    1.0 is less of a magic number than 1.8.

commit d4e8acb8122e333f422b33cde5d0de3f9c52ded1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 17:36:36 2012 +0100

    We don't need this any more, just inform the registree once.

commit 4d74132dbc541067b2b372b4f64175c17c648871
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 17:06:57 2012 +0100

    Resurrect branch, and fix spelling.

commit 2b3d3bf82aa903d5ee84ec3a99bf75c8fdb4f468
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 16:53:08 2012 +0100

    AHEM

commit 8fde3f574106ae30e6936036403dd7c0e362d31f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 16:25:48 2012 +0100

    Minimise difference from default

commit 044198713159bdc3bb955837220de882baf8913a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 29 16:16:40 2012 +0100

    Revert odd change

commit 06c7b26cc5cda66422d38e9e61c5f1a822e67361
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 29 13:34:32 2012 +0100

    Better platform support detection for disk free space check

commit 9e014251aeef165f1bdc1acb2a6ffd0dbd8262ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 28 22:58:09 2012 +0100

    cosmetic

commit daf73ed81abc0300f9397783695b6f212daec7f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 28 17:42:07 2012 +0100

    Rough sketch of exchange decorator concept.

commit fd0b3c9623ee9e97178a98c93b67bdda48ad4ee3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 28 15:36:36 2012 +0100

    permit x-message-ttl=0, and optimise that case

commit 28157224989b3d8c5d8dd1ee9e340ff7980cf53e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 28 15:36:34 2012 +0100

    Separate alarm from disk monitor and disk free status reporting

commit 1d9fae81b6b36986592fd8c0cfed84ed21792dea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 28 15:10:20 2012 +0100

    Consistency

commit 3bb80f82d73ebd9df3031171b50dd142dbb68bbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 28 14:22:52 2012 +0100

    refactor: extract undefined-ness check

commit 7900e65cf89fc9c28cbef3f1454a1ef61584c94f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 28 13:53:58 2012 +0100

    cosmetic(ish): shorten arg check fun names and make them more meaningful

commit 82a85e8657026778bc176415814f7f11a95428a4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 28 11:22:46 2012 +0100

    Language

commit 5fcb0ba694c7b1730505a586839183024513e955
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 28 11:14:58 2012 +0100

    Alert remote and local alarm subscribers differently

commit d71abc5236bd788406f6a4cbc53c382f00b7f801
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 28 10:59:46 2012 +0100

    Remove rabbitmqctl disk free features

commit 947b91d08487476fbf8403f3f09350ef569b117e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 27 20:59:13 2012 +0100

    cosmetic

commit 796400da8cbeb961475e6cec701d70ee10895785
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 27 20:55:53 2012 +0100

    cosmetic: don't rely on Erlang term order to catch type errors

commit 4be7f5865d112d929a6e9bb2c1babdf27f2ead8c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 27 20:18:36 2012 +0100

    correct spec for BQ:dropwhile

commit 6aaa3c97ed7030dabd9a62419fe6db4b1fb56ded
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 27 16:10:22 2012 +0100

    AppName and Key should both be binary.

commit b5ce963304053d70a6f32d215cbbdd0944c79ae6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 27 15:46:40 2012 +0100

    Notify when things are cleared.

commit a2ae21f150eea8418cbcae3ae5110794756811e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 27 15:37:32 2012 +0100

    More API

commit d921ad17ea24a4a042e46eb20710fc1a76e0db0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 27 15:17:16 2012 +0100

    API tweak

commit 799eee63e19fa4313125ea4c02c524a924ad6205
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 27 13:20:01 2012 +0100

    A few more APIs useful for mgmt. Make proplist keys always have to be binaries.

commit 6ba99d5beaec247be531f03985f5226b2ee0cef6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 18:25:34 2012 +0100

    Rearrange for mgmt.

commit 780a31e3dd4c911a62d9887b0f32840462de92bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 17:57:00 2012 +0100

    Rename cluster config to runtime parameters.

commit 82a72b631585eaa7f3e9dd35b0e1bff1e84c5e6c
Merge: f8460be37 362cec19c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 17:12:41 2012 +0100

    Merge bug24764

commit 362cec19c8c33909d889be85b3a0969646480552
Merge: 9fbac3688 8640c6ed1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 16:59:00 2012 +0100

    Merge bug23610

commit 8640c6ed1e2821b809677341c643633e5b79c51b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 16:58:43 2012 +0100

    Cosmetic

commit 9fbac368837f91327c24532d14667d3857cf90c3
Merge: b617e4f99 5cf7a0445
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 16:02:55 2012 +0100

    Merge bug24728

commit 5cf7a0445de22aae001a8aa3a2c07014e5f7b518
Merge: 9a1bbd407 6e3de8dc7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 26 16:00:32 2012 +0100

    Merge bug24827

commit 10ddeb509b3eedd66f2da0beacbf36ece7393577
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 13:24:48 2012 +0100

    Wrap long lines

commit f6d9f7d47f7ed534382789ec42612e40d47911e4
Merge: 41c63bda8 df44a0dc9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 11:41:30 2012 +0100

    Merge heads

commit 41c63bda8acf97fa9a6ee4dc8507a962ca913755
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 11:18:31 2012 +0100

    Remove rabbit dependencies

commit b5ecf2c371d3dd6c7308192d9bb353fbe37aed42
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 11:04:39 2012 +0100

    Rename disk_monitor

commit df44a0dc98e591e1c92863264d925d4f8a3e844f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 10:49:26 2012 +0100

    Disk free checking updates
    
     - add to status output
     - check supported platforms

commit 6ab62ffea8d2a79386defc6aef5379ab99bb4978
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 26 10:36:10 2012 +0100

    Generalise memory alarm

commit 6e3de8dc7ae78eedf9e05a130262d96108c00359
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 22:21:15 2012 +0000

    ensure appropriate expiry of immediately delivered messages

commit 9a1bbd407d597274b0889c2d39990ef84d6a9a3f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 19:24:36 2012 +0000

    cosmetic

commit efc555659702b3b9ff858bd119a1fd78d476a225
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 19:14:58 2012 +0000

    refactor/optimise 'reject'

commit fc853e94a462b75dad5d90456c1ba03b71865c9a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 18:51:38 2012 +0000

    cosmetic

commit f2a36056915621667b0608ad7369a9518a02a7b8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 23 17:45:23 2012 +0000

    rabbitmqctl doc tweak

commit d4e9e4fbdcd0b807487070adb31ca197fe8313b9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 23 17:04:18 2012 +0000

    Disk free limit setting with rabbitmqctl

commit 3509f72455ad8ad9486eb710d75b1e4f5e738f00
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 15:03:08 2012 +0000

    don't check the return of credit_flow:{peer_down,ack}
    we don't do this anywhere else

commit a3114513fae53a8261a2d72f1fa0c54bded4ad28
Merge: 45df15468 3567459a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 15:01:41 2012 +0000

    merge default into bug24769

commit 45df15468ec057c51931ca0dca5c102d02da5c46
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 15:01:04 2012 +0000

    make the return value match the spec
    fortunately no call sites were actually checking this

commit 3567459a49f40210dbc8507fb0d1e91b7af6f09e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 14:39:30 2012 +0000

    correct return value of rabbit_amqqueue:delete_immediately/1
    ...and be more assertive

commit 8f25204f353b651e6b856b3aaba6dd4fef3b6fc8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 14:11:47 2012 +0000

    monitor queue senders with pmon
    ...which simplifies the pmon API and the mirror slave promotion

commit ea0439d1886f187ab7d1593cc5dfebf72753b96c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 13:10:21 2012 +0000

    use pmon in mirror_queue_slave

commit e0357983739240a39c2a1ffea2b5033a57ead7fb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Mar 23 12:45:43 2012 +0000

    Logging and types for setting disk free limit

commit 714023885da25ac727c58bc6346b89330f80b7ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 11:29:30 2012 +0000

    use pmon in queue_coordinator

commit bd4b6cd7f5f84c19f125acc2eb8f04ba0f8cd730
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 11:26:10 2012 +0000

    use pmon in queue_collector
    this required a tweak to the amqqueue API - making
    delete_immediately/1 take a list of qpids rather than a single
    #amqqueue record.

commit 0c2f69b0b847f4d99bf1b641ee8d2cd3cb2569b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 23 11:24:14 2012 +0000

    I keep forgetting the trailing ".".

commit fb11a2b39ff24c9dd2cfcb055b65dd05b1ee1b29
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 23 11:15:26 2012 +0000

    null is in JSON, we should allow that too.

commit d7b3c452ff5f2f0989de3cb5e330b660f3a7643b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 11:05:27 2012 +0000

    use pmon in rabbit_channel

commit 7eae68ac5add562edb07951055bfb0be33cd13c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 10:56:50 2012 +0000

    use pmon in amqqueue_process

commit e9ae5eeb0b90c5b0f3ac0782b8547f2458137022
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 23 10:56:24 2012 +0000

    first cut of helper module for keeping track of process monitors

commit 8cac9c46186570f0aaa0aa17a497a6affd36cc33
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 22 18:05:20 2012 +0000

    First draft of disk space monitoring

commit 75ed81b116b597750ee8b80606a010c62ca06f08
Merge: 7b5311a1b 63aacdfd7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 17:12:31 2012 +0000

    Merge heads, again!

commit 63aacdfd7e7503f802d4470eae522360dae2736d
Merge: 0b039a983 8d12768a5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 17:10:49 2012 +0000

    merge heads

commit 7b5311a1b1224f705aaa2241311bf86e6bf01971
Merge: 0b039a983 8d12768a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 17:09:33 2012 +0000

    Merge heads

commit 8d12768a5b45b53f17e2f3248e0c3f0d3f0931ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 17:08:10 2012 +0000

    fix spec

commit 8ab18090d491211f9afa66e178fcd5abd329aad8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 17:01:22 2012 +0000

    erhm. it helps to actually add this.

commit 45851faf8067ad72044ea566136453ac2cde06e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 16:29:18 2012 +0000

    convert channel to use new dtree data structure for confirm tracking

commit 4e5fbd136b9b9b077d054fbe030283f3a023f327
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 16:07:52 2012 +0000

    Added tag rabbitmq_v2_8_1 for changeset 99239db7a754

commit 00d500742807c40947f32d7ea365e531310a242b
Merge: 0b039a983 bdef81f97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:47:53 2012 +0000

    merge default into bug24750

commit 0b039a983d28cc0aed2a47e0eb470a91fdcc424b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:47:13 2012 +0000

    cosmetic

commit bdef81f97ee0f2d86583d93cbe943df25017244b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:37:34 2012 +0000

    get rid of rabbit_misc:gb_trees_set_insert/3

commit 9f0615a1334535e81f4c629400bc0b5e1705aa7b
Merge: 377269f58 ad4b4243d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:32:06 2012 +0000

    merge default into bug24750

commit ae1a7e4f751fe1b023f50453ea15eb55576609cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 15:21:43 2012 +0000

    Allow string keys, format the results for listing.

commit 377269f581c42b7d84c76303be0e026686cee75e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:20:39 2012 +0000

    consistency

commit 7f18e6756b3a180349065ba23ebedf2c484a4f2d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:19:48 2012 +0000

    cosmetic: log queue name with rabbit_misc:rs/1, like everywhere else

commit 9506c29260675298a13a7bc73567e61c8f1b0b2b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:15:56 2012 +0000

    fix a possible leak
    it's not clear whether we can actually end up in the 'none' branch,
    but assuming it exists for a reason, we should certainly clear the
    dict entry there too.
    
    We don't actually need to clear the entry in the {value, ...} branch,
    since handle_confirm will do that. But clearing in all cases is more
    obviously correct.

commit ad4b4243dd021b1de1b9b5870594673ece7691df
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 15:09:16 2012 +0000

    convert the queue to use dtree for confirm tracking

commit d32586f256e3c1d2e498805d92ed247396397d41
Merge: b59948ce9 b73abaf0b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 22 14:03:37 2012 +0000

    Merged bug24809 into default

commit b73abaf0b6535213b1b69e5ce33e6cd5c203d490
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 22 12:51:50 2012 +0000

    Rollback startup method for SuSE only

commit b59948ce98388fbe80eeb8981361874fc5d6882a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 22 12:11:58 2012 +0000

    Accomodate a desire to avoid polluting the logs

commit 78972a682d9409fe17d8896458eb5174eb4997f7
Merge: 8246067ef 75fd2501f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 11:03:54 2012 +0000

    Merge bug24816.

commit be83ef7aa6e6a4b91837083a1441cb89ec46b8f9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 22 10:49:38 2012 +0000

    first cut of new data structure for confirm handling

commit 8246067ef4cb33b39cbffe865c2d9916f89237d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 22 10:49:18 2012 +0000

    Package all bat files.

commit c49f49b27f6309cb768290a753779ce6731c297a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 22 10:38:56 2012 +0000

    Update debian control file fields

commit 75fd2501f5afa3bff9387a3e3a2eda4813821422
Merge: 30405c2c5 e21831f99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 19:08:48 2012 +0000

    Merge bug24810 again again.

commit e21831f996ea517bb35aac8103ea014d80f47d9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 19:06:23 2012 +0000

    So we actually need to handle the case of starting from scratch separately, otherwise we never write out the version file, with fun consequences.

commit 753c485a48d8f8a6ac3ebf391ad025f52750e7e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 18:11:06 2012 +0000

    lookup/3.

commit a32778828783ff861092e5615dcfb9377c3d0c01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 17:25:55 2012 +0000

    Notify

commit 4d6493406ad6c98a3bd3c0a22a898deeb16f1b21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 16:38:29 2012 +0000

    Generic validation.

commit 30405c2c5296dd2685ff4bf6d31328b1a935e947
Merge: a62996f63 7b71672e6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 21 16:17:08 2012 +0000

    Merged bug24810 into default

commit 7b71672e6ce6ac0c3d06d8f41020177c71c55d74
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 14:59:10 2012 +0000

    It's possible somehow we could be left with an empty mnesia directory (spotted with "make cleandb" but maybe other things could do this). So instead check for the existence of the guid serial, which has not changed since at least 1.7.0.

commit 975806ecba5d876da65b8faeac8ed6194bcf75f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 21 14:07:04 2012 +0000

    If don't even have an mnesia dir yet, treat that as meaning "no upgrades needed" rather than "upgrades are impossible"

commit a62996f630712470d9c3a91cc86bbc5974ca4ec8
Merge: bcf82b2bb 680f65595
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 21 13:24:46 2012 +0000

    Merging bug24774 to default

commit bcf82b2bbb475940b24557c7f227ef6d495b4d21
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 21 13:23:25 2012 +0000

    And if an {intrinsic, Delay} child exits normally/shutdown, remember to really exit the supervisor.

commit 5b6410ac7aacf1d1bb9ae3d9df5a30f7d45a66cf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 21 13:17:52 2012 +0000

    Some cosmetics; Some consistency of ordering; There is no good reason why delayed restart shouldn't also support intrinsic. Added.

commit 9d8fd520da3572e0f209f896ce5fbac0eea8d19b
Author: Ivan Dyachkov <ivan.dyachkov@klarna.com>
Date:   Wed Mar 21 12:58:44 2012 +0000

    Apply supplied patch to support normal/shutdown termination of delayed restart children

commit 680f6559575b14b0e36237605f44c2b525a18c40
Merge: 6e8c7da43 5f424ad41
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Mar 21 10:34:10 2012 +0000

    Merged bug24810 into default

commit b617e4f997c76982e646e929edbc5c5fb3dbacc8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 20 23:44:05 2012 +0000

    use monitors instead of links to watch over net_adm:names/1 calls
    thus eliminating the need to trap exits, which can interfere with the
    calling process, and dangling 'EXIT' messages in the mailbox.

commit f8460be3713ae7e35d0c0794d8c13d43cbaa414d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 20 16:13:43 2012 +0000

    reduce number of system calls by batching socket writes

commit 6e8c7da43ef4ab467d12609dfe756ae443122e62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 20 15:04:59 2012 +0000

    Look for cluster nodes in Mnesia's view of the world (in case we are a disc node) and the config file (in case we are a ram node)

commit c8f5d083b31f2d2c34877d26217d129616115be2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 19 18:19:22 2012 +0000

    Some pluggable validation thing.

commit ebfda646338ac6ed2feec633d58eb3f98b14c9f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 19 18:00:02 2012 +0000

    Simple CRUD for config-y Erlang terms

commit 5f424ad41584ac491c8ce84db404e5a5f21635e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 19 11:34:30 2012 +0000

    Added tag rabbitmq_v2_8_0 for changeset 152dab3f6974

commit ce0f160f2d47e218395c42b9b44d2ef9cf8022af
Merge: a1f2f13d3 56b988339
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 15 16:56:44 2012 +0000

    Merged bug24794 into default

commit 56b9883390e2751a287a730de4eab7df5ff86586
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 15 16:31:48 2012 +0000

    Simple test for multi call - and reverse the lists so they come out the same order they went in.

commit 44ec6f212e61cad22e19e60528116b7f441a3a3c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 15 11:59:37 2012 +0000

    Slightly nicer to use a -define().

commit a66c1d8e5fff92f2466ba37b7aa0b55d70663cf3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 14 17:26:57 2012 +0000

    Comment

commit 2c54d455ba5b2febdab7d1ade543a7a8d699531c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 14 17:23:53 2012 +0000

    Only sleep as much as we need, and tail recurse properly.

commit eddfe7919c5143ab7022dce28768549d3ec39325
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 14 17:20:35 2012 +0000

    Hush, little dialyzer, don't cry.

commit aba018952747eb170cb5ef55e3429416ca0295c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 14 17:10:58 2012 +0000

    Scatter-gather.

commit 37274b07deaee75d194283c944533a333712e05d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 14 16:24:25 2012 +0000

    This fixes the bug, but it does not scatter-gather, which would certainly be nice...

commit a1f2f13d38ae5c773fbc72bca0ad13993463b2bf
Merge: 0679d68cc f1cf8fdf2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 8 11:54:56 2012 +0000

    Merge bug24614

commit 0679d68cc450f95234abd74662cfe61f5b3602a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 8 11:54:05 2012 +0000

    Not needed.

commit f1cf8fdf2d712a0e9f2dcb77c114d2849412709f
Merge: 7c86aad8a 6ea59fd9a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 7 17:46:51 2012 +0000

    Merge bug24779

commit 6ea59fd9a71e770bd5e4a2c327e452e0084e4489
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 7 17:32:55 2012 +0000

    Let it crash...

commit 1d31f5315c7569e63ac42d1e8be72557f385f45b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 7 16:05:56 2012 +0000

    Ahem.

commit d34eeca3f451601d59f429acdd850caa43fdb772
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 7 15:42:25 2012 +0000

    Try to close the socket immediately on reader death.

commit 7c86aad8a193a3e008c6036e18bf751ed076c9bf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 6 17:35:24 2012 +0000

    Add to qi the equivalent of msg_store_file:scan and rework a specialised walker so that it makes use of the generalised one. This is exported so that it can be used elsewhere.

commit 33f0fe96678cac4c4114e825d1627db3384802a3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Mar 5 18:55:21 2012 +0000

    Added -callbacks for rabbit_auth_mechanism.

commit 82f9e3ef6024ef7c230b0896ea5393df72c9345e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Mar 5 18:46:38 2012 +0000

    Added -callbacks for rabbit_auth_backend.

commit 1ad2258a20d24eda769219763d59b335407045b4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Mar 5 18:38:17 2012 +0000

    Added -callbacks for rabbit_exchange_type. Deleted rabbit_exchange_type_spec.hrl.
    
    rabbit_exchange_type_invalid doesn't typecheck (rightfully), we need to
    change the type signature to remove the warning, but that's ugly...

commit 525e498c466112ab9a2dca18e74173bda61ef90c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 5 17:47:48 2012 +0000

    cosmetic, plus report Pid instead of {ok, Pid}

commit a27ec7d8268f0e4b1ac9778f887db8d7eb22ac1d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Mar 5 16:18:50 2012 +0000

    Added specs for gm callbacks.

commit 42b19d8c4ea7280c1ac63897648ef9565018ded5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Mon Mar 5 15:34:38 2012 +0000

    -callbacks for gen_server2. USE_SPECS now requires R15B.

commit fc2bedb2824ccb8161b57fcb04a2224a0fa190ab
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Mar 5 14:26:26 2012 +0000

    Make RedHat/Fedora use runuser to start the service

commit 2aad682d5813336828a2585dd243d40c391b42ab
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Mar 5 11:42:23 2012 +0000

    Reduce changes and preserve atomicity of redirection files

commit b6d1a50efa00f523083b4fbe030716abc7163e18
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Mar 5 11:01:55 2012 +0000

    Modify packaging for Debian to use start-stop-daemon

commit 89ffa42234b0922693e10a84acf3af2ad5579315
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Sun Mar 4 17:36:18 2012 +0000

    Notifying queue deletion in rabbit_amqqueue:on_node_down/1

commit df797cb2a8acdd8a7840b65bae746ef9c07833c0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Sun Mar 4 13:51:28 2012 +0000

    Notifying queue deletion in rabbit_amqqueue:internal_delete/2.

commit ac114c61b2bb8585c058a048adf2ae1ffc6a37ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 2 08:51:10 2012 +0000

    cosmetic

commit 81311106a434a25f9eb007aabc707a9986bf260c
Merge: c43939831 8b642dfe0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 15:36:43 2012 +0000

    Merge bug 24768

commit c43939831fdfec64af61631cc3e67195fe46e3cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 15:34:15 2012 +0000

    In fact, let's not call handle_ch_down in the case where we get a 'DOWN' while waiting to stop.

commit d4435a0928bcb80272131312f8b4a9c87cd449a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 15:11:22 2012 +0000

    And a comment

commit 82261daa7bdbac32987d343a558a0af453ba8e14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 15:09:37 2012 +0000

    Actually be slightly more minimal about what we move.

commit e3865e504c09961d77e25e87e0944a4145a90bb4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 14:59:17 2012 +0000

    Don't throw away 'DOWN' in delayed_stop.

commit 8b642dfe0c59265b9d78daf84ce20249dedb7594
Merge: 90dc5d678 1715ef085
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 12:33:10 2012 +0000

    Merge bug 22961

commit 1715ef085a13146633778d3fba727a6934831b11
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 1 11:59:18 2012 +0000

    Correct strange language, M-q

commit 90dc5d67806212b17f15438a28e7e5db16bb1952
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 29 17:21:48 2012 +0000

    Copy the error_string concept from ctl, in order to never format a string with ~p.

commit 06a504b3e2f2e7f5d81ebda0d5e1d193c7f76fc4
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 29 16:36:58 2012 +0000

    ….and make it executable again :-(

commit 2c623ca96968267511080c3f096545688e09d417
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 29 16:33:23 2012 +0000

    OK, several goes at getting this right  :-(

commit 9dc074d6838a077e20a6e533f7bada1cc4f2a805
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 29 15:15:46 2012 +0000

    Remove check -- hmm, that means the generic-unix rabbitmq-defaults can be created by the build step

commit b50cd3e80dd22af36ed209a7ece12290a9a8cb31
Merge: 4435c7482 5771884a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 29 15:07:50 2012 +0000

    Merge bug24558

commit 5771884a66b9b8343b8ab11217a7b6049f321225
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 29 14:33:09 2012 +0000

    Missing spec

commit 7c30fae1881216f549ec9f9d2e1ea26603d489f7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 29 13:38:01 2012 +0000

    Assert in timeout, better sync comment, changed naming of needs_index_sync.

commit fc8e9055aaa79974c87e595bf4bf1634d843b161
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Feb 28 13:14:51 2012 +0000

    Adjust message

commit 4435c748294379add22aca9e3ee7273113daee18
Merge: 168c06030 5e78aacf5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 28 12:29:37 2012 +0000

    merge bug24650 into default (Move names for connections and channels from mgmt to broker)

commit 5e78aacf560b504834559e7e2b5a1fc9118983bd
Merge: cbe615d79 3092e2760
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 28 11:43:08 2012 +0000

    Merge bug20337

commit cbe615d79202e46850eff6de85359159bb101e87
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 28 11:08:18 2012 +0000

    that function doesn't return errors

commit 2bbd4c6060944433ebe4ca87d2823e9cce1147ac
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Feb 28 10:56:15 2012 +0000

    Move SERVER_ERL_ARGS to rabbitmq-env and renamed rabbitmq-sys-defaults to rabbitmq-defaults

commit b35c92000e9e26429312c9a2b0209dd34b3761d6
Merge: 9c6e308a6 3092e2760
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Feb 28 10:34:48 2012 +0000

    Merge default in

commit 8e3abb2016756689b03d423e62585926d71a9c93
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 28 10:31:15 2012 +0000

    re-order arguments to BQ:fold to look more like an Erlang fold

commit f6da4265a1b8ee4ad561e8b5f5086c91530d6430
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 27 17:57:08 2012 +0000

    Rename process_messages to fold.

commit ae0bfcaba99b9d9af7daafee8b658d5d3fb314c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 27 17:40:55 2012 +0000

    Extract some header-munging functions into rabbit_basic (not sure that's the best place, but rabbit_misc is already overflowing and rabbit_headers did not seem justified).

commit 3092e2760af67be6634888dfec61e461ce8d6d28
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 27 16:26:18 2012 +0000

    typos in (old) debian packaging doc

commit d10dd65d2fd20ea7feb61d4328962993e99a9084
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 27 14:52:07 2012 +0000

    Cosmetic

commit f59845ff7fc9faf76e3b1f213d15cd0d36933ea3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 27 10:32:31 2012 +0000

    add missing argument to BQ:process_messages

commit 7130cf757781c333b1394b3868f1c2d031eaa503
Merge: 1b946de5e 3f32ff3ef
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 27 07:00:20 2012 +0000

    merge default into bug20337

commit 1b946de5eb1f2aacb4d0d2e17a911fd03c8b1cba
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 27 06:51:49 2012 +0000

    get rid of DLX warnings
    
    Also fix a wrong match in a case.

commit 3f32ff3eff4206171f237b4b102b26bfde7a2614
Merge: c7868218b fbf94610e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Feb 26 17:21:31 2012 +0000

    merge heads

commit 264461b43e49c24c84d92ee767af0696318a4fcb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 17:10:12 2012 +0000

    don't remove DLX when not found
    
    The warnings now looks like this:
    
    =WARNING REPORT==== 24-Feb-2012::17:06:55 ===
    Dead-letter-exchange <<"dead.letter.exchange">> for queue
    <<"test.queue.dead.letter">> does not exist.  Disabling DLX for this queue.
    
    =WARNING REPORT==== 24-Feb-2012::17:06:55 ===
    Dead-letter-exchange <<"dead.letter.exchange">> for queue
    <<"test.queue.dead.letter">> is back.  DLX works again for this queue.
    
    Again, only the first message causes a warning.

commit 84f12e7eb0397c761d88282a39a7a4be17b1d5b6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 15:43:11 2012 +0000

    add missing head

commit 168c060308e2ccdba8ef6f8e06fe2e87400bc3b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 24 13:50:26 2012 +0000

    Marginally tidier

commit 93ca3857e92e73f0e1fbfe8e83fd6f76f22b3425
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 13:10:40 2012 +0000

    rename the weird VQ:ack/3 head to VQ:process_messages/3

commit fbf94610e3d09c67d53f10d6129a1734577594f0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 24 12:53:43 2012 +0000

    fix hidden bug in config file listing
    see docs for init:get_argument/1 - a single "-config <file>" argument
    comes back as [[<file>]], multiple come back as [[<file>], ...]. The
    reason the previous code worked is that the functions in 'filename'
    accept deep lists.
    NB: we are not handling the case of "-config <file> <file> ...", but
    then neither does the application_controller, and th docs for 'erl'
    only mention a single file.

commit 948082ce50fbaaa204f1f4337568390a822590a9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 12:19:29 2012 +0000

    dead-lettering to a deleted exchange outputs an error and disables dead-lettering for that queue
    
    =WARNING REPORT==== 24-Feb-2012::12:17:18 ===
    Dead-letter-exchange <<"dead.letter.exchange">> for queue
    <<"test.queue.dead.letter">> does not exist.  Disabling DLX for this queue.

commit 9c6e308a602d1cdb621c89984fb0c4fa693fb83e
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 24 12:18:31 2012 +0000

    Missed a reference

commit 19bd34400716e57f79301f02b4ec7097ecfbfabb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 24 11:26:16 2012 +0000

    cosmetic: make spec order match export/definition order
    ...and introduce a useful type alias

commit 8f931704288ff3a926d4711a5c9bc3cdc9dc626d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 11:21:35 2012 +0000

    add type for header_routes

commit 3d9667e5c6f4565a233ff9b242f9583e4e887311
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 24 11:19:00 2012 +0000

    Get generic-unix sys-defaults to check for global locations
    (and rename rabbitmq-locations to rabbitmq-sys-defaults).

commit 22ca9724cc6f5b1d4b4ba6e102bf52ddb2dde1a7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 24 11:16:49 2012 +0000

    refactor amqqueue argument checking

commit c7868218b29e214f5b0e4196aaf154eda9668496
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 24 10:55:19 2012 +0000

    Also, spelling

commit 44e8494f6051d4a00519a75e553a0bf941858d0d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 24 10:54:12 2012 +0000

    You don't need a fractional part and it can be greater than 1.0. Also, M-q.

commit 9c57bdf81f336be9ed79f61e92efc982490d52e3
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 24 10:10:05 2012 +0000

    Rename rabbitmq-sys to rabbitmq-locations

commit c42e8d431872d99787c27aedeb7fed10519269aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 23 16:40:10 2012 +0000

    Channel names.

commit 122fbb80c5c56980966860d6eeec4fdd6b2abdee
Merge: 2725b8ce0 399867cfd
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Feb 23 15:26:15 2012 +0000

    Merge bug24182 into default

commit b36b50b90174d3ec34a5bfdbf5b21f9cf3d68879
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 23 12:56:58 2012 +0000

    rename a function

commit 2725b8ce01c2636ac6fbfe375d1c936653363d8e
Merge: 56f4ccba3 4230ebb9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 23 12:43:54 2012 +0000

    Merge bug24482

commit 56f4ccba310376979e4a59028ef710383d6dd04f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 23 12:42:21 2012 +0000

    M-q and explain windows v unix.

commit 2083e9accd12f547d4bec8ed98d981cee4032028
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Thu Feb 23 11:42:35 2012 +0000

    Remove unused variable

commit 4230ebb9c24e607e240192894ab32408b8372634
Merge: 50c05af89 fc56209e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 22 17:10:01 2012 +0000

    Merge bug24739

commit 4c90882d2792dbec967ffddae164ce5e46d5b762
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 16:36:24 2012 +0000

    Put back one sed change -- not an inline update after all.

commit 80bb36c20ee00a8910c7fd5ee30a5c05fdf9cc33
Merge: 51a214d4a 50c05af89
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 16:00:03 2012 +0000

    Merge bug24739 in (a dependency).

commit 51a214d4a707c04670029345f535d7d9549fdb4a
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 15:56:47 2012 +0000

    Adjust rabbitmq-env.conf location and re-instate ownership decision

commit 1a2ea0daa42e5f8265626755679be81a571144cb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 22 15:35:10 2012 +0000

    Checking for memory usage in needs_timeout

commit 9dfa7be0933aa9fad6c2dee35ebb1873317b78db
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 15:02:20 2012 +0000

    Backout sed -i replacements

commit 8520b8e45bb8123ced0a312b82eb436656ba049f
Merge: a0f9eea66 fc56209e4
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 14:44:20 2012 +0000

    Merge default in

commit 10394f9c082b2c2e8a9ff733b4240bd86c3e993e
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 22 13:08:28 2012 +0000

    Using SYNC_INTERVAL for the idle timeout as well.

commit fc56209e428b2085a42acd5e1f545334c20225d8
Merge: 641d2b2d2 5f7d15590
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 22 12:46:13 2012 +0000

    Merge bug24706 (again).

commit 17c67eaf445372bc4549169e024fcca93d3589cb
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 22 12:40:05 2012 +0000

    Removed reduce_memory_use test before actual reduce_memory_use in timeout/1.

commit 65d7a0d4bce7c53f03c9c51ee6c202f0313d2b75
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 22 12:39:28 2012 +0000

    Removed sync_if/2 and sync/2.

commit 50c05af89a2ccb9d6c17f23d0abce95991fc284a
Merge: 641d2b2d2 8252a1922
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 12:21:13 2012 +0000

    Merge bug24706 in (a dependency).

commit 641d2b2d24da9991c6b58723ddf9f677808f0f16
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 12:01:53 2012 +0000

    'nother oops

commit 879abebb048546a884d7277340cbb76c2fdbfb31
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 11:30:54 2012 +0000

    Oops, typo

commit 5b5e56481d65f3c9114ab131197f22c17058a029
Merge: f42177c67 5f7d15590
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 11:13:28 2012 +0000

    Merge default in

commit f42177c675f63db811727323c9c685b3b4841734
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 11:12:23 2012 +0000

    Fix macports to Portfile after move of vars to rabbitmq-env

commit 61b22fe80b9d9fa11ec52c441f7cc6c346021a63
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 22 10:52:04 2012 +0000

    name info item for connections.

commit 8252a19228bc077f8195b8554b3ac67f0bbed271
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 10:11:16 2012 +0000

    Take default owner/group for confdir

commit edc775303f97d205dab292d1a9a7572a27711147
Merge: 24f67f901 5f7d15590
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 22 10:03:01 2012 +0000

    Merge in default

commit 5f7d155907af53e7f4785dd5c2bb5113c4d184df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 21 16:29:08 2012 +0000

    Resurrect default without bug24494, for real this time.

commit d421af5d38b5e2e00062b8ce481c90ffee1e41b2
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Tue Feb 21 12:34:40 2012 +0000

    Create man page for rabbitmq-echopid.bat

commit 46f37ecc2c95e5ba58981a5594d44aa76468c5a6
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Tue Feb 21 12:03:26 2012 +0000

    Handle echopid nit picks

commit ab4864be8d11d64d0012597a39ea1c30e8d7db8c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 21 11:04:19 2012 +0000

    Cosmetic / reduce distance from default.

commit b80153559e0bca6d34dcbab56dd5eb0ee269ffd4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 21 11:03:09 2012 +0000

    I don't think the mk_ prefix helps us here.

commit 399867cfd72dd67f0aa3e49964fd82826ebc15b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 20 16:28:04 2012 +0000

    Move the mode thing into the server too.

commit 36826b3785635f10cebaec59ae0f6b2b68e4878d
Merge: 27cac40ae 5850679bb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 20 14:37:56 2012 +0000

    Merged bug24365 into default

commit 1b02400ad090850fcab692ba0143924bf9956d8a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 20 12:32:58 2012 +0000

    Move code from rabbitmq-auth-mechanism-ssl onto the broker

commit 5850679bbfae610ef664cbe8cdd6f3b98c9d9fd3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 17 16:53:22 2012 +0000

    How do I hate thee, coverage? Let me count the ways.
    
    Now that ctl reset disconnects us from the distributed system, it breaks coverage each time we do it. Fix all that up again.

commit 27cac40ae1f4b735171b06f6b105e76a4d24220d
Merge: c7f164e17 fdda3e6e2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 14:23:10 2012 +0000

    merge bug24381 into default (Windows INSTALL file is not readable using notepad)

commit e600b1ebee482e4bfa192daff14ca4b92efbd3e9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 12:29:03 2012 +0000

    rename delayed_delete into delayed_stop

commit 5a8da9113aaf35ecf4c599c14f51a63f84f0911a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 12:06:35 2012 +0000

    ignore all messages after queue deletion, except for confirms
    
    Downside is that `rabbitmqctl list_queues` will hang until the dying queues
    stop completly.

commit a0f9eea66641f60e19c94dfa2880e4811e43f3a1
Merge: 24f67f901 3d2c8cc14
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 17 11:24:57 2012 +0000

    Merge 24748 in to get renaming of portfile variable.

commit 3d2c8cc14338118e7ff31352545ed5e7ae343f9d
Merge: c7f164e17 5b860c872
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 17 11:10:00 2012 +0000

    Merge in default

commit 8cb2906111da6eace1c2686ed8ec4573b2c992e2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 11:07:25 2012 +0000

    hang subsequent queue deletions

commit 22f3580833dd1c46a678ec3b87d1fdde8a8aaf6c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 11:01:33 2012 +0000

    delay stopping the queue until all confirms have been received
    
    The only two cases we don't delay are when 1) there are no outstanding
    confirms and 2) if the queue is blowing up (e.g. because it's received an
    'EXIT').
    
    Also, small refactor for rabbit_misc:is_abnormal_termination/1.

commit f84d75d6c7db92d973bd724294ad278867c22bb0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 17 10:06:01 2012 +0000

    simplify MsgFun logic for VQ:dropwhile/3 and VQ:ack/3
    
    MsgFun now takes a message (rather than a message reading callback).
    
    Also, only warn of lost messages when DLQ exits abnormally.

commit 4fc59f32b9ec02ae6f5bd8a22b31ad1e08cff76e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 16 19:10:30 2012 +0000

    warn when messages are lost
    
    When a DLQ dies, the messages published to it are confirmed, after warning the
    user.  The alternative would be to put the messages back on the queue, but
    that would be a bit surprising.

commit 36498d8ea29cf6dd6fd9b295b7a0ebc62349fdd7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 16 19:05:02 2012 +0000

    BQ:ack batches of messages

commit 03b335f12f44427637873e557f6399c30ef28151
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 16 18:00:42 2012 +0000

    don't dead-letter on purge

commit 06f5ec199e9314aa1de26c4d673e53699c4a3549
Merge: c7f164e17 e2bec7156
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 16 17:34:34 2012 +0000

    Merge default

commit 477c6f6655f36ad8d9fd03eff37ecf3cec2c4cc0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 16 17:25:26 2012 +0000

    don't dead letter on queue deletion

commit e2bec715642c14dcf92324849eb76739e1093af3
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 16 16:26:19 2012 +0000

    Introduced a small timeout when needs_timeout returns 'idle'.
    
    This makes this branch as performant as default, while performing
    syncs. I have to make sure that we don't rely on the timeout being
    0.

commit fdda3e6e2c680fd73de68cd2701e105347e31829
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 16 16:00:49 2012 +0000

    Use DOS/Windows linebreaks

commit b1913648c6a56a3db00f05caa81324c81c8d1194
Merge: c7f164e17 41e75d036
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 15 17:05:09 2012 +0000

    Merge in default

commit 99a273e543b8ba2c82ddd0fa6f72afa1557c151d
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Wed Feb 15 15:57:00 2012 +0000

    Implement basic timeout when waiting for the pid

commit 4862eca0087035826c67d187872260a537cae107
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Wed Feb 15 15:23:56 2012 +0000

    Make waiting for the pid the default behaviour

commit f4ec8fe68acf5104f067da4e483188745e99c707
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Wed Feb 15 15:00:19 2012 +0000

    Add errorlevels and wait-looping to rabbitmq-echopid.bat

commit c7f164e1725dfc0a1f122283ed4d0eb5183c1dd8
Merge: fbc19a845 14a593dea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 15 14:25:18 2012 +0000

    Merge bug24086

commit f6a16199d231489fb0156f1fffdace0319bc296c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Feb 15 00:22:27 2012 +0000

    rename ChPid to SenderPid where appropriate

commit 1ca232d53728e19fb31c7032602ad0e87e3d45f8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Feb 15 00:15:10 2012 +0000

    dead-letter when auto-deleting

commit 14a593deae6ed574896f42cc15ac670a94565f63
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 14 23:07:11 2012 +0000

    refactor: less strange variable scoping

commit 2e3746df0e5533bd5de1b805cfaa191bc7a33941
Merge: d97749514 c5781aa82
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 15 11:28:53 2012 +0000

    Remerge bug24714

commit c5781aa827618fc48a2a7b01cced2e48fca15a1b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 15 11:25:53 2012 +0000

    Unmerge bug20337

commit 202ea16b2fc1f681b37e5523f71ca4c36422ef17
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 14 22:57:01 2012 +0000

    oops

commit a928c53af58efe4a860cc425e5a8dca3578c3845
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 14 22:44:09 2012 +0000

    don't hang on multiple queue.purges
    
    Following Matthias' suggestion, we don't ok multiple deletes for the same
    queue: the first delete gets ok'd, but the other ones will get an exception.
    Because confirming multiple purges on the same queue is fine, but confirming
    multiple deletes on one queue is weird (if not wrong).

commit 50a345df8f8d165e443ad5c25f57b118f7c4b139
Merge: a9f617968 917b43d75
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 14 22:02:34 2012 +0000

    merge default into bug20337

commit 917b43d758f0df8f786177a2b7d31be89b3b3347
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 14 20:13:29 2012 +0000

    cosmetic

commit 0e51a4c04597b9b4ced8dc6c91e056c29b360970
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 14 19:30:41 2012 +0000

    always issue credits, even when we drop a message
    ...due to a dead-letter cycle
    and make the code a whole lot simpler

commit 12f50e7fd4cf1e8f9f545dc297ba92c8b7b42aab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 14 18:09:56 2012 +0000

    cosmetic

commit 2214ba8f1ccdea454797ec2f0a0dea2ddef51398
Merge: f9dbe8182 caf4d4576
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 14 14:50:37 2012 +0000

    Merge heads

commit caf4d4576fd2f0b322ff6ce45b7fc66a058a3a62
Merge: d97749514 623303eb1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 14 14:48:26 2012 +0000

    Merge bug24714

commit f9dbe81823dae264d5ecae8800c223bae9a221ab
Merge: a9f617968 623303eb1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 14 14:47:45 2012 +0000

    Merge bug20337 into default

commit 24f67f901475984be10f4fd6eb1960539a958c5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 14 14:23:38 2012 +0000

    It's not just for enabled plugins

commit 5aab46a43864e3de13c46eb50a6af91f1e3b0fa4
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Tue Feb 14 13:48:34 2012 +0000

    Move wmic pid-finding code into its own batch file

commit a9f617968b7b0cd3464ce30fd007340e919f4ff4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 14 12:05:27 2012 +0000

    factor out redundant code

commit ea94de35ecb237762c5c0d0ff33af8c42ff1da95
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 14 11:47:26 2012 +0000

    refactoring

commit 623303eb1dda1ed1eb8655b3bdb62fdd3e1ea9e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 13 21:16:52 2012 +0000

    simplifying refactor

commit 5b860c87237dfd547ed39acc6dbcd2ebba13464c
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 13 11:28:55 2012 +0000

    Ensure rabbitmq-env.conf file is fixed location, even in Generic-Unix case.

commit d990634fa80c6dea3c8700849a7a91003007cb29
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 13 10:50:11 2012 +0000

    Update misleading comment

commit 68dc649d4344bb69cf1713f26f748111de0d7fc6
Merge: dd1be126c b107b969c
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 13 10:24:25 2012 +0000

    Merge heads

commit b107b969c5c2e3cb01e56aa2063ecbab4f38f052
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 13 10:23:00 2012 +0000

    Add directory for enabled plugins in the standalone generic-unix case

commit d8d0420bbecd508ad00655b38fa671b3c9ebea09
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Feb 12 16:53:17 2012 +0000

    don't hang if purging an empty queue with dlx
    
    The queue.delete case had already been handled.

commit 92eb78e23ddad3a10aba4120cf41e759530c3560
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Feb 12 16:24:48 2012 +0000

    use lists:keydelete and only log cycles once

commit 1798766f85aa1b942647a6b6136e09cb251bd631
Merge: 7a1c79945 6e728902a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Feb 12 15:24:25 2012 +0000

    merge default into bug20337
    
    All tests pass.  This also fixes the rabbit_guid rename.

commit dd1be126c2138936da281d59f0f7cabaef2022f0
Merge: e73c6b75d 8f9beac9b
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 17:41:12 2012 +0000

    Merge heads

commit e73c6b75d24abdbf2f8edf1218c80136a0c6f599
Merge: be1df6066 34ddbe258
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 17:32:18 2012 +0000

    Merge in 24739 (again).

commit be1df606676b6dda3e4c51dd942dc699de1a976d
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 17:29:49 2012 +0000

    Ah… the number of indirections there are here…  :-(

commit 34ddbe2581e40d8ed670a0a229ca98c47c1a7613
Merge: 4e9ebccd8 56a96e27f
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 16:37:55 2012 +0000

    Merge in 24739 (I need this fix).

commit 4e9ebccd821b41558049f504244c98962f49e569
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 16:34:51 2012 +0000

    Get macports installation to create enabled_plugins_file directory if it doesn't exist.

commit 56a96e27f9d4629f00864311a16fedea5ce7aa0b
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 16:13:39 2012 +0000

    Comment for future readers

commit d913a6d6f06ae4ba5b013ee5bfba74973b968c4a
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 14:07:00 2012 +0000

    Typo

commit 322d57e8dc544ebc833222af4c62b5548c46e621
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 13:30:38 2012 +0000

    OK Now I see which rabbitmq-sys is really updated in macports  :-(

commit 3082e29d11f5f8fa00574657bd6f83973a943388
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 13:26:59 2012 +0000

    Another go at reinplace syntax

commit b69e217f90470ce808948fee88536ef84fd19d65
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 11:29:23 2012 +0000

    Simplify macports Makefile and delimit MACPORTS_PREFIX in the usual way.

commit e90dc524dbe443d6ecbe7fad5cb885aeffa52260
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 11:02:56 2012 +0000

    Escape $ in Portfile reinplace command

commit e23ef1da57efb96878e6794c612a58643f2cb40a
Merge: 7a1c79945 105a18315
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 09:57:50 2012 +0000

    Merge default in

commit 105a18315f724503b12780c1f55d79826d69bb80
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Feb 10 09:56:49 2012 +0000

    Refactor generic-unix rabbitmq-sys for easy updatability;
    simplify macports mods to generic-unix package;
    make rabbitmq-env independent of package installation;
    adjust rabbitmq-sys in base scripts to allow rabbitmq-env to work everywhere.

commit d97749514dafa8889431bb723bfbadc254060feb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 9 20:00:35 2012 +0000

    monitor nodes just once

commit 45129fd39cbf15134766041e7e490e449c9047d6
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 18:17:31 2012 +0000

    Got rid of unused function and warnings.

commit ca17b12b649de93da7bb811bf59558826bb12a3c
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Feb 9 17:50:35 2012 +0000

    Remove dependencies upon sed -i which is not posix-compliant

commit 7a1c79945a5b0c7e08cd19fd2881da81783583c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 9 17:23:27 2012 +0000

    remove cruft

commit f98e24a889e49c29691b45e21db235768e5d358d
Merge: 0408fdbf7 31f877254
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 16:53:24 2012 +0000

    Merged default

commit 0408fdbf71c7df48276875a3b721db21241ec517
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 16:17:23 2012 +0000

    Changed needs_sync/1 patterns order.

commit 27fd4874cf2c6f418655c95829a2d22d3aacf721
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 16:12:36 2012 +0000

    Taking is_dirty into account in needs_sync/1.

commit a2fc0dd8355f18cf31c25389c7147ba5965e35fd
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 15:54:36 2012 +0000

    needs_sync/1 now uses the handle write buffer, sync/1 is unconditional.
    
    If we perform the sync unconditionally and not only when unsynced_msg_ids
    is empty the write_buffer will always be cleared and we won't be stuck in a
    loop.

commit 8f9beac9bdfaa100ab24220b3db6ea42cd4b28af
Merge: 2fab39a6b 31f877254
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Feb 9 14:55:45 2012 +0000

    Merge in default

commit 84703ed36b4b0780dd6a3cf3726bed9c816aba94
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Thu Feb 9 14:37:49 2012 +0000

    Syncing instead of flushing.
    
    This stops needs_timeout and timeout from going in a loop. However, since
    rabbit_queue_index:needs_sync works looking at unsynced_msg_ids, this doesn't
    preserving acks when the broker is terminated abruptedly, since the timeout
    won't be triggered (needs_sync will return false).
    
    If needs_sync is defined inspecting the write_buffer if the file_handle_cache,
    needs_timeout and timeout go in a loop, for reason that are not clear to me
    now.

commit 31f87725494305bbb923b274e343a20660ec84a1
Merge: 80bb1e177 9ee929816
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 9 14:26:42 2012 +0000

    Merge bug24668 (make consumer flow control more like credit_flow; improve performance along the way)

commit fbc19a845d847fc39e58cdbc117ded77fa656867
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 9 13:37:20 2012 +0000

    handle framing errors promptly

commit 9ee9298160f3d29794bd731eae92d2bb2e3d114a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 9 13:33:11 2012 +0000

    Cosmetic

commit 80bb1e1775298e78bc4196ca10c8c5b4d1640093
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 9 12:03:17 2012 +0000

    refactor channel frame handling
    ...so there is just one process_channel_frame call site.
    Also, ensure control_throttle isn't called twice, which would happen
    when processing a 'channel.close_ok' frame. No harm in it, really, but
    unnecessary.

commit b1f9f5c03a1eb396fb1a0ee9a8f4ab49090dfeff
Merge: bb64bdf8a e848ee7fc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 8 18:04:57 2012 +0000

    Merged bug24505 into default

commit bb64bdf8a0c55bf7ca25a8c0b85fff1c3af6756f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 8 17:44:23 2012 +0000

    cosmetic: drop redundant /integer in binary match
    plus re-indent comments

commit e848ee7fccccfc0f4821aa6b2613524a962c1a69
Merge: a80e6eb70 8d67fce57
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 8 12:00:06 2012 +0000

    Merge bug24234

commit a80e6eb7008ea135fbf883573d1a2e20fc95074f
Merge: ace78be9b f496cee95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 8 11:44:04 2012 +0000

    Merge bug24730

commit f496cee95babadc178ecab7e243a241cbf447794
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 8 08:58:50 2012 +0000

    refactor: remove cruft
    The equivalence proof is left as an exercise to the reader.

commit cff558a1d426e5258eeb98195fea6bb8c38baab7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 7 21:10:05 2012 +0000

    refactor: extract commonality between basic.deliver and basic.get
    ...and move the writer communication as early as possible, which
    improves latency.

commit cc8ab871619c093d27823ace64488e73ca6a1f87
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Feb 7 18:08:55 2012 +0000

    Returning idle in needs_timeout/1 only when there is something to flush.

commit 9b62f842cdbbf26a4e929ff1d8761c6819d7c19a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Feb 7 16:59:20 2012 +0000

    Always returning either timed or idle, always flushing in timeout/1.

commit 55c701d92dbcb9114c630cb7a271f3cd4f205813
Merge: 4f22b3309 82a60957c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Feb 7 15:13:48 2012 +0000

    Merged default.

commit 82a60957cb14f3a1b98052e54f1aec32d1c18ba9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Feb 7 15:11:53 2012 +0000

    Using gen_secure/0 only when really needed.

commit 6296c7e6436d44dedce9f52aeb52b127e69788dc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Feb 7 14:58:53 2012 +0000

    Flushing periodically, trying out various way to find out when to flush.

commit 6f4f9e92e126b548fedfafc4b01002fbd98a6649
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 7 14:04:49 2012 +0000

    credit_flow-like throttling of queue->writer message flow
    Previously we effectively had a credit_spec of {100,1}, i.e. the queue
    would send up to 100 messages to a consumer channel/writer, and the
    writer would 'ack' them individually. That is horrendeously
    inefficient:
    - when draining a queue, after the queue had sent 100 messages it
    would block the consumer, unblock when the notify_sent 'ack' came in,
    send another message to the channel/queue, block again. So a vast
    amount of work per message
    - in a cluster, the notify_sent 'acks' effectively doubled the
    cross-cluster traffic
    
    We now use a scheme much like credit_flow. Except we cannot *actually*
    use credit_flow because
    - rather than wanting to know whether a sender is lacking credit for
    *any* receiver, as indicated by credit_flow:blocked(), we need to know
    *which* receiver we are lacking credit for.
    - (lack of) credit from receiver should *not* propagate to senders,
    i.e. sender and receiver credits are completely decoupled. Instead the
    queue should, er, queue messages when receivers cannot keep up.
    
    While we could modify credit_flow to accomodate the above, the changes
    would be quite unpleasant and not actually reduce the amount of code
    vs implementing a more specialised scheme.
    
    The downside is that the contract for using
    rabbit_amqqueue:notify_sent becomes somewhat mysterious. In
    particular it sets up a monitor for queues in the caller, and expects
    the caller to invoke rabbit_amqqueue:notify_sent_queue_down when a
    'DOWN' message is received.

commit ace78be9bd1f1ee0c00d7cc637edaf27695f69ca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 6 23:45:34 2012 +0000

    Don't sync the mnesia disk log when nothing got written to it
    This is imperfect but safe.

commit 4f22b33092c2346578c1e7f73b2c859e37c217ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 6 21:12:26 2012 +0000

    cosmetic

commit e51ebce66580575ee284022e21d3f07044e43b34
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 6 19:38:20 2012 +0000

    correct some signatures and return types

commit 2fab39a6b0564cd5629a0cabc4710fa8c3e57f46
Merge: 0b335fbb8 49b72ed35
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 6 16:28:56 2012 +0000

    Merge in default

commit 0b335fbb8f5b8870c7ab6be411bb6a08e384ed55
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Feb 6 16:21:58 2012 +0000

    Give alternative to 'todos' which (can) work on macos

commit 49b72ed351064c566f2d7a42a1394b994335ab08
Merge: feb304bfd 0021a3fd3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 6 16:11:16 2012 +0000

    Merged bug24624 into default

commit 6e728902a8c7223a23b79b66e6dae23ee186e18d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 6 15:54:25 2012 +0000

    cosmetic
    
    The changes on default don't seem to impact the working of this branch.

commit feb304bfd384d0b6ed4286438b0d717f3c878d06
Merge: b00bbc43f ac839d16d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 6 15:33:49 2012 +0000

    Merged bug24655 into default

commit 4eb2a5282a77f7b73e1f9b94e368b6ca3b81129d
Merge: a5143916e c16d3a27f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 6 15:15:50 2012 +0000

    merge default into bug20337

commit ac839d16d0b951ce2dbf338a35aada910033e702
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 6 15:02:10 2012 +0000

    tweak credit_flow logic
    - make credit specs contain the InitialCredit and
      MoreCreditAfter. This is more intuitive and means the message sender
      only needs to look at the former and the receiver at the latter.
    - narrow the condition on which handle_bump_msg invokes unblock - it
      only needs to do that on *transition* from =< 0 to > 0.
    - refactor: extract process dict update
    - cosmetic: more logical order of exported functions

commit c16d3a27f9eabefab3a6d7e248997ee837819127
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 6 13:00:09 2012 +0000

    cosmetic

commit c5199726b4d1a3b49f9c8674ade4e095aaaeeb75
Merge: fe8f4c7fa 39c55dbd9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 6 12:36:08 2012 +0000

    Merge bug24706.

commit fe8f4c7fa80f16ec0fb21538d28fcaac4f25d510
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Feb 5 09:48:11 2012 +0000

    shrink

commit b54325a00eb7ecdac8eb88e408a57682e3e7cc35
Merge: 0cf73a65a c98126aea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 15:59:12 2012 +0000

    Merge bug24702

commit c98126aea314533b1f84298b59da70c467020e64
Merge: 8eb92efda 8ad54bb11
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 15:36:08 2012 +0000

    Merge bug24500

commit 8eb92efda0da6bc0e976ddf483f939d70d2532d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 15:30:59 2012 +0000

    Add description

commit a5143916e5069d3d97438008187784f3761fd4a4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 3 14:32:32 2012 +0000

    refactor (Matthias's suggestions)

commit 8ad54bb11d9e372e09c268edec822a005eec689e
Merge: e9559c13b bd2902fc2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 13:06:47 2012 +0000

    Merge bug24606

commit 0437e0c87f9f1a2dcb95d880c9380523f8ba3203
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Feb 3 13:01:07 2012 +0000

    drop messages in dl cycles
    
    This is the fate of messages in cycles:
      =WARNING REPORT==== 3-Feb-2012::12:54:34 ===
      Message dropped. Dead-letter queues cycle detected: [<<"foo">>,<<"foo">>]

commit b00bbc43f2b49cee2e286fff033c8f6238303008
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 11:11:11 2012 +0000

    Umm, and those.

commit a2b653c2f2a8be5ebafdbdd1a0f9c202b454e4f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 3 11:09:41 2012 +0000

    Build-Depend on erlang-nox and erlang-src.

commit 0021a3fd306f5bcd39e2ed5be02c551956cce9e0
Merge: 22e541e4a bd2902fc2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 2 16:09:56 2012 +0000

    merge default into bug24624 and use new rabbit_misc:format/2

commit bd2902fc29d4508f40197a46551bc2590e03c1de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 2 15:34:31 2012 +0000

    refactor: extract string formatting function

commit 22e541e4a464842d4be32396185e50b42c68aba6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 14:42:27 2012 +0000

    Move cookie_hash/0 too.

commit ed6934938195ec11d3923eb8a2fc4ac1a72d3a2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 14:36:17 2012 +0000

    Move rabbit_misc:nodeparts/1 and rabbit_misc:makenode/1 into rabbit_nodes

commit f34e0da9b6ddc9948820b90fdad3c9c9e8b29920
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 14:20:34 2012 +0000

    "to contact" isn't correct in the duplicate check case.

commit 150fbb73d78d7eae9e57b87601856db0a9abfe0b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 14:16:48 2012 +0000

    Unify the more resilient hostname check, refactor out this code into a new module.

commit 0151a42ccf01e2b7c1608fc1a88b5ee183d361c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 13:41:25 2012 +0000

    Clean up diagnostics code, clean up diagnostics messages.

commit e9559c13ba475e6b75bf4fd0c32683750d4c0c01
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 2 13:41:23 2012 +0000

    Update copyright 2012

commit 7d17ae130affe0a7dd626e4db18159f8e6b71db6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 13:03:53 2012 +0000

    Remove nodes file immediately after starting Mnesia.

commit 4e3488a0b26afc2ff61d478046d39dc357403d99
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 12:55:57 2012 +0000

    Oops

commit 9b937a1e4ab5d652d2e8221f92ea364725ab94ce
Merge: 9b6c99384 c23dbf8d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 2 12:54:28 2012 +0000

    Merge in default

commit 5e35fa65b28d9966defab60e4e0848c04b641079
Merge: 9b6c99384 ac8c7a57a
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Feb 2 10:41:26 2012 +0000

    Merge default in.

commit 0cf73a65a40fc55b2d2bc847a3b7a4097aba22b3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 1 22:20:06 2012 +0000

    include some mirror master state info in status()
    After careful inspection, I have determined that known_senders and
    seen_status are the only items worth reporting on.

commit 8d67fce577d3c61e35cb82703f01dd6bdb00026c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 1 17:45:09 2012 +0000

    Committed some changes by mistake...

commit 795674565424f046595451b09b33dc5b9d089d06
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 1 17:40:59 2012 +0000

    Cosmetic, restored reject/4 arguments to the previous order.

commit 9b6c99384e421f767d3b353ad9f0d793f3072d28
Merge: abea5ffd5 f2a71b50b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 1 17:23:57 2012 +0000

    Merge heads

commit abea5ffd58a2f5eae1b59f0d1c5e40378ff02a69
Merge: 33a91402a f46d8bf10
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 1 16:48:35 2012 +0000

    merge bug24703 into default

commit f2a71b50bcd1c7b6f0bf9b8807d6bd46cc4c4a8d
Merge: 0bbb2b2f9 3d83ac01f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 1 16:48:08 2012 +0000

    Merged bug24713 into default

commit 0a876533668f3dc51abfb3db32f6ed35be58c6e1
Merge: 3d83ac01f fc8585112
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Feb 1 16:35:05 2012 +0000

    Merge default.

commit 3d83ac01f30412de953a9406ffa8d989dcffa034
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 15:57:53 2012 +0000

    Typo

commit f46d8bf10eef5df2adef106a32bb29e5a6cde37a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 1 15:43:04 2012 +0000

    simplify

commit d600d3896b57f41edc4604b97c2864a148d4106c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 15:15:38 2012 +0000

    Revert comment change

commit a24696f90e186fde9f280899928af1c9bb870d64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 15:12:53 2012 +0000

    OTOH if we're not trying to cluster with anything we should probably be happy.

commit 417d24df045910de2748337a71605ed94d194c9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 15:06:04 2012 +0000

    But Matthias points out that we can avoid the three-way-ness by changing the meaning of non-forced clustering so that you must only have to contact *one* disc node. This seems to work.

commit 4ac491b4ad9f5998916b36f1bb7d9df13cdb4ce6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 14:52:57 2012 +0000

    Reintroduce the three levels of forcedness. We do still need it.

commit 0cd66c21f879a6694f905096f0493253baeed188
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 14:07:50 2012 +0000

    Inline.

commit 81f0dbdfd90658a45271852b5e08e219dfb79479
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 13:57:20 2012 +0000

    This doesn't start any more.

commit 61a754a6ecbb580b1cf193a73fe2474b570d247c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 13:45:22 2012 +0000

    Base discnodeness on what we want to become, not what we are.

commit 1ff50f4f37bf579a9b46990098236a16bb5dcb95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 13:38:31 2012 +0000

    Change the semantics of Force to fit this particular bug. *meep*.

commit 0bbb2b2f93e39be73aa1c39d2c10b8175bac32ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 11:54:20 2012 +0000

    Don't claim to be adding mirror when we're not.

commit b532b76c70bab963c3942c7443b3b89281b28caa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 11:45:49 2012 +0000

    We don't actually need this two-stage startup, we can just fail to init/1.

commit 634556a6ddf452084652137df1a3247b051b2681
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 1 11:17:57 2012 +0000

    Let's pay attention to whether we actually started or not.

commit ac8c7a57af4b381d44a62ef0ba0447c1740072af
Merge: 1a36ebfe1 33a91402a
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Feb 1 10:57:20 2012 +0000

    Merge default in

commit 292e2f3eb76aea7c282d2974a587cb29520ec90a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 31 18:07:57 2012 +0000

    Rebase 038bd3c185ae

commit 3872c5bc5783ebdb03a0e4f54be7c314d073ae14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 31 18:07:07 2012 +0000

    Resurrect and remove redundant ensure_mnesia_running()

commit 2110fe86d6082c6e23e0e7e4bbe1b6be0dc361b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 31 17:35:02 2012 +0000

    Two-stage-startup-with-mnesia-record, like rabbit_amqqueue_process.

commit 33a91402a7bbe105f514557b5de4be70fbf3a798
Merge: 9bd01e7e4 f2bfb487b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 31 17:23:03 2012 +0000

    Merged bug24671 into default

commit 71ab9983cc40aa06e1ad3a84d14a16a1c9876601
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 15:39:14 2012 +0000

    Better comments regarding gen/0, explicit range for phash/2.

commit fc8585112191b5b50e0bded8f1bc3d4739374bea
Merge: 237440334 9ae275a2d
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 14:27:04 2012 +0000

    Merge default.

commit 146d5909e36fd84c42a3a72f7035f9e4cd0ea0d5
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 14:04:46 2012 +0000

    Better comment for gen/0.

commit ff722cfaee7b255fc83c1d775dcc0084f2d2d1f9
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 13:55:53 2012 +0000

    Update comment for gen/0.

commit f2bfb487b7c6695595859cc2f04d99635fd25cdb
Merge: 16236ff34 cdd483cd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 31 13:55:40 2012 +0000

    Merge bug22470

commit 6f6f1da0aa28059bdc4761a1bde6ca9ee53d8740
Merge: 32dcff746 2e4a51eba
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 13:48:58 2012 +0000

    Merge master in.

commit 32dcff746f2d2a09eaa9aec5dcdddd06b43a2c85
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 13:34:37 2012 +0000

    Change fash guid generation function to use phash + rotating blocks.

commit 16236ff34e013013ad8e480df3e89caad64c629e
Merge: 2e4a51eba cb898760b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 31 13:17:11 2012 +0000

    merge bug24715 into default

commit cb898760b39aaf0d31a0db8ecc9368aac62daceb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 31 13:16:26 2012 +0000

    cosmetic: ensure_gm_heartbeat is not a gm callback

commit 568f4601c90c8c55dcc65126d94ad284275a60ab
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 31 12:58:53 2012 +0000

    use same variable naming convention as in channel

commit 151c88acf1ae7fd010c9287c33e2d5842c6788db
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 31 12:52:09 2012 +0000

    don't leak queue monitors

commit 2e4a51eba4a52f5ab31566458ce6d91f2f85de9d
Merge: 840394831 9ae275a2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 31 12:03:36 2012 +0000

    Merge bug24718

commit 237440334f0ae63800e0941a5842c7a1b42d1648
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 31 11:00:20 2012 +0000

    Renamede reject_tx/4 to reject/4.

commit 840394831874df48862f35399454848b36bed9c5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 30 18:59:41 2012 +0000

    it helps to not throw away the state
    it really does

commit 1a36ebfe14727586c600ea2d031db5efeddc3959
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Jan 30 18:01:45 2012 +0000

    Modify generic-unix packaging step to override rabbitmq-sys defaults.

commit e1eff8737f69880efd00901b8225802c26f15d3b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 30 17:04:56 2012 +0000

    Don't use timer:apply_interval/4.

commit 01deb46a6c1f9c66daa3a6a8652a927826c1d946
Merge: 6c546834c d7ab91610
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Jan 30 14:41:12 2012 +0000

    Merge default in

commit 6c546834cac4d15038fb73f6af4ae5721cee91a9
Author: Steve Powell <steve@rabbitmq.com>
Date:   Mon Jan 30 14:40:26 2012 +0000

    Move defaults to rabbitmq-sys

commit 9ae275a2d34a2911f9650960b611433807f38f24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 30 13:19:48 2012 +0000

    It's a resource, it'll print 'queue' anyway.

commit cdd483cd673a9fff71a744ea986be603f7c21fb0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 30 11:23:36 2012 +0000

    produce only one log entry for abnormal connection closure
    instead of two

commit f49fc3133a7a785374293d7f9beab2ee7df122f2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 30 11:17:23 2012 +0000

    check that dlx is defined is dl-rk is set

commit d7ab916102209c17ebeb25139688dd2c249dc107
Merge: a55f862b1 5f1c7d5e5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 27 17:00:12 2012 +0000

    Merged bug24664 into default

commit 5f1c7d5e50c136a10149654f88f924fc2623c9d1
Merge: 0143a21c0 07cee505b
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Jan 27 12:36:09 2012 +0000

    Merge bug24601 into default

commit 0143a21c0344072820d1efed6caa51430f59f855
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Jan 27 12:32:36 2012 +0000

    Remove redundant template from html-to-website-xml.xsl

commit 07cee505b0bdbbf01de7c50afe57e0aea75521af
Merge: 25a31a2ed cffda8a6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 27 08:54:10 2012 +0000

    merge bug23706 into default

commit cffda8a6e880c5b0b99db562b0e76e0a6e73ab69
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 27 08:02:11 2012 +0000

    cosmetic

commit ee1d5c3cc6343b258a5d879e7828c4c40e577819
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 26 21:47:35 2012 +0000

    consistency

commit 5eecb4d4924c9a9b11fe14ecb0d0a088047ac72c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 26 20:25:36 2012 +0000

    validate log levels on startup

commit 4e60685d205bcf47ab0f6b5b2029dc036fa23d90
Merge: 25a31a2ed 7d8d7a78f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 26 20:17:04 2012 +0000

    merge default into bug22470

commit 25a31a2ed1499fff3c74f5e3ba853ea96e997bdf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 26 18:48:47 2012 +0000

    get rid of debug and message logging
    since they have limited use
    This does make the rabbit_log server somewhat superfluous, but it does
    get a new lease of life in bug 22470

commit 7d8d7a78fda9cdb5972dc1de83338d3866adf44a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 26 18:30:13 2012 +0000

    introduce log categories
    thus opening pandora's box
    this turned out to be simplest way of controlling the connection logging

commit b0944c7ab7a5339f574b1c02e5c0816b3b0cfc16
Merge: 575b7707e 8ef1f5451
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 26 17:00:15 2012 +0000

    Merge in default (and make error more readable)

commit 36d512da847d175cee43921b1088a1a28a30ae7f
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Jan 26 15:25:41 2012 +0000

    Change CONFIG_FILE, LOG_BASE, MNESIA_BASE and ENABLED_PLUGINS_FILE defaults
    - CONFIG_FILE to ${RABBIT_HOME}/rabbitmq
    - LOG_BASE to ${RABBIT_HOME}/log
    - MNESIA_BASE to ${RABBIT_HOME}/mnesia
    - ENABLED_PLUGINS_FILE to ${RABBIT_HOME}/enabled_plugins

commit 88d99fa5b640de9552d55c1ccb12567fa1ef3dc9
Merge: 8ef1f5451 39c55dbd9
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Jan 26 12:55:43 2012 +0000

    Merge bug24706 in

commit c430f7c8cb95077bfbc4355eb7a9c324e206d62a
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 16:20:13 2012 +0000

    Delete extra whitespace.

commit 8ef1f5451beeb5ba6aba218a51d3088e75f0a268
Merge: 4dd7731a9 c177658c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 25 15:18:56 2012 +0000

    Merge bug24435

commit 4dd7731a945980b79951bad5936fd047931be5a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 25 15:18:42 2012 +0000

    Alignment

commit f5ac6ad4dbc667b88c5da578b509404bbc5b9b26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 25 15:17:48 2012 +0000

    I think this should be a soft error. Although the spec does say to use command-invalid when the client attempts to declare an exchange of an unknown type, that's much more obviously the client's fault. So let's go with an old favourite.

commit a9672d08ef959969e698310e81e4b18e5b19204a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 25 15:07:46 2012 +0000

    Tweak language

commit 0c5e6b6a16229a59a42a28ef3feb3802b7ee32c3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 25 15:04:48 2012 +0000

    prettier and more consistent connection log messages

commit c443b85078317e23b28e1fc5f079e987234f9671
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 25 15:03:53 2012 +0000

    move error_logger 'flow control' into application code
    since tcp_acceptor no longer does any per-connection logging itself

commit dacd413d2c961f3ee47cdd266ae6c0796787ee6c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 14:58:29 2012 +0000

    Cons instead of append, reject does not change the channel state.

commit 4d68eaab6297a24f08d18efcd997249cb4299bde
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 25 14:26:40 2012 +0000

    do not log accepted connections in tcp_acceptor
    Logging in such generic code should be very sparse. Let's leave that
    to application code (rabbit_reader et al in case of rabbit) instead.

commit 00852f11a23ff91420e712e9c814f6f4a6e3a3f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 25 14:06:58 2012 +0000

    drop ssl upgrade message
    it's not that important and just clutters the log

commit 5f55a91f1a5e7af2c05df56cc5834d77c7e902a8
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 14:00:17 2012 +0000

    'case' statement style

commit c15500aaa52d63fcf31a1a95e3eecbe5daa06fbe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 13:54:57 2012 +0000

    Better error messages and style fixes.

commit 8d55bda7fa11fbfd0b12c3482f366f492b49c80f
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 12:43:15 2012 +0000

    reject doesn't need to know about the channel state.

commit bdbd20c64a3eaebf4687789b46aade6cb48eccbe
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 12:21:02 2012 +0000

    Fix to reject_tx, list comprehension instead of map.

commit efd4e3e9a5c731bc4f7a2141de936c131e630ca0
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Wed Jan 25 12:33:33 2012 +0000

    Flatten the list of lists.

commit f74a2f7fc141c6fbebe10afd86867bb1c4e42d56
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 24 19:35:14 2012 +0000

    check dlx routing key arg

commit 2c53e3452477d6063e0424db9cd37371ab9b94c7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 24 19:05:24 2012 +0000

    overwrite malformed x-death headers

commit 9f1793492d497a5dda19c5685228b38a8ea29410
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 24 18:50:22 2012 +0000

    don't discard accumulated changes

commit ead2f76803c9a3baa6f0b2e15af73cfda15d3d62
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 24 18:41:31 2012 +0000

    use POSIX timestamps instead of human readable ones

commit 60a09e95e6a3bb0f3383097e108a10d5269f0e2d
Merge: 2142d1b62 c177658c5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 24 18:27:38 2012 +0000

    merge default into bug20337

commit 9bd01e7e47864422ea12cdbe366fd02f387f4d41
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 24 18:11:01 2012 +0000

    Remove ?CREDIT_CPU_BOUND and have /1 versions of ack and send instead.

commit bf2d2db59c75b354d0515f8aebf0c7adbb9afbd4
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 17:21:48 2012 +0000

    Executing basick.{nack,reject} transactionally.

commit ea5c31882b44f011f19d5863ffef4efdcea1ed47
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 15:28:46 2012 +0000

    Forgot to add/remove files.

commit d5ce39678a0a729f978a59f6caa197f5d1bd5b1c
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 15:21:04 2012 +0000

    Change dummy exchange name from "inert" to "invalid"

commit 40e2db03844aba0aa5b1d6c859fd5987be1c070d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 24 14:19:44 2012 +0000

    ...however, we should still allow rabbitmqctl reset to work when some nodes are down. (This is what we did before, the difference between reset and force_reset is that force_reset works if mnesia is completely hosed).

commit f90da3d989d4cc1a8f28bd40799848527bf7bcc8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 24 14:15:57 2012 +0000

    Don't force on init() (which fixes bug 24703), plus a little refactor.

commit 90148d92505a3d0e96d8eafdea2762c35aa05bcc
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 13:55:20 2012 +0000

    Duplicate "exchange" in error message

commit 8ab7d48a3db570b91ad44d7be3af4a158bd20a06
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 13:50:58 2012 +0000

    Using rabbit_misc:rs/1 to format the exchange name.

commit 9f8aaa304f33d69782eeb19f5fdffd81b52644e7
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 13:32:33 2012 +0000

    Protocol error instead of warning when routing through inert exchange.
    
    I originally raised protocol errors in bind/unbind as well but that defies
    the purpose of this fixes since if a queue is bound to an exchange with invalid
    type the boot sequence fails since it tries to re-bind the queue.

commit 124e6c2a7b898be38aae00a245d36e553106dd95
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 12:37:41 2012 +0000

    Dropping messages silently instead of emitting warnings.
    
    Matthias noted that emitting a warning for every message that can easily clog
    the logger.

commit 78f61fde6589b01a88a0cf9bb7f682c51089d407
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 24 12:22:59 2012 +0000

    Add stub for "inert" exchange to be used when exchange types are missing.
    
    Right now it just emits warnings on startup and when a message is routed
    through the exchange.
    
    I need to handle the "add_binding" and "remove_bindings" better, probably
    emitting a protocol error.
    
    Also, I'm not sure the log warning are visible enough.

commit 575b7707e69b3e3aef476dc7bf009bc5dce3b54a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 23 15:10:36 2012 +0000

    Show both log files.

commit d7df867d6e3853a6a31831b79311ca879a5330ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 23 15:07:27 2012 +0000

    Further clarity.

commit 7d026823db75ab8bc661e2db70899c2b48f33346
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 23 15:04:47 2012 +0000

    Improve display of boot errors.

commit c177658c5547d4648f47b6dbb92e5e86dd84cb2b
Merge: c32363c9a a3f32b609
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 23 14:34:58 2012 +0000

    Merge bug24653

commit a3f32b609a2b0fe7202159add0e8288e29aeecff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 12:14:38 2012 +0000

    refactor: use types exported by 'supervisor'
    instead of defining our own

commit 71cf73cde780518155922ccd70893fd56b6da071
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 12:03:47 2012 +0000

    helper function for constructing tcp listener sup child specs
    useful in e.g. stomp

commit 91c029d03a048d0e810e9206088ba82e125ee758
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 11:29:42 2012 +0000

    use the correct inet types

commit c4c45de4bf4048afa5fb3d944f2166d92a6b2f72
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 11:15:19 2012 +0000

    use correct type for {M,F,A}
    the built-in mfa() type stands for module-function-*arity*

commit c91adb28842ae127be4992000abe152bef691816
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 10:06:02 2012 +0000

    refactor: check_tcp_listener_address/2 -> tcp_listener_addresses/1
    ...which is a more sensible name and signature

commit b55fb4fe8b78317e3d8ca6d0c941619fcc289f85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 08:49:06 2012 +0000

    refactor: turn a condition into a guard

commit 4c9ffeeda6d584e455344a3f9f7d1d9222349146
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 23 08:16:22 2012 +0000

    cosmetic: move helper functions where they belong

commit c32363c9aaa3c0adab8e1859d48d50bad04e94d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 22 17:10:04 2012 +0000

    handle the remaining enabled_plugins_file error case more gracefully

commit 78cf15d0f59d5537e8825585606cea0fda870461
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 22 15:09:29 2012 +0000

    don't complain about empty enabled_plugins file

commit 08574dd7cd1ac911e75bb6f59392f5cb1388f315
Merge: 06a551151 b673ba687
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 20 16:01:28 2012 +0000

    Merged bug23432 into default

commit 6f179250c3346f502dbd4315b174946e27e103c7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 20 15:52:23 2012 +0000

    display posix error description

commit d687a24dd263da6f3fbf7019c070e24d34be9172
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 20 15:29:38 2012 +0000

    Improvement?

commit a6e9bfa54f3606eecfddad9eb3c2579bc3193270
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jan 20 12:56:18 2012 +0000

    Don't fsync after inner nested transactions

commit c456427a270407d5321ce5d59db578988ca894d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 20 12:34:21 2012 +0000

    More doc.

commit 06a5511512b9fb76461c566aebc94b26039f5254
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 20 11:39:34 2012 +0000

    Resurrect default

commit 9ab3d151291632061f54e8b07f6a58d1f1921961
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 19 16:42:04 2012 +0000

    More credit for the queue -> msg_store case.

commit d13c96bdc9499c9af8be7a7fb8d87639645933db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 19 16:03:06 2012 +0000

    Be more assertive

commit 9fd3ce8d36de386b44bc3330891e64bfdf920532
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 19 15:52:27 2012 +0000

    Remove doc:div and doc:toc, add show-in-this-page and reindent. Really this should have been in bug 23052. Ah well.

commit e6bf11b095f174bb2610710f3a7c7a62df17e351
Merge: 70562444d 9b528b2ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 19 15:19:35 2012 +0000

    Merge bug23938

commit 70562444d8c538094c5469bef5a6ae0ff186dbbf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 19 13:10:23 2012 +0000

    correct typo

commit 3acaa40f05209e86d766a310cbb061e00d3db052
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 19 12:29:09 2012 +0000

    Language tweak for mnesia_sync justification

commit 4697704570a2dde0c09bebb0aeeae1f8cabd2f3f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 19 11:04:27 2012 +0000

    Brief explanation justifying the existence of mnesia_sync

commit 5f410c781b98180bae374409a4154b74e9cf10d5
Merge: 51e7b6787 37b9daba3
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Jan 18 15:04:08 2012 -0800

    Merged bug24641 into default.

commit a55f862b1d73a111d41d96df0a81c17b48769abc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 18 15:48:24 2012 +0000

    HiPE credit_flow - this gets MCM -x 1 -y 1 -i 5 from 29.5kHz to 30.8kHz.

commit 5b37ae6d3257e9c292e8feeaf8198010cf8fc07f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 18 14:46:40 2012 +0000

    For direct client we *do* want the reader pid (amqp_channel) rather than the conn_pid (amqp_direct_connection) here.

commit cc8b0b5d752b2e16a92dede65af4c3bd5fc4a351
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 18 12:20:21 2012 +0000

    Correct comment and use spawn_link

commit 1d43ea4a18f534329161934af1d380ce5fcd94bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 18 11:33:25 2012 +0000

    Ignore bump_credit messages in rabbit_tests.

commit afa6d34a55ae93b61e2584dbf2f0d2ee1b38ab96
Merge: bee2e6d7e efc76de61
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 17 20:08:42 2012 +0000

    merge heads

commit bee2e6d7e38faebb2810b29084d944d7f5f82d2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 17 19:40:55 2012 +0000

    two flavours of 'write'
    Just like in the other applications of credit_flow:send/ack, we need
    two flavours of the surrounding API function, i.e. 'write' and
    'write_flow' in this case. That way existing call sites, such as in
    rabbit_test can remain undisturbed.

commit 2cad1714fbb1f5b9912fe866610d4643755ba662
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 17 19:17:17 2012 +0000

    more sensible arg order
    and consistent var naming

commit 51e7b67879e04da503d101e87ab88bbfe567af77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 17 17:41:03 2012 +0000

    Same fix as c412171663cc for rabbitmq-plugins

commit efc76de61ce776ed0fa5f1c5f6fbb5f7dbae9dc9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 17 17:27:15 2012 +0000

    Flow control: queue slave -> msg_store.

commit c9eb26930121f210a4eba76759a5866656e55e6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 17 16:52:19 2012 +0000

    Don't pass the client pid in for write.

commit f46df77fe0ba44d163ab92fd8f1b1846468fbddd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 17 15:32:07 2012 +0000

    Flow control: vq -> msg_store.

commit 933db72e665f4cae30a2a98b10316ecf93bbc7cf
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 17 15:14:09 2012 +0000

    Change the guid related entries names in the process dict.

commit bbbde3cd59aefb7638009f0fde5e3c900573f980
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 17 15:04:04 2012 +0000

    Change naming in rabbit_guid, explicit guid passing in string/0 and binary/0.
    
    Specifically:
    fast_guid()            -> gen()
    guid()                 -> secure_gen()
    string_guid(Prefix)    -> string(Guid, Prefix)
    binstring_guid(Prefix) -> binary(Guid, Prefix)

commit 72e74a0fea033d1091c07b9a4fcc369422b60946
Author: Francesco Mazzoli <francesco@rabbitmq.com>
Date:   Tue Jan 17 12:19:31 2012 +0000

    Split guid/0 in guid/0 and the faster fast_guid/0.
    
    The first function works like the old one (hashes the {serial, counter} each
    time.
    
    The second function (fast_guid/0) hashes the serial once, and the XORs it with
    the counter each time a new guid is needed. Thus, it is more predictable but
    should not produce less unique guids.
    
    If the fast function is used when generating ids for messages, it leads to a
    considerable speedup when testing with BroadcastMain (from 67k msg/s to
    75k msg/s).

commit aee2983d79bde3725ebdaf5e71e9f1dee4115d52
Merge: 1b6d50a60 53d21a228
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 17 01:16:12 2012 +0000

    merge bug 24265 into default (Somehow support DNs in rabbitmq_auth_mechanism_ssl)

commit 53d21a228bff099407b32c4dd211797e33c885d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 22:16:11 2012 +0000

    clearly this was tested thoroughly

commit 3af21f0259e53896e3b9572bc7084466540e8c30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 22:11:32 2012 +0000

    make flow control explicit in the channel API
    just as we did for the queue
    As a result the existing call sites of rabbit_channel:do, e.g. in
    rabbit_test and the erlang client, can be left alone.

commit cfa5b020ca65bc8f022aaffed71d1143478c6825
Merge: f1e9ae878 5dd79aa4d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 16 18:50:29 2012 +0000

    Merge bug 24638

commit dbb370029825f5a0f5a50d30c4b76234abba9b95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 15:59:52 2012 +0000

    simplify publisher monitoring code

commit f92fa9559b4119937cc4dfe3ec59f19516dd8d63
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 15:43:40 2012 +0000

    only monitor publishers when they publish with flow control

commit f1e9ae878d06b44c8d572d8c74065761d0b4a467
Merge: b45e48ad5 d5ce4fc72
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 16 15:18:00 2012 +0000

    Merge bug24676

commit d5ce4fc72e9d8d67d6293f99406e55e614e80304
Merge: e1cc08bf9 bc83ba097
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 16 15:15:47 2012 +0000

    Merge bug24674

commit b45e48ad5788cbb814fd46b7bec1f84a9261bc1d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 14:59:57 2012 +0000

    fix supervisor2 bug reported by dialyzer
    The erroneous code is invoked when a child terminates normally at the
    same time as it is being terminated by the supervisor. So
    unsurprisingly we haven't seen this, and it's hard to test.

commit ce346e5b75ffc3ed2ea234d04b3c3b4ed08f744a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 13:16:48 2012 +0000

    provide two flavours of rabbit_amqqueue:deliver
    - one with flow control and one without
    This allows us to leave the various existing call sites of
    rabbit_amqqueue:deliver unchanged, and only subject the channel to
    flow control. It also reduces the distance between the two places that
    need to know which messages should be subject to flow control by
    moving the rabbit_flow invocation logic from the channel into
    rabbit_amqqueue.

commit 48abf9dd61db2bdffb3bd0dcbe9607be6d285c97
Merge: 5ad6b5b63 bc83ba097
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 12:32:50 2012 +0000

    merge default into bug24664

commit bc83ba09747316d27a6ca6e359106d68bfc23550
Merge: 1665e136c 5dbb27c6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 16 12:19:25 2012 +0000

    Merge bug24681

commit d7161c1101547cfeeebc03d9487e6e1c1f818009
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 16 12:18:44 2012 +0000

    Remove unnecessary process

commit 1665e136ce7a5e59bbd74587e948c306aeca44d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 11:03:38 2012 +0000

    merge rabbit_router:deliver into rabbit_amqqueue:deliver

commit 5ad6b5b63c749e0a4217c9689e66009a3649c24b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 16 08:30:26 2012 +0000

    it's really not worthwhile exporting process_channel_frame

commit f95d764c79b6ad73382cb7ce4f8084b99e507797
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 17:20:45 2012 +0000

    do not hard-wire the channel interaction into process_channel_frame
    This makes that function more versatile, e.g. permitting the Erlang
    client to skip the credit_flow:send step.

commit e23c5f990d9903eee29acb51979c36e6666ecb94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:23:54 2012 +0000

    Reinstate a bit of code that accidentally got nuked in 9a87718c74df.

commit 7edc7cf574ae0f91553c93c01e23b349f07ebe50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:15:27 2012 +0000

    sender_down / receiver_down -> peer_down.

commit 7f1c683bea4a503fae5c9ee96a6f01f62a1e7fe7
Merge: 605933c29 7d86034c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:11:20 2012 +0000

    Merge heads of bug 24664 again.

commit 7d86034c5658b9bb0ad858252131e2d0b3f39637
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:10:28 2012 +0000

    rabbit_flow -> credit_flow

commit 605933c2922dab2c42bc49a0932e37dc07f64d0d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 16:06:54 2012 +0000

    cosmetic(ish)

commit 5dbb27c6a103d1062b428a16bfbc87f9c4da0278
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:03:40 2012 +0000

    Revert b03fe604af24. Not enough sleep.

commit 46a479d02ac450a49d68163425b6a9d211e1f524
Merge: 0543efc9a cf13a7b47
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:01:20 2012 +0000

    Merge heads of bug 24664

commit 0543efc9a99b7ea6e1183990ebf1691a152ce5f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 16:00:43 2012 +0000

    Move rabbit_flow:send invocation from router into channel; monitor all queues in the channel.

commit cf13a7b47687744e98dce6599b4b7639450c72af
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 15:28:41 2012 +0000

    update 'last_blocked_by' while blocked

commit d9f54a905896aca4440729d32d04f8c2937b4e65
Merge: 8a2dc629a 9090d0dae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 15:21:14 2012 +0000

    Merge bug 24673

commit 8a2dc629a07beda9c98101f65e4317847acbdde2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 13 15:20:53 2012 +0000

    Emit the timeout in the stats event.

commit 4e36502bdcaeaa6c3a4809e03be6bbcfb8ba8c7f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 14:01:37 2012 +0000

    apply flow control to content bearing methods only

commit 0491bc836d96f69e942bbe2f569736fe59dca0dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 13:46:27 2012 +0000

    unblock, if possible, when channels disappear
    We do this in all call sites of channel_cleanup, except in
    wait_for_channel_termination, since there we know we are about to
    enter the 'closed' state, which unblocks us anyway.

commit cc54cbdbd0ab684ddbcd4b8c7b53cca33f7f98e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 13:16:46 2012 +0000

    simplified running<->blocking/blocked state transitions
    also more sensible info items

commit c4893e60a1f25089230a8da1c26472ce7e651170
Merge: f8a052afd 9090d0dae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 13 09:46:55 2012 +0000

    merge default into bug24664

commit 9090d0daea27ffa72eb7a61fe61c23bafae4b462
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 12 22:37:32 2012 +0000

    a little bit of refactoring on the reader
    - move the 'blocked'-induced heartbeater disabling to the point at which
      the transition to the 'blocked' state takes place. This makes the
      correlation between these two events more obvious. It also prevents
      duplicate invocations of rabbit_heartbeat:pause_monitor/1, which
      hitherto was accomplished by relying on switch_callback/3 never
      getting called while 'blocked' - an assumption that could easily
      become invalid one day.
    - a little bit of inlining of timeout calculation code in
      close_connection/1.
    - more compact case handling in handle_dependent_exit/3 and
      wait_for_channel_termination/2.

commit e1cc08bf92d79152f72baa8888d681f961469ee2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 12 19:23:21 2012 +0000

    fix rabbitmqctl error reporting under R15

commit f8a052afd730ff5f3532d67f984a6ae7149a2aa0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 19:02:09 2012 +0000

    Attempt to show information about blocking due to memory alarm and flow control in a more comprehensible manner.

commit 07611a63fcfdf5087782335160a3bd5d598df75f
Merge: 4f6d5399b b81e4e7d0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 12 17:20:58 2012 +0000

    Merge bug24636 more

commit f5885abb20e2409ab64d392e0846cb9b7c7509f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 16:23:09 2012 +0000

    Flow control: channel -> queue slave

commit cdff3eca6098564c9100e0b156847bef283867bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 15:52:50 2012 +0000

    Avert eyesore.

commit 3d23167b9c793d76469af0eef52347f4262ebb39
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 15:49:37 2012 +0000

    Have queues monitor publishing channels so we can remove them from the flow data.

commit b81e4e7d063ed4c233f8f7651cafe76bed919b5c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 12 15:30:17 2012 +0000

    oops

commit 31459cd1ea66eab4555fc469e72247e8538a4373
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 15:19:56 2012 +0000

    Rename bump/1 to handle_bump_msg/1, add a comment and specs.

commit bd24d59b6010d6fea72f0e39a0d3b312f2f31fce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 15:03:35 2012 +0000

    Matthias points out that we don't need to remember that a pid has gone away: if by some chance we end up talking to it again we'll end up monitoring it again and then noticing it is down, and we'll always have ?MAX_CREDIT available each time.

commit 647348c7f1e59cd0bc4082f5decbe40b9b8dfd36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 14:49:51 2012 +0000

    Improve book-keeping - now we treat a receiver having gone away as granting us infinite credit, so we can pump out our remaining messages. We now don't leak connections any more.

commit 34d09736e9231813d8e1b74a325dde2c547cbb62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 12:01:21 2012 +0000

    Allow one sending process to be blocked by more than one receiving process simultaneously.

commit b694e7f8e3756b47934d309803eb5cf9d277084d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 11:36:56 2012 +0000

    Ahem++

commit f3008fd7104c6b08b886e32a1b21f202b6ad1080
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 11:36:23 2012 +0000

    Refactor / tidy, and sneakily fix an off-by-one error (ahem).

commit 444fbf98c6903efc8db00b166406acb3d622972f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 12 11:16:39 2012 +0000

    Oops.

commit 4f6d5399b5c110a22703fa5ac73b9dc0f3149b16
Merge: 816595d43 7a29b53b7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 12 10:13:47 2012 +0000

    Merged bug24636 into default

commit 816595d43f408baba8f0926118dcef444dd01c74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 11 15:56:30 2012 +0000

    rename fd stats items to make their meaning more obvious
    - and arrange them in limit/used order
    - and make process count info look the same

commit 6a722411f99709b7c14fbe834568aa843a5a77ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 11 14:19:06 2012 +0000

    Actually we should use conn_pid here since that goes to the same place for network connections and a more reasonable place for direct ones.

commit 35c0ab39abdf6c493bac6a129d37149d7a453179
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 11 13:01:50 2012 +0000

    Get the channel to "block" by not issuing any more credit, rather than calling reader:conserve_memory. This allows us to abstract much more into rabbit_flow, and is more general. Also rename some functions.

commit 6f93ba715fb450bafdf24b00f790312107f16634
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 11 10:52:01 2012 +0000

    No timeout when calling

commit 00576790d80c37ac47e3f2d67e22bcbe980ff95a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 10 17:51:14 2012 +0000

    Inlines.

commit 1375ebc533cd376397ff99a8c20cd42f6fa2d4ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 10 17:28:21 2012 +0000

    Cosmetic / refactor.

commit e099c912c60c7ed4c51f2754227809b490bb279b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 10 17:11:19 2012 +0000

    Flow control channel -> queue.

commit 7a29b53b73424232509a1851cfc3e04ab720957c
Merge: daef9b60f 68e7bdb6e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 10 15:55:40 2012 +0000

    Merged bug24665 into default

commit d24140fc1093e3e23d0e2f8cd84ded88539ea1e1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 10 14:58:52 2012 +0000

    First draft of mnesia fsync

commit 31bef22041049a15a3ec9a522ce9168c76e47ab2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 12:45:23 2012 +0000

    cosmetic

commit 18c736636113d27618887ffc3bcc1d7817450b30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 12:38:21 2012 +0000

    include a few more pieces of info in rabbit:status
    stuff reported in management that isn't reported elsewhere already.

commit 48213ca5e9255a0e98f016e9ef48f0d886ff0bfb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 12:26:31 2012 +0000

    include fd info in rabbit:status()
    There is a slight layer violation here - we label the info items with
    'socket...', which is correct in the rabbit context but really could
    be any fd in other contexts. Note though that we already mentioned
    sockets in the log message produced on startup.

commit 5dd79aa4d84fb041bd5d1e23204c4a84712e534c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 11:46:44 2012 +0000

    increase closing timeout
    to increase the chances that buffered data will make it to the client.

commit 4bc6165a3d29c10fca6fb72fad14c73cbe05bae3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 08:59:50 2012 +0000

    don't linger

commit 68e7bdb6e79effb12a5ac1a987ca0c0738c69ba5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 10 07:26:40 2012 +0000

    cosmetic: remove nonsensical comment

commit daef9b60f77ceabd16090b85c6cc4d90eaffb5a2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 9 21:40:17 2012 +0000

    don't start cpu_sup
    We've not needed this for some time.
    Note that we still need to a) depend on os_mon (it's needed for memory
    reporting under windows), and b) disable various bits of os_mon
    explicitly since they otherwise start up by default.

commit e713a79bdbe526fd14eb3edec06defd70d2e05f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 9 18:17:51 2012 +0000

    Very hacky first pass at internal flow control between channel and reader.

commit 5a8226b644e71770e049517e7ecd143eabe8afae
Merge: 2302e6bba 96994162e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 9 15:15:23 2012 +0000

    Merge bug24649.

commit 1b6d50a604cd527475f905cc696bbc9adb7d4d41
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 6 15:43:19 2012 +0000

    Better comment.

commit 8eb408103baddec6264aef433319949a63ff2839
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 6 15:41:19 2012 +0000

    RFC 4514 states that non-acsii chars get converted to UTF-8 and then escaped - e.g. U+00A3 POUND SIGN encodes as \C2\A3.

commit e38c62a23620dd28429aa621080952cb9681803a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 6 15:39:29 2012 +0000

    Oops, actually this converted "foo" to ["foo"].

commit 37b9daba31287e3443df02b22e54ae28fd11b7d2
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Jan 6 15:08:26 2012 +0000

    Add VERSION to the build and destroot phase environments for MacPorts

commit a00af523c3824fe651c2ec06269acb036b77c283
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 6 14:46:08 2012 +0000

    Avoid putting quotes around domainComponents.

commit ef591d28162a9b4fbd38768b5c50c24af58a1f23
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 6 13:50:44 2012 +0000

    peer_cert_subject_itemn -> peer_cert_subject_items, there's no guarantee we'll only have one!

commit 96994162eef383c82b7f9e20e9d4af479699bee8
Merge: a3b1d5bd2 50c0c2366
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 5 13:34:34 2012 +0000

    Merged bug24659 into default (2)

commit 50c0c2366998c452d6be39ec044b629ef314ad07
Merge: ad27eeaed f71e5e4b6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 5 13:34:17 2012 +0000

    Merged bug24659 into default (1)

commit b673ba687fdf64b7f290a54ee2c098c0d8389e36
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 5 12:43:15 2012 +0000

    Avoid a circular dependency. The new load_definitions depends on recovery (since it may create a queue and recovery starts the sup). But recovery depends on empty_db_check. But load_definitions *enables* empty_db_check (since we want to avoid creating default_foo if we just loaded a bunch of definitions).
    
    But there's a simple fix: recovery doesn't actually need to depend on empty_db_check.

commit ad27eeaed184e37c6dd79605b3b1c999a8fc77d1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 4 18:50:59 2012 +0000

    another, even tinier, refactor

commit 9350c4131d0204ce1582fb2f2dbca9a04eea98ae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 4 18:12:27 2012 +0000

    tiny refactor

commit 39c55dbd9e1c67617a7ebd93ce31fca35a1e7fc7
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Jan 4 15:57:19 2012 +0000

    Move non-empty defaults to rabbitmq-env
    - rationalise server-settings
    - correctly override PLUGINS_DIR
    - allow use of PID_FILE override
    - simplify NODE_IP_ADDRESS and NODE_PORT setting

commit 80e347b6741cb5181c3bbe6b27d134430b3334b9
Merge: 1aadea65e 1e0b5433e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 4 11:03:30 2012 +0000

    Merged bug24644

commit 2302e6bba1689f6dc72998ea945c3fff373af5ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 30 13:47:41 2011 +0000

    carry on accepting tcp connections after an error

commit 1e0b5433ea5c894f547231cd2e8facaff84157dc
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Dec 23 10:59:57 2011 +0000

    Added modification to portfile made on previous release by macports.org
      see https://trac.macports.org/changeset/87628

commit f71e5e4b61bdfd216124d5da49140f4cde5c3a12
Author: Piotr Sikora <piotr.sikora@frickle.com>
Date:   Wed Dec 21 12:35:36 2011 +0000

    When available, use VERSION defined in the environment.

commit a3b1d5bd212786c38c9a957c071d7e7eb23f686b
Author: Piotr Sikora <piotr.sikora@frickle.com>
Date:   Wed Dec 21 12:06:36 2011 +0000

    Portability: use temporary files instead of "sed -i".
    
    The "-i" option isn't available on BSD systems.

commit 1aadea65eac6ede7a43cb55540bca8060f4b6f9e
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Dec 20 10:59:36 2011 +0000

    Added tag rabbitmq_v2_7_1 for changeset dc103b0d36b5

commit 6854170f3ef1513f151463ccf341d81f867dcb5b
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Dec 20 10:56:14 2011 +0000

    Updated changelogs for 2.7.1

commit c23dbf8d0e309d295c09fb2d283b57e3d2ca8730
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 16 17:00:40 2011 +0000

    Make rabbit:diagnostics/1 just return a string. It's still most convenient to assemble it the way we did before, but now the API is saner.

commit 636b2f8e2c59326e13c4d6730e5cfca0ae20ba29
Merge: 0c9e226a0 bd7547a49
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Dec 15 21:35:21 2011 +0000

    Merged bug24631 into default

commit bd7547a49d051fde5ef278f4e1d8299c1b8da0cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 15 11:45:35 2011 +0000

    Ignore force_event_refresh if we have not finished handshaking.

commit 0c9e226a06f4a1b6f4c842e3e4775ccd1135beb7
Merge: 46628f29c 6cf72c517
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Dec 14 11:32:04 2011 -0800

    Merge bug24582

commit 6cf72c5170cf99f37e3c2afaa44a2ee41fbd23bd
Merge: 28a7ad1e9 b65fd7aff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 14 15:54:12 2011 +0000

    Merge bug24628 into default.

commit 28a7ad1e99f3d97661727d4acc46cba12eb73af7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 14 14:55:52 2011 +0000

    Updated definition of whereis_name

commit 0d3001e0e167ea2463e4c0a7ca45c3b0cb230c1f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 14 14:21:55 2011 +0000

    global:safe_whereis_name/1 has been removed

commit 86fa04997da714453d0a3f0aff83d8524514241a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 13 13:46:14 2011 +0000

    Ahem2

commit d9f81df4bace8612130668b648e172240c7909ab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 13 13:40:51 2011 +0000

    Ahem.

commit ec58e698e6bb1b606cf39546cd17e83ca20bf6ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 13 13:38:40 2011 +0000

    Show node diagnostics when we see timeout_waiting_for_tables.

commit b65fd7aff7ead1e33e85d5d5c9c9ab04671706e7
Merge: d63d878f9 f7579427c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 12 17:05:04 2011 +0000

    Merge bug24618

commit d63d878f92db01441311b93f985ea16440d295ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 12 17:04:50 2011 +0000

    Cosmetic / revert

commit ee72f7e21de7b1ef91010097b7e3520203c9795c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 12 14:02:38 2011 +0000

    remove rabbit dependencies from gm

commit cc50d8ebff3e74965674330aff0e83df0f2076f4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 9 16:17:06 2011 +0000

    Separate member construction function

commit fd644c5abe649c7b89d57fdd3387643cbd953964
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 9 15:41:59 2011 +0000

    Extend member structure to prevent pid collisions

commit f7579427ce34916481d61a8c3051555e93d8ddb7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 9 12:34:56 2011 +0000

    I think we can be sure that it's not.

commit 28f1cffa9bfd7edb7cf9a7fee3bb849f155f9b3b
Merge: 13803279a f837b64b3
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Wed Dec 7 10:58:09 2011 +0000

    Merge bug24595 into default

commit f837b64b3688776efec272ddc3f94a3937cb8a5a
Merge: e72443022 7436e04e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 5 17:37:52 2011 +0000

    Merge bug24607.

commit 2142d1b62ef070cb413222920dac858ad53c33df
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 5 14:44:40 2011 +0000

    add setting dlx routing key in queue.declare

commit e724430224ba966a507c9a636834be861524765b
Merge: 1aac220b0 3dfc9e0cf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 5 14:17:59 2011 +0000

    Merged bug24612 into default

commit 9dff074041a1107c799e3911fa3854c850f2984a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 5 13:11:33 2011 +0000

    record routing keys and exchanges when dead-lettering
    
    We don't record BCC routing keys, only basic.publish and CC ones.
    
    Also, there's little reason to prefix the individual fields in the "x-death"
    table with "x-death-", so don't.

commit 6344212b8cf87795985c78130d8c4e818e33ae94
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 5 11:58:00 2011 +0000

    include the time the message was dead-lettered

commit 707b3093a85e1e6ffdbb6acadbc2953d8d7dffb1
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Dec 2 17:32:36 2011 +0000

    Whitespace and tidy

commit 37c686f4e11c6c3445816509200575dbb1f28e14
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Dec 2 17:24:00 2011 +0000

    First attempt at writing out erl pid on win; not pretty, not fully tested, but it seems to work

commit 1aac220b0eb58f26f523bf4ea193b548edbce329
Merge: d297dfbe8 ae1bb4d6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 2 16:43:41 2011 +0000

    Merge bug 24608 (qproc and mirror_slave disagree on data structure for msg_id_to_channel)

commit d297dfbe836b4a02a8f31f2d0acbf3f318063e1b
Merge: 251dc0c0e 5930d0453
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 2 15:43:10 2011 +0000

    Merge bug 24561 (x-ha-policy=nodes doesn't fully cope with failure of master)

commit 9b528b2ffd95b35abc6ded96190ed62aba099596
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 1 22:23:44 2011 +0000

    refer to rationale from bug 24607

commit 7436e04e99ad134d186a2391e1f1e6dd2ce718e0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 1 21:57:32 2011 +0000

    reduce queue/exchange deletion complexity
    from O(binding_count^2) to O(binding_count)

commit 3dfc9e0cf848690da15c03e7561359e3de0f7a82
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 18:28:38 2011 +0000

    Matthiasness.

commit a1c79a7dd1c3d6392ff363bfe46cd322eb157bd2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 18:28:26 2011 +0000

    We need to distinguish between the already_started we make get back from the real supervisor (which we need to treat as a real error at init) and the one we cons up ourselves (which we can ignore at init since in general all the mirrored sups in a group will have the same childspecs). But we treat them both as errors for start_child though.

commit eb00309010121d9c443c9852c17edf5041f7bbbe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 18:15:00 2011 +0000

    Oops

commit 831f445a48394e0d8d368cef34b0cbf02bf32329
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 18:11:17 2011 +0000

    Handle children that fail to start at init properly, by shutting down.
    
    Maybe we should log something though.

commit ffd0e8891e3a8cd3af907163613b59958cbe0a31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 17:47:58 2011 +0000

    Slightly clearer.

commit ae1bb4d6ab5644b87fd37a89356157449c34dbfe
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Dec 1 17:05:15 2011 +0000

    Minor ecumenical matter

commit ef12656199d0d37d1d0d1159f71d4d4fb1c9123d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 16:57:37 2011 +0000

    Oops

commit 36f722be040867f8c03fc05cb3f0cb50e529f7a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 1 16:54:54 2011 +0000

    Failing test.

commit 5acd6a1d77673ac6270bdf8d02e9fcc51c193d1f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Dec 1 16:50:15 2011 +0000

    Foster agreement on type of msg_id_to_channel

commit 5505aa6ee7af3fba35fc4ca98cfeb12001c1b1df
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 1 08:54:29 2011 +0000

    add upgrade step

commit 81726295552b561d6ff6c4eb11bb525a9699680a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 30 15:53:05 2011 +0000

    tie up some loose ends for the new table

commit 9bd227ffcaf59eeaaab5f5df8d400384362703f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 30 15:14:18 2011 +0000

    now that we have table locks there is no need for phase separation
    This is essentially reverting to the code as it was before bug 23885,
    except using the new rabbit_topic_trie_node table for counts.

commit 5930d0453865b6a73919131e8b4a32c7f1938112
Merge: 8d9e6661f fa9a7e7e7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 30 13:01:10 2011 +0000

    Merged bug24591 into default

commit 956d4e321634f387ec04805388538799b3c8b66d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 30 11:14:21 2011 +0000

    only lock tables when we are dealing with multiple bindings

commit 13803279ade65e65ab2f0de01ff26b1ef155b258
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 30 10:39:28 2011 +0000

    Advice for windows service users when changing plugins

commit 2d651fe3732ae3497d5584d8e1a97968804f0ad0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 30 10:36:01 2011 +0000

    simplify

commit 2dc193878d2abd8cc8b0d70f3fb8d9cb27aa1351
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 30 10:27:57 2011 +0000

    reduce time complexity of binding removal on queue deletion
    from O(n^2) to O(n).
    The solution comes in two parts:
    
    1) a new table, rabbit_topic_trie_node, to explicitly track edge and
    binding counts of nodes in the trie. This eliminates expensive
    mnesia:match_object operations to determine these counts when needed.
    
    2) table-scope write locks to eliminate row-level locking, which is
    expensive when there are many such locks in a single transaction

commit 8d9e6661f74372f26c244f0cf7b389dc64e9983d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 29 19:32:45 2011 +0000

    comment out failing test to check whether others fail too

commit 28938a35c5ada85c5553ec45f7d769b62aad4fa1
Merge: 38af545ca bf657f51d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 29 15:18:57 2011 +0000

    Merged bug24578 into default

commit 38af545ca6445aa906575eb40638d14abd5304d5
Merge: 41b41f673 74dfa4dd0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 29 13:10:29 2011 +0000

    Merge bug 24392

commit 41b41f67387fa25a66d3cfe923762cce8f962523
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 29 11:42:56 2011 +0000

    ensure that rabbit dies when recovery fails
    rather than just sitting there

commit 74dfa4dd08dc5b2e90491694940965f054b65f91
Merge: e58525e56 fdb6e3bdf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 29 11:42:10 2011 +0000

    Merge bug24579

commit e58525e561fe88243662b7f04c7d93da1a32fecb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 29 11:41:55 2011 +0000

    Slight simplification that these vars are declared once and failure is a thunk.

commit 96aa1b9fe2538b9114bcb9536a1b278236dbfc60
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 28 20:37:37 2011 +0000

    ignore empty segment files
    We already ignore corrupted content.

commit 04bfde75cb646a34557b5460cb19a7daf9a4f68d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 28 16:39:35 2011 +0000

    Rearrange

commit 2e945e8df8d78b085752b223d29c2a07efde27a9
Merge: fdb6e3bdf 2ad1cc600
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 28 16:18:17 2011 +0000

    merge default into bug20337

commit 2ad1cc60082bc47b562dd72eec45e7b6869ce0da
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 28 15:29:29 2011 +0000

    fix tuple arity mismatch
    
    I strongly dislike dynamically-typed languages.

commit 013608177ac3cddcecb3d204239ceb70b6bae4c7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 28 14:45:28 2011 +0000

    don't hang if there are no DLQs bound to the DLX

commit fdb6e3bdfd51aa455da606f636b36d19a8181f20
Merge: 62d9204a2 c99557f6f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 28 14:22:20 2011 +0000

    Merged bug24593 into default

commit c554f590c987ed10178b5c8188e8f2ab40547206
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 28 11:28:12 2011 +0000

    death headers are now stored in an array of tables

commit 82d1942f9ab7809ccdb331e1ea5343b031131edd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 28 10:24:01 2011 +0000

    don't check dlx on queue.declare

commit 62d9204a234cdb1e6a34314f8e08a2960d20af56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 25 10:08:23 2011 +0000

    Still nicer error handling inspired by lib:eval_str/1.

commit 5af438f9367012024a1047ce5455237c48cb5ade
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 17:20:50 2011 +0000

    Also handle tokenising errors somewhat.

commit 77afb9616050648709b6ae2f7463dc2406e2dda3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 17:09:05 2011 +0000

    Handle RPCs that crash better.

commit 6f031d445e5d8fff88a0edbd2ffc51d3a924f621
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 17:07:36 2011 +0000

    Handle the most common parsing error nicely.

commit 218a9c73b6de4a7b3eeec84d17e3d1a44c4bea2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 16:51:28 2011 +0000

    Basic rabbitmqctl eval, with let-it-crash error handling.

commit fa9a7e7e7814fa297b59c62b08049145a7530d37
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 15:38:19 2011 +0000

    Move the try / catch into rabbit_networking.

commit 97ea55f69ff8c4a51a13753a395cfd71e2002e16
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 15:32:31 2011 +0000

    Filter out connections which no longer exist.

commit c99557f6fbe00eb6c29832b169bee68813f24a77
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 24 12:21:13 2011 +0000

    better reporting of location of failed test

commit e0634891c8164d6fe0aebbaab3bfb077acf2e447
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 24 10:55:01 2011 +0000

    Another attempt at reducing racy failures.

commit 01dcf6a810bd1cd8ead552a7a3924bf5170282c7
Merge: 73a310487 eb9fa45f9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 23 13:40:53 2011 +0000

    Merge bug 24467 (Autogenerated queue names don't pass validation)

commit 46628f29c2c45251ad0ca3ee45b34f8113c90d75
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 23 11:36:32 2011 +0000

    Use fixed service name

commit eb9fa45f9d3bfc280c1bd3c2b28e8e1f95dae15f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 23 00:37:47 2011 +0000

    base64url-encode for string guid generation
    this works well for AMQP (with its restrictions on queue name
    characters) but also when used as part of filenames, urls, etc

commit bf657f51df2533696c7fe090c54b258f8448e90c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 22 14:21:19 2011 +0000

    Don't add message id to the set of msgs we've heard of from gm but not channel, if we actually *have* heard of it from the channel.

commit 5a339e41d924aedf6c90077cdcb08f8fd0f2c3ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 22 10:10:11 2011 +0000

    Allow equivalence comparisons with absent values

commit 251dc0c0ec9b69ee0f413f6be0e0543e86333b8c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 22 09:33:04 2011 +0000

    Record the master together with all the slaves

commit 73a31048797f70aafae8ab7ff7c1aea5efbb8a4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 21 19:11:50 2011 +0000

    cosmetic

commit e09582b32dc46269349124e835d23b546477a933
Merge: e75018d7e b76b273cb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 17 12:23:21 2011 +0000

    Merged bug23052 into default

commit b76b273cbbbad95529bd6aa5b0ec868cef12f764
Merge: c83aafd1c 9b45e4cb3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 16 14:16:41 2011 +0000

    Merged bug24559 into default

commit 9b45e4cb316d0371a86ee595f23a21f2aa291b8d
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Nov 15 16:39:23 2011 +0000

    Put the real changes in  :-(

commit c83aafd1c3d34e35e8c21cf809b15e42f54c985b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 15 16:31:54 2011 +0000

    don't explain why we don't do something that doesn't work

commit 115031dee2ddc5d7bb68b6a29d8a352a74fbf68d
Merge: 049db5318 993c2383d
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Nov 15 16:23:20 2011 +0000

    Merge default into bug24559

commit 049db5318f4e73735db41d587e2daffbbab8788a
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Nov 15 16:19:55 2011 +0000

    Portfile updates for macports packaging

commit e041f9d892a3250acb273dccfb365693456a4fcc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Nov 15 16:14:59 2011 +0000

    only remove messages when ALL DLQs have confirmed
    
    Also, simulate confirms when a DLQ dies.

commit 993c2383db591571f04b056021d94fe162b1071a
Merge: d3aca6715 341e00624
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 15 15:58:30 2011 +0000

    Merged bug24560 into default

commit d3aca6715f1f29ca4410f5b132135f5dc3fbc794
Merge: d2f22b673 d3dafe16f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 15 15:08:22 2011 +0000

    Merged bug23462 into default

commit 210753283340f608726431a2e24975d1834791fb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Nov 15 14:54:32 2011 +0000

    monitor the DLQs

commit 4233681bbc79c022e8bf5f2114c407fe2d744fef
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Nov 15 14:02:58 2011 +0000

    removed reminder comment
    
    There seems to already be a mechanism in place for this.
    amqqueue_process:next_state/1 confirms the messages reported by
    VQ:drain_confirmed/1, and this seems to work fine for the other cases.

commit 5e1647232f7e6ee3b71fdfd47b083591773e34e8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Nov 15 13:54:28 2011 +0000

    wait for DLQ to confirm messages before deleting the queue

commit d2f22b673b42e15bc4259bb7698f8b45904b2943
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 15 13:16:17 2011 +0000

    More clarity.

commit e6a60dc204f902e6aec3da20cd486fd27969b018
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 15 13:12:51 2011 +0000

    Use {node(), make_ref()} rather than self().

commit 341e006242e3ffbee37a5fbb6a3747cfd039d636
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 15 11:57:32 2011 +0000

    Duh

commit d6878f2eb30e5a7a26348812a86e725fdc2ba921
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 15 11:55:03 2011 +0000

    If we get an explicit channel close we might already be shutting the connection down - in which case we should check if we have no more channels left and close_ok the connection if so.

commit cd2b0f85f5a1d351d7e287caad1e283d21d5d945
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 17:03:26 2011 +0000

    partial wait-for-DLQ-before-deleting-queue

commit 38f64271fecd7fab463f0c27f7a4a1eda2307c07
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 16:40:50 2011 +0000

    spread out the dead-lettering on queue deletion

commit 11c0813c08a8c6281a7b55ceecdbaa7d13e2fba8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 16:22:26 2011 +0000

    don't remove purged messages until the DLQ has confirmed them
    
    Also, block the queue.purge_ok until the messages have reached the DLQ safely.

commit aa0c973fbb6a456bc1b22031be6b9cf8d95a8f1f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 15:19:05 2011 +0000

    don't remove expired messages until the DLQ has confirmed them

commit e56430b201a41ccd11a8852d1491c6496b9bfcd2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 14:36:35 2011 +0000

    don't remove rejected message before it is confirmed by the DLQ

commit 7af4d955136480da2f947aedf6ba578afa4d330b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 14 12:05:05 2011 +0000

    amqqueue_process re-publishes with confirms

commit e75018d7e8e34c7173e0bf50336a9a5122caf985
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 9 17:40:37 2011 +0000

    No longer download a garbled copy of the install / build instructions from the website.

commit d3dafe16fc23aed0483463644e8adaf106e68674
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Nov 9 10:20:22 2011 +0000

    Added tag rabbitmq_v2_7_0 for changeset 353c527677e1

commit ef64581e6d60b637f1d7b743a2b7c3f50f5b1ad4
Author: Steve Powell <steve@rabbitmq.com>
Date:   Wed Nov 9 10:13:45 2011 +0000

    Updated changelogs by release build

commit b8081c680b9557e52a5dd58a3ef43acc0fcae5f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 7 15:29:42 2011 +0000

    unbreak variable queue assertions

commit 5e8643f947be0e0eb07a7a1eff9b8cdbbc58f27c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 7 14:20:38 2011 +0000

    more consistent naming

commit bd54ca5fe425d8fb316987f8db991b156f514221
Merge: 6c5e554fc d82d34cb3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 7 13:07:30 2011 +0000

    Merged bug24534 into default

commit d82d34cb379cc6c00f02b42288e176a298f696b6
Merge: cc9747ed9 c60fdf213
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 7 12:47:18 2011 +0000

    Merge bug24430.

commit cc9747ed9b514debc212a380eaee769c4711dee2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 7 12:42:55 2011 +0000

    Cosmetic

commit 6c5e554fc596ef3149a32a7e9335117d58b125a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 7 12:16:13 2011 +0000

    Big ugly warning.

commit ffbe61e27e210ae6e0002418c27f014af9ba8689
Merge: 61f48f086 c60fdf213
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 7 12:06:57 2011 +0000

    merge default into bug20337

commit 42dbab810891e59c6396c5b8b85ba1f8a327c5ff
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 3 16:03:45 2011 +0000

    send_after does not accept infinity as an argument

commit c60fdf21357804931761fa154c803259dcdf20c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 3 11:43:40 2011 +0000

    Resurrect default

commit 59697f8cc0e684e27629d9709de92ff1db8aca6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 14:27:45 2011 +0000

    Correct thinko - permanent + normal is an error, duh!
    
    (And some slightly evil formatting, but I really don't want this to wrap.)

commit b7b41085cca0b463df2509c3319009fb0187a0b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 13:18:34 2011 +0000

    Oops

commit 549aba2e04926e92906bd249870d423d99b6414f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 13:17:27 2011 +0000

    Refactor: reduce distance from default.

commit 67bb7dca1b555186046f9327009faa048fade25c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 12:41:38 2011 +0000

    Refactor: don't use a dict when a list will do.

commit c7c658a666649bf84104585078cc595425fb8546
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 12:29:39 2011 +0000

    Refactor: simplify by checking if restart is permanent earlier.

commit e3db319524604bacd9e14f6bb1bcdc54917ef695
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 12:24:53 2011 +0000

    Refactor: I like closures as much as the next chap, but that was too many.

commit 333ac493a964230bc384b00f6c47e08a8d052241
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 2 12:02:17 2011 +0000

    Cosmetic: pattern-match more, factor out dict:append, fix unused var.

commit b78878f27634f3b1124363925ef84c0f0f34f943
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 2 11:19:49 2011 +0000

    Indent correctly

commit 3be4c1e3432ee288c552576d4b3037b4746b7e2c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 1 18:28:51 2011 +0000

    Refactor supervisor shutdown more

commit caa744fc478191b0af7babcb5de5d68934a41424
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 1 16:47:29 2011 +0000

    Refactor supervisor shutdown

commit 2a979749ccd6c0cc1f6612ae19aded3685113b63
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 1 16:39:45 2011 +0000

    More accurate timeouts during supervisor shutdown

commit d8ec056a2f8a90c5b5c6a2a069c1ddfe69feb235
Merge: 9d88c741d 8855b5b6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 1 11:33:58 2011 +0000

    Merge bug24525

commit 9d88c741dc1285879759e734d5f0fa58aec746ee
Merge: ffcb10beb 76116cdb4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 31 16:35:29 2011 +0000

    Merged bug24517 into default

commit 76116cdb4d6fd916411e1324e9f03601d3172ece
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 31 16:34:24 2011 +0000

    Whitespace

commit b5a761c9ac6c05ed9aee8c7ae7fa95a533f90514
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 31 16:18:51 2011 +0000

    refactor

commit 8855b5b6dc455d895130b3001e7ae44cd5afccbc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 31 13:27:58 2011 +0000

    Consistency with wait_for_tables.

commit 7c9a105340780d66408dba7c286d61a72de4968a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 31 12:07:31 2011 +0000

    remove debugging printf

commit d6c3c5870c255b675d0dd250f3181393f7edaa57
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 31 11:59:15 2011 +0000

    cosmetic

commit 3a82eb250eda38be3c9483e89b7373811972d6b6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 31 11:54:29 2011 +0000

    timeout epmd connection after 60s

commit f21d5c370557dac41288b672ff9b5921db5fbb93
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 31 10:29:06 2011 +0000

    fix case + cosmetic

commit ffcb10bebde966300d0c7b0448cc7a35d561433d
Merge: 6754c841f 98ee8d916
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 28 18:05:38 2011 +0100

    merge bug24513 into default

commit 6754c841f6922cba418b9b95374d3bf85fc5e7be
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 28 17:59:03 2011 +0100

    tweak

commit bca631d7a7abab811aff8dfdbbe0c990a3c4a214
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 28 16:43:37 2011 +0100

    I feel really in control of Rabbit right now.

commit 2bde28a0f74e7892b82ac59c3ea18eb544195f5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 28 16:21:59 2011 +0100

    Inline

commit 2800502f568611f3d9271800834935fc825d1b86
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 28 16:05:37 2011 +0100

    Surely I should inline that 'wait'.

commit dac47d81cc7ed1e029071bdae9a1f3377293fcb8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 28 16:01:50 2011 +0100

    And don't send a ref, use a monitor instead. That way we don't need to try / catch in the spawned process.

commit 3c5a49e31e7d434f3d6b6e4d5830a597fca211ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 28 14:42:11 2011 +0100

    Send a ref

commit 98ee8d9169e39470c081f7fe7a0d7b066190b6bf
Merge: 0f1b04ee6 6efdea89c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 27 14:37:44 2011 +0100

    Merge bug24522.

commit 0f1b04ee673932aa8d962a0ccfa516dc8f6fc611
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 27 14:35:52 2011 +0100

    Since it may be sane to set the watermark to "0.0", let's allow "0" for that.

commit e5c46ade80810eef1ccd0f03bf9d63f0f7799c6a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 27 13:20:32 2011 +0100

    Reduce nesting of case statements
    
    (Courtesy of Matthias)

commit b75157b9a7b0f133277ba824815fb65359dfcbe0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 27 11:48:01 2011 +0100

    Change the meaning of vm_memory_high_watermark = 0.0
    
    Setting vm_memory_high_watermark to zero disabled memory monitoring.
    Now we treat 0.0 as a normal percentage, which guarantees that the
    memory alarm will always be triggered, making it impossible to publish.

commit 6efdea89c956dd2c3ec787941ea98616898474e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 17:31:09 2011 +0100

    Resurrect default without bug24494

commit af4080cea71658a97a06e7b9e4037e2399a1c037
Merge: 8945393a8 428ea7c88
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 14:43:27 2011 +0100

    Merge bug24308 (msg_store perf unnecessarily bounded by disk)

commit fb39b75030bfbeacda12f3ce19f7e9ab44d47422
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 13:40:51 2011 +0100

    Use multiple processes for compilation. 2 seems to be as fast as any > 1, but this does go about 25% faster for me.

commit e4420200ce9904fb78debd918c5cda4c0c677656
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 26 13:38:45 2011 +0100

    break on too many args

commit 94aa722ade648165c7c12b681575bad1d7b9de66
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 26 13:34:22 2011 +0100

    refactor and rename

commit 2c809f93f1d70f14d7778e7ff661d40b158c08c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 11:50:04 2011 +0100

    It turns out that I can't even design ascii art correctly.

commit 13696cd41ddc795ee0030eb8c0899cd1543f57a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 11:45:26 2011 +0100

    More simpler

commit e15c0f2325f449f25c2dc69b34a2fdf6808a6610
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 11:41:06 2011 +0100

    If HiPE is not available, print an error message and continue.

commit 428ea7c88dc5a2cfe0a4efa544ea86c4b8fac42f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 26 11:12:39 2011 +0100

    This is still failing occasionally in CI, I must have tuned the value for my workstation...

commit 49b257a4b21c66d9eed7b0a120b0dcd26d4a2712
Merge: 3c96c0343 2cef73fa1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 25 19:20:27 2011 +0100

    merge bug 24511 into default (VQ soak test must generate unique message IDs)

commit 9043f5df575bf1f067c99afaa2eed20a998171c0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 25 16:53:19 2011 +0100

    no more magic numbers

commit 7667ec8b557981f65d4391b30805b813b6f18002
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 25 16:51:58 2011 +0100

    refactor + guard against garbage

commit e47f91aa09663cd5969c824cca78fe03c5001589
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 25 15:45:13 2011 +0100

    rebase on default

commit 3c96c0343b754f090d751bdeaa85e4a3a14ae6fa
Merge: b6c4497fc 4e6377cc7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 25 12:27:48 2011 +0100

    Merged bug24516 into default

commit b6c4497fc701ed4a9e99e99ced9c6863e40f5f4c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 25 10:29:24 2011 +0100

    close stdin in init script

commit 8ef7d5466098cb7b617367850deec4df8d3ced77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 24 18:37:59 2011 +0100

    Oops, forgot to add this one.

commit b8468aa1969499e5fb0f5adfa8d304b46eea2a93
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 24 18:21:56 2011 +0100

    Go faster stripes.

commit 4e6377cc7d56d92f3f5721308591ba3c3872fb18
Merge: de2c1e93f 336525153
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 24 12:24:56 2011 +0100

    merge bug24514 into default (soak tests broken due to api change from bug 24509)

commit 2cef73fa13b632c611dd52b18a365ebe1849fef3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 24 11:39:40 2011 +0100

    Update escript and docs

commit 3365251532519553547b15fcffc6fa916c4fc3cb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 24 10:15:43 2011 +0100

    Update VQ soak tests for new requeue API

commit de2c1e93fd88da4f3d4a952d74dcb3581fd219e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 24 09:08:43 2011 +0100

    a spot of inlining/renaming

commit 72f09c04ab844d2ce99ea20003947a72e74d9867
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 22 14:12:19 2011 +0100

    minor optimisation: switch from dict to gb_trees
    ...for the msg_id_to_channel map in the queue process. This doesn't
    actually produce any noticable gain, but we use gb_sets/trees
    everywhere else in the 'confirm' logic and this was the only place in
    the code where a dict was keyed on msg_ids.

commit 1a126a457c74b1e2fc45d13af9b993dbb31936f3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 21 19:07:58 2011 +0100

    eliminate unused var warning

commit ca0a3fe5b462f8029ee6c3252b8b889b019f2418
Merge: 2ffe72b11 d532140b4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 21 19:01:30 2011 +0100

    merge bug24504 into default

commit d532140b40aa0a61a6c045c8f428942719452b09
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 21 18:30:24 2011 +0100

    expand scope of "no alternate exchange" optimisation
    to cover the "routed somewhere" case too

commit 2ffe72b11babe52cbc28c8205015ed6425e65f9a
Merge: 8b267b22d bacd03480
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 21 14:11:58 2011 +0100

    Merge bug24509

commit bacd03480b93bc3e88fee988b2a35b8cc23d23d4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 21 14:11:09 2011 +0100

    Cosmetic

commit 31fb2a346f5165fad369a37ee93d09a86a2347a0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 20 18:12:49 2011 +0100

    Publish multiple differently in soak test

commit 61f48f0867ca77de86a224db3ba1855497dc722b
Merge: e8dfee98a 0128bf7cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 20 17:01:50 2011 +0100

    Crude merge-from-default to help examine this thing. Currently some tests fail due to q_p blowing up with failed assertions, I don't know if it was like that before.

commit 3a200963ebdf5651c2fd8693e40a9b7fc7bdc1dc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 20 16:22:35 2011 +0100

    Refrain from resetting message expiry in message requeue

commit 8b267b22d9f2551875adc7763bc6a784a2312fe9
Merge: e8dfee98a 3e06c88ea
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Oct 20 16:05:52 2011 +0100

    merge heads

commit 3e06c88ea1ffe6c7ccaf905c0c0173e224ed2925
Merge: 937f775e4 e972ee82d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Oct 20 15:10:13 2011 +0100

    merge bug24510 (make start-background-node start-rabbit-on-node breaks logging after bug 24332)
    
    Also, don't fail if rabbit is already loaded.

commit 937f775e42aeeae7726ae780a884644cdd828751
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 20 13:21:11 2011 +0100

    Load rabbit first.

commit e8dfee98ae3033453a4bb83baa464f1e822fdded
Merge: e972ee82d d7c3862b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 20 12:11:20 2011 +0100

    Merge bug24508.

commit d7c3862b62b482dcb13a57a1297ece3c50f703eb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 20 00:17:44 2011 +0100

    replace timer:apply_interval with timer:send_interval
    The latter doesn't churn processes and doesn't require exporting of
    functions we otherwise wouldn't.

commit e972ee82d5691f19f51f589f6a3890ce89b590d4
Merge: 7c0a6ba3a e0402a92d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 19 16:27:32 2011 +0100

    Merged bug24362 into default

commit e0402a92dcffab585da88c582f1518e02e0c2575
Merge: 558360e29 bd03952d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 16:26:32 2011 +0100

    Merge bug24481

commit 558360e29f3c8b4fa434b6c06a0bb1561ad4607e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 16:26:17 2011 +0100

    Cosmetic

commit e0e552ba67fd8989f4398346732aa94d7db89945
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 15:43:32 2011 +0100

    Revert 910c670238ad (Produce guids a bit more efficiently)

commit 21a3e39ce5b2b833d147b529c0276f1e27398e0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 15:23:03 2011 +0100

    3) Cache results of rabbit_registry:lookup_module() for exchange types in the process dictionary.

commit 502fc9e8c1009549780f98a06188ad36824c4252
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 15:22:34 2011 +0100

    2) Produce guids a bit more efficiently.
    
    (At the cost of limiting us to 2^64 messages published per channel.)

commit 5874d8c3ee0577366d23402e4674f194341451e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 15:21:28 2011 +0100

    1) Don't even consider alternate exchanges for exchanges with no args.

commit 226ce8bd8673fa1eeacf02bd07ae17c31a329547
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 19 13:59:13 2011 +0100

    Saner naming

commit d1cbb6a15f03e4ad71317d9f6fe29a4f3ecb3345
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 19 12:58:12 2011 +0100

    Perform semantic equivalence test

commit bd03952d21529a83951b21d86b1c227c0e35916e
Merge: 20aa89375 8d40a6229
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 19 12:40:18 2011 +0100

    Merge bug17162.

commit 20aa893754c121c294fdf93a9245aa953be0dcd9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 19 10:48:15 2011 +0100

    yet another attempt to reduce timeouts in CI
    - catch surplus eagerly
    - wait longer for confirms, wait shorter for any surplus

commit 8d40a6229ee9586169f6a19f95db338bbbb10b8a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 18 17:21:04 2011 +0100

    remove parse_properties (again) and rename test

commit dc01c06e144659bc6b0463f5102cfe0b9447fd13
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 18 16:39:05 2011 +0100

    small routing optimisation and re-add parse_properties
    
    Parse_properties is now only used to test encode_properties.

commit 68f4bca221d30fd717a20fce658e06ebae9a8028
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 18 16:37:53 2011 +0100

    As noted in bug17162 comment 13, this delivers a few percent improvement on MM -y 0.

commit c39552f40677a7e91c1488f994da13aba1a3e038
Merge: 20052e7a1 3d4fd8774
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 18 15:54:26 2011 +0100

    Merged bug24460 into default

commit 20052e7a1f10e7226f3a6cdfdf884d1773678d98
Merge: 481244e57 e01c209aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 18 13:34:16 2011 +0100

    Merge bug24483

commit 15e365893642cf172f0c3ef0d3d075269e6a20ae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 18 10:04:13 2011 +0100

    cosmetic
    
    And fix the '_':2 thing.

commit e01c209aa5460131494880e0420f2e4d188dca49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:56:02 2011 +0100

    looks like a 200ms wait is still not enough to keep CI happy

commit 8945393a86bac954a767f8145dac6e8332840327
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:32:36 2011 +0100

    more accurate description of flying_ets table

commit 8938793638abbbb0abc3c14f51d95dfa0931424c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:31:49 2011 +0100

    explain why client_update_flying phase 3 will always succeed

commit 143e1a9ef130be85efa7407ec378adbc175ffdda
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:12:21 2011 +0100

    refactor: revert change to var name

commit 16a323ef4b02ef579673a72e8e90b9e6f9e89d16
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:11:01 2011 +0100

    refactor: rename update_flying/3 to client_update_flying/3

commit dad77785211e769499869a88a8d1d19528defbf7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 19:09:39 2011 +0100

    fix bug

commit 6f4b92bfdfe96691695d797f637288386e28220b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 17 16:51:23 2011 +0100

    unroll property parser
    
    The codegen code is quite ugly now; I'll see what I can do about that.

commit 73a83d32fad3f3c06f6ddc98c52b498743f401fb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 17 14:45:16 2011 +0100

    Give up on attempting to improve clarity.

commit 481244e575d7f7416c624aff03d87db1e288302b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 17 14:44:29 2011 +0100

    Windows slashes

commit 2f8ab8bbf679effb2048e050c0ba3757f167bdf0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 17 14:42:37 2011 +0100

    Rephrase to make Matthias happier...

commit 2e63caebdcc684aff35f18aefa1156cd3fa73b82
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 17 14:32:30 2011 +0100

    I find this clearer

commit fb31be91ed49bb67a73028bff531317daa53167e
Merge: 047cc2de6 712ad8a29
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 17 14:26:31 2011 +0100

    merge bug24455 into default

commit 712ad8a29635da184bda64431bd7da6d671e1f76
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 17 13:02:02 2011 +0100

    Minor tweaks

commit 752794f58c9227fdcf8b29a72154751c0b982fb5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 17 12:47:09 2011 +0100

    Having thought about and discussed the code and desires, change things around a bit.

commit 6f8aefa84ee409f1ac9590d79cf810fefa7d7479
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 17 11:58:23 2011 +0100

    Better supervisor2 shutdown handling

commit 3d4fd8774d253d824d8039986e1cf2dc24500d93
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 17 10:47:30 2011 +0100

    remove redundant usort
    
    It used to be there because it tended to speed things up for some reason.

commit 8ce764b905664552405014941f3075b0c372e37c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 17 10:25:58 2011 +0100

    properly sort the queue of acks

commit 041c45e3568589fbd0361c8e5e5a7751fd7b0c4c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 16:20:26 2011 +0100

    cosmetic + correct specs for lqueue:peek{_r}

commit cca9049a46797ad6c2694957726caebefc7e184b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 15:56:35 2011 +0100

    oops

commit 2a4e7bbc33b268ddd0113295fdbb39d6e416239d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Oct 15 15:48:20 2011 +0100

    Revert lqueue so it does not cache ends of queue as we no longer need this to be O(1).

commit 19c5ecf4b6bbb0185fbbf38534dd93ad5c1b4d8c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 15:11:24 2011 +0100

    refactor: extract delta assertions into one place

commit b10d29e63dd5deb6772657ac52233d4ee3494e54
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 15:11:01 2011 +0100

    doc tidying

commit 0c29b6eb0fe4a42bf984f9d6da9c5ba520a35877
Merge: 047cc2de6 1746889b9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 14:27:24 2011 +0100

    merge default into bug24455

commit 047cc2de6f88b51eacc7a98d0be731a0d9d9d6f4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 14:27:02 2011 +0100

    minor optimisation in qi: keep unsynced_msg_ids in a gb_set
    ...which avoids the conversion from list to set in notify_sync
    Extracted from bug24455.

commit e30b03e315f540aeca383ae8ad3a29eedeb436ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:46:34 2011 +0100

    rename 'removed' confirmation event name to 'ignored'
    since that reflects its meaning better

commit a0fd784d7dbfbee544b91aef7fc4027cdd7a9701
Merge: 370a19c95 2c51116a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:27:36 2011 +0100

    merge default into bug24308

commit 2c51116a998daa1c1a6314de0e942168eb1b70d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:25:23 2011 +0100

    a spot of inlining

commit 370a19c95af58bbb61d727fa7a9868adf698697c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:07:42 2011 +0100

    get coverage of timer-based sync/confirm

commit 60ef7fddd9f8f0d664b65529b7435b94155bc0ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:07:18 2011 +0100

    increase likelihood of hitting 'dying client' optimisation

commit 2f59dc43832d6fccb8c3fc64c595f23df56be989
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 15 12:06:41 2011 +0100

    increase timeout
    to match what's on 'default'

commit 10db9f9de5b4a7ee082b431f7b04cf39fb04ff6f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 14 23:14:52 2011 +0100

    improve code coverage
    this gets us close to the same coverage as 'default'. One notable
    exception is dying-client elimination of 'remove', which is proving
    rather elusive.

commit ea3c15e3d5e2006bdfc6d13e7a5b07860e828085
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 14 16:49:10 2011 +0100

    Terminate simple children in parallel

commit 7c0a6ba3abd29d9ab0f4ca72c8c2e48b86064281
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 14 14:18:44 2011 +0100

    Give the supervisor hierarchy a chance to quiesce at the end of each test.

commit cc564c8bcc0c916d65bbf306fd5ba03d6421cd29
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 14 14:08:52 2011 +0100

    documentation

commit 8c2bb842971f2dcf6513eef84704bc3e2ecd0394
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 14 13:02:15 2011 +0100

    fix error reporting

commit 8c11990a09621282cb5674cf7a70e35ee438001d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 13 23:20:43 2011 +0100

    double timeout to reduce ci test failure frequency

commit 9e8e0da1d388acc64bc5263848edfd0943282153
Merge: 73bf86e97 1f357d9fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 13 16:51:53 2011 +0100

    Merge bug24478

commit b24a343140b46f3c2d3ada863253ff2b38c7ac69
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 13 16:41:35 2011 +0100

    Use backslashes

commit 1f357d9fd629fc2de23b1a65895be8366b7f1ae5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 13 16:37:52 2011 +0100

    Use $() like we do elsewhere, add a tiny bit more comment.

commit 95fb041d2e5dfc64306ee84ce0187ce730abc437
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 13 12:19:33 2011 +0100

    Don't record cygwin pid for rabbitmqctl wait

commit 78cd23612bdf9602ab36cf0f9bca5d164b1f7c1f
Merge: 41f6b85d7 73bf86e97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 12 22:08:12 2011 +0100

    merge default into bug24308

commit 1746889b95a47b592c65f2675a9487f39807dddf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 20:55:20 2011 +0100

    Because I've got rid of ram_index_count (i.e. betas count), and because the guard around whether or not betas_to_deltas is now based on q2 and q3 len rather than ram_index_count, we no longer need to have the separate gammas_to_deltas fun, which means we should no longer have the problem with it being called too often as we should be able to rely on the chunk stuff working out.

commit 8e9bcf586365bb1be70db2cc10775e18dbe9625a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 20:30:46 2011 +0100

    gb_sets:from_list(X) is slow. gb_sets:from_ordset(lists:usort(X)) is faster. Just keeping it as a gb_set throughout is fastest still.

commit fb80c8c3b2b435d5bce23fccb6f1e5b512f6d44f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 16:24:35 2011 +0100

    Update docs

commit 27b9e7d97086f48ef5a4b0030f707766fc981a72
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 15:27:06 2011 +0100

    Undo that last change, but still ensure q3 ends on a segment boundary by giving q2 priority over q3 beyond the segment boundary of q3

commit 73bf86e97f63597da2bbd6567d5940d05d47924f
Merge: 8055e7d80 4fa1d121f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 12 15:17:52 2011 +0100

    Merge bug24477

commit 4fa1d121f319b290e12beb8f36d2a7df8b99487f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 12 15:17:37 2011 +0100

    Explain a bit

commit 3b6108f1fe79cdcbf7dcbb0dc91d0da60045c425
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 14:40:12 2011 +0100

    cosmetic, and be somewhat smarter about deciding the minimum length of q3 (now must end on a segment boundary - minor optimisation)

commit fae4da6b71bfb923cc44b7e506edad1e55b5ef75
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 12 14:15:22 2011 +0100

    Cache both ends of the queue to give O(1) peek and peek_r

commit 7871f27da1dc0bd2ae7ff7b9e72e80315186017d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 11 22:43:43 2011 +0100

    only confirm messages on 'remove' that are pending confirmation

commit 518705ee30888ceb519a378baa49327ff7c8550d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 11 22:42:37 2011 +0100

    add tests for msg_store confirm logic

commit 033fc53d7aba10cc70457c24fc712ee2325f7310
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 11 22:40:22 2011 +0100

    make tests wait for *exactly* the right confirms, no more, no fewer
    This does introduce a 100ms pause for every invocation; hopefully
    enough for the msg_store to catch up and sync (the sync interval is
    25ms) the usually small numbers of messages.
    
    The confirm capture code now uses lists rather than gb_sets, as a
    convenient 'bag' data structure. This can have O(n^2) perf, but we
    only need to start worrying about that when the tests call this code
    with thousands of msg ids, which currently they don't.

commit 8055e7d8059d9421e1232d226e5d9383c80734c1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 11 20:27:59 2011 +0100

    abide by the msg_store API constraints in the tests

commit ff3430c509458ed48568f3d7b19607531d6dca63
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 11 18:20:29 2011 +0100

    Do not use q1+q4 length when calculating permitted ?s - if you do, then as the queue is slowly drained, even whilst target_ram_count may be growing, you can end up writing more out to disk. Instead, use the target_ram_count directly as an indication of ?s. This is preferable as it indicates the permitted ?s which is obviously suitable for use when calculating the permitted ?s.

commit b558d28a63ba9c84e4d33dcf4775692b894f3ff0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 11 18:02:04 2011 +0100

    Add peek and peek_r to lqueue, and use them in needs_timeout. Whilst this is better, it's still O(N) per msg, so we shouldn't actually be doing even this...

commit 2e0752768e98f771aed71bd711805e2c57fa2b56
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 11 16:47:12 2011 +0100

    When under memory pressure, we want to limit the size of q2 and q3, not just of ?s. Simplify calculation of permitted length. Simplify (and correct) expansion of ?. We can now completely drop ram_index_count as we never care about just the number of ?s.

commit 41f6b85d766098ac7ee62bfbaf5b41bf4cee82b2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 11 16:45:27 2011 +0100

    issue confirms when needed (and only then)
    This also fixes a bug that is present on 'default', namely that we
    used to always issue a confirm on 'remove' regardless of whether there
    was preceding 'write'.

commit 554dab58bb812d805e55247b136467d4e283a6fe
Merge: 3735abb0d f88351e10
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 11 15:45:36 2011 +0100

    Merge bug21319 (include plugins in source and binary packages)

commit 3735abb0db665a0d7231896e4d04d74e39856356
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 11 15:14:40 2011 +0100

    Add another format: minimal. Just the name of the plugin, one per line. rabbitmq-plugins will be used in automation, let's not make it painful.

commit 548c120de5051818ff13f21b65a30dace870fcb9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 11 14:27:00 2011 +0100

    Trivial cosmeticism.

commit ff083c90f67eebf0817c720e0129ee32e969b4d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 11 14:25:10 2011 +0100

    If the user specifies the name of a non-existent plugin to disable, then we should actually disable it if it's enabled - otherwise we can never remove non-existent plugins from the enabled_plugins file.

commit 378a659529d8d58671997af3bb94707a7936e430
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 11 14:23:21 2011 +0100

    If the user tries to enable a non-existent plugin, actually blow up and do nothing. Otherwise we end up with typos in the enabled_plugins file.

commit 3f3b79aa89a937f6c351cd29541060dc704ef37e
Merge: f04c2946b f88351e10
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 11 13:40:29 2011 +0100

    Merging default to bug24455

commit f04c2946b50aa7f9c0eb4becbcdea726f00f120b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 11 13:37:21 2011 +0100

    Ensure that we push ?-bordering ?s into ? eagerly.

commit 02349e945480aff4e6c9a0e0a9a0c6a9153d7900
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 10 19:37:00 2011 +0100

    refactoring: extract core of 'write' handler
    similar to what we already did for 'remove'
    Also, don't add the 'dying client' marker message to the pending
    confirms. While that does no harm, it is clearly not right.

commit 3adc1ab43489a23b5ef00fc1c82fe34c7d8d096d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 10 18:33:05 2011 +0100

    cosmetic

commit 96349d7f45850d182655a8106fb58089b76d7497
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 10 18:26:18 2011 +0100

    there's more than one call site for remove_message...
    ...and only one of them must pay attention to flying_ets

commit 2ef30dc95eaa7e04a0371fef0de8154f40a36685
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 10 18:19:33 2011 +0100

    be more careful about deleting cur_file_cache_ets entries

commit ad9e24a3de5d631a9f35dcca6358b16e8615b3ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 10 17:15:40 2011 +0100

    Adhere to corporate branding policy.

commit 0d9d090cffb20527036083905904420b9f2c6d8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 10 17:15:23 2011 +0100

    Typo.

commit a5cbaee2b793d03755eb4c7744bc5cedc18f672e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 10 17:15:13 2011 +0100

    Explain statuses.

commit a77d7185c9eb28aaf8c87221c018cb50e0c0df42
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 10 12:54:14 2011 +0100

    include the spec files' license info

commit de23ab89c84aaf71a0853eecf6c0a4fe2718396d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 10 12:46:56 2011 +0100

    generate release LICENSE file

commit d8a7e93e3e722bb31184aa462cecd0cc1bcbc99b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 10 10:21:00 2011 +0100

    find the LICENSE files

commit fe15c3ac5d5186506702c46b0f0cb2e8dcbb2530
Merge: f88351e10 6c358592c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 10 09:51:56 2011 +0100

    merge default into bug21319

commit 60a02152a77f802b08d5fc27e8c1a91b048732d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 9 20:33:36 2011 +0100

    I'm pretty sure this is correct

commit f88351e1078750fcfc5f8b8a66bda5a3b1aece12
Merge: b1ef2b126 cb360e2c5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 6 16:12:13 2011 +0100

    Merged bug24461 into default

commit cb360e2c53d982631201e5c3fc33589528853cfd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 6 02:25:01 2011 +0100

    inline publish/5

commit 06eba8a0d22b5dae27db2923e494d46576af3410
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 6 02:05:12 2011 +0100

    slightly more obvious flying_writes accounting
    and move the cache cleanup from 'remove' to 'write', which is a more
    obvious place. Improve docs on that too.

commit e83bdef7c2060f55c9d2adc1f34393719d0740f6
Merge: 6bfb38647 5361e9727
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 6 01:38:53 2011 +0100

    merge default into bug24308

commit 6c358592c74a2da74a84920a4eec57f8b99a162a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 5 16:54:03 2011 +0100

    Slightly better message

commit 6bfb3864795b80e2cb67c5fe0f74f4903f54a7e5
Merge: 377e4dbe1 76f96c8fc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 5 14:49:14 2011 +0100

    Merged bug24459 into default

commit 8e06d03debb2d39449ad5e2b90599bb3b5a6e4e4
Merge: 587e3cf8a 234c2cd96
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 4 14:43:27 2011 +0100

    Merging default into bug24455

commit 377e4dbe191e5f9957e958dea0a49512cbc37ec5
Merge: 587e3cf8a c081bfb3a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 4 14:02:22 2011 +0100

    Merged bug24462 into default

commit b6bc816d887115d48e9b524061373d6fb662db88
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 19:02:22 2011 +0100

    bin_to_list -> binary_to_list

commit 4b5d706bee2f7951aa7cd23a59c5d23888893a7b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 18:53:00 2011 +0100

    make portsfile consistent

commit 1cd09c6053fdde6bf7895ba76ed0fcf17ea02333
Merge: 96f6e92c9 d79232fcf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 18:43:39 2011 +0100

    merge heads

commit d79232fcfef6de81b22d75d34a83bea72bcc504e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 3 18:21:09 2011 +0100

    Don't print the list of enabled / disabled / missing plugins with ~p, it's not very readable.

commit 96f6e92c986a375b01cad23dab297e7f72ae5586
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 16:45:50 2011 +0100

    add all LICENSE files to the RPM
    
    The rules are here:
      http://fedoraproject.org/wiki/Packaging:LicensingGuidelines
    
    They just say that the package should contain a license file and that it
    should be %doc.
    
    We could specify the multiple licenses in the License: field at the top, but
    that's just going to be annoying.
    
    We are kind of going against
      http://fedoraproject.org/wiki/Packaging:No_Bundled_Libraries
    but CouchDB does the same thing with mochiweb, etap, ibrowse and erlang-oauth,
    and Ejabberd does the same thing with eldap.

commit c081bfb3a1685c340118bf187344ab634a256cc0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 3 14:32:26 2011 +0100

    Don't blow up when nodes policy is used.

commit e1ee221f2806f97b15a43fb5394aab3335388701
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 14:10:03 2011 +0100

    update debian copyright info
    
    The rules are here:
      http://www.debian.org/doc/debian-policy/ch-docs.html#s-copyrightfile
    
    We're supposed to say who holds copyright, where the upstream source is and
    include the full text of the license (with the exception of Apache 2.0, which
    is a common license).

commit 587e3cf8aa4c4308662b957b1a374a468402f70c
Merge: 8d4b32621 88a9a3402
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 14:08:04 2011 +0100

    merge bug24323 into default

commit 8d4b3262130d7ebe02aed4428dbcc75bb86d00f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 13:16:21 2011 +0100

    remove badarg test since it's part of general error handling now

commit 7458ec0ed58b9c2c1a0fb1224d2f4ecfae3b7581
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 12:49:30 2011 +0100

    simplify/generalise badarg handling

commit c18ba4de9e86caa3826f7af59605c2206fb2ec46
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 12:40:32 2011 +0100

    make sure plugins/README is in all the binary packages

commit 84171ca4c01ef4ee8e85a0b1c96ece36509313e0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 3 12:25:48 2011 +0100

    reference all the little licenses
    
    The hg version of rabbitmq-server has the same LICENSE as before.  The
    srcdist, if it includes the plugins, uses the custom LICENSE from
    packaging/ and also copies all the little LICENSEs to the top-level.
    Ditto for generic-unix.

commit 88a9a3402a628c7e8061105746b1a380503095d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 10:18:48 2011 +0100

    optimise resource lookup
    This is worth ~2% in "MCM -a" when running with two Erlang schedulers,
    and drops rabbit_misc:dirty_read/1 from #21 to #49 in the fprof
    analysis of the publisher channel.

commit aa364b17adc71b8105e7fde1de66fcb6a5872599
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Oct 3 09:36:31 2011 +0100

    Expect failure silently in test

commit 76b495bc5546268c0f7a847574459552c1f6163a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 09:21:23 2011 +0100

    improve performance by bypassing mnesia for queue lookup
    This is worth ~2% on "MCM -a" when running with two Erlang
    schedulers, and drops rabbit_router:lookup_qpids/1 from #21 to #42 in
    the fprof analysis of the channel process.

commit 234c2cd961f00ed0c2334a219ae098929cb25cb3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 3 00:24:19 2011 +0100

    simplify delta calculation in push_betas_to_deltas

commit 0dedb9bed4ba28b39a093a458b580a3b31d0dc7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 2 21:19:09 2011 +0100

    fix indentation

commit d5bb2e7cf187084794ecf8cdda9b819670871217
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 2 21:17:08 2011 +0100

    save a line

commit abb97c9e3f7ee0a97a6f9051f1fe894a447d2e05
Merge: 230088bf3 53083f51d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 2 21:06:38 2011 +0100

    merge heads

commit 230088bf395631a4229d170e9dea357c7739b34e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 2 21:06:02 2011 +0100

    refactor: get rid of #merge_funs

commit 2e0f014495363043b328f4ce09c5de1b2af281e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 2 20:45:03 2011 +0100

    some small cosmetic changes and tiny tweaks

commit 53083f51d87a742c007c1f8c20f2b1fd0d1c935a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Oct 2 19:25:37 2011 +0100

    Make lqueue opaque

commit 09226b228402443f2542f3e8d920f1f81cf33ad0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Oct 2 15:13:35 2011 +0100

    Drop unneeded queue impls, tidy lqueue, add specs etc

commit 542644446675a7392ab30667b140ab3145bf95c2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Oct 2 14:53:31 2011 +0100

    Avoid lots of combine_delta calls

commit b6bea063ea878259f0e7eba95aeeed3cb8773da7
Merge: 107dd2b9a ca592e6a4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Oct 2 13:55:46 2011 +0100

    Merging default into bug24455

commit ca592e6a4edbbb028b387943aadc44c22fadb0b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 22:15:15 2011 +0100

    optimise interaction of limiter with single queues
    which is a common case

commit 8091d60485da1f3bf719eec120fab3f136c121f8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 21:16:00 2011 +0100

    switch vq pending_ack from dict to gb_trees
    The latter are generally more efficient and this gains us 1-2% when
    running "MCM" with two Erlang schedulers and drops
    vq:{record,remove}_pending_ack from 25/28th to 32/39th place in the
    fprof profile of the queue process

commit c5c18113ff88ef57912bdd690297151aa0edd708
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 17:09:51 2011 +0100

    optimise vq:drain_confirmed for the common case
    This gets called on the processing of every event/msg by the queue
    process and making this change improves throughout of "MCM -a" by ~1%
    when running with two Erlang schedulers and bumps vq:drain_confirmed
    from #20 to #36 in an fprof profile of the queue process.

commit b1ef2b126a7e59775c28702e3df18be926b33dbe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 16:00:09 2011 +0100

    make the rabbit_event API more pleasant to use and less costly
    also simplify ensure_stats_timer - it now always sends the message to self().

commit 76f96c8fcc9a2d47da4373bdc73f24189cd854ca
Merge: 189219cb3 05e18dc26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 15:31:42 2011 +0100

    merge default into bug24459

commit 189219cb3f51416517fae344eabc692abfae558b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 13:30:50 2011 +0100

    yes, this really does gain ~1% with MCM with two erlang schedulers

commit 05e18dc26cbe7e4424f6fa2ec0ce4bee01ce2a94
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 12:10:48 2011 +0100

    keep track of uncommitted acks in a list instead of a queue
    This is simpler.

commit 33c43124c18b43ade8239e7e5d1881bf5ecd9000
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 11:26:55 2011 +0100

    collect acks in lists rather than queues
    ...which is slightly simpler and more efficient.
    This also allows us to optimise for the common case in fold_per_queue.

commit 556e8080c56662ffcc999eea096cef7a33030ad2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 09:55:20 2011 +0100

    speed up acks a bit
    gb_trees are generally faster than dicts.
    Worth 1-2% in "MCM" when running with two Erlang schedulers.

commit 4ad8acb5e3123e869cfb9c17cb5716d31cc26836
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 09:52:53 2011 +0100

    refactor: extract gb_trees_fold/3 and gb_trees_foreach/2

commit 58163fdf3a777b4ebdad49ec64b4069eed7963b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 09:16:17 2011 +0100

    refactor: eliminate gratuitous differences in 'confirm' code

commit b3aca49a1705a9029d398b5e75bb90f6751b2427
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 1 02:42:51 2011 +0100

    refactor: one gb_trees_cons is quite enough

commit 1bb4234ec2e6f5e0f82531f98728a6fb3f0aed58
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 23:18:56 2011 +0100

    a few minor tweaks, essentially cosmetic

commit e1eed03eecce965ac932f218b62c6ac801eb73d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 23:06:03 2011 +0100

    avoid creation of intermediate binaries by using io_lists
    This is worth 1-2% with "MCM -a" and two Erlang schedulers

commit 97bee7c008aec26fa9cae79b0f0d10307350b530
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 22:18:06 2011 +0100

    performance improving short cut
    This gains 1-2% when running "MCM -a" with two Erlang schedulers

commit 5383e9df16c1791d15057c2fbddf9a2a31ded74f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 22:16:39 2011 +0100

    cosmetic

commit 68da804b33531929dc00c0a0e83e34b7ac7f68b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 30 18:05:47 2011 +0100

    Bleh2

commit a3948c6088c60c04238c7bf003502bff71fa2653
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 30 18:03:56 2011 +0100

    Bleh

commit 0d4fc7d531b411b46dd668ab4c23278206a43752
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 30 17:56:21 2011 +0100

    Explain what we actually mean by explicitly / implicitly enabled.

commit ed38106f48c577cd868aaab38d553ae3c7a78b1b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 30 17:55:54 2011 +0100

    Language tweak.

commit 107dd2b9a9e54aef5e87100f4c40f57fc97e412a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 30 17:52:01 2011 +0100

    Avoid delta's low end extending beyond the low end of q3

commit 678ea2acc02ac75342c89c4250b00b0549d26f8f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 30 15:43:55 2011 +0100

    Immediate updates after memory vm highwatermark change

commit 7c1668e5c06a94fc8f08628daede462da66a93ec
Merge: 84407908c f7a0cb757
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 30 15:02:13 2011 +0100

    Merging default into bug24455

commit f7a0cb7577bdb6edb5ce591018e06a5ed44ab307
Merge: 3b5732011 8954d5977
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 12:47:05 2011 +0100

    merge bug23764 into default

commit 8954d59776d3e9bf818098f58faddf3f90bc3941
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 12:30:35 2011 +0100

    correct formatting

commit 11e929435f01f7200c43c95703b35ad09731fce6
Merge: dcb7442b7 3b5732011
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 12:23:07 2011 +0100

    merge default into bug23764

commit 3b5732011382a264507fa2f71349f1316cdc48dc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 12:20:28 2011 +0100

    reformatting

commit dcb7442b7c87f7d47bc3d4fbd6853c27e38a2d70
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 30 11:46:13 2011 +0100

    Add brief note about requeue to VQ docs

commit a4d9122e484a4407f10440b0371f8556b522d9d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 10:07:00 2011 +0100

    always record pending acks in #msg_status form
    #msg_status { msg = undefined } replaces the previous 4-tuple.
    This simplifies the API and gets rid of the obscure, ad-hoc 4-tuple.

commit 95d0c45c8086fcb37f8b4a0290eb7e3799ab2910
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 30 09:26:57 2011 +0100

    cosmetic

commit 21ec534a390cb54e7486cf97228e116fa75499bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 22:42:36 2011 +0100

    refactor: extract removal from pending_ack
    and in the process renamed remove_pending_ack to purge_pending_ack.

commit 40172b86a6fd5b7ae5e3d25ef6a012ae69c59ffd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 21:56:41 2011 +0100

    inline ack/4
    since there is now just one call site left

commit 92cd4bc4f2f6f7ef54ad83d5179d19a1acf78c49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 21:55:52 2011 +0100

    refactor: pull call to msg_from_pending_ack into queue_merge
    thus avoiding duplication, making the alpha/beta fun tables
    non-parametric, and containing knowledge of seq ids in queue_merge.

commit e7f617d36332af20b3046af66cea18b9013174c4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 21:15:15 2011 +0100

    inlining and reshuffling

commit bc7a823cbd05b162894cef50dfd3d9008fa1a992
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 21:09:16 2011 +0100

    further abstraction of queue/bpqueue distinction

commit 8a6645894c74807326adb64649d011e1f2f41055
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 21:02:24 2011 +0100

    a whole bunch of refactoring and cosmetic changes
    - more sensible order of args to queue_merge and delta_merge:
      1) things that get consumed,
      2) things that get added to,
      3) constants,
      4) State
    - more sensible order of results of queue_merge and delta_merge:
      1) things left over from (1) above,
      2) things produced,
      4) State
    - better var names
    - correct indentation
    - stick to <80 columns
    - some inlining

commit bb3a01337afb87122e0bcfd6a7eab4682f217520
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 29 18:46:25 2011 +0100

    :s/PLUGINS_DIST_DIR/PLUGINS_DIR
    
    Only in rabbitmq-server, because that variable in rabbitmq-public-umbrella has
    a different use.

commit 3632d4394426ca79ec5682a1cbd67eff890376e2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 29 18:31:04 2011 +0100

    thread static configuration through functions
    
    I miss mtl :(

commit 1371ff713bcdacc82de991d8c71a16f726fbfd35
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 29 18:21:18 2011 +0100

    don't bother with versions and sort plugins before listing

commit 2de8c9028efccecf5029b479ba90bad3592b06bf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 29 18:06:34 2011 +0100

    refactor

commit 2fe76d37309b737dc5fd396b0f5d3a4a26ab0584
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 29 17:48:29 2011 +0100

    Refactor, rename, comment

commit 84407908c2d6cffc57097734627e9f5182bed632
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 29 17:09:09 2011 +0100

    Count the quota properly on beta -> delta. Also, fprof shows that the queue:len calls in permitted_beta_count can be very expensive. So wrap the whole of queue in lqueue and associated refactoring.

commit 142174d4ac295594475f098eee91482d315c1b1a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 29 13:25:43 2011 +0100

    Concession to Qpid tests is now redundant

commit f71ea231b79294f461d20c37869adf8759d53b7c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 29 11:47:28 2011 +0100

    Speed up requeue test

commit 1aaccecd4313449b0d642e436b33e2b29c68e992
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 29 10:19:44 2011 +0100

    Move #msg_status{} back to rabbit_variable_queue

commit 306c4035eef6342102a879bd209f9947ff8ecc96
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 29 10:14:36 2011 +0100

    Only ack messages when necessary

commit ee60a619df9528a61f9215ad400bfb9042625598
Merge: c32322228 5caf99c5f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 29 08:54:07 2011 +0100

    merge bug24298 into default

commit ec542c0d8ec041bdef27f2ffdd728d3dfd74c559
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 28 18:40:16 2011 +0100

    Count properly

commit 3349c31b004d0b4e9d5085c5bba14558102c722a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 28 17:32:16 2011 +0100

    Change one or two things around a little bit

commit 5caf99c5f85c258d0e03cb09de621a3fd2424e77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 28 16:10:00 2011 +0100

    Further oops, we now depend on everything being built before running run-background-node, otherwise we have two make processes tryi9ng to compile at the same time and they tread on each other.

commit e7e90559cdf89bbbb316e81db7caaf085914e854
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 28 15:17:18 2011 +0100

    Ooops

commit 2ecc9baddaa05ee3efd39d76a024db94b4c393ba
Merge: 9fe249063 39496a12d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 28 12:18:50 2011 +0100

    Merge bug24371

commit 0741dfc7028f97d0e22c4b5f00921d4722d90f51
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 28 11:47:22 2011 +0100

    lshift

commit f983269d622aa44d0d8994ed05b4fcf2582b2c03
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 28 11:36:19 2011 +0100

    Better test coverage

commit 0265670047d9307f4506bc91f6f70c2c8c459301
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 28 11:26:47 2011 +0100

    Remove redundant definition

commit 1e71f208683e5d505c4c0810751545c95391c20e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 27 18:00:00 2011 +0100

    Refactor
    
    Making use of the symmetry between q3 and q4

commit 034cccc3889642afc00cef273a25eebbe8719c08
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 27 11:41:41 2011 +0100

    warn when enabled plugins can't be activated because they're missing

commit 96ce53bf319c4f8fec99580095f84be809516dbd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 27 11:35:18 2011 +0100

    Requeue faster
    
    by not adding messages one at a time
    Modify test to requeue multiple messages

commit 8c97b35bd2e73a3dfe386d57f3783ee82a5250e3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 27 10:38:41 2011 +0100

    re-instante the README and remove rabbit_common

commit bd048aeb5f9ae6507edbf72060ed403c66a0a037
Merge: ee3feaaf4 39496a12d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 26 21:37:25 2011 +0100

    Merged default into bug23764

commit ee3feaaf4c6cde126198c37cbfcc35cc7180e9f2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 26 21:36:59 2011 +0100

    Turn q3 back into queue
    
    And filter messages from queue index

commit 796892629ad1cf3a3b832de52b57f431052de88a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:30:56 2011 +0100

    copy instead of symlink

commit b769c6922e77358483ba1a967fd4979f71a933fd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:26:29 2011 +0100

    update -> write and cosmetic

commit b12cb42c53f9240da3caeec0ef4f515d5646cd18
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:22:43 2011 +0100

    remove redundant operations

commit 42bef2998e94e67abce7a53c588186da1f5e9573
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:20:45 2011 +0100

    refactor

commit 7202c9d02f85ca8b0126ebbfb6ce457fbf87a064
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:14:51 2011 +0100

    add specs

commit edc4a8869a5a0b4d4ccf3fa3fc7e21027029a46e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 26 18:08:34 2011 +0100

    Add 2,3-finger_tree implementation.

commit dc28dac13550b9ffc6a183d4499b57d4094f44fe
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:08:15 2011 +0100

    make enable/disable with no arguments an error

commit aa2bb652f239b32db15a5a8ff30f458d38bd4ccc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 18:01:09 2011 +0100

    actually do the backout

commit b53e3f1151cd41ddd0dae955d00ce4d10cdf2506
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 17:56:50 2011 +0100

    make rabbitmq-plugins more social

commit aa96e281875ec515bb0fa346ffa5ab4d3c13e097
Merge: 8aab0362b 39496a12d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 26 17:54:33 2011 +0100

    Merging default into bug24455

commit 5ee4d91e96b3d0d42a6a6ac0bb089a0a2921f664
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 11:43:10 2011 +0100

    make both batch files use the same enabled_plugins file

commit b40e1084efac1f3f8a4f998371050caf4cb87bb6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 26 11:33:40 2011 +0100

    use a specialized wrapper for rabbitmq-plugins
    
    All the scripts assume that they are run as ${RABBITMQ_HOME}/bin/script_name
    and use this to extract RABBITMQ_HOME, so we do need a minimal wrapper for
    rabbitmq-plugins.
    
    I don't know if the 'cd /var/lib/rabbitmq' is necessary; it probably isn't for
    rabbitmq-plugins, but might as well leave it in.

commit 8aab0362bbfbde500e1660b90388733cde06892d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 23 18:47:39 2011 +0100

    bpqueue is very dependent on the performance of queue:join. fqueue makes queue:join O(1) and maintains O(1) on other operations bpqueue cares about

commit 39496a12d997af16f5ba7928cbc5933105ed57c3
Merge: 0d0291fb2 a12c59397
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 23 18:09:07 2011 +0100

    Merge bug 24315

commit 94c2476a2ebc3db11c106fdba03640ed85f34ea7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 17:38:58 2011 +0100

    rabbitmq-plugins must be run as root

commit a12c5939750b227394cd49da5a273d1b7e76f9b0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 17:22:26 2011 +0100

    extend comment

commit dc56371d486fb4955d274830b91653c95a3fb13e
Merge: 0d0291fb2 94c895ea5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 17:10:28 2011 +0100

    merge default into bug24315

commit e492e8c3807dd4a47c55c92e8a2e933b34e1cefc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 16:24:57 2011 +0100

    make invisible lines more visible

commit 4efb973a01be057df49c0d01ed4ba94f9542b184
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 16:03:55 2011 +0100

    oops

commit 8c225dffff5cb5608e6e2acb1e3f67c6041b9adf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 23 15:50:02 2011 +0100

    plugins-dist -> plugins

commit 0d0291fb2c57b8090b46131b89a115e949a3bb54
Merge: 1d62ac93a 1b69e1fa1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 23 08:33:32 2011 +0100

    merge bug24332 into default

commit 005d9e704129f3c59b9c2a3ecf1a776c350fe45e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 18:54:22 2011 +0100

    warn when a RabbitMQ restart is necessary

commit 3bb75c177cfbbef998dab297682ba8e1468b6add
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 18:39:18 2011 +0100

    -e and -E filter by enabled status

commit a05e7717539d39bedff3e17b03c87845881fc600
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 18:27:42 2011 +0100

    compact -> verbose

commit c4caae36bdb0179211d1aa6c665bc5466c74f563
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 18:22:24 2011 +0100

    Simon's readability patch

commit 4b27b8f67ac821d797924e39029176b6ea82f700
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 17:49:02 2011 +0100

    fix packaging bits

commit 8aff707c85ce7049d2cbb6aef920e59e9b2d3606
Merge: 1b69e1fa1 da265ac0e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 17:34:25 2011 +0100

    merge default into bug21319

commit 1b69e1fa1527fe559130f07b31c3002d8d634b93
Merge: 0ccf0f5ab d19d494db
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 17:32:37 2011 +0100

    merge heads

commit d19d494db5944c9ba905fd1dcaeebf7e001df52f
Merge: ef7fdba68 347cdb6ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 22 17:25:41 2011 +0100

    Merged bug23866 into default

commit 0ccf0f5aba4d85c48395a494f76f377b4f20fa6f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 17:23:23 2011 +0100

    fix rabbit_file:group_tokens/1

commit 347cdb6ed96828eed31cef549c47f433160b73ae
Merge: f81dfa2ad a3c646849
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 22 17:23:16 2011 +0100

    Merging bug24433 to default

commit da265ac0ec05eef8a2fb8e3b521a7e488e7a285f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 17:03:53 2011 +0100

    the plugins distributions may be either ezs or directories
    
    Turns out the token parser was broken: it didn't work with nested tuples.

commit 1f72ea46b0228c1e05d2e6b50391c5e6373d87bf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 16:18:32 2011 +0100

    don't use the plugins directory

commit 19fef5cde199b89984acb7d6ecbb40e91734e6a5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 14:07:30 2011 +0100

    rename rabbitmq-plugin to rabbitmq-plugins

commit 14538ee86d41bc312820f0a408f687f8db32664c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 13:55:46 2011 +0100

    improve manpage text

commit 2e311e2f3d19cd177d93e741ede3855119775b05
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 13:51:47 2011 +0100

    re-indent manpage

commit 5b08b751a3cd1440a5e191297fcadec8c5f43cb4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 13:51:00 2011 +0100

    hide the prune command from users

commit 8fdc34e425479020a35180cf03f040b4252dab35
Merge: 750bd4bec f81dfa2ad
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 13:42:28 2011 +0100

    merge default into bug21319

commit a3c646849871a70b66bf8ca219a420227e29ca4a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 22 12:32:06 2011 +0100

    Avoid construction of intermediate queue

commit 1d62ac93ae0980918d89161ff80724bed5b07d74
Merge: 5ee1a204a f81dfa2ad
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 12:08:33 2011 +0100

    merge default into bug24332

commit f81dfa2ad4714da599607445ef1f91332fc72494
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 22 10:24:18 2011 +0100

    binary:bin_to_list -> binary_to_list

commit 3f8ec7ff8d10d20f5bf96ae64a15a3a392ab6de4
Merge: 1b20604a2 f8c210016
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 22 01:50:14 2011 +0100

    merge bug24386 into default

commit f8c210016aa16719ccf7b387a4226770c91b2f28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 22 00:27:21 2011 +0100

    get the spec of list_dir right at last

commit 1b20604a24263adbb47b4d018866a058f93eead8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 22 00:24:15 2011 +0100

    correct a spec that has been wrong for ages
    it helps to occasionally look more closely at the dialyzer output

commit 9fe249063c21f378ac6cb38027fd8dd62b901721
Merge: e9dc1ba83 f5dd0f82b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 17:58:02 2011 +0100

    merge default into bug24371

commit dc049afd41cd045f1f63dc6c55e40019da7db4e5
Merge: e7714194e 2182f9405
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 17:32:44 2011 +0100

    merge heads

commit 2182f9405565c272c657ce6a6135d056aa6f06b3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 17:30:09 2011 +0100

    fix a dialyzer warning

commit e7714194ee760aacbe96b7ceab852f3718b8bc74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 21 15:57:24 2011 +0100

    cosmetic

commit 494998dcb02e731c09dbe985b8208c4808a07614
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 14:52:07 2011 +0100

    don't use rabbit_file in the FHC tests

commit c9fdc19d6bb19138f87bb0f2ec9a8ccc337943ec
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 14:21:06 2011 +0100

    refactor

commit 6bf02299e9793e976f5da1aa5be4087d49d64ee2
Merge: e9dc1ba83 5fd149272
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 13:45:24 2011 +0100

    merge default into bug24386

commit 5fd149272870f8d810a27396eb9240bdc02f7568
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 13:44:41 2011 +0100

    move file functions from misc to rabbit_file

commit b5e7b8796476af4977dc579e0a304e03e784af1b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 21 12:44:56 2011 +0100

    guard all prim_file uses

commit 5ee1a204a9629bca99a71269df8a28d38816900f
Merge: c00c20b3f e9dc1ba83
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 21 12:21:27 2011 +0100

    merge default into bug24332

commit e9dc1ba83c3a05e015deab341e6cb6608e3a7e37
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 21 12:04:29 2011 +0100

    remove redundant "-s rabbit" from windows startup scripts
    ...and bring the order of erl args in line with that of the Unix
    script, for aesthetic reasons

commit c37efa4b3ee9d1502590eda87b3fab4fb4dd5c5a
Merge: 193cec3ae 6be54f925
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Sep 21 08:24:26 2011 +0100

    Merge bug17174 into default

commit 45ebed02921b2ae140da8d5c993a73adc40fdf82
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 17:20:26 2011 +0100

    make fhc a gen_server2, turn releases into casts and prioritise them

commit c00c20b3ff1dbec5442973976786773f56b5a420
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 16:44:26 2011 +0100

    Backed out changeset e24819baa47e
    
    Because our sasl error handler will start up before the real one, for the
    moment, anyway.

commit b39f33cb61320c07968b7c0ecb345af3fc7bdd8c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 16:01:55 2011 +0100

    reorder boot script so that rabbit:prepare/0 gets called *after* sasl is started
    
    Otherwise, the SASL application is started after and installs its error
    handlers (which prepare should have replaced).

commit 750bd4bec3b056e7c9752aad3bb5ad63257d64b8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 15:02:58 2011 +0100

    rpm permission tweak

commit 8c23702334b44e85b3c3372bdd90d391db30e6f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 14:33:50 2011 +0100

    permission tweaks

commit 6be54f9251fd14489130d2f04f533ceb04207ba3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 20 11:04:22 2011 +0100

    improve flow control by penalising message ingestion in the scheduler

commit 44b42292fb13a76351a90b29e2d4869bdc028a3d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 11:02:25 2011 +0100

    typo

commit 2a75edd4a5e2430cadeb7cfc8a0626a64b91c036
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 10:45:53 2011 +0100

    slightly more informative errors

commit 3f210cd27da5918ad09077a5a57880ab97311e33
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 10:25:09 2011 +0100

    the READMEs should be .txt on Windows

commit 52ac3d9092f6409f379a6ab217bc51b1e75ba619
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 10:22:59 2011 +0100

    make the windows zip bundle look more like the generic unix one
    
    Remove the build directories not present in the generic unix bundle.  We were
    already removing the Makefile and codegen, so it was unbuildable anyway.

commit afcfe9d8e3d1f636165b0e236fe5ae3c44ae0be8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 10:12:08 2011 +0100

    refactor

commit f9c769b1ecef5705486ad58cd16529bcf09a679d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 20 10:09:09 2011 +0100

    ensure the plugins dir exists before trying to copy files to it

commit b0c0265cfb97959833bd1c7bb46619232f330aa7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 17:32:38 2011 +0100

    remove leftover

commit dd048a039005d3293682aaeed349a50c6a389125
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 15:52:47 2011 +0100

    running "rabbitmq-plugin enable" will fix missing dependencies as well as remove unnecessary plugins

commit ce59f6561700eb21304c798dcd3fda5e1e55b933
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 15:11:21 2011 +0100

    re-enable plugins on deb upgrade

commit e9bc341feb3dfe35ad50256f37329f17c490c20b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 14:33:46 2011 +0100

    re-enable plugins on RPM upgrade

commit bbdc07a6cf883ef4e2729b4db4187bbe7ac3bacc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 13:45:43 2011 +0100

    don't forget to install the rabbitmq-plugin script

commit 40fc81848bdbe38456890cc37f946919b8caa76f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 13:39:56 2011 +0100

    rename provided_plugins to plugins-dist

commit 2dbd7b51439827b62ee7bdd9c94fa0d69be2d119
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 12:57:51 2011 +0100

    also clean plugin sources

commit ffcf0b57eefa8ae40afb8553f01447870478dcd6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 19 12:23:16 2011 +0100

    symlink to an absolute path

commit 1cbadfe5f27b52ab1cbd6f3e80e28da5f676125f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 19 11:46:12 2011 +0100

    Rely on a running vm_memory_monitor

commit f95f2fd23d069743a3de0c8e8ef6ef4086785360
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Sep 19 10:52:48 2011 +0100

    Better default last memory limit during updates

commit b16a7e7478a10a2f145c94d4862630656259a79c
Merge: 193cec3ae 5911f5c71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 19 00:14:07 2011 +0100

    merge default into bug24433

commit 193cec3ae1e7425519d8c1132758c5c1d79678c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 19 00:13:03 2011 +0100

    cosmetic

commit 5911f5c71b5716523c672c90e39dc75b3c1bc369
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 19 00:10:52 2011 +0100

    count queue consumers as required by the spec

commit 6c7be0a138dbe19987b01f971a193f25fa9be1a6
Merge: f021235a7 1580728ff
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 23:20:52 2011 +0100

    merge default into bug24433

commit 1580728ff3eb4681de63649aa2d61b35dc811fbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 23:13:55 2011 +0100

    a bit of inlining, tweaking and cosmetics

commit f021235a7710df4e5e0cea5f18d008adb3546ae5
Merge: 4ff1f35bb 2e8d6875e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 22:32:12 2011 +0100

    merge default into bug24433

commit 2e8d6875efdfdb5bb222e60b492a2723d8620c6c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 22:31:47 2011 +0100

    cosmetic

commit 4ff1f35bb701a45443d14279bf8772382046854e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 12:30:11 2011 +0100

    improved compiling- and working-ness

commit 7678f8aeb43c9a3d08229efaa217027548296a13
Merge: 739ee88e5 ff8bf657a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 00:46:16 2011 +0100

    merge from default

commit ff8bf657ab87743b19d872b8766b42c9844dc1dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 18 00:31:00 2011 +0100

    extract ack handling logic
    in common between 'ack', 'reject' and 'requeue'

commit c6d51e7aa6c33e8cd3ecb60bae072ec91407dfd5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 17 12:01:00 2011 +0100

    extract correlation between consumer_count and limiter registration
    ...and fix a bug in the process: during consumer registration we were
    using the *old* cr, with the old (and usually undefined) limiter, to
    check whether the channel is blocked. Thus we would end up running
    through the message queue unnecessarily. No big deal, but certainly
    not what was intended.
    
    Also, make the update_ch_record return the record, which makes the
    function more composable.

commit 55c65208603aa194b6959813e911754214730365
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 17 11:10:06 2011 +0100

    rename maybe_store_ch_record to update_ch_record and drop assertions
    ...and some associated cosmetic shuffling and inlining.
    The assertions aren't all that useful and just clutter the code.

commit 739ee88e529aa0ffcd5e37d24a2d58b92f3d177d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 17 10:51:22 2011 +0100

    work in progress
    This doesn't even compile; but I want to stash it away so I can cherry
    pick some of the refactorings and tweaks for 'default'.

commit 1299f4acd0f282967191a7d69b444887e055b603
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 21:00:37 2011 +0100

    cosmetic: slightly more sensible field order

commit 7da6e5a8fb6e2a712a6397b8fc1c91297bf8f3e8
Merge: 27a11041c c9266c1bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 17:49:38 2011 +0100

    merge bug24428 into default

commit 7d219c1e101fa41e6f447e8a6ee66e3bb974884b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 16:40:03 2011 +0100

    fix a recursive compilation issue

commit c9266c1bd93d915109e68cbc922d9ab8da7769aa
Merge: cfeeed9ac 79cfba476
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 16:36:03 2011 +0100

    merge bug23596 into default

commit cfeeed9ac13f19ef359a624f33b88770a679988b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 16:35:34 2011 +0100

    use 'sets' instead of 'gb_sets' for the 'blocking' set
    This set will generally be quite small, there is just one of them and
    we don't need ordering, and generally performance here isn't an issue.

commit d15424b4da61b735fc6b1255cf34813d6f5b1f19
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 15:05:14 2011 +0100

    some tweaks for sake of symmetry
    ...and some cosmetics

commit a3cf7d226fd1568f57e409efb6aade676683f832
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 14:57:54 2011 +0100

    be smart about when building plugins

commit 4a2a8f98d9ae5e4db8b5bff46bf93658b57d46ee
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 14:27:54 2011 +0100

    release descriptors explicitly

commit 999515ba9beb925967f486f1de671f5d35568c0b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 14:00:07 2011 +0100

    minor simplifying refactor

commit d943fd1f07d33041d22069ab00b48e290618e6f7
Merge: 79cfba476 e20bfaf14
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 13:25:48 2011 +0100

    merge default into bug24386

commit e20bfaf14bf7ea4f8e3520e01de07210e93bdd4c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 13:25:24 2011 +0100

    use prim_file instead of file2

commit bb6fdac070867685f6adb37f008a870fb1ecf8dc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 16 13:05:54 2011 +0100

    Makes queues sensitive to changes in RAM

commit 79cfba476f5738999e4b1e16c91709072d679a31
Merge: 3996dc533 8a750a6e9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 16 11:09:48 2011 +0100

    Merged bug24424 into default

commit 8a750a6e9f1a24508d7aa9710c2e10bce8bd30e6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 16 11:09:21 2011 +0100

    Whitespace

commit 464c9b22caacf24dd7cac51aba887a7a1485abc3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 16 10:31:12 2011 +0100

    merge two folds

commit 6b143c5f5a5e341ebc6987a5a088c36e12c3f85a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 16 02:36:59 2011 +0100

    cosmetic changes and some minor refactoring

commit 3996dc533189f02c79a1c3280d8c74adde6308ba
Merge: 0d4194508 19d51b94e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 17:21:10 2011 +0100

    merge bug24425 into default (FHC can become bottleneck when large numbers of durable queues first receive a msg)

commit 27a11041ce60732cbe53dd7dbb83c9dd36b7b5b0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 15 16:55:20 2011 +0100

    And now it's like well beautiful. Wicked.

commit 8beb213f4a586982f2e9d943afb58b7be35e7a59
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 15 16:45:19 2011 +0100

    Scatter/Gather. Eliminates gaps between txns and thus goes much faster.

commit 38d108f164be01c93d6584df5d2a8e42b675d46f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 16:15:12 2011 +0100

    cosmetic and comments
    
    Also, explicitly disable the SASL logger at start-up.  Otherwise, I think it
    gets started on the first event (it starts up after ensure_log_handlers/0, but
    before rabbit starts up completely).

commit 27c1d12254e570f669f112493ca1ed78b8498597
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 15 15:29:12 2011 +0100

    Rework binding recovery

commit 4688cadd6a09f33bdd9414a1dd41659d424ef22f
Merge: 93dd7f01e 0d4194508
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 15:13:36 2011 +0100

    merge default into bug24332

commit bc2f0ba7b3c393804db7d6dc2fe3b4c7a6813990
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 14:49:48 2011 +0100

    rename consumer_monitors to queue_consumers

commit 16c4d4cffb6161ee9dd8a008abd2e41a2c8e1c52
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 14:41:49 2011 +0100

    remove unnecessary check

commit 94d35f70d379c8fd8fa8abd31af441c7ab0002eb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 14:34:09 2011 +0100

    consumer_monitors is a dict again

commit eaedf1fc10f2c754657e337a151102e2257ccc06
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 13:54:18 2011 +0100

    less arbitrary division of labour

commit fc287cc3f3687ea2a0a6cf532313a0309a781905
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 13:38:15 2011 +0100

    remove no-op

commit 99ee855b6523936f3e64a37325b94018d19e996a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 13:36:52 2011 +0100

    monitor_queue/demonitor_queue are symmetric; don't use process dictionary

commit 67251d5692c497986e593f1bf8d04f8b2bab294b
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Thu Sep 15 11:55:19 2011 +0100

    Fix duplicated example para when generating rabbitmqctl docs

commit 2f48b6c4f217b46a8404a60fb1d53ab8800acd54
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 11:25:28 2011 +0100

    consumer_monitors is now a set of QPids

commit 0a7fb6ac3d80589325912c9c9fc53a117eeb03df
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 15 10:23:12 2011 +0100

    refactor

commit 29099ed7168a8aa4022df3e5087940d75a4d27db
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 21:35:05 2011 +0100

    DeMorgan a case

commit 40ff16c1517d89ff6027e6b385e6c7b0bf1a3eb8
Merge: 0d4194508 a3862ee61
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 21:28:10 2011 +0100

    merge from default + cosmetic

commit 93dd7f01ee89c6b6f2b8e83ec83461573bb8bf83
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 14 20:27:23 2011 +0100

    improve 'rabbitmqctl rotate_logs' docs

commit b91a3603c21bbf972dc4be5c959f288fc81c24ca
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 19:56:33 2011 +0100

    changes to file and filelib2
    
    Changes:
      * strip out most types and specs;
      * replace the use of error with erlang:error in one place;
      * file2 starts up serialiser on-demand and uses it for subsequenct calls.
    
    The R13 modules used here require slightly fewer changes than the R14 ones.

commit facffae7b771325bdf7094043047fc5226d1be88
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 14 19:53:04 2011 +0100

    cosmetic

commit 0d41945082d2c6a192007f7b8cef39d196e5680c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 14 19:36:11 2011 +0100

    fix a spec
    that was causing dialyzer to complain, rightly.

commit 19d51b94e966b9de25b20f007a3ba76dcca39004
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 14 17:18:13 2011 +0100

    Use ets table instead of dict

commit bf3759469f1fa01ea392183fd0e254b9e68150e2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 15:45:32 2011 +0100

    add file and filelib form R13B03

commit 233c7530b159409a05a5a22b9340e5f2523ff542
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 15:10:48 2011 +0100

    remove file2 and filelib2
    
    We're going to replace them with the ones from R12.

commit e90a269896ba8dcd538f5314356d7ff9170721a0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 15:07:23 2011 +0100

    file2 will start the serialiser when it needs it

commit c357bcad38bdf86f9db8a499fe471cddb5e73342
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 14:37:32 2011 +0100

    make the serialiser more generic by not registering it on start_link

commit a2e37c310fcfe6611f402e9602827183ff9198c7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 14:19:09 2011 +0100

    rename io_runner to serialiser

commit 0106889df4b6dd1374d37939b89b0acffca3baa6
Merge: c0643c346 edf283be1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 13:55:55 2011 +0100

    merge default into bug24386

commit 606b7f97b0ae4e434f86038ad983b94e9e83f670
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 13:22:54 2011 +0100

    implicitly disable enabled plugins
    
    So, if you enable federation, and then disable amqp_client, federation is also
    marked as not-enabled.

commit 61218503e5e193b1048a180f9060ee4f05511af5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 13:17:39 2011 +0100

    add rabbitmq-plugin manpage

commit 446982936be9adc2102c63187ba987403e05879d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 12:14:09 2011 +0100

    implement "rabbitmq-plugin disable ..."
    
    "rabbitmq-plugin disable rabbitmq_management_agent" will disable
    rabbitmq_management_agent and all plugins that depend on it.

commit 1746ded8fb951faa01138fd01c658d6000a8a602
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 10:51:59 2011 +0100

    handle multiple versions of the same plugin
    
    Effectively, ignore all previous versions of a plugin.

commit 3b55ceac04bcadfe66950beb01015f35ea1a5f04
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 09:56:23 2011 +0100

    prune after enabling

commit 8d4650f4275ea64ef6e3929009031b5e668efdb8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 09:12:38 2011 +0100

    refactor

commit 65e196a5ba4ed568b0e8465a25553be2ad78ffa8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 09:05:10 2011 +0100

    "rabbitmq-plugin prune" removes unnecessary plugins from plugins/

commit 4fc4dcc4ee2665d91591d9bb5d995d8d1dd4256f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 08:10:51 2011 +0100

    support regexp filtering when listing plugins
    
    So, "rabbitmq-plugin list" shows all the plugins and "rabbitmq-plugin list
    web" shows all the plugins with "web" in their name.

commit 7f404a06b61373a5a8bdd853182eac212fc177b4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 01:17:47 2011 +0100

    add a compact plugin listing option

commit 9332d2b689eb8fcbbfc033f9fdb8222dc235bb34
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 01:08:21 2011 +0100

    more verbose listing

commit a268c0aa6db9504ea16a03304d2c4998dc8b7d26
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 00:58:16 2011 +0100

    enabled plugins are recorded in plugins/enabled_plugins

commit 9ed82804f4364099e0c00a4995b452bc522336d1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 00:32:09 2011 +0100

    refactor

commit d45cde666ea4f6da1bf97b4acd9c1067c22974cc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 14 00:18:35 2011 +0100

    don't look for plugins in the plugins/ directory

commit edf283be19ab124065d1f4f10519985d0c82dd0b
Merge: b11414930 7a2e5c8a8
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Sep 13 09:24:36 2011 -0700

    Merge heads.

commit b114149300ca0f3abd2cfab72141448250b3871a
Merge: 7ae03f541 090eee483
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Sep 13 09:17:09 2011 -0700

    Merge bug 23056

commit a3862ee61e80f1c9aa7b7fdd8c36caef61fea952
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 14:55:38 2011 +0100

    refactor

commit 9a16607904d6855a7a393250c55e7fed9bc0e680
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 13:57:49 2011 +0100

    merge flow and (consumer, confirm, starts) monitors

commit c63f11ec7355118abc98db2982a82c8a602a7532
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 13:35:32 2011 +0100

    merge consumer and (confirms, stats) monitors

commit 8463a52f22d00c8abf651c872aed15e19d880f61
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 12:11:00 2011 +0100

    merge stats and confirm monitors

commit 7a2e5c8a891fd6d0bb949dcea4d90e6afe2eeb76
Merge: 090eee483 e9ad95f9b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 13 12:04:15 2011 +0100

    Merging heads

commit ab8f4ad3725b73e9a03476e291ac9b4e8ea16699
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 11:20:30 2011 +0100

    remove unnecessary variable

commit 31beb216a8a8cd2fc2bc21999c61be9c73394937
Merge: 9aa762dce 090eee483
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 11:00:00 2011 +0100

    merge default into bug23596

commit c0643c346bc9064df06d0680a5496db67841b3f7
Merge: 090eee483 2f0671399
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 10:34:38 2011 +0100

    merge default into bug24386

commit 2f0671399ad240d154e73d4d51e6c6928c580be0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 10:32:02 2011 +0100

    revert changes to worker_pool

commit 656f08429af0c678ae057fb598384045ff359fae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 13 10:29:13 2011 +0100

    add a dedicated process for running io actions

commit 090eee48366f13314f7b86584c0a7977f322d96a
Author: Tim Fox <tim@rabbitmq.com>
Date:   Mon Sep 12 14:21:18 2011 +0100

    Added tag rabbitmq_v2_6_1 for changeset 12e1420e9df4

commit 01b640674a72ac6a0a92450f4ca5b94850e27670
Author: Tim Fox <tim@rabbitmq.com>
Date:   Mon Sep 12 14:20:43 2011 +0100

    Changelog changes for 2.6.1

commit 7dc2d7adc16192fa1a86289ec90efbaf79aeb85a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 18:12:45 2011 +0100

    favour plugins in the distribution dir, not in the plugin dir

commit 74bdd2d27cff3e43ad4fa760161ce19d3e8cbd81
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 17:52:41 2011 +0100

    actually enable plugins

commit 3330b3a2f392dc8a8f3567b6d4f7e9e54e579dc3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 17:43:09 2011 +0100

    stubs for plugin enabling

commit 6a8e57f0de0aaac677ddd0ed65e599905d7afc3e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 17:30:41 2011 +0100

    find plugin dependencies

commit b6f9070d915df799b3ad4342a8b73fda28133fd6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 16:57:04 2011 +0100

    filter available applications from the dependency list
    
    I.e. remove kernel, stdlib and the like.

commit 0896d9eba13a335b32195cc305e5d543643173e3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 16:47:26 2011 +0100

    partial plugin enabling

commit d57b01da24620440b533749c8c713b319aeb37ca
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 15:54:02 2011 +0100

    list packages showing which are enabled and which are available

commit 5769e15bcdfaabb675d1648640de3a416f0bd053
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 14:50:28 2011 +0100

    handle invalid plugins

commit e9ad95f9b28c63b0faf3d1e4705a50b7ab39edb3
Merge: eb56e7e0e 4fcb1dddb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 9 14:33:10 2011 +0100

    Merge bug 24416 (yes, let's use dirty ops instead)

commit 96cb9d5c605eefc6901d9d8929d02bd74cc5ea27
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 14:24:50 2011 +0100

    read and parse app files from ezs

commit aaa1c65236c48b856a6c900b74621777a785c18b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 12:11:54 2011 +0100

    pass PLUGINS_DIR and PLUGINS_DIST_DIR to rabbitmq-plugin

commit f7620ca0993a5fa471b1884fd797ab191c667eb6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 9 11:57:42 2011 +0100

    Turn q4 back into a queue for performance reasons

commit ab2f7d3b940f8ab13287faa5057d6047a58abcf4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 11:39:42 2011 +0100

    comand line parsting for rabbitmq-plugin

commit 0447b0d9fa031ecff354dfb280ad74d4ce70e99e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 11:22:56 2011 +0100

    refactor
    
    Move quit/0 into rabbit_misc and remove ezs from provided_plugins/ during
    clean.

commit 4fcb1dddbd9dbf9331d24e8f1f6910c3d0b7e351
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 9 10:23:51 2011 +0100

    show full paths in dialyzer warnings
    which is handy for emacs

commit 469f08821744d07be23cad7e7b22a5c4d040e953
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 9 10:22:05 2011 +0100

    refactor + handle MFAs

commit eb56e7e0e15852dab363f6fbc63a954496d2da69
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 8 19:03:48 2011 +0100

    consistency

commit 3ea15a241d455710891fd2fbd46cd61594249b85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 8 19:03:31 2011 +0100

    do the todo

commit 0a515e34c291ab00ae39330ed2c5f5b659ee9797
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 17:46:20 2011 +0100

    add plugins to debs and rpms

commit 547eed9f603d2c03aceca2f8bc6bb755e95f61ca
Merge: f3ea34651 ef7201b17
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Sep 8 17:38:28 2011 +0100

    Merge bug24387 into default

commit ef7201b178a09676bcb9fa20004fe2af34c75544
Merge: bf99e4938 f3ea34651
Author: Steve Powell <steve@rabbitmq.com>
Date:   Thu Sep 8 17:29:46 2011 +0100

    Merge in default

commit a18dde80c58c3d6d312e431e933adce2804cad6e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 17:12:56 2011 +0100

    add rabbitmq-plugin stub

commit 2e88be5d470b0f38aef3abcfef1cd2ac6b7c83b4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 17:12:05 2011 +0100

    make plugins easier to dist when developing

commit 23e82e5eb9781414b6f64885ec1e60904d386b06
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 8 16:31:58 2011 +0100

    Record phase changes correctly

commit bee08ed2503d6569591c89d10608ab1c76d47822
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 14:42:45 2011 +0100

    add the plugins to the windows package

commit 8113a819f08f99ece57e033603941b56ee43ab23
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 14:16:32 2011 +0100

    add plugins to generic unix archive
    
    Since we don't want to build the entire public-umbrella several times when
    building the broker artifacts (once for each of generic-unix, windows, deb and
    rpm), we make the location of the built plugins configurable in the broker's
    Makefile.  I.e. the broker will normally install the plugins from
    provided_plugins/ (build by make plugin), but, if PLUGIN_DIST_DIR is set, it
    will install the plugins from there.  This applies only to the install target.

commit f2ac67c88d06dec3ce18eb1a9777ea37eb3334d0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 13:06:27 2011 +0100

    fix the plugins srcdist before attempting to build the plugins
    
    We don't include the broker in the srcdist, so we link it in before attempting
    the build.

commit 81e21b46b5a03c5be6efabe8d5fb275604ccb6b9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 12:52:54 2011 +0100

    add target to build plugins and put the .ezs in provided_plugins/

commit 145e8a18a6f0414b91bf285ee940ba60ee1a9e51
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 8 12:22:41 2011 +0100

    include the plugins' sources in the broker bundles

commit f3ea346515e70b10e5ab794596e59a08830c18e9
Merge: cfcdafc35 fc6ac9c29
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 8 11:47:08 2011 +0100

    Merge bug24393

commit adc12772ebe9591f78f81f7449ceeb8453653cf4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 16:02:21 2011 +0100

    remove more specs so that it compiles on R14 again

commit ad8af8ddfa0e1666d76d1c7bddf65d1e7ce379c7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 15:58:52 2011 +0100

    improve comments a bit

commit 21a5868076c537257e519fb0a40073202ec07a15
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 15:57:49 2011 +0100

    remove specs so that file2 and filelib2 compile on R12B-5
    
    Also, forward-port the file:file_name/1 from R12B-5, because the one in R14
    uses a bif not available in R12.

commit 4b1d22c617adfe178d89b0dd91e19d71023ede76
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 15:19:48 2011 +0100

    if the worker_pool is not running, run the submitted job in the current process
    
    The only time when this happens is when using the file2 and filelib2 functions
    during prelaunch and prepare, which should be fine.
    
    The alternative is starting worker_pool before it's needed, but the logic of
    that ends up being quite complicated, as we also have to stop it before
    starting rabbit fully and it may already be running.

commit dbdec09ea1dba290da41622184593fce85f57411
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 14:00:36 2011 +0100

    use filelib2 instead of filelib in most cases in queue_index and misc

commit 69b37beaa98f45bd4520f075bf16b3b96d28936a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 13:46:52 2011 +0100

    patch filelib2 so that it uses file2

commit be1c5ac7fdb6cacd82fdb0aabdad2be2fa338643
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 13:38:27 2011 +0100

    copy over filelib.erl from R14B03 as filelib2.erl

commit 43baa6532e00778ae3349257d17bcab0760ad602
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 13:37:29 2011 +0100

    use file2 in most cases in queue_index, file_handle_cache and misc
    
    Unfortunately, the worker pool is now a pre-requisite for some file
    operations, so we have to start it in prelaunch:start/0 and rabbit:prepare/0.

commit 9ab03a841ab94f6774ddd26dc17cb021bb20a5ec
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 12:19:04 2011 +0100

    patch file2 so that it compiles and runs file_server2 calls through the worker_pool

commit 31ed8fd6c006bcd1bc937130ce5a6be5f9007312
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 7 12:18:10 2011 +0100

    copy over file.erl from R14B03 as file2.erl

commit fc6ac9c295aba3affb5f379ec498d8658ff8fc87
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 7 10:08:40 2011 +0100

    Set process limit when running as a Windows service

commit cfcdafc351b452e352d3a837e402c4a18284befe
Merge: 19317187a a9a3a27d7
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Sep 6 20:16:59 2011 +0100

    Merge bug24399 into default
    
    init script assumes the existence of /var/run/rabbitmq

commit bf99e4938e11ea650045aada6b3876588eccfab3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 17:54:58 2011 +0100

    don't follow symlinks

commit 9aa762dce663ce40df3a890a88d23b4df734e5ae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 17:29:42 2011 +0100

    refactor
    
    And mark the queue as un-monitored when it goes DOWN.

commit 3d68c2a3288a760e83a6ff6fe9cbb086ee38b4e4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 17:13:00 2011 +0100

    only monitor queues that have messages on them

commit 15fcf839006eabb19c03082a12298b7f9475af28
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 15:05:32 2011 +0100

    use the recurisve delete from rabbit_misc

commit ef7fdba68d8ee496b6fade46f1ae81c2ad9ef132
Merge: 5e96681a7 19317187a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 6 14:41:44 2011 +0100

    Merged bug24403 into bug23866

commit a9a3a27d72e662aa11dfd756cdb0c3e9594e836b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 6 14:41:26 2011 +0100

    Be consistent about attempting to remove the directory whenever we can; remove purge deletion of var/run which has existed since root of hg repo.

commit 2c58c717d49281d56d2a4df39fdc364260ffad50
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 14:40:23 2011 +0100

    don't ignore symlinks

commit 13a039ff9250927935a94dc4a741338d72bb6911
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 6 14:09:12 2011 +0100

    Cosmetic

commit 94c895ea5050a5f3aa8aaa942565a757240c857d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 14:03:12 2011 +0100

    refactor
    
    Two with_local_ios in rabbit_mnesia were unneeded.  Huh.
    
    We only need to use with_local_io/1 when we use error_logger; the most common
    case is error_logger:info_msg/2, so we now have a helper function.

commit ce3b8817f421a9954517127998afdfda622a87ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 6 14:00:07 2011 +0100

    Safer status in case broker is busy shutting down

commit 6bc52fcb3afbe9e92d2f0a3b7f76fd1084ec40fb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 13:53:03 2011 +0100

    fix tests

commit 6e22a7a8636da06522165e0a6f2628288a9eab73
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 6 13:49:05 2011 +0100

    When we stop, wipe out the directory rather than just the pid file. This avoids having to worry about how to remove the directory on package uninstall and also has the advantage of helping non-rabbit-packaged distributions

commit f5dd0f82bdff6ea60fb11b05889eccbfeac07807
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 6 13:26:54 2011 +0100

    Ensure dir exists

commit 5f8cda6e696e2b1f686fc38128c1eef884935069
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 13:24:17 2011 +0100

    log various ctl actions

commit 5e96681a71840e691b8764f11193205c029041a8
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Tue Sep 6 12:44:07 2011 +0100

    Remove fake doctype from man pages

commit 19317187a4e338e1a45be0fe737ac727e2b7ef46
Merge: fab4c20ee f01aa54d5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 6 12:23:48 2011 +0100

    Merged bug24385 into default

commit fab4c20eea06a4647ca04195a2f8ee4e0594f1a6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 11:53:16 2011 +0100

    update comment

commit 769fcf608fdd822cfb296f26c55714e9de535b64
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 6 11:03:51 2011 +0100

    re-add log handlers
    
    Also, delete the log handlers in a previous test since it's not done
    automatically anymore.

commit f01aa54d509b72601222e2adff1201e36521d395
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 6 09:32:55 2011 +0100

    tweak 'publish' funs to make their relationship more obvious
    plus some cosmetic renaming for consistency

commit c1162ebaec83811e7633461efc16ec8b7a5e976c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 5 18:57:18 2011 +0100

    improve coverage of rabbit_control

commit db44b9327945acb82f518ac182854aa87fa1f282
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 5 16:48:56 2011 +0100

    cosmetic: don't delve into details of what's in the output of 'status'

commit 291c28ba9d292a05020ec3ef353dc1adfb6bdacf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 5 14:38:34 2011 +0100

    The custom seems to be to ensure the directory is created on startup.

commit 0475dc41ed25c2e71c0f05e245d782dadb614e94
Merge: 581fb1025 c4db13226
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 5 13:24:16 2011 +0100

    Merging heads

commit 581fb1025949aea7835440902899f5a3120a51da
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 5 13:14:36 2011 +0100

    Just like the init script, the ocf script should put the pid file in /var/run, not /var/lib

commit ae0c0323cc00558b54b73dd13ae792616778e939
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 5 12:55:23 2011 +0100

    handle the non-empty buffer case

commit 9e258d4f4f069cf49ac836a8e32a7d42aa31d2c5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 5 12:24:13 2011 +0100

    fix taking over from the tty handler

commit 92e02cec21875351a3b81721aa58ec7feec062ba
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 5 11:09:28 2011 +0100

    update rabbitmq-service.bat
    
    The BACKUP_EXTENSION bit was removed during the merge.

commit 6ce64948d8302636dd862413ee32f0c824e76f55
Merge: cb0dca4a5 463fcc538
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 5 11:08:18 2011 +0100

    merge default into bug24332

commit cb0dca4a5ba6439970e240fb6994db635c6ac858
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 1 14:42:56 2011 +0100

    Added tag rabbitmq_v2_6_0 for changeset 6547461e6c2e

commit c4db13226ee1e5a144142716b4b293fb6b778ece
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 1 14:39:17 2011 +0100

    Added tag 6547461e6c2e, rabbitmq_v2_6_0 for changeset 61cd06576025

commit c74d6ceb4d578d741aa71f7783f07cc0f8b26c4b
Merge: 564876de9 6f4496240
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 31 09:51:48 2011 +0100

    Merged default into bug24323

commit 6f449624030197406dd43a79d6b478ab8b7dad0e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 30 15:50:33 2011 +0100

    Report vm memory limits conditionally

commit 2eb3db154d61976e1fc183d2c1d860d202ca7307
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 30 14:33:09 2011 +0100

    Backed out changeset e115f0eec60c

commit 564876de92a4074b733f004fb9b2330f91d78e2c
Author: Tim Fox <tim@rabbitmq.com>
Date:   Tue Aug 30 14:07:14 2011 +0100

    Added tag rabbitmq_v2.6.0 for changeset 6547461e6c2e

commit bd9daf485a092f7c31da9813971cfeb7b4afc659
Author: Tim Fox <tim@rabbitmq.com>
Date:   Tue Aug 30 14:06:23 2011 +0100

    Changelogs for 2.6.0 release

commit 8d4c559a971d25cd818dd189b58b07a123edb490
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 30 13:51:58 2011 +0100

    Report vm memory limits differently

commit 3607125be153616b1b98a0fe1a55018d9681877d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 26 17:45:16 2011 +0100

    Move docs for rabbitmqctl set_vm_memory_high_watermark
    
    and only modify state when necessary

commit da3acdd8a8fe34fcffa64e88d0f990b19dad7b7e
Merge: 9dc1ad000 8aa5c1fd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 26 14:45:19 2011 +0100

    Merge bug24377

commit 9dc1ad0003370fe709035d7b2d8ab369d4d88617
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 26 14:23:17 2011 +0100

    Revert most of the merge of bug24315 apart from rabbit_misc:with_local_io/1 since that's now used elsewhere.

commit f0731e94f0c7b3f2962c7138c2a3d79ce5e47ce3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 26 06:51:39 2011 +0100

    move misplaced comment

commit 8aa5c1fd5e66490e88556243b0d6214d008a4bd2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 25 22:31:00 2011 +0100

    one way to check whether rabbit is running
    and avoid timeouts in application:which_applications() in doing so

commit 7ae03f5419de41a00d9fd0e5df09d44ff5015c85
Merge: d64c8d885 74ccda0d3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 25 19:42:42 2011 +0100

    merge default into bug 23056

commit a8c4a6c3da8d62e4299c254aad156ee88d36a031
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 25 11:00:04 2011 +0100

    Update for user tags. Also move the explanation of the listing format to the main doc part not the example.

commit e61d09654ffffbf9042bb70ea3bf3ed6ce981ace
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Wed Aug 24 16:32:57 2011 +0100

    And correct specs

commit 2e206712d07a22471b5d60d75b8b482e0842cfb8
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Wed Aug 24 15:59:49 2011 +0100

    Rectify some poor conflict resolution choices.

commit d64c8d885ce0c438d6e7c70c85be64d36a440270
Merge: 8087fc766 5b8affbb1
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Aug 24 08:52:14 2011 +0100

    Merge bug24095 into default

commit cedc0b54532a6ce3958a1e07d1e9c31af4e0eff3
Merge: c5bb2b426 5b8affbb1
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Tue Aug 23 18:41:02 2011 +0100

    Merge in default. Many conflicts unhappy face

commit fbe1be958a0d034c139af0d8839d3f2149ac25cc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 23 16:17:36 2011 +0100

    Cleaner docs, less verbose logging

commit 85a00f4fbee557d628e62174174da367cddb6cc4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 23 14:58:21 2011 +0100

    More conservative acks

commit 8087fc766b5e0786f13dcb2c6293e9ad9899233a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 23 12:24:58 2011 +0100

    Move the default pid file so it doesn't get wiped out by rabbitmqctl reset.

commit 5b8affbb142df2d715f9a2f20cdc880db8507bdb
Merge: 911d0d535 f2dad6a87
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 23 09:57:52 2011 +0100

    Merged bug23979 into default

commit ef1860423f72f72c9c027503f614ddb38a52e4f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 23:02:31 2011 +0100

    Use ctl wait in makefile; use setsid and backgrounding borrowed from init

commit 41e75d036e35b3306e01049d475851135d2faeef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 22 18:08:57 2011 +0100

    Fix tests, at the cost of a leetle tiny bit of ugliness.

commit 81da40ddac5e250539081a75967e457ad6d2c6ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 22 16:46:40 2011 +0100

    Update the man page.

commit 39a38ef258f8ea8719b3b0cfb8a269505595e67f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 22 14:23:35 2011 +0100

    Leave the Erlang distributed system when resetting.

commit c323222284af3526b69d27f7a37fd59f060006fd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 12:56:10 2011 +0100

    Minor refactor

commit 46d94f46c372df11f3e728521a137d00efaf7992
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 12:50:25 2011 +0100

    More efficient use of harddiscs

commit 7b30859afdc32517f7a9f082aae4200d453ab434
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 12:47:52 2011 +0100

    Always call client_delete_and_terminate for the transient queue. We then don't need to store the TRef and we should certainly never re-present it.

commit f2dad6a87d34a67c98fc39343a3a2b62228d6ed2
Merge: dc32d1fd4 20c6018bb
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Aug 22 12:44:03 2011 +0100

    Merge bug24357 into default

commit 29088e0724e315cee8bab9d8725d4431a9652a05
Merge: dc32d1fd4 a4d0167a7
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Aug 22 11:58:39 2011 +0100

    Merge with default

commit 20c6018bb09dce3eff6fb9c8c5dc5f26161a919f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 11:48:58 2011 +0100

    Shortstrs are actually up to 255. Derp.

commit 8525ce38ade0a2442bd93552d9c3a8f1f6161621
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 22 11:44:31 2011 +0100

    AMQP error reasons are shortstrs. Take advantage of ~p and limit to the shortstr length.

commit 5361e97272fee534ee1ecb7dee38fd514f475f24
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 19 19:32:42 2011 +0100

    Whoops, forgot that bit.

commit b78a8db06e81908db2d2ed75dc0f5eaae54f37f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 19 19:08:32 2011 +0100

    Fixed again.

commit 911d0d53574addcd92bf013b67d962da0baded39
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 19 16:17:36 2011 +0100

    only output warning if clustered

commit 3395a5842b58828f8fc77a95cd32656ceaea5af1
Merge: dc32d1fd4 aa89617ad
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 19 15:52:28 2011 +0100

    fast-forward bug23979 to default

commit c3116e5b9ff0eddb8129e958f4f75c5b2f7fc9c0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 19 14:38:17 2011 +0100

    Language in rabbitmqctl doc

commit dc32d1fd4bdf67a3c4982e82545f0bd6ab56e299
Merge: 2c3616f54 0ba936f40
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 19 14:18:04 2011 +0100

    merge bug24354 into default (test_refresh_events/1 sometimes fails)

commit 2c3616f54fe083e5ad9ac6bf4e6267005f880eae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 19 13:38:08 2011 +0100

    Typo

commit 9ee2a3eb27eb6d23fcecd9e2bb1428b2caa3cc44
Merge: 1a9f6b9a1 ad6472736
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 19 13:05:33 2011 +0100

    merge bug 24356 into default (pg2_fixed will blow up if compiled with R12B5)

commit 0ba936f4051a437866bd1d0bcb3d2e806c42cf48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 19 12:30:55 2011 +0100

    Hypothesis: what's happening is some old channel_created event from a previous test is getting overtaken by the rabbit_tests_event_receiver starting up, and is thus getting through to us. Solution: ignore events with the wrong pid until we get the one we want.

commit ad647273608465ba3e55ad01db3a06e162c990f7
Merge: 289ef6379 6bff5992e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 19 11:53:36 2011 +0100

    Merging bug24230 to default, again

commit 289ef6379284b5c02566741e1309bee5e5276507
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 18 18:45:24 2011 +0100

    Reverse the polarity, so that it is actually *right*, and make the nearby comment clearer.

commit 1a9f6b9a1c14354944ed8f5a42a0ef3fa49c6507
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 18 16:32:53 2011 +0100

    Remove uses of andalso / orelse where second operand is not a boolean for compatibility with R12.

commit 6bff5992e8914134810509da1b248015efe03e3b
Merge: d2582b551 592cd98da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 18 15:32:58 2011 +0100

    merge bug24194 into default

commit 592cd98da49e3b5699fa2dd491a7cbabf86fae5f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 18 14:43:09 2011 +0100

    'stat' needs to be higher priority too
    Since a typical consumer app will do a queue.declare "assertion"
    before basic.consume.
    
    The down side to this is that a queue.declare can now overtake a
    'publish' and thus report incorrect message counts.

commit e6ad12ecb0e4d44149655fe1424836c7270048c2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 18 12:25:02 2011 +0100

    Allow basic_consume and basic_cancel to match the priority of ack and co

commit d2582b551f68d95dfc07b2f29bae95cb0a66770f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 18 10:44:07 2011 +0100

    R12B-3 fix. I don't think this broke anything but it causes the xref CI test to fail...

commit 463fcc538a4b74af6d9a1342e6a1724315cb5298
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 18 10:05:08 2011 +0100

    cosmetic and remove dead code

commit a3ffc454221aaf147d5ce138dae7208cf7c6ef54
Merge: 2dc3eb753 8e8a65c33
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 18:11:11 2011 +0100

    Merging bug24350 to default

commit 8e8a65c3350661a06fa42803bf09cfc475322eef
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 18:06:01 2011 +0100

    I refer you to bug24285#c40

commit fab0e02038ffd9b876eaef2c37328875385e1c9d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 17 17:05:00 2011 +0100

    refactor

commit f246890fdc2e2de4e620c5938a0cc55a399e46ac
Merge: 2dc3eb753 dc879dea9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 17 16:46:11 2011 +0100

    merge default into bug24332

commit dc879dea9055ec357c808de1622a504d85b9b0ef
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 17 16:44:01 2011 +0100

    tests pass

commit 2dc3eb753112511241c6cc68396351cf8851d899
Merge: 80e4fe0ec 6819ee565
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 16:20:32 2011 +0100

    Merging bug24230 to default

commit 80e4fe0ecf1e354e56ebf787de0125bb335f5f8a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 16:17:15 2011 +0100

    Add missing spec

commit fe620a6c2849cd0ca1922b72f3bbd0c913de1a13
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 16:16:00 2011 +0100

    In Erlang 'Ye Olde Versiony', you can't just call 'error'

commit 9ad33199a63a94a9eb274eeda193adce541ae868
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 17 16:01:14 2011 +0100

    More testing of which_children

commit c05d03cdea1d476d6f9b4d86a3655eaf40373764
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 17 15:37:46 2011 +0100

    {error, already_present}

commit 7cf68828f0e8d83d061218436e906ca831e11e26
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 14:56:09 2011 +0100

    Get algorithmic complexity of function right.
    Yes, it's 4 more lines, but:
    > L = [{X,X} || X <- lists:seq(1,1000000)].
    > timer:tc(erlang,apply,[fun () -> mirrored_supervisor:merge_proplists(L, L) end, []]).
    {190570,[...]}
    whereas with previous implementation, after eight minutes, this still hadn't completed.

commit c97dbfd77b8e7edc4e4e26fef19c47f14f41a521
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 17 14:24:52 2011 +0100

    Detail about units of numbers reported by 'rabbitmqctl status'

commit 0773289662059115ceb537fd9ca96f5f93bf3cba
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 17 14:17:09 2011 +0100

    Query total RAM when updating highwatermark

commit 6819ee5650d7c66acc21767bdcf80be66b280dce
Merge: c7d06d2bf fc4352d00
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 14:08:02 2011 +0100

    Merging bug24285 to default

commit c7d06d2bf333f37ebf649ea354c87dc71bd62c55
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 13:08:46 2011 +0100

    No need to do the append

commit fc4352d00c21d718b3de2004fd343dae2bf6a5cb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 12:57:33 2011 +0100

    Cosmetics

commit 5f6badff69dd02ca7a62361dbd0d3658c95e977e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 12:49:41 2011 +0100

    All gs:calls should be 'infinity'; cosmetic change to spec

commit 43a7ed2aed33d8c8e7f9aa304e04b534fdde5798
Merge: a79e0dab1 b14f55435
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 17 12:48:23 2011 +0100

    Merging default to bug24285

commit a79e0dab1ee45f9a7877a7fcd69756e15683542a
Merge: e9cd2ed9e b0183b010
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 17 12:36:43 2011 +0100

    merge bug24340 into default

commit 1939ebd315d384336bd6e6dba8f78b5b4a8a7a91
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Aug 17 12:25:14 2011 +0100

    Change vm_memory_high_watermark while running

commit b0183b0100c17a89b786e7a61092432639cbac22
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 17 05:11:03 2011 +0100

    refactor rabbit_tests:on_disk_capture/1

commit d46815c9b4131d8026f6abcf2d7dfd17236f2a75
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 17 05:09:52 2011 +0100

    nuke file_handle_cache:last_sync_offset

commit e9cd2ed9ef6274aec988d1e4cd5fc2e8adbd25ab
Merge: e57772edf 9c0212912
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 16 18:44:33 2011 +0100

    merge bug24132 into default

commit e57772edf2423e8827a6e8ecb6d2ca2ab6dff675
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 16 18:08:48 2011 +0100

    mark list_local as 'internal'

commit 63ccac28dc82f91a802db23c21a165762615224b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 16:32:38 2011 +0100

    dialyzer points out that blah.

commit 3523bdaa20c369496765c1ce4bafefef53e527fe
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 16:30:31 2011 +0100

    Don't have misc depend on mnesia.

commit fffc5d1545f68b40a89e4fd68989e0768d134fa9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 16:18:29 2011 +0100

    ...and now we only need to talk to rabbit nodes, not all nodes.

commit 2f047bb33300b661979913ae71f122c54e13e832
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 16:14:26 2011 +0100

    Move the pg_local management into rabbit_direct.

commit b500b5810dcd107b5eeb61a4c5fe75bd6536b240
Merge: 92d33216b 9c0212912
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 14:05:04 2011 +0100

    Merging default to bug24340

commit 9c02129120b895b43ee51b483dae56203662ad23
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 14:04:50 2011 +0100

    Correct spec

commit 92d33216b79fd86321f4903079b969142e6ee085
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 13:59:54 2011 +0100

    Remove dead code

commit f7485f7337700987773c79a1b9be8225850ce863
Merge: 730e42d8f ae9365022
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 13:34:13 2011 +0100

    Merging default to bug24340

commit ae93650229f10f5156ddf0b16b950d1ee5ee6557
Merge: 34bc2e7da 1dd717201
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 13:32:49 2011 +0100

    Merging heads of default

commit 34bc2e7da9c3430140c61899cd576f28d7b24e52
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 13:32:06 2011 +0100

    Reforce msg_store sync interval to 25ms, which was the goal of bug 23765, but was accidentally undone in changeset 8fd9704bd1dc.

commit 730e42d8f8aba4b79a5450843da2aa9deb934f8c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 16 13:24:53 2011 +0100

    Correct capture of msg-on-disk in tests as sync replacement; rip out explicit synchronous msg_store:sync and other unneeded logic

commit 1dd717201df143d5eaac88a47e74f39e697511b8
Merge: 1e4689b72 37777fc46
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 13:04:06 2011 +0100

    Merge bug 24130.

commit 37777fc466a609380ca6043bbb1ea87a2988b1cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 12:57:06 2011 +0100

    A little bit of explanation.

commit 1f4ab1c7b1192d4999bb2293b4b6e06919cf4e0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 12:29:44 2011 +0100

    I think this was the problem - since the channel was not part of the supervision hierarchy it would not get shut down (and if it was the test would not work!) but it could try to send stats when rabbit_event was down. So close and recreate the channel.

commit ad9abe5c9106d468bcc369118bcf69dfb8815f14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 12:02:29 2011 +0100

    Don't drain events, instead get rabbit_tests_event_receiver to only forward on events we care about.

commit b384571346491b87b77609fe50dfc6cccd25e831
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 11:37:41 2011 +0100

    Move these back where they should be...

commit 1e4689b72de856ff8083782b5a8f951db9164a0d
Merge: a88be278c 5a5392185
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 16 10:49:39 2011 +0100

    Merge bug24289

commit 5a53921850fc5bb2f959c5929451d4ab1332709a
Merge: aa89617ad f6f03b1af
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 16 10:40:21 2011 +0100

    Merged bug23979 into default

commit 7c151ba0a8f3482d3651e0dff3244f5fb3a02cac
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 15 17:42:09 2011 +0100

    Initial version of requeue preserving order

commit b8572a679be98d5f3a46b9a99e8255970cd69b62
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 15 17:02:24 2011 +0100

    Well it doesn't work, but it should eventually...

commit 30b3e146747b9b67b90bafb3d6bef2abb31c85c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 15 16:42:18 2011 +0100

    Oops

commit b14f554357f83cf0f2301101ffd4d499457f6699
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 15 16:37:35 2011 +0100

    refactor

commit 6fef41e263e41312e5d63e34eb7dd1719c60fae5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 15 16:26:34 2011 +0100

    Aggregate which_children, implement count_children.

commit aa89617adf819aea261b4a3e8eeaade1e78c6e79
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 15 16:00:50 2011 +0100

    refactor
    
    The sets thing is probably slower, but it isn't run that often.

commit 188f11f2ea0104fee15456c1c5bd49004e59b94e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 15 15:44:39 2011 +0100

    closer to passing the tests

commit 5021b0da7bce4a28f9fb4d3410ea6830c408891e
Merge: 561597328 d4f7f81de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 15 15:28:00 2011 +0100

    Merge heads.

commit d4f7f81de7d5c48335d92df270787d474decc2b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 15 15:24:18 2011 +0100

    Make delete / restart / terminate work groupwide.

commit 43b0f15fc6ade39b98c31298fa9393ce5142b4af
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 15 13:05:48 2011 +0100

    Update property for requeue order
    
    Store sequence id with message to maintain ordering
    Record acks in a list - complex data structures suffer from corruption when contained symbolic values are evaluated

commit 561597328be0ebca1f2ead258699e184ef4c55a8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 15 12:30:24 2011 +0100

    Simplification of comment; improve consistency of function arg ordering; make mnesia table an ordered_set and always put the Group first - this will improve performance of delete_all and is generally nicer.

commit 43b70982f3b9916871ff2bf1f0a45e9b24691703
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 15 10:33:20 2011 +0100

    use the new logger environment variables

commit bec0839acc7deb60abf2ce3762b147ea2fdc83bd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 17:59:06 2011 +0100

    sasl logger also appends
    
    Removed the "log file not writable" tests because rotate_logs now
    fixes that problem by deleting the old files.

commit 59d0dcc5d511570a066ec823b2c1fdbed04e808e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 17:49:23 2011 +0100

    remove old log files when rotating

commit ac7a3a8cdfeedd541dc222b486b94db5c06773d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 16:59:28 2011 +0100

    don't bother swapping out non-existing loggers
    
    Error logging seems to work fine even when stopping/starting rabbit.
    Also, remove the tty_logger last in case we need it before.
    
    Since ensure_working_log_handlers/0 is the first executed by rabbit,
    we can be fairly certain we won't miss any log events.

commit 5cb15bfdc5ff05e55cef6fb01f77f5349ac252b2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 12 16:34:55 2011 +0100

    If the client is dying, turn the sync into a noop

commit 02228954e49afafdd8f4305d198ede89d8574130
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 16:09:05 2011 +0100

    fix warnings

commit 6cb8a0b5b41fc5dbbcde121256ac23244d0d9bc1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 16:04:38 2011 +0100

    don't log to console if there isn't one
    
    The on_node_down/1 and on_node_up/1 warnings will be run another
    rabbit node, which is not a user using rabbitmqctl.  Since there isn't
    a console (probably), don't bother printing the warning; just log it.

commit 45ed25d145f76edd863baf960c2b4a43a319c4e4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 16:00:45 2011 +0100

    warn when the last *running* disc node goes down
    
    As opposed to when the only disc node goes down.

commit d5287f57cd5a86efd30f6f9fb2039f6fa4677058
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 12 13:50:31 2011 +0100

    start the writer declaratively

commit 0f883e515008a52dd6ebf61eb428632c581d1423
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Aug 12 12:26:06 2011 +0100

    Add requeue order test

commit bbb61ce416b91492800c3956dbd6854fd115c416
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 20:10:35 2011 +0100

    start the limiter programatically
    
    Also, how do you name a function that returns a list 'find_child'
    (singular)?

commit dd172f3127451c355af611ade4e34e5e6f3f4eae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 19:38:19 2011 +0100

    fix specs

commit 9c488e7fb20955b15178e1b2a7cefca8dfa6c382
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 19:25:20 2011 +0100

    replace undefined | token() with token()

commit 5b4b26ff4c723248063d32be099a665b075ded2c
Merge: e4bbe62e5 f6f03b1af
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 18:48:23 2011 +0100

    merge from default

commit 5ff902b4d2118d5d451d976c7287f27f0d4c65da
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 18:34:07 2011 +0100

    only allow the rabbit error logger to touch the files and append rather than overwrite
    
    If the standard error logger is initialised with the correct file
    names, the files will be overwritten.  So, we no longer tell Erlang
    the location of the files at boot.  It will automatically register an
    error_logger_tty_h, which we then unregister after setting up our own
    loggers (you can't swap a file logger for a tty logger).
    
    Still left todo:
      - error loggers when stopping rabbit,
      - windows rabbitmq-server.bat,
      - the other head of ensure_working_log_handlers,
      - it doesn't really make sense to swap out the non exitent
        error_logger_file_h.

commit e4bbe62e53c95d1b66998e07a0a49b6603167642
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 16:14:50 2011 +0100

    refactor

commit fe09c02d8d20893f4fef3fb39ba923e4de28564e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 15:44:06 2011 +0100

    fix dialyzer types

commit 93fe43622a4bcfede8ad731e811df4b8bea67748
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 14:56:54 2011 +0100

    inform when the first disc node rejoins the cluster

commit 1c59d0a24a18e7deb4240cc79a473d37780044ea
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 11 14:15:34 2011 +0100

    More consistency

commit 1883df90676fe5db719ec6469aa95275821870c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 11 14:14:11 2011 +0100

    Report empty list of slave_pids when mirroring is off, rather than empty atom

commit ea063f697bbd9be1576a1df29ea0fe6bedd82e18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 11 14:13:11 2011 +0100

    Remove unused var, and cosmetic (record whitespace trumps vertical alignment in my book ;) )

commit a88be278cfe6cd900af79f0b110d6e02c034c30e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 11 14:05:21 2011 +0100

    alignment

commit 68f1110e4ab5771bd41718161ae6bbb7778deb93
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 11 13:37:00 2011 +0100

    Report the name when a queue is deleted.

commit 20985917da9b2c654c78a4e443224a24db13bd12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 11 13:36:45 2011 +0100

    Report queue slave events by name rather than by QPid.

commit b18c4c95c5d1bc03756e2eb27d416f2711acbbe3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 11 12:04:06 2011 +0100

    That one isn't needed either.

commit 30e8edcc85de0875e468b3dae3fcea8303bde6c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 11 12:02:24 2011 +0100

    Use {Id, Group} as key in Mnesia, and remove update since, err, write will overwrite anyway...

commit 5c27f4d3c848fa8132e202733a05a53c4d3ae7b0
Merge: be0cc69ae 96c02054d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 10 18:08:10 2011 +0100

    Merge heads

commit 96c02054ddc0b3ba02a9a7b27692a6f58465af67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 10 18:03:54 2011 +0100

    Fix stop raciness.

commit 14fea80fbd9be28925a602ca9454fc55f63f3b6b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 16:20:18 2011 +0100

    Reworkings

commit ab82e9f59f7e376f8978864840249051b4bffdab
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 10 15:05:07 2011 +0100

    I think we can be more assertful here.

commit 282c6f53d129fc7b0e1589e84fb41f575df60428
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 10 15:03:16 2011 +0100

    Identify the (possibly former if it changed) master pid in the queue_mirror_deaths event.

commit be0cc69ae9bc07b7a9ad2a60757c60c1c987a4d5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 15:00:03 2011 +0100

    Cosmetic

commit 871e1961782bc9a52c6519f4a855f8024e2c7ad8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 14:59:38 2011 +0100

    Cosmetic

commit 7639a6183a3c7f52f6d731b8182a18ead0d457aa
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 10 14:36:41 2011 +0100

    oops

commit b22535586fb5a141046b732cf02a933142f848bc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 13:39:09 2011 +0100

    Various improvements mainly to detection of and reporting of death

commit 4837a81deacf1ce23358384ebbd900e7d6b6ed46
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 11:39:03 2011 +0100

    drop mirror_nodes info item

commit 103dc69ffb38c77842cf1d8171a2b0edb40dbd37
Merge: f6f03b1af cd0ec24ce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 10 11:26:00 2011 +0100

    Merging default into bug24130

commit efcf90291c8874aaabde07de896f4384c7c84e91
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 10 11:06:01 2011 +0100

    remove misleading comment + small refactor

commit 4f722487176d49566a29da05dde05c79e7d174e2
Merge: 20f581d19 f6f03b1af
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 10 11:00:08 2011 +0100

    merge default into bug23979

commit 5534b2f369d9adc3ae06c40e94f0e1b192c16917
Merge: f6f03b1af d0fb3ef8c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 10 10:49:16 2011 +0100

    merge default into bug24289

commit 314074f8e8f8c01cdb6843773b6999830cf99cf6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 9 15:33:58 2011 +0100

    refactoring: lift closures

commit 572816800c67df388d66463a23bf96703ca53df0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 13:22:50 2011 +0100

    Should explain this...

commit 2f0fc194f5fbc0ea053cf34ed892f07170503370
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 13:17:25 2011 +0100

    Flatten.

commit c9f225ff25082a651706292d906d77f9f40026d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 13:15:53 2011 +0100

    Slight test for ignore too.

commit 2a7d16833d40ef6b007fc4d9048b7a9ff46908e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 13:12:37 2011 +0100

    Blow up if we're asked for simple_one_for_one, more tests, try to handle Mod:init/1 returning ignore.

commit 1ddad291fa6a5932db9cb1b4dca27419d48cab22
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 12:31:49 2011 +0100

    Matthias thinks this is obvious :)

commit 5369e55ff293ae31c17d6ec72d9f818d46ea78e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 12:29:40 2011 +0100

    Test queues as well. Connections Are Hard.

commit c3c7fd6557cc8aced1786ba82e0fc3cb05604c0d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 12:02:24 2011 +0100

    Merge all the _exists events back to _created.

commit d13177cc7ef5466f09f2827fc040c4725b8ccf2c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 9 11:31:48 2011 +0100

    Export amqqueue:list/0. Remove filter_exit_map use and timer:sleep/1.

commit ada63ddb1fd4efbebb26436e36ab7c3588b9354b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 18:46:51 2011 +0100

    Clear mnesia table up if we're the first mirror to start, since otherwise we can leak when all mirrors go down, mnesia does not and children were added dynamically.

commit f6f03b1afc93639d4cc5f4c66a2e9392506b434c
Merge: ab700197d fafcb7be3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 8 18:07:11 2011 +0100

    merge bug24322 into default

commit ab700197dd3f6ab81ef11c059a038dd4e6b763ab
Merge: b19323c88 1701e5889
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 8 17:50:40 2011 +0100

    merge heads

commit 1701e5889c27329dc1e280050e225e7335b74d26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 8 17:48:44 2011 +0100

    correct spec for rabbit:stop_and_halt/0

commit b19323c8802205c9bd22747316e59d9a603a770b
Merge: 6826eaefc 14191a156
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 8 17:38:34 2011 +0100

    Merging bug24319 to default

commit 6826eaefc4cb212b0faeb152ec6d2ba1203802cf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 8 17:21:11 2011 +0100

    Upgrade all entries in a segment

commit 14191a156a4be97d87dae99bae3b88d196d9f4e0
Merge: bffc69e2d 79107abf5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 8 17:15:52 2011 +0100

    Merging v2_5 branch to default

commit f533d09ce31d3ed7a41ed9387ef61b7b012e580b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 17:10:15 2011 +0100

    More doc.

commit 7027bf9f23ea9ed96ba14ffb04668e72debbc393
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 17:05:55 2011 +0100

    Don't delete from mnesia if child is running.

commit 68e1af754a89c1a7ae93c36c0828198564649c1f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 16:49:45 2011 +0100

    Exit differently.

commit e15c6d91696f4935c572bbea953dd5c7e8ae74c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 16:37:44 2011 +0100

    Explain cardinality relationship between modules and process groups.

commit fa4ba6adf48faa8363b5c8673aaa84069b4381e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 16:24:51 2011 +0100

    The most important commit so far.

commit 5c85a01c0e62f12a320f6eeea443f7e4d3dfb0d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 15:06:35 2011 +0100

    Test at least some of the refresh event code.

commit fafcb7be34bbf87d531a02bf21f893a158eab036
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 8 12:27:03 2011 +0100

    closer to default
    
    And don't clobber the state.

commit 215157444302137b870bc0faec7ef73b1b3a0870
Merge: 80ceb2367 79107abf5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 8 12:17:33 2011 +0100

    merge default into bug24322

commit 80ceb23676927669c18a2afdf10ad1a63902d3b9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 8 12:17:12 2011 +0100

    simplify node monitoring

commit 62f6bda562541f078c3f8b7bdbf1001ceec3efc8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 12:17:04 2011 +0100

    Rename and refactor append_rpc_all_nodes, and get the networking:connections() to use it since otherwise it doesn't handle failures.

commit 26610eabd92603ede622a7ed4e0dab6f575ba10b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 8 11:52:56 2011 +0100

    Various smaller QA things.

commit 74ccda0d367fd06c2cdada2d22416532d1929bf1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 8 11:44:57 2011 +0100

    fix dialyzer warnings
    
    The ones left now are mostly our over-specifying functions in
    interfaces and a couple of "crated function has no return".

commit 79107abf5327f561ad20f294ac80857a2758e596
Merge: 71514c3b6 64334c817
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 8 11:01:55 2011 +0100

    Merging bug24313 to default

commit eee95b08550604f85edae37cb986cc1a06f0ca56
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 8 10:41:11 2011 +0100

    more specs
    
    The specs in msg_store_ets_index, msg_store_gc, msg_store_index, net,
    networking, node_monitor, prelaunch, queue_collector, queue_index,
    reader, registry, restartable_sup, router, sasl_report_file_h, ssl,
    trace, upgrade, upgrade_functions, version, vhost, writer,
    tcp_acceptor, tcp_acceptor_sup, tcp_listener, tcp_listener_sup,
    vm_memory_monitor, worker_pool, worker_pool_sup, worker_pool_worker,
    misc, types are up to date.
    
    That should be the last of the specs.

commit 71bfdac1951600f04dadf9b161de2a3882c7468a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 5 17:43:31 2011 +0100

    Be more assertive about exclusive consumer being... exclusive.

commit 60205ef4e8a9bd4fe863dc80bba0a92de315cf2c
Merge: 36d6750b0 7bc13caf1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 5 17:15:08 2011 +0100

    Merge in default

commit 17df91ba5ce1c38eac2c559fd108aae1b0cbfc1d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 16:13:39 2011 +0100

    even more specs
    
    Specs in heartbeat, limiter, log, memory_monitor, vm_memory_monitor,
    mirror_queue_coordinator, mirror_queue_master, mirror_queue_misc,
    mirror_queue_slave, mnesia, msg_file, msg_store are up to date.

commit 64334c8177b37edb2f83e7516f1d8067f1f6f07c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 5 15:53:50 2011 +0100

    minor simplifying refactor

commit 010a6f713383315a9bcf7cfd2b1e859a23fd0a47
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 15:05:02 2011 +0100

    more autogenerated specs
    
    The specs for framing_0_8 and framing_0_9_1 are up to date.

commit 2263a1a11da4144f11ed7da4140d0e77e2c449b7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 14:57:38 2011 +0100

    more specs + revert earlier mistake
    
    The specs for binary_parser, channel_sup, channel_sup_sup, client_sup,
    command_assembler, connection_sup, control, direct, error_logger,
    error_logger_file, event, exchange, exchange_type,
    exchange_type_direct, exchange_type_fanout, exchange_type_headers,
    exchange_type_topic, framing, guid are fine.
    
    The two framing modules are missing the spec for lookup_class_name/1.

commit f4b8122b17cfb7e23db4b70a5501391dd841b191
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 13:51:08 2011 +0100

    more specs
    
    Specs for access_control, binding, alarm, auth_backend,
    auth_backend_internal, auth_mechanism, auth_mechansim_amqplain,
    auth_mechanism_cr_demo, auth_mechanism_plain, backing_queue, basic,
    and binary_generator are up to date.

commit 4a973ca48103c560fb09b3a961991aeb83481f9a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 13:00:13 2011 +0100

    more specs
    
    Specs for gatherer, gm, priority_queue, rabbit and rabbit_sup are up
    to date.

commit 18a52855ccb9bfabffaed7b36d133200ea5f6b0c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 12:35:05 2011 +0100

    file_handle_specs are up to date

commit c53593038f0078d659d3b10dca9661d5001b4c63
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 12:26:52 2011 +0100

    refactoring
    
    delegate_sup specs are up to date

commit e4857afa0c062662a971590576f87a97be5aa571
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 12:22:47 2011 +0100

    cosmetic

commit 4fb7a0370842cc90af48fb628103563376f89e3e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 12:21:47 2011 +0100

    amqqueue_sup, delegate specs are up to date
    
    Nothing to do for bpqueue.

commit a1e7aab0236b6cf7d99b540f8f778468e44a4846
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 11:39:28 2011 +0100

    backing_queue_spec and variable_queue specs up to date

commit ce416bf76e142ba2649d1c39f1649085b1cb5dc7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 11:17:22 2011 +0100

    channels and amqqueue_process specs up to date
    
    Nothing to do in channel.

commit d64c9fc613830676ac861b2cae44c1ad3a6dc8be
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 10:50:35 2011 +0100

    amqqueue specs up to date

commit cd0b66740cc87e2e13a4e32518c74bbaebafbed2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 10:07:32 2011 +0100

    cosmetic

commit 553e01677b661600960a55cb21db051ea3eb014a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 10:06:29 2011 +0100

    don't add specs to the modified OTP modules

commit f72086292bc13dcd5cbb9aa2e5aa9eacc6602d42
Merge: 625f9b72b 36d6750b0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 5 10:03:12 2011 +0100

    merge default into bug23056

commit 20f581d196216fc48f84c884d4fa9bd77adf9aac
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 4 17:14:56 2011 +0100

    don't warn if Force is set
    
    Because the warnings require mnesia to be started and Force is usually
    used when mnesia cannot be started (e.g. when force_resetting the last
    node in a cluster).

commit 33f2427221c393d90fb66a6a1208905874ca97de
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 4 15:43:50 2011 +0100

    log warnings on local node

commit b4902c13a80c9479398c3a9dc170e3371fb62539
Merge: 36d6750b0 06e61c58b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 4 15:21:30 2011 +0100

    merge default into bug23979

commit 36d6750b0f984a105c448609cb29f9037193d8b0
Merge: 55116c93f f3e6ec241
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 4 13:35:34 2011 +0100

    Merge bug24315

commit f3e6ec2415a26d47eae6ffbd003648a487580067
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 4 13:35:11 2011 +0100

    More generic.

commit e770bab34dee193a5ed3b9904741144622b45ec4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 4 13:02:27 2011 +0100

    Return the value of Fun(), and make sure we always restore the group leader.

commit 6d40a193d6c8e73216c8fc640533329669b7e859
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 4 12:26:46 2011 +0100

    better argument formatting

commit 55116c93feb00f5cd9fb09a50199f4223b08c713
Merge: 6f2c6d952 c6f5efd88
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Aug 4 11:26:15 2011 +0100

    Merge bug24305 into default

commit d8d01c9ecd9a5c1dbf5e0f2095ffd8513f36a3a5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 4 10:59:03 2011 +0100

    remove logging statement

commit 33479da737c7da9cd40448a873b675a8b8f5662a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 18:53:01 2011 +0100

    keep track of which nodes are up and don't cleanup after the same node twice

commit c5bb2b42652d095b96272d12cbe7a770ff79f439
Merge: 6f2c6d952 2e532d1df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 3 14:36:12 2011 +0100

    Merge in default

commit d9847e1f8732f6226ab738d3b5e957eb7b5ab7a8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 13:39:46 2011 +0100

    cosmetic

commit d774d85a72848145535c4fb6a706cf1fa01a6e99
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 13:39:31 2011 +0100

    abstract out with_local_io/1
    
    Because it will be needed whenever a rabbitmqctl command causes the
    logger to print anything.

commit a60c32b182cf81d6a2727deec21be2be931729d0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 13:12:51 2011 +0100

    refactor mask_args

commit 06e61c58bed50f7e4398fa78b8c2af2e7ef6e197
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 12:57:20 2011 +0100

    wording

commit 1dfde164803eb95df86957f0e28a7a6cae2f892c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 12:48:04 2011 +0100

    don't stop mnesia if it was already running

commit 6f2c6d9527d38122d7cd113c0e65f1c80ddb0036
Merge: d3509448a e21b90260
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 3 12:30:31 2011 +0100

    Merge bug23504.

commit e21b902601e1be8b1beac77372cc7eaed6ad00f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 3 12:26:34 2011 +0100

    Cosmetic

commit 65fe27ce65b0c29e6d18fb35b1e1439842d64813
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 11:41:24 2011 +0100

    warn when the last disc node fails

commit 8f60a84cbfa3019a3a9d196f55b32e24b765b47d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 10:51:40 2011 +0100

    warn when resetting the last disc node

commit 0f56bb08552bb6bda110c14ad7f242393fb62667
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 3 10:37:50 2011 +0100

    warn when removing the last disc node from a cluster

commit 0573d3f32651aee28d3f040a745e4c726ac33115
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 17:48:28 2011 +0100

    refactoring
    
    Rename internal_emit_stats to emit_stats.
    
    Add the missing export to channel.
    
    Prefer one big case statement over a function with two heads.

commit 0ee057a0bafc8ef28c2d5925df238d6be49face0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 17:27:01 2011 +0100

    be discrete about what you log

commit 7bc13caf1ec82c6ca7fcd9710efa56354dab9c04
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 2 17:13:33 2011 +0100

    Fix list function names, introduce an abstraction.

commit 7eaae5011bf69aa05e1fb33247630b1355e8f74f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 2 16:33:41 2011 +0100

    Tidy up slightly and make rabbitmqctl list_channels cluster aware.

commit 64b7039293f3d8d4619355853faca2713b15c8d5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 16:06:44 2011 +0100

    log rabbitmqctl invocations on the remote node

commit 71514c3b6b51cf1e39941dc107cb7eb534b5f89b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 2 13:33:42 2011 +0100

    Use acceptable message expiry value

commit 33f5bbe586ae377301c8fc8bdf8eab7d417acae6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 12:46:53 2011 +0100

    more consistent naming
    
    It's called *internal*_emit_stats in the channel.

commit 5097d7c4f335f6df9389d3f99c7d129998a6866d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 12:27:34 2011 +0100

    just ignore the result to erlang:cancel_timer

commit 23e91e841569bb3eb43436f992c557c71a4e2693
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 12:18:58 2011 +0100

    convert another timer

commit 849ededdd260bf4b7ca190a1e7ddb84ab5baf20f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 12:03:48 2011 +0100

    convert mirror_queue_slave's sync timer

commit 898a884b0a544b2548159f103b1e2379aaefb580
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 11:58:03 2011 +0100

    convert gm's flush timer

commit 6d5c958d5aa6a8dcc88df26c6bd0f47f192f3a13
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 11:47:23 2011 +0100

    convert amqqueue_process's sync timer

commit 59d4ccaafcbf850b58076dbbeacae47396d75cae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 11:41:23 2011 +0100

    some more refactoring

commit fb956f77077687c7f198b27163ae89bb3145e935
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 11:11:14 2011 +0100

    refactor

commit 0ae1bba1dd2d519a9b50540e76f79ae518b810f7
Merge: 9b10c994f d3509448a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 2 10:48:18 2011 +0100

    merge default into bug23504

commit 20efde3748633f362dbef33f0190021f5b0df464
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 1 15:01:06 2011 +0100

    Introduce rabbit:force_event_refresh which will:
    
    * Emit a foo_exists for every foo that can emit foo_created
    * As a side effect, wake everything up and thus send out foo_stats events too.
    
    Currently this doesn't work for direct connections (rather more fiddly), but it does for everything else.

commit d6416a72d485c74c05dd0c1bb0d2cd9235ea9c60
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Sun Jul 31 20:59:15 2011 +0100

    Add IndexOnDisk to AckEntry

commit e43f0bddc96ea676ded522b235056f9e3c41fe21
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Sun Jul 31 20:40:57 2011 +0100

    Turn q3 into random access data structure

commit d3509448afcd1f6f0783c13bc877560b43c9b5f5
Merge: 7ab6f4234 7fcf30954
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 29 16:29:10 2011 +0100

    Merge bug24284

commit 7fcf30954d940160ff540c5aef51d53e1b485fc9
Merge: 358c6fbb3 5c725cdc0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 29 13:25:53 2011 +0100

    Merge bug24292

commit 358c6fbb3f4760282bf0bdd901cc96f6cb7cb461
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 29 13:24:50 2011 +0100

    That comment feels very redundant now, this is no longer hard.

commit 5c725cdc01dfe220e05a8c0861ba6e1620d69cc7
Merge: b57f57bd2 317b7a3e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 29 12:13:54 2011 +0100

    Merge bug 24227

commit 317b7a3e90c42a7606feaec563308ec0317e1a0a
Merge: fc9658cc6 9cae10fcf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 29 11:23:42 2011 +0100

    Merged bug24278 into default

commit 7ab6f4234cae7c6ed9331810f046bee840c47089
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 29 10:26:31 2011 +0100

    silence nsis

commit 42ec8b74f9fe8f829b8876a2c2a827b470e34c1e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 29 09:56:45 2011 +0100

    silence tar

commit ee337278aa2637d0d6c0f13a3b357eb727820deb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 28 18:30:30 2011 +0100

    silence zips
    
    Gzips don't normally print anything, so they're fine.

commit 9cae10fcf9a3fc816eb31b293a51989ab3d5068d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 28 18:23:06 2011 +0100

    Make sure every shortcut has "RabbitMQ" in its name, and be a bit more consistent.

commit fc9658cc636109d8462c3a9c189da135d52c54e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 28 18:08:36 2011 +0100

    employ more sophisticated message queue formatting
    ...in the channel, queue and msg_store

commit a653ca51e46cd4f16ed298f1befe77d1057b531b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 28 17:32:49 2011 +0100

    silence unzip

commit d0fb3ef8c30b8d2770e95b5663620e694f22e5d8
Merge: b57f57bd2 5bd77d974
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 28 16:39:30 2011 +0100

    merge from bug24227
    
    Also add the wait_for/1 function that was just removed from that bug.
    Hah, the dependency on that bug isn't necessary anymore.

commit b57f57bd212907f6efb0293c3a85c756224b6d20
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 28 16:30:48 2011 +0100

    abstract out mnesia:start and mnesia:stop

commit 153af9d0dcce41ee6b5e5ab5afe1f5c9abb6722f
Merge: afd128544 5ad5ca885
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 28 16:27:19 2011 +0100

    merge bug24307 into default

commit afd1285449b9513987e9d4b0cf15b50a86103311
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 28 16:26:55 2011 +0100

    refactor

commit d1c5c01e71d6eb64572044304bb9a4c35cd705d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 28 16:16:42 2011 +0100

    strip out the new backup naming scheme since it isn't necessary anymore

commit 72abcd76380d49ed1e7688d073292b79fec6b2a8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 28 15:11:43 2011 +0100

    Don't unpack and repack

commit fc65da2a1bfa9045945ee3b60311e079941e1ff3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 28 15:02:52 2011 +0100

    Don't call prioritise_info for EXIT from parent. Use infinity priority for system msgs and EXIT from parent

commit 031179d8deea02070cecfe54dd251f73c00a9844
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 28 15:02:11 2011 +0100

    Minor refactor and introduce horrific inefficiency

commit 9d08c2abc95443ce9a4ffef1098a7ec48d879a20
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 28 14:45:06 2011 +0100

    Make priority_queue be able to have a concept of infinity as a priority

commit 5ad5ca885c05a04fd2274bf71571c8aec1966edc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 28 13:03:11 2011 +0100

    refactor: use multiple heads instead of 'case'

commit a4d0167a778a571b1736a832c78f77cce876081b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 28 11:51:47 2011 +0100

    MNESIA_DIR is not always set. Make sure the directory exists.

commit 951e3f2982c21fb03bfeed07548aa5881209ef3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 27 17:27:16 2011 +0100

    ...and get the ownership right.

commit d9a155b8365f9b9a066978231facbab3d9b827c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 27 17:17:51 2011 +0100

    /var/run/rabbitmq should exist

commit 2448d4afdc9a9a2b5759a05cfb53234289c2f989
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 27 17:11:10 2011 +0100

    Always write the pid file, and write it in /var/run for debs/RPMs.

commit e6e9cee87b8ffe73dfdfb3b472d48ff04dd5bfb5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 27 16:38:49 2011 +0100

    Turn q4 into random access data structure

commit 135c9b0fee81ccdc037cbfc6c68e0e294251df1f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 27 15:20:03 2011 +0100

    remove some magic

commit 5bd77d9749c875507963faa0ee8899c7054dc258
Merge: b244d5dde 6bee95507
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 27 14:54:09 2011 +0100

    merge from bug 24227
    
    And fix the two conflicts that appeared since the last merge.

commit dd5755647a68aafd26a1e73cdc47a94875e909fa
Merge: 5d4e44fb9 d89965a28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 27 14:02:57 2011 +0100

    merge bug24288 into default

commit d89965a28f6a66128d4f7e42c812d08604140fc9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 27 13:12:11 2011 +0100

    General improvements

commit c6f5efd888d0068b5242aed9721b9b9f476af3c1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 27 12:43:56 2011 +0100

    It has been decided that masking out on write, is preferable to masking out on read.

commit cd0ec24ce1aa285dcae469ab1df98f2a529a5081
Merge: 5d4e44fb9 77f12b1bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 27 12:24:43 2011 +0100

    Merging default into bug24130

commit df1c1403a82f570b81a584dbbc4331216c5d86ef
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 27 11:09:03 2011 +0100

    catch-all cases, not just undefined

commit f258807e5635e9e649a678d4371241258b6c1ae5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 18:39:12 2011 +0100

    Wipe out slave pids whenever we start up a queue.

commit 5d4e44fb9b6c0d382cf0c2b96426f03b3558768e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 17:24:59 2011 +0100

    Move ha boot steps to somewhere more appropriate

commit 6db4fa05544a03474c1a75d32ea5608e182abc75
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 17:01:51 2011 +0100

    dict => orddict

commit 99a23a6ab47505b08cbd7e72aab5d6624c68e81f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 16:57:06 2011 +0100

    +documentation, minor renaming, clarity

commit 39fd0c69972d53f0ca3fb07a56e95e2d1f8a573f
Merge: ff8a4b4b9 e9e50efae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 26 16:53:25 2011 +0100

    merge bug24296 into default

commit ff8a4b4b9f5594cdf1172b9b9b83e23cd21df0d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 26 16:53:03 2011 +0100

    cosmetic

commit e9e50efaea3eb2cbe27a37f09e31c35aad2d7834
Merge: 3dbd550f1 57076e959
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 16:23:00 2011 +0100

    Merging bug23464 to default

commit d3827b1101fddff9872bc2172821ca366d869f80
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 16:17:38 2011 +0100

    cosmetic
    
    Not sure how the misaligned -> happened..

commit 3dbd550f1e03687b8f8c45f9bd2640bdc924fd03
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 26 15:56:48 2011 +0100

    Convert O(N*M) to O(M*log_2(N))

commit 47a4e13ecb16624b99e5d1cea71252e11f99115d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 15:54:45 2011 +0100

    combine function heads

commit 9a448a5e8821c3d5c2a5ace4e0c9ef73d969c5c0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 15:45:13 2011 +0100

    cosmetic

commit 5d8c0b95e620dcd90c743767e2c16866a1ece3d8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 15:36:42 2011 +0100

    cosmetic

commit 7fe53bc472e3fdefeb009b1d3093e2c6ed5e2a2a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 14:40:15 2011 +0100

    don't needlessly notify queues

commit 55c3848942bfe29b1a1e24e1dab5487685d8aaea
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 14:19:36 2011 +0100

    unbreak amqqueue_process/limiter logic

commit 38552e670eeeb309616dff309f845d8cf23d0bfe
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 26 14:09:33 2011 +0100

    More consistent use of macro

commit 7b1a3833deca325b94a958bd647a391e371fb949
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 13:44:11 2011 +0100

    remove useless cases

commit d26943f19078df679ee46e8e8a5f0bea6a735d00
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 13:21:18 2011 +0100

    finish refactoring

commit 00cbb515af59166a8754a74ea6d704c961d54cc0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 13:13:53 2011 +0100

    refactor
    
    Most of the changes in channel are due to it being called LimiterPid.
    So, we're going to call it Limiter now.

commit b244d5dde897a2e8aa64c8b6c8a9eae1fa2761f6
Merge: ea32ca631 ef7edce7e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 12:21:56 2011 +0100

    merge heads

commit ef7edce7eeb9865e75ed098cf38543bdbabc0025
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 12:20:25 2011 +0100

    oops

commit ea32ca63193acc2a8b8cbd305cc0a91e4bf472e2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 26 12:03:35 2011 +0100

    Cosmetic

commit 71387e2359b126dc946551253cc6fab62290c8e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 26 12:00:51 2011 +0100

    Cosmetic

commit 138bcfe4091fef439aa6971506e519a410b35b40
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 26 11:39:16 2011 +0100

    cosmetic and refactoring

commit 15b57877d8c28403da9d9fcdc467b1a868f6c759
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 25 16:07:24 2011 +0100

    improve comments

commit 0194be9943c5be1f61ed70f07abadfd4dd0f1bb1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 25 15:55:22 2011 +0100

    fix tests
    
    Even if they're not used, the limiter functions need a valid token.

commit 4063dc906fee9683fd1fcb614acff9d4a3ace7b3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 25 15:22:23 2011 +0100

    refactor

commit 35ff81f33f6946e9cdf05a226c5ff32bcc9db9f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 25 15:13:55 2011 +0100

    refactor

commit 787055f4b8a903fa0444cf142560b2ad07a9124b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 25 15:01:16 2011 +0100

    start limiter before channel
    
    Also use an opaque type, a token, to invoke limiter functions.

commit 2e532d1df13d835d3b9c48ded4dec8d87ca8ef42
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 25 11:38:18 2011 +0100

    Remove some dead TODOs from when this was very young.

commit 8aab89ccc78ef61e5833ed058f335b9a51a819d1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 25 11:27:42 2011 +0100

    Face down, nine-edge first.

commit d1c7a8697c8d59f56bff84d4ae6302d0ba893691
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 25 11:20:23 2011 +0100

    ...and unbreak.

commit 118b59e2b3d2ef3ddefe60a3ef5514a7a8de7420
Merge: ac62154a5 57076e959
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 22 17:51:52 2011 +0100

    Merge in default.

commit 6c67ac02d6e980d1da0ac23d4a0f59f6c0a98608
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jul 22 17:46:23 2011 +0100

    Convert dict to orddict

commit a9734f49465e034033b862175009c9a4c689d8ff
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 22 16:18:58 2011 +0100

    use mnesia:system_config(use_dir)

commit 5646d8c3868a4caed4d1f73f1df413f7e4b67d2c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 22 13:37:20 2011 +0100

    more spacing

commit 1fd63a816d59b3087b3ef3d9f4a125bc6aac6762
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 22 13:33:58 2011 +0100

    rename IsDiskNode, WasDiskNode
    
    My general rule for spelling these things was: if it's followed by
    node, it should be disc; otherwise, it should be disk.  So,
    is_disc_node vs OnDisk.  I managed to miss those two, though.

commit 02ccd319c6db2bd9012c8a727d195eb237d541d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 22 13:28:04 2011 +0100

    un-misname waiting_for

commit 378e24e39a14f3354e7356df73f5e2961b426076
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 22 11:05:22 2011 +0100

    Sp

commit 3ea2233ba38bd0e30535bdbba133642097bcdc95
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 21 18:17:42 2011 +0100

    factoring

commit b1929763fbcec8108ce02ef372806176c09b03ca
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 21 18:08:49 2011 +0100

    Support optionally formatting the priority queue mailbox, and do so on the queue.

commit cfb870ce994437b418830abe73bc8c915fca3a39
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 18:07:19 2011 +0100

    cosmetic

commit 6bee955077828d9d846477af534da48ca27e3e5a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 18:00:04 2011 +0100

    handle starting/stopping returns from mnesia

commit 9e96bac6af9d5981fe3ca425fe25579036e65850
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 17:54:08 2011 +0100

    remove starting/stopping improvements
    
    Moving to another branch... but I need the diff.

commit a5fe1e4a8adf57b38b65afb287d46705d849465a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 17:51:01 2011 +0100

    don't use echo -e
    
    I don't want to risk breaking something with that right now.  I'll
    test and file another bug if it's safe.

commit 143e12d4016bfc3d4ce907a9b8443772cc8e13f9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 17:47:22 2011 +0100

    remove the disc schema for stand-alone ram nodes

commit 8adeb90f58cc0dcab485a12a4eaff3a724d26566
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 17:19:01 2011 +0100

    bring branch closer to default

commit bfeb65b179cc54be63b23f80bcc248b5c48cf87f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 17:10:58 2011 +0100

    don't wipe message store and lengthier comment

commit 662da45f24c13d0f438d94f7ca7c544e88067f72
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 16:48:17 2011 +0100

    remove impossible case

commit e4e2f20a6534d8148808a925592fff948b7368b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 21 15:13:18 2011 +0100

    Dialyser points out I was returning the wrong thing here. Oops.

commit f530357e3d5bac447811986ad8fd68bef1822c60
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 21 15:12:55 2011 +0100

    Bad OTP! No quotes!

commit 243024cd490e633f480d23987cb31506dbfaba3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 21 15:04:58 2011 +0100

    Remove demonitor_all_peers since we always stop after invoking it.

commit 2121c6236055e280fe82020981a7b62d8d4a135d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 14:16:18 2011 +0100

    remove redundant code

commit 3b241c64ee6c3996c4285b799164cb79bd3e6ca9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 13:54:03 2011 +0100

    oops

commit 699d1be4f154b222bbc0fad2ce33e6c57e698046
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 21 13:20:07 2011 +0100

    refactor and re-sync ram nodes
    
    A bit of trouble performing local upgrades on ram nodes: the upgrade
    process takes down Mnesia, which causes it to lose its schema and its
    recorded table info, which causes the ensuing schema check to fail.
    Solution: after doing the secondary upgrades, re-cluster ram nodes and
    wait for them to sync up, again.

commit b60edf56efcd481f6876427fe6410a0bef727d4a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 18:06:02 2011 +0100

    refactor

commit 3fb8ecc4b6f93884d6b2c396d2984887048f3c37
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 17:46:05 2011 +0100

    handle the starting/stopping returns from mnesia

commit c6ee10a6a36738ecddfaeb1ffc5456bc47102ce0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 16:53:17 2011 +0100

    always reset and preemptively leave clusters
    
    Always backup and reset during clustering if the node type has
    changed.  Worst case, it ensures that we actually have an empty mnesia
    dir with new ram nodes.
    
    Also, preemptively leave a cluster before joining it.  Suppose we had
    a two-node cluster, the first node goes down, the second hard resets,
    the first node comes back up, the second node tries to rejoin the
    cluster with a different type.  Since it hard-reset, it doesn't know
    that it used to be part of the cluster, and the other node is unaware
    that our node is supposed to have left the cluster.  So, when
    clustering, we always try to leave a cluster before joining it.
    
    In leave_cluster/2, I added {aborted, {node_not_running, _}} to the
    "not error" returns, because it looks similar to {badrpc, nodedown},
    which was already there.  This may be wrong.

commit 3b459ce77a4be55e205ec1cf0eb827a2e5657bf1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 20 16:15:20 2011 +0100

    It *is* a process. It *has* a pid.

commit 0f6530bfa5449e53c1d99a0013e4e6b46c886847
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 20 16:04:59 2011 +0100

    (Untested) attempt at updating OCF script.

commit 745e558a543ed3fb2b5dcc15babfc404cf386df7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 15:28:01 2011 +0100

    reset before changing node type
    
    Matthias points out that the only way for mnesia:change_config to
    start creating tables is for the node to re-join the cluster (and get
    its old table definitions from other nodes).  Instead of fixing the
    tables after that, we now reset inside the cluster command.  Note that
    in very old rabbit versions, we'd just prevent this by having the user
    reset manually.

commit 77f12b1bb344392f84649b640666c6683ae05c52
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 20 14:06:36 2011 +0100

    Flip flop again: revert b69bd74d8e17 and add the old master pid to the promoted message - we want to identify queues by pids in mgmt.

commit 3640a79148a2bcbf07d67a2ee4cfab013901e7c0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 12:53:49 2011 +0100

    remove two resets introduced earlier
    
    We don't need them anymore.
    
    BTW, when generating the backup db directory name, we used to just
    append the date (including minutes, seconds) to the current directory
    name.  But since we do an extra move_db/0 now (when converting from
    disc to ram), some of the tests were fast enough to try to backup the
    database twice in the same second.  Needless to say, this would cause
    an error.  So, now we generate the new name as before, but if it's
    already used, we wait 1s and try again.

commit 058a11aa6b319152347fcddc2806947034770942
Merge: 86569edf5 57076e959
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 12:46:10 2011 +0100

    merge default into bug24227

commit 86569edf5653a90cbc1b1a8612544fd37551d1a8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 12:42:37 2011 +0100

    test that disc nodes are actually disc nodes
    
    The tests used to be slightly wrong.  They'd expect:
      rabbitmqctl cluster
    to create a cluster with a single ram node.  It didn't, instead, it
    created a cluster with a single disc node.  Since we weren't actually
    checking the resulting node type, everything went along fine.
    
    Assert_tables_copy_type is complicated by all the cases it has to
    handle, namely converting disc -> ram and ram -> disc.  For disc ->
    ram, we first need to convert all the tables to ram, then, we need to
    convert the schema (converting it before fails with "Disc resident
    tables").  For ram -> disc, we first need to convert the schema,
    otherwise, all the table conversions will fail with 'has_no_disc'.
    
    Regarding an earlier commit, using mensia:system_info(use_dir) to
    check if we have a disc node is wrong because we create the directory
    for the message_store anyway.

commit 381213af0b7b3cc3a3d898fdf77cfacf19574875
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 11:17:40 2011 +0100

    check that a ram node is indeed a ram node

commit 10c46203e5ae4cfb4cb1a36f2a73a54573a3870c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 20 11:07:51 2011 +0100

    enable disc-less nodes
    
    The main trouble with this is
    mnesia:change_config(extra_db_nodes,...).  If the current node doesn't
    have a schema with all the tables created, it will get it from one of
    the nodes it connects to.  This is a problem if we're a disc node and
    they're a ram node or vice versa.  So, after we get the tables from
    the other node and wait_for_remote_tables, we assert that their
    storage location is correct and change it if not.  If the other node
    is disc and we are ram, this unfortunately means that the tables are
    first written to disc and then converted to ram, but since this is a
    one-off operation during startup, it shouldn't be a problem.

commit 029750c33d69321061cd16f780fa5027b6aa6868
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 19 14:56:20 2011 +0100

    comment

commit ac16ca27a90f3c5877d3028e1a52c0874b7bb75f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 19 14:55:13 2011 +0100

    really add schema-less nodes
    
    I've disabled disc-to-ram conversions, for now.
    
    Mnesia:change_table_copy_type(schema, node(), ram_copies) half-fails
    silently if mnesia isn't running.  It removes the stuff in the db dir,
    but it gets recreated on the next mnesia:start/0.

commit 70b00a61eef3dcd844f1b1534cabce67018d3612
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 19 12:57:28 2011 +0100

    Uh, it's probably an idea to write out the pidfile as early as possible, in case for example prelaunch fails.

commit 57076e95920128cbd425e3e252cd4948aa6c0dd4
Merge: aca4e9c45 32d89eaea
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jul 19 11:05:11 2011 +0100

    Merge bug24273 into default

commit 1888720f4890ef06057099642cae84273d0d2c81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 19 10:51:36 2011 +0100

    Actually, for the bookkeeping mgmt wants, this is better.

commit aa339008221e32a7281b305bc06801d614cfa148
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 19 09:47:06 2011 +0100

    Cosmetic

commit 32d89eaeaa509b1a9989050b5cd07ffead0e6da8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 19 09:34:19 2011 +0100

    catch another two reasons

commit aca4e9c457701fc1777b8a624d8817233b8531c8
Merge: ac52ab814 4cdfecb32
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 18:39:13 2011 +0100

    Merge bug24262.

commit 16c509d4b0c94f6730e10ac7450f9c4f738d02f5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jul 18 18:36:00 2011 +0100

    Speed improvements

commit 4cdfecb32687897fb8330a1aa1003c7434009785
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 18:34:53 2011 +0100

    Bigger comment.

commit 8427ac34feaaeb7db3560fd274fe0d1d02e5fe78
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 18 17:51:09 2011 +0100

    more the restart_app to a more appropriate place

commit 1e54be5ef57b5880afbc12b298b2a8d930cca07f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 16:57:31 2011 +0100

    Simplify group shutdown by repeated casting.

commit e5c5f6dd3ec7f2dc6acc374a76cf702e4667d676
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 16:46:04 2011 +0100

    It might not be 'killed'. And we should return an error here.

commit 2bd44a15bab74e2167820a676e71943826cb1530
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 16:32:21 2011 +0100

    I spent a long time trying to get the teardown of the complete supervision hierarchy associated with each test to be completely synchronous and failing. It's much easier to create a new group for each test.

commit 5ee0a57f7bfd74cb86eb9e19dfeb3732533254ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 16:24:44 2011 +0100

    already_started

commit e8f859942c65517e9708ea34ec84c927f03a126c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 18 16:04:13 2011 +0100

    there are many ways for a queue to die nicely

commit 8b6acb113c5a50a1f5a2deab59db816d6568eeff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 15:07:18 2011 +0100

    Handle being torn down while in the transaction.

commit ba884ae7dae2422d86b4cc542f2d31190d922a3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 14:52:51 2011 +0100

    Not even sure what that was there for. Oops.

commit e1c1025bbece07e567d0b6c717edc82ae2432741
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 14:52:37 2011 +0100

    Remove a sleep() by waiting for the supervisor and any children we care about to go away.

commit af50eeeea4b6b023634bd6c797488dc9edfd65a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 14:51:49 2011 +0100

    Catch more exit reasons (with a fork of rabbit_misc:with_exit_handler/2).

commit dfb201f4c058db6736992d7299ce3154257143d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 14:50:44 2011 +0100

    If start_child is called twice in a row we used to hang. Um, that's not good. Fix.

commit 9b8e28e5a2f2650830d9c703e5d649ec69cb4128
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 18 14:49:28 2011 +0100

    Defer all of the startup work to the second stage startup, so that we can't get a DOWN message while we're still half started and then fall over.

commit 0b55e974a1889a2fc0e39d3442a5e6030976049f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 18 14:09:24 2011 +0100

    appending to a list is slow. And we don't seem to care about this list being ordered

commit d4a7b574c7b4e05a3a913be722f6b715aecf3479
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 18 14:08:35 2011 +0100

    cover the missing case

commit b75241fcd24673243ffe413f9df95899c2e2ecfb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 18 11:16:13 2011 +0100

    the argument is sometimes 'disc_copies' and not 'disc'

commit 5cdc3daadb11630dbe8a3c8027435ce158d51520
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 15 18:03:46 2011 +0100

    Stronger constraints and some notes on frequency

commit e5532548824ac2aa3231ce974352e2c2a82dc811
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 15 17:29:51 2011 +0100

    increase a timeout

commit ac52ab814f787ba752cb16269092b9af38a7d904
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jul 15 17:27:27 2011 +0100

    Correct boilerplate for the HA modules which were started in 2010 but failed to get updated to 2011.

commit 2d94fd58e6340169da198fa95e07186d490b2a57
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 15 16:42:57 2011 +0100

    remove io:format

commit 3ea08a9ad561e88b3d1996835226db8a1619e61e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 15 16:40:36 2011 +0100

    cleanup queue and restart app

commit 64aacf077f8f18a3c821b70ff03b31c8e77b31cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 14:39:12 2011 +0100

    Add master_pid to queue_slave_synchronised event; this will reduce the amount of bookkeeping mgmt needs to do and is pretty trivial.

commit b76fee70ddda812ea70e6c885ef50cd7b60ba30c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 15 14:12:00 2011 +0100

    re-add schema-less nodes

commit 3a2f261753bfd7f061d1ccde3184def04a5184b3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:58:37 2011 +0100

    This was copied from R14B03 supervisor.erl, but there it was exported. I don't think we want to export any types from here, people can get them from supervisor.

commit 0277e787ec5559d8c0f2be6aea1e91f4cd3fc7a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:55:38 2011 +0100

    More descriptive names, don't clash with erlang:monitor/2.

commit 16e2bf9e3494fd39e73a31919a359d058b44e023
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:24:42 2011 +0100

    The problem with kill -0 is that its semantics are "could I send a signal to this process?" - i.e. it will fail if the process exists but is not owned by the current user. I think this is not quite what we're looking for, so let's use ps -p. I've tested that ps -p does the right thing on Linux and OS X, and it claims to work on FreeBSD and AIX too according to the manpages on the web. That's probably good enough.

commit 3c9ea59548401c22c0c5707d1bf5bc4c20b93964
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:09:09 2011 +0100

    Do these checks the other way round - if the pid is not running we should fail, even if the node is up. I think.

commit 3b532afbaf3f05314d3171865b66a3b1395792a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:02:54 2011 +0100

    Be more clear when pidfile read fails.

commit 8dd65664e9401ba5c2f05fe44abb980f13d459e2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 15 11:00:12 2011 +0100

    Show when we've acquired the pid. This would be useful for diagnostics.

commit 715a7ed538da2d1a60c43693e1bab12de3e59055
Merge: e039aa57f 1415c54ab
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 14 16:33:50 2011 +0100

    Merging default to bug24230

commit e545c6a694d53d7175c47e98c8884ca87356beba
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 14 14:36:16 2011 +0100

    Refactor to mimic style and pizzazz of amqqueue_process

commit 21ff1e85d2a49ae8ab2fb899954fe6340658bc33
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 14 13:30:30 2011 +0100

    rework

commit 1415c54ab973255fd547cbccfb805cb75ddab6a7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 14 13:29:29 2011 +0100

    fix bug introduced by bug 24216 (tx untangling)
    forgot to propagate an API change

commit e039aa57fca1722680dc7334fc153b126b866d27
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 14 13:04:04 2011 +0100

    Make this more explicit. I *think* it's TRTTD.

commit 6df92bb9eb2cf33771942f6a2d48ef24b480e9b8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 14 12:58:10 2011 +0100

    Remove dead monitors. Make sure everyone has unmonitored everyone else before we start to shut down.

commit e510d63ec69c72168d1788f330b9d7dbb1590517
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 14 12:51:50 2011 +0100

    cosmetic

commit e3c9470ef13e0a82bd6853461aa86d8e42c34a6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 14 12:35:34 2011 +0100

    Shut down the whole supervisor group if the delegate shuts down due to its children having surpassed their restart limits.

commit 07485be0b7890d6645239d2cd1fc8794e9232390
Merge: 0b2bc19e9 13142c3eb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 14 11:48:37 2011 +0100

    Merging default to bug24130

commit 65542a0ea048cdb4d99532ded6a6ddbb2dca02b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 14 11:16:34 2011 +0100

    We should probably prefix this.

commit 34380876b11b57b47920c2c445211599c9b1ecdc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 13 18:02:41 2011 +0100

    rabbitmqctl wait $PID_FILE.
    
    NB: pid_up/1, with_os/1, system/1 and escape_queues/1 are salvaged from rabbitmq-multi. pid_up/1 used to be is_dead/1 but the new polarity makes more sense.

commit 9fc4cc10e1ca11a5f977eea9cc32b09e6506380c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 13 17:30:42 2011 +0100

    PID_FILE

commit 1639445b0cb3a53944261b0dd0bf9d71b0ac1106
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 11 16:31:48 2011 +0100

    Fix race. Use cast. No "hello".

commit ce75f3bc26eb0d52f1a83431bbc5c71cae51cd08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 11 16:27:24 2011 +0100

    We like a lot of things about OTP. But not tabs.

commit 1b17e3b4fa989e2a058dff8ac1a9a67f64ebf397
Merge: c08f792cf 13142c3eb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jul 11 16:19:47 2011 +0100

    Merged default into bug23464

commit 13142c3eb0e1c8ccdcb0933d8aa93ae2fe395f86
Merge: 42bfd7a31 82c7e7c07
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Jul 8 16:01:17 2011 +0100

    Merge bug24216 into default

commit 82c7e7c0744055f4fbc80666dbb70009532df52d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 8 12:35:58 2011 +0100

    cosmetic

commit e89adca2a5c4edf9127c50437b519661ad26633c
Merge: a652185b1 61c87b432
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 7 13:47:12 2011 +0100

    merge bug24244 into default

commit 61c87b43239d18ae7d94da966e851495236c6b30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 7 13:28:32 2011 +0100

    inlining

commit a652185b1606b749d89464beb00f7d987725c89e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 7 12:02:51 2011 +0100

    Note to future self / others

commit 0b2bc19e987644d69c49398c722fb896cb335cd8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 7 12:01:46 2011 +0100

    Support querying slaves for their status

commit e008fe55ec2090536c2ccc8952e834ae3e5cfe88
Merge: c8d480351 97df2b9ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 7 12:00:58 2011 +0100

    Merge heads

commit c8d480351b9db984a86fc6cd6be8dea3e5c5846e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 7 11:58:20 2011 +0100

    Fix upgrades from 2.4.1 and before. This failed because the #exchange{} record now contains the exchange scratch space, but at the point at which we add trace exchanges Mnesia hasn't got there yet. The moral of this story is: never use record definitions in rabbit_upgrade_functions (which is why all the transform() invocations don't).

commit 97df2b9ac28af18968ce2aac2c825e49f95f8fab
Merge: 77853d6d0 eb14007e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 7 11:45:33 2011 +0100

    merge bug24179 into default

commit 7329e6b266cd9f1a5b86cb7d049a04becb365dcc
Merge: eb14007e1 ae64998b7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 7 10:34:59 2011 +0100

    Merging default into bug24130

commit 42bfd7a31ad6340083d12353ec384e974007bfa3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 6 17:40:37 2011 +0100

    ditch per-x-q confirm stats
    They don't work properly (see comment in code) and are emitted in a
    very awkward place. And they expose implementation detail - there is
    no a priori reason why queues should be involved in confirms - and are
    of questionable utility.

commit 57263a7f999fe813de18405200e3d040bcc8429d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 6 17:36:22 2011 +0100

    make 'tx.commit-ok' indicate responsibility transfer
    This is now very close to the previous tx semantics.
    The downsides w.r.t. the previous state of this branch are
    - a bit more code, though only in the channel
    - tx and confirm mode no longer compose
    - tx always carries the cost of confirms
    
    Implementation notes:
    - The channel must remain active while a commit waits for confirms
      from queues to trickle in. We achieve this by recording the fact
      that we have a pending commit.
    - The trigger for sending the commit-ok is that the number of pending
      confirms drops to zero and we have a pending commit.
    - We check for that condition in three places:
      a) at the point of commit (in case the tx contains no publishes or
         all confirmations happen as part of delivering the messages to
         queues)
      b) where we would normally send basic.acks
      c) where we would normally send basic.nacks
    - we are re-using the same logic/state as for 'proper' confirms,
      except we suppress the sending of acks/nacks
    - handling the failure case is slightly awkward. We record a tx as
      'failed' as soon as we encounter the 'nack' case. Subsequently, when
      the aforementioned triggering condition is met instead of sending a
      tx.commit-ok we send a precondition_failed error. But we can't just
      employ rabbit_misc:protocol_error here since that only works in the
      context of handling an AMQP method, which is only the case for
      (a). So instead we drop to a slightly lower API level and rely on
      the fact precondition_failed is a channel-level, rather than
      connection-level error.

commit 2c82d25fa6ed321ec1a3859f227034ae9e861499
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 6 16:00:48 2011 +0100

    One last tweak.

commit 91b651a2c2120efd91816aaee16a1ba2b84e72e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 6 15:46:21 2011 +0100

    Refactor / beautification.

commit c08f792cf7180069ce0085f11c3c1b9a73eb9ec5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 6 14:41:47 2011 +0100

    Minor refactor

commit 2e9d93e50947ac2b430fb98ff86ba66682997949
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 6 11:31:15 2011 +0100

    Dialyser points out that start_link may return other than {ok, Pid}.

commit dbf3594e3d34e3b35404061b68ce2cca5e1cbe5f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 6 11:25:07 2011 +0100

    Dialyser points out that pid_of/1 was returning the wrong thing, hence some tests were passing incorrectly. Fix dubious test.

commit abe71e312544dd6af2b3b5d99a4d6453f10e46ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 6 11:13:00 2011 +0100

    First pass at specs. Note that these are formatted a bit differnt from how we normally do things, since most of them are OTP copypasta it makes sense to do the rest in the same style.

commit 7f77f0ba28e532d0a7e1f30e957c522cd76a1ac8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 5 18:30:53 2011 +0100

    Inline rabbit_misc:table_filter, then fiddle with it until it's actually right. To say this could do with some beautification is an understatement.

commit e4861e6e2ffb21ea1ec44041fa1eea8044d78dae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 5 17:56:57 2011 +0100

    Added timeout testing

commit 1a02c8a709af5bb56359702cb29d04c35b24cbc8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jul 5 15:52:33 2011 +0100

    Improve code coverage

commit cf7be59ceab4e6bcc617a274c44011183a67073a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 5 08:53:42 2011 +0100

    confirm on tx.rollback

commit 440406d4d0084493e918137306a1fe119f0caa79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 17:22:42 2011 +0100

    If we're intending to allow gen_server2 and supervisor2 to be defined out, let's do the same for pg2_fixed.

commit 1b085d1f03e672f538da7a60a4b0ba9494498372
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 17:15:02 2011 +0100

    Essay.

commit 7dafe0b207860eb80b2a6a533ac78554e23392aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 17:14:52 2011 +0100

    Duh. That notify thing is no longer needed, simplify.

commit 19b5f21525b1994fcb900caa1f0750ed1ac7cf78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 16:42:00 2011 +0100

    Support unnamed supervisors. This tweaks the startup somewhat again.

commit 9db1caee2f802ecffa3d75baef984cd2d293a209
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 14:43:29 2011 +0100

    Support childspecs returned from Module:init(). Unfortunately a bit fiddly as we need to cast a message to ourselves (since we can't start children until the overall supervisor is up) but then we need to cast another one back so as to still start up synchronously.

commit affb0a5024c8156961bc16b53f483b7a4a4a522d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 13:33:54 2011 +0100

    Add another test

commit a7badca0c6819fc255eb44474535ebcdc29d5003
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 4 13:23:30 2011 +0100

    Use two supervisors (an overall one and the delegate underneath it) so that our behaviour is not affected by the users's choice of restart strategy.

commit cff7dc28e6dd35a3eb592b0a7f7d112345e96f37
Merge: eb14007e1 37f637171
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 4 10:48:00 2011 +0100

    merge default into bug24216

commit 37f6371719da169ac1a53d582e87fbf911251c3a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 4 10:38:30 2011 +0100

    change tx semantics to 'batching'
    We keep track of uncommitted messages and acks in the channel. All
    routing decisions are made instantly, which means errors are detected
    straight away.
    We increment pub/ack stats on commit only.

commit eb14007e10d7e847aa6916fbb8c12f27c255d0ca
Merge: ca3992bbc f3de6d209
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Jul 3 23:10:48 2011 +0100

    merge bug24232 into default (don't show mode in 'rabbitmqctl list_channels')

commit f3de6d209ebd817f925b3f41103f587e7502c2e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jul 2 10:54:23 2011 +0100

    cosmetic: more sensible order of qpids for routing

commit ca3992bbc1d847dba45f5d7101b4a90181efabd0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 1 18:42:01 2011 +0100

    remove 'transactional' flag from 'rabbitmqctl list_channel'

commit 5a2e7eb43740de2d0e30efda7f263a137493e818
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 1 18:40:22 2011 +0100

    cosmetic: move docs of confirm-related channel info items to better place

commit 9119004e6a136db4bddca9251c622436f3d87e64
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 17:24:41 2011 +0100

    Bang head against desk.

commit b9e7ee35d553915c285c326bf5341a0962b441fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 17:23:51 2011 +0100

    Fix an occasional race.

commit 55b22bd799861a910a468a64ce561a4471cebdf8
Merge: d99cc9d66 10ec1a091
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 1 17:01:32 2011 +0100

    merge bug23825 into default

commit 016c3b6f69b746444b539049a97b77c117fdfd62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:58:50 2011 +0100

    Let's pretend that didn't happen.

commit ca14bae2d3f66b38058cf42c4101fc3c00c571fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:58:24 2011 +0100

    Improve reliability, test deleting and restarting children.

commit 10ec1a0915e121be01c7ab380b6d106cee92858f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 1 16:46:18 2011 +0100

    cosmetic: we tend to prefer 'any()' over 'term()'

commit c40fe2d2e8e391430c9f3dae400afe8fe2ebad77
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:38:07 2011 +0100

    Be less chatty.

commit f7d1e25c659c7a9e13b81ac113a2e8dce0be4908
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:37:00 2011 +0100

    When starting a child that is already around on a different supervisor, do nothing. And test for that.

commit fea445fc8626bc36f7374d00b37a9b6ae9ecd955
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:24:42 2011 +0100

    We only have mnesia now.

commit ef88e7ccaf6d3c43730b3e184e92f406b292f61f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 16:15:33 2011 +0100

    Trying to keep that ETS table up to date was never going to work, live without it. Also fix alive(). And another test.

commit 70cb2766d7d54a1ba94bedb936497efce954de68
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 1 16:08:19 2011 +0100

    Better code coverage

commit a3bc8bb58a800ce07dbaf30f496fbba389be9c9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 15:49:18 2011 +0100

    Uh, fix the test.

commit 4eaef2057ef74de4252dea6663c9ea48de4708db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 14:33:29 2011 +0100

    Beginning of tests, and fix a bug found (ETS table creation on demand is racy).

commit 63f47c549062efef2f24aad2ff6e32b06d97fd86
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 14:32:41 2011 +0100

    Cosmetic

commit 9d03b45aa466136cb9ffe9beb39bbd47b11f6240
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 12:56:12 2011 +0100

    Separate out supervisor name and group name.

commit e8387f915f2305400d6c0c92325da609b83c5450
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 12:35:55 2011 +0100

    More cosmetic.

commit 51d27e2e6dcf4dabcf45b3ac9892f48c3d029a56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 1 12:30:11 2011 +0100

    Cosmetic

commit 0790ba94929adf0f9aa9fcf278c2217b1c7f7437
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 30 17:57:27 2011 +0100

    Note

commit d82810b06bc9b9640201a240704b4e862c78dda7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 30 17:46:01 2011 +0100

    Crude but working implementation

commit ffe20ebb2111120106b2d97deb8589f22165ea44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 30 15:17:10 2011 +0100

    Something that impersonates a supervisor and delegates to it.

commit 53c99e56c0136881d8f9ffd409376e1314e2676d
Merge: d99cc9d66 7836ce2d6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 29 18:40:32 2011 +0100

    merge default into bug24216

commit 829e53913db9e443f77ec1faaee90a4ab4e2a64d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 29 12:08:49 2011 +0100

    - use rabbit_misc:execute_mnesia_transaction
    - call the function update_scratch and only update the scratch space
    - call Fun(X) once
    - make 'read' into a 'wread'

commit 4ca66ea0b2b3fcbe3946945b3f862167ab0a8bdf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 29 11:35:49 2011 +0100

    Spec

commit d99cc9d66036bc9568a5a28e5ae9d377dc21af48
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 29 10:20:43 2011 +0100

    cosmetic: give rabbit.erl some structure

commit 82d316afe123376bd90937dce37155ceb8f6098f
Merge: a699c342f f1a7fc4cf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 29 09:32:29 2011 +0100

    merge bug24207 into default (Rabbit doesn't stop and halt correctly)

commit a699c342fb44010106054f915ee460bcdb3ee282
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 16:57:23 2011 +0100

    factorisation

commit d9d593aecb6050b9ff44b98756e996f723de0b7b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 16:37:26 2011 +0100

    There's a possibility that rabbit has to be able to be started without being booted. Thus we need to be able to load the transitive closure of rabbit's dependencies on demand. This is especially needed for the tests.

commit b37c3093f458c3ce37c682ac6c65e4c20329b9a2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 16:01:47 2011 +0100

    Avoid pointless begin-end block. Duh.

commit 02940648492d2d4539737f234774bb407402d4f9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 15:57:24 2011 +0100

    All keys are optional. We must not omit a vertex just because it has not any dependencies

commit 390c5ebf7340992085ebdc12289eb696c9a52af8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 15:42:24 2011 +0100

    cosmetic

commit f5532d9d6f264f2247e72e9f821a37f2fa20133b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 15:41:23 2011 +0100

    Finally, just to be really safe, avoid init:stop as far as we sensibly can on stop_and_halt as we know that does the wrong thing should applications have been manually stopped and restarted

commit 72d8ef41731c27518bab52eea4aad13bfa02983b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 15:36:22 2011 +0100

    Delete graph after use

commit 1e9d29e6cae34a6aa1e8e8fb023895d6912d5638
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 15:32:31 2011 +0100

    Build graph; prune graph; traverse graph; obey graph.

commit f131ad2fea33d5d2b7de676167c5cfa981f93910
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 28 14:03:45 2011 +0100

    Complicate Makefile processing

commit e8a538f31abf2eaba95df6d5c9811e7869d8b38b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 28 14:00:29 2011 +0100

    Add conditional compilation and makefile infrastructure

commit 49caec2dcc9235696715bfd0d2a6a6c7b9961729
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 28 13:34:01 2011 +0100

    init:stop knows better than us. It makes sure applications are taken down in the right order (which we were not doing).

commit f1a7fc4cfcf0e566a1cf3f76ca3e73e242d43d6d
Merge: ecf2ee325 3e8acf0f3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 28 07:07:52 2011 +0100

    merge bug24180 into default

commit 77853d6d082806a1f37081b243dfbae2f719e473
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 27 18:21:06 2011 +0100

    tiny refactor: better function names

commit ab53bfb04b08bffafe243ed4dbfcf4a42c32fbd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 17:32:57 2011 +0100

    Scratch space for exchanges, and rabbit_exchange:update/2.

commit 3e8acf0f3868f3afcd7a6121866fc0cd0f7a8cde
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 16:54:16 2011 +0100

    Remove tonyg and md5 checksums, since the Macports guys already have done and we don't want to reinstate them.

commit bffc69e2d6adeddf85bbb8e9e161539a73f9ac1d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 16:02:02 2011 +0100

    Changelogs for 2.5.1 release.

commit 3b5b393f060f3758e5c7802767b20fb6f46e0d9c
Merge: ce9ffa11b 8cbced41a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 27 14:52:21 2011 +0100

    merge bug 24221 into default (channel.flow{active=true} can fail to unblock queues)

commit 45fcc2b8769e6bbc34dfcc33b1b8408f1961b0b6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 27 11:44:33 2011 +0100

    Add further backing queue methods

commit daecef07a7cf228fefc4c6f917fcb56cc3310ab6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 11:11:37 2011 +0100

    Added tag rabbitmq_v2_5_1 for changeset 5b687b250804

commit 5dedb11d3c8ef1d376d85593d3145c2e2c82cbc7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 11:10:16 2011 +0100

    Backport 1df8606372dd (add dependency from internal exchanges to trace exchange - bug 24208).

commit 2a9d5eaf609c2e0c978c7a9ed07399eb9b20c0b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 27 11:00:14 2011 +0100

    Create 2.5 branch

commit ce9ffa11b95435227c8e7b8d18c41a5c3189ac52
Merge: c47456965 e0738531b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 27 09:10:58 2011 +0100

    Merged bug24208 into default

commit ae64998b77dba916d1a61c1dc1f853fe0a8fd673
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 23:33:20 2011 +0100

    docs

commit 479792104a66677c5fe4ae65b8b9cc53c1ed2b18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 20:49:17 2011 +0100

    Notify the world when we become synchronised

commit 4d71d306cfaf231f5a4714ed8df4f499579bcff9
Merge: 4ac9b6dc7 c47456965
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 20:42:42 2011 +0100

    Merge default into bug24130. Also add appropriate specs, and fix some bugs

commit c47456965113ffb95a361cff09f25cf89b8b054f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 20:23:39 2011 +0100

    Add missing specs; move some functions to more appropriate places

commit 4ac9b6dc77de8d64bf7f0142693d882d7f654b75
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 18:53:15 2011 +0100

    Master responds to length_requests with length broadcast; slaves can determine their synchronised state correctly.

commit ce16080dd9a3f0a7082240f08c7d76a86939391b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 26 18:28:43 2011 +0100

    essentially cosmetic tweak
    the result of terminate_and_shutdown is not needed, but it looks odd
    to throw away State1 in one branch.

commit 7836ce2d6045dcafa82df2dc05bd07a8bd68b665
Merge: 993823e6d 9de9da84e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 26 18:21:18 2011 +0100

    merge default into bug24216

commit 469397027252324ba4e5f02068a12a2c859a4b08
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 18:17:00 2011 +0100

    Slaves request length when they join.

commit 9ef691695d49e5217db86daa08f50a1ec0a7e39a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 18:10:03 2011 +0100

    Emit slave promotion

commit eb895b67603a2c0d638fea808477d8901a0aff7c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 18:07:52 2011 +0100

    Emit slave creation

commit 993823e6dc482b414725067124c5202fc10e1cf2
Merge: ae69fbc89 dd38990bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 26 18:04:47 2011 +0100

    merge bug24217 into default

commit ae69fbc8976a0d560714e6cca1dae06dab5ccca1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 17:57:57 2011 +0100

    simplify

commit f867a350fb827c2f228b783abc32629428f835b3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 17:50:58 2011 +0100

    Ensure we hit both branches of the newly added case queue:is_empty(Q4) of

commit 7cd1be4dd393e8cbced33f9287396a6813579ede
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 16:38:51 2011 +0100

    Refactoring

commit 6674ff263ca254b847d85e738f9f82fb8a6c20b7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Jun 26 16:28:23 2011 +0100

    Add test

commit 03ac4d0eb20ab6cf4db01c5a518a37f42ced6ae4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 26 10:06:05 2011 +0100

    meh

commit 1ee9fc064fb2671ad20eee8d0c090105b497dbab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 26 08:52:59 2011 +0100

    cosmetic

commit 8cbced41a42542001f64a5fb2d8526965583ae02
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 22:07:40 2011 +0100

    remember when we've refused a queue's can_send due to being blocked
    so that we can tell the queue when we get unblocked

commit 9de9da84eff2460bd79d05a37fdabc2085473436
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 18:34:23 2011 +0100

    s/run_backing_queue_async/run_backing_queue
    as well as removing some mroe tx remnants from mirror_queue_slave

commit 713f085b30a59db3a4b31b1bdbbbbe4ebb3b4c15
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 18:23:20 2011 +0100

    get rid of sync run_backing_queue
    it was only needed for tx
    Also remove some tx remnants from mirror_queue_slave.

commit b586310726399063c9e123f445c7ee26e715577e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 15:31:27 2011 +0100

    cosmetic: move helpers to where they belong

commit b3c7a88928dc787440d9762c1320eaa10bcc4b75
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 15:31:10 2011 +0100

    cosmetic: make order of exports match order in behaviour

commit b42ea9aa3d01dc95ab03ebe8a7f6ce6015b302ac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 15:17:49 2011 +0100

    refactor 'dropwhile' and 'fetch'
    - rename 'internal_queue_out' to 'queue_out' and turn it from 2nd to
      1st order, thus making it more analogous to queue:out
    - only assert state invariants at public API return points, not inside
      helper functions
    - inline 'dropwhile1' into 'dropwhile'

commit d5e3c94a05bc6ba16a6477343f851260706b12cc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 14:47:32 2011 +0100

    minor refactoring and simplification

commit c5b36e1d11a42c63f0108ede22240d946e8979ae
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Jun 25 12:14:26 2011 +0100

    Correct bug. This was introduced in bug 24116.

commit 22ac5ea3c9659422f38997b6dcf00faf231740ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 25 07:03:13 2011 +0100

    fix tests

commit 08451c5322f9877ce36c4fabc7bfa0dac8329690
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 24 22:36:22 2011 +0100

    tx gone from everywhere

commit 4c6e1560a903ac514b1fe3a61b9ebdfe963a8083
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 24 21:02:57 2011 +0100

    remove transactions from backing queue
    ...and mostly from amqqueue_process

commit e0738531b6e1e40c7cf9ffc8a3f4e47db3aa9214
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 24 12:20:03 2011 +0100

    Oops, we need the dependency.

commit dd38990bd1b1e3f11ba71d85546482367068aa29
Merge: c12a751cf 53555cd5d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Jun 23 09:16:40 2011 +0100

    Merged bug23554 into default

commit 53555cd5dd02d366728605c7f73dde2e15afd1bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 22 13:32:30 2011 +0100

    Explode if the nodes policy has an empty list as the policy params

commit af6608461a420f8bdc1034ca345be3656039d8ac
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 22 13:09:39 2011 +0100

    Make an error more likely to be formatted sensibly

commit 419aa9bb33c07b3e61465ea2beff6d51da8e3671
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 22 12:33:06 2011 +0100

    Really really don't look at x-mirror anymore. sigh.

commit e826bd10c17fd4d35350bd675e2f28368d974ca0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 22 12:28:01 2011 +0100

    Be more helpful...and make it compile

commit ee4cba4504c6d4cb9227c0a90ad42c911c231f44
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 22 12:26:59 2011 +0100

    Be more helpful

commit 6455387577aaced51e14984e1e75c73bd2b79449
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 21 18:30:07 2011 +0100

    More realistic tests

commit e4cefc5ce741f73e17afc23591a3a57705850e0b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 16:52:08 2011 +0100

    Remove rubbish

commit 1d2d2d6c00cf87fd9105cb5f0dd8f2f2c527ce9e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 16:51:22 2011 +0100

    All done.

commit 42a3391e1be4e3ca4b914d40fb77a4f45d79cb04
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 16:43:25 2011 +0100

    Sort out misc. (dnc)

commit 6ffa7490139cf4ca93db5763529d02fab3bc22c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 16:23:15 2011 +0100

    forgot to remove. (dnc)

commit 37fb4e222655b8e0182b8ce3771f6b5a0c5b7769
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 16:22:48 2011 +0100

    Sort out (everywhere except mirror modules) slave pids and mirror nodes and deal with non-local queue declaration, and introduce ha policy and ha policy params. (does not compile)

commit 9e6aa4f7e8057565c8ecea2b8de68bafd5850064
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 14:14:14 2011 +0100

    Rip out support for dynamically adding or removing queue mirrors

commit 34a62af5202cb8682c7833baa1cd2a0e266b4e9c
Merge: c12a751cf 323f0b298
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 21 14:09:02 2011 +0100

    Merging default into bug23554

commit c12a751cf467bd78f81eb803d3adc6a3241432f8
Merge: 869a6ade9 e6fad42a0
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jun 21 10:34:55 2011 +0100

    Merged bug24164 into default

commit 11936a400994d2a447f0c3aad7b5fdc779f858dc
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 20 17:51:30 2011 +0100

    First draft of qc property for backing store

commit 8a8802ddcb56373f100128ad7c541f156ea2b0ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 20 15:47:04 2011 +0100

    Generate fine stats on redeliver.

commit 0128bf7cce3568e00753f42a516646eb04399c2d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 14:21:02 2011 +0100

    DLE -> DLX

commit 0e9ab79f92f700da57c0c2c96501afa853833629
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 14:16:02 2011 +0100

    Tweaked read_msg_callback to not increment RamMsgCount and cleaned it up at the same time

commit 123a0fa618ccd5077193c6af1914664d073f835d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 13:04:34 2011 +0100

    Refactored read_msg_callback

commit 0bc93d9ea3d7b8f268f1fcdeb98013a29db31ea2
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 12:59:33 2011 +0100

    Rename MsgState -> AckEntry

commit c4281184b8f440aa7ef82d7fa9875c764fc84890
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 12:58:19 2011 +0100

    Renamed dead_letter_exchange to dlx

commit e120bd3802b722b12a40d82b9ea14d89e417c11d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 12:50:06 2011 +0100

    Fixed up spec for msg_lookup_callback to contstrain input and output types to be the same

commit 1c1deede6b1372d9eff102c2db558989e4e70917
Merge: 419f66351 e6fad42a0
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 20 12:45:18 2011 +0100

    Merge with default

commit ecf2ee32580ed5728a4f9845fe0640120e791e17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 17 15:53:37 2011 +0100

    Allow unprivileged users to passive declare.

commit 869a6ade91a2bfe641843aea283939f9275aa0d6
Merge: d40b238f7 e6fad42a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 17 14:26:56 2011 +0100

    Merge in default

commit d40b238f71c49c3d85bc8e0dbdd56b3cc9922a4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 17 13:35:44 2011 +0100

    It's now 'management'.

commit e6fad42a0b5d27a4d832645bb9e9db5d0b0113cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 16 14:32:02 2011 +0100

    Matthias points out that these pertain to the old persister which we no longer ship.

commit 17eab3feaf763713882b7670a2724e1d52ee74db
Merge: 230887e64 af72998b1
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Jun 14 17:12:07 2011 -0700

    Merge heads.

commit 230887e6407bfc85cf4557edf150e34b28af9423
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Jun 14 06:25:04 2011 -0700

    Added tag rabbitmq_v2_5_0 for changeset 1924f92d10f7

commit a0995488650839bd964025ff856d84f989556cfd
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Jun 14 05:53:10 2011 -0700

    Package changelog mods for 2.5.0

commit 419f66351f15070693446954fc2a32b73b84bbc9
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 15:36:42 2011 +0100

    Fixed bug with undecoded content

commit 2d763b61f6cf17e7dd150041df472b2fd9e0e5c5
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 14:54:10 2011 +0100

    If a DLE is deleted after being declared in an x-dead-letter-exchange argument, this should be a fatal error. Also, if the DLE has no routable bindings for a message, we should just proceed as normal.

commit b3f1f14e1d28be6a50094d64143dfa71612fdb28
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 13 14:51:16 2011 +0100

    Convert non-administrators to "management-user" (see bug 23664)

commit 465c0d9c41cf62f2ee295d08d1829232492cd041
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 13:51:04 2011 +0100

    Removed PD hack and be happy with the death reason we have

commit af72998b14f2852bdd098ee1252aa0af6df802df
Merge: 6e508e646 8e28d7ae2
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 12:46:16 2011 +0100

    Merge bug24162 into default

commit 9aae97b137bb3e5e7f98f0b59c41061577f39fdd
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 12:02:58 2011 +0100

    Updated specs and fixed error in ack that didn't account for different ack storage formats

commit 76552918fd0e8636eee8087204e1a169f3a9c66e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 10:46:01 2011 +0100

    Bit of a hack, but it gets the tests passing for now

commit 44d75673aa6c6c8c429072124bf4e391b9c93bd7
Merge: 6e508e646 cc4bf8586
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Jun 13 10:32:45 2011 +0100

    Merge with default

commit 588b23fa982506331287d77eae6579435d5ff032
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 10 12:23:24 2011 +0100

    Yes, this is really what the QA process has come to.

commit 3ead94ab4b3ffb545428f860e1b4e9eef24e4f71
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 10 12:03:34 2011 +0100

    Further improve tests

commit 0f06d160405d154dd586bb950ea84430df68fb57
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 10 10:33:17 2011 +0100

    Improve (and, err, fix) tests

commit 6e508e646db617d2a98fa650cb0fd1c4877f4f68
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 9 16:43:17 2011 +0100

    Elimination of trivial and pointless abstraction

commit 78044d9e38fbc869ea99d0679142b586ab4dfe5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 9 15:53:49 2011 +0100

    Oops

commit 90529d148cd36fa23e7a201c8ea8368346e66945
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 9 15:30:06 2011 +0100

    Since we're changing the backend API anyway, let's remove this management-specific wart.

commit 802846a4b4a64a3baebddb2322784c2b7a893591
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 9 14:15:17 2011 +0100

    First pass at user tags.

commit 8e28d7ae243663d7af2bd41654987a9b421ff5b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 9 12:13:40 2011 +0100

    Make the stats interval configurable.

commit cc4bf8586cfa9d0771ad5c51556f8de972d76782
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Jun 8 15:13:14 2011 +0100

    Support for DL'ing messages that are rejected with requeue=false

commit cc97fb50de0ec36c8fd40ccbfb75c122e2b52acf
Merge: 415eaa255 438e76e8f
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Jun 8 13:10:55 2011 +0100

    Merge with default

commit 415eaa2552be75a578ae3dacecf1c9ff4ca5fa8b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Jun 8 13:09:43 2011 +0100

    Publishing under new GUID now. DL'd messages have x-death-reason and x-death-queue headers for admin purposes. Support DL for queue.delete. Fixed issue when messages not in memory were not loaded back from disk

commit 438e76e8f8113b77dce286b4cab03c8736c4f44d
Merge: febeb8df1 35f10bb9d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jun 7 15:20:28 2011 +0100

    Merge bug24157 into default

commit 35f10bb9d61f8ae0307fb5426d52db5b369a6ae1
Merge: fa646cea4 febeb8df1
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jun 7 15:15:55 2011 +0100

    Merge with default

commit 9d36f516d5eeaa303619b45159473fabb3015e2e
Merge: febeb8df1 39a0d0350
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jun 7 13:55:05 2011 +0100

    Merge with default and rough outline of DL for ttl expiry

commit fa646cea45a2168ed0c486356f560cae0d12c09d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 7 13:10:35 2011 +0100

    Another version, avoiding a temp var

commit c4975944ad710e824d872f77c9c912046d5797dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 7 12:24:58 2011 +0100

    OK, so that approach does not work, due to the node started by erl somehow imposing some of its configuration (in particular SASL) on the tests call, and making the log tests fail. Let's just parse the output...

commit ad7be9810efa313d75c8bdec22d6689db747be66
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 7 11:43:39 2011 +0100

    erl_call treats all communication with the node as success, so try to emulate it.

commit febeb8df17ac5a0b024bce2c4f73c1a5b269d0da
Merge: c62eef7be 02714c944
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jun 7 10:02:05 2011 +0100

    Merge bug24151 into default

commit c62eef7be78668a00f3af3676658c0d9e39cf499
Merge: 14bd624a9 95d07287b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 6 15:58:08 2011 +0100

    Merged bug24156 into default

commit 95d07287b4007af9f763ff3be7e39eee0d9bbc04
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 6 15:51:17 2011 +0100

    Explain what we list by default.

commit 14bd624a9487831c7b9fa0c0f2bacbd8c53e5a93
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 6 15:37:48 2011 +0100

    Ahem

commit 16621950589705bd64b4a6ffda78c0103da5383a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 6 15:17:12 2011 +0100

    Be more consistent about returning infos from rabbit_auth_backend_internal:list_*_permissions, fix rabbit_vhost:delete. Note that some of the info keys have changed to match those in mgmt, so we avoid a translation layer.

commit 0607022c1339d8cb26e4f3146e4680c546f8c358
Merge: 05d4f15c2 c906c9a2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 6 11:23:53 2011 +0100

    Merge bug24128

commit c906c9a2fb83beeb6de94576d640cefc1f9058b5
Merge: 09da939e7 c2475fe28
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 3 15:27:59 2011 +0100

    merge bug22953 into default
    some minor tweaks and bug fixes to the broker needed by rabbitmq-federation:
    - make rabbit_binding:list_for_* usable in a transaction context
    - add rabbit_binding:peek_serial/1 to retrieve the exchange event
      serial w/o incrementing it
    - correct exchange type 'create' callback invocation in recover

commit 05d4f15c22ce96db22d10bd11c79dda98f120b74
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 3 15:23:53 2011 +0100

    More consitent exception handling

commit 02714c94497cfc285515c82e8a861cedb26cbba1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 3 14:05:39 2011 +0100

    optimise routing by bypassing mnesia:dirty_select
    ...and going straight to an ets:select instead

commit 718423deb006f04cfa7c4f410f963c5ab0ea5e27
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 12:38:17 2011 +0100

    Report cosmetics

commit f125cf516136f232e9bf59c4d598ffc044e9d5c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 12:20:56 2011 +0100

    Reformat and move environment / report back (and take status with them).

commit 3dc0e27e75ffb84decec8d9db08d4e2873acb8d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 12:17:58 2011 +0100

    Reformat, rephrase the "diagnostic information" para and move it to the top since it always applies.

commit 5a45292a484b7acfe8ae957003f289fd3996aff4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 11:57:40 2011 +0100

    Use a list comp to filter, sort the list.

commit 0294bbacc37b089f57023857baf2c0190d3ad5eb
Merge: 40a21fd96 50e58e116
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 3 11:54:05 2011 +0100

    Merge heads

commit 50e58e116df244c1d592a6168471f60108fae8e1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 3 11:51:50 2011 +0100

    Change rabbitmqctl docs
    
    Move environment and report from Server Status to Application and Cluster Management
    Remove list_consumers, environment and report from usage info

commit 40a21fd96f9bef828d316bff7b183d598347c930
Merge: ef6b33d42 06ab65b03
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 11:46:31 2011 +0100

    Merge heads

commit ef6b33d4282b42334b548d028fc291967e168f45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 3 11:45:53 2011 +0100

    Need a space here

commit 06ab65b036f60dc5cd9d4fe8cc8c26478df6e284
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 3 11:31:22 2011 +0100

    Less verbose description of environment command

commit 6f62c3966b851022496031ccd15ee5e332ff0658
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 3 11:22:01 2011 +0100

    Show docs in usage

commit 661c972ae8ecad260471aa61a1fb1e5cb5dba0c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 2 18:12:17 2011 +0100

    Split rabbitmqctl status query

commit 09da939e7c4dd3f6c145e02c6cf05551ae697f40
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 2 18:03:46 2011 +0100

    Oops, we don't map true/false to transaction/none on recover. Let's fix that here...

commit 323f0b29842701bbd23b2ee7cf8a4401903b9dbd
Merge: abbd3577c c2475fe28
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:44:50 2011 +0100

    Merging default to bug23554

commit c2475fe28fad0f55e32484bed76091476a419e3d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:40:26 2011 +0100

    Reduce diff from bug23554: Extend backing queue api to present reason for termination

commit d03d08e75937bec437d664203c7a0ff845a3f46a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:32:33 2011 +0100

    Reduce diff from bug23554: Scaffolding for programmatically deciding backing queue

commit 64fda0635880aeee08096e58ca29485311a3e1c7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:25:42 2011 +0100

    Reduce diff from bug23554: Allow formatting of nested info items

commit 535567b4a128459c68d21c3fe13458a457d51feb
Merge: d0cea8a68 3ccb10b6a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:10:28 2011 +0100

    Merging heads of default

commit d0cea8a686399afaaf2073921135ee4f0a28edb5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 15:09:00 2011 +0100

    Reduce diff from bug23554: minor tweaks to gm_soak_test (correction of error messages)

commit 66d5c4711c21a35dafe0f2127800e2d85839c8d6
Merge: 9d37d5594 3ccb10b6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 2 15:00:59 2011 +0100

    Merge in default

commit 3ccb10b6af5d8393efc15eac07f6d0f6f2ed8f62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 2 15:00:44 2011 +0100

    Move pget from federation / mgmt to misc.

commit c4ddb406dca4b73fe58397aeb54a2800fbcf2959
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 2 14:41:09 2011 +0100

    Move set_table_value from federation to misc

commit 75f46f88d89af44012ab16f8f77badbe7f226733
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 2 13:12:32 2011 +0100

    Cosmetic

commit abbd3577c55a0311c75cab9ae18da58f5de45aa2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 11:08:52 2011 +0100

    Undo unneeded change to boots

commit f60aa1e22a41c4416fcf92238557fbadc0b47407
Merge: c2a311575 1dbc4d1d0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 2 11:01:47 2011 +0100

    Merging default into bug23554

commit c2a311575a52fabdfd110e1071bf4b8d2bacdc79
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 2 10:46:00 2011 +0100

    cosmetic: eliminate gratuitous diffs vs 'default'

commit 1dbc4d1d0fdc0870353168f47cb674c6dde48ebf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 2 10:44:30 2011 +0100

    cosmetic

commit 1598e73192b6bf570a393e78187c0d744598e4a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 2 10:14:50 2011 +0100

    cosmetic

commit 9d37d5594417c2b7f0d9346fcead9871cc560a0f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 1 16:46:34 2011 +0100

    And change the name

commit 7403ee737772f601fd58790e18d3b8f81d8f8276
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 1 16:43:25 2011 +0100

    Oops

commit 9d0960818b2a8d25eee5117abd7919c52ac4f4a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 1 16:39:00 2011 +0100

    rabbit_exchange:peek_serial/1.

commit 6963ae185a8ea581ed786c73d1a4b2c995a1960c
Merge: a62fdf927 b39431bed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 1 16:32:26 2011 +0100

    merge bug23857 into default

commit a62fdf927da88bc406dd8bdbee63a22fca442b8d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 1 11:06:02 2011 +0100

    Tweak comment

commit 3e77f50ec85f8cfccc65a7ae69fd1e57ae5d9fa6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 1 11:03:02 2011 +0100

    Make sure the global name server is definitely up and synced by the time we treat the cluster as "up".

commit 8fa43752f207408591d57a683618d67e9967b31a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 16:21:49 2011 +0100

    Update manpage for rabbitmqctl status

commit 8007d629f2aa7a43807cb36ad1bf75130ae16b3b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 16:07:13 2011 +0100

    Move status info (again)

commit af973d1406b57a3790a6aef905c5de5b208beb80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 31 15:51:34 2011 +0100

    Allow binding:list_* to be invoked inside a tx meaningfully.

commit 2e363957c9192ec4f669bbb37e820ac4426c664d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 14:40:39 2011 +0100

    Report node-specific details separately

commit 61556c2e11c617e0f0067d1aba064cbbd5c16489
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 13:36:23 2011 +0100

    List permissions differently

commit 7f4bd7efc40349e99cd3f3f0906dd3d9f921b07e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 12:03:33 2011 +0100

    rabbitmqctl report layout tidy

commit b39431bedc5a1bb2e247bab5372962296f284214
Merge: 9050e3a14 d6bfb4873
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 31 11:18:56 2011 +0100

    Merging bug24137 to default

commit d6bfb4873822ad3d301d79565ffe32ca9e63ccc4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 31 11:08:01 2011 +0100

    These "--novalid"s are less meaningful in the context of bug 24137 since you need to have docbook installed to get this far and so can't trigger the bug. But it can't harm to put them in, and it's possible that there's some other bug I haven't thought of that this fixes.

commit 98bbc39689ce4013e9a2c18b83a09eea67d415ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 31 11:04:05 2011 +0100

    Remove more pointless namespaces.

commit 47b8aea5379850f96848c1f94b64f1410816a2ad
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 31 10:58:20 2011 +0100

    Optimisation while listing consumers

commit b11ebe1af43a907a0f35799d8c2b88c1a31c5c6c
Merge: 2e4e66760 9050e3a14
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue May 31 08:36:42 2011 +0100

    Merge with default

commit f6410dd7ca7c5c81f79c1deb01e455fe7c7e8d7e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 27 14:04:40 2011 +0100

    Add headers

commit 9050e3a145a7f9b6b27534a53cf6f685fe7bdbba
Merge: 4c3b56b7b 566c81566
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 27 13:47:43 2011 +0100

    Merging bug24079 to default

commit 1862c8c51086ce320c0bead1766be355c369caca
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 27 12:46:39 2011 +0100

    rabbitmqctl report listing consumers more consistently

commit 566c81566ace2a275d52cf9c6ffd310fe0158c92
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 27 12:17:06 2011 +0100

    In light of bug21782, solve the asymmetry problem the other way.

commit 2e4e667608048229a5cb23008a39ef278249023b
Merge: 4c3b56b7b 159d9da83
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 27 11:51:14 2011 +0100

    Merging default into bug23554

commit c5bb4d5055b01bf6bf6920d9ef7c01a3b9fc8cf5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 27 09:33:14 2011 +0100

    Remove rabbit_consumer.erl

commit 0dde8d8491c22dc4bfe1bd09be9aab9f6c25bbcf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri May 27 09:30:50 2011 +0100

    Rollback info_all renaming

commit c37764e79c42ba3e1d67c2e3c34409d287df79bb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 26 18:07:38 2011 +0100

    rabbitmqctl report

commit 0f6772c73ad979d1e1dcb523f961701cbb44a110
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 26 18:04:00 2011 +0100

    Don't validate against the docbook DTD when building the usage erl - we don't need docbook installed to build the server, but without this --novalid we instead go to the internet if docbook is not installed, which can make building flaky.

commit 565e7c0d4b53de2fa4dbce8ea89ec14e7ca262be
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 26 17:40:26 2011 +0100

    What on earth were those namespaces imported for? They're not used for anything, and they help the build to fail if we can't contact docbook.org.

commit 4c3b56b7be499d5ad3570c56c6fca6048a8cfdeb
Merge: 3ab921519 dca647b79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 25 17:37:47 2011 +0100

    Merge bug 24136.

commit 159d9da835ab6b6c3cc4c0223663a1473186ff27
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 17:01:39 2011 +0100

    Remove R13ism

commit dca647b79fe6b4132b8236777686b1ded90631d5
Merge: a09237ae2 dfb7e59b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 25 16:43:15 2011 +0100

    Merge bug 24133

commit 3ab92151948c0c546cbefe5902efbd92acd14280
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 15:45:21 2011 +0100

    R14B03 moved hostname and ip_port out of inet.hrl and into inet.erl where they export_type'd them. This is a backwards incompatible change. Thus there's little alternative to bumping the erts requirement for using specs

commit a09237ae26fbb620eaa7dab3a1361755956f7c8a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 13:50:18 2011 +0100

    Assert equivalence of x-message-ttl

commit bd02c71a2091d3d885ea0b74d120cb4b274b748b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 13:42:34 2011 +0100

    Work in gm table creation as part of the normal upgrade steps, and then assume that it'll continue to exist

commit 2bc6a18225c1b0dea97588bb363d2589b32c1a5f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 13:32:06 2011 +0100

    enforce equivalence checking of x-mirror arg

commit 86154a405631bd8bb3adc8a360cdc99e1baba8a5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 13:23:21 2011 +0100

    correct use of nodes()

commit 5a67647632c1327b3081fe58a571d92a0be1cb97
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 12:35:21 2011 +0100

    Not quite sure how I managed to get that quite so wrong...

commit 6855080f826159e15bef9dfa048c953f74c8ee6e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 25 12:05:08 2011 +0100

    Enforce checking of x-mirror arg

commit 0c0276ea8642c868772a0a145599cb3ec51f6b42
Merge: ed518e836 dfb7e59b0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 24 18:03:46 2011 +0100

    Merge default into bug23554

commit ed518e836df619635776c4d93696e487d4a7a198
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 24 17:38:14 2011 +0100

    Permit dropping nodes of mirrored queues. This turns out to be much much messier than I'd hoped as the principle problem becomes ensuring an add after a drop works. Normally, an add would only occur on a node that has not seen said queue before: if it had, in a previous lifetime, then the booting of rabbit would have ripped out any locally stored files regarding that queue. But now this step may be missed. Having tried many different approaches, the simplest became expanding bq so that the shutdown reason is exposed to the BQ. Thus both slave and master can then detect that they're being dropped, and, in the case of master, it can convert a bq:terminate to a bq:delete_and_terminate. Every other approach I could think of turned out worse.

commit dfb7e59b0fdc4972bc2a65a7a0842a54f8f99645
Merge: e3be8db48 603ac8be0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 24 13:55:42 2011 +0100

    Merged bug24107 into default

commit 06c3ac40bba9c60305612ea9fae8440892a19a00
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 24 12:50:58 2011 +0100

    Whitespace

commit 603ac8be0e43fb9cc132123a2a2b067450398da5
Merge: a1fda5e48 265142455
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 24 09:07:26 2011 +0100

    Merged bug24129 into default

commit 7a692dcb3ab460b30423c74785d386c0ff0ed2fe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 16:50:48 2011 +0100

    Add pointer back to bug given the value of the additional commentary in the bug

commit d8d15f29478db155af8cc428052cde92573ddb4d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 16:48:34 2011 +0100

    Update comment

commit ef7511bd205f45762757e9bb6c1fb00a6b824cdf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 16:45:27 2011 +0100

    Fix the remaining memory leak

commit a1fda5e48fbe0c33b2bd99873f6daef302d8873d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 15:06:10 2011 +0100

    Add a "tracing" column to the list_vhosts command. A bigger change than expected, as vhosts didn't have the standard info item infrastructure.

commit 1cce55e21613fbf6b239f0fd23778da47ad5dd9f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 15:00:50 2011 +0100

    Updated documentation, and in the course of writing it, thought up another scenario I wasn't coping with. Fixed. However, not all documented causes of memory leaks are yet fixed in the code

commit facda70ab65e963f7455a8f6a23e358ead18cdaa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 13:29:35 2011 +0100

    Remove debug log entries

commit cce47dd51248ba5aafe8659213903af076d3ca3b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 23 13:27:31 2011 +0100

    master must broadcast, esp if it doesn't know about the sender. Also rip out the varying priority run_backing_queue* stuff as it turns out it's not needed

commit e3be8db48e6626f4e18079dca5c865a88c4bbd56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 12:39:49 2011 +0100

    Since we should not normally see warnings now, let's zhuzh them up.

commit 864983db8c3083184307fa67cfe5e30468337503
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 12:25:05 2011 +0100

    Rename variable

commit 896bbde667ba9cf95bb1a541523b026de2db3c4b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 12:22:21 2011 +0100

    Introduce variable

commit e07b068097786ffcd59e48f38c80b0c9d849853e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 12:18:07 2011 +0100

    Exclude mochiweb from the xref check.

commit e8f6bada8543567580e948afefa68c1ab59b3f92
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 11:17:18 2011 +0100

    Inline exchange/1, multihead publish/7

commit 8b13d36eb49671fcfb39e4118f19db65852f48bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 11:12:52 2011 +0100

    Rename and move things a bit

commit 6a62a4cde71a97bba4858b5566921ffad3f6a79e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 11:12:32 2011 +0100

    Abstract the types

commit 023d259b7a31b739fd5ae9426e3df96860e0f943
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 11:11:24 2011 +0100

    Don't display it as binary.

commit aa6b3116a0bc0876625520b6fd5f06c79a1fbf81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 10:25:02 2011 +0100

    Update docs.

commit 5549ba745328cbf5ebb3b479198cb3dfe09b74d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 10:20:08 2011 +0100

    Actually use the exchange we have. Not very scientifically measured, but this seems to knock about 1s off the time to to "time MulticastMain -x 2 -y 0 -z 30" with tracing on (from ~82s to ~81s for me).

commit bd042236936bef579a54184e2266ddf608cb6941
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon May 23 09:38:44 2011 +0100

    Fix dumb mistake.

commit 90d1d2aef840120447a16b21b08e17006a573789
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 20 18:39:07 2011 +0100

    Critical bug fixed

commit 5ff0bf20e1381ca27100551ea65176f5be690fae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 20 18:34:00 2011 +0100

    --

commit 644a66996de65456ea5716436f9d615287ebf41f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 20 18:27:35 2011 +0100

    That's an awful lot of work to solve a potential memory leak...

commit 2627104223d94ed2297c53d9305b54c5c808b003
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 20 18:15:24 2011 +0100

    Switch to hard coding the exchange name.

commit 50ae4f843eed3c026901648a523af9d3d637139a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 20 17:46:44 2011 +0100

    Fold publish and republish together.

commit 7acb2d538853e700565e5f7b3a3be69187f6f71b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 20 16:17:16 2011 +0100

    Optimise looking up trace exchange and message construction.

commit dff7935f22364e622544d67afaa1ba986c2059e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri May 20 14:51:57 2011 +0100

    Rewrite the rabbitmqctl interface. Define trace_exchanges in rabbit.app.

commit c5edb3dbca4f3e046101203e2e77bd545790a674
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 20 14:34:55 2011 +0100

    ...and the other bits I forgot.

commit 8bd0cbd78611086198336b2f35a0dec3cb8de551
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 20 14:32:16 2011 +0100

    BQ:idle_timeout => BQ:timeout

commit 265142455a7f8e4bb09aee18f57b5beedae68afd
Merge: ae8e00b23 20e8bb017
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri May 20 14:22:56 2011 +0100

    merge bug24118 into default

commit 6908a82094e5cd21230144c3cbe8fadf96742461
Merge: 20e8bb017 ac28ddf16
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri May 20 13:33:05 2011 +0100

    Merge with default

commit ac28ddf16559b9cb0270c38637d3d5d0136548b7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 20 12:01:08 2011 +0100

    Make log messages prettier

commit ae8e00b23c03770299894085687a2f10e0c38e71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 20:59:30 2011 +0100

    some more inlining

commit 8d59525162c1e057c09cb8626e2f2e0757e74a73
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 20:10:27 2011 +0100

    cosmetic

commit c64d6655d5fa1780d464c58d0177805fe37b264a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 19:50:38 2011 +0100

    fix error handling and construct xname on init rather than every message
    I have no idea why that 'catch' was there. There is nothing to go
    wrong during publish except the exchange may not be found. Which the
    'catch' wasn't catching since that is just an ordinary {error,
    not_found} return. Cue explosion. So now we handle that and print a
    nice error message.
    Also, there is no point constructing the exchange name for every
    message; doing that once, on init, is enough. That has the further
    advantage that now the implementation matches the spec
    (rabbit_exchange:name() is a qualified name, not a binary).

commit 909e5c85a1eccd8c9f0e0de534fc1f92573fc3f4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 19:11:31 2011 +0100

    inlining

commit bff378171127bb2688dd3db920310227b7c87a27
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 18:40:35 2011 +0100

    sometimes clarity trumps performance
    I can't actually detect a difference in performance here, though I'm
    sure the new code is slower than the old one.

commit 96bcb7310baf35dd14f37586733ac9ffb63254c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 17:36:24 2011 +0100

    funs are too expensive here. Ouch.

commit 67dcc215cef5ec60466dba09811d9e26425eb114
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 16:44:09 2011 +0100

    Further refactoring

commit dd48ceb98d7fb6a9a7c9ef6b817428a5082de30b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 16:25:06 2011 +0100

    Refactor.

commit 20e8bb01733b2f67598425a112f339a4088ab5b0
Merge: 481ba6187 f2743b4d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 16:08:51 2011 +0100

    merge bug24117 into default

commit 29445dd2b11ee90d1a235391bd5871a6d7f60a06
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 16:05:02 2011 +0100

    Slightly tighter specs, tidy imports.

commit 457221a521edfce0b1599b1d403cd21aa4a56387
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 19 15:57:43 2011 +0100

    Be more assertive. Slave is the equiv of amqqueue_process, so it's ok here to know the message is actually a #basic_message and thus contains an id which can be matched against

commit b04866828c7275079cb32ebda7098782bb9774f7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 19 15:10:11 2011 +0100

    Make slaves explicitly monitor the master (see comments to come in bug)

commit 481ba618783febcb470a803bc652acf56200ee09
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu May 19 14:16:30 2011 +0100

    simplify

commit ae85eea0d4272b8264b8be92300ba8271a2b9ef4
Merge: 0de9980c1 b0971d13a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 19 14:05:13 2011 +0100

    Merging default to bug23554

commit b0971d13a8836b6cafcb2c63e8bb5db8cd510a6e
Merge: 3870c1b3d b88324d62
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu May 19 13:39:37 2011 +0100

    Merge bug24116 into default

commit f2743b4d5b941cd2d65934b07b4f2d141491804e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 19 13:32:09 2011 +0100

    BQ:idle_timeout => BQ:timeout

commit d32b73f70c72ad41fd019ce0da80e47547d37982
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 12:41:22 2011 +0100

    Fold refresh_config in with (un)set_env, abstract into rabbit.

commit a776cfe99bc3f582efcfb84a3976b492969a2206
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 12:30:16 2011 +0100

    Rename

commit 81ce58564f293853071ffdee83c6afccddd9009e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 12:04:27 2011 +0100

    rabbitmqctl refresh_channel_config

commit f18fa61ba732767eef72a9c0632643a6140a95d8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 19 10:53:01 2011 +0100

    Refactor a bit and push more work "below" checking the state. This reduces the cost from 2.3% to 1.1%.

commit 339f0c815fad286e38bc4b5756d660de05890df1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 18 17:54:24 2011 +0100

    Only check the application environment when a channel starts up.

commit b88324d62b465f7c1eac86edf2178d05c1c1dc52
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 18 15:43:51 2011 +0100

    And now, after testing it, actually make it work by correcting one of the counters...

commit c4497f028f22ce73fc80330a17dbb0d930664f6d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 18 13:36:50 2011 +0100

    whitespace

commit 2126828816af3361dd3e221e1b85a94412891a87
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 18 13:35:41 2011 +0100

    Well it's no shorter, but it closer matches the original

commit 9b539289a1c122c791112d70f470a696fd5e45f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 18 13:30:32 2011 +0100

    BQ:needs_idle_timeout :: State -> Bool ==> BQ:needs_timeout :: State -> (false | idle | timed); which better reflects the different needs

commit ff11ce2755d725c3d798abd0a3e544f803a345e0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 18 12:42:47 2011 +0100

    Do not read the msg surviving dropwhile1

commit 0de9980c125ff0b24099c71b94d03bbebfefc301
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 17:29:38 2011 +0100

    Improve logging information

commit 7d783d1765e6c41c4d9377c8d321762ec86b3287
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 16:40:01 2011 +0100

    Eliminate a race which was found to allow promotion to be non-atomic

commit 4dc16a43667afffc75a183bde8f67ecd5f56d9a5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 12:28:39 2011 +0100

    Add upgrade step to add the mirror pids to the queue

commit cbb1ebfbe6437953bad937fffe1f1f257dc86bcb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 12:12:48 2011 +0100

    Ensure that when a slave gets promoted, it requeues msgs in the same order which they were fetched

commit 9327aa6dbd1f172353f5a811c3d7bf1356b7831d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 11:25:58 2011 +0100

    Add a sleep, to avoid tight spinning

commit f42f00c82076c3d2c756b0df1a1d74ec3eabe360
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 11:14:36 2011 +0100

    Not especially happy with this but can't think of how else to solve this. If the queue has mirrors then you may well find that during death you try to contact a dead queue process, because the mnesia table is yet to be updated. In such cases, loop.

commit 453ece9b11a0cef4b9ce6c300b12ed07cde1c931
Merge: 7bc8f4795 3870c1b3d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 17 10:56:08 2011 +0100

    Merging default to bug23554

commit 3870c1b3ddaf6f147da33d98942a497ad60a8253
Merge: ffd830f80 790ef6bc6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue May 17 04:08:36 2011 +0100

    merge bug24004 into default

commit ffd830f80c8e2e003e472c28c92b641a9ee0adaf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 16 22:31:56 2011 +0100

    Closer approximation to English

commit f719a2d6d029bead67b6a2602c0004a7f4adf587
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 16 22:11:06 2011 +0100

    Extra words

commit d7ef3a9fcc7048299b406686c81be698a7e66523
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 16 22:08:59 2011 +0100

    English

commit 0f8036e4033344956fc67b4e7b90eafa06772b41
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 16 22:08:12 2011 +0100

    Added origination comment

commit 790ef6bc65d86fd1f1ab6c99cf43c7652af78fe1
Merge: dcb584730 eb545e833
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon May 16 21:48:10 2011 +0100

    merge bug23939 into default

commit eab4f184888594013db25bc6a69d12488f1d19ed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 16 17:36:41 2011 +0100

    Correct specs

commit 7bc8f4795784f39d3c815c420e7658a1a0768966
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon May 16 14:58:55 2011 +0100

    Fixed call to validate_message

commit d9c63025e730f6b85e78e7dcae49d4c28757e72d
Merge: 1a9334108 eb545e833
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon May 16 11:09:28 2011 +0100

    Merge with default

commit 2823712d2ae6d65092bbc84a689448312af2500a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun May 15 17:17:05 2011 +0100

    shrink

commit eb545e83348a1e3e06c9030d936735c31aa06b2d
Merge: b76b4f03d 54059ed6a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 12 12:12:45 2011 +0100

    Merging bug23899 to default

commit 9b7774748885024f8e848fcd45461f0b097d4574
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 12 11:43:06 2011 +0100

    Support multiple source dirs

commit fb5e3344fe2a3179faa33a753a9f6477ad62ced2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 11 16:55:57 2011 +0100

    If we see a list of modules there already, trust it.

commit da8c449ef0e34f27a7a4e00958d4b4b2c905c621
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 11 16:39:38 2011 +0100

    Use erl files rather than beam files to generate the app module list.

commit b76b4f03db4e73c40cd62b3a06c8fda18bbec515
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 10 18:19:19 2011 +0100

    Fix racy bug in tests as reported by Simon. Bug created in bug24037 I suspect

commit 59bd712ebbcf31743d9da03bd8513bf084e3a121
Merge: c5e3a7814 bedf9e99a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 10 17:46:15 2011 +0100

    Merging bug23559 to default

commit c5e3a7814b57592d540e3180f9b915fcbe70afd7
Merge: 6f5aa1a60 fb2660152
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 10 16:33:46 2011 +0100

    Merge bug20589 into default

commit fb266015210dc54b686cf1af39f8b88b075c8d7a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue May 10 16:05:43 2011 +0100

    Indentation

commit bedf9e99af9676f33774cc2b3450b71d9c2d2e4d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue May 10 06:00:04 2011 +0100

    track buffer size explicitly, resulting in a small performance improvement
    Also rename recv_length to recv_len for consistency and brevity.

commit 2cb8c70d2fe97841e8e122a6bee963729933bdca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue May 10 05:14:43 2011 +0100

    refactor: extract commonality between tcp and ssl recv
    ...and add a guard, for consistency with other funs

commit 6f5aa1a601225b5d2d0b19bf4d82ebcb3a5e3a89
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 9 15:17:38 2011 +0100

    How did these tabs get here?

commit 844ecd7146f5c38eb9b896c4837eb118068fc646
Merge: fd24ae76a e12d53601
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 9 13:26:41 2011 +0100

    Merging bug24067 to default

commit fd24ae76ac016b1a6d4f81d47485e2f8d8ee17f2
Merge: bb793eec2 8ec7c17cf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 9 13:19:07 2011 +0100

    Merging bug24047 to default

commit 8ec7c17cf51203834d6312e59f026f3d73c0b33d
Merge: 53d96037d ca1ad9446
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 9 13:17:40 2011 +0100

    Merging bug23831 to default

commit 2f94a7d2384a1ed1ad4afa944fff4a85e680e2bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 5 14:57:47 2011 +0100

    trace_exchange -> trace_exchanges

commit 6127120d1a12299af425d7e5bab73d4c8b09e669
Merge: 918598c3b ca1ad9446
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 5 14:18:23 2011 +0100

    Merge from default

commit dcb584730bfc4a8b452b8b4a745970d544a2b039
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 5 11:18:19 2011 +0100

    80 columns.

commit 729ad3699262fa3966d410b8ed647ae5bac76053
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu May 5 11:13:25 2011 +0100

    Remove pointless diffs from default.

commit 20e92eb4693f3c67238bc92a6b15e3b8053df91b
Merge: ca1ad9446 04c7af27d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 4 15:36:03 2011 +0100

    Merge in default

commit 54059ed6acf7e1483b71ec586fe996971f3cb387
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 3 17:26:52 2011 +0100

    I cannot BELIEVE that anyone was so UNPROFFESSIONNAL as to OMIT these TYPES.

commit 659a8d4d13402721ba4a4d23cbacbbe4990750cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 3 17:17:52 2011 +0100

    Remove dead code.

commit 698ef285f72be3a0f98457026bfbf54c1e37c850
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue May 3 15:33:33 2011 +0100

    Separate out different types for network and direct connections, don't check the password for direct ones.

commit 1a9334108bf69b9e2405ca9e006582f6d7873bdb
Merge: 11a0868f9 ca1ad9446
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue May 3 11:59:21 2011 +0100

    Merge with default

commit e12d53601aa45c4624dd9f8ff8f4c40e58ca7b84
Author: Piotr Sikora <piotr.sikora@frickle.com>
Date:   Fri Apr 29 05:43:20 2011 +0000

    Bump sleep times during tests to 100ms.
    
    This fixes timing issues I was seeing on OpenBSD. Solution pointed
    out by Matthew Sackman.

commit 1970d97dc800bc6a16d68460c92cfb564baa5e90
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 28 15:26:17 2011 +0100

    Precisely provide the same api as file:write_file/2,3

commit 78759491b8cb7f4d006bd021fcc0cb0dde08e413
Merge: 207104897 ca1ad9446
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 28 15:05:55 2011 +0100

    Merging default into bug24004

commit 02eb3b206ead615df8b2470acbae2600f7c1b4da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Apr 26 17:10:35 2011 +0100

    optimise common case that buf contains a single binary
    This turns out to improve performance *a lot*.

commit ca1ad94464bde375a054162e2ee91a688ab9e7dd
Merge: 17b612db5 20a6f77c1
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Apr 26 11:40:29 2011 +0100

    Merge bug24060 into default (init script rotate-logs action is broken)

commit 20a6f77c16853b469c4bdc363dd1815de0ace08d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Apr 24 11:11:05 2011 +0100

    Rotate logs uses ctl, not server. Also die if ctl doesn't exist or isn't executable

commit 17b612db504a3fdb38d3b52c177fe697934d14bb
Merge: 0badbef58 04aaaa55a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 15 20:18:32 2011 +0100

    merge bug24009 into default

commit 11a0868f91ea3f3263c1dce53a87db6391c0fa81
Merge: 04aaaa55a 2acabcea5
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Apr 15 16:30:13 2011 +0100

    Merge with default

commit 04aaaa55a15c04f970dc03de869f2fcf7074dcc1
Merge: 452639faf a93cf2f3d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Apr 15 16:29:07 2011 +0100

    Merged bug24037 into default

commit 452639faf51cc4166bf2ac44a1fcca8f94462557
Merge: a7f71af36 a93cf2f3d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Apr 15 15:16:27 2011 +0100

    Merge default

commit a93cf2f3d63e87c3111192ceac35eb00e3eed4ba
Merge: 5de4fa2dc ea7f63fdd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 15 14:08:32 2011 +0100

    Merging bug24050 to default

commit a7f71af36a62cd33d22e880bd1687522267f3e3a
Merge: 5de4fa2dc 8221900e4
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Apr 15 13:58:39 2011 +0100

    Merge default

commit ea7f63fddad0acfff826c971a303c3e9293f0aec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 15 13:33:36 2011 +0100

    Symmetry, specs.

commit 0badbef5887bb2e2561233d1e733a477e55c1bac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 15 13:16:03 2011 +0100

    tiny refactor

commit d4c484efcc3b9080e54223c49f51d9870ca4d6b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 14 18:14:23 2011 +0100

    Allow the erlang client to remain ignorant of rabbit_event.

commit 918598c3b526e34893df43aa6cd8bd894898850e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 14 17:11:37 2011 +0100

    Simplify tap_trace_in/out, don't make msg_to_table return a tuple, refactor, cosmetics.

commit 53d96037d3bd20dd5f5052524fb4e0f1e7366ef0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 14 14:37:01 2011 +0100

    (new head of existing branch bug23831). The direct client links to the rabbit_channel. This is the first time that we have a process linking to the channel which is not the parent of the channel. Consequently, and because the channel has trap_exit turned on, the channel needs to be able to deal with EXIT messages that arrive for it which are not from its parent

commit 5de4fa2dcc259e068bf5d3767044fd77f9c44f80
Merge: fe47ee0cc 7a46bea96
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 14 11:18:06 2011 +0100

    Merge bug23568 to default (build system rewrite)

commit f29e5fb5e6f9d2e56bdd274e910b3d09d34f9530
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 13 19:17:37 2011 +0100

    cosmetic(ish)

commit 6dc34685cdf8291aec3c16ca2c9fc03dffdf95df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 17:50:59 2011 +0100

    Slight further simplification

commit 2acabcea54950f2bed84f1faae59984d51fb52bd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Apr 13 15:27:29 2011 +0100

    Forgot to undo these bits, and the boot sequence has been changed, so debitrot

commit 522a40661db3e3016fc6218f2dd91bfb06e41b5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 15:12:46 2011 +0100

    sync_binding -> sync_route, simplify.

commit 5c9a8c00f3c45a098faee8982688e821f20f23d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 14:52:05 2011 +0100

    Oops.

commit 3ec4aacf97b27f6bea5ab6f94c599125b62994a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 14:48:25 2011 +0100

    Simpler remove_for_source.

commit 1c5308fe62b259af04f90cfcab682cf9439af263
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 14:48:15 2011 +0100

    Cosmetic.

commit a372fa05c7a8865911949034c945894b7665252d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 13 14:38:15 2011 +0100

    -sync_binding(Binding, SrcDurable, DstDurable, Fun)

commit 2f9dbde73fc57c2e35308fefd6fff56c73a46fb6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Apr 13 12:09:54 2011 +0100

    Undo merge from bug24038 which has now become INVALID.

commit 8fc6e563b1067cd64723971b29838ea7497fd72d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 12 10:56:08 2011 +0100

    Cosmetic.

commit 8b82ced4896b54f222fcbebae3dba09f24d9c45e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 12 10:53:09 2011 +0100

    Remove user and consumer tag.

commit 3f788007e3e1657fb455ee060af2dce25871f108
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 12 10:49:30 2011 +0100

    Be more specific about what we catch.

commit fe47ee0cc0544c66422b00e3f8dd43b73928908f
Merge: d156a1183 971f321f4
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Mon Apr 11 13:05:50 2011 -0700

    Merge bug23617 into default

commit 7a46bea96a056657cfbb35889376463c88bc4a47
Merge: 122972d7a d156a1183
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 17:17:16 2011 +0100

    Merge from default

commit 83c2121c7e98632b8927f8b219b0e17cda1b2087
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 14:44:34 2011 +0100

    Remove from all forward routing tables in remove_for_source.

commit 024cfcba4f9929da4b25639892ad35c8eca00d2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:39:29 2011 +0100

    Cosmetic.

commit 6584f4826de38265bf1c606e3db324ac93d6434a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:37:09 2011 +0100

    Get rid of that "Bin" suffix, it was inconsistent and strings are generally binaries in the broker anyway.

commit 8c19c44bb9523bc2289629bac79a92fc2efdf19f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:31:52 2011 +0100

    Cosmetic.

commit 90d1dc73f61eca2d46c6acd86f6e1fda1ed6a3d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:23:41 2011 +0100

    Less magic.

commit 4931873c351db4a1b960d3d2b1a85f99606f2cc6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:21:38 2011 +0100

    Add user to trace messages.

commit 3302ec870dba01624d6fd05a3a21335af96ad4be
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 13:14:17 2011 +0100

    Convert properties to table in a slightly smarter way. Also refer to the result as "properties" not "headers" since that's what it is.

commit af4d7d10a6fdf82c7948dfe79d70434c76abeaa7
Merge: d156a1183 b7c41bc6f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 12:41:32 2011 +0100

    Merge in default

commit b7c41bc6f16def1015998bd2475336adda0b77c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 12:38:39 2011 +0100

    Remove delivery tag.

commit 6499a5e952de85ebbb6f437bb724e4f4be540a02
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 12:16:49 2011 +0100

    Only copy routes that aren't already there.

commit dd1cb7db5ce12e4f3f5027157d44c7197a995cc8
Merge: 66ecf4dea d156a1183
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 11:37:12 2011 +0100

    Merge in default.

commit d156a1183511156148facc36862c113ebeff014f
Merge: b02b49868 043369e89
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 11 11:11:03 2011 +0100

    Merge bug24039 (attempt to add unavailable binding not handled properly).

commit 418af6d6efdcc791a8f5a308badcaab0808f3c3f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Apr 10 13:05:36 2011 +0100

    Work on documentation of ha

commit 700c770bfd458bb63bc1ade77c2ce4a3f6bb3811
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Apr 10 12:53:52 2011 +0100

    Work on documentation of ha

commit 3fe72bb890545f839265f3a2a00f889170ade6d1
Merge: 043369e89 db207126b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Apr 10 12:21:10 2011 +0100

    Merging default into bug23554

commit bb793eec22c039a8581645704f10e96c858eaf76
Author: Piotr Sikora <piotr.sikora@frickle.com>
Date:   Sat Apr 9 16:51:13 2011 +0000

    Detect available memory on OpenBSD.
    While there, rename freebsd_sysctl() to sysctl(), since sysctl is available
    on number of different platforms.

commit b02b49868044d15a9ae3ea8d77f7f8f80e0b9e24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Apr 9 00:38:18 2011 +0100

    correct error when attempting to stomp on an unavailable binding
    ...and fix the specs too
    plus some cosmetic shuffling

commit 043369e89c9ad3090fca99b9c9df97a1aff5ef4a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Apr 9 00:15:52 2011 +0100

    tiny refactor

commit 0e8c9dabdb681e52e9f814428c1a44ad9cbf681b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 22:08:38 2011 +0100

    cosmetic changes and minor tweaks to rabbit_binding:{add,remove}
    - align 'add' and 'remove' structurally, with the isomorphic final
      phases extracted into helper funs
    - call 'read' instead of 'match_object' to check for binding presence
      in 'remove' - cleaner and possibly slightly more efficient

commit 66ecf4deade6b1a9edca4b546cedffc0568f3172
Merge: 824c9913d 97b52fc91
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 20:17:33 2011 +0100

    merge default into bug24009

commit 97b52fc91d35f5d7a2bb33b3ad7a8a8a5f8a0673
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 20:09:17 2011 +0100

    cosmetic: update comment on table_filter

commit faf1e5b490bcc2dd33f48f9f2f4a87c811d4e67a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 20:08:45 2011 +0100

    remove duplicate check
    rabbit_misc:table_filter already filters out elements which have
    disappeared.

commit bd3bbb3660616dfa5613eb651842325b6b170de8
Merge: a164bb8c7 147307d98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 18:55:18 2011 +0100

    merge bug24031 into default

commit 147307d9846e21fdce76b686d51710113accd135
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 18:33:44 2011 +0100

    shrink

commit db207126bb61a4d251dc2755d15dd8aa5cb1a4e0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 18:15:38 2011 +0100

    Additional hilarious witticism

commit 1864b5b876d5d5d60c0ee6ab0f9696fd736d34f6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 18:13:35 2011 +0100

    Some initial HA design documentation

commit e48006cf4298ec2be31125246cf8f6d669f7da44
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 18:10:19 2011 +0100

    Don't cons inside the tx, prevents us from copying the accumulator on the way into the worker pool at great cost.

commit 04c7af27dbf7a697e07afcd7b5bc8025ae24bac2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 17:03:58 2011 +0100

    Oops.

commit e252f65938afc8be2987866acb2107420f0c9c1e
Merge: 824c9913d 8e5b26a8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 16:54:06 2011 +0100

    Merge in bug24009

commit 824c9913d94154b5db8b117e93d509efd2a2d7d6
Merge: a164bb8c7 2478fe809
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 15:46:38 2011 +0100

    Merge in default.

commit 9500774756bed46b85bb95297015dcb84b1e35eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 15:10:40 2011 +0100

    Specs.

commit a164bb8c72406a9573e1c45072c03c34e841b0aa
Merge: e2760302b 642bf663a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 14:57:26 2011 +0100

    merge bug24006 into default

commit d363b6cf58759d8457799d1917e1bc97b85f5a0f
Merge: 7da385925 04bf045f4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 14:23:57 2011 +0100

    Merging bug24038 into bug23554 and hook slave up to the new apis. Overall, it doesn't save that many lines, but it allows the slave to not duplicate -defines which were also in amqqueue_process, which is well worth the effort

commit 04bf045f42e118e3b19b448730be6b3124b3349a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 14:12:26 2011 +0100

    Abstract out mainly timer maintanence functions

commit 04e758ee287c603ab185373375747defdd4aca1c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 13:56:09 2011 +0100

    Keys not key.

commit 642bf663adb9d4326cc75c6f3a01c5b9882d02d2
Merge: 06392c3a3 8e802f0ff
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Apr 8 13:23:48 2011 +0100

    Merge bug23550 (show direct connections in mgmt)

commit e2760302b51aba3bb807db2ff6e580ba40fa7b98
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 12:55:42 2011 +0100

    cosmetic

commit c9324d7f6e1c591f00cdf034fafb00ca23fb10b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 12:49:52 2011 +0100

    Cut down on reads.

commit 7da3859257cf6860fb742fc21e581bbd504ff6be
Merge: 8221900e4 08bab86f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 12:13:41 2011 +0100

    Merging bug24039 to bug23554

commit e81374724d69d938afb376f9a3a3a2edd6596376
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 12:13:34 2011 +0100

    Improve comment, minimise difference from default.

commit 71ec3860f634bdbd3cb37b1a5304af5087ee7d81
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 12:10:17 2011 +0100

    Go back to add_binding.

commit 8221900e452bb01d1fc61336a1e66656f6f507de
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 12:03:42 2011 +0100

    Extensions to BQ

commit c7ecf0f981f68d61589473b0ae159faae6006693
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 11:41:08 2011 +0100

    Callbacks should come after mnesia writes.

commit 08bab86f1c758eea61cefc5a81242c3e52ec818d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 11:15:57 2011 +0100

    some notes

commit 4e76d023f58295991cdb5c9c1de096f75a6bd3bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 8 11:06:22 2011 +0100

    misc:table_map -> misc:table_filter.

commit 79bbb0a7c29bb4edbcc316c3bb993bca78d2aaf2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 10:27:19 2011 +0100

    Sod it - transactions are too hard to do in mirror queues so don't bother. I know how to do it, but it's horrifically messy, and the margin is too small

commit e80bc94e5844f79f85150e3b1f6a6463be28687b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Apr 8 00:24:02 2011 +0100

    cosmetic

commit 8855feacf6d188872a2abcc1eaa52d7a7a5c280c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 8 00:11:23 2011 +0100

    Well, getting closer. But it's not done yet, and I may have discovered a rather fatal problem with the whole idea of supporting txns in mirrors anyway in that because of the coalescing going on, there is absolutely no indication of when the BQ finally completes adding the msgs to the queue. Thus the only solution here might be to ban coalescing in this case

commit 44efb9f3fb70eb5bf779a87314bd3f9752cecd52
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 18:19:16 2011 +0100

    Well txns are still only half in. But I want to go home.

commit 8e802f0ff0472a7b45f987a421dd46406b715ea2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Apr 7 17:31:05 2011 +0100

    Added tag rabbitmq_v2_4_1 for changeset 8cd73aad181a

commit bf15cfa77017fad71be0aa6cae24c63b3a540991
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 17:29:09 2011 +0100

    Port and rewrite the manpage changes.

commit 30c4917374f4d87e7b93244763c4998741ee03e0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Apr 7 17:28:22 2011 +0100

    changelog entries for 2.4.1

commit 16c2d80ff006839075cf4ebe64b4d4677255a191
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 17:11:07 2011 +0100

    Tracing has very little to do with rabbit_log, let's make it its own module.

commit 17da180f15f55c5ef2f35ad117cfc584bc7188da
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 17:06:29 2011 +0100

    Cosmetic.

commit 4d02f11fcc3c6a52a5e2b4afb07f8420c1793bfa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 16:59:44 2011 +0100

    Cosmetic.

commit 4f9167dbb5625438d9eb1d00c0e221c22a1f2587
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 16:54:41 2011 +0100

    This seems to work fine. FIXME denied!

commit 28065e743d827eda46d32186573d85f67638629d
Merge: 4d7b867af ae329cdb9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 16:17:16 2011 +0100

    Merging bug24033 to default

commit 6f64a454329f97df7d839c9042b54c3b8b678043
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 16:16:09 2011 +0100

    Do loop detection earlier.

commit 4b4e4bfb306d79cb46d0e465a7d2b87e79ad6832
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 15:55:19 2011 +0100

    Grrr. non-maskable-interrupt half way through implementing txns

commit 4d7b867af8bf15f4a8a478d933c8e669cd895dc9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 15:40:14 2011 +0100

    Reinstate trap_exit in channel.

commit 9c93d407b264e0b93c13fb6c7bcf5c5d82ea6b1c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 7 14:30:47 2011 +0100

    make ssl work
    ...and handle socket errors
    
    It turns out that for active sockets the messages sent by tcp and ssl
    sockets to the controlling process differ gratuitously.

commit 3376cc7697174d530058fd4522417bc6037d992a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 13:29:28 2011 +0100

    Add BQ:discard, correct BQ:is_duplicate, finally fix the last bits of immediate delivery, though hopefully in a way which has not leaked through to the lower layers...

commit 66b5fc3789f3a892d373278ecfff531c0c918874
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 13:12:48 2011 +0100

    In a cluster it may be useful to know which node things happened on.

commit fd05e61ba433b0545dd31b0c4e233caad7be200d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 13:01:43 2011 +0100

    Don't expose queue message ID.

commit 92654d7c845f60dd339e03cca7ccef0c35688976
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 7 13:01:17 2011 +0100

    get heartbeat monitor to pause when it should
    On 'default' we kick off another prim_inet:async_recv *before*
    handling the frame we've just received. This is done for performance
    reasons - essentially we are reading ahead - and leads to the following
    sequence of events:
    
    1. receive memory alarm -> change state to 'blocking'
    2. receive a 'publish' method frame
    3. kick off another prim_inet:async_recv
    4. handle frame, detecting that it is a 'publish' frame and thus
       changing the state to 'blocked'
    5. receive the frame header for another frame (e.g. the message
       header, or could be something on another channel, or a heartbeat)
    6. since the state is 'blocked' and we pause the heartbeat
       monitor and *don't* kick off another prim_inet:async_recv
    
    On this branch we don't read ahead since a) that would complicate the
    logic a fair bit, and b) we could end up draining a fair chunk of data
    from the socket, rather than just a frame header. As a result we need
    to make sure the heartbeat monitor gets paused as soon as we
    transition to the 'blocked' state.

commit 8f977fc47b04f9a558908ad7433c8a229ec64cc6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 12:58:27 2011 +0100

    Make the generated messages somewhat more AMQP-ish by mapping payload to payload and envelope to headers. Thus lose our new mimetype.

commit bda3552956f7dfdf56361eb40afffce7a5c7be2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 12:40:31 2011 +0100

    Move the inbound tap to before routing but after validation. Remove queues from inbound tap.

commit 158f5e7a918d1ef5b16a8a9c0cd9fa097d908a15
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 12:18:32 2011 +0100

    Validate_msg becomes is_duplicate, which makes much more sense

commit e72a90c15e86af28d2f94e4ff4767768ba3c2664
Merge: ae329cdb9 cf9ec3732
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Apr 7 11:45:35 2011 +0100

    Merging default to bug23554 (minor debitrot)

commit 5e3ffeb9a8f18153917a89ee1696159eebf631c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Apr 7 11:24:35 2011 +0100

    Tested debitrot; works again.

commit 482d29e30d243ae235ca14b81fc7579ca02a6f85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Apr 7 11:22:25 2011 +0100

    tweak

commit c512615e243de593d4b114a658273d56ba3e5bc2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 17:08:54 2011 +0100

    table_fold -> table_map

commit 4047821b9426947dedd69f8963c4fcfed20411e5
Merge: 88e5e89a0 ae329cdb9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Apr 6 16:41:37 2011 +0100

    merge default into bug23559

commit 30f8a2f2d22a182500364d8e34dfb25baa418fb9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:59:54 2011 +0100

    Damn priorities.

commit 62d4409aca7d52ba76e3fd866afe5bd311786dd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:48:04 2011 +0100

    Acc may be empty.

commit 91b811add533c89c24a59b181e51dd279b4c0ed5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:44:56 2011 +0100

    Matthias prefers this.

commit d6d333829e5a087e58f927ee8bd0a71d78a5349b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:36:58 2011 +0100

    Refactor a bit, and only check rabbit_durable_route if the binding might be durable.

commit ae65bc19d4e11e5d7f61ab6d8660ab26592f11d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:23:04 2011 +0100

    Check the route still exists.

commit 564c485de0d9355b8a55dcb3187ae4651a607cf4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:17:12 2011 +0100

    Check for presence of binding in rabbit_durable_route on add.

commit a3642ecb8f559a7b316741b8796c4d36cb3e8e48
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:04:07 2011 +0100

    No longer needed.

commit f63a204b0e1359572ee7dc5584201a3cfd021d79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Apr 6 15:01:46 2011 +0100

    Split back up into lots of little txs.

commit 39a0d03500351179d771ad80eec8a697ba3ae54a
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Apr 6 14:43:58 2011 +0100

    In progress tweaks to VQ to support returning the dropped message in dropwhile

commit 9b966d0af5da4cc4c52ec583f5de981b1d81ae16
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Apr 6 12:43:52 2011 +0100

    Store DLE arg in the queue state

commit 038aa54e50a6197f4b7546da0e18fa3692a96821
Merge: e292e8db2 ae329cdb9
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Apr 6 12:34:28 2011 +0100

    Merge with default

commit e292e8db2c9437375a2157fd3c7b6c4da0cf1d2b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Apr 6 12:33:44 2011 +0100

    Whitespace cleanup

commit 04fbdc3e510f694e50790dbdbed799230c8be5a1
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Apr 6 12:32:47 2011 +0100

    Add argument checking for x-dead-letter-exchange

commit ae329cdb93b355bc73824d46245a5ee077be1644
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Apr 6 11:33:14 2011 +0100

    It is not an error if the file does not exist

commit 971f321f492308a9b5829fe74af4f753e3ea3aa9
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 6 09:51:22 2011 +0100

    Performant means something else entirely

commit a8cf6693379446de4854c2a27cdda10f373ff888
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Apr 6 09:41:28 2011 +0100

    Added windows service description

commit 16d551e7bf2557fcade264a4675b8233991bc388
Merge: d6d8e6151 36a6847c0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 18:04:32 2011 +0100

    Merge in default and untested debitrot.

commit a3c513313ee067e58f277904a841a95dfe2f9e66
Merge: d6d8e6151 115fc04db
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 5 17:34:08 2011 +0100

    Merge bug24017 into default (again)

commit 115fc04dbc11d4bb92d33c213469cc8db46993c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 16:57:44 2011 +0100

    UTF8strings come back as binaries.

commit d6d8e615121291670f43a1acb7b24fc5fd1378f3
Merge: 90ac3681f 774c13469
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Apr 5 16:12:56 2011 +0100

    Merged bug24017 into default

commit 90ac3681f16f65d7898c6556c8f723cd53a088fd
Merge: cd6405f33 6f3333c4c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Apr 5 14:09:54 2011 +0100

    merge heads

commit 4a5bf947506e1ceb901b4762ede747351314e60b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 13:27:17 2011 +0100

    Recover and invoke callbacks for bindings in the same Tx.

commit eed614baf27f1df28ebd6298949e7807c18f7095
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 12:24:13 2011 +0100

    Recover all the bindings in a single tx.

commit 8d8ad3d258e188acab0c69d3a42541a940cc63ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 12:09:13 2011 +0100

    Revert bc5bcde98866

commit cd6405f33d6b1a87cb7f34eeb4809e88b9c6256d
Merge: e43b99a83 17e129823
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 12:01:07 2011 +0100

    Merge bug 23998 (prelaunch dies with "unexpected epmd error: address")

commit 17e12982394a33a485f6bb280bb1d14b31723025
Merge: e33d6ea4f c045e33e3
Author: Steve Powell <steve@rabbitmq.com>
Date:   Tue Apr 5 11:49:37 2011 +0100

    Merge bug22005 into default

commit e43b99a836f8eec107cc854e8f0a90b304d4339c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Apr 5 11:49:07 2011 +0100

    Remove gratuitous export.

commit a872473afb85129e7918523e38b08505f3eb5df4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 17:07:12 2011 +0100

    Invoke all the create and add_binding callbacks in the same tx.

commit db1c104916171f05947d98c45235d424f4f9c278
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 16:35:51 2011 +0100

    rabbit_misc:execute_pre_post_mnesia_tx/1.

commit 1c3b4e30ea3dc21db7931ce3f5a3518f59af4047
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 16:24:02 2011 +0100

    Split up sync_binding.

commit 7f371eb77e83af037e996b07f581abb558310c6f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 16:14:28 2011 +0100

    Cosmetics / specs.

commit 6f3333c4c116f5644f0271281cf6490eda3f2f40
Merge: ab63e5874 1f531c85b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 15:00:08 2011 +0100

    Merge bug 24020 (rabbitmq-env warns if rabbitmq.conf exists)

commit 774c134695faea0fbfa8bb1ca33be8941e00df8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 14:18:26 2011 +0100

    Reduce duplication.

commit 059b22e655b6e946210dda1a15ec51f6a9fd8e83
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 14:07:34 2011 +0100

    Actually DTRT. Note that this knocks out the is_binary/1 check introduced in 22bf9ebcaebf; however despite that changeset's comment this does not seem to be needed with R14B (or any other release I tested).

commit 1f531c85bcc5fd8dfcf4c4e1fdc1b3d706844070
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Apr 4 13:38:41 2011 +0100

    Warn about config only if new config is absent

commit bd48eb02a172c478eaa74a4ec4b441e292e8ef11
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 12:11:48 2011 +0100

    Tweak comment after rereading it.

commit 8dc1d4c9f66b719e50fd91a43814e2a7e10e4af3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Apr 4 12:10:06 2011 +0100

    Describe the problem. That's half the battle, right?

commit ab63e5874c27a9276ad191605aa8ab73898ce373
Merge: 14027ffde 336b28ebd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 18:12:44 2011 +0100

    Merging bug23628 to default

commit 8e5b26a8e4c6b692c03115141982760b56c8d5d6
Merge: 639edbf41 2478fe809
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 17:40:32 2011 +0100

    Merge bug 24009 into bug 23939.

commit 14027ffdeb9028862d99567fa3de7867ab808f2a
Merge: ab606a30f b92327a35
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 17:29:24 2011 +0100

    merging bug22952 to default

commit 2478fe80910fb07f20cafa80492f1bafffd85274
Merge: 6b36086c0 8118ea9c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 17:22:15 2011 +0100

    Merge bug24006 into bug24009.

commit 6b36086c0735916b62315a72f87682380f0b2eb8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 17:04:40 2011 +0100

    Fix tests again.

commit 43a0d5a5654ab4f0833492d8c5c459d156652b6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 16:55:45 2011 +0100

    Fix tests

commit 6d0227b8d1b6040386928989fd656f56a16575a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 16:48:09 2011 +0100

    QAish updates.

commit b92327a35263a278b6ae9436592dcb7c53685134
Merge: b0f66ae2f 56fee1d54
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 14:17:52 2011 +0100

    Merge bug23997 (R12B compatibility broken due to gb_trees:map R13ism).

commit 56fee1d54286d23eab7b72e85735bcb809223355
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 14:08:39 2011 +0100

    Another read/1.

commit a6b60f850a5b301f174deb03b4620f7f190495e1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Apr 1 14:27:29 2011 +0100

    use mnesia:read/1 instead of read/3

commit 336b28ebda341bcdf6a103840f1e92a33053f29e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 13:19:31 2011 +0100

    'shutdown' is only treated specially if the child is a supervisor (previous behaviour was actually confused on this front). Some minor renaming, reordering, and inlining

commit ab606a30f3a419ad24d0517d28095002178bba17
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Apr 1 13:09:50 2011 +0100

    Unlink before exit

commit b0f66ae2f22e97b5529f226bb896bd80500ed3fb
Merge: d071751fc 84256cde8
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Apr 1 12:31:09 2011 +0100

    Merge bug24007 into default
    
    'rabbitmqctl wait' can wait forever on broker failure

commit 639edbf418c53a82615f1937e52aff86a71d5e9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 12:25:20 2011 +0100

    Oops, missed this one.

commit b88ad80e099704656246b6e21845a15e6f967c98
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 12:22:42 2011 +0100

    Revert to trailing whitespace et al to reduce diff to Erlang's supervisor

commit ea8cefe18293f93f0d07354f87ee64be81b7f9cf
Merge: 8118ea9c7 bae88c488
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 11:55:08 2011 +0100

    Merge bug 24009 into bug 23939.

commit 20710489718efdf22412bb0316957719f0783059
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 11:47:06 2011 +0100

    rename

commit a66a96ed25d2811f500efa84c06a38ca97ac8a98
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 11:46:23 2011 +0100

    greater than

commit 0101c4d1b3057b41eafff74d6562771641ac1a2f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Apr 1 11:40:17 2011 +0100

    Well it's almost hypnotic in its ugliness. Pending nicer fix from eldorado

commit 8118ea9c727e9c46bfc9deb5ef651ed5a42cc557
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 11:31:34 2011 +0100

    Make things more symmetrical. This adds extra rows into the semi durable table for bindings from transient to durable exchanges, but since we recover bindings based on exchanges and queues recovered this should not have a visible change.

commit 7fc7f4ad96ca8198ddcc978fd5b54d26b1d0448e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 11:07:51 2011 +0100

    Dest -> Dst

commit 3c7935e50c7fa405995111ba865e10a239ba7b8a
Merge: 984611b15 31fdad341
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 11:04:42 2011 +0100

    Merge bug 24006 into bug 24009.

commit 984611b15b0bf6c8dfd27f7e306f097d7b4fe2d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Apr 1 11:03:52 2011 +0100

    Use names, not exchanges / queues.

commit fb13ca8153d60c07594af01e11972fc4dbd74f3b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Apr 1 04:06:07 2011 +0100

    fix some R12B-5isms

commit 31fdad341bf5d1f7c6614b846cdf62e13c8b11c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 17:54:19 2011 +0100

    Introduce rabbit_semi_durable_route to kee bindings between transient exchanges and durable queues alive if the durable queue is down.

commit ba9a86b9d50720ee6ba891a889ecf4ab20399275
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 31 17:38:29 2011 +0100

    Slimmer gatherer termination

commit 5b0057b578fc990dd76d4e859243069ac87abb78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 16:25:43 2011 +0100

    Recover e2e properly.

commit 627667f963c0adaac2a0d9dea653833332af4b9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 16:18:42 2011 +0100

    Fix tests.

commit 3b311e9cbb3c4f6d3031ab6ee5c6757c18d3d1cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 16:04:41 2011 +0100

    Unify recovery into one boot step, based binding recovery on the queues that have been recovered.

commit a951c56623d89a5a5769a9c9bbfeed5f6af407ea
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Mar 31 14:59:46 2011 +0100

    reverting previous changes; treating {shutdown, _} exit reasons the same as normal in supervisor2

commit 84256cde841fe85e8155f3e385db5379b4e08014
Merge: a2b490f31 e40ce1bff
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 31 13:27:29 2011 +0100

    Merging bug24008 to default

commit b0277b0d617c5d6050f0a3e6aae3c271be9c3c58
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 13:25:18 2011 +0100

    Oops.

commit e40ce1bffab30d2959f441a66c899ae222839a1d
Merge: 197b263d3 6055c9897
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 31 13:15:10 2011 +0100

    merging bug23968 to default

commit 4fa5c3309ebc119b35f3a6f6c9c5e7d5eadaf5ee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 13:08:50 2011 +0100

    Only recover bindings that are to exchanges or to queues that are on this node.

commit da2bd58438daf6e72acf7ec82a11770277474fdf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 31 12:43:08 2011 +0100

    Change exchange type API to not distinguish between creating and recovering, and to allow recovering bindings. Recover bindings when needed.

commit a2b490f317fa76876fa26339502c09f6ba1b0cba
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Mar 31 12:07:17 2011 +0100

    Don't transform markers when upgrading messages

commit 7d682827afafcfadafa8b24ed5513fbe8d747e4a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 15:31:45 2011 +0100

    Only recover exchanges and bindings that need to be recovered.

commit bae88c4882efc2790d46baf8743fb6d358a1a98c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 14:22:42 2011 +0100

    Correct comment.

commit d7938cad8df1662013c9535018796b3b2ebe024f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 14:12:05 2011 +0100

    Call the field next, not serial.

commit d071751fc4498d3ac69abe78af00d9703bb5dbc8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 14:06:52 2011 +0100

    Make sure Attempts does not go negative.

commit 06392c3a31d16b16320e6e2ef9ee9ab48b1ffafb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 13:55:33 2011 +0100

    Add space

commit d6e31decab7372ba430e18098bd19e3d565fae4e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 13:50:36 2011 +0100

    Mark network connections as network.

commit 197b263d384d5344ea03feacd29b2430da807d5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 30 13:38:07 2011 +0100

    Make rabbitmq-server compilable.

commit e8a4442c93f5d78eb7c9c83f88a76bb2ddc73dba
Merge: 454e615b0 96c3724eb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 30 14:29:16 2011 +0100

    merge bug23993 into default (OCF script is broken when specifying an alternative config file)

commit 96c3724eb02795e9660b1924153abca2fad8a048
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 12:45:54 2011 +0100

    cosmetic: put 'rabbitmqctl wait' code in the right place

commit 068ce28bc9fa95e4213f2cba21ff6776c51a005c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 30 12:36:38 2011 +0100

    Shutup, dialyzer

commit 056f5467c9778017c97939ee7a911cffaa99cce9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 12:15:20 2011 +0100

    cosmetic

commit 065f2e7596ab1e27669c05c0b0be9469376f6559
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 12:11:06 2011 +0100

    cosmetic

commit c8d207b631931c5b4f40399dabd91e2cad428de7
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Mar 30 11:47:30 2011 +0100

    adding reporting exception to supervisor2

commit 091226b7427f84616a76c4f41d235655e6044f61
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 07:43:22 2011 +0100

    cosmetic

commit b87e60aa95b9e11fcdf11b1ec86a2644125135be
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 07:40:55 2011 +0100

    simplify: rabbit_misc:const/1 and thunk/1 types are identical
    get rid of former

commit d3f5f90e93b39a957a04aa1439b6a253f402e4c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 07:27:20 2011 +0100

    consistency

commit e33d6ea4f6034a27e5719bf425458be1496dc819
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 07:21:21 2011 +0100

    cosmetic

commit 009bd1a5669f880f2a8f06367f0f7e86e0c6238e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 30 07:20:43 2011 +0100

    test refactor: mock the writer only once

commit 00c05cefd4ac8391197b1fc097a6502dba29bb66
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Mar 29 20:58:52 2011 +0100

    remove R13isms

commit 1c90833a81267e602011eccf174fe0afcc05fdca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 29 19:17:57 2011 +0100

    shrinkage: one dict is better than two

commit 749d25fec0ac5ea4904a338124668345cd97529a
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 29 17:52:23 2011 +0100

    Finishing touches.

commit b0ce6e09510a93ce09c509c7bc7b99a057038245
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 29 17:36:55 2011 +0100

    cosmetic

commit 03615befdb771d99de0373a3fb893acfc18b6550
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 29 17:31:46 2011 +0100

    Matthias doesn't like mentioning the port number.

commit 487f4aeb7039ccc0ab0bd3203a4d6d5b5337195a
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 29 17:08:50 2011 +0100

    Slightly better explanation for some epmd errors.

commit a4966a7fee353f782aaff9fe15fe6ae226de6307
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 29 16:03:36 2011 +0100

    cosmetic

commit c090ba70ebcc9651ad728809f9f1b0ebe26afa0c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 29 14:11:19 2011 +0100

    Avoid using file:write_file

commit cf9ec3732fd38afd0afc7a1738ba4607c21694ab
Merge: 625dc7f1a e3992edc4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 29 12:59:49 2011 +0100

    merge default to bug23554 (minor debitrot)

commit e30a0da5d9c5bcae836fda4726b9731e9c679941
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 29 12:18:51 2011 +0100

    err...

commit 09efa314c122db7c50ed20b86c76f7013b089b97
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 29 12:14:03 2011 +0100

    Dialyser

commit 042b3237005be68d2f6b9062dffb9456edfe2df7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 29 12:01:30 2011 +0100

    Go back to serial/1.

commit d5afad7006a4d1dcbdec5ea83e02ee7cc938f7a6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 29 11:29:13 2011 +0100

    Don't attempt to provide a serial for the x deleted event, we weren't doing it right anyway. Create the table entry at exchange creation time.

commit e3992edc4eaac0955fcb63012e7eed59596def1e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 29 11:27:29 2011 +0100

    english

commit 3a7a409084c522cd94d74fc251a3a5b11fbe690e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 29 11:25:21 2011 +0100

    Improve documentation of BQ concerning the issuance of confirms

commit 6799d3db48f1de761ce32b2a0e3f14c5fde2eb5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 29 10:31:34 2011 +0100

    Fix Matthias' deliberate mistake.

commit 4501e6ba879c9238f3960816cf8e7e5b8f6cf204
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 22:13:57 2011 +0100

    index the serial dict by XName rather than X
    ...which should be more efficient

commit 530884ca4d82fb3a8bb1b34d0f080d8ccf4ca4b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 22:11:42 2011 +0100

    refactor: make add_notify do what it says (and no more)

commit e4e03158caa055262dbedfa2fb41192f4c73ad49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:53:40 2011 +0100

    cosmetic

commit 88efae2302666e55fc2899bb66649db2f5ec8bbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:47:45 2011 +0100

    refactor: move all serial manipulation code into 'exchange' module

commit fe03a19d205359632c1c9ee72b8723dafc475ecf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:46:30 2011 +0100

    only look up exchange type once
    ...and fix a bug in the XT:create invocation - the serial wasn't being
    passed through.

commit 90f38d507ed6e63f5e358453319f67d816156199
Merge: f1aceb7b0 e52c5e65e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:25:58 2011 +0100

    merge default into bug23939

commit f1aceb7b0a69c039f36109d2a5401a85548f1355
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:25:43 2011 +0100

    cosmetic

commit e52c5e65eea60e770631d80735cc1bd63d56c12b
Merge: 1c2cfb95b 4e16d0c2d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:20:46 2011 +0100

    merge default into bug23939

commit 1c2cfb95baaf6654360c6156776ec6e5a9606a77
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:13:36 2011 +0100

    tweak: only invoke rabbit_exchange:callback when absolutely necessary

commit 875063641da99fd6cca1762ca2c50ef087fd32f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 21:10:20 2011 +0100

    more sensible order of exchange exports

commit 4e16d0c2d08c7ba8935427afcf215de7cc838a7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 28 20:43:32 2011 +0100

    cosmetic

commit a28a23b0006461281476977dc44dee814ef08ddb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 18:08:41 2011 +0100

    Cosmetic: move serialise_events.

commit e20fff39da1e63744b76d889c99121c5aa3ddaf5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 18:06:44 2011 +0100

    Comment.

commit 81508789e91cc2ca55f6786b98f0f18517070c69
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 18:05:40 2011 +0100

    Cosmetic. I'm sure at some point Prev was used for something.

commit d29143347e11f2326843bd2b6145e1fa99eff077
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 18:04:38 2011 +0100

    Cosmetic.

commit 7948bdc2920c623ab0b56d421274b9aa638674b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 18:02:53 2011 +0100

    Better abstraction.

commit a319d55f6e56f3d299a53d9d40c335494ba17b1c
Merge: bf8ce0fea af5527ddc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 17:55:14 2011 +0100

    Merged heads. Need sleep.

commit bf8ce0fea66777c6202eead4586876fa970ccb2c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 17:54:01 2011 +0100

    Cosmetic.

commit 6055c9897ccaf2db61c5f6a31478fe3911755f52
Merge: b6cc126f3 68f615b27
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 28 17:41:52 2011 +0100

    Merge default into bug23968

commit af5527ddc6f9069c99b7047c966775d6be8b30e9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 16:41:43 2011 +0100

    Fix on_node_down.

commit 0b639b478d5144373df007fbf63195fe59987222
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 15:46:52 2011 +0100

    Simplify a bit more.

commit 241d1072358daa2824ab67de028ab862a2e0d578
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 15:41:19 2011 +0100

    Make the tail fun in execute_mnesia_tx_with_tail *only* get executed after the tx, and roll other uses into the tx fun. This is rather simpler hopefully.

commit 3ce10894acda38fb92494d91196e2166faa7bf9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 14:16:55 2011 +0100

    Unify funs, cosmetic.

commit 01ded2fc76edede3e241b59c3abc4c218dce2211
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 14:16:39 2011 +0100

    Oops.

commit 3d3e85021bed87a9ecaf5c480d9309f88a44ff1d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 13:35:24 2011 +0100

    Make serialise_events into /0, don't call it via callback/3.

commit c9fa97452653795ba47467575d9de2a12cdecc98
Merge: f7eba489c 68f615b27
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 28 11:55:05 2011 +0100

    Merge default

commit 454e615b02e949e58f48604af1f7a82a362e87cd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 25 17:33:07 2011 +0000

    Correct test for existance of config file

commit 68f615b277cf1c7cbfd548afcd9f6534203a681a
Merge: f2eae25c2 9b1e99e3c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 25 13:09:38 2011 +0000

    Merging bug23831 to default

commit f7eba489ce5d05610d6021b5d41b9523fae33c71
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 25 10:27:22 2011 +0000

    Shorten name for alignment reasons.

commit f8b346795475c63bcf6b9d289bf57af6a77c6ada
Merge: 9b1e99e3c d055ecafc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 24 10:46:34 2011 +0000

    Merge from default

commit d055ecafc5ca06b046fe583ee1d48191cf8bd0d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 24 10:45:04 2011 +0000

    Fix for API change

commit f2eae25c28f74f492e417991188da904c3d672cb
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Mar 23 20:12:03 2011 +0000

    removing trap_exit flag in rabbit_channel

commit 9b1e99e3c1520798e9b8ca796d7a3bc53bf2ff55
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 18:06:16 2011 +0000

    cough

commit f60d9c3e857415978806d797b3f236c7ed00be44
Merge: 7325ee2db 0d41cf362
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 18:02:13 2011 +0000

    Merging bug23425 to default

commit 0d41cf3621a9d52ba769a59dd62d982f5c5d9748
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 17:23:12 2011 +0000

    Turns out it's very important that we do write the schema_version when call mnesia:cluster

commit beaaec77b432e5ac05cb5945520db466838d3df5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 17:08:19 2011 +0000

    Abstract out continuation

commit 7325ee2dbd472a7a90fb255afd370447d234cf7d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 16:50:28 2011 +0000

    ARGH! Trailing line

commit 52918e9da3964cf602499f75d420355e5451dd5c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 23 16:26:33 2011 +0000

    cosmetic

commit d104d08ce2102d45fe8d7f2e4b8ae090ace6c5da
Merge: 94c4c96e9 4cababc13
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 16:16:50 2011 +0000

    Merge bug23937 (logs events published in exchange amq.rabbit.log have no timestamps)

commit 4cababc13f7e9fc4bde80e1ff78b9e9dbd791046
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 16:16:23 2011 +0000

    Explain

commit 4723655935c0a6bc0439d586040ecc9a3d1dbafd
Merge: 6c9d66343 8376163b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 16:06:15 2011 +0000

    Merge heads

commit 6c9d663436f8b739f35e71ff88c12bd4251e5280
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 16:05:04 2011 +0000

    Record all nodes, don't list them when we refuse to start.

commit 335cbed6f5a5d4342511ebdfe1033f5bec237e1d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 23 15:34:23 2011 +0000

    Switched to now_ms()

commit 70909e0d2e0cec7decfadf569b4fa7d85642b693
Merge: 94c4c96e9 8ee219843
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 23 15:32:19 2011 +0000

    Merge default

commit 94c4c96e9d22a8b5bd36cb13717cb5f1d94cbd61
Merge: 2bb72661c 6e49cdf15
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 23 15:31:13 2011 +0000

    Merge bug23972 into default

commit 0c7eba3c836953a4fcf722bbbe6f376ee2ef5956
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 15:26:49 2011 +0000

    Only return the queue the second time round and thus don't call XT:add_binding(#amqqueue{}, ...).

commit e072f8017605a52eab069a4eb8415f5dcf7a3097
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 14:44:11 2011 +0000

    Since we use callback() to call serialise_events() this can now return a boolean(). It's probably nicer to add the type here than add another function.

commit 5f05e16a74a05c9965a3e757980d564ae2204d43
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 14:43:30 2011 +0000

    Correct types.

commit 8376163b97b5228c46cbd2322894a265729ff829
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 14:40:57 2011 +0000

    Detect discnodeishness prior to suffering disclessness

commit 3db4250be38d07a05a7202b12351c692d6764d54
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 23 14:11:09 2011 +0000

    Do an impersonation of the serialisation thing for create / delete. Since the counter resets after delete this doesn't solve the problem but it makes the API cleaner and maybe future-proof.

commit a21745ecc4d397fc51f3be3e0d1a7e8f49b27467
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 12:11:01 2011 +0000

    sort out how often and when we do the rabbit:prepare (set up log handlers), and actually make that do the mnesia upgrade.

commit 9ace75dd89479ecdfaac1d3355ca66255462f2fd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 11:53:59 2011 +0000

    New decree is that you're not meant to match against ensure_stuff calls

commit 2924e7842c872591e1eab3c73c4dc74d4fdad565
Merge: 2bb72661c c03ef2a0b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 11:33:53 2011 +0000

    Merge default into bug23425

commit 6e49cdf15409d1713510d4083d2642c418ac2bd4
Merge: 139e3ddd4 2bb72661c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 23 11:26:39 2011 +0000

    Merge with default

commit 2bb72661c529cc5dd233a9bef8f4cfbf40fb8733
Merge: aa13f7a8d 0c40701b7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 23 11:04:11 2011 +0000

    Merging heads of default

commit 139e3ddd401404190f58922fb9eae9838a5d0d89
Merge: aa13f7a8d 4ba94e18c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 23 11:00:46 2011 +0000

    Merge with default

commit aa13f7a8d638e0b4bf1c6b80a1ef527fa8db7a06
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 23 10:11:17 2011 +0000

    Added tag rabbitmq_v2_4_0 for changeset c4f487dab865

commit 14c5a4bdbb84f7bc3c66d402af95981f10df264c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 23 10:10:31 2011 +0000

    2.4.0 changelog entries for debian and fedora

commit 0c40701b76a01a0daed46f6b1fb6ef4326c83c31
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 22 17:52:19 2011 +0000

    cosmetic(ish): no need to match the return of ensure_*

commit c03ef2a0b1b301a2f2cb5ef943c12eee100db9c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 22 17:44:39 2011 +0000

    Renaming bits and pieces for consistency and checking a few more return values, plus other minor fixes

commit 625dc7f1ac9147ec67c6534cee89a7c1e3105b3f
Merge: 640ef6c81 79d0c65ec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 22 15:34:03 2011 +0000

    Merging default into bug23554

commit 640ef6c818d73244ac0032e4dea7c80f223e8cdd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 22 15:02:33 2011 +0000

    Enforce a bunch of returns

commit c668b6175d7749567c71ef53928386982fa4ccd2
Merge: a6918e73a bbd5d5993
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Mar 22 13:42:23 2011 +0000

    merge bug23730 into default (Make Debian packages depend on "erlang-nox" metapackage)

commit bbd5d59934f41cc57d341bd106abe566db8dd30f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 22 12:39:48 2011 +0000

    Switch to erlang-nox.

commit 2a20c45a7c2a2c0740780e4587a5a726b5ea77e8
Merge: 6413bd76c 0a2bd3192
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 22 12:39:27 2011 +0000

    Merge from default

commit a6918e73ad3dbc7084ff571f9a4e0808a16574fe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 22 12:39:04 2011 +0000

    clarify documentation (thanks Emile)

commit 4ba94e18c6e363d3592b5db9abb7d8eedf427a3d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 21 17:57:54 2011 +0000

    Introduce batching (again - same diff as 5f7d8d07f94f)

commit 0cd4e2f3dd031100103598398f9abcd2de6d0afd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 21 17:56:34 2011 +0000

    Add test

commit daa382587bb1f49ed6a0ce6b9e3ec0bf1d34256d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 16:54:09 2011 +0000

    Better name, vertical space.

commit 5a43845743ff94f6fbf045ea5f23be07b1c52181
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 16:51:34 2011 +0000

    When upgrading a secondary node we call init_db twice: once early to force a cluster rejoin (at which point we are not ready to do local upgrades, e.g. fhc is not running) and then once at the regular time. Deal with that.

commit 542707dcaa0b1562f18512cddc5f3a4ad90ea68d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 16:42:36 2011 +0000

    Don't try to determine whether a backup is needed before doing anything, take it as needed. This inverts the backup and the lock file - the backup now comes first and the lock file is only used to defend apply_upgrades/3.

commit 570e408c79de3593b21955e3901cec8b216541fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 14:28:34 2011 +0000

    Oops.

commit 0e112d9f52d032bd1e555fc6a3a7180abc32c71f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 14:22:51 2011 +0000

    maybe_remove_backup is safe when returning version_not_available since we would not have taken a backup in the first place. However, this is not exactly obvious, so let's not do that.

commit e4629e618b6605d135fa1b0c1f64f558127797fa
Merge: ff126e64d 68042fac6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 14:01:02 2011 +0000

    Merge heads

commit 68042fac63bad913aa46fda6ed136b9877e1b7e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 14:00:31 2011 +0000

    Various QA tidyups, and stop exporting the backup / remove backup functions.

commit ffc18269b13851202955ec1936b73504a42216bc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 12:27:02 2011 +0000

    serialise_events should take an exchange really.

commit c045e33e387fc9a91203596363207192ded64060
Merge: 6413bd76c a11ad4dbc
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 21 11:08:54 2011 +0000

    Merge with default

commit 6413bd76c15d871b502cd6489547c0b5b3019238
Merge: 782e33786 c528d4702
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 21 10:58:26 2011 +0000

    Merge bug 23963 (rabbit_exchange_type:delete/3 only called for non-autodeleted exchanges)

commit a11ad4dbcd41b173e5eb19c3019e1afd1a58f2c7
Merge: 782e33786 5452d4940
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 21 10:58:00 2011 +0000

    Merge with default

commit ff126e64dc7ab85e480bb41f8f27e46bdea7e63b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 18 17:57:04 2011 +0000

    Well I thought =~= was beautiful and appropriately approximate to ==

commit 838b2ccadf62b8a1352d19556d0de802f4c3df31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 18 16:50:44 2011 +0000

    Probably makes sense to remove the serial number on delete.

commit b6cc126f3c1b4bbf3a4c60aec074067cf0bf2b31
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 18 16:45:53 2011 +0000

    Rip out dedup cache

commit 03975f2f5d76a0025a71b100f30b5c55eaf1d049
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 18 16:36:02 2011 +0000

    Rip out msg_store:release

commit 9839718a3ae169c4a1c6cb19f0d5674d68cf9f63
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 18 16:15:39 2011 +0000

    I think this is tidier.

commit 677c308f8d96957af98a67e203abdaee329e09e4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 18 13:38:20 2011 +0000

    Take a single backup before any upgrade, remove it when we're all clear.

commit 79d0c65ecf9a016288c7cf77e76f03a7107538d2
Merge: 782e33786 bdfd91590
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 18 12:53:27 2011 +0000

    Merging default to bug23554 (minor debitrot)

commit 00e23d294cf69e0f7e1f6f149f6d5cdbd9c59841
Merge: 2107f764e 4ce9edcda
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 18 12:16:33 2011 +0000

    Merge heads

commit 2107f764ee34b8cd309e3226175b68a8dc214b98
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 18 12:15:51 2011 +0000

    Ensure mnesia is stopped for the local upgrade backup.

commit 782e3378687073d89ac4fd855713c43c1d5bda95
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 18:02:50 2011 +0000

    cosmetic

commit 97b22cf0fb6678c13e6b3ddb922a5c79f0635447
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Mar 17 17:57:38 2011 +0000

    Not 100% beautiful, but this gets serial ids into the hands of add_binding and remove_binding.

commit 4ce9edcdab9ecef06a552754bb453c4a841ceb8b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 16:53:15 2011 +0000

    Can't call =~= with non-version args, thus shuffle things around a bit. End up saving a line.

commit eeda0bc1acd1be613c636a041b76dcce0b9b938a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 16:37:54 2011 +0000

    Improve symmetry: if we write the running_disc_nodes on rabbit shutdown, we should nuke it on rabbit startup. This then means that the prelaunch thingy is always run with the previously_running_disc_nodes file present. I believe this makes no semantic changes, but the improved symmetry is worth having

commit 3b05ad9f71030f8f9ee3a571cbe8ec1c7c88c2d4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 16:26:25 2011 +0000

    rabbit:stop() is not always called when rabbit is stopping. E.g. q(). doesn't invoke rabbit:stop/0. It does invoke rabbit:stop/1 though.

commit c528d4702492171370163473d10e164e07d718e6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 14:53:30 2011 +0000

    Make code prettier

commit db36c19f6504dbd1b9d2c1cf0bef30102d8778f9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 14:41:03 2011 +0000

    Make sure we record if an exchange is actually deleted...

commit d1863a3d017a7991457c19b5daaf32abc56c6fc4
Merge: 9168aadf2 bfa8dae74
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Mar 17 13:45:54 2011 +0000

    merge bug23942 into default

commit 9168aadf236b0110b1637ed76b12bc45dd012ddf
Merge: 1119229e9 f4ddca7d3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 12:01:57 2011 +0000

    merging bug23929 to default

commit f4ddca7d3180bfe2531c318492f4c5d24f5d9f7d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 09:34:13 2011 +0000

    and again, _don't_ record confirm on immediate if we don't deliver...

commit c5c260889317964b7a64d9e1c7908704e30f456e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 09:22:03 2011 +0000

    If we have version_not_available, then it makes sense to have version_mismatch, not schema_mismatch

commit deab5f46a2d80a96032ecafe986b17b7850296a0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 09:17:27 2011 +0000

    renamings

commit 7a90ae91ae48760eb003d467061d8d7296d71d0c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 17 00:52:11 2011 +0000

    incorporate qa feedback. The version.erl api is rather nice now: the version itself is entirely opaque - whilst it can be read, there's nothing provided to decompose it at all.

commit 5cbcdeb49c1d4bae70ed84dd41d83e4e4186c66d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 18:13:19 2011 +0000

    ordering

commit 1c6bff022cbb449ddb2ecbb5894b521f2d87426b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 18:02:15 2011 +0000

    english

commit f68bf93024fb3539a3068bdd79b148bf29786472
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 17:30:30 2011 +0000

    Abstract and rewrite schema_version handling functions

commit 89125ebb4f5398283cb9c58b637197b1a0493250
Merge: 1119229e9 daac7b013
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 16:03:39 2011 +0000

    Merging default into bug23425

commit 1119229e931dfd737984a52ac7df0f8aad71a70d
Merge: a63fb66af 9b5324703
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 15:29:51 2011 +0000

    Merging bug23263 to default

commit 9b532470380d5eca206dd5908eb72401889c3b38
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 15:16:49 2011 +0000

    cosmetic

commit 23d18d56c8a9ec6e12410038253c090b817ae293
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 16 14:29:58 2011 +0000

    Say "ConnPid" everywhere.

commit 894201a627dae3aec33648d047bafa85d9cf9567
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 16 13:37:21 2011 +0000

    How could I forget those joyous uses of channel in tests?

commit 4a7629c42203c81a337b6192915ece861fe99022
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 13:36:31 2011 +0000

    refactorings

commit bfa8dae7425e9aa1701b3e7a26359774300620c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 13:19:03 2011 +0000

    minor refactor of test

commit bdfd91590c0882021b40fe1817eaee4dc42c7935
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 13:16:30 2011 +0000

    whoops

commit ad4e7d507d9a62abde77f4af90cc2f0899ef92ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 16 13:15:51 2011 +0000

    Try to make this branch vertical space neutral. Sadly we can't do this by planting a vertical space tree.

commit 1b5da479d8cdd8a894763e36ec049b716156d422
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 16 13:12:37 2011 +0000

    Use the correct connection pid for exclusivity (and error logging).

commit 2bd132d6f1d8e06adb8dc00cce06c6272b29030c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 13:08:22 2011 +0000

    A different and largely opposite version of 'never'...

commit dc358ded2a2012d59161fa99d0d3f6b9373a31a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 16 12:58:11 2011 +0000

    Transplant reader_pid vs connection_pid work from bug23350.

commit e144a091d293a8b3f20720e777aac53406c5b088
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 12:44:13 2011 +0000

    Made gm do batching of messages. This has an astonishing performance impact: if every broadcast msg to the gm results in network activity then performance is low - presumably serialisation of, and network broadcast of small messages is very inefficient. By batching broadcasts and then sending many on a timer, performance is much much higher.

commit c6f4647119d387f32e713ab016d5bcbf60ba7bf9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 16 11:19:17 2011 +0000

    refactor

commit de473d29cb982244e466397bcbebb0fc9412d685
Merge: aae598c91 a63fb66af
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 16 11:05:20 2011 +0000

    Merging default into bug23554

commit 9613266a92533c5e3795513e59445bd2dad13041
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 16 10:58:31 2011 +0000

    don't record anything confirm-related for immediate unroutable messages

commit a63fb66af50915d9b547ee201bae6a13242afdc7
Merge: 01d369cfa 7ee6739a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 16 10:09:59 2011 +0000

    merge bug23949 into default

commit 7ee6739a3d06fb4e7c3b89d0159e9a8a3a8ab9e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 16 09:20:37 2011 +0000

    cosmetic: more consistent naming of constants

commit 8ab10f24efe3f856dc6b45393a041f6c8ba70ee2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 16 09:06:46 2011 +0000

    avoid sub-binary construction of tail
    and some cosmetics

commit 00561dd4a766a77a5ece09044f055df8154f5c15
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 16 07:44:29 2011 +0000

    cosmetic

commit 01d369cfae6aab49a96879e5386329d0937ab3e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Mar 16 07:18:40 2011 +0000

    cosmetic

commit 925628824d471f17f2ca7e367d0948fc2a7d9bc3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 15 20:00:56 2011 +0000

    inlining and some minor refactoring

commit d321c516aed26923154997303717bbf14f42fc10
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 15 19:26:15 2011 +0000

    initialise #connection.capabilities
    - not strictly necessary, but good form

commit b31bc7927d46eb3eeb89250a86dacab0d55989fd
Merge: 819b5c162 f424d34e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 15 17:25:45 2011 +0000

    merge bug23948 into default

commit f424d34e56d68d34938f386134a59ae48326ae2b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 15 17:21:19 2011 +0000

    cosmetic

commit 6a9d484c021f26c4c540fd5ccf3324ab9668cf15
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 15 17:00:28 2011 +0000

    Read segment files in one go

commit 50e616c15f50c793ec8c37e4e20009b363b8a18c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 23:48:35 2011 +0000

    Ensure we hit both branches of fhc:filter_pending

commit 6d9925809d758882bef71dd7f50b986bde82de43
Merge: cd9402896 dd9651cd0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 23:42:49 2011 +0000

    Merging bug23948 to bug23942

commit dd9651cd08c840cd5067154b9f8c438ab891de04
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 23:34:29 2011 +0000

    fix

commit aae598c91b40228334b8c4636753821ac8cd26d3
Merge: 819b5c162 d29f522eb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 20:44:56 2011 +0000

    Merging default into bug23554

commit 819b5c1624a4f8b07eafb4c382e25e3153c37dfa
Merge: 25575df4c 3dac29009
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 14 19:28:47 2011 +0000

    merge bug23946 into default

commit 25575df4c3626944935c4d1e11c2f66ce1fe7d7f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 14 19:28:20 2011 +0000

    cosmetic

commit 3dac2900967aa2a6f9e78164f29ec4ece06d60e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 14 19:27:20 2011 +0000

    cosmetic

commit 84102019795bddd7d42f9bc01e6abea4813fef78
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 17:55:47 2011 +0000

    Start the GC before we rebuild the index, and store it in the State

commit d29f522eb48119b25af21e4c4c665a7b48fc61e1
Merge: dafce92cc 0f78a913c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 16:57:10 2011 +0000

    Merging default into bug23554

commit dafce92cc24ff7f0b47b3d28be758ea7fa052c05
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 16:56:52 2011 +0000

    Whoops - add missing catch case which I just hit in testing...

commit 0f78a913cec7e77f1ce844e25e118343a7b32f39
Merge: c1c5de621 f4faaa8b8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 16:54:23 2011 +0000

    merge default into bug23554

commit f4faaa8b865e68028782058639347337757e9823
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 14 12:09:43 2011 +0000

    more docs

commit cd9402896a7158424fa6751777b66dbb3809f900
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 12:05:04 2011 +0000

    Adjusted test to hit code path

commit d3ff663d65e9fdace3668903b55197c9bcb971bb
Merge: 71a642331 bba11517f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 14 11:56:35 2011 +0000

    Merge bug23882 (unnecessary coupling and implicit contract between bq and amqqueue_process).

commit 71a642331c10f4d4bce0862859e030d3623ffe97
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 14 11:51:26 2011 +0000

    I didn't think that implied that it could *only* be used out of process, but let's make it clearer.

commit 5a72a15010aea8197907663aca25a0ea716f1804
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 14 11:43:15 2011 +0000

    I think this makes it more comprehensible. To me at least.

commit 5bc69e976ef20a9bd2a53c92a134ec342ab443ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 14 11:30:23 2011 +0000

    Maintain an acceptable level of code quality.

commit e413f6029a199c1906e5c60f7de1f4fd0cd1cccf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 14 10:48:28 2011 +0000

    Fix

commit c1c5de621a572768383ccc78f5a2ff58ff40b7aa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 11 17:19:24 2011 +0000

    Make slaves rejoin on boot

commit 8504d1c5fd80b6c246102158f6cb8885778d8712
Merge: 1721a5ebc bba11517f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 11 16:21:35 2011 +0000

    Merging default to bug23554

commit 1721a5ebc1160fae927d72be21278eba2d3c28db
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 11 16:21:05 2011 +0000

    Make new mirrors magically occur when set to [] and a new node in the cluster appears. Fix various other bits and pieces

commit bba11517f66b618bf9d07159ee6d1c3588917e41
Merge: d892d83e6 95d6b971b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 11 16:06:41 2011 +0000

    merge bug23885 into default

commit d892d83e6d4ef2f0f09195be92bad61ff4166e53
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 11 15:50:12 2011 +0000

    Backed out changeset 2ac4e46ab7c0
    changing the lock kind may have undesirable effects in a concurrent
    setting. The efficiency gains don't justify taking that risk, at least
    not without further investigation.

commit 95d6b971b4b9ff39cd242d29828932a15c26147f
Merge: 5452d4940 db0bdf3cd
Author: Steve Powell <steve@rabbitmq.com>
Date:   Fri Mar 11 14:45:46 2011 +0000

    Merged bug22005 into default.

commit 8ee2198430e5a0739575a9808833eaee86d568dd
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Mar 11 14:06:21 2011 +0000

    Add timestamps to error_logger messages

commit 6785ac3db7bcb5e926310a54e3273be1530a756d
Merge: 30d7890f0 db0bdf3cd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 11 12:28:32 2011 +0000

    Merging default to bug23554

commit 30d7890f09844744739c2702b5743b50a58e8ab4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 11 12:27:33 2011 +0000

    Add ability to dynamically add slaves

commit 254e3d88dc4e2c6b9ef3e441529565644ff1295e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Mar 11 11:29:54 2011 +0000

    Take write lock when counting records, reduces the constant factor during delete

commit 264f4dfdae771b81ee082eff1021a5264922768e
Merge: 99b329075 db0bdf3cd
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Mar 11 11:25:32 2011 +0000

    Merge with default

commit db0bdf3cd42511b0191a5765fdbcb4507715b638
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Mar 11 11:23:49 2011 +0000

    Merge bug21647 (allow consumers to be informed of queue death)

commit 7cbe4b8cbc5ecffd8e88186a2f4d7bf8d56f8040
Merge: f7a0fcb48 45c07a350
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 17:11:35 2011 +0000

    Merging default to bug21647, again.

commit 6f051b2e788e64d3cf688c16a2699a0b582371a0
Merge: 7f5fcc545 45c07a350
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 16:57:34 2011 +0000

    Merging default into bug23554

commit 7f5fcc545db0f4b773bbd002f53017906753188b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 16:30:53 2011 +0000

    Remove erroneous loss of state. Whilst this now can cause a memory leak, it only affects the master, the dict is not particularly rich, and it'll only be left with entries for dead channels (most likely channels that were on the old master). Also, we might very well be able to address this through other means

commit 83aeface9ebfaf7e5f2584fb676e674bb044d8a1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 16:26:37 2011 +0000

    discovered another entire class of interleaving opportunities I've not considered. Fortunately, the fix turned out to be simple. ish.

commit 0bfe9420ed8d8e7f331696e1020c92756335a25e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 13:50:11 2011 +0000

    Make creation of slaves synchronous. This means we are guaranteed on queue.declare to have all slaves up by the time of the _ok

commit e15a67b75f233b30157f6e22b4f68977fe264b13
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 10 12:51:49 2011 +0000

    It was right before...

commit 96d03bd4f87da75db74ae9e51c658ad3077ac6a0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 17:03:07 2011 +0000

    or that might be a bit better...

commit 99b329075dba101b84c967350e5f652ee587f417
Merge: daae53c0d da9f51e0d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 9 16:49:49 2011 +0000

    Merge with default

commit 0c83a88f5af258d56c891991e0e9fa45b8c1fcaf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 16:39:59 2011 +0000

    There's a chance that might be it

commit 82435afc8e946bbf487b779ee92c6fa7ac1583f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 16:28:52 2011 +0000

    Further improvement of documentation

commit 45c07a350fb81085b6cc61893e93715d2776be60
Merge: c723f0465 2ed7f63eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 9 15:53:10 2011 +0000

    Merge bug21973 (Make suggested frame-max configurable)

commit 4616f24b4b3724dee1be1b7a1066858ffb3b36e3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 15:26:30 2011 +0000

    Correct documentation. Code is still wrong though

commit 1de9cb76aa9682a66c3ec59136b02953178ea328
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 15:12:48 2011 +0000

    fix

commit 99cd6f58f940e6627a86d507674be1830d75cb4d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 15:08:41 2011 +0000

    Sort out and clean the validate_message stuff. It compiles again now...

commit bbecd33055de18a167be1a37948b924210f9ca45
Merge: 91ec54ba3 d16bd4bae
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 14:37:41 2011 +0000

    Merge default to bug23554, and then a bit

commit c723f0465bec343f0d54aa9cdb8e41a039c4f7fb
Merge: 91ec54ba3 a662d47ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Mar 9 14:17:43 2011 +0000

    Merge bug23520 (obtain fd limit with erlang:system_info(check_io))

commit 91ec54ba3defc89b21bbdcd6ba42b6a969d4b543
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 13:22:39 2011 +0000

    save 2 lines: no one cares about the result of deliver_or_enqueue, so don't bother with one

commit d16bd4bae07f5c6fa9c942ce62310bc721171877
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 13:19:10 2011 +0000

    just stashing this whilst I fix something else

commit 79194f31a235cbf94ac9f7419bf4ed5693cf70a9
Merge: 3e859fd22 da9f51e0d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 9 12:10:40 2011 +0000

    merge bug23920 into default

commit da9f51e0da320e7ca0b6ac2689df0e61bf34b7a3
Merge: 70e709abd 93e096449
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 9 12:00:21 2011 +0000

    Merged bug23848 into default

commit 3e859fd22827f30ea29a5f02a90e033d511194c3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 9 11:53:39 2011 +0000

    remove misleading comment

commit 70e709abd491083f2e60f047415bb0d87df154b7
Merge: 314452b1a 93e096449
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 9 11:47:29 2011 +0000

    Merge with default

commit daae53c0d574a2dd30382c90447d013a07de6125
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 9 11:31:47 2011 +0000

    Fixed bug in the QPid tests. My tests were passing because I used an exchange name in both add and remove calls

commit daac7b01388684aeb76aec658076a2f354b7f3de
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 9 11:17:27 2011 +0000

    Correct upgrade step

commit 314452b1aedf1cfb4b587b8cb9055787be71ca44
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 9 09:30:15 2011 +0000

    change if to case
    
    Mhm.

commit 6dac8cdbdccd2ea98fd72003aaf48bcfe5f21bac
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 9 00:14:21 2011 +0000

    close channel when test finishes

commit 8f56800fb06881669ae2af781efb2384abd31755
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Mar 8 22:20:43 2011 +0000

    cosmetic changes and some inlining

commit a662d47ff4b39f530d9e02c9a295a511ef6dca79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 8 16:25:43 2011 +0000

    Pin the URL comment.

commit 63f47b7fe07ca71ef6d0e4982af4391650ff704e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 8 16:18:22 2011 +0000

    Fix bad path_entry creation

commit fb963d270c9f04beeba1b1f8377f91b6b20ed736
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 8 15:56:23 2011 +0000

    Tweaked accumulator again - no need to store the entire path

commit 962ea81092a1ebbec6b1cbe26c5c326bab66f3ad
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 15:44:58 2011 +0000

    Just some more notes

commit d8bf0d012bc95b185e2cf06d3cbb816a519aad19
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 8 14:19:40 2011 +0000

    Use lists:append/1.

commit fcbaaf7f646c1f3278cd351bf8f477342715c8e8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Mar 8 14:11:11 2011 +0000

    Don't change the version file format

commit f4042e55b0b46533d3704c2e937e114d061d93ff
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 13:35:06 2011 +0000

    save another line. bonus

commit c751f0c2f8213720ada9914cdea01358cfc217f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 13:33:02 2011 +0000

    save a line

commit f08e57cc08a16a3c31955981838970e4a3b10c74
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 13:24:18 2011 +0000

    Hmm, I'd forgotten than deliver_immediately == false => the msg _isn't_ enqueued

commit b0bd6c8a98f59e9a1537133dc0d0eaa41f0a87da
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 13:13:24 2011 +0000

    oops

commit b3ed57b031b51b1c01819064a38e337fc2860abc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 13:01:14 2011 +0000

    add BQ:validate_message

commit 89ea6bfac9359b49c58843be98c69cc0ec84359e
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 8 11:58:10 2011 +0000

    Floats are bad. Use integer division instead. (via Matthias)

commit 048c0fe1a76edb282a69b52c7f42305bf9f0470e
Merge: 93e096449 d9aed47d7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Mar 8 11:55:43 2011 +0000

    Merging default into bug23554

commit 37fa9c11f28009808a210e2e69faa63395d5f5a2
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 8 11:16:35 2011 +0000

    Short comment

commit 94673c661e44324509965fd021ca3984552853b0
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Mar 8 11:11:57 2011 +0000

    Use system_info(check_io)/max_fds instead of ulimit.

commit ef5f4b72bebde582a3fd531f4bd1f6787f032a14
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 8 10:05:11 2011 +0000

    Removed io:format

commit 0db8b69f865dc695455fabdb54af4bf9d82ec93c
Merge: 717de5c25 93e096449
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 8 08:17:26 2011 +0000

    Merge with default

commit 7b29c01df022470215de6e21c210f7cc2488f0a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 18:23:56 2011 +0000

    Simpler is_new_version/1.

commit 8b4adcb0de5e4e11488bab57af2a5e9e9b7f43dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 18:21:36 2011 +0000

    Spec, rename functions.

commit 04e7ada56fa94da8915acd45c5001b6ae631f6d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 18:06:53 2011 +0000

    Variety of small QA-related tweaks.

commit ec7633ed968ff91cda77b1bcb5d86a613f9cecb5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 18:00:11 2011 +0000

    Explain the tuple here.

commit 93e09644956b99da3424fc736736e032294d3e22
Merge: e5c6e403b 74b062c59
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Mar 7 17:43:04 2011 +0000

    Merged bug23916 into default

commit 717de5c2557aa3bfdb475d5d41eb110a0c8790ce
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 16:57:21 2011 +0000

    Fixed a few pattern matching errors - remove actually works again

commit 74b062c59e3bfe39a99b0fbe792c376c1f9842f4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 16:25:36 2011 +0000

    Add a command prompt shortcut that starts up in the right dir. That's pretty lame, but at least it's safe.

commit c364af63ab622d886a7f1997873862a74816409a
Merge: b88c81901 e5c6e403b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 7 16:15:40 2011 +0000

    merge default into bug23882

commit 2bb7e409667cf9bb822d30d3dd3e4221a2f6cfe7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 15:53:17 2011 +0000

    Remove EnvVarUpdate

commit e5c6e403b66102b08a48ce12a13edeceecff46a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 7 15:27:54 2011 +0000

    guids be gone

commit f172b1a94b92dbb440a2889a61c1b714b0b40bdc
Merge: e90ea3baa c9bca5aa4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Mar 7 15:21:21 2011 +0000

    Merge bug23914 (lack of type for msg_id obscures APIs and code)

commit 1e6c32ed2248a5fcc780633b9137e19e313f3420
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 15:12:17 2011 +0000

    Comment describing the why behind the refactoring of remove_bindings

commit f40da1a778c8452b325b3fa66ec1a9b718489a82
Merge: e90ea3baa 535ed4db6
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 15:01:41 2011 +0000

    Merge with default

commit 535ed4db6f6b6393ea528978bb9072e6936b3b48
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 15:01:13 2011 +0000

    Added exchange name back into count functions. Made path node id key in delete accumulator

commit f7a0fcb488cf1fa724cf397d63e4ab02f47bd6f4
Merge: e90ea3baa 1d858806f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 7 14:44:57 2011 +0000

    Merging default into bug21647

commit b88c81901a341111163cee50078145df2d31124a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 7 14:32:43 2011 +0000

    document bq init params

commit e90ea3baaac8070b0efd1e470a03174aad9f010e
Merge: 0c54e7151 807081def
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 7 14:00:08 2011 +0000

    Merging new head of bug23810 to default, which results in a tiny and insignificant change

commit 0c54e71511a3d31d6626f6e1617f8598ea67c8f9
Merge: fd5c14578 6c4ae5734
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Mar 7 13:58:54 2011 +0000

    Merging heads of bug23810

commit c9bca5aa497f692d6690423e8b3ba6b6d1e94ad2
Merge: 807081def b43e73619
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Mar 7 13:47:02 2011 +0000

    merge default into bug23914

commit 3605678a8c34d364a4cbfc68743668e0cb462116
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 11:00:17 2011 +0000

    Tweaked delete accumulator key

commit e3c25b66cf45354f626e51e9f95cf0ed63e4ab47
Merge: 47c823619 807081def
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Mar 7 10:00:01 2011 +0000

    merge with default

commit fd03cc9495772866071fa881c9e3a12766fa0f7e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Mar 6 12:45:40 2011 +0000

    add test for confirms in case of queue death
    
    There's a race in the test, but it seems to work reliably.  I ran it
    1000 times in isolation and it didn't fail.

commit 807081deffb9b03cab8723ba0aa354dedbc27e8f
Merge: 6b60d505c 3fd05897f
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Sat Mar 5 11:03:16 2011 -0800

    Merge heads.

commit 6b60d505ce766f6ef1daa5c3f8743463dc2f1ef5
Merge: 0b772a8a1 175714093
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Sat Mar 5 10:46:37 2011 -0800

    Merge bug23575 to default.

commit 3fd05897f3a1fa4a98d5d046b2dcc297667e65d9
Merge: 6b4b2718b f8ade16bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 17:57:27 2011 +0000

    merge bug23875 into default

commit ec07303df1389642f65d902849cfd3e4889636dd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sat Mar 5 11:42:43 2011 +0000

    cosmetic

commit a11606ea43e7efbefbed0f16661424fb85b29d48
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 10:48:38 2011 +0000

    shorten maybe_run_queue_via_backing_queue
    to something less misleading though arguably still quite obscure
    
    Also move make it clear in the amqqueue API which exports are genuine
    and which are for internal use only.

commit 87004aa49a7e914fda45d9c8fca4baf18af23fac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 10:06:16 2011 +0000

    simplify various callback constructions

commit 7f009301197b2cd99dd15b755aa247ae00b9e2c4
Merge: d49878725 f8ade16bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 09:04:14 2011 +0000

    merge default into bug23882

commit f8ade16bfce1906d0c318a04875364673604a11d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 08:55:12 2011 +0000

    add missing assertion

commit 12110aa1e1f1e1e16e9da036b575c969a5d231a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 08:53:23 2011 +0000

    cosmetic

commit 064d70e798030b60b4c6a7136ed8070998fb4dbe
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sat Mar 5 02:28:19 2011 +0000

    nack messages when the first queue dies

commit d4987872568bf61164b03ce85798df33440cf3ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Mar 5 00:31:49 2011 +0000

    make handling of confirms more obvious in BQ API
    and fix some bugs introduced earlier
    ...amazingly it all seems to work now

commit 2a4dc5912890903d845080db60f8634519da0874
Merge: 25dd335fc 175714093
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 22:24:51 2011 +0000

    merge default into bug23882

commit 0b772a8a140ea97c35ae6da52e2d801faded650d
Merge: 5b014bff9 43c4ad4d5
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Fri Mar 4 13:46:51 2011 -0800

    Merge bug23575.

commit b43e73619e5805072cbb65b7b3ebf9817486f196
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 20:42:51 2011 +0000

    cosmetic

commit 194028ca1a0ee5af468c6b0262cbbf1844de9a65
Merge: 69a7a5a34 175714093
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 20:37:37 2011 +0000

    merge default into bug23914

commit 1757140934da3ff745585025c5c0111fa6b432e3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 20:31:09 2011 +0000

    cosmetic

commit 69a7a5a34d066d38db84fc5679066d724ca83d3e
Merge: 9fc7225bf 43c4ad4d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 19:52:34 2011 +0000

    merge default into bug23914

commit 43c4ad4d5bef15d29ae01445924b8c3fbb2eed9a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 19:49:17 2011 +0000

    cosmetic - comment indentation

commit 88c836df19a602a22467c3a99e6f0c3eeae7d484
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 19:32:39 2011 +0000

    cosmetic

commit 9fc7225bfedef512a519ae011fe0d193d1f2fa9e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 18:58:26 2011 +0000

    guid -> msg_id in tests

commit fd72e310847393f33fef8d7ceec487719ca5d99c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 18:46:21 2011 +0000

    guid -> msg_id in amqqueue_process

commit 466b4961c5d266f975aab0c962464d45c61893ac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 18:36:49 2011 +0000

    #basic_message.guid -> id

commit f5b3f8f1cdd34d734350bed84e5ab7a3a55544db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 18:30:25 2011 +0000

    guid -> msg_id in vq
    except for #basic_message

commit 8a79fec59355e550b9d9f7fdfad8a186f16482b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 18:30:06 2011 +0000

    guid -> msg_id

commit bd56dff973b5d9141d98919062c277be22e3198b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 17:55:05 2011 +0000

    guid -> msg_id in qi

commit 9fa5c154b0304c274e022ef53db1d63912a0766e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 17:46:50 2011 +0000

    guid -> msg_id in msg_store and friends

commit ee281b1d5bc164a0395d037f91ef7aec550065da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 17:22:18 2011 +0000

    introduce separate type for msg ids
    and add some auxiliary types for fun params to a) make their purpose
    clearer, and b) work around emacs indentation bugs

commit 1d858806f81e5ae82b4ec9093135a59f7276864b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Mar 4 17:16:32 2011 +0000

    compromise renaming

commit 25dd335fc3186d6422ba1dab3c713908bd11a4e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 15:41:25 2011 +0000

    beginnings of decoupling bq from amqqueue
    - parameterise bq with callbacks

commit 5b014bff96f8edbf70fcc3a39c7d26bcd525dcd8
Merge: e0fb813eb ba3a15653
Author: Tim Fox <tim@rabbitmq.com>
Date:   Fri Mar 4 11:53:55 2011 +0000

    merged default into branch, again

commit e0fb813eb903254369d616f67861de420aef4b4c
Merge: 2877becea 3a5fcb8a2
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Mar 4 11:22:10 2011 +0000

    bug23867 merged into default

commit 47c823619d28981fb6c08e41b1dca3441b741d9a
Merge: 504d2fa18 3a5fcb8a2
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Mar 4 11:20:43 2011 +0000

    Merge with default

commit 504d2fa18029ad0fcfd9fc1fbd429bb3822068de
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Mar 4 10:41:47 2011 +0000

    Reworked binding delete into single transaction again

commit 6b4b2718bac84ae918ae311b9c9f9ab9334a70ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 08:34:11 2011 +0000

    cosmetic

commit dc5d5b81860305176d9f21b697c9ea67ad2f9919
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 08:29:11 2011 +0000

    yet more simplification

commit ced19121ecd769e4737b3a1cbf3dcdc73043a624
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Mar 4 08:11:07 2011 +0000

    simplify

commit b8652459200b5c1b89a175f2a4b815a807d624dc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:49:42 2011 +0000

    avoid tautology

commit 3312e91872add95284e97ae80e85c6d4753f7b41
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:41:45 2011 +0000

    move code around and refactor a bit

commit 7dfd97127e202d1edb1e9a9bee5eb802ec9ecf14
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:25:54 2011 +0000

    shrink code

commit 7019781312eaae629d104444e29f189ac6b08aee
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:24:17 2011 +0000

    dafter renaming

commit 5452d4940927a871f32a933d88038363f0aa3a3c
Merge: 3a5fcb8a2 3d02d79df
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Mar 3 15:23:37 2011 +0000

    Merge with default

commit 3f0868aa816ed7dd1ac67be4dbcd9d443d820423
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:21:43 2011 +0000

    renaming

commit cbd0d077ee6da50d60a51cab587e63d927db1afa
Merge: b68b2eea7 438c93a18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:19:38 2011 +0000

    Merging default into bug23875

commit 3a5fcb8a20c07a2908452e368c7d25e776dabe53
Merge: b1459b0ab 438c93a18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:16:59 2011 +0000

    Merge bug23893 to default

commit b1459b0abf0d9a6511561452003054068d65e976
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Mar 3 15:05:41 2011 +0000

    Remove unused var

commit 3d02d79df14e104258d1718e8ead409889e843c3
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 2 21:52:31 2011 +0000

    Always specify rabbit application when looking up ssl_options

commit d9aed47d793f0f580c455109942aa6af3d7a5ec2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 2 16:12:49 2011 +0000

    It's very substantially wrong.

commit dcca25d53dccbd4ca2c4645f602181d5be624ccd
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Mar 2 15:44:41 2011 +0000

    Extracted ensure_ssl and ssl_transform_fun for use by STOMP

commit c7ce813752b649754048064841f4c5c26eafd348
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 2 13:48:58 2011 +0000

    Remove erroneous documentation

commit 69e059a7f5878dafc4751d80811c710d9a48563a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Mar 2 13:32:59 2011 +0000

    only confirm delivered messages that need confirming

commit ba3a1565304a4d3d1239a528b71c79eea1bd72f3
Merge: e289045b1 438c93a18
Author: Tim Fox <tim@rabbitmq.com>
Date:   Wed Mar 2 13:07:34 2011 +0000

    remerged in changes from default

commit dacc27d78b8ff020a41a6919cd3f5a54fc9d586c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Mar 2 13:01:30 2011 +0000

    Fixed confirms in HA queues. Broke slave promotion. Will fix

commit 1a2fff770c10fd6906dce79dff2e487123fab93e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 1 16:10:55 2011 +0000

    Correct foldr -> foldl

commit 74d1821ddb968fe7093c8b0af47b98bbe4492279
Merge: 24deb39db 438c93a18
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 1 15:44:45 2011 +0000

    Merge with default

commit 24deb39db31955eb03222a6e3beb44e5b4db4dbc
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Mar 1 15:44:37 2011 +0000

    First cut of pushing edge cleaning out of main topic bind delete tx

commit 7768d11214271ced5f957b4fcf3b3b6a966d8cd3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 28 18:09:01 2011 +0000

    confirms still don't work... but it needs sleep to fix this.

commit fd8bffd2df83e0d58ba36a323466a417d38f7c4d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 28 17:11:58 2011 +0000

    Large amounts of debitrotting due to changes to confirms api and such like. Sadly mirrored confirms aren't working again yet... not really sure why

commit 66fedcc7952a12c7641ff614936bf96c8332e2a5
Merge: e4a29a36a 438c93a18
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 28 13:33:42 2011 +0000

    Merge in default.

commit 9566c5bfbb46338ff414f9bd8c56925ff8711b87
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 28 12:55:44 2011 +0000

    Removing gm_test from bug23554 which has in bug23727 become gm_soak_test

commit ffaa1deb9e3313dc3a9c7ac223d49e7db521d210
Merge: 0b06530a5 438c93a18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 28 12:53:38 2011 +0000

    Merging default into bug23554

commit 438c93a18a874cbf888aeb0e7766f336caccac15
Merge: a3a5ff2dd ed589d097
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 28 12:21:22 2011 +0000

    Merging bug23483 to default

commit a3a5ff2ddc8f3bbe731929b961e4f44f44937071
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 28 11:02:29 2011 +0000

    ...and untabify.

commit 73f01f6acdcd87b607fc36e683ea58711a9d0713
Merge: 91fa60797 b4fae0526
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 28 11:00:19 2011 +0000

    Merge bug23580 (Add statistics for 'basic.return')

commit ed589d09733d38cca8afeab829a0d8cd2f3d55d4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 25 16:12:21 2011 +0000

    Stricter msg store upgrade

commit b4fae0526122f5d4d221204cab4b163bc57baa0c
Merge: 50aeae4f4 c5278e212
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Feb 25 16:02:17 2011 +0000

    Merge bug23727 into default

commit 3c75a67756b2c0f7bd9703af4c6ff907f0b7d8f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 14:46:30 2011 +0000

    remove blank trailing line

commit 4c1d597012d2915ef55f0033092eeb3434b83841
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 14:45:45 2011 +0000

    multiple_routing_keys/0 is not part of the backing_queue

commit c5278e21223d8ad7af73d3b73240435019822635
Merge: 55f5c2a8f 96f8ba033
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 25 14:41:09 2011 +0000

    Merge bug23076 (preventing bad_arg error in rabbit_event during shutdown)

commit 50aeae4f4f7469d0399dea5fa5f816895f7e115d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 13:05:21 2011 +0000

    Additional word

commit 96f8ba03363b077cfe7cb5169f73c0e54ce5f26a
Merge: 18237257f fc9ff1594
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 13:00:58 2011 +0000

    bug23824 merged into the default

commit 18237257f7e70d71658ec7c123d4a6861cd591d8
Merge: c1a794918 4a9207a80
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 12:46:50 2011 +0000

    Merging heads of default

commit d272bdb9ad30ebe50bc91d86df85ae459c2ab057
Merge: e8aef51c0 4a9207a80
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 12:40:09 2011 +0000

    Merging default to bug23483

commit 4a9207a8016351dc70ae9a48156f4d112a272650
Merge: be4b20cfb 89ad417a5
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 12:37:57 2011 +0000

    bug23799 merged into default

commit 89ad417a5789954b7e4e7132e6dd5b46ed4a58d7
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 12:36:45 2011 +0000

    We renamed .conf to  -env.conf.

commit 433f4df2880f7a36f636a2fd01b7efa884ec126f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 25 12:25:16 2011 +0000

    Make documentation accurate for current API...

commit 6b4dad7245e64a286a37e3afcb4bf2233c10bb7d
Merge: 1dc6e9561 be4b20cfb
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 12:18:02 2011 +0000

    default merged into bug23799

commit 1dc6e95613cf625b8d772a5ccfd15c90b3832214
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 12:17:17 2011 +0000

    No, we don't supply multi man page any more.

commit be4b20cfb43c4f687af10e71c518f792c6606291
Merge: d2cf22aff 79740987a
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 25 12:10:57 2011 +0000

    bug23278 merged into default

commit fc9ff1594a18726a3e62d101d6c02056fe1488e2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 24 18:32:56 2011 +0000

    Create log backups in the correct folder on Windows

commit b68b2eea755c04ac7342f524f8be91787c8668c4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 24 18:15:34 2011 +0000

    Make memory alarms work correctly over clusters

commit e8aef51c0c033eccc863f2659fb5fd2618da8f36
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 24 15:14:26 2011 +0000

    Dialyzer typo

commit 79740987af7ce6a60d661513a9dddbab889dcdfc
Merge: 521845937 64fc40f4a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 24 14:43:44 2011 +0000

    Merge bug 23858 (Implement try-restart and condrestart correctly in our init scripts)

commit 64fc40f4a222d04a974bd10ab1fa0b46ceb2f967
Merge: 43c93e349 cc858f2e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 24 14:29:25 2011 +0000

    Merge bug23877 into default.

commit c1a79491865c9434ae45723115162b0881bbb052
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 24 14:25:06 2011 +0000

    English, not American

commit 984b204e9754af60b09d7d0edd826298ff3e76b3
Merge: 1f8d8a6d9 8c823dc0a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 24 14:20:22 2011 +0000

    Merging bug23637 to default

commit 25623c17a6872bb7376f8d1d7dc68f496576eb7d
Merge: 1f8d8a6d9 fd4705d74
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 24 13:31:54 2011 +0000

    Merged default into bug23483

commit 1f8d8a6d99f3a1fef1117bbb40c9ca6da20659e8
Merge: 41ea35668 43c93e349
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 24 12:07:46 2011 +0000

    Merged bug23826 into default

commit 43c93e349a527da111791a276bc445392169a12f
Merge: 3b667cc3d 0ff96ad27
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 23 15:18:35 2011 +0000

    merge bug21440 into default

commit 3b667cc3dd857860529ca38ffb32b0450a7ce65d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Feb 23 15:12:38 2011 +0000

    cosmetic

commit 78980b58f37d81f8cebabcb465c41c439f74ec16
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Feb 23 14:43:00 2011 +0000

    Removed table name intersection in wait_for_tables and cleaned up whitespace changes

commit 420c7326140f9a1bc38624e0403e6f8d63eb6b92
Merge: 253fcc641 0ff96ad27
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 13:58:16 2011 +0000

    Merging default into bug21647

commit 0b06530a5532549f7de8d57d624fac546961fb97
Merge: 32d11d570 245592bc7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 13:50:38 2011 +0000

    Merging bug23727 to bug23554

commit 83a876c7facf3b66c6c9bcf65293f4375183215d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Feb 23 13:40:15 2011 +0000

    Fixed incorrect binding pattern in rabbit_mnesia

commit 245592bc7051cfcb16cfd0dff84085d1294e8146
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 13:09:16 2011 +0000

    correction of specs

commit 90988e596c89940bdf48aac04a7951b08a14410f
Merge: f2f4bc9ba 0ff96ad27
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Feb 23 12:58:28 2011 +0000

    Merge with default

commit 5f192815cb9ded7e21ef8423d1fec06a543889c4
Merge: 3da1b8654 0ff96ad27
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 12:56:20 2011 +0000

    Merging default into bug23727

commit 3da1b86545a8b99e640f55ece3d2c867ddd02b63
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 12:54:40 2011 +0000

    Wire in gm_tests to rabbit tests

commit be6363321e67964fde51f4147e75237c71170394
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 23 12:52:55 2011 +0000

    Added test to assert receiving messages in the order they're sent. Other cosmetics

commit 625f9b72b3f8469f5e9935f3347b13e3ae1ae419
Merge: 8826a0007 0ff96ad27
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Feb 23 09:53:01 2011 +0000

    merge from default

commit 32ab9db898718f0644f8e17941ff5903e429c6de
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 22 22:57:01 2011 +0000

    rename

commit 8a79cb30ce5cc1b90d805361b4ccdb2eba94c3e6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 22 22:55:24 2011 +0000

    consistency

commit adb4d41e9fbe34f478235185be4a3652841aa362
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 22 22:54:12 2011 +0000

    Magic macroification

commit 09d39fda8ac5b2e3a30e41090f2af4e5a32eacb9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 22 17:22:37 2011 +0000

    Added functional tests

commit fd4705d74ff16f10f11567efcc29d8c3bfe078c2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 22 16:57:39 2011 +0000

    Revert re-arrangement of upgrade steps

commit cc858f2e62aaa48f7a87f381ab2c6a9d792fa42c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 22 15:57:47 2011 +0000

    better name

commit cebadd6d3ffc67c988c8694f39c1752a09b1856d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 22 15:55:37 2011 +0000

    better error reporting for failed table integrity checks

commit 2cd01c20cbb32c4e138a00a0d2d61be4703f6f50
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 22 14:43:08 2011 +0000

    Sender-specified destinations updates
    
    build on R12B3
    reduce mnesia lookups

commit 41ea356685cc968cb7e837742c1d89fae0fe7024
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 22 14:41:24 2011 +0000

    Revert d3fd719c5287 (Remove should_offer/1).

commit 0ff96ad279aef667967a84544620dcf176a09bbd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 22 14:35:34 2011 +0000

    remove redundant calls to wait_for_tables
    ensure_schema_integrity calls it indirectly anyway

commit 1adca902568cc3ff578cb42c1988bf1bc755787e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 22 14:13:45 2011 +0000

    remove redundant function

commit e4a29a36a9c76db9ad4620e095f660a134aa8585
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 22 12:50:49 2011 +0000

    Don't look at the cluster config, it is not trustworthy (for what we want).

commit cbba5bebe809f3e2e26c2f3a9a713e9667069304
Merge: e94c1299c 68195be9e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 22 12:36:27 2011 +0000

    Merging bug23657 to default

commit 4ec619d53631f159c4899202bb46adde86ace34e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 22 11:15:28 2011 +0000

    Make sure logging is working if we're about to actually do something.

commit e39014044d83e14b0ef86215bbb7c87a7d8ed4cb
Merge: dab04dfa0 443296009
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 22 11:01:17 2011 +0000

    Merge in default

commit 122972d7a3013610de74591fafb48b201618643b
Merge: 443296009 424182a42
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Feb 22 03:24:56 2011 +0000

    Merge default into bug23568

commit 253fcc641964ab9cdbefdf7e608c5e9250bafefa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 21 18:15:44 2011 +0000

    cosmetic and code movement

commit a257c29f2030e6160816634770d84a38e58a6f1f
Merge: 443296009 7be587155
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 21 17:40:17 2011 +0000

    Merged default into bug23483

commit 0652ecf330165993ba68f7eacc0e1ef63865bd54
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 21 17:36:09 2011 +0000

    renames and refactors

commit 443296009f45d631dde279a0b1b9549641643701
Merge: e94c1299c f2f4bc9ba
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Feb 21 15:34:33 2011 +0000

    Merge bug21440 into default (again)

commit f2f4bc9bac12179a236f6a385e5c728dcf8bad18
Merge: e94c1299c a92eef55d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Feb 21 14:11:42 2011 +0000

    Merge with default

commit 73c69c8ce0f4e3eea30262e97b3747d2721c184e
Merge: 3628ac875 e94c1299c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 21 11:23:50 2011 +0000

    Merging default into bug21647

commit e94c1299c2256610adafec351cedb0b316e220e3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 21 11:21:09 2011 +0000

    whitespace

commit a92eef55da4181fa2d9443331f4eaf38c9aedbdb
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sun Feb 20 16:44:56 2011 -0600

    moving wait_for_tables call in transform

commit 8de8e2d9f8a7e49706e60f69a2458d9cc05abace
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sun Feb 20 16:37:07 2011 -0600

    less wait_for_tables

commit 79583cfc1757c01130ac68c8039843da9f7b1a70
Merge: 8a9e54b4f 2c57fb144
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sun Feb 20 16:20:45 2011 -0600

    merging in from default

commit 8a9e54b4fc055973925a181fb1768934af16ae1d
Merge: fd5c14578 f23ae4839
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sun Feb 20 13:12:03 2011 -0600

    merging bug23810 into default

commit d2cf22aff35196b9c778f47a0c47324293370687
Author: David Wragg <david@rabbitmq.com>
Date:   Sun Feb 20 00:11:18 2011 +0000

    Fix "File listed twice" warnings when building RPMs

commit 2877beceaa079519bf4150f6f8260f888ad8edce
Author: David Wragg <david@rabbitmq.com>
Date:   Sat Feb 19 23:37:54 2011 +0000

    Obey Fedora guidelines regarding Default-Start and Default-Stop
    
    Fedora guidelines say that non-vital packages should omit
    Default-Start and Default-Stop.

commit 6fa4d3bed077dc59cb2f702675e27201a2a8939b
Author: David Wragg <david@rabbitmq.com>
Date:   Sat Feb 19 23:36:36 2011 +0000

    Debian needs unusual LSB Default-Start and Default-Stop lines
    
    For Debian and descendants, there is no distinction between runlevel 2
    and 3, 4, and 5.  So we need to modify the Default-Start and
    Default-Stop lines in the init script accordingly.

commit d36fa2d13c9f635700c52961f94e6b2ad9110b3d
Author: David Wragg <david@rabbitmq.com>
Date:   Sat Feb 19 23:34:39 2011 +0000

    Include LSB Default-Start and Default-Stop lines in init script
    
    Runlevel uses vary between distros; the runlevels given here correspond
    to the most common Linux conventions.  In particular, runlevel 2 is in
    the stop list, because in most distros (Debian being a notable
    exception) it means that network services should not be started.

commit 3628ac87508d5e8f8ec8e241c9b71e3dda431a0e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 18 18:40:07 2011 +0000

    Fatal error

commit 5e4237f3306773e7e61069a6fe4754675c1d8b50
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 18 18:28:16 2011 +0000

    Set up the monitor only when we see the basic.consume_ok coming back through otherwise there's a risk of sending out the cancel before we've sent out the consume_ok, which would surprise clients. This is further complicated by the fact NoWait with basic.consume...

commit ac62154a544c4903c2821668c74a9f111fa8b944
Merge: f23ae4839 6398ee3c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 18 18:09:18 2011 +0000

    Merge in default

commit 898bf079c124a1afa8f647f7a4c81b2539d66659
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 18 17:42:56 2011 +0000

    Make the consumer mapping store the queues, not the queuenames

commit f23ae48395675fc51bf914a4ae409d770a42d1f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 18 17:39:50 2011 +0000

    Don't use rabbity types.

commit 3eff985435a3127ce5081aeac68b9444584ee908
Merge: 16b26187a f6ce046ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 18 17:29:33 2011 +0000

    Merge bug23553 (Present managed socket count in mgmt plugin)

commit bb9eab93fae9f6f80acdc4b25c41921f000b3f18
Merge: 2fa2b0e6b f6ce046ba
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 18 17:21:26 2011 +0000

    Merge default into bug21647

commit 16b26187a4a46ef1973849a5c84d8d6c77f4e964
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 18 15:51:53 2011 +0000

    :info instead of :get_x

commit fc7a035a535541965d07c47c3887517897989edb
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 18 14:25:05 2011 +0000

    untabify

commit f6ce046bacedd9830cc909fa5f698db56f9e96e5
Merge: 62b7f0ba8 862bdee24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Feb 18 13:58:40 2011 +0000

    merge bug23859 into default

commit fd5c14578a595b9f9f1d8bfb0fd06c35e0661d75
Merge: 2e73bbd8b 62b7f0ba8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 18 13:15:17 2011 +0000

    Merging default into bug23810 (debitrot)

commit d4b34a71673e6d65ac5eb484c108f6cd36a4cdc3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Feb 18 12:32:12 2011 +0000

    Changes by ryandesign in r75667 of Macports' SVN.
    
    SVN commit msg was:
    rabbitmq-server: maintainer update to 2.3.1; see #28254
    
    Additionally:
     'I simplified how the manpages were installed (using
     "`xinstall -W`" to install multiple files to the same destination
     directory at once), and simplified how the checksums were specified
     (listing each filename only once).'

commit 62b7f0ba8cc08e4d81511782e5def551425884ee
Merge: 0bc30cc89 6e9b81e7f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 17 19:16:57 2011 +0000

    merge bug23850 into default

commit 2fa2b0e6bac986f75329aaf6641d71ded1bd6b28
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 17:32:55 2011 +0000

    Add to our own server_properties (informational only)

commit 47791dccd45c0182cdd2e28e4339e5c4e896d2cf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 17:20:01 2011 +0000

    Tidy up on DOWN and emit basic.cancel

commit e1abf94150145a0654275584e0e59cf3bb185654
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 17:01:03 2011 +0000

    Maybe monitor queues on consume, maybe unmonitor on cancel

commit 6e9b81e7f36ad540279debba2b13fd8bf56cccd1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 17 15:09:11 2011 +0000

    cosmetic

commit dfd0364f817f260ac5f8b72afff853c149441cb0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 17 14:48:29 2011 +0000

    cosmetic

commit 862bdee24fc67a332651f0c77f238cd30fb4c8e5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 14:45:54 2011 +0000

    Get rid of gen_server2?:call/2 sites

commit e859caf7eddf836308d2456283c3ebec5954247d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 17 14:38:16 2011 +0000

    cosmetic

commit a09bc2995ff7bd6b7dd53ff62ce738ec20740846
Merge: 8ca4968ee 0bc30cc89
Author: Tim Fox <tim@rabbitmq.com>
Date:   Thu Feb 17 14:23:05 2011 +0000

    merge default into bug23850

commit 8ca4968eee099b90f384859544c1ea6eb738d68e
Author: Tim Fox <tim@rabbitmq.com>
Date:   Thu Feb 17 14:07:38 2011 +0000

    Improved performance by unrolling dict:update with nested funs, and replaced use of dict with gb_tree for UQM

commit 52184593765535908accd6a027fdb7d36509d030
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 13:33:43 2011 +0000

    Remove condrestart target

commit 0bc30cc892398e346838eb51097dfd2a8ea8c8f5
Merge: 49b3f4ff6 6d4459476
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 17 12:21:48 2011 +0000

    Merge bug23839 (Add capabilities to client connection)

commit 6d4459476aad2190923a439dd98a1f382c9887d7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 12:10:11 2011 +0000

    use the correct api written for this purpose.

commit 4e12cabd6d96209cb0cbfeba3758034907c10c35
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 12:06:49 2011 +0000

    /...consistently.../

commit b28f1ff8e432f34cb265f4b1eb13a384919137bf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 12:01:49 2011 +0000

    Implement try-restart and condrestart as intended

commit 68195be9eeb8e7ee4889f95074da4da344e09b65
Merge: 9b3035c00 49b3f4ff6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 17 11:56:49 2011 +0000

    Merging default into bug23657

commit dab04dfa063ad10c8e72869d2d30a8189047e6f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 17 10:58:18 2011 +0000

    Retain ram-nodeness when upgrading.

commit 28bc208e53623900ae50571754df3f667c5d141f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 17 10:45:21 2011 +0000

    Make the error messages more readable.

commit a91bf4cb8141f8fc4b7ac8117214abebb4fb5d4e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 17 10:39:45 2011 +0000

    Fix our idea of which nodes were running when we shut down.

commit bd1392718f4f6eb0efada430c6b2c670f1a340b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 17 10:11:45 2011 +0000

    Oops, that's not exported.

commit 49b3f4ff64291e13524cf16f66bc5c991f94091e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Feb 17 08:52:12 2011 +0000

    s/now_millis/now_micros - so the name matches the function
    spotted by John

commit cc11333752dcaf6ac0f78b3db8c6f8033f1b30d9
Author: Tim Fox <tim@rabbitmq.com>
Date:   Wed Feb 16 18:00:21 2011 +0000

    Fixed cosmetics as per comment#6 on bugzilla

commit 5766f2a1067b899dda0836eee7523651acc5e040
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 17:58:58 2011 +0000

    (Untested) Record the nodes that were up when we shut down.

commit 90eab55daaa93e2f986627e680fda4fe072dd7e3
Merge: 8b17365e7 71e720a37
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Feb 16 17:44:57 2011 +0000

    bug21741 merged into default

commit ee5858e31fc83b833da68adfd9200ad18bb223dd
Author: Tim Fox <tim@rabbitmq.com>
Date:   Wed Feb 16 17:33:46 2011 +0000

    make sure all unconfirmed msg structures use gb_sets rather than sets

commit 30db2e72cb0f3b92f4ae16b383c6cb8375a2305b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 17:08:08 2011 +0000

    Prose

commit b5d849a1d7dcf9578bcab310236f40d9be76a930
Author: Tim Fox <tim@rabbitmq.com>
Date:   Wed Feb 16 17:01:43 2011 +0000

    Applied Matthias recommendations from comment#2 of bugzilla with the exception of using gb_sets throughout (will contact Alexandru first)

commit 2284d66f6d43aa52bd1fcd9c57b22765addcce8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 16:49:07 2011 +0000

    Rename

commit 6c69c9407328de4e224070c05f410b9490bd2092
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 16:46:39 2011 +0000

    Revert where rabbit:prepare happens.

commit ce9be9189530389c0cc1da8fb833bb0cbcfcf0bb
Merge: 8b17365e7 ee5e7f647
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 16 16:42:34 2011 +0000

    Merging default to bug23839

commit 53aaaf5c9bf3459adfc3791ad13e5bd41e1a3b9e
Merge: 8b17365e7 5e4eefbc1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 16:41:57 2011 +0000

    Merge default in

commit 8b17365e74f87a761f79a3a3d7ab7e537b6a3792
Merge: aac99fd42 3fba9951f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 16 16:19:13 2011 +0000

    Merged bug23840 into default

commit 9ca6b8dfa7526c1dcbde61978070e902d2b76986
Author: Tim Fox <tim@rabbitmq.com>
Date:   Wed Feb 16 14:02:22 2011 +0000

    optimised removal of confirms in queue deletion, by introducing a dict of qpid->msg_seq_nos to enable fast lookup of all messages for a particular queue

commit 7be5871557b2d00899ec86012639135eead5cdf4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 12:03:22 2011 +0000

    Aesthetics

commit d1e7e9748d0f6770523ee5cc192fa6101a95b5a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 11:43:14 2011 +0000

    Matthias points out this does not need to be second order.

commit 1653edfe373e61c294331d05f75ea2fad6ac3b9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 11:25:59 2011 +0000

    Shorten transform_dir.

commit 9b3035c005223eeb0dadaa52dc5666c5c900d074
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 10:43:34 2011 +0000

    No need to reassign.

commit 767fb3d36117ce7a19f4065ce129d9b733d31bb8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 10:42:24 2011 +0000

    According to http://refspecs.freestandards.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/iniscrptact.html this is a success.

commit 0b81f6c6b8133c07ad530066a72621f7d5a04965
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 16 10:35:25 2011 +0000

    Don't fail if the lock file does not exist (on Debian).

commit 3fba9951ff1f630baf35f9b17fcb709052b5228a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 18:14:11 2011 +0000

    Whoops. Forgot these

commit cd3baf58e01d69e2bf6b9a592dad62412670149f
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 15 15:56:04 2011 +0000

    Swapped helper function arguments

commit 424182a420801b464abf2acaafa728bad61a51ca
Merge: aac99fd42 c915c6c9d
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Feb 15 15:51:33 2011 +0000

    Merge default into bug23568

commit 1199db41493a659065092484ae0279a35c2907d8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Feb 15 15:27:52 2011 +0000

    Sender-specified distribution updates

commit 2c57fb14475b2ff4022320882ca17f423f35971f
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Feb 15 09:20:07 2011 -0600

    adding wait_for_tables after database upgrade

commit cf6ac6d1718c9e69412a0ce43bcb821ad63ae637
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 15 15:10:03 2011 +0000

    Make the timeout code a bit clearer.

commit 6c4ae57341053e7cc7cb344954f9b65545fe5ef8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 13:51:58 2011 +0000

    404 => NOT_FOUND

commit 441ac18d33cba52ddca8ad09b4eef27f4bf8099c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 12:36:40 2011 +0000

    /Consistently/...

commit b29e1217253b4c85d8bcecec08518f3a41ab7b65
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 12:29:33 2011 +0000

    Move Protocol to after vhost consistently

commit 15b182936816551a97977656ffcd0ff5a60dd20c
Merge: 6172b0449 addda5bde
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 12:18:42 2011 +0000

    Merging default to bug23810

commit aac99fd42ed9c8bb7931f92812d12b9cdb63c760
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Feb 15 12:16:10 2011 +0000

    simplified and better error reporting on queue declare arg checks

commit ee5e7f647da07f60c384e97ab238c58813060e74
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 15 11:54:01 2011 +0000

    Move capabilities to after the vhost consistently

commit 2e73bbd8bfbd0d9a363babd89e04a6b4cc6c8599
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 14 19:20:06 2011 +0000

    cosmetic

commit 2212cec012790f2c1a982e9f2178a01a7af830b0
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Feb 14 13:19:56 2011 -0600

    removing duplication and use of sets in rabbit_mnesia

commit 8e078622827fa18389866220d88facda5c3390bf
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Feb 14 12:49:43 2011 -0600

    fixing upgrade from schema with missing tables

commit b2debccea380afa79ab5e87934f73887c22ef69f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 18:10:44 2011 +0000

    Pass client capabilities through to the channel

commit b05321a72ea2cc561fccb5aa0a0543e6258b3424
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Feb 14 12:07:19 2011 -0600

    fixing attributes in rabbit_upgrade_functions:topic_trie/0

commit 95696be53b8706ead7c6296a76428085aec0f23a
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Feb 14 11:53:00 2011 -0600

    fixing field lists

commit 0660e9fb5aa5e8516b1a1a7fa377daac990fd271
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Feb 14 11:38:21 2011 -0600

    fixing database upgrade

commit 3e6b9ea19f22ffbb82d6b4a1f94ec7341c05d822
Merge: 965882c3a 00a3f9e33
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 14 17:37:54 2011 +0000

    Merged bug23842 into default

commit d864a53d009e695752e2ffbcabeb479f1781867e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 14 16:57:16 2011 +0000

    Sender-selected distribution updates

commit 965882c3a40ecc012c950dffc0b14c7e1daec203
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Feb 14 16:48:45 2011 +0000

    print usage message for all command line parsing errors

commit f8ba947d2a61ad152fa409565ab414d3a2f2c597
Merge: 3259110d9 addda5bde
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Feb 14 10:25:49 2011 -0600

    merging in from default

commit 1f654392f66f9263ec0c4190ba218ccdcce60b37
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 14:57:04 2011 +0000

    Supply server capabilites

commit 00a3f9e33bbf1d2119391b4818dbea474f38fe3c
Merge: d7b850ed5 addda5bde
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 14 14:48:43 2011 +0000

    merge bug23829 into default

commit 471fb77fb104fee6e725c7e5fc0d572437a72a24
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 14:46:41 2011 +0000

    Make server_properties a /1

commit 5e4eefbc13a8c1431cd38ca785a7f2dd0470493d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 13:59:39 2011 +0000

    inlining

commit 4b081e1ef3195f7b38d5a9dc74893be04dd34ed8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 13:39:05 2011 +0000

    Cosmetic

commit 88443f40c032c787f561c4e96582f0dba32db006
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 14 13:27:05 2011 +0000

    Make "set +e" cover rather less code.

commit 486f4ca65d399b01971fd24b8c2bdf9317d70fa2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 14 13:19:20 2011 +0000

    More explicit documentation.

commit b5830b60c8e319f0b5937532b70fdfe4548a815d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 13:08:43 2011 +0000

    Be explicit where we can be

commit 315184c7568482accf95b937123fa59888ac7030
Merge: 697c54ba5 addda5bde
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 13:08:16 2011 +0000

    Merging default to bug23425

commit addda5bded6f058889fbdf07a0f22cd5882c0db3
Merge: 9380e46a4 3e35ec678
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 14 11:29:35 2011 +0000

    Merging bug23609 to default

commit 3e35ec6789c438cd8b3b1604b18b41e2ff816c2d
Merge: cda4623ef 18e02d755
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 14 10:40:16 2011 +0000

    merge bug23765 into default (current sync interval in queue_process and msg_store causes poor confirms performance)

commit 32d11d570edcf1ae20ef5806e23edca47ae00ad6
Merge: 3a4196aef 82d3a143a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Feb 12 21:00:13 2011 +0000

    Merging bug23727 to bug23554

commit 3a4196aefac0f4183eb98503bfbd360c6e0a2ceb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Feb 12 20:59:39 2011 +0000

    Added documentation for gm 'become' callback result

commit 82d3a143a70c5ed67f1e5eec0920d89e703dc8a6
Merge: d7b850ed5 970bab419
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Feb 12 20:55:11 2011 +0000

    Merging bug23829 to bug23554

commit 970bab419d2b9ac53a6e619c28455ddcd6f611d8
Merge: 18e02d755 5d048144d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Feb 12 20:54:33 2011 +0000

    Merging default into bug23554

commit d7b850ed5013f566fe0b43947c38d50b43b4bbc3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Feb 12 15:26:31 2011 +0000

    Added documentation

commit 0a45352fcee38d2b4e6e70e0153612516fb4e185
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 11 17:56:09 2011 +0000

    Remove rabbit_msg_file:scan/2

commit 9380e46a44d2faec7278a0471a2cd6893f041885
Author: Tim Fox <tim@rabbitmq.com>
Date:   Fri Feb 11 17:46:30 2011 +0000

    moved call for call deletion notification into Fun

commit 803bbd4354d3d20624abd589aab199d9a7823b7b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 11 17:28:13 2011 +0000

    rabbit_msg_file:scan/4 now looks a bit more like fold
    
    Also ignore garbage at the end of a message store

commit 6172b0449bdb68148bb4bbdb53b3fb1053c2f19e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:24:44 2011 +0000

    Do rollback first so that reader will catch DOWN if rollback errors

commit 99f60e689edfcfb63f30d1b426f82a70ddd0160e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:23:37 2011 +0000

    correct comment

commit 5a6064f8baaab464e3877d22a0f2cc66cb9371cd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:22:13 2011 +0000

    Demonitor on channel_cleanup

commit 4279f12c8d9acc06cdfbcf30c0bab2bdc97a5740
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:19:29 2011 +0000

    Log in the case of an uncontrolled, unexpected channel exit

commit 8e7fe927028fb341ced2a9a30255e8e78d19587e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:07:31 2011 +0000

    Remove needless variable

commit 622a070edabc230d72bffadce71b03baf52acafd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 15:06:28 2011 +0000

    Correct rabbit test for new channel exit sequence

commit 2cd46719d931ae06c5df89a0c1e96c3a32756588
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 14:52:32 2011 +0000

    Always erase both channel and ch_pid. This is lovely - it makes it a proper bidirectional mapping. All java tests now pass again.

commit 608549f7e76a60b9f9448b4ca9b77157955f98ee
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 14:30:02 2011 +0000

    Add ability to change backing module dynamically

commit 6398ee3c7c0908e8364b3af9e46860426580780e
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Feb 11 13:54:29 2011 +0000

    Use serial number arithmetic for credit

commit eec000ad98d1a4cf1cd0638ab97b20c7c8fead73
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 13:27:28 2011 +0000

    drop CPS in favour of explicit API

commit 2bfc5a5d00549c76e484ad4613fb7f8f3096adb6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 13:18:54 2011 +0000

    Move the state modification into rollback_and_notify

commit 5510373266051521648e0388877eac481669d864
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 13:14:27 2011 +0000

    Remove boolean shouldClose from response of bin_gen:map_exception

commit 90f31d6af6b02fd6723692df32c8e31fe71f5c65
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 13:07:51 2011 +0000

    cosmetic - moving protocol field up.

commit 6d1e427077d3f46ad0813dc77393d71286163dd1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 13:04:21 2011 +0000

    Remove hardcoded protocol now channels have the real protocol

commit 21f09a4abc9b89aa6649397c9be458eee5e8a38d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 11 12:51:50 2011 +0000

    Upgrade messages

commit cbaf7acb4d20f0e9f3823762dad00410edff857a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 11 12:38:26 2011 +0000

    Remove annoying documentation

commit e289045b11b859ab994d3709d3dd4e2af8ef722a
Author: Tim Fox <tim@rabbitmq.com>
Date:   Fri Feb 11 12:11:43 2011 +0000

    remove commented out code

commit 07a26591193b98fc3e6882fb14328612b9251313
Author: Tim Fox <tim@rabbitmq.com>
Date:   Fri Feb 11 12:07:40 2011 +0000

    Refactored handle_call({obtain, ...}, ...) into single headed function

commit ba2a471143cd3c8b00a05f99d8692c6df55bd053
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 17:55:35 2011 +0000

    Whoops

commit fee41ed44058192fe3d877203c674bb1e934ea4a
Merge: 4c2afec2e 18e02d755
Author: Tim Fox <tim@rabbitmq.com>
Date:   Thu Feb 10 17:49:33 2011 +0000

    merge default into bug23575

commit 3f16737601797b59724cc037449024b1fdd90a32
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 17:16:28 2011 +0000

    The channel.close_ok from the client might be immediately followed by a channel.open. As such we must make sure that we send the channel.open to a new channel

commit 89a2adc676e8ef3deba8b3423878c763d8aca2f5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 17:08:24 2011 +0000

    close_channel is no longer needed in reader, which means that closing as a channel state is no longer needed.

commit 0acdd1c4779dfb229a3fd2538b4bab2c60aa77a3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 17:06:42 2011 +0000

    Always log the error from the channel; can now guarantee exceptions that turn up in the reader are hard exceptions

commit 2dbe5a1de702f23455d9826d778af160346809e3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:56:10 2011 +0000

    Log soft channel errors

commit 94782088c4e3513a5605fb9d1d2c9cc8fa642278
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:52:09 2011 +0000

    cosmetic

commit 2178f650113a62b301fdbe58cf7bbbb93ebdc2f9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:51:32 2011 +0000

    Tidy channel termination (state=closing implies rollback_and_notify done). Erase both ch_pid and channel from reader state on DOWN (required for soft errors in which the channel issues the close, waits for the close_ok, and then stops normally)

commit 4c3f54da738298c79e3422af63f0c4a343f20d6b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:34:08 2011 +0000

    If we receive a channel.close whilst we're closing the channel already (presumably client and server initiated close at the same time), then make sure we still send back the close_ok

commit 4c2afec2ee1a8b858017543b0531bc759b9e39e2
Author: Tim Fox <tim@rabbitmq.com>
Date:   Thu Feb 10 16:32:03 2011 +0000

    Added code to raise or clear alarm "file_descriptor_limit" when transitions between
    being able to obtain file descriptors (e.g. for sockets) or not, and vice versa, occur.
    Method adjust_alarm contains the logic to set/clear alarm based on previous and new state.

commit 41ddcdf2ee8b174bd5ad3a621e83080e71b0c8f0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:30:55 2011 +0000

    server initiated channel.close: keep channel alive until ch.close_ok is received. Make channel responsible for deciding on the severity of the error

commit 20bfae49c046cc3978a46b2de9faabe6241ce97f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:17:00 2011 +0000

    Ignore methods to the channel if we're closing

commit 090521e9a8b01c1286d3ba15f045f627f9845d84
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 16:11:12 2011 +0000

    Make client-initiated channel.close work in new scheme

commit cc6a2cffd0e8c4bb1a13e5acca2fc3d18d3867ee
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 10 15:59:14 2011 +0000

    Pass protocol through to channel

commit 18e02d755fa9d0d5279b76fcfbedc40bb06cc036
Merge: 3fd2ad495 086240048
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 10 12:54:57 2011 +0000

    Merged bug23811 (no need for amqqueue:notify_sent to use delegate)

commit 3fd2ad4953f0b120c3b0cb4967ff380e87e70c39
Merge: a86d24c4f 820110edb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 10 10:51:26 2011 +0000

    Merge bug23813 (abstract rabbit out of delegate)

commit fee276a98263d5dd0f458309fc2d16bed46cca44
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Wed Feb 9 17:52:18 2011 +0000

    Separate calculating the credit from updating the state, and do it properly.

commit d62fe30b4b922a62660deea0c9283da7a4b603a8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 17:03:54 2011 +0000

    Remove io:format

commit d743c195c35ef618170d720ef77f6f543220905f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 16:56:18 2011 +0000

    Add pid to rabbitmqctl status.

commit 190f53514c8313a12b8a9bea1f2b63e55d072ff8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 16:52:05 2011 +0000

    Undo 3b4956543c30

commit 4bccb8b893fd3557cd12b4dcef903d3f347ba367
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 16:27:48 2011 +0000

    http://refspecs.freestandards.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/iniscrptact.html:
    
    0       program is running or service is OK
    1       program is dead and /var/run pid file exists
    2       program is dead and /var/lock lock file exists
    3       program is not running

commit 18fd3422bbd6ce30e7975b7306afd4bd501358e4
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Wed Feb 9 16:27:42 2011 +0000

    Use a base for basic.credit, to account for messages that have been delivered but not received by the client

commit c10d8e1111fdf617b935f771efd1dc982c05b449
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 16:25:51 2011 +0000

    Correct the behaviour of /etc/init.d/rabbitmq-server status

commit e0fbba695861c1d660dddde1b50ccd045f7571b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 15:59:17 2011 +0000

    Use setsid rather than nohup.

commit 820110edbcaf070a9a242342339d7096e95922d6
Merge: f0731cf3a b87905852
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Feb 9 15:44:27 2011 +0000

    merge bug23806 into default (Re-declaring a queue on a different cluster node fails)

commit e47b685cc8c9c89606a0eb8d9cb6910b032fe25e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 12:50:08 2011 +0000

    Remove pointless test, fix comment.

commit 41884c84d1bbb306d7cd0dae62874d69a7e9c3d0
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 9 12:16:20 2011 +0000

    Only clear encoded content when necessary

commit c8a4be6e5c1bf52aff825eaa7bb034cd8a87d16e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 9 12:01:21 2011 +0000

    Sender-selected destinations - qa feedback

commit ea6524854d5674bd5dacabad3e183bc4c8ea3a5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 11:48:00 2011 +0000

    Reverse to avoid negated conditional

commit f0731cf3ad786ce3de8cf9810f54ac95e6c181ae
Merge: 0aa1f7e5b 462df5dd6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 9 11:03:19 2011 +0000

    Merge bug23792 into default

commit 3259110d99fab149cd1d29b52e5ed5c644fe2ef2
Merge: 31e0664c8 0aa1f7e5b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Feb 9 10:30:09 2011 +0000

    Merge with default

commit 9b10c994f7bb39dac5de2a43c1a21301a164a930
Author: John DeTreville <jdetreville@vmware.com>
Date:   Tue Feb 8 17:23:53 2011 -0800

    Sorry, accidentally shipped some changes to Makefile that I use for testing.

commit 41f4a7f7963faa9cfcfe1124d34ca337efe2a48d
Author: John DeTreville <jdetreville@vmware.com>
Date:   Tue Feb 8 16:21:17 2011 -0800

    All tests pass.

commit 054d57f33c9e35d2d6b93fb8317093906e93fd72
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 18:44:19 2011 +0000

    Trailing tab and whitespace

commit 6a123a92e442e51b27708e318f633936e45db4a1
Merge: 0aa1f7e5b 6a11b9ab7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 18:10:43 2011 +0000

    Merging default into bug23657

commit 6a11b9ab7b83ec0ac2eefdf7230c795fcb268057
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 17:28:32 2011 +0000

    formatting

commit b879058524de9e611c1d20f44ff0ecebed4e564d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 16:47:57 2011 +0000

    Added test which covers the mysteriously dead queue on queue declaration, and hence misc:is_process_alive

commit f6c454a7edba6b62ca74405531503370f8f78246
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 16:06:35 2011 +0000

    I need a much longer timeout for these tests...

commit 8cf44aaac75ea0c85108a5b6367f29fbb91e44f5
Merge: 15eb1dc86 0aa1f7e5b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 16:06:11 2011 +0000

    Merging default to bug23806

commit 0aa1f7e5b8c6eafca9ed19acf9b729403066625a
Merge: 89f1a813c e3896507c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Feb 8 14:00:22 2011 +0000

    merge bug23814 into default (misc:with_exit_handler is missing a match for nodedown and shutdown)

commit 89f1a813cf468345aa1f8f8c9dd20ab42da2567d
Merge: 6f9e00562 b1c9b0498
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 13:36:42 2011 +0000

    Merging bug22698 to default

commit a86d24c4f70a3e0236093f35b441c9cb47af7e88
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 13:17:00 2011 +0000

    Move the booting of the delegate to rabbit

commit 15eb1dc863da3aa26ca02f2b5dd3406ede356387
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Feb 8 12:37:13 2011 +0000

    abstract out is_process_alive

commit f793796dcf5a5e2ed91eeab012e3a6ddfcd9fe73
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 17:22:40 2011 -0800

    Dies in rabbit_channel:handle_info with emit_stats msg. Will fix typo in the morning. Also dies in com.rabbitmq.client.test.server.EffectVisibilityCrossNodeTest.testEffectVisibility test, but so does the default branch.

commit 88e0d1eb4f991fcb51c8e1b438f2685250e28ba5
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 15:43:11 2011 -0800

    Updated rabbit_amqqueue_process. Ready to test.

commit 6ab77cedd14dd8081ac8d8747831a5a9b5ab95e2
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 15:20:57 2011 -0800

    Updated rabbit_event and rabbit_reader. Removed accidental tabs from file_handle_cache.

commit dfd8faa35a6caa9a265606ea1dfef086bce15815
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 15:06:16 2011 -0800

    Updated supervisor2.

commit 060300fe210402c240b28297b487dbb2d234b2a4
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 14:58:10 2011 -0800

    Updated rabbit_msg_store.

commit b1c9b049883dcf1b4a0f13e7b7f288ae8047722c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 7 22:52:49 2011 +0000

    remove listeners when the rabbit application is stopped

commit c7947095354436520ff5c5632dddf53c96bda81a
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 14:45:08 2011 -0800

    Updated file_handle_cache.erl

commit aba5c6643970c12b220f82fdda1b82bae338458b
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Feb 7 14:32:17 2011 -0800

    Branched new bug23504, based on more modern default.

commit 6f9e00562be2166c0f58ebc5f3f959cd7daf0ced
Merge: 013a60ff0 25a2afa63
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Feb 7 21:34:11 2011 +0000

    merge bug23804 into default (ssl connections dying prior to R14)

commit 5a6d9c31b5f5a1779c952fb1d435b3f496cfa012
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 17:10:35 2011 +0000

    remove non-rpc'd call to is_process_alive - now matches the rpc version in amqqueue_process

commit e3896507c579837b43abac9f58ecfbe498d5a6a6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 16:50:11 2011 +0000

    Make with_exit_handler more robust and able to cope with the other forms of shutdown and nodedown

commit 833101199e8440028e25303c0085134789816d24
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 16:36:10 2011 +0000

    accomodate both forms of nodedown

commit 086240048ba0500bc5d802a1876207ce707b5ddc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 16:35:05 2011 +0000

    use a plain cast, not delegate

commit 013a60ff0c1093d26319e90926ddfd32c3db48da
Merge: 9aa8ea2cb bdaad0a36
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 7 16:10:25 2011 +0000

    Merged bug17383 into default

commit 6047226c7a3b4b9f809c7ee0dfee94095110011c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 16:09:06 2011 +0000

    Abstract out the rabbit from delegate (also improve robustness)

commit 0a2bd319234af1c68a5fcf425dd1a6ad0a871eea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 16:05:02 2011 +0000

    Just depend on "erlang".

commit 31e0664c802a7a19a70ef310f6738c0e1ce21e76
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Feb 7 14:23:01 2011 +0000

    fixing binding recovery

commit 9aa8ea2cb1f0b4a74c624ffa777b592300fdfef4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 14:04:39 2011 +0000

    Check Erlang version.

commit c915c6c9d79f572478f71cbcaed64cd3636e224d
Merge: 74d4121e6 bdaad0a36
Author: David Wragg <david@rabbitmq.com>
Date:   Mon Feb 7 13:47:54 2011 +0000

    Merge default into bug23568

commit d018108294d6519a501a973c45d34cc4c9a4623a
Merge: 8614e2ba6 bdaad0a36
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Feb 7 13:32:11 2011 +0000

    merging in from default

commit 25a2afa6379d638201dda02f49a52c043a879f91
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 12:22:52 2011 +0000

    Keep the same formate as ssl:connection_info

commit bdaad0a3695966511c0f8e282705945ca7427647
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 12:20:31 2011 +0000

    Remove intermediate variable.

commit 553d47d65ec42e7b92ece353a60a7c14110ea2c1
Merge: 77ba4b3dd 845a759f8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 11:42:35 2011 +0000

    Merge bug 23061 into default (spurious heartbeat timeouts possible during connection termination)

commit 8d2705b0c206c90f8e83068c09aa3498bb638c1d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Feb 7 11:27:47 2011 +0000

    Fix SSL connections in R13Bx.

commit 2578d9303980cd66e973f7981f1d8ae076ac316c
Merge: 77ba4b3dd ebcd774c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Feb 7 11:12:43 2011 +0000

    Merged default into bug23483

commit fd293acf0f1ea779b51d5897ee26f7fb5ede148a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Feb 7 11:10:37 2011 +0000

    Refactoring, cosmetics, consistency, return codes

commit 77ba4b3dd4a52307c73002aa201c0e444f14416d
Merge: d894c6614 21e2b0e5c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 4 14:48:11 2011 +0000

    Merging bug23768 to default

commit d894c66145f4cd5cc2c5861cc66e4eedc81811e1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 4 14:39:56 2011 +0000

    update documentation

commit e348eb299bb90565187bb7e796b2d0cae06d1ffe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Feb 4 14:39:04 2011 +0000

    Use a list comprehension to match rest of codebase and save a bunch of characters

commit 55f5c2a8fdb5d243ffb7414faf84c1626da80c87
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Feb 4 14:18:19 2011 +0000

    Remove redundant try/catch from event notifier

commit 66c930e09b540ce2a68cfdc642f463a12f68c13e
Merge: 75a898bd6 21e2b0e5c
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 4 14:03:41 2011 +0000

    default merged into bug23533

commit 91fa60797b8183a2dcd3ceac362f78bfb9560b1f
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 4 13:42:51 2011 +0000

    cosmetic

commit 79586c1a0b2b788105da3c84ff8e207e025e6694
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 4 13:39:35 2011 +0000

    Treat basic_return immediate/mandatory differently

commit 9814ec9dfa85081f6866763d1ac09e0d413153a5
Merge: 8de967079 21e2b0e5c
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Feb 4 12:11:49 2011 +0000

    Default merged into bug23580

commit 443fa7f8bb386ef50606030b65ac44807968375e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:52:09 2011 +0000

    Don't copy cookie to %APPDATA%. As far as I can see, $PROFILE == %HOMEDRIVE%\%HOMEPATH%, but those last two are not available in NSIS.

commit 3b94a636b2265d22a08bd7807485876ae0073a1e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:45:19 2011 +0000

    Use the standard NSIS uninstaller icon. It's quite ugly but it doesn't look like the Rabbit icon, and Windows icons are hard to use.

commit 3ad533ff1614aa510ed97216e72f0d9b549b83c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:35:33 2011 +0000

    Transparent icons

commit 3cdc44ae845fc236b85d7aff99a126fcf901bf1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:28:47 2011 +0000

    Finish pages, explain on the uninstaller one that logs / db are still there.

commit a4a50c12905bba6dff277bf454bdd9365cf44769
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:14:13 2011 +0000

    Consistency

commit 4fe531c1ed2fe9bc62093d6e0f1abb9f3f41f58a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:07:37 2011 +0000

    Move install dir registry key under "VMware, Inc."

commit 1d5c929cb1acbdbe3e8c870d25f85be5b5afe56e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 17:04:09 2011 +0000

    Rename "RabbitMQ" to "RabbitMQ Server" in a bunch of places.

commit 71e720a3756155d453bc0206139030107ca2615d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Feb 3 16:13:56 2011 +0000

    Rename rabbitmq.conf

commit 21e2b0e5c98862504b3a43f739ced2c77691aec3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 3 15:52:59 2011 +0000

    Update documentation to include connection.secure steps

commit d5bf80b0ec626dd143dd3ce1fea40b2740ad58e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 15:49:12 2011 +0000

    Remove redundant fields from credit-ok.

commit dc62002ef29b02bb281a000c4a3867c5f7c3f1a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 14:05:05 2011 +0000

    Added tag rabbitmq_v2_3_1 for changeset 82e6a8017630

commit f26d1d9e0a989153460f25876bd9deaa825502ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 14:04:29 2011 +0000

    Changelogs for 2.3.1

commit df50089104691e22563b29aad434195ca1abe049
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 13:38:11 2011 +0000

    Change mind again on how this should work - have a synchronous reply method, and an async method for spontaneous notification.

commit 79d966f297ee8ddaea0c8a264a0206a31d9eda90
Merge: a6db8d1c2 b78070dc6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 3 12:59:15 2011 +0000

    merge from default

commit a6db8d1c20d477ffd3be420bf12a51214792b126
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Feb 3 12:52:18 2011 +0000

    add test

commit b78070dc6d9400049f0d1746bdc1dce997f5c521
Merge: 714ff5f0c 6773a4905
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Feb 3 12:18:51 2011 +0000

    Merged bug23793

commit 714ff5f0cb4447b4a6399a5fdb244af1aae0c22c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Feb 3 02:00:12 2011 +0000

    Ensure all call sites of BQ:idle_timeout subsequently call run_message_queue to avoid violating queue invariant

commit 173fc2f73c15217f607a1887521af8d05f775f04
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 2 18:12:45 2011 +0000

    First version of renaming rabbitmq.conf

commit 08ffa97ff979eb28302bba5eb2b1ab00fa690f07
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 17:36:48 2011 +0000

    Send a credit-state when magical draining happens.

commit 462df5dd6615d1acec23b997f14693e3c449713f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 2 17:30:41 2011 +0000

    Make tcp listen options configurable

commit 6773a4905b1c7505b517f248db536967c18fcb61
Merge: 967272294 b60beb02d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 15:33:16 2011 +0000

    Merged heads

commit 967272294f31e5c962a7b43bdeffe155ab4d186f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 14:13:14 2011 +0000

    Added tag rabbitmq_v2_3_0 for changeset 5ab55c446716

commit 8481fa2b983ef0e748bb28a4805725c8ac48fa83
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 14:12:33 2011 +0000

    2.3.0 changelogs

commit ebcd774c1bc96a908262a67635863dd1af8c2849
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Feb 2 13:41:24 2011 +0000

    Refactored sender-supplied routing keys

commit a8f202f13a00cd8819bd4a0bdc6a69420ad67389
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 12:40:13 2011 +0000

    Return a basic.credit-state after receiving a basic.credit.

commit b60beb02d6e6bca5e9deb8d65efd0f9d2348ad3c
Merge: b89148764 594d856c2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Feb 2 12:31:28 2011 +0000

    Merging bug23735 to default

commit 6178c2747d7b2a0a747f1d4e58a917dd7afeb12f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Feb 2 12:04:07 2011 +0000

    Credit needs to be per ctag.

commit 7c9bf8899d82442eaf759116005f4cab2e214815
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 1 16:53:28 2011 +0000

    Support drain (probably in a rather inefficient way).

commit 61c19a4a9abecc79916caf25847dcace23f66f49
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Feb 1 16:28:36 2011 +0000

    Beginning of channel.credit support. Tests pass, except for drain=true.

commit 74d4121e6af14658a21746d66cc5d5c2f2d17746
Merge: 594d856c2 55f5d3dc3
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Feb 1 13:09:35 2011 +0000

    Merge default into bug23568

commit b89148764e6d45d44c517130612529cdb4fddfc0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 16:49:59 2011 +0000

    Cope with values that are not strings.

commit 6db9a9cd8d0e0f9bcfa4ca011235da7e0e706ccf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 16:40:03 2011 +0000

    Fix the OCF script. Man, that was painful.

commit cda4623efe42ba493522f4f6476aefd9f5cdad3d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 31 16:23:56 2011 +0000

    Bump up sync timers in queue and msg_store to 25ms

commit 594d856c2c403e69ec921e769dfd3f3c01e8da8f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 31 16:23:03 2011 +0000

    Whitespace change to create new head of default

commit d8b31906dc69cc1fc725f5f244d5330806b00c61
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 31 12:19:47 2011 +0000

    cosmetic and addition of impersonal pronoun

commit dc2dfc47d67a27d6499b0142ce98f9dda738590e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 12:13:18 2011 +0000

    Tweak wording.

commit d2121c1982cb50308305b50df8684f2531605cf1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 31 12:10:37 2011 +0000

    make cluster nofitication a boot step; don't print to screen

commit d426010271c7ceccf28a841998bcac8dc276d458
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 11:38:44 2011 +0000

    Clearer error message.

commit a814f2e0e8e1ae7490e2b4d51034990bb8eafc76
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 31 11:34:18 2011 +0000

    cleanup after rabbit goes down on a clustered node

commit 68a0b3b3e3d72c537651ed0684f886a3def9ec5c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 31 10:59:45 2011 +0000

    monitor rabbits on clustered nodes
    
    When a rabbit starts, it,
      * informs every other running node in the cluster that it has
        started, and
      * registers every other running node in the cluster as running.
    
    This should handle every possible case of nodes joining clusters,
    since every join should be followed by that node starting.
    
    We can't just monitor 'rabbit' on node ups, since those come in when
    mnesia joins the cluster.  The rabbit process starts up a bit later.

commit 5ae99b11529026221caa66f54dc8d81c68891110
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 10:42:08 2011 +0000

    Consistency

commit cc0fc355a4fc589e3da4bd1b8ede8148f216bfd4
Merge: f702995d6 b3a85e8c2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 31 10:07:13 2011 +0000

    merge from default

commit f7ac30a46bcd300487fa8153e1e95d8f620b4147
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 31 09:54:47 2011 +0000

    Remove unhelpful advice

commit 5a149c9047487e6daef073c661d5951569b81a0a
Author: David Wragg <david@rabbitmq.com>
Date:   Sun Jan 30 09:02:12 2011 +0000

    Make the USE_SPECS erlang version check more robust
    
    And eliminate extraneous processes forked on each erlc.

commit 55f5d3dc379f865aed2b579df754cd4b2b07af55
Merge: f702995d6 a8e3eb676
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Jan 28 17:10:20 2011 +0000

    Merge default into bug23568

commit f702995d658e363c0d92c5b2b30d2b8632550f0f
Merge: 099b31a9f b095990dd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 28 17:08:31 2011 +0000

    merging bug23696 to default

commit 099b31a9fe3e41efbdd1d7927fec596a9f896369
Merge: f1b522352 30d377732
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 28 13:17:00 2011 +0000

    Merging bug23410 to default

commit 8614e2ba638d2c3b8fa6c2e3d647458c40b12190
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 19:18:49 2011 +0000

    cosmetic

commit 10aabbbb1c923b3d570f387170ab36b5f1b46751
Merge: 8393b7944 4dff8573b
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 18:53:58 2011 +0000

    merging in from default

commit 30d3777324f868299552b846d633549cd1f7879e
Merge: 36661cc56 8393b7944
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jan 27 18:53:21 2011 +0000

    merge bug22252 into default (how does basic.recover affect basic.qos limits?)

commit 8393b7944dfcbe47ddc948261776d08f29dbd770
Merge: 55f0abb50 9b488b959
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 27 18:21:10 2011 +0000

    merge bug23546 into default

commit b095990dda3c30f250bbc96515dacd2ea4eafeed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 27 18:18:39 2011 +0000

    Cope with the possibility that the user of the delegate mechanism is not on a node running rabbit

commit 4dff8573b42b2fbc607e3070cd8295345eb18fd0
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 18:11:44 2011 +0000

    cosmetic; using accumulator in trie_match

commit 914ce746d14e9e213d437804714866bcb8dba57c
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 17:16:52 2011 +0000

    removing network_listening and direct_listening boot steps

commit 55f0abb50c09492ae60057f825e7e7b3446fed1f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 27 16:39:27 2011 +0000

    Stop the channel crashing if we requeue to a dead queue

commit 9b488b9597a087ff3c04dffdb67d872f67e15597
Merge: 3a2f498db 4605a42a7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 27 15:40:46 2011 +0000

    Merging bug23756 to default

commit 3a2f498db393ec22b15e96ea65fdcd46d006d8d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 15:15:15 2011 +0000

    tabs to spaces.

commit daa8828b518753df5d5036ba2c61d2ceee7d64ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 15:13:44 2011 +0000

    Add --disabled-login

commit 3b7cbaeb6027215b1db1fc0f48754ae375ed8aff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 14:18:57 2011 +0000

    Fixes for Windows XP: set our own environment too, invoke batch files via cmd.exe.

commit 86a5fb36baef27c040cbb812c9e54ce3ef87b083
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 14:11:05 2011 +0000

    changing exit's to {error,}'s in rabbit_direct:connect/3

commit bfd62917ab78f93a2c5cf51b1bdc9b382bdd4638
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 14:06:54 2011 +0000

    Stick the version in the name, compress more aggressively.

commit bd2e39ece0804717e1d8afd81594690745f55871
Merge: b56cb08c1 4605a42a7
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 27 13:49:27 2011 +0000

    merging in from default

commit cd2d66b99ce6031d776989d1a12314af0b719781
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 13:36:32 2011 +0000

    Close the installer after starting the uninstaller, to prevent people accidentally bringing the installer to the front and continuing.

commit 8d5bdd249ab6f98bf9dd04777afc64e521909ebf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 13:12:10 2011 +0000

    Unset ERLANG_HOME on uninstall.

commit 532dabbacd7ce07970c7c080be3d499b4b6877b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 27 12:50:03 2011 +0000

    Create db and log directories in case the service isn't installed.

commit 4605a42a7f1371578bf089fd39735ad6d56d4e7f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 27 12:21:44 2011 +0000

    Correct specs

commit 1ed46ae197155be72bcf86182a55ff3f77957b48
Merge: 1113838e2 f37fd4288
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 27 11:15:54 2011 +0000

    Merged bug23744 into default

commit 36661cc567b10297605c78c50ed5e9c417dbff0e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 26 17:35:43 2011 +0000

    On recover with requeue=true, notify the limiter of the requeued messages

commit 1113838e23b5ac79326ffe0d1eef47be967a4441
Merge: b6bfd478a 974712493
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 16:57:17 2011 +0000

    merge bug23742 into default

commit 82cacdb803af012b0e1481f99703e226dc923ed1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 16:39:08 2011 +0000

    Oops.

commit 974712493c62eaf8e69e98dd9caa5dbcfecee0dd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 26 16:36:15 2011 +0000

    Make the supervisor2 delayed restart test suite passes again

commit fc7dcd5b3f190cfb60463f6b9f298c27f1f7fe35
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 16:28:10 2011 +0000

    Treat all {badrpc, _}s the same. Use which_applications/1.

commit 306afd02529066aeb470a118f106d14dce441742
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 16:12:13 2011 +0000

    rabbitmqctl status is not adequate to wait for the server as it can return
    successfully when the vm has started but not the app. The app can then fail.
    Therefore introduce a new command to wait for the app to start.
    
    Note that this subcommand contains a timeout to wait for the VM to
    start, but will wait indefinitely for the app to start once the VM
    has.

commit f37fd428890c3d00fe30cde61097577f6a7eb921
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 26 15:44:05 2011 +0000

    If there is an mnesia entry for the queue and the qpid is dead, then remove the mnesia entry, but still return the existing queue

commit 70622ed6f20718060271c8b895560cfea98cf5f6
Merge: 462f4544f 73711540b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 15:43:38 2011 +0000

    merge bug23748 into default

commit b6bfd478aec71c1afb13a87ef707d31d2d340f35
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 14:31:49 2011 +0000

    inline two funs for compactness and clarity

commit 17054cf64e892489f4313643a02b46b5cef292e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 13:42:44 2011 +0000

    simplify

commit 8b22b74269c19286a6c2988f58c66696e3930f69
Merge: d841573ed 462f4544f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 13:40:35 2011 +0000

    Merged in default

commit 8ed91d0d36a7f7ab1bf0200938069d9d7cd60770
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 13:31:00 2011 +0000

    refactor 'write' handler for clarity

commit f1b522352caa0e6b21c7e03aaedac07c17ce1b3c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 26 13:22:26 2011 +0000

    don't log stats for nacks (originating from queue deaths)

commit 73711540bfe3741072ce9abcfa77b3e5c1af91f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 26 13:08:37 2011 +0000

    Remove dead pids from children when we're delaying the restart

commit 83a14d19e4034a69182a582e2b371c8c80f283f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 26 12:37:55 2011 +0000

    return State from write_message rather than it calling noreply
    This makes the API more consistent (cf read_message etc).
    Also, shuffle order of some write actions for consistency

commit 697c54ba507ce631d93e9b8cec95c01a132aa51c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 12:32:34 2011 +0000

    Change the new version format from:
    
    [{local,  [...]},
     {mnesia, [...]}].
    
    to:
    
    [{rabbit, [{local,  [...]},
               {mnesia, [...]}]}].
    
    This is to allow for future work allowing plugins to own upgrades (that
    can be ignored if the plugin is uninstalled), without having to change
    the format *again*.

commit 462f4544fd733e95086dc13bbac1d5b2fed88506
Merge: 1b2497cd8 1fec0bea2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 26 12:22:38 2011 +0000

    Merging bug23736 into default

commit 0c9d75ada079600d96056defd5fee53a6e19b28e
Merge: 1b2497cd8 fe9f73e59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 12:19:50 2011 +0000

    Merged in default

commit 1b2497cd867f1fa8c38845086797b44c77360c70
Merge: 5a8b5e0e7 81aae5e2f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 26 10:42:31 2011 +0000

    Merge bug23602 into default.

commit 9859c07faafdf98bc8a944ed94ebd60a61ded7c9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 20:38:58 2011 +0000

    nacks instead of rejects and coalesce

commit 78c02d4264a587ab7615cdf4747f042458dc6b4c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 25 19:00:36 2011 +0000

    If we don't actually write the msg and the msg isn't in the current file then delete it if its pending write count is 0

commit 16a2a38d775e3831e7dbc4b6856af67e823c3de0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 18:03:40 2011 +0000

    Start / stop service links.

commit 3967ae179ff45c87df34fdcdeca8f33fdc633fbd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 17:57:33 2011 +0000

    Be a bit smarter about what we remove.

commit 32b8611ce6529fb79acef8c1f781006fcbaff076
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 17:34:39 2011 +0000

    Those backticks bugged me.

commit 4952f14eefc6225affadea6f7cd5f949878fa7fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 17:33:46 2011 +0000

    Check for Erlang as soon as we start, and offer to help the user download it.

commit 5a8b5e0e7466e1f736c3a5bc16350b91c11ef4e1
Merge: 42520718d c13727fe2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 16:01:50 2011 +0000

    Merged bug23740 into default

commit 1fec0bea26273f442534ad8e9bd2e79721f9c1de
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jan 25 15:23:59 2011 +0000

    Support R12B3

commit 42520718df65cba3516d1dbda623de5a60830f21
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 25 15:22:56 2011 +0000

    On pre_hibernate, report the real ram duration, not infinity. The assumption that pre_hibernation implies hibernation that will last for long enough for the ram duration to go to inifinity is not correct.

commit b3a85e8c2486ac9caf0d996b925b5be9eb56e7bd
Merge: 69b0e6573 c13727fe2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 15:21:20 2011 +0000

    merge from default (rabbitmq-multi works again)

commit c1738454714aa5dc09cce97b0b32f16bd6749c5c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 15:17:23 2011 +0000

    Consistency with other packages.

commit 01516a5a7680eeebb3e5a8fbd782b09ff7f50f5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 13:37:20 2011 +0000

    Add sbin directory to path for ease of rabbitmqctling.

commit c13727fe2b6a27e5c164d3bf081bb1290ba9667a
Merge: dfa3b00ed a77983869
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 13:13:47 2011 +0000

    merge bug23582 into default (rabbitmq-multi start_all fails ...)

commit 69b0e6573049f1c9330bffec65a7fb7a3471d358
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 13:04:59 2011 +0000

    monitor the rabbit app on some remote nodes

commit a7798386993ac748ad3ac7bfe66663dda824e8db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 12:59:47 2011 +0000

    Cope with the new style port-only listener type (but limited to IPv4 when starting multiple nodes).

commit 197ef224e4ed64d5e90c68be8d908bd6f96ee989
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 12:59:15 2011 +0000

    Revert IPv6 changes to rabbit-multi*.

commit b91cdc21d0e36cdd7bc7b5a4caf76bb6bce9e140
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 12:34:25 2011 +0000

    More entries in the start menu.

commit d9fa4c00141fd751a26db9ce7a24116ec7612d52
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 12:29:06 2011 +0000

    Fix uninstall icon, show better uninstall information.

commit e63b2ee626d3c7a8356302367b7e1795ec2e1df3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 12:06:14 2011 +0000

    Minor bling.

commit f9b811b127b93e8dce1c1ebd023797274d37a805
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 12:05:41 2011 +0000

    register the almost-top rabbit process as 'rabbit'

commit b05e76a612ab4a7d5b7bfbdc35469ba1abedb3af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 11:52:11 2011 +0000

    Add some version info to the exe file.

commit 665231abe63b59caea9c569a5791d9f2160efccf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 11:43:05 2011 +0000

    Add some links to the start menu

commit 76be9e739b05d44cbe6f6d0ac198d56636b12a0c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 25 11:29:33 2011 +0000

    send rejects instead of confirms in case of non-normal queue deaths

commit 04e88967d09d1fc14a7ec4a4c0dc27387b44f72d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 11:13:14 2011 +0000

    Sync Erlang cookie to both places it could be

commit 91edc19ceedeb0289bc4d1ca8d2a1d470d38f953
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 10:57:11 2011 +0000

    Set up RabbitMQ service.

commit 56739d42889e21bdbebda573838a4902d366515c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 10:39:20 2011 +0000

    Remove previous version of RabbitMQ first.

commit 980034c74b3c5030498419cbb42c1853a21d833e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 10:31:03 2011 +0000

    Actually set ERLANG_HOME.

commit 7fa2a589e2b85d5ad9a4b9021ae0d5667555f959
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 25 10:18:07 2011 +0000

    Section descriptions, make a while load of the text actually appear.

commit 2db8dbb786c663e8a55022660b533fff7969ecae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 24 18:22:51 2011 +0000

    Locate Erlang.

commit 99dd4cb5e7b288856016265fd14d48ce74839353
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 24 17:40:26 2011 +0000

    Treat sender-specified destinations as routing keys
    
    rather than queue names

commit e37e4ec481e8265802fe381779bd702164679082
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 24 17:29:39 2011 +0000

    The start of an installer. Just install the zip file.

commit d841573ed030ca47972ac7aa4ff74897cc4d1e3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 24 13:57:24 2011 +0000

    Untested changes to the OCF script.

commit b5f4ad4de0691a29d4ae22a840d4b6f830c1947f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 24 13:42:59 2011 +0000

    First pass at a multi-free init script.

commit dfa3b00ed59369d0134f3de7045ab0852c66dd49
Merge: c66e0cf57 1909c9337
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Mon Jan 24 12:36:45 2011 +0000

    bug23154 (ipv6) merged into default

commit 81aae5e2f164e2ef17153c8ca8aa2440bf73db88
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 24 12:21:14 2011 +0000

    Rework code so that it's even more efficient, handles errors properly and also more obviously implements RFC4616 correctly

commit f26e73a0c25b48c697d8f1c8d3a7904e20d32cae
Merge: 1909c9337 b2b3c39fc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 24 11:34:29 2011 +0000

    Merging default into bug23602

commit 1909c933792e91855f7434ae01115b66b285471c
Merge: 79dad9ffc 59587fa71
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 24 10:36:49 2011 +0000

    Merge 23534 into default.

commit 59587fa71b021132c728fc65451cd88fa43464b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 23 19:02:21 2011 +0000

    fix typos

commit 8fd59b132ec102421404f9cb50d0d47d24de2dd4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 23 18:56:51 2011 +0000

    dependently type acktag producing functions
    s.t. the "blank ack" case is manifest
    Switched from blank_ack to the more universal 'undefined' in the process.

commit b56cb08c1ef17676c2e946542e37d93418dc5110
Merge: baa1ac7e5 4f31a779a
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sat Jan 22 01:37:53 2011 +0000

    merging bug23696's two heads

commit 4f31a779adaa094a50dafca902ead1017c58519c
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sat Jan 22 01:34:35 2011 +0000

    adding rabbit_direct:connect/3 for the erlang client to use

commit e8319045ab4bac1fd7a0305796de0eade68fceec
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Sat Jan 22 00:08:36 2011 +0000

    adding specs to rabbit_client_sup

commit 5d048144d014ef181bccfecbcad20b90fef92f7b
Merge: 6d12e57aa 1678bb99d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 21 16:39:34 2011 +0000

    Merging bug23727 into bug23554

commit baa1ac7e53bead635f9e24191c62ff492b772bfd
Merge: baefffb00 04af35656
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 21 15:31:37 2011 +0000

    Merging default into bug23696

commit baefffb00838306772a6d470f96db0c432ce83bd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 21 15:23:03 2011 +0000

    Reverting bogus whitespace change (avoids file diff with default)

commit 9b8afc8d823e9547da15f174c4bda49df37cd05e
Merge: 7895b4c33 7eb8f63e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 21 14:35:19 2011 +0000

    Merge bug23201 to default

commit 7eb8f63e101d19ec6d7046c26159204f13508c94
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 21 14:29:55 2011 +0000

    Rename the info item for consistency.

commit 7895b4c33991208e4d2fa6236ff2a2bb1afa7961
Merge: 0b81b29dd 04af35656
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jan 21 13:15:14 2011 +0000

    merge bug23626 into default

commit 3695364c713b5a5476c61233eaea41a4beabf890
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 21 13:09:02 2011 +0000

    fold cases

commit af57a26e9a1a44ee9765460a07402c55e5583957
Merge: 04af35656 a3e6dc0f3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 21 13:05:57 2011 +0000

    merge from default

commit a3e6dc0f335f6ac21a20db9af9fd87994cac43d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 21 13:03:11 2011 +0000

    rename variables for consistency

commit 7f06ec4d32f45f5945a6106ed0202a872dd891d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 21 12:27:57 2011 +0000

    Correct unused variable name.

commit 1678bb99d157e94cf8c904a8ab39e1a5f3898be0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 21 12:10:41 2011 +0000

    bump year on copyrights

commit 83e91de7cb2c92ebc6e0cbd5da4b5a197ba70ce9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 21 12:06:49 2011 +0000

    Adding gm related files, plucked from branch bug23554

commit 6380b6a85717732b67f9591bd53a56289ac8ebda
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 21 12:05:06 2011 +0000

    Fix docs

commit 0b81b29ddf218d00b6f1b8030a7738caeb978fad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 20 23:12:42 2011 +0000

    move channel lookups into handle_ methods
    This avoids double lookup in some paths and unnecessary invocations of
    run_message_queue.
    Also inline recorde_current_channel_tx, which eliminates some lookup.
    And allow rollback to trigger the forgetting of a channel record.

commit e6fdc9a2e9a004b35ab67b7cb7d459ed61d63dea
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Jan 20 17:19:07 2011 +0000

    fixing type specs; other cosmetic

commit 04af35656ad30e621b238d0e1000f26b5f450f00
Merge: 1c7ea9f18 3aff2ac17
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 20 16:55:07 2011 +0000

    Merging bug23723 into default

commit 3aff2ac175d681b1b7d68b2a2cf0f12004180fcc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 20 16:47:23 2011 +0000

    handle errors in list_consumers

commit 98f95832792eac5d9d9216f1a36a360c2f98c864
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 20 16:01:05 2011 +0000

    Deal with the possibility of a ch DOWN overtaking other messages from the channel

commit c66e0cf5776ac89a4375c5bbc1df8cc9a52a8d4a
Merge: 1c7ea9f18 4ac7ba123
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Jan 20 15:49:16 2011 +0000

    default merged into bug23154 (ipv6)

commit 6d12e57aaa61b10df739e289086c499b130da52d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 20 14:24:43 2011 +0000

    And the result of misc:rs is a string, so format it as such

commit 28c6b18d0569ffe7b59b7a776d907be396a865b1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 20 14:18:38 2011 +0000

    Correct formatting of resources in log messages

commit 1c7ea9f1875eb3cbefab5828932b6aa1b7caf255
Merge: fbd631733 82d5f2c6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 20 13:56:41 2011 +0000

    Merge this to stop it dangling

commit f65f537b218312531ca3d8562dec5ecb467a0481
Merge: fbd631733 fa6928fc2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 20 13:46:52 2011 +0000

    Merging default into bug23554 (epic debitrot)

commit bd66179e0db81bb0703e521400470df89f6647d9
Merge: fbd631733 23d7a9e68
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Jan 19 21:27:03 2011 +0000

    merging in from default

commit 23d7a9e6877fdd22337fd3ddbd333ac607788a9d
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Jan 19 21:26:34 2011 +0000

    adding supervision support for direct connection channels

commit 2e89c5efb113625c428bc2bd29649134d9e8be86
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Jan 19 18:25:31 2011 +0000

    fixing merge conflicts; some stylistic adjustments

commit 4ac7ba12338146c3a6e396a1de681ec98d997e6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 19 16:03:19 2011 +0000

    Don't test on the real port. Pick a test port, and retry if we find any evidence of its being in use.

commit deab1769f73ec290d8c5d4f54c6b486e2e5ded93
Merge: fbd631733 ba4c0e4ab
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Jan 19 15:55:06 2011 +0000

    merging in from default

commit 8b52b75fd7b491694dd7eb150c93667795bd9b6a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 19 15:36:57 2011 +0000

    comprehensions are more concise

commit 4d304b3ff7ac467526c36749fad5c43688c12b86
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 19 15:34:33 2011 +0000

    Duh.

commit 2c708052321ff02a51940b3a55607a7e61c1b66f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 19 15:23:05 2011 +0000

    swap tuple elements for readability; inline a function

commit fbd631733f2e25c8842292e48d956f09ca8040e1
Merge: c8a8842af 48961866a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 19 14:42:22 2011 +0000

    Merged bug23434 into default

commit 8c823dc0a8b2f59102fe136ea30db8968439838f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 19 14:38:43 2011 +0000

    replace the sort with a gb_tree
    
    Instead of creating a list and sorting it, insert the MsgSeqNos into a
    gb_tree.  Dicts and orddicts are slower.

commit c8a8842af6d12e19e6a83a094d6af15d90397299
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 19 13:53:32 2011 +0000

    Correct all remaining copyright notices

commit f0dc513e2fa62f19e3731f3de8b0853d40757304
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 19 13:38:43 2011 +0000

    Correct copyright message

commit ad0cd7400e3e8613b5539d9149ac2ee3885895d6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 19 13:37:46 2011 +0000

    Update .erl and .hrl license boilerplates

commit cfeda21342b6b9d75f8d8043a8dce0d738d06ec7
Merge: ecf16c7f9 95dc7e75b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 19 12:59:33 2011 +0000

    Merged default into bug23483

commit ecf16c7f9b81b6d47f6441fa1d2a05c91b6cbfa4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jan 19 12:49:30 2011 +0000

    Sender-specified distribution for fanout exchanges

commit 941cda9b25547fdb4cd72f47f5d7af49b11e76c4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 19 11:15:35 2011 +0000

    Make port_to_listeners distinguish all the cases now, and write even more comments.

commit 410a95402743cb7d62c4201995ea2631a50b5732
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 19 10:52:53 2011 +0000

    fix break when stats were off

commit ae4e78b32d7ef089e4588bee4a8a3d7a1ec67b36
Merge: e844aa961 48961866a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 19 10:42:25 2011 +0000

    merge from default

commit 48961866a6b8f8fea8307a746d7a0bb0cbae4a7a
Merge: 4e42ee81d fdeb4e550
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 21:42:10 2011 +0000

    merge bug23705 into default

commit a0422a2e57a7b726e3689be2232d2d7a68e95648
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 18:14:36 2011 +0000

    Cosmetics.

commit dd37eae36ee3d1d0812ef9d36d316c0304136e80
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 18:10:20 2011 +0000

    Rename ipv6_status to port_to_listeners, make it return listeners, explain it more.

commit 4e42ee81d528ae47f3313bff98c5d2b0f517f1e1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 18:09:08 2011 +0000

    sync_timer => sync_timeout

commit ebcbafd902b299e9496c85452836b00add8f59de
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 17:55:36 2011 +0000

    Specialise the sync_timer in order to permit us to unset the sync_timer_ref

commit af522e38690917f4f26d72f6e82597c286454787
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 17:31:43 2011 +0000

    Allow gethostaddr(Host, auto) to return more than one IP address in the case where a hostname resolves both A and AAAA.

commit fdeb4e55099bc30286f7a90ac154f87c1c17b01a
Merge: df718484b bbd8c02db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 16:48:42 2011 +0000

    merge bug23631 into default

commit 6574ee12f9e23f3e82d396874638f366e4e6ae98
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 15:39:10 2011 +0000

    That's not needed

commit 363ab3ed22d724564537bc2be033347d9635897c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 14:18:36 2011 +0000

    Er, and this too, of course :)

commit bbd8c02db5cebe125986a455e60ef4723c9f4ddf
Merge: dda8f690c d52b7b16d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 14:08:27 2011 +0000

    Merging heads of default

commit d52b7b16d9c2b26db7c2eb2181975fc95df56e6f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 14:07:52 2011 +0000

    Correct specs

commit ccbad98f132b1c6d6c618cea318f051f617fb59d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 14:07:48 2011 +0000

    Satisfying bit first: remove rabbitmq-multi and all trivial references.

commit dda8f690c832398492d726bed5951a685587c02c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 14:00:20 2011 +0000

    Fix surprisingly long-lived mistake.

commit 1d304f6ae76d590255b02e61e3251e40d30d42f0
Merge: 99fefeb4f 78b440c0d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 13:47:50 2011 +0000

    Merging bug23698 into default

commit 99fefeb4fe33324b8825f6d98a488e83cda7e9fa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 13:21:51 2011 +0000

    Inlining

commit 291aba6a83904ea2eef77e6d52c1339cad7e05f7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 13:17:40 2011 +0000

    A little more abstraction never hurt

commit bf5db121bddedd855374e4d4c9c78328c808115f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 18 13:04:31 2011 +0000

    Some might say this is a touch over abstracted. It's quite pretty though

commit 36a9e21a8c6a8bf8c6b5aa5229ac1a900acf641f
Merge: 78b440c0d be1b799e7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 18 12:31:41 2011 +0000

    merge from default

commit e844aa9617630682e361336831db5b2b1a2c9408
Merge: c433ab14b 78b440c0d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 18 11:59:56 2011 +0000

    merge from default

commit c433ab14b06f8c0ffc276db3a5e2ab96d132c23e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 18 11:51:55 2011 +0000

    merge duplicate code

commit 78b440c0d9c5411afab5a0b975eab7970bc4f3d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 11:30:21 2011 +0000

    Or not

commit b658abd8ff843e00ea4194223e34174780825dbc
Merge: 7d8ddc459 619b95d57
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 18 11:25:41 2011 +0000

    Merge bug23689 into default.

commit 386bce76a9db23ae874e391106e6a524f2f28782
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jan 18 10:59:31 2011 +0000

    stats for confirms work again

commit 619b95d57bda575d1b639504d7623cf825cc5ba1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 08:49:38 2011 +0000

    small simplifying refactor

commit 6b4fc02d61233cde5c9ca13f407270fff25b6db7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 08:44:06 2011 +0000

    cosmetic

commit 5579eb9c37e536c4d2a6e19804acdb51b5b46fa3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 08:14:35 2011 +0000

    cosmetic

commit df718484b2bcf00c47782ad6ecb98620fab46528
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 08:09:04 2011 +0000

    cosmetic

commit 2ffd432f0dd082b9c6ae48ffc83f056df958744a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 08:08:41 2011 +0000

    correct specs

commit 7d8ddc459f8a786ada7d77e625eba90592ea57d3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 18 06:51:58 2011 +0000

    indicate absence of config files more clearly

commit 58efb97f1aebe5ddf22dad9ef5010f377907bd3d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 17 19:46:13 2011 +0000

    don't send routing-failure-induced confirms straight away
    to allow for coalescing with preceding confirms.

commit 73cdc5325488dab8ddb8a19c1db4d936bc0110bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 17 17:09:13 2011 +0000

    prioritise confirms and coalesce them until we see another command
    As well as sending confirms when the channel goes idle we also send
    them on the first non-confirm (Erlang) message. I.e. coalescing is
    restriced to adjacent confirms in the channel's mailbox. By
    prioritising the 'confirm' erlang messages we shuffle all confirms to
    (near) the top of the mailbox, adjacent to each other.
    
    With this change we get our 'confirms will be sent eventually'
    guarantee back. And performance appears to remain unchanged.

commit beed00bac1f430a005ba8d6112f1e88e144a42bb
Merge: 2ed9f0235 95dc7e75b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 17 14:35:45 2011 +0000

    Merge in default

commit 3ddffe2709454b10345627230657e7f192e4bd13
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 17 13:26:36 2011 +0000

    Added a test which will, timing dependent, hit the close_fds callback stuff. Code coverage in tests bares this out

commit 6793d9c9012f4c044c019cae20ba4a88ba4a8001
Merge: a41873bf3 95dc7e75b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 17 13:25:40 2011 +0000

    Merging default into bug23631

commit 95dc7e75b22adea0a474ad28596dfd51adec765b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 17 13:25:19 2011 +0000

    Every msg in a queue should have a different guid. Sigh

commit 4773a339f444b510a9083e15e4e1e8f2774db6af
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 17 10:32:30 2011 +0000

    coalesce confirms in channel, for better performance
    We accumulate confirms in the channel and only send them when the
    channel goes idle.

commit 69103a55b78083455a261cadb653374cfcef9617
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 17 09:17:05 2011 +0000

    allow hibernation after confirm

commit a41873bf3b2750a941a872d47e16483cd1fe5166
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 19:12:40 2011 +0000

    refactor: extract helper for initialising test msg store client

commit 787e3ae4ac85d76f4897a6454f3a2e8f76b78a4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 19:07:00 2011 +0000

    cosmetic

commit f47817d6174e924c7d31ba26d4e67055cffa80b1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 19:03:47 2011 +0000

    cosmetic: get rid of intermediate var and save some space

commit c0d3ab81e6f721a1e41f9c94893f87e0efe05e49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 18:46:38 2011 +0000

    make recover_index_and_client_refs do what it says

commit ef693e666b025ff84e5bc8e6cc75e5edffed4dcb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 18:39:58 2011 +0000

    cosmetic

commit 20bb1053de64815c106af7d65db36f223ff06dbe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 18:37:23 2011 +0000

    some cosmetic and minor refactoring for clarity

commit 0ed27d058f85181221d87d9e917193f0701b814e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 18:05:23 2011 +0000

    refactor: extract helper fun for updating the pending confirm mapping
    and invoking the MsgOnDiskFun client callback

commit 08dcb9caa9fde632675a5face3b5f0b2b27fb82b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 17:24:22 2011 +0000

    simplifying refactor

commit 91e8c54382977a0f517fff2c61cad1952dbd4d1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 13:22:16 2011 +0000

    oops

commit 9739b8ab3f6bb2e694e16e8d7a4f2fa30b6f5ffd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 16 13:20:47 2011 +0000

    display config file locations on startup

commit 74e0ee0e43af978d5916892c46e4660cf79699eb
Merge: b08721938 9ff954b21
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Jan 15 14:40:23 2011 +0000

    merging default into bug23631

commit b08721938ccc2d639cc98bd716e72a2f91aaaf59
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Jan 15 14:39:27 2011 +0000

    Whoops - client_terminate should not clear the cref, unlike client_delete_and_terminate. Tests pass again now.

commit 0f34fc96e7a58c44cf292fe914ef129624822e69
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 19:09:50 2011 +0000

    Introduce msg_store_client_init/3 helper

commit 352224998317eef0065da02cbe88b5438487c67c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 19:05:28 2011 +0000

    Rearrangement in gc. Can't seem to get it shorter than this though

commit c0a367ad8e5a6f8bac8369f5c4703dc56b1fcc73
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 18:59:54 2011 +0000

    change close_all_indicated to return {ok, CState}

commit 85921c92640fb786d034d5bfeb283122aecc2b81
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 18:55:37 2011 +0000

    Correct order of function arguments

commit a31371b6e4792b24d25303af2495d166f637261b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 18:52:55 2011 +0000

    Combine client_refs with client_msg_on_disk_callback into clients

commit 16cbcecd4491535c664bcd2c0bb862203947e897
Merge: 12832c377 50a712334
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 16:30:06 2011 +0000

    merge from default

commit 9ff954b2154b39bbe9adc2730733fd0fe3562d02
Merge: 168c3076c bda3866ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 14 15:41:52 2011 +0000

    Merge bug23675

commit 168c3076c55283681419dd7ec728634c9ad4bf0b
Merge: 12832c377 d7288a710
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Jan 14 15:10:19 2011 +0000

    bug23663 merged to default

commit 12832c37745cd831a2234135183f8fa8db28047b
Merge: 2fe425a96 9c4dd977b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 14:51:15 2011 +0000

    merge bug23690 into default ('confirms' simplifications and optimisations)

commit 9c4dd977b1c779b1e1b5138a62eeb48965af65fe
Merge: 2d0409667 c2bd1bb51
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 13:25:29 2011 +0000

    merge bug23679 into default (unnecessary fsyncs when requeuing messages with confirms)

commit 3a746c1e5e1125891aa48490649ea7144a905463
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 13:21:32 2011 +0000

    And now it works

commit c2bd1bb51b4e4da686fdd8a01fac68b613c6e860
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 13:20:23 2011 +0000

    Matthew's patch: don't add requeue'd messages to unconfirmed

commit a8e3eb6766992632618bdc09b529fe68bd8e4834
Merge: a5e8b83b3 2d0409667
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Jan 14 13:04:46 2011 +0000

    Merge default into bug23568

commit a9e8d35cc4a20f19427d7adf44ad1a054e1cec14
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 12:48:29 2011 +0000

    Minor tweaks, and added explanatory comments relating to the various races

commit 50a71233462074d78d85c6fa71e253373d5be496
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 12:18:11 2011 +0000

    cosmetic

commit 98c7ee913093c6bf80ba7e2a3ecd23b13c2ac942
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 12:16:37 2011 +0000

    keep track of de-duplicated confirms

commit bda3866ea8029aba7a05d604f1c93164f4297e00
Merge: 2d0409667 7eb96a0f4
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Jan 14 10:55:43 2011 +0000

    Merge with default

commit d81d102cbc07aece6d0f8452c36eb47626c9fe5f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 10:53:01 2011 +0000

    don't do confirm stats book-keeping unless stats are enabled

commit ff0081cdc8acefa646ce47a6b0d194aceb668df9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 10:15:47 2011 +0000

    for queues, log partial confirms rather than full confirms

commit c17e1994d093654a922d83a44e9082249c10d50d
Merge: a1701d1fc 21cc1444f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 14 06:22:37 2011 +0000

    merge from default

commit 5632d3944614e2134567386de8253e17a4a91ef6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jan 14 00:37:29 2011 +0000

    More testing needed, but this does seem to work

commit 2fe425a96bbb2fbfd8d70fc02171be313caf9afe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 23:04:40 2011 +0000

    invert logic to get better reuse

commit c037c2f93b391fbf3b9dc1c807b13a5e5a821101
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 22:28:28 2011 +0000

    combine 'unconfirmed' and queues_for_msgs
    and permit coalescing of confirms on queue 'DOWN'

commit 2d0409667e82d86c55a18acfe2fb3fb9de56260e
Merge: 48f0bb291 3a4dc9aeb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 16:52:14 2011 +0000

    Merging bug23445 into default

commit 48f0bb291ea58bea7b6e24a0e72f675f89e72ef0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 15:36:49 2011 +0000

    cosmetics and indentation only

commit 43ede159062dbbf2c63535e1605267f3ff225ff7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 15:10:02 2011 +0000

    Some refactorings

commit 1bdcd3e6d46f037f8ac5609082d2466de06ccf64
Merge: 3a4dc9aeb 9d483181d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 14:23:37 2011 +0000

    Merging default into bug23445

commit 2ed7f63eb5c911073a899b5e41622c3e1281f85d
Merge: 3a4dc9aeb 17807ea83
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 13 14:02:55 2011 +0000

    Merge default

commit 3a4dc9aebc2b6a48a7b786e904f389db225983a9
Merge: 3c110e1ae 7f3a8b9f8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 12:26:31 2011 +0000

    Merging bug23661 into default

commit 3c110e1ae15e3ab85ba507af69bb740bf2a7ca73
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jan 13 12:04:19 2011 +0000

    Fix bug. FTR, this mistake has been there since Sept 16th 2010

commit 21cc1444fe56efb0b14d5117ad6651abed016f9f
Merge: 32a2c25ec 425f1003c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jan 13 11:36:22 2011 +0000

    merge bug23678 into default (conditional on vq:needs_idle_timeout wrt confirms is too lax)

commit 32a2c25eca36fa73f05cc9a684d68802efc6e45c
Merge: b21cbe609 eeedb301c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jan 13 11:32:10 2011 +0000

    merge from default

commit 7eb96a0f4280163054693c41413cde64851dcba5
Merge: c0ea9e059 425f1003c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Jan 13 11:30:56 2011 +0000

    Merge with default

commit 425f1003cfd3b69ea15be326a0727433f8d33c78
Merge: 046f3fc9e eeedb301c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 10:33:15 2011 +0000

    merge bug23684 into default

commit 046f3fc9e6d134f28dececad37f63ef93ffd3455
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 03:26:56 2011 +0000

    remove redundant clause
    confirm/3 is now only ever called once confirm mode has been enabled,
    and since we can't turn that mode off there is no point in checking.

commit eeedb301c253414d03a7d714f656ad83dbab0ca9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 03:18:55 2011 +0000

    Backed out changeset b6d2a6e12e77
    Turns out this change is only valid on the bug23684 branch

commit be5d43b675628e3d91dca154535f9e8c5b26b287
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 03:10:30 2011 +0000

    remove redundant clause
    confirm/3 is only ever called once confirm mode has been enabled, and
    since we can't turn that mode off there is no point in checking

commit c0f0300915f48a9ce78139c580a074ab8626fe0e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 02:43:15 2011 +0000

    generalise optimisation
    there is never any point in trying to send a multi-ack when there is
    just one message to confirm

commit ea9872fc097435ac28622592a445230df4857053
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 02:16:18 2011 +0000

    bug fix: don't send confirms when MsgSeqNo == undefined
    also optimise unrouted message handling further - there is no point in
    going through all the logic of determining whether we can send a
    multi-ack since we know the MsgSeqNo will be the highest unconfirmed
    and it's just a single message we are confirming.

commit 8742edd6816fadd9fb4d5691fdd4ac46a1ad6228
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 01:54:12 2011 +0000

    cosmetic

commit 0c08bbfbe63318f2e68350ad1aa6320b60c725af
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jan 13 01:25:59 2011 +0000

    inline a function

commit 92a62a0310d74765ca3b36077ebf3fa5c7c2496b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 13 01:22:57 2011 +0000

    tiny refactor: use dict:fetch instead of dict:find

commit 9a3604d627f64f2582eaf2d5640a276dbbc6ac1d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jan 13 01:11:30 2011 +0000

    optimise confirms for unroutable messages; don't do any unnecessary set/dict operations

commit 027a7d46a1d0c02181be3dd326c5764df30d437f
Merge: 343f13ebd f7c044855
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 17:51:33 2011 +0000

    Merging bug23643 into default

commit 343f13ebd92edb49f6a425aa96729317edba7c96
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 16:19:40 2011 +0000

    Eliminate unnecessary put/2, and cosmetic

commit d631bed5a12c2bab3b2406edf9b57fb19622557e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 16:08:45 2011 +0000

    typo

commit f7c044855ca50d64998a2f0dfa48a71dacebce2a
Merge: e4d6472ad f5217b916
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 15:42:12 2011 +0000

    Merging bug23668 into default

commit f5217b91649893e8c8793e162bd5842deba04752
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 15:24:50 2011 +0000

    Refactoring and ensure that we don't issue confirms for messages that have been masked from going to disk

commit 185d200a0166ff1a3e46264204cf149ec9d142f0
Merge: bfbe15a99 e4d6472ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 12 14:56:54 2011 +0000

    merge default into bug23643

commit fe9f73e59ec973740a09f2aa36778dc2d0de032d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 14:43:32 2011 +0000

    Cosmetic.

commit 544415e1d94bac06065bdf8c0f7b70cbd6b3fb4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 14:03:49 2011 +0000

    Break the bad news rather than just timing out wait_for_tables as we traditionally have done.

commit e4d6472ad902f76458309039445d060f30284bae
Merge: 2c54995f1 074ed7f97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 12 14:02:21 2011 +0000

    merge heads

commit 074ed7f9748e29bcd3d0d1fb2eb4a9ab6fb17019
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jan 12 13:54:31 2011 +0000

    cosmetic: fix indentation

commit 45327bcdead1cc8e8438d60fe2cad359cd22099a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 13:31:41 2011 +0000

    Don't display a cluster-related message on a single node.

commit 9acd660bfbbbaf8b614aadf9b8ba3d24e5cec43d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 12 13:11:25 2011 +0000

    msg_store confirms messages that are written to disk, removed and then revived

commit 22af9498f8fed1b035b4b697940488fe3c60a4e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 13:05:53 2011 +0000

    And fix again.

commit 2c54995f1b65485519fd8e426481e83176071980
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 13:03:00 2011 +0000

    Mandatory delivery only needs to know that it got to the queue. Not the result of delivery

commit bc892dbf91c4df178c8319c375317bed343e5783
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 12:54:12 2011 +0000

    Detect old-style versions properly.

commit 7db95ec69b5766c8f38ab5f03d9b42e57cbf6c50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 12:43:25 2011 +0000

    Remove pointless differences from default.

commit b21cbe609b718c008842af8b6a0f53c9a908c144
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 12:34:28 2011 +0000

    Logic.

commit 5e887beacced4e4e4330bf46771be639c1e05c8b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 12:20:58 2011 +0000

    Prioritise both sync and async versions the same

commit fcc5b96bd87979fca7ee3cc2260cba335e878dfa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jan 12 12:04:24 2011 +0000

    Make conditional more precise

commit 5b8f8847a405c50929b85921f7ff5c749aef5b12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 12 12:01:09 2011 +0000

    rabbit_mnesia:all_clustered_nodes/0 does not return disc nodes only. Duh. But we can do better anyway: allow any disc node to do the upgrade.

commit be1b799e745f4404459953084451e72d35beb2c2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jan 12 11:59:09 2011 +0000

    swap union and intersection

commit c0ea9e0595049cc91c1cd32f108c6ebdf85ce3ce
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Jan 12 09:20:52 2011 +0000

    Honour the requeue flag in basic.nack

commit 2be3dddb891f6edec591e8e69742b30063719d55
Merge: 79acba27d 32be493dc
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jan 11 17:06:38 2011 +0000

    Merge with default

commit 32be493dc092069bc496fa006d16f942d953d0a3
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Jan 11 17:06:07 2011 +0000

    Extract common logic for message rejection. Introduce basic.nack and rework basic.reject

commit 4db63f30162ae870df2811918a272f138dd09d8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 17:03:56 2011 +0000

    Revert this to the old version that we want.

commit 79acba27de543f92ef9bf05034671372ac15b3f4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 16:12:20 2011 +0000

    fix a bug

commit 82406489b7baf59e5a381afec5409f5c8d553991
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 16:00:51 2011 +0000

    cosmetic

commit d16c66f16fec99fe13f7769949b6472dec57e1b3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 15:45:39 2011 +0000

    cosmetic and tiny refactor

commit f657edded754ac464fbc450e731d9409907ac2eb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 15:25:28 2011 +0000

    Minimise difference with default.

commit 9d483181de3e2094cd2014ae9a7b3dad69bb885e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 15:20:36 2011 +0000

    cosmetics and minor factorings

commit 566d62432fc5c627e4f413ad5a8ce9ae6f0a0ac7
Merge: 33d71911a 27fe1d8bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 15:15:15 2011 +0000

    Merge default

commit 33d71911af2bcae1d145a663d4c4cdb488fd7f28
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 15:11:44 2011 +0000

    Remove test upgrades

commit 32cccaf2632eb3cd89b65f02877a83a49dd1eeaf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 15:09:19 2011 +0000

    Note that we've upgraded here

commit d47beead83fa6447e9836da64303084ab8cf86d0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 15:03:29 2011 +0000

    Store the version as an orddict keyed on different scopes, and thus don't assert that everything is done after the first upgrade.

commit 2cd703d1924c960bfcdf8223307caf4c21eb28ec
Merge: 27fe1d8bf c7bdaafc1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 14:32:47 2011 +0000

    Merging default into bug23445

commit cb58fc7c4a53f754a63c74654a22d18ce734ed67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 13:44:41 2011 +0000

    Break the cluster *after* taking the backup.

commit 27fe1d8bf9c554c9aecd667d8f23a965edcbc1d1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 13:41:57 2011 +0000

    Optimise the heartbeat to death. Honk. And some cosmetics too

commit a020e288b0a526b1b29e455d1e807550c5259813
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 13:34:02 2011 +0000

    One DAG per scope.

commit 94782dbb5267516f16ac2b914f3c36f9348033a6
Merge: e2d5699e1 44dac57ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 13:29:33 2011 +0000

    merge bug23329 into default

commit 9c213d41f8f824468f8d1d96239d6a234ac92167
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 11 12:44:43 2011 +0000

    Holy %$*! it works. Still needs tidying up somewhat...

commit 44dac57ceb54f9f955753541ac44e2fb0cdf6593
Merge: 128cf8e4a d3b8db6c9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 12:19:05 2011 +0000

    Merging bug23616 into default

commit e2d5699e10a773b429f9723ee03372dfa58f0b8e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 11:59:46 2011 +0000

    Typos

commit 7e165032449b7d4f8e6b5ee097fc5687b8c43fa4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jan 11 11:48:48 2011 +0000

    Updated documentation

commit d3b8db6c9c803c6bbe89749e1d84d203c3377cf2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 11:13:46 2011 +0000

    start confirm sequence numbering at 1 instead of 0
    in order to avoid conflict with special meaning of deliver_tag=0 in basic.ack

commit 82d5f2c6bf1e38cad407165da97209cdf510eb69
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 09:54:17 2011 +0000

    start confirm sequence numbering at 1 instead of 0
    in order to avoid conflict with special meaning of deliver_tag=0 in basic.ack

commit c841c5ded00c5046c18ec2176bd4bb7152be91a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 08:28:43 2011 +0000

    refactor: extract helper function

commit 37fe2a238fbde730b0e116ec6ef6b278beeb2a67
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 08:00:02 2011 +0000

    fix typo

commit 58a3c2de2a4e27090c626d464e0485d7b91c3b18
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 07:51:35 2011 +0000

    cosmetic

commit 64a54d7f3daa0b3dfd6854bdce0d8c91e9d42851
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 07:43:31 2011 +0000

    fix

commit 09b2e84d179dcf954a173227ae28dfe2bdcfb235
Merge: d46229d4c 128cf8e4a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 07:43:12 2011 +0000

    merge from default

commit d46229d4c579d6deedf3832f921d536def03c7db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jan 11 07:39:14 2011 +0000

    cosmetic and minor refactor
    tidy comments and eliminate some intermediate vars

commit 128cf8e4a1ad257ebc094379bac30d3e88d4d1dc
Merge: 0ee8b2f49 0b74552ea
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 10 21:22:26 2011 +0000

    merge bug23593 into default

commit 0b74552ea693b606e092888fb92f7ce7c2b3f713
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 10 20:44:36 2011 +0000

    small simplifying refactor

commit 7742deecda609ae19f10451d86f906ccb1a75410
Merge: 2cc20586e 0ee8b2f49
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 10 18:16:05 2011 +0000

    merge default into bug23593

commit 2cc20586e4a33694a6ade682364478dd69de2c71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 10 18:08:02 2011 +0000

    refactor: better function names, some inlining

commit 0ee8b2f49415b04440410312ffe4ca0071c5a7b4
Merge: 67c99b6f1 fdc3bb7b6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 17:42:22 2011 +0000

    Merging bug23665 into default

commit 9924047fb21cd5435c1e4b98b18f66712b688b9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 10 17:25:13 2011 +0000

    Move the upgrade tests earlier in the boot process. This doesn't work either, just committing it in order not to lose it.

commit 844fb5a360d43066fd511c34008e10df3e990a90
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 10 17:09:13 2011 +0000

    cosmetic

commit 27e4b5bdded5f3ec43f9599c9798afac9b3e01ff
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 16:06:02 2011 +0000

    remove unneeded logic

commit 67c99b6f1b7e8baf1acce3e0db9f6769e67e28a7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 15:54:19 2011 +0000

    more consistent naming

commit c7bdaafc1f963b800e4bcd349e2ff03f0147d1a5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 15:48:31 2011 +0000

    Only read inside an mnesia transaction

commit 8f5cd599048df253e3c0242ac3df6f2601dfc922
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 15:41:23 2011 +0000

    One less thunk

commit 1be3c923ca50061000a7673c7970fb09f6b6fcc0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 15:38:09 2011 +0000

    rethink grouping logic

commit fdc3bb7b6720182ad80410d9473ee8cb29f0235c
Merge: 585d6f577 c55c17203
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 15:18:10 2011 +0000

    Merging bug23636 into default

commit c55c172037e446090849a8eebcf24c7893c8f641
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 15:03:11 2011 +0000

    Turns out that 0 and true are distinct. sigh.

commit c521643a67de6b64adcf00557464d72404d7e6d9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 14:40:08 2011 +0000

    cosmetic + a bit of refactoring

commit cee41118178cc6f801a913c03114a36c1e4c0716
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 14:36:47 2011 +0000

    More frugal use of thunks

commit adc51577b48f1ecb03c69d0e446c823c6c42802d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 14:31:34 2011 +0000

    Msg -> MsgSeqNo; inline two functions

commit 30eaaa2f9a4cee968c616f80e46bafa2db9e9dad
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 14:08:30 2011 +0000

    remove duplication of erroneous logic

commit f7d16db3692dd143ac535e3f7c6ed1435286436d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 13:57:21 2011 +0000

    Unconditionally return a fun() in execute mnesia tx

commit 9a8acf9cc923ebe4eb6faf5fb3677a37e9eccc58
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 13:50:58 2011 +0000

    Improve consistency of naming

commit e90320784bd8651a2843e7858397514af28d6bb8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 13:41:13 2011 +0000

    refactor / abstraction

commit 1d68ad3e37905a37f0e6ccaea38f4b22b37d25a3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 13:07:39 2011 +0000

    Testing shows that using a set seems very comparable versus ets in this case, and still offers the profound improvements over default

commit d7288a7106285cb10d51316cbd2dc7ec361a71b6
Merge: 585d6f577 c37f99680
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 10 13:04:09 2011 +0000

    Merge from default

commit 585d6f57723e5b7919df52b05baf6eca447a636a
Merge: 93a2bc7b9 3c3d27add
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 10 13:03:39 2011 +0000

    Merge heads

commit 3c3d27adda4dcca72d9e606cfa0bd85330c1e4d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 10 13:03:07 2011 +0000

    Fix dumb mistake. Not sure how that used to work.

commit ed0e0f9f338b851dc5ff3ed4bd728e03a8306f51
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 12:29:58 2011 +0000

    sync queue_index when variable_queue has outstanding confirms and is idle (branch off default)

commit 93a2bc7b9c9a3e77daee776acfa652a1fa5a3974
Merge: 99a50e456 e296f662a
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Mon Jan 10 12:20:26 2011 +0000

    bug23578 merged into default (ssl info)

commit f5bdd1e1839365f566346f6c687a0c362d3a5546
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 12:17:41 2011 +0000

    Transfer changes from rabbit_access_control to rabbit_vhost

commit c37f9968085c29b0a9cf200485625bf58121b6dc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jan 10 12:16:33 2011 +0000

    Remove SASL EXTERNAL mechanism.

commit f216fd35c47e8321c65e59164ee3754f9c133a3b
Merge: 99a50e456 cc0fd0b76
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 12:11:28 2011 +0000

    Merging default into bug23329

commit 99a50e456314243875880cb4e5f5db9691c11e8d
Merge: 24dcac7bb d1d0ed9f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 12:08:36 2011 +0000

    Merging heads of default

commit 24dcac7bb10cf3f19ad15d5bd4d860124a58efcc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 12:08:05 2011 +0000

    Fix bug

commit 75165cf7f453d428c2d6c8e076fe2f1c7aacddfe
Merge: d1d0ed9f3 fc11634c5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jan 10 12:05:13 2011 +0000

    Merged default into bug23445

commit cc0fd0b7698cc79ac6bd1074c9addfcd90e14f06
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 11:51:07 2011 +0000

    Correction and improvements of comments

commit 21068eb16a23bc31cb8c20aba7a2744cfaf3f722
Merge: e14e75414 58a159e00
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 11:46:30 2011 +0000

    Merging default into bug23329

commit d1d0ed9f3fd8c08c6b47f897d657e72348e139ef
Merge: 58a159e00 d60d8804f
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Mon Jan 10 11:39:59 2011 +0000

    bug23594 merged into the default

commit 58a159e006bb20002eaebc217edfabf4efe8524c
Merge: 41ae48e5c 15fa2e9c2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jan 10 11:23:48 2011 +0000

    merging bug23612 to default

commit ea5a64afed2143b6843359ce93a7c73b1f40dd54
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jan 10 09:36:52 2011 +0000

    misspelling

commit e14e75414167d0b2ee988da81d016d7fb2989951
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 9 17:00:54 2011 +0000

    simplifying refactor

commit 7f3a8b9f8f7bd511c4eecdcac8f555afa1664795
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jan 9 11:46:20 2011 +0000

    ensure connections terminate when channel-related processes exit abnormally
    When processes related to the channel, such as the writer and limiter,
    terminate abnormally, the channel_sup terminates the channel process
    with reason 'shutdown'. The reader musn't treat that as a controlled
    termination.
    
    The other path to a 'shutdown' termination of a channel process is the
    shutdown of the application. But the reader will be shut down first
    there since it is started after the channel_sup_sup. Hence it will never
    see a 'shutdown' termination from a channel in that scenario.

commit 41ae48e5c380a08dcd1bed7ba2f4d11b59712670
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jan 7 18:16:41 2011 +0000

    rename WaitForIndex to ActionTaken

commit 2ed9f0235fad0edee8fc5090de98a1215d0a5380
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 16:08:16 2011 +0000

    Update documentation.

commit d4ace7f82d9e26fd4430465622d5f7d110977d56
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 16:03:50 2011 +0000

    Don't have the scripts set bind address of 0.0.0.0 if the port is specified but IP isn't. Instead use the same logic as if it's specified in the configuration file.

commit a5e8b83b35302334013cdd0bd630acc188b550ed
Merge: 49ce527be 4de1294c7
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Jan 7 15:01:38 2011 +0000

    Merge default into bug23568

commit 9ea5fdd840bae7b9b40d1d35edff75e2d9e24007
Merge: 15fa2e9c2 beb16ecac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 14:10:43 2011 +0000

    Merge from default

commit 15fa2e9c295dd82d9fab6fb82c2d1633d43d0250
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 14:01:05 2011 +0000

    We have a dependency mechanism. Why not use it?

commit beb16ecacb5d38c391f0ef426d3cf2163ca91296
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 13:23:21 2011 +0000

    Cosmetic

commit 949ab083dea7d48f7e94811491f6210d0142d315
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 12:07:12 2011 +0000

    Refactor a bit, reinstate ensure_version_ok check.

commit b55447368f48faa608cd04ec389f6731b0fcb8db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jan 7 11:54:35 2011 +0000

    Ironically our dummy upgrades now need to be upgraded.

commit 11296b5fdbec856257fa9038da940ace8945f9ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jan 6 19:04:33 2011 +0000

    Sender-specified distribution
    
    First attempt for direct exchanges only

commit 903ca29aadf6be24cb428f8e66fc003e08833b13
Merge: 4de1294c7 e986737e0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 6 18:03:26 2011 +0000

    Merge from default

commit e986737e0f1c0fc4e2f2c5369db7fc2eb9a7534f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 6 17:50:21 2011 +0000

    Decide the node to do mnesia upgrades based on which was the last disc node to shut down. Blow up with a hopefully helpful error message if the "wrong" disc node is started first. This works; you can now upgrade a disc-only cluster.

commit 4de1294c7c8172943de213d106db8ad96a0971df
Merge: 1420f5b7b e7cb028e6
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Jan 6 14:20:00 2011 +0000

    Merge bug23455 into default

commit e7cb028e68fd61e5f0ba3b3ff41478fa47e40b5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jan 6 12:41:15 2011 +0000

    Fix comments.

commit bfbe15a99662c564daed872b32f2e7a11c8751dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 6 12:31:03 2011 +0000

    refactor: extract function to handle frame and pass to channel

commit 5001bcd203519da606bc1b40a7e10062de11613b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jan 6 08:42:56 2011 +0000

    cosmetic

commit fa8bcb1615af39ae75852e5d928ca7129d9f1458
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 17:59:59 2011 +0000

    Explain that rabbitmqctl only touches the internal user database.

commit eefed49f1f8b7ce067270e972860f259bc69e606
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 17:44:21 2011 +0000

    Fix a few spec-related stupidities.

commit 999226e6d4e2aac047955102656a9afa2d6729ca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 17:23:06 2011 +0000

    Oops.

commit 5647fe828c869fbe9d2b5f6b922f1b271da46faf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 17:20:48 2011 +0000

    Dialyzer fixes.

commit 3356b53de2e01b4d8ee787d6cae0d9c5af2f47d9
Merge: 1420f5b7b a4dcd1217
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 16:22:13 2011 +0000

    Merge from default

commit e296f662adfd35e9f9ff5e2ccd96b74898a94cf8
Merge: 1420f5b7b cbd64f344
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 16:05:06 2011 +0000

    Merge in default

commit 8bce43ad9fbc9b3fdfe7550cf1e34de2e4ab2ebd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 15:40:42 2011 +0000

    Format IPv4-mapped IPv6 addresses as IPv4, put brackets round IPv6 addresses that are adjacent to colons.

commit 1420f5b7bb4209d5ad3d481fb397d4a0bab172dc
Merge: 9a4b88279 7842327c5
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Jan 5 14:44:40 2011 +0000

    bug20570 merged into default

commit dffbcf3580f67164ca9d8f51304a8a75a86705ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 14:43:22 2011 +0000

    Allow specifying a listener as just a port number, meaning "bind to everything, whatever that means on your OS", and use that by default.

commit 9a4b882797d7cf90166512a63ce1fc0c0d211c82
Merge: 0c0af02a1 7842327c5
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Jan 5 14:01:05 2011 +0000

    default merged into bug20570

commit 6b642eb7aca67ef9fab05d7117e3284b5f4a9e08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 12:28:18 2011 +0000

    Reinstate stop_tcp_listener.

commit 5a00384dc85e587bb591688c819f269886363cfa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 12:18:04 2011 +0000

    Allow check_tcp_listener_address to convert one config into more than one spec (so that in future we can have a simple "bind to port" config that works on dual-stack operating systems).

commit 6cc6838b9377d996ec191a0ab5fe89601a05783f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 11:54:36 2011 +0000

    Make listener spec a bit more of an abstract type so that changes to plugins are minimised.

commit 5ba59293f423150ece50e1d6a55f1760208e7042
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 11:13:10 2011 +0000

    Automatically determine ipv4 / ipv6 depending on IP address or hostname provided.

commit 216cbf79273f8cca2615e05c86d681a000275ee2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jan 5 10:31:35 2011 +0000

    Special case [::] like we do 0.0.0.0.

commit a4dcd12173d0a82bb22de9edff9c1c17bb565ffd
Merge: 9fdff1679 7842327c5
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Jan 5 10:19:34 2011 +0000

    Merge with default

commit 8ea3adb13bd562c3a56d392e7bf20844ae048702
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 17:14:47 2011 +0000

    Import and debitrot Reilly Grant's patch.

commit f15396ac8b7ca459569103ea74e8eb59eb3d1c26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 16:34:23 2011 +0000

    Check our version matches the remote version.

commit 08bd9e01c565a9851a3b50bfecec7dcee536d411
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 16:24:59 2011 +0000

    Fix spec

commit a2ef8678d7c52e45032b7b3b604f9c4a03b64d45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 16:12:07 2011 +0000

    Revert arbitrary difference from default.

commit 02800055c4cec47a23afba8ff5e3de8928e6f4dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 16:09:18 2011 +0000

    Make disc node reclustering work, various cleanups.

commit f94bd56823591959fb820983534b137a6840a8aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 14:18:51 2011 +0000

    These two cases are the same.

commit a1986871023be08bcee16cf1a55671f5bcb9612c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jan 4 13:39:08 2011 +0000

    Sketch of how clustered upgrades might work.

commit d0bc5d50c36ab7399a8249e2146664609c3abf70
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 3 18:14:09 2011 +0000

    cosmetic

commit f7e9233d366fd896c673c760be7294863c6aafc9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 3 13:51:59 2011 +0000

    better error handling

commit c1266c548c2f3cce84682c4bcd4a83deb5eaedcb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 3 12:43:13 2011 +0000

    add specs and move frame analysis from reader to command assembler
    The latter avoids a mutual dependency between the reader and command
    assembler.

commit b9518191e2a2b100e85658bd56567f7eaa4ee042
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jan 3 11:57:39 2011 +0000

    renaming

commit 707a504e264b26322a44cee4f0748de0ca964d04
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 1 19:20:06 2011 +0000

    replace rabbit_framing_channel with tiny state machine
    ...which we store in the reader's process dict
    
    This simplifies the interactions between the channel and the reader.
    
    Note that the reader now monitors the channel processes rather than
    their sups. This makes more sense since it interacts with the former
    but never the latter.

commit 685ed08edacd82e871fadac07b97d8cf6d15a029
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jan 1 13:21:42 2011 +0000

    refactoring in preperation for eliminating the framing_channel process

commit 2c601cdb6c7222d83ecd5054c2adcec8a81ad456
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 29 23:48:54 2010 +0000

    faulty logic

commit 20bf8532ef41a8ddb201ee3de3cb236ebc34e014
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 29 09:04:22 2010 +0000

    amqqueue confirms in batches

commit c42ba3a379c099410ad0f6079457b7520d38dc3b
Merge: 7511ecd0b 6e869f0f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 29 08:34:48 2010 +0000

    merge from bug23612
    
    bug23612 removes most of the confirms from amqqueue_process.

commit 7511ecd0b5dd9ecbc350daed964c19f7b7663744
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 29 08:30:48 2010 +0000

    confirm sequences of messages in channel

commit fc11634c5c1cb7701563b2d66fe3fafd8a3f9505
Merge: 831891ea9 7842327c5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Dec 23 16:21:13 2010 +0000

    Merged default into bug23445

commit 831891ea9e3a4d7b13986cbb60f8f49dde909b52
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Dec 23 16:12:01 2010 +0000

    Changed exchange callback API for transactions

commit 5fd28c283b04b119f2fac23a28616dd80301ae4e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Dec 23 14:16:33 2010 +0000

    remove references to confirm.select{multiple}

commit 6e869f0f778997a5be571423d02150e4fcdb94dd
Merge: 66dd46717 7842327c5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 22 18:29:48 2010 +0000

    merge from default

commit 7842327c5653565ac13ea4406b41490a4f757881
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 23:56:12 2010 +0000

    Whitespace change in order to force correct head of default

commit 66dd46717157fa6f76e281f8ec3c7fb3fa4f8c99
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Dec 21 20:38:02 2010 +0000

    remove dead code

commit 3b698d4fa132036bbc4ac1a4e045d994458b5683
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Dec 21 20:23:18 2010 +0000

    move another confirm into VQ

commit 5b283b20ef93224c2562440ecf53e985f180d1a3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Dec 21 19:37:04 2010 +0000

    removes form the msg_store cause confirms to be sent out immediately

commit 8cee1d4be1fac4c51a2047334b86afab4f7fd67a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Dec 21 18:58:26 2010 +0000

    fix tests

commit fa6928fc212f49818265cab198791389073a2119
Merge: 7cc2eab03 788074087
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 18:32:10 2010 +0000

    Merging default into bug23554

commit b5bedc8c2759dce5c6fd2515f4b34502e7b9647a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Dec 21 18:31:49 2010 +0000

    simplify variable_queue:ack's return format

commit 7cc2eab03ba0b766c8cf6e25d5db025ecd5c8df6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 18:31:16 2010 +0000

    Abstraction

commit 12594a71310ab7f1cdf954e83e77761f280bc342
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 18:12:43 2010 +0000

    It's called port. Not server_port.

commit 62ad528c0ee921f1f0ca1c5b56394dc501f201d9
Merge: 15103807d d809fc80d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 18:11:21 2010 +0000

    Merging bug 23634 into default. This makes ctl list_connections list all connections in a cluster, but I think that's more logical anyway and makes it match the behaviour of list_queues and list_exchanges etc etc

commit 15103807d30fe3178c1b39356cd48a9dd1d52fd9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 18:01:47 2010 +0000

    And points for obviously merging things to default without running the tests are awarded to Simon, whilst points for not making the change in the first place and not running the tests are awarded to Matthias. Good jobs.

commit 7880740872e1c90cd147494c6331bb846c8c47ec
Merge: cd1abcaf6 8df5ca8a4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 17:48:17 2010 +0000

    Merging default into bug23554

commit d809fc80d00412b5abc2b53e962c5ee7c9a0a98f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 17:33:58 2010 +0000

    Cosmetic.

commit cd1abcaf642b1afa8d8159ed1837d381449df6e2
Merge: b9dbac16a a9bf1aea6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 17:03:49 2010 +0000

    merge bug23586 to default

commit 29799ae7b7658835d23414dac8daab69fe6956ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 16:21:43 2010 +0000

    Matthew says we really need that check, so make connections() return connections from all nodes.

commit 8df5ca8a4153a43cdd03e2797fe1eb604943247f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 15:40:11 2010 +0000

    Make the addition of slave nodes more robust. This is especially important for recovery of durable queues

commit 43ebb9465bca66ae20b54c0677dbd0574968c89b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 15:25:31 2010 +0000

    Don't attempt to verify the pid represents a connection.

commit b9dbac16a49924b0abf4fceb3e0f7034a19b75c8
Merge: d8c90b7c5 358b5f806
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 15:23:11 2010 +0000

    Merge bug23632 into default.

commit 358b5f8062836f83db2ccb5602bcf2b2f9b56275
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Dec 21 14:19:05 2010 +0000

    include Creation field in string representation of pid
    in order to preserve pid identity through ser/deser, particularly when
    the pid is remote

commit fbcdab41943cb4c4b83d14325a4bee775b2af494
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 13:36:43 2010 +0000

    idiot

commit 16cb3e23c90901b599898eb6c6e8e73e4981c61d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 13:31:42 2010 +0000

    Use amqqueue:store_queue/1 so that we modify durable queues durably

commit 9fdff16790f6a1558ffad5296487030b40d64d1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 13:23:32 2010 +0000

    Make the Erlang tests pass again

commit 17aec78d02bfe35fbe9a231a8a058cc654e13afe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 13:23:06 2010 +0000

    Correct all manner of crazy wrongness with maybe_run_queue_via_backing_queue. The principle problem is that the state with which the function is to be run is dependent on the caller. Sometimes it's the 'top level' BQ state (eg invocations called by amqqueue_process). Sometimes it's the 'bottom level' state (eg invocations called by vq or qi or msg_store). We didn't used to have multiple layers, but now we do. Consequently, the invocation must indicate 'where' the fun is to be run. The clearest explanation is in master:invoke/3

commit eb490a7ef18a9224e06d828c8611e686a5d33d4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 21 12:59:38 2010 +0000

    Split rabbit_access_control up. Functions that are facades onto the auth backends stay; functions that manage users and permissions go to rabbit_auth_backend_internal, functions that manage vhosts go to rabbit_vhost.

commit 035d4992771be3e4eb976ad8aade9aedc50f2b83
Merge: d8c90b7c5 70aac947f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 21 00:42:39 2010 +0000

    Merging default into bug 23554

commit d8c90b7c540bb04250222bae9ec744b06552b1c5
Merge: a4574af72 897e0ee59
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 18:59:12 2010 +0000

    merge bug23619 into default

commit 297a87e67ee7b8245f249504d15763898165ff73
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 18:15:44 2010 +0000

    Oops

commit be0644ab97c719612b1752c1548cac70ad5b98a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 18:06:05 2010 +0000

    More comments

commit 79126cdd252ae20adeb8bb1f634f0dfa5b47688c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 17:57:31 2010 +0000

    Clean up

commit 6e268b6ed68e703ba4c0fbcaf558a2728b9f4e5a
Merge: 1ae251253 897e0ee59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 17:33:51 2010 +0000

    Merge from default

commit 897e0ee59dcfb466e202e7f7231e59d3f07b0537
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 17:28:04 2010 +0000

    Oops

commit a4574af72a80f576808fd9314a22b8330333db4f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 17:17:11 2010 +0000

    Delegate from remote to local as well as from local to remote

commit d7c90146f308efc1f686b27f0da0662f03032af7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 16:59:01 2010 +0000

    more typeoishness

commit 3bf9032ccfe739749df3476da503ed8a55b69be0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 16:56:24 2010 +0000

    typeoish

commit 84938e5f421b26b66c38f2d5a5efbcdf90208599
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 16:54:49 2010 +0000

    Test the badnodes case

commit 80b4cae24a2e600f15f0285be53ddf6f378dd65a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 20 16:23:09 2010 +0000

    the msg_store is responsible for confirming rejected messages

commit 1b4821894340f77603412ce88855ae15e852a4b0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 20 16:18:38 2010 +0000

    the msg_store is now responsible for confirming messages

commit 70aac947f7eb5320fb27792af203f0e201dfd7ba
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 16:17:04 2010 +0000

    Remove R14-ism. Also, cute feature - if you specify no nodes by name, you mean all known nodes

commit c1cc82f75d702329ef8007ab6ecaaade645edbd7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 15:48:31 2010 +0000

    Give in and have the master put the pub msgs themselves on the gm. Avoiding this proves far too complex in all the failure cases (the worst being when the publishing node crashes - the master can receive the msg, but not the slaves. Worse, because of complexities like delegates, it's not even straightforward to monitor the publishers in order to be sure we're not going to receive more messages from them). We continue to have all msgs directly routed to all queues. Yes, this means that normally every slave receives every message twice, but this is genuinely the simplest and most secure route and protects against failures the best.

commit 6ec37ddd63b1222debfd473e9abb84417806bd35
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 20 14:43:49 2010 +0000

    amqqueue_process shouldn't confirm when a message is basic.got (it's the BQ's problem)

commit b60e1c47fd36139cf5f1f4b4fff13b5110728b6c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 13:56:21 2010 +0000

    Revert the previous changeset as I've decided to solve this differently

commit b3fb3813834ca74e1d770615fbafe225e222c3b2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 20 13:37:06 2010 +0000

    remove confirming of undelivered immediate messages from amqqueue_process

commit 59658d208794847676b5e10b6b79727485cb51dc
Merge: d94c5fcfe da082d1a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 13:31:08 2010 +0000

    merge heads

commit 5beb2aa5d34dec6cfe1bc994112a9d76dbc12840
Merge: 3d3f7c6de a1b63d6cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 13:04:18 2010 +0000

    merge default into bug23619

commit d94c5fcfe3ad6ce67e27839b74a274b8c562b891
Merge: 408b6d4c9 a1b63d6cb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 13:02:12 2010 +0000

    Merge bug23358 into default

commit 408b6d4c9412decce732e4d35c6751420bbfa8cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 13:00:52 2010 +0000

    rabbit_misc:rs/1

commit a1b63d6cbe42bbc8da8c23b0dff32d7e69bb3db8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 13:00:01 2010 +0000

    cosmetic

commit 3d3f7c6de807e2770460d8369482f6dabf5148f8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 12:44:15 2010 +0000

    treat nodedown as a recoverable error

commit 7f7d1bb62f8d811185c5362ac61887cb98b14682
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 12:39:57 2010 +0000

    Legible error message.

commit d8ae7115f1fa24c84abca27a4719039eb18ef524
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Dec 20 12:36:06 2010 +0000

    cosmetic and minor refactor

commit 5f00461bf5de7e28d4d3070f705c07135b14f3c3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 20 12:29:38 2010 +0000

    Tone down the name a bit

commit b88e8aac5cfd38cf7380984565c1f4e134772f51
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 20 00:26:33 2010 +0000

    Right, well the fake handling code in master is fine. The fake handling code in slave is utterly wrong. However, I need to sleep

commit a9bf1aea60ec2e78bac8c226b248ac28c8eabe49
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Dec 19 13:40:31 2010 +0000

    fix msg_store losing confirms

commit a145ce54d72506aab04d25794107293d010ba35f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Dec 19 13:11:18 2010 +0000

    Treat localpids even more specially, and save 4 lines in the process...

commit bad8e9b982703557f58b970e897645b6137e0e64
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Dec 19 01:10:14 2010 +0000

    When you send a msg to another node, if the local node doesn't already have a connection to the destination node, it has to contact epmd and try and resolve the remote node. This takes time. Thus, in the event of a distributed gm group, it's very important that we record asap when a member dies as that member might be our downstream, to which we're sending, and it might be on another node. Thus promote the DOWN messages. Because of the inherent races going on, gm is built to cope with this anyway. This has the nice benefit that promotion of slaves to master in the event of failure of master is now pretty much instantaneous

commit 7494ba44566e5b32a56c7b51f1bfce2f5acf8c56
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Dec 19 00:54:51 2010 +0000

    Fixed a bug caused by revision 454fbb9127bd in rabbit-ha from where gm.erl came; Make gm_tests more robust; Avoid creating endless funs all the time for every message (substantial performance gain). Abstract use of dicts - expected use case is relatively small groups, thus orddict would normally be more appropriate

commit c838c22a866b160106fa83cb0c6fabb1fb27e610
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Dec 18 16:34:37 2010 +0000

    Substantially reworked delegate

commit d18ca8b0da9f16a47d19a0f8371cf5c84ca8a7e9
Merge: 0552229b6 da082d1a4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 17:50:02 2010 +0000

    Merging default into bug23554

commit da082d1a4ad4bd73a6a6f1c4bf4dbf11c823cef6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 17 16:52:10 2010 +0000

    fix bug in consumer_delete event emission on queue termination
    This caused rabbit_mgmt_db to explode as it attemps to format a
    consumer tag as a pid.

commit ead11ac25842d35b010207e802d284136b0895f9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 16:48:34 2010 +0000

    Adding documentation

commit 0552229b651e5e43e22fa13330df7e88b684af71
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 16:42:34 2010 +0000

    Ensure that promoted slaves monitor the queue's exclusive owner

commit e263e5bf12f49a22ad6316eba676f32fa9da9aa1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 14:57:13 2010 +0000

    Fix a race condition that can occur on queue deletion. Also change boot order to make sure the msg_stores are started before us (and thus stopped after us)

commit c26af5ded707efee4635a8a01e233d9dca720f55
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 13:51:02 2010 +0000

    Accidental unification going on of two things named Q; fix a bug which led to repeated calls to BQ:delete_and_terminate (which turns out not to be idempotent)

commit 13f55320029362d956ee84109e2448cbb5eea567
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 12:05:43 2010 +0000

    That might just be enough to support confirms

commit 0c0af02a1cc93542d46ab705dc348fd3ef9d5755
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 17 11:24:58 2010 +0000

    Clearer error message.

commit d60d8804fcb3778e5d7a8821a297f2234381aa60
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 17 10:25:34 2010 +0000

    Use randomly generated nodenames in batchfiles

commit 71809f4e35e7c5c98735d13e970e7c19296d0345
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 00:31:55 2010 +0000

    Correct places to do confirmation stuff

commit 91e9438fb63cab946e8dde6af72cdc2d81c9bb1b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 17 00:31:15 2010 +0000

    Support maybe_run_queue_via_backing_queue in the slaves, and add some comments about where to deal with confirmations. I think. Assuming my understanding of pubacks is right.

commit ee6d77595a3b390e9d3153fac14f3936091851ac
Merge: f7527b26d b0961fe47
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Dec 16 10:38:48 2010 -0800

    Large-ish merge from default.

commit faa35a799468acc38a014d781e535d08f1b97f35
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 16 18:37:44 2010 +0000

    Permit dynamic inspection of the current mirror queues. This isn't particularly lovely because the master queue itself does not know, and thus has to do an mnesia read. However, for the time being it should do

commit 33184f2cdc708cdb49929db33eba0212128228a6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 16 18:13:20 2010 +0000

    extra_pids => mirror_pids; Also rip out changes to the registry and just hard code that rabbit_mnesia takes care of gm - the problem being that we need access to the table dfns even when rabbit app is stopped, thus the registry would be down

commit 27c278c115a12f00034f44ee51f61e4ba3227403
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 16 15:37:57 2010 +0000

    Make use of the wonderful new registry.

commit 982603860aedd6fef441aae23d18ba24029734fc
Merge: 031508ec1 b0961fe47
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 16 15:04:19 2010 +0000

    Merging default into bug23554

commit 031508ec16a3a86844433330143bfd88f1f6b855
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 16 15:00:36 2010 +0000

    Move the various files from rabbit-ha to rabbit-server as the ha work can't exist as a plugin

commit e3506df92fbe007eaa933e34c5b11b1222976e50
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 16 11:47:23 2010 +0000

    Unforgeable user-id.

commit 845a759f8993fe6faa66d8ddadfb20e8a1aad31c
Author: John DeTreville <jdetreville@vmware.com>
Date:   Wed Dec 15 16:52:17 2010 -0800

    Ignore heartbeat timeouts in closed state.

commit b0961fe47618356c79c63f73fe6e33392feca102
Merge: 5f40f022b abf24c794
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Dec 15 11:48:58 2010 +0000

    merge bug23232 into default

commit 1ae251253762810085f46220e8ee9ae8d1689a43
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 15 10:51:58 2010 +0000

    Distinguish between two ways of listing vhosts for users.

commit 17807ea8376d04a6ce685bde8e0877b7469d31e7
Author: John DeTreville <jdetreville@vmware.com>
Date:   Tue Dec 14 16:16:01 2010 -0800

    Put in Matthias's changes.

commit b2b3c39fc89e3a00ba26e2d22542d9d76c4f4234
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 14 18:26:59 2010 +0000

    Don't use re where it can be easily avoided in the plain auth mech

commit 3c1fb6fac9e9e616c559cf2eb312506581686b2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 18:09:56 2010 +0000

    Cover the case of non-admin, read.

commit c2c9a6526e9caec9be22b5e1531c640631369ea0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 14 17:52:13 2010 +0000

    inline

commit 5f40f022bbfc23b16df506239d5fd427f4eca895
Merge: 5d421ea6b 507d63362
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 14 15:07:12 2010 +0000

    Merged bug23566 into default

commit 6d1fdf67b8ff93d9f679824fbc98edb89aa709ba
Merge: 5d421ea6b efb8bda30
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 15:03:44 2010 +0000

    Merge from default

commit 5d421ea6b12f84f77d2cf918952cad89186ec00f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 14:34:08 2010 +0000

    Spec fix.

commit 507d6336279278daf715e2c16427c308bc97ae9a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 14:26:37 2010 +0000

    This is really a protocol error

commit 9a88f0bdd5b566ad415a2311a83806b864de0ec0
Merge: dc7156490 2d1b01464
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 14:25:27 2010 +0000

    Merged from default

commit dc71564903f1c123d847f560afb1009da24d027c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 14:23:40 2010 +0000

    Make refused and protocol_error cases more symmetrical.

commit 2d1b014649cdba6507a14783820c45cfbc8dba9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 14 13:00:52 2010 +0000

    global option does not exist in R12B3.

commit 817aa2674974ea425b64cc34a520dae112819538
Merge: 42f2b1ba6 ae523d758
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 14 12:37:46 2010 +0000

    Merging default into bug23554

commit ae523d758ea75906f09a79babce8c9bf4a825cce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Dec 14 12:24:21 2010 +0000

    Simplify code surrounding the return from BQ:ack

commit 208505606c0e04639507eec2d24eb71ef59ea0db
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 18:51:48 2010 +0000

    improve consistency of API

commit 025657862a4512aac04964aeda62c24194576890
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 18:45:38 2010 +0000

    The arg to duplicate_node_check is always a string, and control:diags requires a real node

commit c200f65ef8ef366edebec212eb2c7b789884cb85
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 17:44:23 2010 +0000

    cosmetics

commit 17d8f930cbd9b1b3325401adceb6a5aeedaf574a
Merge: ca6be02c8 cc13dd99f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 17:42:16 2010 +0000

    Merging heads

commit cc13dd99fb19567a4e105a34bd6274d9593948b9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 17:41:43 2010 +0000

    Do not, ever, use lists:concat. It does not do what you think

commit ca6be02c8fb706ee91c3a16b61d23a44fe865f1c
Merge: efdc7d8c1 0ae56c9c2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 13 17:25:43 2010 +0000

    Merged bug23506 into default

commit 42f2b1ba6074b7643b30dfeb693c8cb92d4a2a3b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 13:58:38 2010 +0000

    Extend state conversion function

commit 7c039eb4f4a9ed71961a8177f71cad048a619391
Merge: 14ed20ee8 0ae56c9c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 13 13:44:07 2010 +0000

    Mereg default into bug23566.

commit 0ae56c9c2c6b32cb5bf1fdea1f5a429510a3c65f
Merge: 704df47c3 dc8e2ec39
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 13 13:19:02 2010 +0000

    Merged heads

commit 704df47c3756bd62cb84d2a06655aafd8ad85e41
Merge: 368bfaf8a f6144f6cd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 13 13:15:27 2010 +0000

    Merged bug23467 into default

commit bfe4ae94b81f01f6c5561a3862b8fa8ff9a71967
Merge: dc8e2ec39 15b8801f4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 12:20:32 2010 +0000

    Merging default into bug 23554

commit dc8e2ec39920fbb56583ef543eb86f2f83b87dec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 13 12:19:26 2010 +0000

    Essential cosmetic

commit f7527b26d62a899357e07db2004486124d63353e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 13 12:08:46 2010 +0000

    Cosmetics.

commit 368bfaf8a74305a33ec03b3367d8c6c3fd14cb66
Merge: 12f170a59 a89cc42d8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 13 10:51:28 2010 +0000

    Merged bug23591 into default

commit a89cc42d89869a79a95643b83f04cb0cf129e610
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Dec 13 10:50:29 2010 +0000

    Windows prelaunch with short node names

commit f6144f6cd96dadf3db89f524099deb6e30a64dca
Merge: 12f170a59 57911250d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 13 10:43:02 2010 +0000

    Merge from default.

commit 15b8801f46667733c8fd6fcc0cf73cbe62ab1ad7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Dec 12 23:53:06 2010 +0000

    Alter the result of BQ:requeue so that it also returns the guids of the requeued messages. This makes it match the spec of ack closely and is more logical. Also, entirely coincidentally, happens to be necessary for HA...

commit 12f170a59ab4ed7dcc9ccd976d7ab027c1ec515b
Author: John DeTreville <jdetreville@vmware.com>
Date:   Fri Dec 10 17:04:16 2010 -0800

    Edited, changed default branch by mistake.

commit d3775d56b3093c224eecc3e2c840517adaf74198
Author: John DeTreville <jdetreville@vmware.com>
Date:   Fri Dec 10 16:56:17 2010 -0800

    Made emit_stats a handle_info function, not info_cast.

commit d806d94a448e787254c2ba17876ba00f172401a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Dec 10 17:04:44 2010 +0000

    cosmetic

commit b4b54035608e30a94c5c8fd8e63abd2449b88669
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 10 16:59:17 2010 +0000

    Ensure we can cope with no specified nodename (misc:makenode takes care of this); ensure we start the prelaunch node as a distributed node (same trick as with ctl); the absence of epmd is subsequently a fatal error

commit 4e976be099370a99e90cc85bea9491ca0afd769a
Merge: 088bc9f02 6fbaa75b6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 10 14:27:07 2010 +0000

    Merging default into bug23554

commit 088bc9f02f21a3ff83e27aba0aa0518d7a39df1a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Dec 10 14:26:28 2010 +0000

    Removing tabs. GRRR

commit 0bdc9b2cb2f9f990c9fa0b8c49d900b6af26dfa4
Merge: 9861a2fd0 e839eb188
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Dec 10 09:00:17 2010 +0000

    Merge bug23511 into default

commit 9861a2fd0c1c2b36ddc0d6104708bd296e5a5cc2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 9 21:07:58 2010 +0000

    cosmetic: put methods in more sensible order

commit 6e6e4db0dace2bf3c94295662d8dc7212d61eb23
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 9 20:29:19 2010 +0000

    cosmetic: avoid confusion between acks and pubacks
    ...by consistently labelling the latter as 'confirms'

commit 6fbaa75b6957e4bde48e7fcc62ad7aab40a6f089
Merge: 23f063e3c fc084ed0e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 17:57:59 2010 +0000

    Merging in from default

commit 23f063e3caeac2663bb5b3171ec580898217d63b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 17:55:51 2010 +0000

    Contract will be process is already trapping exits

commit 4df88aeeccc9272d03c2c423fb37c1008eaa8ef1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 17:43:46 2010 +0000

    Predictions of parameter explosions are high

commit 5b57841b188c8427b4ffa32df1e52607516e1ba7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 17:01:06 2010 +0000

    Turns out the memory_monitor and fhc callback registration is idempotent, and it's also just simply easier to correctly fake the amqqueue_process API. Need to then deal with rate timers and pre hibernation callbacks. Groan

commit 6a1af9f1b5330b606f690a848fda821f26720f55
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 16:41:20 2010 +0000

    Permit queue processes to be initialised with existing state. This raises the need for the ability to change the callbacks in rabbit_memory_monitor and fhc

commit fc084ed0e925235f8b3d3e32e9f8ca3854bb55e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 9 15:19:56 2010 +0000

    Correct wrong comment

commit d1ed0eca8be6d5edb366ffd3bfe3c9507236e4fe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 12:48:26 2010 +0000

    Increase the probability that the above works

commit 9ebc2256e9f14ab0af07be1b30d4e998dd3bdb23
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Dec 9 12:42:57 2010 +0000

    Allow gen_server2s to change their callback modules dynamically. That was easy.

commit a1701d1fc94f65102e5c185c897379d0a5700bdf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Dec 9 08:24:52 2010 +0000

    add stats again; update docs

commit ae24a391e4a7cb0f791b872a6d44e2934f6dc9e0
Author: John DeTreville <jdetreville@vmware.com>
Date:   Wed Dec 8 17:13:14 2010 -0800

    Clients can now override frame_max in RabbitMQ server.

commit e6e1a3c717e08c1c91c5506778124391c995caa4
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Dec 8 15:39:18 2010 -0800

    List comprehension in Mnesia upgrade functions to cut code duplication.

commit 2c7568a94a1df862a9fc540d1483bbe40b7b09f2
Merge: 2ba3f3661 4e4cdeb8f
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Dec 8 14:57:43 2010 -0800

    Merge from default.

commit ae4e7cff60352090417d4efe3b8d8bae4a3be80e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Dec 8 16:26:54 2010 +0000

    On other node death, don't delete queues which still have some extra pids.

commit efdc7d8c122fb950f108fc15a61bbe843722b5c6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 8 16:11:38 2010 +0000

    Forgot this depended on 23467, so we can mention EXTERNAL.

commit 18bf78777256f58ccea9b42e24e4066efa948188
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Dec 8 16:08:57 2010 +0000

    Add a TODO

commit a504a513243c0e5e5af7a198544414952f0b170e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 8 16:06:04 2010 +0000

    rabbitmqctl clear_password <username>

commit 61d670551c4ef4cb447549dc7273ee47e5ac1b09
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Dec 8 15:57:42 2010 +0000

    Provide a means for plugins to add extra tables which are looked after by rabbit_mnesia

commit 4e4cdeb8ff99b6a9bd00fed681dbfdf39436bbbf
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 13:36:11 2010 +0000

    cosmetic: move unpacking around in channel:deliver

commit e0e1db104c22736e8057152b8b46b50536305678
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 13:27:17 2010 +0000

    cosmetic: get rid of channel:internal_deliver

commit 8de9670794fb1a75d03c1e53c54d0da87d52ba3b
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 13:09:26 2010 +0000

    moved maybe_incr_stats to basic_return

commit fc66ac0ce08ee64f241b00f03732c942a01acb04
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 12:45:31 2010 +0000

    cosmetic: Simplify channel:internal_deliver, notify is always true

commit 11453d216582907ba8355d6bd360877e435f7b22
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 12:35:28 2010 +0000

    Get rid of -import() statments.

commit d5b92f6705b041a3ba89315ed27997b6ff139130
Merge: f6a62256f 1ffd85e58
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 8 12:31:31 2010 +0000

    merge bug23482 into default (Detect already-running broker)

commit 31cfc20bf6158c0cf21afd4bbb896e3f2204ba0a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 8 10:48:57 2010 +0000

    Cosmetic

commit 94059ac94682624d5edd6092a7b9bfd48b15b836
Merge: 1ffd85e58 d1776fe5d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Dec 8 10:31:01 2010 +0000

    Merge default into bug23201.

commit a7954f85cfa85da9e3eab7d2b8e5fb4bac27e440
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Dec 8 10:01:04 2010 +0000

    Add 'return' stats

commit cbd64f3448f4df626874c1b0c3dac101e1b018c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Dec 7 18:20:07 2010 +0000

    SSL protocol / algorithm information.

commit f6a62256f284304daec565b933269e83bbd4e4f3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 7 13:09:15 2010 +0000

    Error message readability

commit 17c589fc1ce45b878e628d780fe80ea6d2e866a6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 7 12:57:36 2010 +0000

    Remove redundant code

commit 9900fdc699326669979385c8a812c6ba3dd0091c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 7 12:48:58 2010 +0000

    Perform duplicate node check in a function

commit 1c60674660cb83ff8a8b9cbab61ea072309626da
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Dec 7 12:29:59 2010 +0000

    Cope with absence of epmd while performing pre-launch checks

commit 1111d2a20da7502d325b95f1d4357c35fc6171cc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 15:08:51 2010 +0000

    Reimplement or manually merge all past changes for 23329 onto new head of default. In general the code's a bit cleaner due to better apis within msg_store generally

commit 57911250d3f6951ec73457e3b0c495674c655b61
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 6 14:59:55 2010 +0000

    Demonstrate protocol_error.

commit fbfe779dc0a6ab797d9bfd0831c25b5a9d045061
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Dec 6 13:58:01 2010 +0000

    Better diagnostics when authentication fails.

commit b02c6c8792fde10065127fbec9e5727fda222fc8
Merge: 1ffd85e58 a821bd1fc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 13:05:18 2010 +0000

    Merge default into bug 23554

commit a821bd1fccef580bca7fceaaaeb697e924840c89
Merge: 755a485ad 5ea5799c4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 13:04:29 2010 +0000

    Merge default into bug 23554 (epic debitrot)

commit 1ffd85e580b5d5e8e7bb6b7123126933aa1cf168
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 13:04:06 2010 +0000

    Rip out old persister as it no longer works given the arrival of pub acks

commit 33d5cd485c4dc0ab203fc83659697045f702a4ca
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 12:39:53 2010 +0000

    Correction of specs.

commit 4f1efbcbded0b53f01e97adc692461e4d223644e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Dec 6 12:06:01 2010 +0000

    Minor correction

commit d1776fe5ddb5a11e8f7042bc0d35e4ac442f31b5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 6 11:55:16 2010 +0000

    add missing case

commit 9001dcac8e101a6ff4b9560410bc9c0f420808db
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Dec 6 10:48:30 2010 +0000

    add stats for confirms
    
    To recap, a published message is confirmed by the channel.  A message
    is confirmed only after all the queues it was published to confirm it.
    
    With the current change, the emitted stats look like this:
    
            {channel_exchange_stats,
                [{{resource,<<"/">>,exchange,<<"direct">>},
                  [{confirm,545},{publish,545}]}]},
            {channel_queue_exchange_stats,
                [{{<0.204.0>,{resource,<<"/">>,exchange,<<"direct">>}},
                  [{confirm,545},{publish,545}]},
                 {{<0.195.0>,{resource,<<"/">>,exchange,<<"direct">>}},
                  [{confirm,545},{publish,545}]}]}]
    
    The confirm field in channel_exchange_stats represents the number of
    messages sent to that exchange that have also been confirmed.  If the
    exchanged routed the message to different queues, this number is only
    increased when all queues have confirmed the message.  If the message
    was unroutable or was routed to 0 queues, this number is still
    increased.  This is the number of basic.confirms sent back to
    publisher.
    
    The confirm field in channel_queue_exchange_stats represents the
    number of messages confirmed by that queue (but not necessarily
    confirmed by the channel).
    
    In channel_exchange_stats, if the number of confirms lags behind the
    number of publishes, one of the queues is not confirming messages in a
    timely fashion.

commit 5ea5799c47e93a0dbf1fcca1e4bf4ebc5e0cc97d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 5 19:31:22 2010 +0000

    cosmetic

commit 3be2dd040f4d1231d7af8ff60a82e0ee6dc598f0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Dec 5 18:57:19 2010 +0000

    cosmetic

commit abf24c79420ba9e6821fe40815774b6113d5bdea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 16:16:59 2010 +0000

    Fix

commit 418a8db36f9dc8db9e14ac12a70786f625d53660
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 16:11:58 2010 +0000

    Consistency with other events.

commit 468981754b92650bf61367b42009ed69362b67ac
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 16:05:59 2010 +0000

    Cosmetic

commit edf495e1a4182dfe8cfe722499ee7b69eb181a26
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 16:03:28 2010 +0000

    Fix

commit e52e0065152bc4254344bdaa2455fe17752d53ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 15:55:23 2010 +0000

    Oops.

commit cd8b6f39d89844ecf8a31c6454e3ce923a79d559
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Dec 3 15:31:13 2010 +0000

    Add consumer created / deleted events.

commit 1f08aaca050344ed49f344495c0cfd007d10cd8c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Dec 3 11:13:14 2010 +0000

    Consistent prelaunch checks on windows

commit 8826a000741b465e3023057f0291b649e0241fad
Author: John DeTreville <jdetreville@vmware.com>
Date:   Thu Dec 2 18:01:25 2010 -0800

    Redid bug23056 changes atop newer base.

commit 5714b4cd9bbe01309b59978fe2b1c876496d082c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 2 21:05:52 2010 +0000

    cosmetic: rename field/var

commit 679e90cceeda40de209b1de77f4d056cca4e7f9d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Dec 2 21:00:30 2010 +0000

    cosmetic

commit 14ed20ee8f43a19622eba0d25aeb909609679c02
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 16:20:01 2010 +0000

    Add method name into the error tuple.

commit 5e0e4ec90962a2482c2dfcf383cd06f476edc19d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 15:15:06 2010 +0000

    Simplify

commit 49e874ef21fb804f8a018735d80de835322505e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 15:07:01 2010 +0000

    Only look for AMQP errors in exits.

commit 0a467a1836009ded735413eea8e49bc63bcafa00
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 14:44:07 2010 +0000

    Remove quotes

commit 5b2c6c9c3a57f1559c200767988afd0fd729b71f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 14:15:49 2010 +0000

    More robust SASL PLAIN parsing - cope with any number of \0's being present without falling over.

commit 29f8ae61c36ecaec7cef4f304a9dc7e591c0953f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 14:01:22 2010 +0000

    Catch all types of exceptions, preserve the stack trace in the event that we have a non-AMQP error.

commit c3476627f15ad4107485fed5bd9ac36d1d22a556
Merge: ab808178c b46009dcd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 12:58:56 2010 +0000

    Merge heads

commit ab808178cd286bdd3f32baea01451f91092f7acd
Merge: 71c9e52cd a87bb9e6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 12:40:01 2010 +0000

    Merged bug23532 into default

commit a87bb9e6cdba84aebdde49eaa51bb0fd30fd370e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Dec 2 12:39:32 2010 +0000

    Tone down the claims in the optimisation comment.

commit 49ce527be88c18a549d9c8a5be0aca6befc3ca30
Merge: 4c3b5cdd2 b46009dcd
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Dec 2 12:32:21 2010 +0000

    Merge from default

commit b46009dcd98f61d156712d2b2178ed19a98c0a33
Merge: 71c9e52cd 23a1807de
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Dec 2 12:05:25 2010 +0000

    Merged bug23565 into default

commit 23a1807de8d34165a490058f3d34b1aa2beaffdc
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Dec 2 12:02:29 2010 +0000

    Added cosmetic change suggested in the bug report

commit 71c9e52cd89dd4a8f69d1d27759eaf4f785df2e5
Merge: 9b7a1e9fe 1d9c442ad
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Dec 2 10:58:03 2010 +0000

    Merged bug23567 into default

commit 66b6f3d3950270432388a0dab4e1877a5ae52319
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Dec 2 10:05:29 2010 +0000

    fix to compile and run under R12B5

commit 1d9c442ade4e2e1f8bb0bbd0a208e1225b076d38
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Dec 2 09:03:04 2010 +0000

    simplify multiple confirm code

commit 9b7a1e9fef01233548d8a2edb37cc0964162b932
Merge: 275195fc3 0a882b45f
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Dec 1 14:16:33 2010 +0000

    Merged bug23448 into default

commit 510ccc636411681fcbfeae520f00f63363600a74
Merge: 275195fc3 c5b54e16c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Dec 1 12:43:27 2010 +0000

    merge default into bug23201

commit 46b2e9ac37ef597c92e56664f1fdb330b121af59
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Dec 1 12:32:52 2010 +0000

    Diagnostics on node start failure

commit 864428a8b22537fe86a2f4f38f0f258ba68e44bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 30 18:16:05 2010 +0000

    Remove should_offer/1.

commit 7dab6c33001db1acb98b77e087610f5c3e5727c1
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 30 15:58:14 2010 +0000

    Rename plugin_activator to prelaunch

commit 69dda299b699fc755d906f38f173c7b4b1879e2c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 30 15:57:26 2010 +0000

    Check if nodename is available before startup

commit 275195fc340fa8ed14e13be82cd6fa82fc13d10e
Merge: e7eb7efcf 7c212c88b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 30 13:53:43 2010 +0000

    Merged bug20284 into default

commit 7c212c88b5e532e34732993d03bba20a94f575cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 30 12:50:15 2010 +0000

    cosmetic: put rabbit_net exports, specs, and funs in sensible order
    and consistent too

commit 88e5e89a024fc517054d503a6e10651dc286dafc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 30 12:20:12 2010 +0000

    experiment with uing {active,once} instead of prim_inet:async_recv

commit 755a485ad914deee022a869f7ed2ae1a268cc11b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 30 12:05:37 2010 +0000

    Exposing the publishing chpid right through to the BQ (and tidying up tests/types/specs)

commit 9eeee11c81d4518efebfad6d8b8453a715b9cada
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 30 10:49:52 2010 +0000

    Added tag rabbitmq_v2_2_0 for changeset c9a2e7f3f5e9

commit b86aea4aa1652160806ff3286b6abcc1ddead14c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 30 10:48:30 2010 +0000

    Changelogs for the 2.2.0 release

commit 1159352cb2bc1c0f8e2640d9e2754d2e88a42e1f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Nov 29 17:20:26 2010 +0000

    Make the tests work again. Also mirror_pids => extra_pids on the basis that it could be reusable for other purposes

commit 019a3796f5c03b23c6fcc7b33271ba35dc6262e9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Nov 29 16:37:03 2010 +0000

    Lesser of many evils...

commit 21d51a0a46657867051aa522a1d89e4b1d7c4e4a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 29 12:57:55 2010 +0000

    Introduce some abstraction, reducing duplicate calls

commit 28fedebb44b723fb7a632d02a42fdf2519a30902
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Nov 29 12:40:52 2010 +0000

    Present the whole amqqueue record to the BQ (remove duplicated IsDurable flag, correct BQ callbacks)

commit 7e1fa7f1cbf348eb5d6438ce4c84b4fcf8d0dee3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Nov 29 12:33:31 2010 +0000

    Present the whole amqqueue record to the BQ

commit fc1506364f8f51d57515011f69bac5453d348066
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Nov 29 12:19:59 2010 +0000

    Added mechanism to dynamically choose the backing queue module. Ideally, this'll end up using the generic registry that's part of bug 23467 and allow plugins to register this stuff on boot

commit fb3ba83da55bd4e8169d3c000373e22349014f53
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 28 10:56:09 2010 +0000

    flesh out writer API for completeness

commit 75a898bd61d287dabc9cbae3ba4bedda8d89ea6e
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Nov 26 16:10:24 2010 +0000

    Introduce file_handle_cache:get_obtain_count and get_obtain_limit.

commit e7eb7efcf3a36b33638f28c7e66d73cf59bd39ee
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 16:41:35 2010 +0000

    cosmetic

commit b847fd69b744c7dd0b47903133592f9a4de67f08
Merge: d87be6a2b 2584df47d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 16:28:03 2010 +0000

    Merge with default

commit d87be6a2b7143e9823b137cfa4603b1dbd069541
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 16:27:10 2010 +0000

    Cosmetic

commit 6c50d609f32995e223e22ab286bdf9b3c03ed952
Merge: b0c2cac6b dadd84b37
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 16:08:47 2010 +0000

    merge with default

commit dadd84b373cdabd2c0c2c350527a97d0a5ff887a
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 15:44:56 2010 +0000

    cosmetic

commit 2584df47dba4b4e1e4d5cba0968095d589aea3d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 25 15:37:12 2010 +0000

    cosmetic

commit b0c2cac6b7d7b3efb9df6d39dfaba5ca7b90fc1b
Merge: 72d53300f 27a6eb231
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 15:33:27 2010 +0000

    merging heads together

commit 27a6eb231e087c6ae6a358d1ee207840bd1885a6
Merge: aec5a6cec 351c82b7b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 15:31:44 2010 +0000

    Merge bug23548 into default

commit 72d53300f2b787dd8d8ed035be9b02d539ca6019
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 15:26:34 2010 +0000

    cosmetic

commit aec5a6cec71e341d81f500ab281f6f3ad09f7f49
Merge: 63feb5a6a ab2cba7d3
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Nov 25 15:24:12 2010 +0000

    bug23547 merged into default

commit ab2cba7d30788d57cbc265ea517704ed1d9db443
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 15:02:54 2010 +0000

    Opps, they shouldn't have got there...

commit 351c82b7b83c301646015d2a07336a7e73c060a8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 15:02:15 2010 +0000

    Opps, they shouldn't have got there...

commit 65ae70216d42007d6eed09eaa2c3a91be5bc5da7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 15:00:53 2010 +0000

    Cope with files not existing (or just being empty)

commit 2270af6909510f1952de4e62ebf287116888add4
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 25 15:00:06 2010 +0000

    cosmetic changes

commit 8b4a67718dfca44b5815b7e2a1bfbab59a66764b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 14:52:18 2010 +0000

    No need to open these files at all exclusive. Which is an R14ism anyway.

commit 63feb5a6ab08fdad840e46712e5db858536cf843
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 14:50:14 2010 +0000

    Abstract out file locking, and revert to not using the R14-ism exclusive flag

commit 5b206268023a544aec79aba288406372bb793d3a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 25 14:17:32 2010 +0000

    Make sure we get the stacktrace out of a boot failure

commit 0a882b45fec2c78240ebabf082e5799a466fd3a1
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Nov 25 11:52:54 2010 +0000

    Updated portfile as suggested by macports guru

commit 95ca573579e610d7f69f8b715a13fabf8d3d833c
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Nov 25 10:13:30 2010 +0000

    Indentation

commit efb8bda30a51fa0ef371814df8d8b48c0373a8e5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 18:06:18 2010 +0000

    The resource is not a string.

commit 86c5dcbacab76a2608d51832af6bc0b73b254795
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 24 17:08:59 2010 +0000

    let frame interleaving happen
    but still optimise the delivery of short messages

commit ab702e3bfed99c631e81c4b68b951098fea4483a
Merge: 0bebfc360 04138572c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 16:01:57 2010 +0000

    merging heads of default

commit 44cc17d8110f2da5282294ee3e1a50362f09e046
Merge: 72ef27128 04138572c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 15:04:14 2010 +0000

    merge from default

commit 72ef2712855fdda7bc5090fa883536f69a447c0e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 14:02:54 2010 +0000

    change order of tuple elements

commit ea195b281d15d1e3cb5de0dfaef0df3088fab6de
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 13:54:05 2010 +0000

    Dammit.

commit 04138572cc89399ffd6331060174535be9ffd9a8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 13:43:35 2010 +0000

    exit -> throw seeing as bug 23535 is invalid

commit cb604e3b0d4e29d4c35ba89be092fcc7c020d10c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 13:43:15 2010 +0000

    cosmetic

commit 0aac12c645368f2c3c0921377c807b68bd33ffee
Merge: a7d83ca01 a436d1654
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 13:38:02 2010 +0000

    Merging bug23519 into default (again)

commit bf662d6d6551ff2ac30372b37f76333910ea45f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 13:27:24 2010 +0000

    Mnesia upgrade to convert user to internal_user records. Painful since the built-in Mnesia upgrade system does not let us change the type in a table.

commit a436d1654e1437069f3669f1232ecaadbfa90c22
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 13:20:54 2010 +0000

    Application of M-Q

commit 6d75908f910abfaf6bbe84f337f4d4fae8cfab5d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 13:15:05 2010 +0000

    Refactoring

commit bac3de0fc773de4e33d59300e1ac480b66695744
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 12:51:04 2010 +0000

    cosmetic

commit a7d83ca0106fd2776145c80d2c770d8a36ee41e2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 12:38:35 2010 +0000

    gratuitous cosmetic

commit b925cff75d99a0465c35ba738743c7fbb993ec60
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 12:37:54 2010 +0000

    cosmetic

commit baa04f97602a00e6efa7aa222670f36fc6dce04f
Merge: 93b5e0e73 381b56556
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 24 12:37:40 2010 +0000

    Merging bug23519 into default

commit 79dad9ffccf527b244d08274476e562b62bca292
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 24 12:33:50 2010 +0000

    Add helpful comment about windows flushing to rabbitmqctl

commit 9fbf71408cf4fe495f5602254c65b6dd627a3c46
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 11:58:08 2010 +0000

    cosmetic + handle missing case

commit 14d115196876a5880dc69d16000c6e889c639ac5
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 24 11:56:46 2010 +0000

    Slower rabbitmqctl shutdown on windows flushes output

commit aa397d37163ad150c4489fc68e4143dad75809ad
Merge: 61e46087c e2eb7725a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 11:51:29 2010 +0000

    Merge from bug23467 (and hence default)

commit e2eb7725a3298ad9cadb4a024a7cb87048141ea1
Merge: 381b56556 d3ff99f9c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 11:50:11 2010 +0000

    Merge from default

commit 61e46087c2f35906795e8e6032dd5e2d830b6908
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 11:37:19 2010 +0000

    Spec stuff.

commit f598074d7928c360190b948e6e11b3599195e5c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 11:05:07 2010 +0000

    Don't allow the backend to grant access to a vhost which does not otherwise exist!

commit d3ff99f9c799f9953b5cbd51032904e1f41cb3bf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 24 10:40:16 2010 +0000

    Tiny simplifying refactor.

commit 30f88387eeb4c571fede283886d6474944324d3e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 24 10:38:56 2010 +0000

    remove redundant record field

commit 381b56556798419a309b3d4b9a693ad77a9e6ac4
Merge: 24be1a5e0 ab58d3f60
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 23 18:12:35 2010 +0000

    Merging bug 23335 into default

commit 24be1a5e0daaaa27cd1120bddeac152c15a462dd
Merge: d52767901 6168664fa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 23 17:54:04 2010 +0000

    Merging bug 22692 into default

commit 0bebfc360997826ba7b532aaba140aab44951d03
Merge: ebb6e53b9 58c2ff376
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 23 17:51:10 2010 +0000

    Merged bug23494 into default

commit 6168664fa058177e50c0032bb774069c61ff6e59
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 23 17:40:09 2010 +0000

    It's rather crucial to call reduce_memory_use at the end of publish_delivered if we've added to the acks. Also reorder items in backing_queue_status so that they fit better on my 160-char wide xterms. It's also a bit more logical

commit 001e95a03788f339561363abb87cbed9671f1b5e
Merge: d52767901 1b81f760b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 23 17:33:06 2010 +0000

    Merging default into bug22692

commit ebb6e53b9908c78258ae1c0e50c51693856b191e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 23 17:22:18 2010 +0000

    cosmetic

commit b3db9def142ea58623294ede1c35dfe5a310fdc8
Merge: ae86a0cef 16cb47891
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 23 17:17:07 2010 +0000

    merge bug23531 into default

commit ae86a0cef28083e44a8f180ffef2d7dd1d69cab4
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Tue Nov 23 16:07:54 2010 +0000

    Use internal_send_command, since we're sending to a 'raw' socket

commit 597483d801a800c038dbb2d16291b05374277914
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 23 14:12:55 2010 +0000

    Offer tx and non-tx exchange hooks

commit 16cb47891d6aa3fa924501025e07addbb598b17e
Merge: 2f65c78ef 5375bc5c6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Nov 23 13:45:59 2010 +0000

    Merged bug23293 into default (again)

commit 5375bc5c6f1821e063bb2ea5da600aa7b755ee3e
Merge: 462a16fad b80bd5252
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 23 13:35:41 2010 +0000

    And, err, merge heads.

commit 462a16fadee38f9ccf0eaac1f1ff96ea72e9e125
Merge: f29cb718e fbf2bdc95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 23 13:34:54 2010 +0000

    Merge amqp_0_9_1 into default.

commit f29cb718e3eb636a2bdd84ce967fbefcd649d4e6
Merge: 9ee6d80c1 dd999bfef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 23 13:33:55 2010 +0000

    Merge heads of amqp_0_9_1

commit b80bd52526abac83d886e12371c86678a66a72e0
Merge: d52767901 fcf2e481a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 23 13:11:15 2010 +0000

    re-merge bug21377
    since it had a dangling head

commit fd86b29fb2b948381824fc16501c42b7606b8134
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 23 13:11:10 2010 +0000

    Allow Module:check_vhost_access and check_resource_access to return error tuples too.

commit fcf2e481a55e408614507838789ae6328cfe4e05
Merge: 184211476 c729982d6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Nov 23 13:10:41 2010 +0000

    merge heads

commit 556cfd5e2fa6ee9e2c9282749d844157fb7e4d55
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 23 11:26:24 2010 +0000

    Fix some whitespace issues, add a note

commit d5276790137419632cfcdc1c43250166ab125732
Merge: 89fcddb7e e64d8aa70
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Nov 23 10:58:49 2010 +0000

    Merge bug23186 into default
    
    plugin activator should use command line args instead of rabbit env vars

commit e64d8aa70ef29db76b40ecffe9d24902e0444e12
Merge: 64ec063f6 fbf2bdc95
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 23 10:03:44 2010 +0000

    Merge bug23513 into default

commit d5ef3f6cb936bbc72084316de6d53bde169b1d9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 22 16:04:47 2010 +0000

    Let an auth plugin specify which vhosts a user can see.

commit 194543338122d9807f2a809c9458d8aac0199c16
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 22 13:58:30 2010 +0000

    Allow auth backend modules to fail

commit aeab4639d6dc4182c66c336d58b7fc9050143b68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 22 12:48:32 2010 +0000

    Fix accidental renaming of an info item.

commit 2e4c9d5d8dbbadca756575e1f6d030c8a5773a4c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 22 12:38:01 2010 +0000

    Improve consistency.

commit fbf2bdc95361fdef5ad5b55774b661bc6ccaee1e
Merge: b1a330c88 145c4e991
Author: David Wragg <david@rabbitmq.com>
Date:   Sat Nov 20 01:37:54 2010 +0000

    Merge bug23523 into default (rabbitmq-asroot-script-wrapper is pointless)

commit cce31163e09fe8a7c9f74c3a04b763d8024dcc42
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 19:54:04 2010 +0000

    Not sure that's the right approach but at least a) EXTERNAL works via pluggable backends now and b) I've got it out of my head.

commit bc626227d8faf64e5ff6b6b9146c86d1cfbe2d4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 17:00:35 2010 +0000

    Increase the amount of correctness

commit e839eb188f4b561829ef48f1933cbd70dda21345
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 19 16:50:38 2010 +0000

    Move HOSTNAME and NODENAME to rabbitmq-env

commit 17e620ac28b3dbbe0329a8b18d9a2b4f0f502260
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 19 16:34:58 2010 +0000

    Remove OS-conditional and use hostname more conservatively

commit 800faeeed5a6a0763ccd86a66484c01232796a6b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 15:54:42 2010 +0000

    Be consistent about refused return

commit a583f94612ec993cd48bf37ae119a266b2dae760
Merge: c9d4f77de 145c4e991
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 15:48:29 2010 +0000

    Merged default into bug23467

commit db9b1e02f1907da9ede6734c9d91a560de75bb9a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 15:41:53 2010 +0000

    Umm, these are probably important

commit 5aa8956519d383339160ca9f2e1dcacf397ea263
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 15:36:00 2010 +0000

    Rather impressionistic sketch of how pluggable auth backends might start out.

commit db1b49406cded8fc0e616fb5b9090dd68025776b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 19 14:55:20 2010 +0000

    Make scripts work on Solaris

commit c9d4f77de6c4845f262a12ad730aa592c7579142
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 19 12:10:03 2010 +0000

    Remove untrue statement

commit b1a330c88645904fbeb9e2130f2ab91912850c3e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 18 17:04:53 2010 +0000

    Remove rabbitmq-asroot-script-wrapper

commit 93b5e0e739c233d43bb447c04c96c1dac14f8b0d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 18 16:22:59 2010 +0000

    Stop mnesia while taking the backup

commit 67cce9fb792a2a802ef4a4ce598619805cfae38c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 18 13:25:36 2010 +0000

    Take a backup before upgrading.

commit 1b81f760bdfe1ab9a80d32c30316a40e2d4d55fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 18 13:21:26 2010 +0000

    Minor refactorings, and a couple of fixes

commit 2ba3f3661defc8a58e83f9156fef933f318a11e8
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 18 13:17:14 2010 +0000

    Merge add_internal_to_[exchange|durable_exchange] into single upgrade function.
    
    Per Simon's feedback---they really belong together.

commit 145c4e99154f804e48a89713fd2cc9bfdc5c889b
Merge: 72dbac575 ab198cfa8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 18 12:23:23 2010 +0000

    One head is better than two

commit ab198cfa801f4454ffa29c62720ea87482ec916c
Merge: d549fd38c 198600c60
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 18 12:05:08 2010 +0000

    Merging bug bug23498 to default

commit d549fd38cfae385599a16ebfd61331aa0cb68018
Merge: 9d949f92d d269d2dec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 18 11:56:07 2010 +0000

    Merging bug23505 into default

commit 72dbac575bc0a1007dc24fee923edcbda7a3151e
Merge: d269d2dec e58fa7695
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 18 11:47:19 2010 +0000

    Merged bug 23424 into default

commit d269d2dec092ab3cb5ba534ad91a9789a1aa32a4
Merge: 0b99d85d9 85192bdd5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 23:26:05 2010 +0000

    merge heads

commit 85192bdd57e6ae3dfed9cc1cabee757bb382680a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 23:24:47 2010 +0000

    oops

commit f624fc7704a07b97a67a096740505c69f5c74846
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 23:17:24 2010 +0000

    minor optimisation: ask for next piece of data before processing
    This reduces the likelihood of the reader process stalling,
    i.e. ending up in 'receive' when there is nothing in the mailbox.

commit 9bfc13adb1377bb38156d06e62f32c0688923ed6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 22:59:33 2010 +0000

    remove some cruft in reader, and some minor tweaks

commit 338941d5013675acd681a5b85f8552d3ee468165
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 17 16:56:38 2010 +0000

    Add Mnesia db migration for rabbit_durable_exchange table.
    
    The broker should now be able to auto-upgrade both rabbit_exchange and
    rabbit_durable_exchange tables at boot time.

commit a8af773cf6f73916cfbfbe0c122c0c198afa9399
Merge: ee3d5bc26 576250f24
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 17 16:39:50 2010 +0000

    Merge from default.

commit 9d949f92d6dc5753b64b95bad6051d8a52a08c04
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 16:30:37 2010 +0000

    some routing optimisation
    - handle the very common "message goes through single exchange" case
      specially
    - use a gb_set in all other cases - it performs much better than a set
      for smaller sets, and not too badly for very large sets either.

commit f40ff434b2b985e4680ba7bb9741f0271d81b259
Merge: f6d111c33 d1107ceb4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 17 14:58:14 2010 +0000

    merge from default

commit e58fa7695a89508f1249075a1352370e2c438ee3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 17 14:37:01 2010 +0000

    refactoring

commit f6d111c331105058281d1ad802b45e5e2820ca77
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Nov 17 14:35:45 2010 +0000

    fix confirm after basic.reject{requeue=false}

commit 3a5fa2efc163380aa0e0353e7f1f1e5260fa67dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 17 13:55:50 2010 +0000

    cosmetic: remove superfluous imports

commit 69419ca8876ef7495ef2a0a7a75be3532a7f911b
Merge: f417c08bc d1107ceb4
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Wed Nov 17 13:27:31 2010 +0000

    Merge bug23460 (emit hibernate time in stats)

commit 198600c60e8081bb6544b40575050319cf6de0ea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 17:56:40 2010 +0000

    Throw rather than return errors

commit d4add8b0d8c97e528a9cb064e8ebaa13996e47e0
Merge: d1107ceb4 bfdcc30be
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 17:51:50 2010 +0000

    Merged default into bug23498

commit f417c08bc693f7de9f15dff5aa76141c4237324a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 17:26:29 2010 +0000

    Matthew points out that erlang:now() can be rewritten as now().

commit 6de80d7002824c1f71521a8e2767b057cd39eea0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 16 16:17:42 2010 +0000

    Added queue_ttl upgrade

commit d1107ceb4493f048cf1e5f7fe0b3271bb0e49d1f
Merge: 4e855ba84 576250f24
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 15:59:50 2010 +0000

    Merge bug23488 into default (Remove rabbit_misc:intersperse)

commit a7e09f194f12e7b2d75b22f0d224914dfe1aaa3a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 15:40:18 2010 +0000

    Reoprt idle_since pseudo-info-item.

commit bfdcc30beef5023a8a3d4c939dc8a2616779b2ca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 13:39:35 2010 +0000

    Fix

commit 70ab964a9b555f96175dd20be358cccfaa0674cd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 12:13:53 2010 +0000

    Don't open a security hole if server is misconfigured.

commit 64ec063f6d7b7f9e0da98af6b49918490815baf6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 16 12:09:10 2010 +0000

    Fixed windows scripts

commit d6c06d5e66d6edf782c059a294767139e4e054a4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 12:08:36 2010 +0000

    Specs.

commit 576250f24bfed3190e8f438cbd0aef87c14a22bd
Merge: 1ed98a14d a5c489b17
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 16 11:47:19 2010 +0000

    Merging bug 23496 to default

commit 6494e66c5c7bc34a020fa63264793643a177cd06
Merge: 2330e5e05 ebf653fcb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 11:45:19 2010 +0000

    Merge bug23498 heads

commit 11779f5c25d635dd76b5050df5cd41ba1f3f2a6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 11:31:49 2010 +0000

    Fix default config

commit fd5c3c3821fe3a6bf550e8498193f1fcb273218f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 11:06:57 2010 +0000

    After reading RFC5802 I'm not convinced this approach can be salvaged (in a sensible amount of time) so let's replace it with something that is a simple demo.

commit 1814eefb1b1a0a71e42faaed02dd554ea1b2b21d
Merge: 63e572efb a5c489b17
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 16 11:02:15 2010 +0000

    Merged from default

commit a5c489b17f85c935a41b618936db03125ab819dd
Merge: 19d62579c 53f90c8ad
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 15 22:46:45 2010 +0000

    merge bug23495 into default

commit 4e855ba84439549d916925b54b65423d88943db3
Author: John DeTreville <jdetreville@vmware.com>
Date:   Mon Nov 15 16:27:22 2010 +0000

    Fixed thinkos in calls to string:join.

commit 53f90c8adb1a9cfedc3dd552663d596af58dbe94
Merge: d54047019 bf0a1a1ed
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Nov 15 14:08:18 2010 +0000

    Merged bug23493 into default

commit ebf653fcbc58990f18ebb1f26d0f0e661b0fd513
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 15 11:25:25 2010 +0000

    Replace catch with try; we want to show all kinds of boot errors in a readable way.

commit 63e572efb18e5180b6a3ca37636db5c671e46449
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 15 10:50:39 2010 +0000

    Remove the beginning of the per-mechanism options thing, in the interest of getting this thing finished.

commit 2330e5e058ac4d26552af09fee397e6b6228ec38
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 13 21:38:57 2010 +0000

    attempt to correct specs

commit d540470194c039ad6c8b7cf2533c6357b122b260
Merge: 5e5016944 50f0ad283
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Nov 12 17:54:52 2010 +0000

    Merge bug23354 (remove xmlto and half of universe as macports deps)

commit 0f6b8d422910230732c8ad5026ca9642e538408f
Merge: 0b99d85d9 9cd80fed2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 17:45:57 2010 +0000

    merge default into bug23498

commit 0b99d85d98f872d12ba99febe9b31e8ec5546971
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 17:45:39 2010 +0000

    cosmetic

commit 9cd80fed2dc6f2ede001a8f6594eb77908dd52e0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 17:44:02 2010 +0000

    make build_acyclic_graph return errors
    and refine types

commit 03ee535c4fccb9b895289a352ab335624b9cb662
Merge: c13ff742a f416f2152
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 15:49:14 2010 +0000

    merge default into bug23498

commit f416f2152942177494d7431f6123034fc427a9f3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 15:46:42 2010 +0000

    cosmetic

commit c13ff742a541433ae3cdd86c75f3ba50b1877ff7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Nov 12 15:45:32 2010 +0000

    use {error,_} returns and throws instead of exits

commit 1ed98a14d8886bd03286cfcbdf73e271a45eccd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 12 11:11:37 2010 +0000

    Typo

commit f1c5bf9a27295c14e082657aed88b563c1407656
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 12 11:11:01 2010 +0000

    Don't use records or record_info, explain why

commit 50f0ad283eabdd35f6958dc27c6d996c6d957bef
Merge: 67fa3a967 548119379
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Nov 12 00:28:45 2010 +0000

    Merging bug 23481 to default

commit 1d671ba1db478a63cedd9bc83865870d5a6213e0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 11 20:50:47 2010 +0000

    exit->throw, *_or_exit -> ensure_*, and some cosmetics

commit 67fa3a9677d1607bff1d3dc63fb2eca5237ea8e7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 11 20:28:33 2010 +0000

    move around and correct digraph builder types

commit b632949ee3c9178dbe8635a27b05eaa681f0b427
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Nov 11 19:42:39 2010 +0000

    remove superfluous spec

commit 9e0c86553585e53b24dcb2304602faabffceab71
Merge: 7d8ec3d5f 7b2a828ea
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 19:40:24 2010 +0000

    Merge with default

commit 7b2a828ea1176ea37c37ce049017aa6023da5296
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 19:33:43 2010 +0000

    Rename target_ram_msg_count to target_ram_item_count

commit 7d8ec3d5f2a9aa263b2b353757fc377afa8d2325
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 19:00:35 2010 +0000

    Correction of specs

commit 68276333abfb98c33436f587cda34da83d381b14
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 18:46:15 2010 +0000

    Removed stray references to target_ram_ack_count

commit 8fca28fcc4fbbe70c44d47abfeab11f91b30f7e0
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 18:45:22 2010 +0000

    Reinstated the infinity check for chunk_size

commit fe630f2e0e3512489c65ecd1aae853e509885490
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 18:44:41 2010 +0000

    Added assertion in limit_ram_acks for is_persistent=false

commit 4e868475ad481c3cef13e80c5f90d009fe8b5061
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 18:22:18 2010 +0000

    Correction of specs

commit ee3d5bc2695d49c467eb6a121955522db4a853b7
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 17:41:53 2010 +0000

    Update rabbitmqctl docs adding 'internal' to list_exchanges.

commit c540e7409d3f7d89fc6d79d042c141508100ea2e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 11 17:34:16 2010 +0000

    Add upgrades for password hashing and listeners having IP addresses

commit 5297229b24e43ff0da364d62004cfc086c505f05
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 17:26:02 2010 +0000

    Make rabbit_exchange:infos aware of internal exchanges to support rabbitmqctl.

commit 77e2286e8fa882a054e674c9c1d52d339d2076e2
Merge: d74695db1 92b287a67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 11 16:57:51 2010 +0000

    Merged heads

commit 92b287a67b15af3fb1c336eed52bd2ab9092e18d
Merge: 5894e354d e2b0a028b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 11 16:57:08 2010 +0000

    Merged bug23484 (Remove duplication of heartbeat logic)

commit bf0a1a1ed2221119bae34ed602be68558c05fd31
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 11 16:42:58 2010 +0000

    Make peer_cert_* info items into binaries; remove the special-casing of string-y lists as not escaped.

commit d74695db106c478e0a6269c6a88d09d866bda662
Merge: c22130dfc 66765cc8a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 16:29:10 2010 +0000

    Merging bug 22573 to default

commit 5481193791f7da4b743a1d20388e847415b62df2
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 16:10:13 2010 +0000

    Makefile and generate_deps now more robust.

commit 66765cc8ade85f6c1d3b8f139851bbc7168a2154
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 16:08:45 2010 +0000

    Remove unused function

commit c22130dfc267e8e4aa05bdd630386fd838ccb4be
Merge: 25e0e894a 5894e354d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 15:34:09 2010 +0000

    Merging bug 22614 into default

commit ad796f87f109815b65c799b99e1300b908821557
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 15:01:32 2010 +0000

    Safekeeping commit; never try and build this version.

commit d775539c975ab6c66f888f2ee2ea5622acd24e0e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 11 14:49:26 2010 +0000

    exit rather than warn if future upgrades are found.

commit 19d62579c3cf28e05300ed068c95dd1d7976e885
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 14:19:55 2010 +0000

    Switch spawn order of channelsupsup and queue_collector within connection_sup

commit 25e0e894ae1ce67b59b082f1bed4d4450eccff21
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 12:59:21 2010 +0000

    Some inlining, and ensure that we limiter:deregister on ch_down (yes, limiter will be dying anyway, but it's more obviously correct in the amqqueue_process

commit 58c2ff376a46979e742cc7382844e69e532b6e20
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Nov 11 12:20:50 2010 +0000

    not_allowed -> precondition_failed

commit 5894e354d772d2812c5f4d8fac6fb071067e0831
Merge: cc587861b b5b71b141
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Nov 11 12:19:49 2010 +0000

    merge bug23476 into default (replace rabbit_dialyzer with dialyze command)

commit b6d763cb7c52263c554f5d38a3afc306a3a13006
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 12:09:10 2010 +0000

    Comment formatting with M-q and no need to use ++ for multiline string constants

commit fe58685b8ef6f05523f77c22ceeeb63cf40190d0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Nov 11 12:02:44 2010 +0000

    don't confirm messages on requeue

commit 834b8af2bc924ddf96751c895409156e63963433
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Nov 11 12:02:32 2010 +0000

    Cosmetics

commit e2b0a028b8a7911128ae5024b4d7a1bb4e2cedea
Merge: cc587861b fb0517315
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 11 11:53:14 2010 +0000

    Merge with default

commit 15770bee73e45ae9da724412a4b71ae8977c2b21
Author: John DeTreville <jdetreville@vmware.com>
Date:   Thu Nov 11 11:34:38 2010 +0000

    Added some extra polymorphism inside rabbit_ssl.erl.

commit 75981e271febab439d0923e90fa800c451d08824
Merge: 60b28b903 6e7d448b3
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 10:47:39 2010 +0000

    Merge with Matthew's cleanups.

commit 60b28b903d118ca5302b948f25f88f5b5b775c3e
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 09:54:43 2010 +0000

    basic_cancel now unregisters limiter whenever consumer count zeroes; ch record updates now require zero unsent message count as condition for erasure.

commit cc587861bb5279c5f837474367695fe1e5b319d0
Merge: ff1d4bd4b a8aa6e724
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Nov 11 09:39:36 2010 +0000

    merge bug23475 into default (eliminate dialyzer errors)

commit 361c7a1911daf29ee2cf4d60e6ab1ab50bd59f9e
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Nov 11 09:24:12 2010 +0000

    generate_deps takes file args from stdin

commit b5b71b14101dfd30aed2b9b6c32946d28db9d07e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 10 23:06:51 2010 +0000

    add a few more apps to basic.plt
    This gives us no missing funs when dialyzing the rabbit code base, and
    very few when building the plt itself.

commit a62164abe3b124be60a9025000ca8f2242468810
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 10 23:05:42 2010 +0000

    don't check behaviours - the check isn't ready for prime time yet

commit 3cfdc16761b3119eaca7f4d1a57bb7c81e2ddca5
Merge: ff1d4bd4b 0b970881b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Nov 10 22:08:32 2010 +0000

    merge default into bug23476

commit fb05173157d4b18a6570239c0c876a5d4e765755
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 10 19:00:27 2010 +0000

    Reworked heartbeating so that it really works again and so we can specify different timeouts for send/receive

commit 5a9a9fdd1c6db1f0d1e41f8250c492da6cf64e35
Author: John DeTreville <jdetreville@vmware.com>
Date:   Wed Nov 10 18:42:09 2010 +0000

    Removed rabbit_misc:intersperse; changed clients to call string:join instead; hope that's okay.

commit 2258eeceda52df44dc9c86af83d6fd3d65709535
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 18:30:09 2010 +0000

    rabbitmq-managment's loss is rabbitmqctl's gain.

commit 3fe296ba211332042e60977a3fd3e1755412dfe5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 18:24:23 2010 +0000

    Keep knowledge of sockets in rabbit_net

commit 11f3a9b278ef4e6037b5297309b32f066574b610
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 10 18:21:25 2010 +0000

    Move internal exchange implementation over from other laptop.

commit b279b34edfa174698163d0cdb2c41b02a3b29fbc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 18:00:12 2010 +0000

    Make peer_cert_* info item strings into binaries like everything else.

commit 241196725c4729c69a96a27633a05b6b6c94c289
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 17:59:45 2010 +0000

    Add an "ssl" info item.

commit a752dcc6f0486d0ad7275ce54c6150864c0c42b9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 17:21:44 2010 +0000

    Beginning of a config mechanism.

commit 7f814a1a1133fa67f2c88fb6b85693c34f998218
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 17:21:28 2010 +0000

    Fix that...

commit 6e7d448b39a9caef8659909c063ff6082b7e513e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 10 16:55:53 2010 +0000

    Minor moving about and cosmetics

commit 34ba59a6d6c1cbea4d27cf5890b140dd176f3b6e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Nov 10 16:49:03 2010 +0000

    Make use of the returned value from maybe_store as an assertion, as suggested

commit ff1d4bd4b2c53ab2ed82cd8fe5a3e80b91dd4ce4
Merge: fb9bf1aff 9e691ead9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 16:36:20 2010 +0000

    Merge bug23466 (add rabbit_types:{info_keys,infos}).

commit 9e691ead977a5b6700fe05f62ebf4f12198db7cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 16:35:28 2010 +0000

    Remove extraneous whitespace

commit cde3d07e1bc1c73f80e10e4b0108527cb1dac22b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 16:28:36 2010 +0000

    Prevent a very difficult-to-trigger race.

commit 2244644339349c01d5118f4d49e500677e0b3216
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 16:04:32 2010 +0000

    Reinstate user_pass_login/2, the Erlang client depends on it.

commit 7c0a0ca45f6cd077156498e86f287dfee9e1bf7d
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 10 16:04:29 2010 +0000

    generate_deps should no longer trip on detritus.

commit 477bcb7e42b7cac12ca0379e8b8cf580c0088e34
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 10 15:48:46 2010 +0000

    Refactor update_ch_record into maybe_store_record and make its use universal.

commit 2db81cf81e761131926de66b8382013df9fa4d41
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 10 15:39:12 2010 +0000

    Reworked start_heartbeat_fun to allow a different timeout for send/receive heartbeats

commit ab2f78530e5c849d689a37011e5ff85245268d99
Author: John DeTreville <jdetreville@vmware.com>
Date:   Wed Nov 10 14:56:12 2010 +0000

    Added rabbit_types:{infos,info_keys} and used them as appropriate.

commit 4d906f7d4562b8704a1a123ddb96ee7b157c6126
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 14:42:07 2010 +0000

    Strip out the plugin-disabling mechanism

commit ded30432188726509a7d64991befcfe9725ba1aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 14:13:40 2010 +0000

    Spec fixes

commit 0266d57133df73c714845dbc750e369a8be7d699
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 13:52:06 2010 +0000

    Mostly working EXTERNAL implementation

commit 524156880a84cf6397ec0c659ac5a32cedc379af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 13:09:40 2010 +0000

    Don't allow a client to select a mechanism we decided not to offer.

commit 4f8a5842e1bc068fe6e1eb04378dd11e14dcd819
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 10 12:11:07 2010 +0000

    Fixed up the specs for the heartbeater

commit cb4825213644553644b61df28f8aa6e37496b053
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 10 11:47:51 2010 +0000

    Refactored rabbit_heartbeat to provide start_heartbeat_fun

commit 4ce27941d56a240f3a3e528648af896825efb891
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 11:42:11 2010 +0000

    Document auth_mechanism info item

commit 145f76c144b495d445d9afd0970c9392fc6d271e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 11:11:27 2010 +0000

    Add auth_mechanism info key

commit 4ff2f25b20ed4c461ec3bb41b2e99bc9c0a8222e
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Wed Nov 10 10:34:25 2010 +0000

    Improve function naming and handle other potential leak spots in channel record updates.

commit 81acdf83959c74ebcd30cbf1e775533dd3df543e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Nov 10 10:34:07 2010 +0000

    Fix use of file:open/2

commit fb9bf1afff3699236b0af404c70359c0d42483e1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 9 17:18:08 2010 +0000

    Updating outdated comment

commit 72d6d7c40b8afc88a767c85762bacdac49463588
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 9 17:00:36 2010 +0000

    Check both our version and the remote version. This is TRTTD I think, and has the side effect that we write our version out on the subsequent node.

commit 0054b0ce511b114e7e342414ec14fd2df125c1e5
Merge: 6e0c2971c 2fa129818
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 9 16:41:39 2010 +0000

    Merged from default

commit ef4667da4a760a6376cff26a097451b10570bb16
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 9 16:30:50 2010 +0000

    Document a bit more

commit b25a62b94ecabff3e75a9f0beb351f16b306b52d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 9 16:15:36 2010 +0000

    Get the name right

commit 289d7561c848de6002838cd699094955e25c156d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 9 16:05:37 2010 +0000

    Add our slightly flaky demo challenge-response mechanism, and update APIs etc to cope with it.

commit bf3b2a931b0260653aac0967dced37312a58e194
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Nov 9 15:43:16 2010 +0000

    Clean up trailing whitespace.

commit 617b83085f85b4a058776564f78382da100e9eeb
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Nov 9 15:39:42 2010 +0000

    basic_cancel and channel_down handlers use new helper methods

commit b822832adb111aafde6380d9433269ab0046d3dd
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Nov 9 15:18:37 2010 +0000

    Move function to be among its relatives.

commit f77cffcd78044c083a73884c5d2a8265c7625a67
Merge: 6e0c2971c dbc68a83f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 9 15:08:51 2010 +0000

    Merging bug23480 into default

commit ca92655637ec900894dc2e7f0bc96256b14cb275
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Tue Nov 9 15:05:53 2010 +0000

    Add helper functions to clean up ch records.

commit dbc68a83f0e65b2fb6c2e6ff3f71b23f31735c2e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 8 23:39:46 2010 +0000

    refactor: extract shortstr size check

commit fec392a0b7c3f59b8f26f92fa1f65ce469596374
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 8 23:38:54 2010 +0000

    don't check shortstr size on decode since it is guaranteed to fit

commit 97ce437419f70320e12f7e7b318766417d725b14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 8 17:55:05 2010 +0000

    Add a mechanism to remove plugins from the registry. The intent being that people might want to disable PLAIN and enforce MY_COOL_MECHANISM, but PLAIN is not an .ez file so you can't just delete it. This also lets you disable built-in exchange types if you *really* want to.

commit a8aa6e724fea02713c237ec6ce321dcadc81780b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Nov 8 14:03:38 2010 +0000

    saner enable_cover and report_cover funs, and saner specs as a result

commit 2fa1298180832f12a79050d6fd68ff553692b1d5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 8 11:50:58 2010 +0000

    Refactor a bit, have the first cluster node fail if version is wrong

commit b350496701affe24a77e604713d8682ad47ed6a3
Merge: 6e0c2971c 764eb6054
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 8 11:49:38 2010 +0000

    merge from default

commit 764eb6054f47aedd28d538b033fbf9cdc48ed9ed
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 8 11:27:24 2010 +0000

    confirm messages on queue purge

commit 9bc51f406b3fb9ec32261e3fcdf33fc175154b62
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 7 22:58:43 2010 +0000

    another attempt at fixing the type specs for enable/report_cover

commit 1062afca2d25c27b628ca8096bf40751d5fce6fa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 7 21:56:00 2010 +0000

    fix another spec niggle

commit 886eac494d7b6a5f7855ade079f5cf8038c03a88
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 7 21:13:26 2010 +0000

    yet another spec error

commit 73bafb20a7647418e5e8807eb32fa7da77c045d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Nov 7 19:02:25 2010 +0000

    fix a couple more spec errors and a genuine bug (lists:concat vs append)

commit 0b970881b73f024db092fdd7ad05b2ca3fe376c1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 21:05:32 2010 +0000

    run dialyzer command instead of programmatic invocation

commit 9cc831ff72187513eafd184739e7e5b61cc2d39f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 17:30:23 2010 +0000

    correct some more specs

commit 52d1e388958073f1ff95279b4c81fb30e9c8d08b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 17:24:18 2010 +0000

    appease dialyzer
    The code was perfectly ok before but dialyzer didn't think so.

commit d908f6b9e1a390783eea799cd69c304c32e17fb5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 14:27:42 2010 +0000

    document obscure case clause
    dialyzer complains that one of the clauses is unreachable

commit 99fd0a6733cd0829b8a9a0e0d39b984ef21b7647
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 14:08:31 2010 +0000

    yet more spec fixes

commit bfd8aff43f63cdc8267fbc0bc0ebbd2212acf0f2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 13:10:04 2010 +0000

    correct type spec for pseudo_queue

commit 0d3669759559681b61bef7c2345fee02e6e50da1
Merge: 540f080c6 e72282afd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 13:08:48 2010 +0000

    merge heads

commit e72282afdbf921a0cf983821815cb3db03282309
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 13:07:00 2010 +0000

    Backed out changeset 46b62f064eff
    apparently pseudo_queue is used by rabbit_hub

commit 540f080c6a04725173c2d197d1d1092e9110f0cd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 13:04:14 2010 +0000

    add wrapper for protocol specific types

commit f19befcd947b0af71938f923e120814c57a332d8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 13:02:20 2010 +0000

    export types in more sensible order and add some that were missing

commit 2fe2f2b904b19511bd89a63d3710ccc04c127c11
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 12:23:03 2010 +0000

    fix another spec error

commit 59f6941d23e2c8baa1d798652fade93465ab2b6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 12:15:25 2010 +0000

    correct orddict type
    this doesn't actually work yet since the type isn't exported, but that
    will be fixed in a future OTP release.

commit ef97e11af788adeb54267c0dd6347cf35c295a8b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 11:41:52 2010 +0000

    correct spec typo

commit b59033e1fab1cbf632c8c72c4277b21a40b31745
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 11:30:08 2010 +0000

    remove rabbit_amqqueue:pseudo_queue
    it's not used by any of our code and plugins anymore

commit 6495b5278172e17ff3561007e2dc2ff7ef8d8d59
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 11:28:55 2010 +0000

    fix spec error

commit 6e06e1d75eff0e75ef9f7dc03ffa7ea3e20f4e62
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 11:11:29 2010 +0000

    add missing type export

commit 50430cb3166b64d976d540883e4af09fc1403abb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 10:50:01 2010 +0000

    there is no such thing as 'dict:dictionary()'
    it is just 'dict()' instead

commit ef7ea33e62929a597fd5d7e7dd277018381b6656
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 10:47:26 2010 +0000

    fix a spec error in gen_server2:system_terminate/4
    ...and some cosmetic spec changes.

commit 21c9ea0f509c0039ba62c6732cacb5d7bdc34261
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Nov 6 09:47:23 2010 +0000

    backport upstream change to way print_event/3 is called
    The code previously relied on the ancient {ModuleName,FunName} syntax
    to denote functions. That is bad for dialyzer and also forces an
    unnecessary export.
    
    The underlying code in sys:handle_debug hasn't actually changed - I've
    checked back as far as R12B-3 and it's always been invoking the fun
    with Fun(...) and is not doing any pattern matching on it. Also, the
    R12B-3 docs says that the fun is "fun(FuncState,Event,ProcState) ->
    done | NewFuncState", i.e. there is no hint that it should be passed
    as a {ModuleName,FunName} pair.

commit e14c37048534eb05f944edc65acd68f271b863b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 16:39:18 2010 +0000

    Move existing PLAIN and AMQPLAIN auth mechanisms into plugins.

commit 19e63b4e9287523743ded20078d4d76661747bb8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 16:38:44 2010 +0000

    rabbit_exchange_type_registry -> rabbit_registry

commit 56252aa5ff9908baa815c18e3e8008db0b529541
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 15:45:28 2010 +0000

    Check the schema version on disc as well as the integrity check when starting first disc cluster node

commit 22a941d8d369d058beb2e3245a562e73cb9efe06
Merge: 6e0c2971c 4b12b3a14
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 15:18:26 2010 +0000

    Merge with default

commit 4b12b3a1485cf27d7b021d0df0884e0cfbe5732e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 14:59:21 2010 +0000

    Reworked ack shedding algorithm based on discussion with Matthew

commit 6e0c2971c7c1a30fef0bc895adc79d437c99c733
Merge: 629e5ac49 2bd9ee1f5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 14:05:51 2010 +0000

    Merged bug23299 (Erlang internode communication fails with user_sup undefined)

commit e2a4f48436ed3e15bd99179a45cdb54baf6af7ee
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 12:54:03 2010 +0000

    Reworked to test to be more predictable

commit 629e5ac496f858351899e595134ee175e92e0060
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Nov 5 11:16:20 2010 +0000

    Make brokers launched from rabbitmq_multi.bat restartable

commit 2bd9ee1f5846625d7d3776be3f1a3972b707a394
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 10:53:48 2010 +0000

    non_neg_integer(), surely

commit d0167cb3a51a1d5935e388bae3c49c69d3ecd9ee
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Nov 5 10:46:44 2010 +0000

    Add now_ms/0.

commit 6335bbeb1f39d4a22dedd789600c2598849157ec
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 09:30:37 2010 +0000

    That was quite special

commit 2a38e404d66616dba6fd5ddb920f8f33492f1950
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 09:18:05 2010 +0000

    Clarification of the comments in VQ

commit 8a981d289945892f42e86ec39cbddb30daf8d384
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 00:43:08 2010 +0000

    a bit more clarification on the comments

commit 7f8941a4b4d1628cbe07b88feb3767feffcfd180
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Nov 5 00:11:30 2010 +0000

    Cosmetic change and first draft of comment updates

commit 47773edc8b8ac74f97dc3214e316fcaca6e400fe
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 4 22:51:56 2010 +0000

    Purely cosmetic

commit 6a85139dac11d92609be0436101c6301547453e3
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 4 16:00:08 2010 +0000

    Added a test for the ram ack flushing. Tweaked the way RAM is shared between acks and msgs

commit 7b3757000960e1957412ff55150198c56fc5b7f1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 4 13:51:56 2010 +0000

    Keep the old behaviour when upgrading from 2.1.0 or earlier.

commit 0e1a99264a677d48a663fd0964741a383bd52bd5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 4 13:41:19 2010 +0000

    Check the version we want matches the one a remote node is running before joining the cluster.

commit 97b1aa644e868ace835cb52ed4b4d88f204a8ca6
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 4 12:52:46 2010 +0000

    Removed stray TODO

commit b0580e683354e2969d7981e57a2d6a55ed151a38
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 4 12:32:21 2010 +0000

    clean up

commit a515a6d556cda2bb165f098e67c97ef0532da575
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Nov 4 12:25:43 2010 +0000

    Removed io:format calls

commit 57614a81ceb3f95522ec6c72c6f7c4637ea31fa1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Nov 4 12:03:44 2010 +0000

    Create the schema version file in the case where we acquire the schema via the cluster.

commit ab58d3f6019759c8c508cb6a405872ce507c1806
Merge: 02baf503d 70a262439
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 3 15:26:28 2010 +0000

    merge with default

commit f612fed1c09ec780bc29a681f584dc3c597a3a74
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 3 15:19:05 2010 +0000

    cleaned up some io:format

commit 6b8159df829aec5c4f5137c8d29ffcfc475b514f
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 3 14:30:39 2010 +0000

    Roughly working ack shedding

commit fa09827def23f2b7404860a7e4e7705295da4ba8
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Nov 3 11:29:38 2010 +0000

    Further experimentation. Still not quite working

commit 89fcddb7e956f077169947c2abe8a13ea7337fc0
Merge: 02baf503d d59dde540
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Nov 3 09:48:42 2010 +0000

    Merged default into bug23186

commit c9f70e4af4c77bad9a868026842442e16f42412b
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 16:57:38 2010 +0000

    Calculating RAM duration takes into consideration ack rates

commit fa96008335997564e89f2190074a18c137dfca22
Merge: 02baf503d f1a2dee9c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 16:34:35 2010 +0000

    Starting tracking ack in/out rates

commit f1a2dee9ccf1aa0934d44d069b057e91ffe196f1
Merge: 88055eaab 1a033592a
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 16:14:15 2010 +0000

    Merge with default

commit 02baf503d3404fac02321a0d5ce7b1040036c584
Merge: 26adb6694 2293e1fd5
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Nov 2 15:58:12 2010 +0000

    bug23416 merged into default

commit 26adb669427369be1b6a10279a060a22c6d59e8b
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Nov 2 15:39:30 2010 +0000

    remove repetition + formatting

commit 2293e1fd55198ebbe72fb4a6b1b8f82f2d9f9f09
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 15:31:27 2010 +0000

    Changing opaque type to normal type as it at least stops dialyzer from exploding. Dialyzer's findings are still wrong, but still...

commit d32baff8c02cd9e9c6759d05aa2e3c384554a31f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 2 14:23:58 2010 +0000

    Blow up if the upgrade does not leave us with a valid schema. Refactor several nested case expressions into one big one.

commit e6d60cbacd5276927931da1fd36e840805163f49
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Nov 2 14:08:46 2010 +0000

    Missed update to rabbit_types.

commit 88055eaabdb66e5eee33aaaf3b2f9035f7720a78
Merge: 39a40495c ba3f707df
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 2 13:19:27 2010 +0000

    Merge bug23454 into default (Enabling stats prevents hibernation, resulting in excessive memory use)

commit 39a40495cc1e1243717be5f0a3fb0d5b82b3ac85
Merge: e83a4f569 c3672b65a
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 12:20:25 2010 +0000

    Merged bug23346 into default

commit 802012a6b23271d74445cdfc56f907ada203e20c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 12:02:18 2010 +0000

    Inlining to prevent running out of disk space by overly long source files

commit 5e5016944a98230bbeb2654ece5ff06e3679c546
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 2 12:01:42 2010 +0000

    The tarballs are not both in the same dir! Also, move bashism out to a bash script (I'm not sure we can live without it).

commit a80226ec7171a249855daffc52f8d01cd8d8fc8f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:58:57 2010 +0000

    Same as before - avoid unnecessary functions for pattern match

commit 27feb94a47dd7b7da3173e2d4bf839656039e586
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:51:54 2010 +0000

    Match the list: no need to use length

commit f1a7b4f0d037750e94fee88f908e941fdea45c7f
Merge: 2720e4f99 c3672b65a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:50:54 2010 +0000

    Merging default into bug22573

commit c3672b65a7a6ba70d2643c464a055bf379b61c85
Merge: 537d0ff87 0bd30c535
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:22:43 2010 +0000

    One head of default is better than two

commit 537d0ff87dcb935e20e887573fd445e105240128
Merge: d02620a47 603e852ee
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:22:04 2010 +0000

    Merging bug 23411 into default

commit 0bd30c535063a2121e82eb7b26b2ecc1d042baa4
Merge: 603e852ee bc7b53133
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 11:16:18 2010 +0000

    Merged bug23419 into default

commit bc7b531330518db5f0d79216ac8a30636d73fbaf
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Nov 2 11:10:59 2010 +0000

    Removed unused defines

commit d02620a47a3bb5347dd41232a94852b0e96419fc
Merge: bafaff1f1 603e852ee
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Nov 2 11:02:53 2010 +0000

    Merging default into bug23411

commit 11f0347229dec7dd2ddb8ce7d9e09b97f727b34e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Nov 2 11:02:11 2010 +0000

    Don't add the name MD5, don't base64 encode.

commit ba3f707dfe7d97ef80ee98f9455128ff91dd5540
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Nov 2 10:45:27 2010 +0000

    Channel was also wrong.

commit e83a4f5690ae602b960542e06497d94388712bc0
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Mon Nov 1 12:50:12 2010 -0700

    Bug 23346:  change appropriate usages of dict:find to dict:fetch in rabbit_[in]variable_queue.

commit 706c3e744e6a3042d65c1499c2a31d7ab464705d
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Mon Nov 1 11:21:38 2010 -0700

    Replace usage of dict:find with dict:fetch in rabbit_invariable_queue.

commit 4c6e21fbaab56728d0b737efac415993689e92a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 1 17:23:05 2010 +0000

    Revert the change to check_vhost_access/2

commit b77912abb3fdee4d01aa6a75af6485aa3b7f5b14
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 1 17:00:43 2010 +0000

    Add change_password_hash/2, rename hash_password/2 as it has little in common with hash_password/1.

commit 1eafde927e0e2cb7993dd53c612101c4f395b111
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Nov 1 16:07:12 2010 +0000

    Use MD5 rather than SHA2 to avoid embedding anything. Indicate hashing function in the hashed PW, just in case we change our minds in future.

commit 405adb46fab99a8fe40cc373cc8b212276f6d8d2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 1 14:29:15 2010 +0000

    tests pass

commit 2c5759864c3a094ee0831c4e076b6e9a5e65e46b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 1 14:11:41 2010 +0000

    only wait for disk syncs for persistent messages on durable queues

commit 9e1f0572d052463b7ab94d516c241c3e69191dca
Merge: f5a19c98e 0a57389f4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Nov 1 13:59:04 2010 +0000

    merge from default

commit 13eaa1558759b8439805fbd1d280835bcb133e44
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Mon Nov 1 12:43:46 2010 +0000

    amqqueue emit_stats should reply with 'hibernate'

commit 603e852eea3ce8802f51bb8842df3f4f1a76b8e5
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Nov 1 12:35:18 2010 +0000

    Use 12B05-friendly conversion of atom to binary

commit f5a19c98ec202880fe0508b503903df26f101a5e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Oct 31 14:32:30 2010 +0000

    confirm transient messages in the queues
    
    Transient messages are now handled exactly like persistent messages:
    they are ack'd only after all of the queues have ack'd.  Unroutable
    messages and messages routed to 0 queues are still ack'd by the
    channel.

commit c5b54e16c2cfe5bb3056b76f767ad42c7417a64d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Oct 31 13:25:42 2010 +0000

    update exchange and queue_exchange stats on confirms

commit 0a57389f4429357aaaacc663c28ae4a02034e215
Merge: 852a963bf 32c15ce30
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 29 17:29:13 2010 +0100

    Merged bug23293 into default

commit 2f65c78ef22d2480055f2cc2f2895e40b3c332db
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Oct 29 16:00:12 2010 +0100

    more man page namespacery

commit 32c15ce3074c45414d60558675c0a86c5e5f45fe
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Oct 29 15:34:43 2010 +0100

    really remove namespaces

commit 852a963bfb221c0713c6903ac62279e494a03d3f
Merge: ec7086453 0ff22caa2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 29 14:11:59 2010 +0100

    Merged bug23442 into default

commit 0ff22caa2dce097876fd863a2495c37e725a12f7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 29 12:48:55 2010 +0100

    Add a comment to explain

commit 07ed3788482f32574d9bda40d1e430ce03fa37f9
Merge: 29aaea62f 91867c3a4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 29 12:37:04 2010 +0100

    Merged bug23446 into default

commit 7e13a96ced181dab09039bac642605550b6f6ab6
Merge: 740877e7e a250fccfd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Oct 29 11:38:27 2010 +0100

    merge from bug20284

commit 29aaea62f60952ebd7cf68d7f8d8f244b5e60ad1
Merge: fc31ac8db 69c0bd831
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Oct 29 11:20:36 2010 +0100

    Removing two heads

commit 69c0bd83150bf5cb4ee5b50db6404495456e3288
Merge: bbae6be61 0f90ff4da
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Oct 29 11:10:02 2010 +0100

    Merge from bug23422

commit fc31ac8db83c5eb78c6a183b4bd1eddf126f7915
Merge: 39e1bbb89 5cd1e085e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Oct 29 11:06:29 2010 +0100

    merge bug23437 into default

commit 39e1bbb8955639121dbf046ad0845cc6ac0a6cf0
Merge: 0f90ff4da 6b0aef0a7
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 29 10:36:40 2010 +0100

    Merged bug23218 into default (configurable server_properties)
    
    Allow custom server_properties to be configured in addition to, or overriding
    the default ones (product, version, platform, copyright, information). E.g.
    [
      {rabbit, [
          {server_properties, [
                  {foo, "foo-value"},
                  {bar, "bar-value"}
          ]}
       ]}
    ].

commit 6b0aef0a7a46dc38b0bba86fe6e201b576a5ed35
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Oct 29 10:21:55 2010 +0100

    Whitespace

commit 092da3e7932744df96204a8ff2e277ea339f096a
Author: Jerry Kuch <jerryk@vmware.com>
Date:   Thu Oct 28 12:50:07 2010 -0700

    Fix for bug23218

commit 91867c3a44ff6aa3cdea217062450244d577ec6d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 28 13:32:35 2010 +0100

    Store listener IP address

commit cc7653607acb4e9657e5ca8534e7207cb1c4921f
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Thu Oct 28 13:05:00 2010 +0100

    applied emile's patch

commit b2be431a3fdd18bea340d4aad73a9f2d36bea911
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Thu Oct 28 13:02:50 2010 +0100

    backed out previous changes to man page stylesheet

commit ec70864530701d6feb6d72929c96c80aa938854a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Oct 28 12:59:39 2010 +0100

    Use the protocol field to indicate something useful.

commit 5cd1e085ec717c32d5afd222e9e008ffbbbb4f55
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Oct 27 16:19:33 2010 +0100

    Remove unnecessary SSL include

commit 0f90ff4daacbd6f53ea1da5323d73aaaa2ca0218
Merge: 37515529c e531fe1cd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 27 15:39:02 2010 +0100

    Merge bug 23408 into default

commit 2720e4f996c7c5874ef6bff9966c864b650fcab1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 27 15:13:33 2010 +0100

    trivial

commit 1b2246324499f428d6dfb160a59feece114e9035
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 27 15:09:10 2010 +0100

    Even more beautiful

commit e531fe1cd1bbadb4a133fa9e89ffcf71318a254a
Merge: 83ae729cb 8ca5359ff
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 26 17:14:33 2010 +0100

    Merged bug23415 into default

commit 37515529cd6a8119c44166d9031eb18c09049060
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 15:17:29 2010 +0100

    cosmetic

commit c1ae3c8966ad762b9d8413323e9e0a0bbb8535c7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 15:16:01 2010 +0100

    remove unnecessary begin/end

commit c0c05b7eaad876289f958c7b2f2238116f2947a3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 15:10:19 2010 +0100

    Improve passing of state in tests (and correct some wrong state numbering at the same time. Oh for some monads...)

commit a517780c5b0a1c81a017cdf5874e953a443b5a36
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 15:09:06 2010 +0100

    undo incorrect fix

commit 79a578a87b25d10509ce76fd66154753f4e69b85
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 14:51:35 2010 +0100

    msg_store:write does not alter the msg_store client state

commit 194606150b3907587a5489737440ca41d1f2d06b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 14:08:37 2010 +0100

    If Terms differs from Terms1, then it'll be because there was an issue in recovering the msg_store client refs from Terms. Now given that the terms are stored in the clean_file_name, there's a possibility that we crashed _during_ writing the clean_file_name (e.g. ran out of disk space). Thus we could then read in a corrupted terms file, set Terms1 to [], but still think we terminated cleanly (as we could delete the file). However, in that case, qi:recover/1 will detect the error when reading the terms file and will not try and present those terms as client_refs to the msg_store on startup. At which point, the msg_store will record dirty shutdown in its state, and then qi:recover/4, at which point the qi will do a dirty recovery. Thus in conclusion, the structure of the term file essentially forms its own checksum: if it's parsable then the data in it is trustable. Consequently, it doesn't actually matter if we pass in Terms or Terms1 here, but Terms1 is more intuitively correct

commit 68d7d93c88e356b8f0be70602ce8d956d1088749
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 26 13:51:41 2010 +0100

    Various API changes

commit 3161b54d6d10d787b7469bcc246a1fb7064977d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 26 13:12:52 2010 +0100

    Hash passwords.

commit 53f291c541b355e40a8bec86724b6523ad629eb6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 12:58:10 2010 +0100

    whitespace

commit 8ca5359ffac4f7d02e1e439ecb42e1b586abf1ff
Merge: ea6077d68 0caf8cc61
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 12:36:41 2010 +0100

    Merging bug 23429 into default

commit d59dde5408c2cc7b2f014cf8c26d4f0063ec2b3b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Oct 26 11:37:46 2010 +0100

    Plugin arguments for windows service

commit 83ae729cb7e9e02c8751161a52863cf793df31c8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 26 11:34:37 2010 +0100

    application:get_env/1 -> application:get_env/2

commit e16b59f63170160c1553401d2c9726a4efe3ea78
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 26 11:06:01 2010 +0100

    Remove hack

commit e5e7bb73896aac09ab6f67b5e8c137d795acae11
Merge: db5260540 0caf8cc61
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 26 11:04:41 2010 +0100

    Merge in default

commit 0caf8cc615ee94c21a46bfa4c1f19b62aa63a739
Merge: d7354c96d 1a60d0e01
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 26 10:59:37 2010 +0100

    Merge bug23319 into default (remove client scope)

commit fe60b50f385f3516a3872a681206f517cae595a2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 26 10:17:12 2010 +0100

    remove references to cluster_config_file
    
    Also, add cluster_nodes to the .app file.

commit db52605407e5d04f38b648484207bf08c93fe097
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 26 00:52:57 2010 +0100

    Abstract graph construction

commit 740877e7eaf73d4976db445c0b27f39a6c19f1c3
Merge: d7354c96d 6acde84ca
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 25 22:29:37 2010 +0100

    merge from default again

commit 6acde84ca164645d554de58cc68f0ef0ab9035ad
Merge: 216d967f6 b9cea0206
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 25 22:21:29 2010 +0100

    merge from default

commit d6ac904a94001f41057b10c1ebbe50361181d846
Merge: d7354c96d 1c834a924
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 25 22:11:33 2010 +0100

    merge default into bug23408

commit d7354c96df639f127b020f8a43f87adad212fe5d
Merge: f287f3adc 5e742b324
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 25 21:49:04 2010 +0100

    merge bug23344 into default

commit f287f3adc874cd4a590fef7905208227b1ed77ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 25 21:11:34 2010 +0100

    cosmetic

commit aaf7819367e241ca09abeb0165e1efcdabd94cf4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:31:21 2010 +0100

    Specs.

commit 891cacf3fc71d3b024e644e6ff5503b9d71d0fcf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:26:36 2010 +0100

    Refactor and document upgrades_to_apply/2

commit 0d42959b027f76dbc4503cea0514eef276710206
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:20:56 2010 +0100

    Rename variable

commit 3b340ab5daebe37147084386451fc7c924afe10f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:13:19 2010 +0100

    Fix copyright statements

commit 0c774c7c0b01fd81f94562aaaa796af1c7ee703e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:10:07 2010 +0100

    Match more return values, and reindent

commit 35983264171df2421fe48896607b9ee68ebee9ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:05:36 2010 +0100

    Undo 522af2a24c5e, wait_for_tables/0 in fact may not have been called

commit d532d637797339ff406b3c5b24558c9881b4b597
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 17:03:57 2010 +0100

    Various stylistic tweaks + cleanups

commit 2d488017a7b8108c94cc6e7097d0c6725d2100b4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 16:51:11 2010 +0100

    Rename module.

commit ea6077d6810dd7314da4cf6567df5286ca1b5732
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 25 16:35:22 2010 +0100

    Use two pools of delegates, one for each of outgoing and incoming messages. Prevents deadlocks.

commit 2ee09d057da3d4c314d1ac084d7b1ccc82177c6d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 25 13:33:00 2010 +0100

    GC no longer needs to know about its parent msg_store. Thus fold the parent into the opaque state

commit b2a8eb5d0a2aadfa76e98bb1b4b420fd50146fd3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 25 13:26:58 2010 +0100

    cosmetics

commit 5e742b32411b19afd398f27697872775cf721c52
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 24 16:03:40 2010 +0100

    refactoring: comprehensions are easier to comprehend than folds

commit 1c834a9242479ff6b48d7377483bf23ef5e0ea36
Merge: 2436b4d1c 216d967f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 23 20:42:16 2010 +0100

    merge default into bug23408

commit 216d967f6afce95f52316c98a78e0b8b1ce9f458
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 23 20:37:53 2010 +0100

    cosmetic: whitespace changes only

commit 2436b4d1c4c653c09beb7701177b1524c4b81d49
Merge: 2e1b5018f 5ef202b26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 23 08:28:41 2010 +0100

    merge default into bug23408

commit 2e1b5018fffb4745c5204aefa5a8777e7a203a58
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 23 08:20:08 2010 +0100

    cosmetics and minor refactoring on code from recently merged bug23111

commit 5ef202b26cb6e11b038ea6afc4bc7743d2b42d41
Merge: 5eb0c96aa 20b4b6171
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 23 05:35:39 2010 +0100

    merge default into bug23408

commit 50424d99acbd8821ff5d321a090a7a9f068f45d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 19:27:20 2010 +0100

    correct msg priorities

commit dbb5c011c3176c0583b55fb23e1ba82be058012f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 19:19:18 2010 +0100

    oops

commit 69c3c0c31e533edaf5f36bebb47e428c98a7d7f8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 19:16:03 2010 +0100

    minor refactor: lists:filter -> list comprehension

commit 365d21c8bb7874fec7b6355133d7e7b9876915a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 19:13:37 2010 +0100

    major refactoring of gc logic
    - separate handlers for file deletion and combination, both using a
      helper function to clean up after file deletion. This makes it more
      obvious what's going on.
    - shrink the API by including the call back to the msg_store in the
      gc functions, rather than having a separate call back step.

commit e9b14b83027e0653a83e98afc2922739911164ca
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 17:24:41 2010 +0100

    Use siblings of mnesia dir

commit e0353301d5df9d8dae9e2d2153777fea378a7c38
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 22 17:24:04 2010 +0100

    wait_for_tables has definitely been called by this point (in check_table_integrity)

commit 4ed67bf73098c4b50bc68484b9c7e9d6d6a7e795
Merge: fb8c48ce1 5eb0c96aa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 22 17:21:20 2010 +0100

    Merged from default

commit fb8c48ce171d2e1c9291d7bcbbaa1e9e45d31387
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 22 17:21:04 2010 +0100

    Only attempt upgrade if we are *really* not clustered.

commit b0a04d336f1779c98486df87e6e3fad0febc9141
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 22 17:11:44 2010 +0100

    Only attempt upgrade if we are not clustered. wait_for_tables() beforehand should thus be safe.

commit 5eb0c96aa40d4817bc2702cd0e4513cdce850256
Merge: f0650618c 656715348
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 15:49:45 2010 +0100

    Merging bug23111 to default (again)

commit 6567153481632bd538a76cf26c0aa02db22c5587
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 15:41:15 2010 +0100

    Rather than kicking off the ttl timer on recovery, actually drop expired msgs. Also, drop_expired_msgs when we get a stat call, which comes in from queue (re)declaration: i.e. ensure that at the point of queue (re)declaration, the counts are correct

commit efe0dbd87b4110a293946fe78fc2e39c3e96d1ab
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 15:23:12 2010 +0100

    Ensure at start up, if we have msgs (i.e. recovery, not creation), and a TTL, then we should kick off the expiry timer

commit f0650618c0335d607e221fd2f77e114191829a34
Merge: 6a4cb79c1 9fdf6a76a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 14:20:20 2010 +0100

    Merging bug23111 into default

commit bbae6be61035a47609beda767a27a1347a4aba38
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 22 12:53:46 2010 +0100

    Remove unnecessary branch. Also, assertion of q3's emptiness is unnecessary as the rest of the code works perfectly well even if q3 isn't empty

commit a89cbd7d20ebea4ad2a8220e488ce0ddf0374695
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 04:11:13 2010 +0100

    small refactor

commit 04fd38ead9ea5b56f4fab294a3ba8cb2d8a333dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 04:08:49 2010 +0100

    refactor: merge combine_files1 into combine_files

commit 95e6bec9fc0db30fa96db24276e49e2f8ac388ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 22 03:47:31 2010 +0100

    cosmetics and minor refactoring

commit 226d9285b91692a22d016bee0ced8c83cfdcf7c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 17:59:59 2010 +0100

    Simplify conditional and use the right state

commit 6a4cb79c1417e80bddd3f204797941285dc2a77f
Merge: 1402c2e5c 9b7c7be80
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Oct 21 17:35:36 2010 +0100

    Merged bug23331 into default

commit 9fdf6a76a0e4de9d9759911db104d4df2f7e3cce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 16:55:07 2010 +0100

    Correct spec for sync(), and some cosmetics

commit 9ba78edf5e50071a254f47275f0fbc3051ae3ae7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 15:29:45 2010 +0100

    Cosmetic

commit 2f47413694aa5b98d2c26487f73a2939533ff4eb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 13:12:27 2010 +0100

    Textuality

commit de2901343a617a689fcc3d410fab5cb9299379a9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 12:58:29 2010 +0100

    Whitespace

commit 36d450af7877be0c39f57ed40802e562b34faf4b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 12:48:12 2010 +0100

    Minor refactor

commit 04986a636fb5549708ce2a9ed8c9cbe97f6f4ac8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 12:38:10 2010 +0100

    Remove unused variable and remove peek_result() type which is unused

commit da8babfe18274eae7887161d92631ea9efccf215
Merge: 9a2ec18d5 9b7c7be80
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Oct 21 12:30:39 2010 +0100

    Merging default into bug23111

commit 20b4b617170e0218dc4be7afd924d54c27f9896c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 21 00:21:37 2010 +0100

    adapt vq to new msg_store and qi APIs

commit 2e7912c51fed49017f5521d212b01a8dcdfc2f38
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 20 21:27:36 2010 +0100

    fix tests

commit d6c6a98d51b2b7df136cf529d782d9eaf05b26cf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 20 21:27:00 2010 +0100

    rejig qi initialisation, separating clean init and recovery
    so that vq can get hold of the shutdown terms and thus the persistent
    client ref and use the latter in the ContainsCheckFun

commit 337e9603c05fa1c1e3d482df9785e70352fd4f58
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 20 21:22:25 2010 +0100

    add a fun to get hold of the client_ref from the client_msstate
    So we don't have to carry around the client_ref separately

commit ed8adc15990260df21e5bb7159414e3f94ea29cc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 20 18:47:15 2010 +0100

    Supply the plugins_expand_dir application env var to rabbit as well as the activator, and then in rabbit_mnesia:reset, ensure we do not nuke out the expand dir.

commit 1c489817fdb04aef3cf4d757329f7edd32b6d772
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 20 15:39:32 2010 +0100

    Macports: get manpages from generic unix tarball, to avoid huge transitive dependency on xmlto.

commit b8bdb74a8bdcf9bcc8549efe74debf3797514308
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 20 15:02:01 2010 +0100

    move msg_store server identity and client identity into client state.
    still need to update vq

commit b9cea020619642f7d855b0d2b4cffd96453c61f9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 20 13:11:18 2010 +0100

    only confirm when all queues have dealt with the message

commit 5fa26c28e786640f738670fd57b431fa392c2d9a
Merge: 5af3597a7 1d5542940
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 20 10:02:48 2010 +0100

    merge default into bug20284

commit 9b7c7be80103ac00db23574cb22306f8ea76ae69
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Oct 19 18:04:39 2010 +0100

    Added tag rabbitmq_v2_1_1 for changeset 64a633169b6d

commit f600f1fc29ec1c8cf7f3eec2a0790e60c542df77
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Oct 19 18:04:13 2010 +0100

    package changelogs modified in autobuild

commit 8ac1490a286cb94c2ed0283d9f73a41ab0914bc0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 19 14:09:36 2010 +0100

    mnesia:transform_table/3 appears to see table data before wait_for_tables, which solves a lot of problems. That's probably deliberate :). Move invocation of maybe_upgrade and add a couple of test upgrades to change schema as well as data.

commit 595a7c5b73fe89b5916dc3fba1d75b8ce9189a1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 19 13:24:16 2010 +0100

    Use mnesia:transform_table

commit 0258f8b84945d977d9177bc9a3b4ed4d921a0493
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 13:00:27 2010 +0100

    Apparently they can be. Arbitrarily

commit 207538cf6c52dd624dc5bd76b4a76c0f2755dded
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 12:54:56 2010 +0100

    Support the possibility of the message being removed by someone else

commit aa640ba163b6a25f1c50e4766310d043d37df937
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 12:54:06 2010 +0100

    tuples can only be one-dimensional

commit 493956974233557ccb77ae0866715c55facefe49
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 12:43:19 2010 +0100

    Overlong line

commit 77619924582b4d62872f9ef9568feabe4f4ead2d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 12:28:30 2010 +0100

    Substantial refactoring of gc_done, and drop gc_active in favour of the guarantee that files involved somehow in gc have a key in pending_gc_deletion (which is now an orddict, thus allowing us to run exactly the correct actions when gc_actions complete)

commit c6a1dcda3fe84a4ec40b09b42e818f42196773f7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 11:38:51 2010 +0100

    Refactoring

commit e02d09c19092101e3cc8fe76adc07c4363a06210
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 11:34:23 2010 +0100

    Emit message back to the msg_store again after deletion completed. Potentiall bug free again

commit 68dca61d202b2034f7835d38b84f8a650605c831
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 11:12:40 2010 +0100

    Improvement to specs

commit 6909291e429dde434504f584df1e8f38d0796951
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 19 11:10:06 2010 +0100

    combine and deletion of files are both forms of GC

commit bafaff1f1d3d62f11298beb4b783457d3a4c6761
Merge: 1d5542940 007cabdef
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Oct 19 10:53:34 2010 +0100

    merge with default

commit 007cabdef980c79ac16734e96c17cb01f0b2d02c
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Tue Oct 19 10:52:47 2010 +0100

    Removed extra call to set_ram_duration_target during ram_duration. As such, duration_target is no longer needed in vqstate

commit ea80e40aed44f43358ce50cbaf1f821767d66c4c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 18:47:02 2010 +0100

    Push deletion of empty files out to the gc process.
    Make selection of files to gc a little more robust.
    However, this is buggy in two places:
    1. We update the left and right pointers as deletion is taking place. This is fine, but it then means that in find_files_to_gc, we walk over the table, and will find the links don't work - cue badmatch and explosion. I really don't want to try and reason about concurrent deletions to the file_summary_ets_table, so I think this is going to necessitate a msg back from the gc to the msg_store indicating that the deletion is done and to tidy up any left over mess in the file summary table.
    2. In contains or read or remove, if we find the file we want to access is locked, we add_to_pending_gc_completion. But of course now the file can be locked because it's about to be deleted, rather than GC'd, and currently (though see above), there is no such msg back from the gc process to the msg_store to indicate when a file has been deleted. This could mean actions could build up in the pending queue and never be run. This then raises the question of how this pending queue should be structured. Maybe we should have a mapping from File -> [Action]. Then when either a gc or deletion confirmation comes in, we know which actions to free up.

commit 16c3c17180392a5fb548c1e645680d6fb47db3c8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 17:38:36 2010 +0100

    Further abstract gc to permit different types of actions

commit 54e3a74f2b834d14fa3bdee80596ed4a41fb5077
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 17:30:08 2010 +0100

    Permit the GC to cope with multiple concurrent pending GCs. In the case of a GC being blocked, we don't care if it's blocked on one file or many: we simply store that it's blocked on one, as we know we're going to test both before doing any real work, so this is safe.

commit aab6209b35b1d9dc25a12a5a333a83843cfcc9bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 17:01:30 2010 +0100

    Split out the testing of whether a file is not being read from

commit fec42446f2b755b9eef1c4bfa0f6df8c7699bc2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 18 16:59:20 2010 +0100

    Add enough of a mechanism to allow us to update data in Mnesia but not the schema.

commit fa88202e420ffbe685ddc113a2784ee42329dc57
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 16:51:25 2010 +0100

    Properly abstract the state that the msg_store passes to the gc.

commit 1a60d0e0186d385607ca34fe3e400cdc5ac3a3e2
Merge: ce51b66fc 1d5542940
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 18 16:10:10 2010 +0100

    merge default into bug23319

commit 1d554294023459a2b80fe8cac5ba69b90be35e0c
Merge: cc307b7fb 303a7db9d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 18 15:37:06 2010 +0100

    Merged bug 22101 into default

commit cc307b7fbb76b297daeeafdfacd6cae1fe4846c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 12:30:35 2010 +0100

    Prevent redeclaration of the default exchange: Limited Edition Passive Model

commit 4ab656fc419991af0e935553410bc3ddb29e9ce1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 12:29:30 2010 +0100

    Prevent redeclaration of the default exchange

commit 00d769801f00a60152a345a8e00c72a667b14db6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 18 12:17:19 2010 +0100

    Detect failed upgrades.

commit 5631a878cb98a957f22c9a7a8f3ed714bf1a5aab
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 12:00:47 2010 +0100

    Gratuitous refactoring

commit ebde3c8185d1ff167566e1e311be89afbb9a5b51
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 18 11:55:34 2010 +0100

    Simplify the module attribute required, log a bit more.

commit 7a026dd587a5e6e2618e5d812f6b58364b112293
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 11:51:07 2010 +0100

    Permit neither the source or destination of the binding to be the default exchange

commit 857f1d95583be1d15309a3738f63238a1706f45f
Merge: 4bd2aa127 303a7db9d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 18 11:50:30 2010 +0100

    Merging default into bug 22101

commit 303a7db9d979da1601035a79d09bad5b2ec0caac
Merge: 7dd01d19c aa438487f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 18 10:59:35 2010 +0100

    Merged bug23405

commit aa438487fa22bc673686724b09e9296dc0583a8b
Merge: 49c3ba336 91a368c12
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 17 11:42:08 2010 +0100

    merge heads

commit 91a368c129bd7414e7562e08a598895a4794c1ca
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Oct 17 10:57:21 2010 +0100

    cosmetic: put msg_store functions into a more logical order
    ...and add a missing spec

commit ae61bb5c450a998aa27a8fd3a03ecc3b94d9cd40
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 15 15:50:11 2010 +0100

    DAG for upgrade steps.

commit 0ff769aeab32f67308ffea0eb2555fb8b9a90245
Merge: 42f0fa6f5 c3b324ca6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 15 14:14:32 2010 +0100

    Merged bug 23403 into default

commit 7dd01d19c94218ba1c58dd7333edd9b70ccdfb22
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 15 11:41:22 2010 +0100

    Prevent expansion of routing key if binding destination is an exchange

commit 42f0fa6f5e4640db75e694f729f4383c88a70905
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 15 09:17:55 2010 +0100

    rename error/2 to prevent auto-import warnings on R14B

commit c3b324ca6c367805541b4b5410370afb9f5b30b2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 15 09:07:30 2010 +0100

    fire {exchange,binding}_deleted events

commit ba4c0e4ab3eddbc9422f838fe74bda34b658e954
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Oct 14 20:26:19 2010 +0100

    fixing merge conflicts

commit 1a033592ae1d8f86cdf39ea22de10677b27305bb
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Oct 14 19:22:11 2010 +0100

    rough sketch of pushing ram acks to disk. doesnt actually work...

commit 99361562792325603fb7ca1a7e5886198bf079dc
Merge: 9c889d53c b938a532c
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Oct 14 19:15:16 2010 +0100

    merging in from default

commit 756f45edf1b0626cf228a227591156a53e8a3533
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Oct 14 14:19:21 2010 +0100

    experimenting with moving acks to disk

commit 3cdef2adda051f1a7bae60dee3006b2bf417b024
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Oct 14 12:57:44 2010 +0100

    rename pending_ack_index to ram_ack_index

commit 59f78bee47e0420aa44eb3e008dddbeb7f74f019
Merge: b938a532c 9485410ee
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Thu Oct 14 11:23:49 2010 +0100

    merge with default

commit b938a532cb876ea98111a3ae165f01596eaa509c
Merge: 3eed0f099 184211476
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 14 10:23:31 2010 +0100

    merge bug21377 into default

commit 70a262439c4ca6e66ac2635f5d55075deb19e9fb
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Oct 13 18:21:30 2010 +0100

    Support for requeue=false removed. No longer storing messages along with ack records

commit 1842114766ebc444fc44cce63bae66ad97ce13ca
Merge: c6817c6d0 491522aa0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 13 16:36:33 2010 +0100

    Merge default into bug21377

commit ce51b66fca22a4a2d7bcf2cb3a6d7f40b3b21e92
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 13 15:08:04 2010 +0100

    remove scope from permissions tuple

commit 3eed0f099b5753d5a8314d01f8ec030bb884a5b2
Merge: d6b780f02 f2bc8a9f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 13 14:47:06 2010 +0100

    Merging bug 23159 into default

commit d6b780f02a700e341295dd17013d3de37c460e13
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 13 14:36:50 2010 +0100

    This was clearly never tested with > 1 queue: we must be able to cope with both delete_from =/= undefined andalso dict:size > 1; finally, do the erase first, and then we can test for size == 0, which is a little more obvious

commit 2520f4c9992529f7203bad1431d4159a630b512d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 13 14:24:18 2010 +0100

    Removal of log entry; correction of stats; assertion that QC can only get delete_all msg once

commit f2bc8a9f1da01ef620ad14d2d56b76c7e8be7e7d
Merge: c6817c6d0 3d6bf5c71
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 13 14:10:17 2010 +0100

    Merging bug23323 into default

commit 1dce22d19591f92c347dad909d005f020cb0424e
Merge: 172904e0b 49c3ba336
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 13 13:58:21 2010 +0100

    merge default into bug23319

commit 49c3ba33603bb018c04c940adb2912a010784c3e
Merge: c6817c6d0 2b2d3826c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 13 13:47:57 2010 +0100

    merge bug23273 into default

commit c729982d6a24f4dbfd8ebacc462ec41bb3c24b3a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 13 13:35:59 2010 +0100

    Don't do a dirty_read within a transaction

commit 2b2d3826cee29f69e719a5c4d225b88261165dee
Merge: c6817c6d0 c78d2b379
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 13 12:50:09 2010 +0100

    Merge default into bug 23273

commit c78d2b3795c34cb7c1cad96bf5cfc4c530f37743
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Oct 13 12:48:47 2010 +0100

    Switch to socket_into for the getstat things too.

commit 5af3597a7ed267cbac53c0d5cc6f4effe9ff35c3
Merge: c6817c6d0 b7c4c9f3a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 13 12:43:55 2010 +0100

    merge default into bug20284

commit c676f190856a704e5c19e1cbe76e69d8375e68c9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 13 10:43:40 2010 +0100

    refactor

commit c6817c6d08142f9be24cb6a8377e46628b57c392
Merge: 7cdf16d19 8c412bac1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 12 14:44:38 2010 +0100

    Merging bug 23349 to default

commit 8c412bac1e39d312989f9452141a22be67dc2dd3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 12 14:24:44 2010 +0100

    Write the version after (possibly) shuffling the db around.

commit e450c4fae82500391577b1c16e9c13fd143302b3
Merge: 7cdf16d19 e103b2a79
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Oct 12 14:16:20 2010 +0100

    Merge from default.

commit 7cdf16d19115bb61e5c7f88da2236cb1117feb22
Merge: ae90a73bb 0a930d404
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 12 14:07:31 2010 +0100

    Merging bug 22180 into default

commit 491522aa0fc84d72d00bae1c116a2e5a95c7320e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 23:42:17 2010 +0100

    boolean_or(True, X, Y) = anything_but(False, X, Y)

commit 7d441b1b74773bcb5277942f272faf0f33799221
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 23:00:54 2010 +0100

    rename

commit 81a3e53881e6af0bd196449cb9a562b38690bb3a
Merge: b3a5449cb ae90a73bb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:50:26 2010 +0100

    merge default into bug21377

commit ae90a73bbe3115c8473afbac09087527a958787f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:49:37 2010 +0100

    minor refactor

commit b3a5449cb68de896e810e4d6a49cb1e4d7539957
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:47:25 2010 +0100

    refactoring

commit bb44674d7e044b60356e97de3a316ebb098df8ca
Merge: b441939bd b629aac5a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:05:09 2010 +0100

    merge default into bug21377

commit b629aac5ae7840479f1628eaf15d90af7b2ef684
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:03:55 2010 +0100

    cosmetic

commit b441939bd6d059d6d657e140420f67ce6cbcdcf9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 22:01:00 2010 +0100

    cosmetic

commit 3972361535b6091e7ddd4e2154178c56e0e9b12a
Merge: fe9b9a05c 6574fc75e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 21:55:04 2010 +0100

    merge default into bug21377

commit fe9b9a05c79b957bf922eb2b5670629ad4accf60
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Oct 11 21:53:32 2010 +0100

    cosmetic

commit 0a930d404c5f2fb3a3a9ae476e2cbd121fd21ec7
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Oct 11 18:30:48 2010 +0100

    or should be orelse; cosmetic

commit fb1ad09099eaf67302667b6cbb3c34931ab542f6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 11 18:25:59 2010 +0100

    sets are faster than gb_sets

commit 4bd2aa1272c28b70ff8fa2e37eda09ae171f03e3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 11 18:20:24 2010 +0100

    simplified code

commit d833af71241f8e9fe0d831f6290a179f6ec8862a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 11 17:31:18 2010 +0100

    allow exchange.declare on the default exchange
    
    The only operations permitted for the default exchange are
    exchange.declare and basic.publish.  Both can be restricted via
    permissions.

commit 6574fc75e49121ffa591b668922672956637b2c8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 11 16:17:22 2010 +0100

    Make dialyzer marginally happier

commit 989688f0fb35362bf4a125bacd5ecbc0e84c7b15
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 11 16:11:50 2010 +0100

    Typeo in spec, and simplify delete_queues as order of operations here doesn't matter

commit 9485410ee9049f52f8beee521cf29b238429981e
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Mon Oct 11 15:54:48 2010 +0100

    Started recording the acks that are stored as full messages in memory

commit 383a5ceeebbc1ae97cf25991d73a77089a033e1a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 11 15:54:06 2010 +0100

    Reworked binding / exchange autodeletion with better abstracted and cleaner API

commit cb0d4edbd28354dbdcf081fb17b44d3d904c75cb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 11 14:49:40 2010 +0100

    delete_exclusive -> delete_immediately

commit e103b2a79a3310839cb532f7c83d69ff4b5625b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Oct 11 12:19:44 2010 +0100

    Rename file, store an empty list since the DAG may have multiple heads.

commit b7c33555ccd990a3f95b8cfe096449863d225c95
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 11 08:48:35 2010 +0100

    make default exchange publish-only

commit 4dcba9cdbd04df45a562b36c01949bf72e69d838
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sat Oct 9 22:38:08 2010 +0100

    delete exclusive queues in parallel
    
    Delete_exclusive is only ever used by the queue collector, which
    discards its reply, so turn it into a cast.
    
    Since exclusive queue deletion is now asynchronous, just fire off all
    the queue deletions at once and gather their DOWN messages.

commit f96c4e78a0dc469736b00ce8dd51145c7e070bcd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 8 18:56:36 2010 +0100

    Minimised the number of calls to the XTs on deletion

commit 54a6f72d9dae44af41bd2e7fe0b5d71c403af6fc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 8 16:58:53 2010 +0100

    Use filename:join/2.

commit 4908e7b25d8d9649f56a1a35c5b2d3ef2a37311b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 8 16:26:56 2010 +0100

    filename:join/1.

commit c60b167f9fde525bc8b98db8e60f41ec0d8fd686
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 8 16:17:06 2010 +0100

    Use rabbit_misc:write_term_file/2 (at a more sensible place).

commit 123aef2a83da70b8c31cef54ef423c7c60df8591
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 8 16:09:43 2010 +0100

    remove R14ism

commit ad63b5fb665beeab548b78acbffb3a0f38eb94e1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 8 15:54:44 2010 +0100

    Gratuitous refactoring

commit c319ec209cdebdfe3fef9de4964936241bd16cb6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Oct 8 15:49:38 2010 +0100

    Write a schema version out.

commit 344ff36538961f0af466b2f2d28449bc0333f3c5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 8 15:48:35 2010 +0100

    XT:publish => XT:route

commit 9a2ec18d5ca5b946d381450cdc5af5df2eb822e0
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Oct 8 14:28:49 2010 +0100

    tweaked RamIndexCount accounting again, now it doesn't get decremented twice when reinserting into the queue. Also moved transactional msgpropsfun application to tx_commit_index

commit 2477d9e1780d81529b1734f853c310725081457d
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Oct 8 12:28:05 2010 +0100

    fixed RamIndexMsgCount accounting

commit e203a269a4a8dd5189aba16c88073d6972f48127
Merge: b9a0b9c14 9c60db6b5
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Fri Oct 8 11:20:49 2010 +0100

    merge with default

commit 6b659f1f93dfe05fe4352d010928feaaa43e69b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 7 20:46:21 2010 +0100

    refactor

commit aee10b947c6778b6aa6ce58758cc061953453af3
Merge: efaafb0b3 9c60db6b5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 7 20:20:56 2010 +0100

    merge default into bug21377

commit 9c60db6b5eaf9d036d89f70c4a1b9c041e81ab30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Oct 7 20:20:31 2010 +0100

    cosmetic

commit b9a0b9c140fc910891c55c8efd741290dd38371d
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 21:42:52 2010 +0100

    fixed comment for attempt_delivery

commit 34f68912a583618bf2f84bb87631933945f00d3f
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 21:35:33 2010 +0100

    removed ttl from queue ttl info items

commit 06de7aff58781be01755a29ed7a34fa80834ff83
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 21:09:30 2010 +0100

    Reworked ensure_ttl_timer to use apply_after rather than send_after

commit 43d46890ee8a7cfd095414ae991f11b3a4abdc5d
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 20:36:28 2010 +0100

    removed unnecessary _MsgProperties variable name

commit fdc51cd87bf48dc57b23e675a1a44e993153ac52
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 20:35:42 2010 +0100

    narrowed the capture on reset_msg_expiry_fun

commit 4b651f5945b9526688bda55b2dbdaa584efe88ea
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Oct 6 20:25:51 2010 +0100

    changed usage of #message_properties{} to ?BASE_MESSAGE_PROPERTIES

commit 25a121d25ba17bff2cf1dfb76d5c96a5c9aa5d60
Merge: b14b07a2f f7b48b121
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 18:35:19 2010 +0100

    Merging default into bug 23111

commit b14b07a2fc05bfbbe50f407dc1e5325cce0cda15
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 18:34:54 2010 +0100

    cosmetics

commit f7b48b121145f2a372dc6bf4e3b7b77759bdcbb1
Merge: 028d835fd ab6519c9f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 6 18:20:11 2010 +0100

    merge bug23133 into default

commit 26d472310ccc7900f2b5a605459b5bf3c5b6f9d2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 18:07:07 2010 +0100

    Refactoring and cosmetic

commit 277f0c5237c77886489083c12fabb7992c0e2e93
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 17:50:32 2010 +0100

    cosmetic

commit 287f32becf46afd0cc5db76a36a72d19cba5e1fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 17:21:59 2010 +0100

    cosmetic

commit 874464f9b71264c2819ca64c9a8ce32bfb7ef9a5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 16:40:38 2010 +0100

    cosmetic

commit 727ee9544cf1e28246e9185a409b69dfe3f5333c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 15:57:37 2010 +0100

    Overeager M-/... I did run dialyzer but it failed to spot it.

commit 7f251284a51e72de881c64836f9fb78af18e2956
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 15:54:24 2010 +0100

    Trailing whitespace only

commit 33d59cf16e7b83eb783de0a5b64f1509c9d6e588
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 15:29:53 2010 +0100

    msg_properties -> message_properties in order to be consistent with message and basic_message (though within vq, we have plenty of msg_-prefixes so don't bother inside the msg_status record in there). Also, tidied up a lot of trailing whitespace

commit c6f48bac39166c3a35f53a6c89e6717b129abe59
Merge: ab6519c9f 95bc02968
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Oct 6 15:04:00 2010 +0100

    Merging default into bug23111

commit 028d835fd182b9289595c7e8bd94757a39ec4eba
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Oct 6 14:33:14 2010 +0100

    refactor file summary updating in write/remove
    This change makes it more obvious what is going on and also nicely
    aligns the structure of the 'write' handler and remove_message/2.

commit b7c4c9f3a19669f7c7ff281963baf7948681aa33
Merge: ab6519c9f 2f3affece
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Oct 6 10:13:22 2010 +0100

    merge default into bug20284

commit 44defd241f05505144e90f827f16cbf849664384
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 18:49:19 2010 +0100

    cosmetic

commit 367f9f0387a13da101c91355c41b79652b88d290
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 18:23:04 2010 +0100

    cosmetic

commit 2f3affece89d1cff8a40b120eacf63ce5b0f0147
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 18:11:15 2010 +0100

    cosmetic

commit 1cd4e77393e74bbcb79cace93ed9af83a93314b2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Oct 5 18:03:56 2010 +0100

    swap the arguments of ack/2

commit ab6519c9fe81d873dc5aee437628a582b9500943
Merge: 882d50450 1f7d8c97a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 5 16:29:17 2010 +0100

    Merging bug 23156 onto default

commit 1f7d8c97a0412298f8f677918b46d27482ec6996
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 5 15:35:51 2010 +0100

    Refresh expiry on stat call as used by queue redeclaration

commit efaafb0b388a3df8743d3c4022c6a3cf440462e1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Oct 5 14:26:38 2010 +0100

    Revert unnecessary reformatting

commit 882d50450f5f3a0efc6b86bc8ac6176b7ab26183
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 13:16:44 2010 +0100

    add missing export

commit 453bcf7139daa9ef2c032a3698fa9f979dc83c2c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 13:05:54 2010 +0100

    correct type spec, and cosmetics

commit cafdead33a454a5a47d8c55ecd3b9c80f44cfed6
Merge: 722602d66 7560cb147
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Oct 5 12:31:12 2010 +0100

    merging in from default

commit 9c889d53cc6b8d5849e2c15d02d362c49471609d
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Oct 5 11:41:39 2010 +0100

    cosmetics

commit 6ff61b3f9f21d62c60650ebbeaae3b35b528a457
Merge: 6c39deac7 7560cb147
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 10:09:50 2010 +0100

    merge default into bug20284

commit 7560cb1475881c5b60fc394c2098c3f8d0e8f60f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 10:07:40 2010 +0100

    cosmetic

commit 6c39deac72d788f09f27628b840169e1e106675d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Oct 5 09:36:25 2010 +0100

    cosmetics and minor refactoring

commit 7f60fde50a2ad16a7c512063c18baba2af2b9ad5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 17:17:28 2010 +0100

    refactor

commit 0d6c8c146fe5cb22d95d046b342ec70665fbb1d7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 16:57:00 2010 +0100

    improve performance
    
    Reverting an earlier change improves throughput by about 3x.

commit 4742406a766b769c74cb4bee4f7f25f91ca00365
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 16:46:01 2010 +0100

    no more warnings

commit e23caa6dce26b7eae1192a245ba38fddcb655597
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 16:22:17 2010 +0100

    refactor + add async version of maybe_run_queue_via_backing_queue/2

commit 36c7889582922e11619b5b30518de3f6d926d2dc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 16:05:48 2010 +0100

    refactor

commit c60de7636442a4b00dc3aaf0b0fb85fb5deecd77
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 15:51:56 2010 +0100

    clean up code

commit 96c73ecef38f5801a72f3fc5f3c563c1ffb36807
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 15:43:46 2010 +0100

    gb:add -> gb:insert

commit 4f7984cc8c35fbe512883ff2bc1784690607d679
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 15:33:26 2010 +0100

    refactor

commit 3d68affe52436c29b31b76f4ccbc2f36f3ab2b10
Merge: a02b82f0f 94733d8fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 4 14:50:23 2010 +0100

    Merging default into bug21377

commit 34f93f5425c1376e9e3e11f68ebbfd04cd1dcf62
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 4 14:28:19 2010 +0100

    Use delete_object, not match_delete

commit 433ce28978c03c72895ee092fee949c24b04d0af
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 13:15:48 2010 +0100

    refactor

commit 68948e96b5073ac6291c837070f942433770a07f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 12:36:13 2010 +0100

    schedule a fsync if necessary before confirming messages

commit f1d0baa7da138e0369dc7fb911c64fa006ac2958
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Oct 4 12:26:34 2010 +0100

    Introduce delete_object and use it to solve race

commit 290ac1e2bba29a156ad7bfcbd5c781f0c822b122
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 11:54:16 2010 +0100

    confirm messages when they get written do disk in *any* queue; confirm messages immediately if they've already been written to disk

commit 1ae974f61e61e558783e5fdd7383f2b8759596c2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 11:29:03 2010 +0100

    both client_terminate and client_delete clear the msg_store's on_disk callbacks

commit 785014c50fb4e5f21d0a709885b925789cc52c5d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 11:11:31 2010 +0100

    inlined register_sync_callback into new_client_state

commit 23637d6784beea67bbd64d8f07779909396f8ec6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 10:48:21 2010 +0100

    do_if_not_dup -> do_if_unconfirmed; bugfixes

commit f1bf011088aa96c6643ef7c7112a4a57861da922
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Oct 4 10:35:21 2010 +0100

    only confirm immediate messages if they haven't been delivered

commit 62a35d5c95d12bd67b050effe0c5fc33ec44dc46
Merge: 4032d0e26 94733d8fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Oct 2 11:22:42 2010 +0100

    Merging default into bug 23133

commit c7d1d1403cfddd7f9b75f32bea27fb168d672d3b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Oct 2 03:12:47 2010 +0100

    cosmetics and some minor refactoring

commit 229ba194fdb3bb8e674cb4a754587d4bfce49951
Merge: 9eff2df57 94733d8fb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 1 18:31:57 2010 +0100

    merge default into bug20284

commit 94733d8fb98b8e095fe38579cb738f005ae4ef6b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 1 18:31:32 2010 +0100

    cosmetic and minor refactoring

commit 9eff2df570edf1fbd74df17bb8b9eacb0f372e54
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Oct 1 18:17:48 2010 +0100

    cosmetics and some refactoring

commit d11dfb4a5b5358cffff7f2758a07cf503ddb8a3a
Merge: f0da80b00 d99bd2bc6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Oct 1 15:29:47 2010 +0100

    merge default into bug20284

commit d99bd2bc66150244dab4c6d88faa89665c651fbf
Merge: 5b038b35f c2805bdeb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 1 14:48:09 2010 +0100

    Merging bug 22902 into default

commit c2805bdebcfb80150b9296586e56f07deceb5c03
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Oct 1 14:45:06 2010 +0100

    It's binary up until it goes through public_key:pkix_decode_cert, at which point it becomes an #'OTPCertificate'{}

commit 1402c2e5cc0711b7beb7e94ed95ed25e9eb8e401
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Oct 1 14:08:14 2010 +0100

    broken links in man pages

commit 58b814c06882014d3d6bc63a77e93e6fe28ce2ed
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Oct 1 11:42:37 2010 +0100

    support for R14B; fix utf8 bug

commit a31f800b002405c654fe043816cd69057fb9a2ee
Merge: d93894fed 5b038b35f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Oct 1 10:01:07 2010 +0100

    merge default into bug22902

commit 5b038b35fbe3695d5020174a16b5bb901c6a294e
Merge: 4a9489780 97291f502
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 30 20:37:22 2010 +0100

    merge bug23190 into default

commit 97291f502de7336d0730e46d18dcff0825ba98f0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 30 20:12:54 2010 +0100

    cosmetic

commit fa3f2fe243b52dd38bfeb858a15563fb050e7c65
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 30 20:09:28 2010 +0100

    using mnesia:match_object when selecting all records with a given pattern

commit 4a94897800012f3268f71760b766bb58532821f0
Merge: 8953d4ee7 fd534b11a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 30 18:00:42 2010 +0100

    merge bug23322 into default (gen_server2 has a broken format_status)

commit a02b82f0fdb1acdfc74d83e8f38c78587748a962
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 17:22:47 2010 +0100

    Move lookup_qpids into router and associated changes to deliver API

commit 8fbb9ed3f1a354ecefe431e97e4f8df223bce304
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 17:09:37 2010 +0100

    Change the SeenXs to a sets rather than a list

commit 172904e0bc55e5e98c19be8bca03d394ff3dc7b8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 30 16:40:09 2010 +0100

    updated docs

commit 4c1f1bfa18f35ffa8b19e566ece92a0aebdc2782
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 30 16:35:44 2010 +0100

    remove client scope and scopes

commit 75aa0c74f3d26487a2a3692720695d5a28ae2483
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 30 16:06:20 2010 +0100

    avoid using qlc

commit 95b487858b6e63c701cf60af92c685af2bbd7c1b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 15:24:24 2010 +0100

    Exchange auto-deletion works even with e2e. Diamond property works. Correct behaviour if explicitly deleted entity is queue or exchange

commit 3d6bf5c71071085930bc4a5d1e703858c8e5156f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 30 15:23:47 2010 +0100

    refactor

commit a1f714184c743d13444d25b708c37eadfccaa0ee
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 30 15:20:58 2010 +0100

    minor

commit 8953d4ee767ca9ca75dd5057e673ec06da054524
Merge: cff9b2556 65629ae2d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 30 15:15:20 2010 +0100

    Merge bug23115 (add 'client_flow' channel info/stats item)

commit f7d3c443d23599cd252818c18fb153fa098cbca6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 30 15:12:08 2010 +0100

    Don't forget the limiter even if we have no consumers.

commit 4f45829e6108c8021769229099b2f770ec60d391
Merge: 65629ae2d 5977cb8cc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 13:44:47 2010 +0100

    Merging default into bug 21377

commit fd534b11a17ce9fd9a02886df880b9294412fbde
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 13:08:00 2010 +0100

    Update format_status to work with gen_server2 state record

commit b5d23084c49b346d27fe38e779df5ec41cf2220c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 12:29:26 2010 +0100

    Minor reworkings

commit dc62f68e841aea5f1469ce408a3f7eb2f46af8c9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 12:08:52 2010 +0100

    Fixed

commit 65629ae2df29157700b63bd2a988ae4636ecee62
Merge: c297eff1f dd0ea18ac
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 30 11:18:35 2010 +0100

    Merging bug 23315 into default

commit f0da80b00390c1031934824a651f16565f4f6a5a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 30 10:40:19 2010 +0100

    :%s/need_confirming/unconfirmed/g

commit a250fccfd9b7a17d75562b3ffd2ec2b24144cbcb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 30 09:31:11 2010 +0100

    added fine grained stats
    
    Channel now emits the number of publisher acks (confirms) sent to the
    publisher.  If this number is less than the number of publishes, it
    means that the broker isn't coping with the amount of incoming
    messages.

commit b044ddc344e53941275250407f2217dd839c71b1
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Sep 29 19:36:24 2010 +0100

    using mnesia:read rather than qlc

commit 5e15b21c8cce36b3755055eb0e2314b4547a6dac
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 16:57:48 2010 +0100

    msg_store refactoring

commit 95bc0296885572f0c0064d7b9995ce80cb4146af
Merge: c297eff1f f008755c5
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Sep 29 16:08:36 2010 +0100

    merge with default

commit c335a1a3522846ca3d415d9772aa37f10b692775
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 16:07:48 2010 +0100

    more refactoring

commit e267076ea13f1a8b64b1f8f5ec20a636a371197e
Merge: c297eff1f bb46ac03b
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Sep 29 15:42:48 2010 +0100

    merging in from default

commit 21c8e31bb846bc8ac7fa10938cd2d88d8af02412
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 15:41:54 2010 +0100

    no more redundant message passing

commit c297eff1f1dd80a0c8f0db98248264fe9f0071dc
Merge: 027c74b8f 057727b1c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 29 15:11:00 2010 +0100

    merge heads

commit 7b7be8435a870ff8a2f4fe138427b8d1bd26ae10
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 15:03:42 2010 +0100

    refactoring

commit f008755c5082e6fa22931fb399e42cd7a364fbcd
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 29 14:43:58 2010 +0100

    casing change and added ttl to the list of queue items in rabbitmqctl

commit aa41320a370fe91ec63117a709a3cf7da782c34c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 14:43:58 2010 +0100

    cosmetic

commit b3475ee81f6744d8e9badd0c0a2372bf16b373a8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 14:36:28 2010 +0100

    refactoring

commit a7c396ebe6765458e7b1d04078cb65be81f0bb9f
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 29 14:24:37 2010 +0100

    refactoring

commit 35810b9f5515c8a6e4ec88cca6825dae835de375
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 29 14:04:20 2010 +0100

    fixed bug with queue length and collect during run

commit d3eef85fe6a0f7adbaabf73d397275c712025e8a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 13:52:25 2010 +0100

    refactor

commit a01458914b039f1f0dab0df73bdad5c3b16cb03e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 13:02:28 2010 +0100

    add confirm related info keys
    
    Added the following info_keys:
      - confirm :: The type of the channel.  Is one of none, single,
                   multiple.
      - unconfirmed :: The number of unconfirmed messages.

commit 027c74b8f638df36427166b04067c113fad561e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 29 12:42:16 2010 +0100

    cosmetic

commit aabf6f4b440504532a1e68b3a727bafe2550722d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 29 12:40:48 2010 +0100

    cosmetics and minor refactors

commit dd0ea18acaad2b5d492ddca5850550477992705a
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 29 12:19:14 2010 +0100

    code doc tweak

commit d08674f42ebb85a32284089ac9e48270f35a830e
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 29 12:07:44 2010 +0100

    Don't require otp sources for build
    
    SSL connections using RC4 on Erlang versions earlier that R14B will now fail.

commit 9818757444827a9c93ccb884f8c89181795c048f
Merge: bbfa4b0d4 f18e91e08
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 11:24:35 2010 +0100

    merge bug23245 into default

commit ee6d8422aed1f4f1571005de89d8a4a43fe9ce76
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 10:48:42 2010 +0100

    refactor

commit 1ec0627fab0541144dea4960977601590895afb2
Merge: f18e91e08 961b38f95
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 29 10:32:39 2010 +0100

    pull from default

commit a008d1e14b3e71e3ba1881f2a9b6dfd032d35174
Merge: 057727b1c 65e18b361
Author: Rob Harrop <rob@rabbitmq.com>
Date:   Wed Sep 29 09:46:57 2010 +0100

    merge with default

commit 057727b1cfbc148018d742ba4fd4b15261195157
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 29 09:05:57 2010 +0100

    cosmetic

commit 48b89f2b80a16395c6976514ba45b2c3633fe6e1
Merge: f18e91e08 ff3b2320a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 28 18:11:00 2010 +0100

    merge bug22141 into default

commit bb46ac03bf9098acd25264deec76dd14f9fdee8a
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Tue Sep 28 17:33:00 2010 +0100

    using recursive split; more tests

commit 4c3b5cdd2dfc88287855b90e67a3778ed1208eed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 28 17:20:08 2010 +0100

    Add necessary additional barrier bootstep

commit 65e18b36147518d26faa0e77fa57469c1094b929
Merge: 7a98a7066 f18e91e08
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 28 16:46:21 2010 +0100

    merge with default

commit 7a98a7066a88073f9b606978b3b748dc427590d9
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 28 16:45:58 2010 +0100

    removed peek, and restructured dropwhile to not load message content from disk

commit f18e91e08b265c952b1d46b9d1b49e8216d3ab47
Merge: 74146c890 38c9a7e75
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 28 16:41:23 2010 +0100

    Merged bug23310 into default

commit 74146c8906eb649608cb44cd1f9b816cece5d4b7
Merge: e53655cd7 43ff20770
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 28 13:48:32 2010 +0100

    Merging bug 23143 into default (drive-by fixes include correcting the spec for delete_exclusive, and one cosmetic)

commit 5027755b50ca15434d9be5273bff2f89a7750451
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 28 13:31:37 2010 +0100

    added timer to collect expired messages

commit 38c9a7e75e7b439f611a9225da903638f600b6a1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 28 13:17:01 2010 +0100

    Factoring open modes better

commit f3db00b2c8f892607527866383143d86383fb417
Merge: bf2f47c8b e53655cd7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 28 13:16:36 2010 +0100

    Merging default into bug23310

commit e53655cd779190dd9160e25c322f7354cc5e3b61
Merge: 146b3f12a 92be286dd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 28 12:49:28 2010 +0100

    Merging bug 23179 into default

commit 4dcbcd311d9d17caf3b9cf69fb92d8b9fd1ac0b9
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 28 12:20:27 2010 +0100

    cosmetic

commit 43ff2077045189a7daf16cf06c048f195384aae9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 28 08:30:37 2010 +0100

    cosmetic

commit fca68a08042c3b0b70935a64c0b18d0ca6d2f113
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 28 08:24:24 2010 +0100

    delete/1 -> delete_exclusive/1; lower priorities to 8

commit cff9b25560555d6a8e23fccad3cb23a44b86ee7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 28 02:32:00 2010 +0100

    minor tweaks
    - rename rabbit_limiter:internal_is_blocked to 'blocked' - reads less
      awkward that way
    - call 'blocked' in handler of rabbit_limiter:is_blocked call - avoids
      code dup and makes the connection to the internal check more obvious
    - rename info item to 'client_flow_blocked'
    - tweak docs for info item to hopefully make it clearer how the
      condition arises and what the consequences are.

commit 5977cb8cc07184c1a0582b140d718231d596ee3c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 23:20:47 2010 +0100

    generalise binding code somewhat to mostly abstract away the source kind
    - not completely, since that would require substantial changes, but
      enough to make the code more pleasing to the eye

commit f4f7ac076d51ef9b2fd2e8cac7097d2f161706bc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 22:12:35 2010 +0100

    correct a spec
    this was in fact wrong to start with

commit b4a94be0eedcde2f757a81acc583330c8c0d9e30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 22:04:11 2010 +0100

    rename a few funs to make their purpose clearer

commit 5d49e7111b55c0faffa398b6436738b7adf48020
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 21:58:09 2010 +0100

    generalise binding:list
    in case we ever come up with other source types

commit 18701b1cf851495cd5ca4f7ffc97c6db04568d67
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 21:53:18 2010 +0100

    minor refactor

commit 778c4d14061dcf4d0ceff4f70a457c1806b708d0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 21:43:51 2010 +0100

    tweak specs

commit c5fcc9702bcba6fe192bc35dd6b7e31b594d6b68
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 27 19:44:44 2010 +0100

    using rabbit_guid; cosmetic

commit 4591acbd2944bfcbac7316919b3c8eb5f450e56a
Author: Rob Harrop <rharrop@vmware.com>
Date:   Mon Sep 27 17:04:29 2010 +0100

    added peek to ivq. some tests for peek

commit 785150ec1ea7fa60339441b9401e68c61a6f0215
Author: Rob Harrop <rharrop@vmware.com>
Date:   Mon Sep 27 16:21:38 2010 +0100

    added peek to backing queue, implemented in vq

commit 961b38f9564e8c20e1182d398191d456f2bc8352
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 15:48:01 2010 +0100

    server tests pass

commit 155f4b5a8d892c364f93b18e3d10fced77807fe6
Author: Rob Harrop <rharrop@vmware.com>
Date:   Mon Sep 27 14:46:48 2010 +0100

    minor stylistic improvement

commit f3f8c59c9983568ee9418eb8cbe2091bb056f3ed
Author: Rob Harrop <rharrop@vmware.com>
Date:   Mon Sep 27 14:40:26 2010 +0100

    slight improvement to performance when discarding many messages

commit 021b0a160979c069703a00d9da54f36510a94628
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 14:38:12 2010 +0100

    revert rabbit_tests to default

commit 12e924f7ddb11a1b1736566756d64cfd4104c790
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 14:28:32 2010 +0100

    bugfixes; passes same java tests as default
    
    The queue lease test fails with:
    
    There was 1 failure:
    1) testExpireMustBeLong(com.rabbitmq.client.test.functional.QueueLease)junit.framework.AssertionFailedError: server accepted x-expires not of type long
            at com.rabbitmq.client.test.functional.QueueLease.testExpireMustBeLong(QueueLease.java:80)
            at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
            at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
            at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    
    This also happens on default.

commit 01567eb742fc6a13dc1b5f52f0f75e33ed3da88b
Merge: 146b3f12a 4b25d5001
Author: Rob Harrop <rharrop@vmware.com>
Date:   Mon Sep 27 13:03:29 2010 +0100

    merged with default

commit 935110e2e43ca165c33d63f347db532cfdb36c5b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 11:53:57 2010 +0100

    better separation between amqqueue_process and bq

commit bf2f47c8bbb351e1d92f3a0d28162e580c682c08
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 27 11:17:21 2010 +0100

    only create read_ahead buffers for reading segment files
    The buffers are a few hundred k in size, which is a significant
    cost. And there is no point having them when writing to
    segment/journal files, and they are of limited benefit when reading
    the journal file (which, in any case, only happens on startup).

commit 140f0a5028a9366951f1ab8149aeaed0941445fb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 10:23:03 2010 +0100

    cosmetic

commit 5e9afe6f89fbd5c06fd0b48486a6c2b0775652b9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 10:14:54 2010 +0100

    no performance penalty when *not* using confirms

commit e49f833515b536a51af2a1881fc095348d620c96
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 27 08:59:06 2010 +0100

    solved a couple of bad_matches/function_clauses

commit 92be286dd86fd094af18d6f9aa9144dec2dd739d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 26 17:59:13 2010 +0100

    delay creation of a new queue's dir and qi journal
    Thus if a queue is created, never has any index entries written to
    disk, and is subsequently deleted, no file handles are needed and no
    filesystem writes are performed.

commit d9cf0e695bbb0cac7f3f09f8a2d0342c6be2d0e2
Merge: bc328a8ac 146b3f12a
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Fri Sep 24 19:04:45 2010 +0100

    merging in from default

commit 146b3f12ad4c57da3285784a5725c1227ed2708b
Merge: 97c83a53d 7715a6f10
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Sep 24 16:45:20 2010 +0100

    Merge bug23300 into default
    
    Any change to deps.mk causes all beams to be rebuilt

commit 97c83a53d79f461d510fc9e7618cd4bba741ec18
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 24 14:58:16 2010 +0100

    Cosmetic

commit 48b47cdc7990f3e32af37ebe00ca754918524da6
Merge: 42cd6a4e5 d2c3b75c8
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Sep 24 14:52:55 2010 +0100

    bug23290 merged into default

commit d2c3b75c88cb7d0cf9765d8c5bce8470218af88b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 24 14:29:34 2010 +0100

    Query memory on AIX
    
    (on the correct branch this time)

commit 1ae11f41ce4ebe9ce88ae1f2b9c8ab8dc648ca2a
Author: Jim Apperly <jim@rabbitmq.com>
Date:   Fri Sep 24 14:08:57 2010 +0100

    fixed xmlns handling in man pages

commit 4032d0e26436250ae23d9b57d109203ee0ffb81b
Merge: 45bb0b24f 42cd6a4e5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 24 11:56:13 2010 +0100

    Merging default into bug23133

commit 4b25d500157fb4a635474acbf64e03660b10a903
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 23 14:04:14 2010 +0100

    cosmetic, tab clean up

commit 8160a85527a357144234a39f49d9d7d485672430
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 23 13:02:58 2010 +0100

    invariable queue has dropwhile implementation now

commit 7715a6f108455647e5ef581dbd0daae19a642f81
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 23 11:43:29 2010 +0100

    By using an order only depend, we ensure that the deps file must exist, but it being newer than the beams will not cause beams to be rebuilt. We also ensure that if the deps is being rebuilt, we delete the old one first so that if deps generation fails, the order-only depends cannot be satisfied.

commit 42d17886308efbc8286d685efbe54d0fdea560f3
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 22 18:37:40 2010 +0100

    reworked how message filtering works with dropwhile

commit 8705e92302e760cdd160b995f2028d20b65035e2
Merge: c0796e125 42cd6a4e5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 22 17:36:03 2010 +0100

    merge default into bug20284

commit 1e99c1bd6166ec792a9963709d28cd6c46a73dba
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 22 12:51:59 2010 +0100

    fixed problem in vq:tx_commit, moved expiry recalculation to post_msg_store callback

commit 33fa8a2e3207e2ba240b79efac0dd72e6bec76a3
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 22 12:06:23 2010 +0100

    clean up of specs and dialzer results

commit de20ca33aed6823d3d13b7dbdc30ec0869584269
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 22:38:50 2010 +0100

    persistence of message props working for invariable queue

commit 1a4427984277dff425b894972291ca3921eb7114
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 18:01:41 2010 +0100

    cosmetic changes

commit f56898059fe9ecd900d4d292e656c196b85284ef
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 17:37:43 2010 +0100

    stylistic issues, reworking handling of msg_properties

commit b6356f82afd07d7c5533d6184d9a26672ab0dc9f
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 17:17:33 2010 +0100

    cosmetic changes, alignment etc

commit de44a2b9771e37956dcaf30b3860287e5adda331
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 16:55:23 2010 +0100

    fixed issue in invariable queue preventing per-queue ttl working for transient messages

commit 2827c3b12c0df3daaa281d9c6246f88b570fa803
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 15:43:16 2010 +0100

    fixed naming error

commit 4c3da8274408fd98a3b323d724d6016f98f9a270
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 15:23:03 2010 +0100

    refactoring argument checking and line width changes

commit 4bce995542380040f1b376bf13aef92a5b954a47
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 15:15:26 2010 +0100

    cosmetic changes - line width

commit 0f51b6de043eae6f2a505fd45242b7f6281c2d21
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 14:29:15 2010 +0100

    cosmetic fixes - tabs to spaces

commit 95937eccabb50d5e5cc190d1b9f577ccb9a13b51
Merge: 42cd6a4e5 453b60dc6
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 21 14:25:19 2010 +0100

    merge with default

commit 42cd6a4e553e44dd09d2d8004cf7ea3eac7da25c
Merge: 74b10f6ca e57aa00c3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 21 13:24:07 2010 +0100

    Merging bug 23193 onto default

commit e57aa00c3bcf7ac39232d5fa455c0ebf954a6b51
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 21 13:01:50 2010 +0100

    cosmetics

commit 4e60e48190e377e8ff3b0299f1f51b58b0ce4572
Merge: 653dc2640 a3d460b03
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 21 12:59:48 2010 +0100

    Merging heads

commit 653dc26405d84a387af285f46d07cded1448d2e7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 20 23:32:27 2010 +0100

    Only emit stats on shutdown if they're enabled...

commit a3d460b03c8fc8008fb09956baa79b8833faf15b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 20 11:44:57 2010 +0100

    cosmetics

commit 74b10f6cacd3e5ff46e01d171c818be6bc5afb68
Merge: 3bd4c542a ea135bd11
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Sep 20 11:15:52 2010 +0100

    Merging bug23047 into default

commit 3bd4c542a75db5de4353f29a2458d884ee5affc0
Merge: acdd9667d 98326252b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 19 22:53:04 2010 +0100

    Merging bug 22926 into default

commit acdd9667d506fdc82a662546f2e6e24848a154e1
Merge: a23aba3b2 18056d9a0
Author: David Wragg <david@rabbitmq.com>
Date:   Sun Sep 19 20:54:12 2010 +0100

    Merge bug23255 into default (unresolved dependency on inets)

commit 18056d9a087e49be516df0a1561e30a5bc088199
Author: David Wragg <david@rabbitmq.com>
Date:   Sun Sep 19 20:53:18 2010 +0100

    Rephrase comment

commit 5c8c76ca6c4a3d53ca8aa8e79bcd7bf40c622998
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 17 17:26:01 2010 +0100

    Add a comment.

commit 98326252b89a3088bb4c31ffac492b4b9875f0b3
Merge: 3e71c3c4f a23aba3b2
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Sep 17 17:22:18 2010 +0100

    Merge default into bug22926

commit a9d4538cc7103f0b4516ad6b581a1e081bee98df
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 17 16:52:51 2010 +0100

    rabbitmqctl reports channel blocked status

commit 9fa93047396f8e443e32de8f514738dc64f205c1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 17 13:43:12 2010 +0100

    Don't throw, don't use erlang:element/2.

commit 453b60dc6a45ef50209f5831f70bbd2a330ee88f
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Sep 17 13:42:41 2010 +0100

    invariable queue updated for backing queue api

commit c8c51ed380ab92e3bac4cf38cfccc8958d98cada
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Sep 17 12:57:10 2010 +0100

    added msg_properties to publish_delivered so they can be rehydrated later

commit d84707cc4e8a269d84dedf6afe1288b3d63152fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 17 12:40:26 2010 +0100

    Ignore socket errors when not running.

commit bba1d2ae687013feb985cad6efd6a85041157498
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Sep 17 12:03:12 2010 +0100

    Revert ca0dfcaaecdc

commit bbfa4b0d4f4ba100e8499b5e3510851dc53aa2cb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 17 11:54:17 2010 +0100

    RC4 comment

commit 7fbc158b768ce687571221adae4d7e08f09f8b56
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Sep 17 11:04:39 2010 +0100

    some cosmetic changes and the beginnings of invariable_queue with new api

commit ee30296b7789b4aadc5c62d2d8ad6bd9877d0d04
Merge: 6b3e3ac1e a23aba3b2
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Sep 17 09:53:47 2010 +0100

    merge with default

commit a23aba3b2b534feeaaaad3aeef7d04eb7348b5b9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 16 22:22:04 2010 +0100

    cosmetic: remove trailing whitespace

commit 722602d66f7795cdd89df5194cff4a88b9135b86
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 16 17:06:05 2010 +0100

    fixing merge conflicts

commit 1e640e8f1c58457d6a6766c45f4e59722eaee221
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 16 16:48:40 2010 +0100

    merging in from default

commit 4f1c7fdf5107df1ebe16dc239858de39bd7b900f
Merge: 7549aa286 4e517eae8
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Sep 16 16:46:19 2010 +0100

    merging in from default

commit 4475eeaffc8efa5448bc37b51876bd85c2b56fe8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Sep 16 16:18:36 2010 +0100

    Avoid starting rabbit app on plugin activation

commit 6b3e3ac1e80050d3323c92d21e7b55aeb11d26b2
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 16 12:49:46 2010 +0100

    fixed test_queue_recover. recovery is working again with per-queue ttl

commit b09ab1ad0d284a9e6741d3d9a9b102a190b87ea7
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 16 11:43:06 2010 +0100

    fixed bug in persistent_guids vq

commit 934c2fb0b45c08617fb2c19f8eefb17662b538ba
Merge: f587c9bf6 042d27783
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 16 11:20:45 2010 +0100

    merged with default

commit ea135bd11b9d5a381e176a563fca12c4054b8d45
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 16 11:11:14 2010 +0100

    remove rest of xref calls

commit 25a4f155b0e8cb56630e51d5b89e7aa5cd2455f1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 16 11:08:25 2010 +0100

    remove superfluous xref stuff

commit d4b0fe9cb34c507625ae154d94e2a09ceeaeb854
Merge: 4c49a03f2 042d27783
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 16 11:06:01 2010 +0100

    merge default into bug23047

commit ff3b2320ad304a7d125db914bcdf53c43ef05434
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 16 10:58:38 2010 +0100

    exref on script activation
    
    That is, warnings-not-errors-on-by-default.
    
    For instance, starting the server with bql installed throws the
    following warnings on startup:
    
    Activating RabbitMQ plugins ...
    *WARNING* Undefined function rfc4627:decode/1
    *WARNING* Undefined function rfc4627:encode/1
    *WARNING* Undefined function rfc4627:get_field/2

commit f587c9bf608e3a1687ab92529fb95082c7d1281a
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Sep 16 00:14:04 2010 +0100

    whitespace clean up

commit cc4a6cb25dd90d7d3a1c6e65aad3222295d4420b
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 15 21:35:57 2010 +0100

    removed stray io:format calls

commit 042d2778378568b4d4092d29f09fe473ae7ee18b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Sep 15 17:40:05 2010 +0100

    unknown_ca SSL workaround expiry reminder

commit 05848f660a00c7e928bd8ee309ac1d8cc5e41096
Merge: 881c59896 ada6ebd6b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 15 17:21:20 2010 +0100

    Merging bug 23157 into default

commit ada6ebd6b5ce84bbd4e9a033697d81eb498f8187
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 15 16:43:05 2010 +0100

    No sense in not using the full word

commit 2dfcd8bab4e0f9a37a05b373e6c673d68578598e
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 15 15:25:30 2010 +0100

    midway through fixing test_queue_recover

commit 881c598961c010e1e33f78bf0a4acc4d77aebf37
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Sep 15 14:13:04 2010 +0100

    Added tag rabbitmq_v2_1_0 for changeset d2e36559b461

commit 3f5932f718dcbe71b2be7e4b033675b350c924fa
Merge: 1097814d7 4e517eae8
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Sep 15 14:11:47 2010 +0100

    merged heads

commit 1097814d740a27c6c2f5551f06bc9938d80bb50d
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Sep 15 14:09:49 2010 +0100

    Release 2.1.0 changelog update

commit ccef72413241141ec7a20e67219cf6f1ee7c5391
Merge: 2f7fccffa 4e517eae8
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 15 10:52:44 2010 +0100

    merge with remote

commit 2f7fccffa26ba1212fd69db0366aebd7b9f63a19
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Sep 15 10:47:57 2010 +0100

    erlang tests working again

commit 48ddd5ec417aac609360fc43519d21ccd513bca3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 15 10:46:16 2010 +0100

    It's perfectly legal to convert a process to a gen_server by just calling enter_loop. In such cases, init_it is not called. Thus it must still pick up the prioritisers

commit 4e517eae89a3ecfd2b7017b714afaf1c8b5f4969
Merge: 745aaacbd 19f462bf6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 14 15:21:40 2010 +0100

    Merged bug21528 into default

commit 19f462bf66c64ac1f7e2fc2bd5dadade272aade8
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 14 15:18:19 2010 +0100

    Re-indent

commit f6bd6ae58f8cc40ed1f6ceb91ca79c79c8a01a8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 15:16:57 2010 +0100

    Stop stats timer on hibernate.

commit 402758fc0f10d64986079f95eecf9774168e4a07
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Sep 14 15:11:13 2010 +0100

    Change 'case' to 'if'

commit 796662e018b5711ee7a29fe6b8536f3b5d24e78e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 15:05:23 2010 +0100

    Doc.

commit cf3296b02e328aba7ced48edd55d50f1c652c9a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 15:04:57 2010 +0100

    Don't forget about stats timer before hibernating; it may fire after hibernating.

commit 1c180a87860bdc63b55d56f37c03ec131b804890
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 14:55:10 2010 +0100

    Make erlang-inets into a "recommends" dependency.

commit 1927084f2da4022f8344c5866da8afc191f18902
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 14 14:51:56 2010 +0100

    cosmetic

commit 11d15805af2ba40f2be56bf9d338a9da467bbbeb
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 14:39:24 2010 +0100

    Rename function.

commit a698f79ced137cd141ed8ef0b1913f0843fb02f2
Merge: ace23b698 ca0dbdf83
Author: Rob Harrop <rharrop@vmware.com>
Date:   Tue Sep 14 14:29:11 2010 +0100

    merged with default

commit 745aaacbdb058f8fd164baf2a25fe49b7dd7ce34
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 14 14:23:08 2010 +0100

    cosmetic

commit 6e8d65b60e8e29c4e61cc7b4ec72a309fac7b7a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 14 14:02:31 2010 +0100

    * Use one-shot timers
    * Ensure we always send a stats event straight after creation and before hibernation
    * Tidy the API a bit.

commit ca0dbdf83279b5a61d82b0fcd8bec6e9889539be
Merge: e73ea3af2 0ae8bfd30
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 14 09:33:24 2010 +0100

    merge bug23249 into default

commit 0ae8bfd30939a4c9ec1054f37f38d19712ba7998
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 13 18:04:07 2010 +0100

    set up monitoring in the caller
    which makes for a cleaner and more flexible API

commit 07d11569e946d880e68223f77e223f5c17be3297
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 13 18:00:07 2010 +0100

    Only emit stats in state running, so we don't emit stats before the connection event in the case of a slow connection startup.

commit 9bb9bfdbdbe3c562056a64dc8a28fd7ecdd7f6cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 13 17:39:11 2010 +0100

    Revert emiting stats on creation in the queue and channel.

commit b0293744f34c1ab2489fd3c70c012d2258fcef62
Merge: ad964c35f e73ea3af2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 13 11:05:32 2010 +0100

    Merge default into bug23193

commit ad964c35fc353ac4a8942725135cd8beaa67d511
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 13 11:05:02 2010 +0100

    Only emit stats if level != none.

commit c6346d0a7004228d8238f4221a1303853b5fd466
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 13 10:16:20 2010 +0100

    use OTP functions to decide whether a cipher suite uses RC4 or not

commit 0473e44ebb9cb0386afda155908bdd2ce41ea27d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 19:12:18 2010 +0100

    Do the simplest thing and have additional fields to indicate the type of the binding endpoints

commit 0aff23ef73ab7f2e480d63da58031298d500ddc4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 17:36:10 2010 +0100

    exchange.unbind has nowait

commit b00cdc01b3ce7cd3fad9fdeed3230de8677aab17
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 17:18:38 2010 +0100

    Avoid traversing lists multiple times

commit 86f2e118a1af555fd8838167c568433701cc9472
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 16:49:20 2010 +0100

    exchange_name => source; consistent naming of Src{Name} and Dst{Name}, except in rabbit_exchange when we clearly are talking only about exchanges; improvements to rabbit_control so that list_bindings returns the type of the endpoints as well as the endpoint names

commit dac142b8e9155972fa0b148b3e3ed1ce21d3c6df
Merge: 11cd521c6 e73ea3af2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 15:19:52 2010 +0100

    Merging default into bug 21377 and more consistent naming of Destination and DestinationName

commit e73ea3af22ffa0aa2a173418132b4912ec4e10bf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Sep 12 15:03:28 2010 +0100

    Make naming of Exchange, X, ExchangeName, XName consistent

commit 11cd521c68570ee5b62239dabed609d9c2015fcc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Sep 11 23:46:41 2010 +0100

    Implement exchange-to-exchange bindings

commit 7250adaa1d484459824e08f585173ecee016710e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 18:06:18 2010 +0100

    cosmetic

commit ee5767cd8e05e5ac61f51e5054933c8b15961b75
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 17:48:58 2010 +0100

    When I wrote 'Please rewrite drain/2 to drain/1 - it's bizarre having both the state and the queue there when the queue is in the state anyway. Likewise, in/3 => in/2 - drop the explicit queue arg', this is what I meant

commit 8f381ee252fc5d27ed77804f4ed3f10f0ddd5b7c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 17:13:16 2010 +0100

    Tabs => spaces

commit 56f8b31ebd48998cd14cb98b6eca5f5a5f63e3df
Merge: 7797c0eb7 7cd6087d8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 17:12:41 2010 +0100

    Merging default into bug 23157

commit 7797c0eb727a3094ead2620d837e7f7d286e9fe1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 16:53:46 2010 +0100

    Tabs to spaces and remove trailing whitespace - yes, this is going to make subsequent merges harder, but our version differs so much anyway, subsequent merges are going to be involved anyway

commit 7cd6087d82006e05fc9d5376817f567fee4c025c
Merge: 897bf8e7f 9340e8120
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Sep 10 16:16:23 2010 +0100

    Merge bug23248 into default (link broken on generated man pages)

commit 897bf8e7fa5cb321e048e737a405adc6c4ae3bc4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 11:43:55 2010 +0100

    Correcting maintainers field in debian control file

commit 7add764519092e91c21ff1385b37878f1e57b93b
Merge: 91035d3e0 6e942caf7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Sep 10 11:12:40 2010 +0100

    Merging bug 23212 onto default

commit 6e942caf7c74e7e44fe5be5b9c17be1c971e7433
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Sep 10 08:12:03 2010 +0100

    Check the exit status of kill, not its output

commit 45bb0b24f01f07b289d814f762c67f8870677197
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 15:21:18 2010 +0100

    when a message is written the ref_count is always 1

commit 5d600facd114fe48b308da3930e4ce0bb77067ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 9 13:54:30 2010 +0100

    init_expires/1 before emitting stats.

commit 91035d3e09d7efa2bcbe25f0ada27acebd428ed1
Merge: 64621cf75 74b2cdbcf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 13:13:59 2010 +0100

    merge bug23137 into default

commit 74b2cdbcf64254ee60c2c7f8af92495d1c890fb2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 13:13:38 2010 +0100

    tweak

commit 8a4a6f2bf3c3602d57da95e5a6a9e8fc30fa42e7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Sep 9 12:48:02 2010 +0100

    Improvements to documentation

commit fb618cf7c7b11ab498672eae9c39dac6b2719e58
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Sep 9 11:43:25 2010 +0100

    Add a dependency on erlang-inets (for mochiweb really, in case someone installs status or management).

commit 6204be98647d55e4ce678679964fea69933ab565
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 07:25:44 2010 +0100

    adjust function name for consistency

commit 8a47dfed182215dfc6433279bb38c30cbe0c356c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 07:20:40 2010 +0100

    oops

commit 31375181ad7b0a43309da655dbdbfe885d2805a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 07:19:27 2010 +0100

    minor refactor

commit faa904d064f9f65ae21dd4a5c366b08eb9ab3d71
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 07:13:01 2010 +0100

    tweak

commit 51575c57bee967400a061676b49e6aee6841c386
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 07:02:41 2010 +0100

    cosmetic tweaks and minor simplifications

commit 64621cf7577a1da3ce69e9d709b97ecf8ed60f59
Merge: 0d491f8b4 800bf156f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 06:01:54 2010 +0100

    merge bug23233 into default

commit 8f65d05faf06089625d90aeb0e005b734237d096
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 05:13:20 2010 +0100

    say a bit more own fd ownership

commit 22c272daa8cc73a1ef1eeec948319fbe8f3ae933
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 05:01:18 2010 +0100

    tweak

commit 2649ad0bc86349fd30024e88060763d86d4c5fae
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Sep 9 04:58:54 2010 +0100

    tweaks

commit d93894fed66dbba7822e55051be21e82814b0b38
Merge: 16ee1c105 0d491f8b4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 23:28:17 2010 +0100

    merge default into bug22902

commit 0d491f8b4ca627277a0b95fa919d7e7b0bc67237
Merge: de1eba983 e657a8d7d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 23:25:47 2010 +0100

    merge heads

commit de1eba983b2bb20ec6a7ce47691014df2f566e2f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 23:24:49 2010 +0100

    correct some types

commit 16ee1c1053e193183f578c7576071735c83912b5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 22:48:22 2010 +0100

    note dn display format in docs

commit 5851c533800f5514d1a93fb99865ed1afc12793d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 22:43:23 2010 +0100

    more escaping

commit 102167c5e7ed1272de603cae96bb96906ae8e1e4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 22:30:40 2010 +0100

    tweak rdn value escaping so it doen't need flattening

commit e657a8d7dd138389847bbd883501c74e2b0f932d
Merge: bc6df57d4 032ed33f0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 21:48:25 2010 +0100

    merge bug22983 into default (Extend permissions system to cover users / vhosts / permissions)

commit fa2ee5b87804a56a1f55a3e74b7a18cb6a9e397a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 21:06:44 2010 +0100

    tweak api for better decoupling of modules
    and trim error handling - we don't check for errors in any of the
    other info items either

commit adeabcee97ab51a2becd3d94118f2915851bcfa6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 20:44:20 2010 +0100

    fix type sigs

commit f5bd73d2cee785e03ceda2833b0a8b9006cacf6d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 18:53:53 2010 +0100

    handle chars > 127

commit 58247f3f6b48f98f615b85578f7c83e6ec340cfe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 18:48:03 2010 +0100

    rename info items and functions

commit 95442066889b8564e8593ea2c3c27a89ed8d7e31
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 8 18:33:56 2010 +0100

    cosmetic

commit 7dc9061e27be6cb27dcdb448db4fc43e0027c1e0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 18:25:50 2010 +0100

    Use monitor, not link, *consistently*

commit bacde2bf8a0b85166a0117c42a0d50df4f3f3c74
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 18:12:40 2010 +0100

    Use monitor, not link

commit 6647baf5521f35cdde481c09e542ba0a7f51ffad
Merge: 2969f6ad2 800bf156f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 18:07:27 2010 +0100

    Merging bug 23233 into bug 23133

commit 800bf156f535a81cb37e8b183b3d0a563fff3d0a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 17:51:04 2010 +0100

    Remove all traces of contiguous_top and do necessary refactorings. Manually verified by various stressful invocations of McM that both branches of the case in combine_files are reached and work correctly. Code is substantially simpler

commit 032ed33f066dc35ad3e0306165691c80120d41d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 8 17:18:02 2010 +0100

    Don't trample on admin status updating password, refactor.

commit 102e9dcfd59ce8dd280f21242cbe41f5912d3750
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 16:28:16 2010 +0100

    refactoring

commit 9340e812002120af4f74ade1b4183b0302d96407
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 16:13:18 2010 +0100

    fix a manpages link

commit 861ac11beff610f0450ea278b7a9c1ebdf340a43
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 16:01:05 2010 +0100

    refactor + manpages update

commit 3381cdd82d5961d86d8440dfc27a2ad0a0fb1785
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 16:00:44 2010 +0100

    Corrected documentation

commit 6d6a0d2801d0063e9c1de8732de14ca450f3541f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:47:29 2010 +0100

    better formatting

commit ebe983a9fabfb45335de6e2ea6cdd733dab3e852
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:32:39 2010 +0100

    rename functions

commit ad731358c0ea6cb4b88a8ae0a45715f5255d1a4c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:28:06 2010 +0100

    add support for rdn sets

commit 8fdebd024e976836e21c30cd5048a040c5256ef4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:22:17 2010 +0100

    refactoring

commit 1aff33ad08f3b56158bd2edd2891234226dc1b4f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:03:21 2010 +0100

    cosmetic

commit f9f1c065b593b745bf8d3d246a75297b688d850d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 15:01:14 2010 +0100

    reformat time range

commit 5a1d2f0ee23ea3e2d346ec85ca138d1e54cc17ca
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 14:58:34 2010 +0100

    refactoring
    
    Cleaned up the rabbit_ssl API a bit: the only exported functions are
    ssl_{issuer,subject,validity}, each of which takes a socket and
    returns a string.

commit 4467322fe9f52e3ff26b289c97ec75eec25e0f7e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 14:43:24 2010 +0100

    better error handling

commit c498b1bbcf08a3370a20bcb238ab4be1aeb9fdd9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 14:27:40 2010 +0100

    moved certificate decoding to rabbit_ssl

commit 27bc065a6bdaf3dba473c0ad53e4b4d66107439a
Merge: 88ff2690d bc6df57d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 14:15:49 2010 +0100

    merge default into bug22902
    
    Also, flatten the output of rabbit_ssl:format_ssl_subject/1 so that
    the info formatting in rabbit_control picks up that it's a string.

commit 7ca8693279a250360c448e9d3a68ef0d01751442
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 8 10:38:29 2010 +0100

    string:str instead of re:run

commit 2969f6ad2a7d1192901dddbfa3bb1862a0295cd9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 01:37:18 2010 +0100

    Scan the file and remove from the index as necessary on file delete rather than index_delete_by_file

commit 861a14118826c0edb58fc26521819da0841e65e7
Merge: 910debb20 bc6df57d4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 01:28:25 2010 +0100

    Merging default into bug 23133

commit 910debb20f4cc6ea4982c27495722bfeb4441a64
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Sep 8 01:02:17 2010 +0100

    Fixed the bug. The problem was that I was not removing msgs from the index for the dest in a gc if they had a refcount of 0. Thus they could later be reincremented. I was also thoughtlessly doing an index_delete_by_file on the src post gc, which should be unnecessary - 0 refcounts are now removed as they're discovered, and non-zero will be updated to be in the dest. This leaves only 1 worrying use of index_delete_by_file which is now in delete_file_if_empty. Here, scanning and deleting as we find msgs will be constant time and simple. Note this also features a very rough hacking out of the use of contiguous top in GC which turns out to be essential for this bug. However the real fix for that will be in bug 23233 which will block this bug.

commit b7b745cd907284763161e8050ca2cda60312974a
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Sep 7 20:02:29 2010 +0100

    Use a more portable command to probe for pids
    
    The ps options used were linux-specific.  "kill -0" works on BSDs and
    OS X too.

commit bc6df57d4b683ebbb73f3866c086a1fd285770bd
Merge: 56872898a 9d2f1c7a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 18:04:20 2010 +0100

    merge bug23203 into default

commit 9d2f1c7a3f40307202ea23890100e170e30b7a27
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Sep 7 15:58:38 2010 +0100

    Treat an intrinsic supervisor child the same as an intrinsic non-supervisor child when it comes to 'normal' exit reasons (which, for a supervisor, is 'shutdown', not 'normal')

commit 0e1b68e119297053c48c8e0f542727b9d86093f9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 15:04:20 2010 +0100

    accept string names for ciphers; don't clobber user-defined cipher option

commit b5fc29bcaf0236d6d9a6834275657b2a1eb0bd6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 7 14:52:25 2010 +0100

    Emit stats just after creation event.

commit 88ff2690d4afd3291ac7cab0bae1438e9e9b407b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 14:43:54 2010 +0100

    cosmetic

commit 32e9c7288a4096af57b85ac59f2e580f1a2df591
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 14:41:40 2010 +0100

    more RDNs + refactoring

commit 0c3f40222c5050da06a07de627b70ed6dd601b23
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Sep 7 13:37:16 2010 +0100

    Finish adding is_admin boolean to user.

commit 1250c50a0286a8aaf69bfb87f18ef14eaa81a720
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 13:09:17 2010 +0100

    moved ssl functions to a separate module + refactor

commit 56872898a114c270941c8c0c418102f4c6bebf4d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 11:46:25 2010 +0100

    flesh out API some more
    for management plugin

commit c17ff9ad82194895d62a97cf01b2ccff04e3fc44
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 11:31:06 2010 +0100

    flesh out API
    for the benefit of the management plugin

commit 84ee863f53ed7018abd1b2ee1d97aba583b2969a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 11:27:51 2010 +0100

    cosmetic

commit 77660c2e9d661615b9aa6d11c2211054368d21dd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 11:03:41 2010 +0100

    flesh out binding API a little further

commit 214cb7a46171c2a99ee9950a53a194e1e958f3a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 10:34:14 2010 +0100

    add list_user_vhost_permissions/2
    useful in e.g. the management plug-in

commit a3004cfa7469268c2a2fd02c3938cb047386c23c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 10:20:27 2010 +0100

    cosmetic

commit 6e913d1352a815267ae67650eda9743288a1af7b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 10:15:08 2010 +0100

    correct the type specs of permission listing functions
    these got broken when 'scope' was added

commit 1b77a5d7d38ca909c56dc9465252f144a1ae00ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 10:01:19 2010 +0100

    'scope' is *not* a permission

commit 775e216abf95dd8eb57743805b9b210228565886
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 09:14:42 2010 +0100

    cosmetic

commit fe9d1cfe5a5c76f95665dd7a5a86443f0c3c65f7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 09:12:25 2010 +0100

    format info item solely based on the value, not the key

commit 7edec1ac0319f8d8d0bb48260f5e5ee933d6ad7f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 07:27:05 2010 +0100

    fix tiny bug

commit fe5c0f0e8dbda1c279884f726fc2dbeff764d5bb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 06:22:39 2010 +0100

    refactor

commit ddb4c7d0f3571f5498bbe025ab5fe5dcdcc3279c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 06:01:24 2010 +0100

    make ssl info part of creation events

commit abf54320d2c49fb19ec5f000a5a35a6e6b2b9aed
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 05:58:19 2010 +0100

    cosmetic

commit ad963f9ed7e3094d7fdbbaa5a7d960340b481706
Merge: a297b77d0 30431e239
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 05:45:46 2010 +0100

    merge default into bug22902

commit 30431e239437805d7b7b3e3cc183902d813b178d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Sep 7 05:45:12 2010 +0100

    tiny refactor and some cosmetic changes

commit a297b77d0ff5a60e90948fec85b4d4091cd5ea46
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 04:11:55 2010 +0100

    better formatting + refactor

commit 50ac875057e3e1cb0b5e39f587f9aa0afc105fe1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Sep 7 00:05:48 2010 +0100

    unbreak ssl
    
    So, it turns out they got RC4 wrong.  This affects the Java client,
    because RC4 is its default.  It doesn't normally affect the Mono
    client because it defaults to AES.
    
    Masked the RC4 cipher suites.  When they fix, we should unmask them.

commit c268faede75e4e69981e2fb022258add04069556
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 6 18:26:02 2010 +0100

    Tube strike WIP WFH commit.

commit c0796e125724dbae63f0faff0f2ee4cd66791e52
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 6 18:09:15 2010 +0100

    message store keeps track of queues through their client refs

commit db4ac781fd8924e40f58adb5b431eeb4264ff345
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Sep 6 17:15:03 2010 +0100

    cosmetic and minor bug fix

commit fdfc3104abc31e7f7f9e45f2459e3dd0f3aaccb5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 6 16:12:38 2010 +0100

    reformatted date range
    
    Now, the output looks like this:
    
    % rabbitmqctl list_connections peer_address ssl_subject ssl_issuer ssl_validity
    Listing connections ...
    127.0.0.1       CN=dakota,O=client4     CN=MyTestCA     2010-09-01 17:34:57 to 2011-09-01 17:34:57
    ...done.

commit 50d0fe1ecc3e65b66559e32e4b5ec2b8d46286a8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 6 15:54:01 2010 +0100

    proper subject escaping as per RFC 2253

commit db8aed87875ddd5140a7d7a8f923c01a078b824b
Merge: 35dd83d82 53c0aad3d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 6 15:24:00 2010 +0100

    Merge bug23230 into default (tweak and flesh out rabbit_binding API)

commit 35dd83d82681a801201092203634a391c1515614
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Sep 6 14:54:00 2010 +0100

    We escape like C not URLs.

commit 7b3dc3419199d9a47ee68202c135ad5cf0c5c9ab
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Sep 6 12:16:35 2010 +0100

    Added ssl_validity, ssl_subject and ssl_issuer to list_connections.
    
    Both the subject and the issuer use OpenSSL's notation.
    
    % rabbitmqctl list_connections ssl_validity ssl_subject ssl_issuer
    Listing connections ...
    2010-09-01:2011-09-01   /CN=dakota/O=client4/   /CN=MyTestCA/
    ...done.
    
    If it's not an SSL connection, the 3 values are nossl.
    
    If there's no peer certificate, the 3 values are no_peer_certificate.

commit 7afabe8e5080e1b90feff8f84b017a71b0a0aaf5
Merge: 136244064 61f61703c
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Sep 6 12:04:57 2010 +0100

    Merge default heads

commit 61f61703c9c623423e9ec16555313a3c3b72a2c1
Merge: c9f3384cd 538656e8e
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Sep 6 12:02:55 2010 +0100

    Merge bug23229 (remove more dead code)

commit bc328a8acfdf0e68ff2e1f3d23dcc7f956ad98ea
Merge: e32031f60 136244064
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Sep 6 12:01:48 2010 +0100

    merging in from default

commit 1362440641774434966d14157517fc190e6597ef
Merge: c9f3384cd b4560ce8e
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Sep 6 11:41:30 2010 +0100

    merging bug23228 into default

commit c9f3384cd43789d50c178b4cc8f2bfc5628d2444
Merge: 460848846 5cbcf4225
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 5 05:26:04 2010 +0100

    merge heads

commit 460848846718c1e78cb975557ba10a50e62196a4
Merge: 63474a3f8 194597677
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 5 05:24:15 2010 +0100

    merge heads

commit 63474a3f840c722c299cebb95e0a9da8b3c72db8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Sep 5 05:22:14 2010 +0100

    simplify a bunch of rabbit_event:notify calls

commit 53c0aad3d3b24c3b2fe95dd18b3746090858951d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 07:42:20 2010 +0100

    expand test coverage

commit 9fe80ceb4ae0c8a5d8f5fe0e478ecf81dbe81150
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 07:30:33 2010 +0100

    add a couple of convenience functions
    so that callers can add/remove bindings without supplying a closure,
    which can be tricky across an rpc call.

commit 74404c0ab80c8687ab9866eeac7e913fea69173c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 06:52:35 2010 +0100

    update 'rabbitmqctl list_bindings' documentation
    The command now behaves more like the other list_* commands

commit bf969f71ac27b0fa0ca0c19835680491db233ea0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 06:31:01 2010 +0100

    tweak and extend rabbit_binding API
    - 'add', 'remove' take binding records instead of losts of args
    - 'list*' return #binding records instead of tuples
    - add 'list_for_exchange_and_queue'
    - add 'info*' functions
    
    Also fix two bugs:
    - don't invoke rabbit_event:notify inside mnesia tx
    - include complete binding info in binding_deleted event

commit 538656e8e1618f885ed4e47edcff0d68ebec5276
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 04:56:21 2010 +0100

    remove dead code

commit b4560ce8e40df9dbb7f1826cc08e2e1b905e03e9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 04:53:53 2010 +0100

    some renaming and inlining on internal API

commit 97de41965012c436ccef7ff9134785a5290936b3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Sep 4 04:29:22 2010 +0100

    further binding API tweaks

commit c0ff105b7ba12106a2234fdde009ae737e851889
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 19:17:33 2010 +0100

    first stab at extracting information from certificates

commit 5eb1d5bc26a5330e5119ff1d562ac2a246bd1105
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 18:32:53 2010 +0100

    typo

commit a2a0397e0d3c5243cf4fc210da391a4b9cedd02b
Merge: bb892b558 4fec65f1e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 18:31:58 2010 +0100

    merge default into bug22902

commit 1945976776c56cb04ca57f8ec1711002fb144975
Merge: f4f81cf91 3333a1e8a
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Sep 3 18:28:22 2010 +0100

    Merge bug23116

commit ae624b2c043fff4b8a38b0cc852c297697d2f8fa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 3 18:15:29 2010 +0100

    fix some comments and types

commit a1a5b973055dbd48c1f5a6240df59c17fa7954d3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 17:17:58 2010 +0100

    stopped a race

commit 3333a1e8aa75da8f1526df3bf930c075b38769a3
Merge: 059d914b1 f4f81cf91
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Sep 3 16:55:32 2010 +0100

    Merge default into bug23116

commit 3cc1425825f4deb2eb429b060023fd8d6221f558
Merge: 3c6169b3d f4f81cf91
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 3 15:32:42 2010 +0100

    merge default into bug23228

commit f4f81cf91e88381a7094c3f72fc8634e775b4de3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 3 15:32:16 2010 +0100

    add some missing specs

commit 3c6169b3d43a33cb5b428dc6719287823784e619
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 3 15:18:12 2010 +0100

    move binding code into its own module

commit 954ba7ce3f586acfa8f61b328ee77f0def521240
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 15:12:29 2010 +0100

    moved some confirm logic from router to channel

commit 06c5b1782b13f2346ae0dd888e4b3c57879d78a5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 14:59:16 2010 +0100

    use client_terminate instead of monitoring for DOWN

commit 4fec65f1e195e2a647f89e8eefc66104c928aa4b
Merge: 1ca72853c 374b07783
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Sep 3 12:55:51 2010 +0100

    bug23200 merged into default

commit 054f774ab39eba201c67b542285647c3e36cb2d3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 11:35:37 2010 +0100

    cosmetic

commit 1d73afd61d9dc07a1a4c764b34b14e80936c3e00
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 11:05:49 2010 +0100

    cosmetic renames

commit c1a6ec58a4da23e512a56714a4cbb0526321134a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 10:57:45 2010 +0100

    remove rabbit_basic:delivery/4 since it's not used by anything

commit 3119a0ae9d84a49bb144452d63205cdf94040925
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 10:45:27 2010 +0100

    moved confirm extension into the 0-9-1 json

commit f8316aaa103723def72be79b8042b2196cf769e5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Sep 3 10:36:22 2010 +0100

    when a consumer ack is received, the publisher ack is sent by the amqqueue_process, rather than the backing_queue

commit 1ca72853c6ebd1e8ec3453fce6015f950e0bf3d1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Sep 3 05:31:18 2010 +0100

    refactor: export a useful file_handle_cache:ulimit()
    for, e.g. the management plug-in
    Also, we always need at least two fds (e.g. for 'copy'), so set the
    lower bound to that rather than one.

commit 6a258c35498d38b3fcf434129fe6d75adb41cdb1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Sep 2 18:14:46 2010 +0100

    moved most of the confirm logic from amqqueue_process to variable_queue

commit 54fe3e635ca324bd3a754ee4bbe981081036b447
Merge: a2dcea39b a4c6249ac
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Sep 1 17:21:35 2010 +0100

    merge bug23107 into default

commit a2dcea39b65139d398f510cafd95764134ed2565
Merge: a1ab943fe 2cbabd976
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Sep 1 15:19:36 2010 +0100

    bug23185 merged into default

commit 5cbcf422572b9c9acc4b2110a0b7d9abdbd4c0da
Merge: 91f3b2a5e 544ea9793
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Sep 1 14:58:08 2010 +0100

    Merge bug23197 (missed heartbeat may not get logged)

commit 91f3b2a5e93305a7b4b0faf0785d716e72dab6f8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 1 14:40:13 2010 +0100

    cosmetic

commit a1ab943fe0b500a8aa7aa6d7680678eca54fd5da
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 1 14:39:32 2010 +0100

    simplifying refactor

commit 8cda222f13d626ce1725973e5d291837a53edbae
Merge: 70fe36235 e2dffa44d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Sep 1 14:29:00 2010 +0100

    merge bug23215 into default

commit e2dffa44d328c839cf4bda0a55ceb407fa3bbf58
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Sep 1 12:07:08 2010 +0100

    fixing premature generalisation

commit f91c4dc04a7fb6145bece70ec58dfac87e9e944c
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Sep 1 11:43:53 2010 +0100

    making gen:call label constant; separating calls handling

commit 443aedf4f1cf820baced5367af43d2629bc76aaf
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Wed Sep 1 10:46:27 2010 +0100

    fixing unreachable function clause

commit 70fe362356ba2d5141034f1222ff4a0232433ab1
Merge: bf803c56a 1d62b9cd2
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 31 17:53:04 2010 +0100

    Merged bug23181 into default

commit 177b3662213163dec7facb1a917442c5cb8275b1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 17:42:24 2010 +0100

    refactored code

commit 024d9f37395e29ced6ae469dc780868938798c27
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 17:14:05 2010 +0100

    shortened code a bit

commit b46c91e3820f4eb44078291514865be90b5cee40
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 16:44:45 2010 +0100

    in/3 -> in/2; drain/2 -> drain/1

commit 2cbabd976bda5369416a80cba1ab85fb384e38d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 13:58:24 2010 +0100

    client scope grants permission *only* for amq.gen resources
    
    So, a client still need explicit permission to use amq.default, etc.

commit 374b0778364f7819b61e01b46da5566b3671ec21
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 31 13:56:50 2010 +0100

    lists:member.

commit 3fee193e9bf3b525f834d0acabcf705cd238a813
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 31 13:47:46 2010 +0100

    Allow byte, int, short, long.

commit bf803c56a9d55b6dd8bdf151737162317fefae6b
Merge: 27ce44e7d 50f377ea9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 31 13:10:51 2010 +0100

    merge bug23184 into default

commit ecd626de0e6b37a61cab96621e33b7aaeb2cfe45
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 31 12:10:08 2010 +0100

    Change type of expires argument from (signed)long to signedint since that's the best we can do in 0-8.

commit 0d726de461fd6afc4755ce03a803181fec47e51c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 11:56:22 2010 +0100

    pending acks are sent out when the channel becomes idle or every 1s

commit 4c04aeb19191abeed94e5de11605432311ba5a43
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 31 10:35:46 2010 +0100

    fixed message leak caused by confirms
    
    I've added variable_queue:init/4.  It calls variable_queue:init/3 and
    the fourth parameter is a tuple of 3 functions: the function to call
    when the indices of some guids hit the disk, the function to call when
    some guids hit the disk and the function to call when some guids have
    been ack'd by the consumer.  Rabbit_test supplies nops rather than the
    usual casts, so the superfluous messages aren't generated.

commit 50f377ea9ac5e8f1db046dcb1a95c4e29e329b1b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 27 19:11:47 2010 +0100

    better recursive delete

commit 14c76021b6b58dbf973cb229cfa00e7ba23130d9
Merge: 2a1598e9a 27ce44e7d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 27 18:19:56 2010 +0100

    merge default into bug20284
    
    The tests fail right now because queue_index sends out more messages
    than expected.

commit c52279804ab8063feca5ddda11a8e47d4834b78d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 27 15:19:56 2010 +0100

    remove the mnesia dir check from rabbit:prepare()

commit 7ccf8c04b3253b5107ec334925473aadd8060f90
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 27 15:16:47 2010 +0100

    Call rabbit:prepare just before starting rabbit.

commit 5c69dd834fb6a1f61fc444a9993621fc14ee199d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 27 15:16:10 2010 +0100

    Rework delete_dir to return error tuple.

commit 27ce44e7d420dba66832183a314ee24d6d5e7c3c
Merge: ab9623206 1ceafa8a8
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Aug 27 15:04:50 2010 +0100

    Merge bug23109 (remove reader profiling dwead code)

commit 108641adddafc255574ef4031e4324068a7771cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 27 14:33:39 2010 +0100

    Increase robustness when the scratch dir cannot be deleted / written.

commit 544ea9793ddba34c6375a48f626f7b566810284f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 27 14:16:17 2010 +0100

    prevent normal heartbeater termination from tearing down the reader

commit 059d914b13641f93b572abf0e837b503011e7bf7
Author: David Wragg <david@rabbitmq.com>
Date:   Fri Aug 27 14:13:50 2010 +0100

    All packaging makefiles can assume that "make srcdist" is already done

commit ab9623206b797544a8da6f853d874de7bc15ac0a
Merge: 6c96fc84c f5c78c10b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 27 13:42:08 2010 +0100

    Merge bug23192 into default (errors in gen_server2 'terminate' callback mask termination reason)

commit 6c96fc84cc700d7c7ddedea96228c1245e7d77a0
Merge: a8af211dc b48837f70
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 27 12:19:58 2010 +0100

    merge bug15930 into default

commit a8af211dcae986991709661c6e6446c444a11230
Merge: a3dae7ea8 827f08602
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Aug 27 12:07:49 2010 +0100

    Merge bug23106 (remove rabbit_hooks)

commit f5c78c10bd59161f66a1ac068a4e85892222295e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 26 21:51:56 2010 +0100

    tweak

commit eee29d24f258cf22def92dcc247bde2a994b69e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 26 21:31:49 2010 +0100

    report the root cause when 'terminate' callback fails

commit e32031f603d98ab5d0df2bb1a5998ed0c934d610
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Aug 26 19:12:36 2010 +0100

    minor cosmetic

commit 4a3dd682497c0917cc19fd68df2e48dc527170f7
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Thu Aug 26 18:46:36 2010 +0100

    implementing topic routing with tries; adding better test for topic routing

commit a3dae7ea8b744e5af36187bfac5a044fad4e0f8a
Merge: d851735c9 5d203f947
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Aug 26 17:28:49 2010 +0100

    Merged bug23178 into default

commit 5c9ab05610bfa8b315973c89fe375d760ac5feef
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 26 13:36:58 2010 +0100

    move treating 'amq\.*' specially to inner case
    
    The Permission argument to check_resource_access is not
    a #permission{}.  It is an atom naming which permission we want
    (configure, read or write).
    
    To treat 'amq.*' resources differently, the check needs to be moved to
    the inner case.

commit d851735c9834cfa49f42a8be1fa7365e34329c49
Merge: 49df29b81 d985943a2
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Aug 26 11:40:37 2010 +0100

    Merge bug23141 into default
    
    rabbitmq-multi should detect a bad NODENAME

commit 4c49a03f2fde38e32a895fced9357569a11ce639
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 21:15:41 2010 +0100

    removed underspecs warnings

commit 2a1598e9adcce9aef5631cd772f16ae56d30cc1d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 21:11:28 2010 +0100

    solve a warning

commit b55a93fcc13158059a4802ab7578cb85848aece9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 18:57:55 2010 +0100

    delete_now -> delete

commit 49df29b81e486158806ae45417112926675aea35
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 17:21:52 2010 +0100

    Convert use of proplists:lookup to proplists:get_value

commit b48837f70e2f0bffabbdc092a7dd4cbdb7f6dec1
Merge: 3f3514008 f2e772f4a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 17:13:38 2010 +0100

    Merging default into bug 15930 and minor debitrot (heartbeater)

commit 35ab5479ddd4604d6a87d192a493379607c770cd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 25 17:03:31 2010 +0100

    oops

commit 827f086022c7819b40fcb823b7d2a4cbfa9954fe
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 25 16:06:17 2010 +0100

    get rid of hook mechanism
    It's only ever been used in the bug19230 branch, which is defunct.

commit 1ceafa8a8d5beca38bd1cb6b625db675344cdf1c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 25 15:46:11 2010 +0100

    remove dead code
    nobody ever uses the reader profiling, and the underlying config
    mechanism hasn't been used by anything else.

commit f2e772f4a442170cece366912fda5ce153328263
Merge: ed9e935d4 2d173d737
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 25 15:36:27 2010 +0100

    Merge bug 23131 into default (display plugin version during activation)

commit 2d173d737683a797cf3d832ff8744e77d82514c3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 25 14:55:09 2010 +0100

    display app version during plugin activation

commit 1d62b9cd252f93e137f51696946fd901f4ff7ede
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 12:54:00 2010 +0100

    Ensure that non-deletion queue-termination does a call via the msg_store to ensure all messages from the queue have made it to the msg_store's mailbox (and have actually also been acted on)

commit 5d203f947735b222fa167acf22dbabee6cd70c4a
Merge: c058646cf ed9e935d4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 11:52:24 2010 +0100

    Merging in default now that default has only one head

commit ed9e935d414b64db1abc3fbea1c357c593dd68d0
Merge: 1e105fb29 31acae72a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 11:51:24 2010 +0100

    Merge heads of default

commit 50c2ff42295033080ce329cbdcc2b3ce7006cb5a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 11:38:07 2010 +0100

    exclusive queues are deleted quickly on unclean connection termination

commit c058646cfc45844cab09e8a3a7810bb6f4fdcb45
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 25 11:32:43 2010 +0100

    Convert client_delete_and_terminate from a call to a cast

commit a577ecd3f4628eb2758ff29c91fe8680bfbea8a2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 11:32:23 2010 +0100

    exclusive queues are deleted quickly on clean connection termination

commit bfa69de0abd372b8aa3dbd9d07d3fb2ec738f6e0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 10:17:20 2010 +0100

    updated docs

commit 3023a0bdeb81a26b1e6729556f76bf5047f6e7c4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 25 10:12:04 2010 +0100

    removed all references to pcall and pcast

commit d985943a2dddbdd66488c4a8e99cd22c10325b4b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 25 05:51:02 2010 +0100

    preemptively detect common cause of failed startup
    namely when the node does actually start (if it doesn't then the
    launcher process terminates, which we detect already) but we cannot
    connect to it due to dns/network/epmd issues

commit 8bbe1dba4e4eabea205ec3b8b597c985018c5ec7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 17:46:54 2010 +0100

    typo

commit 1e1d7e1ffdbd5f5982248302b861c3ebeddaa19a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 17:19:53 2010 +0100

    refactoring

commit a4c6249acdbc7d1df11789fd2cb6dc71c1173929
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 24 16:44:51 2010 +0100

    Don't nest lists

commit b75ceac14cf66994d5b8a251bd5a04f39f7fb487
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 24 16:29:18 2010 +0100

    Supply ssl verify function conditionally

commit 1e105fb29865350e06c8f7f565a0dfd1c20fb1fe
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Tue Aug 24 16:12:08 2010 +0100

    Added tag rabbitmq_v2_0_0 for changeset 4f72e4d66f23

commit d08b31fa31f2136ef2f4d0f25eb9fcba44ba968c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 16:03:40 2010 +0100

    migrated rabbit_limiter to prioritizers

commit 0e1ab7095752ea0a50bb637603fa99b582f8f945
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 15:59:05 2010 +0100

    refactoring

commit e5cd88e947b08762b92441553cc167d9728d3ea0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 15:52:01 2010 +0100

    migrated amqqueue to prioritisers

commit 0b6a3f64f6634f725fa7dccbb03a88f2fdcdc142
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 15:27:05 2010 +0100

    migrated msg_store to prioritisers

commit 1e2fb3fc36cc7655bef5e526a56c3037d9fbe12f
Merge: 8e11419f2 31acae72a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 15:01:48 2010 +0100

    merge default into bug23157

commit 8e11419f2ad72db6e6e65cdfb21a08633747df7b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 15:01:26 2010 +0100

    rabbit_channel migrated to prioritisers

commit 7585c95b3afb1dcb10f1641d415a93e99886294d
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Aug 24 14:56:27 2010 +0100

    Take peer verification config into account in verify function
    
    This works around a limitation in the ssl module, which does not honour verify_none

commit 90e38ca2e8abb777c2c8aff82ad26338380af366
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Tue Aug 24 14:48:48 2010 +0100

    Changelog updates

commit c963fbf3f728f0f8235ed2a91ced67409dc82cf7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 14:43:14 2010 +0100

    added error handling wrappers for prioritisers

commit 98d05ad4189a941da2aef1028d0d8d9b457a1a1f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 24 14:24:01 2010 +0100

    prioritize -> prioritise

commit 74c283c36726b52b17e44a9400c80ab31ab46abf
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 23 16:47:38 2010 +0100

    Accept multiple SSL verification errors

commit 31acae72aa8ecca63fecb8cf1ac28c8f516b33cc
Merge: e70b6cb33 ae57f1c47
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 23 15:24:30 2010 +0100

    merge bug23167 into default (Large msg_store mailbox can block queue.declare)

commit 63d4e1774c79f6d55fd295823661cff5bdff062a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 23 15:10:02 2010 +0100

    unprioritized calls, casts and infos are passed through the prioritize functions
    
    PCalls and PCasts have the priorities assigned to them by the pcall, pcast call.
    
    Everything else gets its priority set by prioritize_call/3,
    prioritize_cast/2 or prioritize_info/2.

commit 275559bdb7a77e7a0b78715b64d3551ccaa9fa84
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 23 15:06:26 2010 +0100

    gen_server2: functions now use a record instead of 9 arguments

commit ebdd7f2e3829bb81607fd03b22652e712a260ace
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Aug 23 14:35:05 2010 +0100

    Don't ignore SSL certificate verification errors

commit e70b6cb335aab34fb5a14eb9f794a2491e5edfc8
Merge: f395ed28d 14f93cb22
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Aug 23 12:23:49 2010 +0100

    Merge bug23155

commit ae57f1c47bc6c262e56ffe01fb5dfb985e852fc1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 22:16:38 2010 +0100

    Add priorities to two calls to ensure queue declaration remains quick even with a large msg_store workload

commit 14f93cb22fb30793a28529a345cb29c85a61a27f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 21:58:05 2010 +0100

    make 'xmlto' invocation work with stricter getopt implementations

commit f395ed28d9dbd1793a02112cf80d78a661f153e3
Merge: 2b970156b 5161fd31c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 20:56:10 2010 +0100

    merge bug23153 into default

commit 5161fd31c01cde2e17fc4cd72a239e0f747391d3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 20:21:01 2010 +0100

    Avoid crash

commit 943ff78e662e89ed6347ba2372a0057b1e0f6b57
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 19:53:11 2010 +0100

    ensure and assert that closed handles have last_used_at=undefined
    That way it is more obvious which handles should be in the age tree
    and which shouldn't.

commit bf24a9107181ddd475b3a094fbef315d3fd5f83a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 19:51:27 2010 +0100

    cosmetic

commit 2653158aff3fcbd22ba40e8c5d6ada37791aa41e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 19:38:40 2010 +0100

    make it more obvious that reopen is a with_age_tree in disguise
    plus some minor cosmetic shuffling

commit a736bfa79c3540beffc069ed7a133461c9a332d9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 19:30:46 2010 +0100

    don't traverse age tree unnnecessarily on error in reopen
    this also makes it clearer what's going on

commit 6f4a04e217a8b478144322e091b913ef2005b110
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 19:06:16 2010 +0100

    cosmetic

commit 9404ec8880057780b8c33669953d28a2ba667b97
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 19:01:54 2010 +0100

    refactor: move open1 into reopen

commit 61a733bfa51031d4722a3afa6965f05ec0a06a91
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 18:19:14 2010 +0100

    If we've obtained permission to open some fds and that turns out not to work out, then we should ensure that we inform the server as soon as we stop that the rest remain closed

commit 619389cc281976bcb0c03a4a6de0ffc29e394df8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 17:16:03 2010 +0100

    record for pending items

commit 26370d6710be056e3c082582f2676a68a7090da9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 17:07:14 2010 +0100

    Modify test so that the -1 => -2 change to OBTAIN_LIMIT does not result in the test having sufficient fds available such that the copy could be satisfied without closing

commit 2c9b872861a2e40eaa5cbf46be8754bfee70d4f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 16:56:54 2010 +0100

    Use foldr instead of foldl to avoid having to do extra reverses

commit 8d0186ff787188dfe525baa8cfff1d300428b4a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 16:33:33 2010 +0100

    always return refs/handles in correct order
    to improve clarity at the expense of a few list:reverses.

commit 6dfd138b5e13195c4a2ae17e9334d0f50ab9cdaa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 15:26:55 2010 +0100

    cosmetic

commit 73876c81681c8ab53aab4e83505d0f77204f2d06
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 15:26:36 2010 +0100

    always leave at least two fds unobtainable
    so that 'copy' can succeed
    Also, zero-clamp obtain limit

commit 2b970156bdc70f6748af23794e176b23d9111be7
Merge: eb1f6b9d0 7dee4057d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 14:33:21 2010 +0100

    Merging heads of default

commit eb1f6b9d0fed1c3c644964881171b954b96f2822
Merge: 08877429d 9aa4b7ba2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 14:30:01 2010 +0100

    Merging bug 23166 into default

commit 3ddfee6917900e963c7cc0287d37845e89426846
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 13:50:13 2010 +0100

    refactor: make new_closed_handle create the Ref and return it

commit 672f77cfe3105ce2cb2d82091bc135bbf1ed7496
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 13:43:42 2010 +0100

    add test
    this fails on default (or, rather, bug23166, until that is merged)

commit ca1790984aed95c1249f1875756c41018ce126bc
Merge: 761dab46a 9aa4b7ba2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 13:37:38 2010 +0100

    merge bug23166 into bug23153

commit 9aa4b7ba26f950ca270c068189910393f08e08f9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 22 12:44:18 2010 +0100

    add support for dynamic setting/getting of fhc limit
    and use that in tests

commit 761dab46a4ca1aa7a800db95e7c5d2b6b53ad92d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 22 04:06:18 2010 +0100

    Rejigged client side so that it asks for the correct number of fds upfront.

commit 42d09c6bb55d9c679e71551fab72f72f7ee7aa7d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Aug 21 20:01:04 2010 +0100

    Modify server logic to deal with requests for multiple fds. Including nice pending_queues abstraction. Client logic remains to be done.

commit dd8e7c66f8d8f3ac5a26e19f0ea5db110a2e0e81
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 18:53:39 2010 +0100

    Add infrastructure to server to be able to handle requests for multiple fds

commit 08877429d17fe6720459d221cb29d76dfd009a71
Merge: e4dc1a481 bfe32163e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 18:47:22 2010 +0100

    merge bug23152 into default

commit e4dc1a481a7fd7ae6100664cda784fd4efc92769
Merge: af53c9754 d9659bf90
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 16:58:16 2010 +0100

    merge bug23139 into default

commit d9659bf90af271f9ce857c8ae5c1a82c08e52dfc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 16:17:23 2010 +0100

    oops

commit 7447d62cf43fd76548238c327ac69c7deadf7552
Merge: 2cdb16fae cddda05d4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 16:12:21 2010 +0100

    merge heads

commit cddda05d40947735d5dbd4566b5ee323cd3b38b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 16:09:09 2010 +0100

    simplification due to the fact that we always request closing of all

commit d6222e5f8b3d1d7bc011655a8894eee2a0007429
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 16:08:26 2010 +0100

    cosmetic

commit 2cdb16fae7781de9a926e165255983197ccb4542
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 15:48:44 2010 +0100

    ensure_mref => track_client andalso cosmetic

commit 40c45e71c9f8b5516556e09f097edd71dc8b0e36
Merge: 3bb34ee5c 8fff4eeb6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 15:25:47 2010 +0100

    Merging heads

commit 3bb34ee5cd496c2be00ba59e453d420e9930527c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 15:24:34 2010 +0100

    Convert fhc to use an ets table with record per client which amalgamates several of the previous state entries

commit 8fff4eeb60cdd05eea17ce3f58138896593bd041
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 15:05:54 2010 +0100

    cosmetic and some minor refactoring

commit efd038f6621af2333e45f3d55bb65206f78363f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 20 14:57:38 2010 +0100

    fix bug that crept in

commit ace23b69809ca425d17af8e43b7853fefc38324e
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Aug 20 14:16:05 2010 +0100

    support for expiration during consume now

commit 940862cc555b20c43607bbe3d6c66aba2088a24d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 14:14:34 2010 +0100

    Given the clients are demanded to close all open fds when asked to, them sending a boolean is irrelvant now

commit 26240d2783ac7ee636c6c4c8531b562fb29762cb
Merge: 0ac9b46b9 af53c9754
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Aug 20 13:29:42 2010 +0100

    merge bug23111 with default

commit 0ac9b46b9787ee59c95bb2930102bf7f86565a6d
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Aug 20 13:25:31 2010 +0100

    reworked contract between qi and vq. tidied up in general

commit 5ce5ff529c762dd0d48e378ca10138dec1086aa8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 20 13:02:21 2010 +0100

    If we sent an age of 0 to clients, make sure we do not send more ages of 0 to the same clients until they've actually closed all their handles. This ensures that as more requests come in once we're low on fds, we don't send hundreds of 0 ages to the same clients erroneously. It also means that we always target the correct number of *unique* clients to ask to close their fds, which avoids thrashing the same clients and improves performance markedly.
    
    Also, if on open, we send "close" back to the client, that client *is* blocked (actually, due to have 0 opens) as we know it'll close, send us some closed msgs and then re do the open call. Thus we shouldn't be sending it any set maximum age messages.

commit ec42c2a48cdce9b49920bfc751feda835cdf8bee
Author: Rob Harrop <rharrop@vmware.com>
Date:   Fri Aug 20 11:28:57 2010 +0100

    in flight, want to test against default

commit ec420ff47884505b680ab167be4e206f7a281240
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 20 10:12:19 2010 +0100

    stopped a race

commit bfe32163ee7057d1c02bf34788d5a37da22624d3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 18:47:51 2010 +0100

    Grab the msg from the cur ets file cache, thus avoiding having to send the same message many times

commit 74ff62f25d897d65fa092726af066075bf59fb22
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 19 18:45:15 2010 +0100

    refactor

commit 62e114a90a73265b58e077e388814467ea19bf9d
Merge: fe492aeb8 af53c9754
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 18:13:37 2010 +0100

    Merging default into bug 23133

commit 0877754d1515bf361a0fbab7cdf693fc998dd396
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 19 17:20:09 2010 +0100

    fixed an ever-expanding dictionary
    
    The problem with the current design is that the lowest layer that knows
    about confirmations is amqqueue_process.  This means that
    amqqueue_process, variable_queue, msg_store and queue_index need to do
    all the bookkeeping associated with confirmations even if they're not
    enabled.  Mind you, this doesn't slow things down noticeably.

commit 4c1f25039d6ee221d38e041d7537564894effb1e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 19 17:08:22 2010 +0100

    cosmetic

commit f21798f95b7f38f1839de853eb63ab1c7e58ef8f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 16:54:12 2010 +0100

    Some essential assertions

commit 2f284b28a83fc6b594c827243aceb98b528e5f56
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 16:43:55 2010 +0100

    More meaningful variable name

commit cb4134643cb1f62af3b10b51af513acc42284339
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 16:36:09 2010 +0100

    Whoops

commit 47bc3470cd9b3baf248d80c891dd8f4fad898ece
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 16:27:08 2010 +0100

    Reworked substantially

commit 8fbfd5c7eaf2c272d4d7647a8e7b74e1130d188e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 19 15:35:39 2010 +0100

    refactoring + don't do useless work

commit a6e46ef9b493d0eaff15de8e3d63c8bdfe046310
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 19 14:04:23 2010 +0100

    don't do any unnecessary work when publishing in confirm mode

commit af53c97545672c9417cc17ee555eed0350adc6e2
Merge: 1ae16773a 292869456
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 19 13:54:58 2010 +0100

    merge bug23150 into default

commit 7dee4057dec8f997da55aa51572e86d1420f7a11
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 13:44:34 2010 +0100

    Remove modifications that I accidentally introduced for testing and forgot to remove prior to ci'ing the merge

commit cce43fdb1c049a9a2f804607fe3a8fbd67090706
Merge: c846a8b41 1ae16773a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 13:40:34 2010 +0100

    Merging default into bug 23139 (substantial debitrot)

commit 2928694569f07c9a93325b3078c27cb9a018ea5f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 13:16:39 2010 +0100

    Use string tokens, not re:split

commit 1ae16773ac66b5e81ca95ca2080285e7639ff984
Merge: 5dc194ebe 9c68dd79b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 19 13:07:44 2010 +0100

    Merging bug 23138 into default

commit 9c68dd79bbc747d59ec26d105b23d55a4b7d4d9c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 19 12:28:48 2010 +0100

    once again allow use of fhc w/o registering

commit db5012819afb3287ddfdd0004f95b3e2db79edbc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 19 12:20:18 2010 +0100

    refactor

commit f2a73308e711246d6ea2c50caad7d846be0e022c
Merge: 5dc194ebe 4f47fdefb
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Aug 19 11:23:08 2010 +0100

    merge default into bug23111

commit 4f47fdefbc9b0189522a7e6b96b8a5a84eaf5ae9
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Aug 19 11:21:00 2010 +0100

    Expiry is reset on tx commit now. TX publish messages have correct TTL semantics

commit bcf0fe5ce23eba75acfed72719f65d753639e627
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 19 11:05:02 2010 +0100

    rewrite

commit 6fe629ed384c1a38dac542ca16776fbbf7be2821
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 19 10:58:27 2010 +0100

    added xref check for undefined, unused and deprecated functions

commit 9994b41afc949a19ada7afc2b3550ba04ad58a64
Author: Rob Harrop <rharrop@vmware.com>
Date:   Thu Aug 19 10:51:54 2010 +0100

    per-queue ttl working for non-transactionl messages without persistence

commit 38ef0ab2f42eb1bd0254dadbe29533d4aa8ad99e
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Aug 18 23:10:13 2010 +0100

    reworked backing_queue and variable_queue to store msg_properties. used msg properties for storing and manipulating message expiry

commit 5dc194ebe90103c0374332ce49b0b212dab0d75a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 17:40:19 2010 +0100

    Don't ever keep the recovery process waiting, regardless of whether the queue is going down or not
    (transplanted from 4c99ba7eedd4b28a096d0412bbbdacb1fa91daa3)

commit 1a58ae7a4a572cac2a8ac7b1083b8117df033c2e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 17:29:35 2010 +0100

    A rather crucial infinity missing
    (transplanted from aaf79aa3cacefee1742eb7f257c6a16ec5720d59)

commit 1cd553e672b72b0fdf641b73f6bc95a30efac6ec
Merge: 29a476232 640a4efe6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 18 23:34:01 2010 +0100

    re-merge rebased bug23145 into new head of default

commit bc72dcabf49e3ecd43bb36a6d9641decfc630672
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 18 16:43:33 2010 +0100

    fixed a small empty-set bug

commit fe492aeb80b43306daf40fe02eb1cd1e7e9aa7f1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 16:31:35 2010 +0100

    Abstract refcount == 0 to imply not_found for appropriate call sites

commit 67e0b769ed8d17543e95e93d60e68d06e09d2c12
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 16:24:22 2010 +0100

    By this stage of the client-read, we know a GC can't start and can't be in progress. Thus even if the refcount is 0, we're still safe to read it. What's more, this area of code has never made provision for the index_lookup to return a not_found - it will crash if that happens. Thus if the implicit assumption is that the message must exist, then by the same token, we know the refcount will always be > 0

commit 32888320517cf26ddeb2734885528d28962c0e02
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 16:15:58 2010 +0100

    Abstraction of the inner write function

commit 4dbd1cab224540fa75b94380d2e9a37d34865e86
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 15:54:29 2010 +0100

    cosmetic

commit 6dd43455c0b1b5a487a7f039e964df0491112dac
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 15:50:42 2010 +0100

    Because we can increment the refcount back above 0, the calculation of the contiguous top needs to be contiguousTop + totalSize, because the validtotalsize can contain data that's well beyond the old contiguous top

commit 638b2b41aca863203266b5db559199b75abd7a58
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 18 15:03:56 2010 +0100

    deleting a queue causes all of its messages to be puback'd

commit 640a4efe6901b82f074704cad5f08fd7f332f20a
Author: David Wragg <david@rabbitmq.com>
Date:   Wed Aug 18 14:52:40 2010 +0100

    Eliminate RABBITMQ_PLUGINS_EXPAND_DIR
    
    There were a number of issues with RABBITMQ_PLUGINS_EXPAND_DIR:
    
    - It was undocumented in the context of the generic unix package, and
      if unwisely set could do an effective "rm -rf" in an unintended
      location.
    
    - It did not take account of the possibility that multiple nodes could
      be starting at once, and so doing plugins activation
      simultanteously.
    
    Instead, use RABBITMQ_MNESIA_DIR/plugins-scratch.  This avoids the
    need to extend the generic unix package documentation, the location is
    node-specific, and the distinctive plugins-scratch subdirectory
    reduces the risk of unintended file deletions.
    (transplanted from 064b8797493bb290156fb72a54f9e9276df0faed)

commit dcc3c443caf32700ab7cafa340d7c860cd1525b8
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Aug 18 14:49:48 2010 +0100

    added msg_properties record for rabbit.hrl

commit 200359bf5a66a9129c0d78513e0b22b06f0d2273
Author: Rob Harrop <rharrop@vmware.com>
Date:   Wed Aug 18 14:46:38 2010 +0100

    added validation for x-message-ttl arg on queue declare

commit e2a4881bd65bcee19b1f3ccde7c9332a0a5cbc9c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 18 14:43:20 2010 +0100

    Backed out changeset c47670da4830 - I decided the dedup cache shouldn't be mangled with.

commit 2ea36f3e22f9d7d42415713a980094a7b693fb6a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 18 12:12:49 2010 +0100

    confirm transient messages only after basic.return

commit 7151d480b80314578663e0c3e731130c1c541042
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 18 10:24:25 2010 +0100

    told dialyzer to check for more things
    
    As Matthew suggested, I've added {wranings, [underspecs, behaiviours,
    race_conditions]} to dialyzer's options.  As a result, we now have 56
    warnings instead of just the 4.  Most of them are underspecs (i.e. we
    say a function returns any() but dialyzer's figured out that's overly
    general).

commit 29a4762324299261b0764aa1e83f6401419fa50d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 18 06:27:12 2010 +0100

    small simplifying refactor

commit 847144a104561c58106125959cf7546c72e6e686
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 18 04:24:34 2010 +0100

    take current memory alarms status into account straight away
    This does in fact not alter the behaviour at all due to the following:
    
    - if the alarm is active the alarm registration will call the handler
    straight way, which will send a {conserve_memory, true} message to the
    reader.
    - the reply to the alarm registration is sent after that, and from the
    same process - the alarm process - so by the time the reader loops
    around the mainloop again the {conserve_memory, true} message is
    guaranteed to be in the mailbox
    - on looping around, the reader request a frame_header from the
    socket. The reader has already sent connection.open_ok to the client,
    and the client may have started sending commands straight away. But
    all the reader is going to see of that to start with is an {inet_async,
    ...} message for a frame_header. That is guaranteed to end up in the
    mailbox after the {conserve_memory, true} message.
    
    Thus the reader is guaranteed to process the {conserve_memory, true}
    message before handling any more data from the socket.
    
    With this change it is rather more obvious that the memory alarm
    status gets taken into account before any more client data is
    processed.

commit f3114630d7c5eac34e80da0fc03469698eeab3bd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 18:55:44 2010 +0100

    treat the dedup cache the same way as the index - permit 0 ref_counts and prune on file roll

commit 3f3514008f98a2e1298695ca646334c1c98b2baa
Merge: d58dcb780 3fe7c78a7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 18:37:35 2010 +0100

    Merging default into bug 15930

commit 0bda163a7f6eec6f767ce9212be8889b4e61212e
Merge: c5c7e483e 3fe7c78a7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 18:37:22 2010 +0100

    Merging default into bug 23133

commit c846a8b41475513634acd23a3a2ed9b86869de73
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 18:08:47 2010 +0100

    The solution is very simple: In the case where the fhc sends out requests to close file handles, the clients might respond very quickly. The fhc will then gather these responses (say, just updates, not closes) and then will sit there for 2 seconds until the timer goes off. Thus the solution is just to subtract the timer period from the calculated average: i.e. the expression is to say 'close file handles that haven't been used for N seconds from NOW' rather than the previous 'close file handles that haven't been used for N seconds from NOW - 2 seconds ago'. This works very nicely and whilst the fhc can get quite busy when there are more users of file handles than there are file handles available, that is hardly surprising, and the fact is starvation is prevented and processes are promptly serviced

commit 5d15f25d1f14715003b629ed478d6ffa00eeb196
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 17:42:23 2010 +0100

    Track blocked pids explicitly

commit c93e36365f10a6550db91a25f71bb2c0eb2d10f4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 17:33:13 2010 +0100

    refactoring

commit 305f866c4a70bb3ecab4be8c69847874667a5dec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 17:24:27 2010 +0100

    Correct monitoring and actions upon DOWN messages. Note this is especially subtle for obtains, which effectively implicitly allocates temporarily to the blocked caller (FromPid) whilst monitoring it, and then transfers this to the ForPid when possible. Note the ForPid can die before the obtains is processed, which which point the FromPid must be replied to immediately.

commit 54c4957e9d44abe29982bb2d8313b4bc7ce56f6b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 17:05:44 2010 +0100

    publisher acks for persistent messages
    
    Acknowledgements are sent to the producer in the following cases
    (assuming the channel in confirm mode):
      - a transient message has been received (i.e. it is ack'd
        immediately),
      - a basic return has been sent (the ack is sent immediately
        afterwards),
      - a persistent message has been consumed [by a consumer] or got [via
        basic.get] and ack'd by the client (or the retrieval was no-ack),
      - a persistent message has been written to disk (both the message
        and its index).
    
    At least in theory, every message published on a confirm channel will
    at some point be ack'd.  A message is only ack'd once and the reason
    it was ack'd is hidden.

commit 4d85abee069bcfab253a7a9040ddcb08c6aa05b1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 15:51:14 2010 +0100

    queue_index keeps track of which messages have been published but not written to disk
    
    There are 2 ways queue_index writes something to disk:
      - the journal is synced, and
      - the journal is flushed (i.e. scattered across many files and those
        files closed).
    
    Since queue_index is the same process as variable_queue, we just keep
    a list of guids that have been published and we just call an on_sync
    handler whenever these are written to disk.

commit 3fe7c78a7ac920b5febb9e6073713cc11c581618
Merge: 0c5cbb3d9 57b55e89d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 17 15:01:41 2010 +0100

    merge bug23135 into default

commit 57b55e89da224bca59a09e8547f8117bf7f78cc4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 14:05:52 2010 +0100

    obtain_and_release_on_death => obtain, and minor refactor of tcp acceptor

commit d23dce994d9aa5547d755a9e0fb37c2da31985d5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 13:54:03 2010 +0100

    Combine obtains and release_on_death

commit 0c5cbb3d9a0b723b34503812b267e9f95a7a83bd
Merge: 4cc75780a 9f77d136b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 17 12:54:57 2010 +0100

    merge bug23132 into default

commit 2e57b7e5812fe6932263354a07410cd8956f28e4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 12:53:18 2010 +0100

    persistent messages are ack'd only after the consumer acks it

commit 9f77d136b45992c812311962d762f1c10e87d01d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 17 12:20:22 2010 +0100

    Minor corrections

commit caefab720fc4bffae44f057438ea91debda63393
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 10:45:33 2010 +0100

    move msg_seq_no from #basic_message{} to #delivery{}

commit ad27f6e8847fb7c01a9c68dd7d6faf220e378c3d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 17 09:44:49 2010 +0100

    first stab at keeping track of when messages are synced to disk

commit 4736f0d828163a1053beddab90bc73ca68832e60
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:44:24 2010 +0100

    cosmetic

commit 6585b7edfbffa3c18cdd88b91d39a49275be7d9e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:21:23 2010 +0100

    tweak

commit 727b1d901b481523c160a1d4ea3ef03907246cc1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:18:44 2010 +0100

    tweak

commit fd550bf17aae319ea21ef372982707a7fbbe6651
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:16:04 2010 +0100

    tweak

commit c68dac371ded8c9b62ac5c474e9e8d89028a9fce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:13:09 2010 +0100

    obtain_limit can be 'infinity'

commit 85cae727dfe590101eb2dea6aabbfaa4af178882
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:11:54 2010 +0100

    cosmetic

commit 34cc58dd4791acc1a81cc8b0c94877080a1c0806
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 21:08:51 2010 +0100

    refactor: incorporate limit checking into maybe_reduce

commit 3747ce4c00b35b9b9e0a1b7444d3d3a8924b8fa3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 20:00:02 2010 +0100

    cosmetic

commit b806b972fa8dd1bcb6710c6696dab288a150c52a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 16:52:30 2010 +0100

    opens => open. obtains => obtain

commit 27ce7ca5e6bf56b846b163353aad4fe45c628131
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 16:49:00 2010 +0100

    Finally, it works. Important points: 1) remove elders from blocked clients so that we calculate average based on pids that can actually respond. 2) reduce whenever we have pending_opens to ensure we rotate the strike.

commit 072b272cccbad11beb396c8036da625e7d4f83e4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 16:14:53 2010 +0100

    Whoops. Be consistent about comparisons

commit 77aa7d71f05116a64ea3777c45c3d5a8a624cf38
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 16:08:17 2010 +0100

    Sockets have priority up to 90%. Processes have the full 100% but at lower priority.

commit 8f91ec7634774267dc828c640c11f28281c60ac3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 14:04:59 2010 +0100

    Make sure tests have enough file descriptors

commit 26d3ff6028fcf575f447f0d090232b2bdad778e4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 13:41:42 2010 +0100

    Whoops

commit b3db3ef5c89aeb8eb2354cf11a7e1b1bf89619b1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 13:40:39 2010 +0100

    Split obtains in two : one for open requests (higher priority) and one for obtains requests (lower priority, and a lower limit)

commit 90a1444d225ca724a71281a4e527fdf4ec760ee0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 12:13:56 2010 +0100

    Allow the fhc server to request the client closes file handles before granting an open - thus prevents deadlocks

commit 7f0bc2cddfcd046fecde2f93a5f1ddd4ab348ae3
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 16 11:31:48 2010 +0100

    refactoring

commit d6d91d50c73413a63facf894f196a554b633c3d1
Merge: aa6bcf393 4cc75780a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 11:28:29 2010 +0100

    Merging default into bug 23132

commit 4cc75780a29ec7383caa4c5a9256e629f18b85b6
Merge: 7890666d6 83b5e44c4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 07:14:32 2010 +0100

    bug23129

commit 83b5e44c45a175e09fcd72d0f3af925e0e692ccd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 05:31:35 2010 +0100

    minor refactor

commit a378168c333bd2b1dc71e8f706682b1e53b18697
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 16 05:31:10 2010 +0100

    cosmetic

commit c5c7e483e1d12222ba84fc7d7d805de6257cbb6d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 16 00:13:42 2010 +0100

    Permit 0 ref counts and don't actually forget about messages until the file gets removed

commit 02ee72652a15b2d8d075c58ae0a29408fd050987
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Sun Aug 15 22:44:38 2010 +0100

    PubAcks are de-dupped in rabbit_channel

commit 3afb316eeec2b5354497d949a46e3251e57bfda2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 20:15:59 2010 +0100

    don't log file summary recover error
    the details aren't that important and get in the way of a fresh
    startup

commit 01a3a784a510263a61cf8509c434460225864f6e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 17:01:22 2010 +0100

    don't attempt to recover file summary when we know there isn't one

commit c8c758f69387a1ec9f8503744997525df576eb55
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 16:46:32 2010 +0100

    cosmetic

commit aa6bcf3934d520c8d2657bacead8da21b0ada322
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 15 16:11:15 2010 +0100

    Obtain from the fhc sync, and obtain it before we actually open the file

commit ceb1b969fd284c307758d72c5256d5eb138f9787
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 15:36:59 2010 +0100

    more refactoring

commit 7584790b6fa1b349da69e20c3069716069915dcc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 15:17:36 2010 +0100

    yet more refactoring

commit 7c38e9b288e4093dd2e9ec8c8d562b523da19740
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 15:02:30 2010 +0100

    now it compiles

commit bc5c59a00812d502f2472815440996908988d272
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 14:58:51 2010 +0100

    minor refactor

commit 29b700426dfbed15d0b95f1c493321367d7a7037
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 14:51:27 2010 +0100

    cosmetic

commit 79a7a99c45e17409c9f7c6ffdda20e0ef5170a47
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 15 14:49:47 2010 +0100

    minor refactor

commit ca067635b60d1f8d4daa96b31a65dc38c173d318
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 15 13:55:00 2010 +0100

    Refactorings and improvents to msg_store startup

commit 04a12da57632ba38e52632c85f7b528f08798084
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 15 13:35:18 2010 +0100

    The underlying call to file:copy will not make use of any erlang-level read buffer, so don't bother with it.

commit 4b8ec8872ad779839fdf4428a2dde12e626f1afe
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 15 13:32:32 2010 +0100

    Improve, correct and document msg store recovery

commit 948ecda509ebbc70c135a33833189534b862526b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sun Aug 15 11:03:22 2010 +0100

    Correct and simplify the recovery from crashed compactions

commit 7b05055eb9ae4d2b7a0a291d03bdc04ad286e556
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Aug 14 20:27:07 2010 +0100

    When recovering, because of the possibility of finding the same msg twice, ensure that we only count and include the first copy. Other copies are then ignored.

commit 0c14e210ca1d08adac5239c264e24c209a2c0489
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Sat Aug 14 20:12:52 2010 +0100

    A msg can appear > once in the same file because of multiple queues receiving the same msg. When we iterate through the msgs we find in the file, we must check that the msg corresponds to the msg in the index, by matching not just with guid but also with offset. Also just for fun, assert the total_size matches. Also, fixed a mistake in file_handle_cache where the dirty flag on the destination of copy wasn't being set.

commit d75fc298742940d7eba305fdea10e06d0f6bf744
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 18:05:29 2010 +0100

    typo + reformatting

commit fc62811384f293e4e82e583b18991f9daaac0cf6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 17:42:03 2010 +0100

    refactoring
    
    What's done:
      - PubAck after transient messages
      - PubAck after basic.returns
      - PubAck after message delivered to a consumer (disregarding
        consumer acks)
      - PubAck after message got
      - out of order ack'ing
      - multiple ack'ing
    
    Whant's not done:
      - PubAck de-duplication
      - PubAck after message hits disk

commit 1786a75a72991b99788bdb515f92573b6f32e501
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 17:16:16 2010 +0100

    puback for persistent non-mandatory, non-immediate, unrouted messages

commit c6cece479f62dbefd64976c0b86babb3d5c996d7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 16:36:37 2010 +0100

    pubacks are sent right after basic.returns

commit d58dcb780898a8310b510bda6d5addee720ded83
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 16:32:47 2010 +0100

    Remove dead code in tests

commit c79d7452667e9bf25d7dbd27ca50eee991877e01
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 16:16:49 2010 +0100

    Move the linking into the start_channel function

commit b4e72e423bb26ad9b139b6fe86571ae150a0b72c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 16:16:44 2010 +0100

    simplified code a bit

commit ea9361d575c3f1ea292c1880e49fabab747e2e79
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 16:08:19 2010 +0100

    puback is also sent after something basic.gets the message

commit 10c27d920985c535c5add0cbc0c672d3653b4ed3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 16:04:11 2010 +0100

    Reduce calls to connection_sup:reader

commit dddf242a6ff12af4609fc6e3f562198294181c04
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 15:49:56 2010 +0100

    Specs, moving things around, and removing dead code

commit 4883ff548fb8761684177e8fc77ee212e51a3a81
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 15:44:04 2010 +0100

    partial acks for persistent messages
    
    The publisher gets an ack in the following cases:
      - the broker receives a transient message (after the exchange has
        been resolved),
      - the broker sends the persistent message to a consumer (regardless
        of whether the consumer acks that message, rejects it, etc.).
    
    Still to do:
      - the broker writes the message to disk.

commit 3a2afd875de0e40f47c6b5a93d707fcf26ae33ed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 15:02:48 2010 +0100

    Cosmetics

commit fe529454dea520b25ae4cde5475cf0cfc912037d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 14:54:20 2010 +0100

    Remove writer flush and improve sync methods

commit 7890666d64704e08f82a748ba76adddae83fb937
Merge: 874c0dded 9f00b0141
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Aug 13 14:37:41 2010 +0100

    bug 23118 merged into default (windows file descriptors limit)

commit 94ed3252a83642e889335d5e600797e070d22b7b
Merge: cda84b4e5 874c0dded
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 14:13:22 2010 +0100

    Merging default into bug 15930

commit 9f00b0141635732298e47eaa8ec14503bb7aa275
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 12:44:49 2010 +0100

    Improvements to comments

commit 3a4cf175f8da0de9eca9619b218a18530c0ac55c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 12:21:01 2010 +0100

    only transient messages are immediately ack'd (so far)
    
    In addition, a message sequence number is recorded in the #delivery{}
    sent to the exchange.  If the message doesn't need to be ack'd, this
    sequence number is undefined.

commit 0b7133e9ec8a891c7dc7779ba635bcb7213914d5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 11:55:46 2010 +0100

    new logic
    
    Message sequence numbers are assigned uniquely when the basic.publish
    is received.  If confirm is not enabled, this is undefined.
    
    Rabbit_channel gains a new API method: confirm.  This schedules an ack
    for the given sequence number.  The idea is that repeated acks are
    allowed at this point and de-duplication is done by the channel.  This
    way, in order to confirm a message, another module just needs to
    know 1) the channel and 2) the message sequence number.
    
    No de-duplication is done at this point.

commit 54c800a01bfd9e0cb3ea37ffb179e2ec9b718dcb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 13 11:22:47 2010 +0100

    Reduce the file descriptor limit for Windows to 512

commit 874c0dded0affe3e7dc3efca309ad3535cee5825
Merge: 49732d290 c1b4149cb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 10:43:52 2010 +0100

    merge bug23120 into default

commit 6ff8e253b1b0d71d96958d38561ddc86bb42e6e8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 13 10:25:17 2010 +0100

    some instrumentation

commit cda84b4e59f2b5d1285f8393c61ca79ebddadf18
Merge: 98a1b0ecc 49732d290
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 06:35:01 2010 +0100

    merge default into bug15930

commit 49732d290d29ed81d30a096b352c8a7640e0f13e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 06:32:50 2010 +0100

    tiny simplifying refactor

commit 7fd510b08ac99f60655c43fc0562d8fa0fb8040b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 06:26:09 2010 +0100

    cosmetic: friendlier type name

commit 98a1b0ecc563881359fa3fc78d2062400b89f0e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 06:08:40 2010 +0100

    refactor: extract termination Reason analysis
    from handle_dependent_exit and wait_for_channel_termination

commit 069a765c83acdc32dd1d7e47e592b177ad8a2124
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 06:01:45 2010 +0100

    revert the change from 'stop' to 'flush_stop'
    and move the writer:flush call to a place where the need for it is
    more obvious.

commit be1808608b530c3b72e706ea4a458f33fb5d1754
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 05:58:16 2010 +0100

    remove dead code

commit bd3137458993cb7a6df675ce3959c6f2ef9fe529
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 05:58:05 2010 +0100

    cosmetic

commit c1b4149cbcd27ae130f2f1e1acac09e5d461a983
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 13 04:26:45 2010 +0100

    use consistent return types for start/start_link functions

commit 173816cad7677a27f2b62f14a26b0a9aa764f1a1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 15:07:06 2010 +0100

    only have one ack timer running at a time

commit 45ff6f827dab79075d10433677b7ff8d364bc7c0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 14:52:46 2010 +0100

    type; all java tests pass now

commit 32f9685cf78dca82ef207368a779ec64adf6ae1f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 14:39:03 2010 +0100

    minor clarification

commit 8099cd980949f7d7d5fe6972f01d624e8cde615e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 14:08:34 2010 +0100

    refactor timer code; looks more like msg_store now

commit 576451c23a311303e5c6bf8056cc32f040e7a786
Merge: 5b920f47f 8eadc8328
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 12:45:18 2010 +0100

    merge bug23095 into default

commit 134eab808bd1fb6e408e964df83c59a7535b6cca
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 12:20:50 2010 +0100

    refactor + timer cancelled on channel terminate
    
    When the channel terminates (for whatever reason), any outstanding
    acks are simply lost.  The reasoning behind this is that:
      1) if the channel closed due to an exception, it should close immediately;
      2) if the client wants to close the channel, but receive all of the
         acks first, it should wait for the acks and only then send
         channel.close.

commit 5965b80e510973c5939e6313626b65650541a0aa
Merge: 600288c63 8eadc8328
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 12 11:50:27 2010 +0100

    Merging bug 23095 into bug 15930

commit 8eadc8328e8a4d046ee7bd9733b915fa1c823074
Merge: c16a63ee4 5b920f47f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 12 11:41:02 2010 +0100

    Merging default into bug23095

commit c229634a282a604c998a6d1936d9b33579bdebab
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 12 11:04:13 2010 +0100

    support for multiple confirmations
    
    Suppose the channel is in confirm multiple mode, and acks for the
    following messages are outstanding:
    
    >  3 4 5 7 10 13
    
    The server sends one confirm-up-to 5 ack and three more acks for 7, 10
    and 13.
    
    If the client receives a basic.ack, it should interpret it like this:
    
      basic.ack{delivery-tag=N, multiple=false} => the published message
        with sequence number N has been handled
    
      basic.ack{delivery-tag=N, multiple=true} => all the published
        messages with sequence numbers up to and including N have been
        handled

commit c16a63ee4e19b129c438da7c0e0da4c8bf3785c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 06:16:57 2010 +0100

    do not ignore 'normal' permanent child terminations during shutdown
    If such a termination is worth reporting while the supervisor is
    running, it sure is still worth reporting when it's shutting down.
    
    This involves reverting all the changes related to ignoring normal
    termination during shutdown and instead adding some logic a bit higher
    up the call chain.

commit 7a5439363df2ba639adc5d2a209df75528b30c0d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 05:39:02 2010 +0100

    never ignore 'noproc' during shutdown
    We have no idea why the child died. Furthermore, we will only ever get
    this when a child has unlinked itself from the supervisor, which is
    naughty and shouldn't go unnoticed.

commit f937755fe73ec9600e4849666de8e68e3e1616b7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 05:23:40 2010 +0100

    we must always clear both the 'EXIT' and 'DOWN' message

commit 9d0230adde9f53afc7e7b35d24db257bb703fb95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 05:19:28 2010 +0100

    cosmetic and minor refactoring

commit 5b920f47ffb3af84853e447291d4e231c163fc12
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 12 04:10:13 2010 +0100

    cosmetic

commit 1cc1cf76c916a2f09a118912ecd13ceae8306547
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 11 18:00:22 2010 +0100

    added support for multiple publisher acks for transient messages
    
    When in confirm multiple mode, transient messages queue up in a
    gb_set.  Every 5s, these acks are sent out (individually, for now).

commit a080c6c13de45247d511f8e897ffea574a800fc0
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 11 17:20:49 2010 +0100

    subsequent confirm.selects cannot change the multiple setting

commit 215589110977e13e95d29024bb4f12e488d4d156
Merge: f9b8ae679 52c0123cc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 16:54:55 2010 +0100

    merge bug23104 into default

commit 52c0123ccaae1a5b6a400d21b01a7c15c842e6bb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 16:52:35 2010 +0100

    remove redundant code

commit 516ff90b510bf7bcde4eb9961db4f35c39cca13b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 16:33:47 2010 +0100

    minor neatification

commit 911bbf6f19bad9918f128fa90dce5c94b189416c
Merge: caead8fcb f9b8ae679
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 16:30:16 2010 +0100

    merge default into bug23104

commit f9b8ae679c9955c1be9dbfd1ad77e192d3269049
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 16:28:21 2010 +0100

    cosmetic: consistency

commit 600288c6383adfb393c9cbd50afc46da02c98032
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 16:16:15 2010 +0100

    Get the reader to link to the chan_sup instead of the framing_chan. It used to link to the framing chan, which meant that when it got the exit signal from the framing_chan, it could be sure that the channel and writer had already died. However, this is no longer the case - now the framing_chan is actually the last to start and first to exit in the chan_sup and so the reader needs to link to the chan_sup instead. This means the reader needs to track both the framing_chan and the chan_sup

commit ce7d349cbfe1ea1f0f53c5fa1ad1164a0974b99a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 11 16:06:00 2010 +0100

    rename pubAck -> confirm

commit caead8fcbb5e0d12d7c0610a13d40df7879df649
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 11 15:59:38 2010 +0100

    make table content spot check part of schema_integrity_check
    and
    - rename check_table_content to check_table_integrity
    - change wait_for_tables to only do what it says rather than also do
      the schema integrity check. This change is necessary in order to
      avoid an infinite recursion due to check_table_integrity needing to
      call wait_for_tables
    - add ensure_schema_integrity_check, which contains logic which
      previously was part of wait_for_tables
    - call wait_for_tables in all the right places, and no more

commit 91d12163db8232a8c1e2b16c81e21bdab0e04e27
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 11 14:01:16 2010 +0100

    check that messages are transient before ack'ing blindly

commit 565589202b07c2a07de6f3a07c012e735aed471e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 13:57:55 2010 +0100

    idiot2

commit f272143a249b2128e6f2ae2a86f3a279869dc9bc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 13:56:40 2010 +0100

    idiot

commit 5cc92b64e688ba403233eff17fcfbdf3d1460431
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 11 13:54:36 2010 +0100

    added counter and single pubacks for transient messages
    
    Publishes are counter starting with the first one after
    pubAck.select().
    
    If many is set to false, transient messages are ack'd as soon as the
    are received, but after the exchange name is resolved.

commit c2ff58c43e96f0a077804e73d11d027b625798af
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 13:46:05 2010 +0100

    The table content tests need to happen *after* we've waited for the tables, otherwise they can fail. Thus now two phases - schema checks, as before, and then table content checks.

commit a76cf88e73eab206bd797f2bb2bfc51d57b28c57
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 13:30:30 2010 +0100

    cosmetic

commit c12c25631bd77fba582d18e424ab968eafa77a8d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 13:21:10 2010 +0100

    Improve match specs

commit a6642c403150e28c90b28b4f307a58f1ccf18a9b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Aug 11 12:53:31 2010 +0100

    Use match specs instead. This is a first pass - I want to be able to add some guards and assert things a little more tightly

commit de3e45690f2d4b5bbe9fe33d26ebd7ad490955c8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 18:38:15 2010 +0100

    Partial implementation of 3rd suggestion. Partial because I just wanted to see the shape of it rather than implement the whole thing and then possibly have to revoke it. IMO, testing on the deep structure of terms is likely sufficient

commit 912416cd714c6cbfabe95d0c6a9d473b34ecf9c1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 10 17:56:33 2010 +0100

    added pubAck handlers in rabbit_channel
    
    A transactional channel cannot be made pubAck.
    A pubAck channel cannot be made transactional.

commit 532eb7b665ac41ad39674821865460b73f752412
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 15:27:58 2010 +0100

    Remove dead code - collector is never explicitly shutdown: the supervisor will kill it off appropriately

commit b340fd6b58f207aa5d4a1f6d8d204eb802b4f563
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 10 15:12:35 2010 +0100

    added puback to framing codecs

commit 2afcc050f5b87b8e4630b493e4d236c1ee953828
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 15:11:31 2010 +0100

    I erroneously removed trap_exit on channel yesterday. It needs to be on because otherwise the gen_server won't call terminate when it's sent a shutdown signal

commit 80565eef7b3a704d7baef64cb3a46b759915c6f3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 15:05:21 2010 +0100

    Abstract the heartbeaters in the same way - the reader now has no references to supervisor(2)?:.* nor does heartbeater.

commit 6aaaa0ac97c9729d4f5c23e1c1f9ebe622e9022f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 14:02:41 2010 +0100

    Abstract out the limiter creation. The abstraction made ensures the channel never directly calls supervisor(2)?:.*, nor does it have any knowledge of the channel_sup.

commit 47f3113644fa8bb1d63e37474e35059d48d1a12d
Merge: e5f4b173f 0a81f9e6f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 12:54:57 2010 +0100

    Merging bug 23095 into bug 15930

commit 0a81f9e6fb0c02073ccfea530edaf4cd2081ff40
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 10 12:53:40 2010 +0100

    Prevent supervisor2 from getting upset if a child has already vanished normally whilst the supervisor is trying to stop it

commit d89a35b5351c6212f41645b8b102b4671e10ffca
Merge: a1145b0d2 82aad8649
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Aug 10 12:20:01 2010 +0100

    Remerge bug23038 into default
    
    Plugins directory should always exist

commit 82aad8649a37fea6a33b266b1401de7ff361f738
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Tue Aug 10 10:23:26 2010 +0100

    Make a plugin directory for the Windows package as well

commit a1145b0d205da96ec1991aab44e80e940f0cd347
Merge: e6e6c6a68 e1ee5e143
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 9 19:15:38 2010 +0100

    merge bug23098 into default

commit e5f4b173f598d084a9796b16544cff6c1846ccbf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 18:59:24 2010 +0100

    When a supervisor is killing off its children, if its children have already exited normally, don't class it as an error - after all, the supervisor traps_exits, so the relevant exit signals will likely already be in the supervisor's mailbox

commit 638724edbe75aa9c4414550b449c8e622b6777dc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 18:45:37 2010 +0100

    Fixes all over. Still more to do, though mainly API fixes. Functionality seems to be correct.

commit 919856b5dbd8bc26dac3359274b3293377a37cd6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:14:10 2010 +0100

    Given changes to intrinsic, if we do ever try to restart (abnormal exit), we should hit the max restart intensity immediately

commit 41babd9f15696db9dff4c1610fdf650f82a61e3d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:10:19 2010 +0100

    Arbitrarily decide to make the channel_sup_sup the very first thing that gets started and thus the last that gets stopped

commit c07d794336faaf65da3a3f3cc8e00150cb6fe95e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:09:17 2010 +0100

    Flush the writer much earlier on, allowing the actual termination to be less risky

commit 1f8bdc699e5a3ba3690d989982a0a87c18a26a83
Merge: 446c09257 e1ee5e143
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:05:22 2010 +0100

    Merging bug 23098 into bug 15930

commit 446c09257ccdf9d9ec04d6ab902d823e31ed4289
Merge: c7a372f8b e6e6c6a68
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:05:04 2010 +0100

    Merging default into bug 15930

commit c7a372f8b6279577fd5f03943a1eaa261a3522b2
Merge: b25e6ea4d 4cf09750c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 17:02:21 2010 +0100

    Merging bug 23095 into bug 15930

commit 4cf09750c87c04aacedc24609b21fe2eaf3f73fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 16:36:44 2010 +0100

    Modify behaviour of intrinsic to be more like transient, except in the case of normal child exit

commit c013109ca808fad0b46d57f90ebf596603d466f8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 16:35:39 2010 +0100

    Reverting rabbit_sup to not use intrinsic

commit e6e6c6a683aa253995cb4b0984d767bbe8bbc3dd
Merge: 4ba0d1841 49b3ba704
Author: David Wragg <david@rabbitmq.com>
Date:   Mon Aug 9 16:02:09 2010 +0100

    Merge bug21875 into default
    
    allow erlang and rabbit to be upgraded even when plugins are present

commit cbddaa7c55703346ccb49512c2d334dfb4838990
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 9 16:01:58 2010 +0100

    use state_del_child instead of remove_child
    remove_child removes child *specs* which is not what we want here

commit e1ee5e143b3d83e44df8de637fa71434ec4c2431
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 15:58:33 2010 +0100

    On reaching the max_restart_intensited, don't remove the child spec. Instead just blank out the child's pid, thus ensuring terminate works correctly even for simple_one_for_one_terminate

commit fa15cf2b931a7d67dad5dd1c25f4cf4ed3eb7e19
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 9 15:34:22 2010 +0100

    cosmetic

commit 4ba0d184198d82c07fdcd73c321df397707ce2b2
Merge: cd5f6ae65 7bb99f518
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 9 14:30:08 2010 +0100

    merge heads

commit cd5f6ae651ac95fea95d81173fecc730e139e0e7
Merge: 2f30d659e a667798ec
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 9 14:28:00 2010 +0100

    merge bug23095 into default

commit 7bb99f518dade651c4006b3cf59e64f0e2b34509
Merge: 2f30d659e 7604294b9
Author: Vlad Alexandru Ionescu <vlad@rabbitmq.com>
Date:   Mon Aug 9 14:11:57 2010 +0100

    merging bug23039 into default

commit b25e6ea4d1e4c6c732e601409f1a04940f315dc3
Merge: ffa1136ab 4754d8376
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 13:39:42 2010 +0100

    Merging bug 23095 into bug 15930

commit 4754d837626559b51120596c2bcb86398b731a82
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 13:38:27 2010 +0100

    Convert rabbit_sup to supervisor2 using intrinsic

commit 81358ff87e760e4d06942682ee729c278ddb9327
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:32:27 2010 +0100

    Introduce intrinsic restart type

commit ffa1136ab323510eadc1313ab0b29a45a03d9484
Merge: abbec139f 2f30d659e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:22:19 2010 +0100

    Merging default into bug 15930

commit 2f30d659e683f8b9c5a474650478d6d37b2cc3f9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:20:53 2010 +0100

    Export gen_server2:enter_loop6 (oversight from the past)

commit abbec139fd84a9047f87dc2e45a46fbe31cc61a2
Merge: 601fccb19 a667798ec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:11:09 2010 +0100

    Merging bug 23094 into bug 15930

commit a667798ec6299fd89fc3ebc6fac8b354b31f68b1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:10:38 2010 +0100

    cosmetic

commit 499ca2515bf0b06ef3742a0586e5c7d4a45ded05
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 12:08:44 2010 +0100

    cosmetic

commit b0e6e4a626fc05c31c40b029bb023f6a75d2e6cc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 11:40:33 2010 +0100

    Move parent inside of #v1 in reader

commit 601fccb19f8ca8b16a8acdaa3fd9ec384054d117
Merge: b73f0e725 5c06e6198
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 9 11:31:01 2010 +0100

    Merging default into bug 15930

commit 5c06e619889bc1708a6f182a1403d40099f1a8e8
Merge: da8347974 94926b2d9
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Sun Aug 8 17:50:22 2010 +0100

    Merge bug23091 (use protocol in #content rather than supplying it)

commit 94926b2d94b420e3337da693b267cb821f808720
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Aug 8 14:24:20 2010 +0100

    expand and rewrite tests
    make it more obvious what we are testing and handle more cases

commit f0fda32d9bf270d872d346e458f671ae77a64803
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 7 23:44:54 2010 +0100

    improve test coverage

commit 81774a2718da5364015dbd6b8f6bb9d3451f7876
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 7 23:33:48 2010 +0100

    handle transcoding of content when it is not available decoded

commit 1dbeefe4b8d18c88fa5aee1b3adcd20da0e2dd94
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 7 22:29:06 2010 +0100

    cosmetic
    - we only use quoted atoms in types and when quoting is needed
    - make existence check total - if it's the wrong type code further
      down the chain will barf anyway

commit f525e17989d7bbb0e563d37f837da8880a27172c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Aug 7 21:13:16 2010 +0100

    no protocol in rabbit_binary_parser:ensure_content_decoded
    it can just use the protocol associated with the #content, which is
    safer and presents a saner API

commit 7604294b948b8d7a5a070cc73aa959f223b90846
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 19:01:08 2010 +0100

    include method name in error if possible

commit 642c09581e0846f1fb42b108958a0f47f91fbdf2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 18:25:45 2010 +0100

    oops

commit 49b3ba704e55902202f0f62f0e586fa9bc0109d3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 6 18:00:16 2010 +0100

    Fix stupid error, more consistency.

commit b73f0e725a82b72b6d8d7bc17b764c46037a8a90
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 6 17:55:16 2010 +0100

    Added intrinsic restart type and used it

commit f9d684f8509395e274ab928bc861337cf08dedc7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 6 17:27:06 2010 +0100

    Removing the wrong changes to supervisor2 to suppress error reporting. Shall fix this one differently.

commit 3d77a24d27d1555a6dda6fce6cf459c50a9895d4
Merge: edbab94bf 28bc28798
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Aug 6 17:24:16 2010 +0100

    Merging default into bug 15930

commit da834797427264b79918573be75858914dde02ed
Merge: 28bc28798 2d5157701
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Aug 6 17:22:03 2010 +0100

    Merge bug23035, list activated plugins

commit 2c4930b668e65c5de081bc3d827a5171b0d6ab10
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 17:15:21 2010 +0100

    exit the framing_channel normally on unexected_frame error
    and use explicit signalling to the reader instead of exiting
    abnormally. This avoids cluttering the error log.

commit e0c9fbf9d5416fa5a21d527cacad0a3703b9b0ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 6 17:06:06 2010 +0100

    Unpack plugins into appdata on Windows.

commit 53cc5e498deef6d5d54c5e86c60d3877d39bd3c7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Aug 6 17:03:10 2010 +0100

    Default to the real Unix-y scratch dir, override in the Makefile.

commit 28bc2879895c475cb019d9c89582eeb8685f3d38
Merge: 1388c43f8 9b88b8d4f
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Aug 6 13:07:27 2010 +0100

    Merge heads

commit 1388c43f8bebe5a4761700a65dc8c22ddc3e6751
Merge: 731249c7d 6a6d6d383
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Fri Aug 6 13:06:41 2010 +0100

    Merge bug23038, plugins dir in binary dists

commit 9b88b8d4f693ead8f5e00ca35c91c96b7b8baad3
Merge: 731249c7d 0b74a8d50
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 12:59:10 2010 +0100

    merge bug23083 into default

commit 0b74a8d50dd0e0a8d023defff65080b0cb3108b6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 12:30:15 2010 +0100

    tweak

commit 370d8cb9e31eebfe6dde90623230bcbbc577f9ec
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 12:25:00 2010 +0100

    tweak

commit 314b2a80bd83fe1a03ed6dbb5f9a4c6d3a2f5be4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 12:13:55 2010 +0100

    don't depend on exceptions

commit cfb4ced43a8f02a3ca5518cafde9f44372048128
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 11:40:19 2010 +0100

    map/filter at the same time

commit 73db6798274782fd7f8d3a04f40826928d6c8569
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 10:57:27 2010 +0100

    more informative failure messages

commit 3718e1cf11ac13582c8122923b0526a65ab80c71
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 10:12:02 2010 +0100

    table columns also need to be in the same order

commit 5b3edc173e8e1306a1a12f22da7c123e04e74ca6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 10:05:21 2010 +0100

    tables are compatible only if they have exactly same attributes

commit 50a18a89fdd0fa19cb7d407117275284a8111759
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 09:50:53 2010 +0100

    all errors should be caught
    
    A missing table results in the following warning
    =WARNING REPORT==== 6-Aug-2010::09:41:24 ===
    schema integrity check failed: {aborted,{no_exists,rabbit_user,attributes}}
    moving database to backup location and recreating schema from scratch
    
    And a differently defined table gives this;
    =WARNING REPORT==== 6-Aug-2010::09:43:29 ===
    schema integrity check failed: database_tables_incompatible
    moving database to backup location and recreating schema from scratch

commit 731249c7dc01c17832d043ff8661b48c909e11bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Aug 6 09:29:44 2010 +0100

    cosmetic

commit fa2e2ffea4b357e4d34cb3d3211fb26d1a024132
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Aug 6 00:16:54 2010 +0100

    refactored code

commit a4510d055fed78482536878c30f83c12b35206e4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Aug 5 18:51:40 2010 +0100

    check that mnesia table attributes are as expected

commit fd4844c7717ccb209df72b1ef97cf4896dff28c2
Merge: 2420864db 9f08ac34f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 5 18:03:51 2010 +0100

    Merging bug 23027 onto default

commit 2420864dbc7affa077c4cdd031482eebd403999e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 5 17:56:09 2010 +0100

    nicer error messages

commit 9f08ac34f4567971dfb0f526a328f8c948ffc02f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Aug 5 17:13:13 2010 +0100

    Minor improvement

commit 5e7719a0e55e57b59c2ef40ad41b8e03eb116120
Merge: 22a99dc7c fbdc8c26f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 5 15:56:46 2010 +0100

    merge default into bug23027

commit fbdc8c26f8915d72548415e2ff20fe546968b2b8
Merge: f9bbe5dd9 656666f1d
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Thu Aug 5 15:24:33 2010 +0100

    Merge bug20078 (don't fail commits when queues go missing)

commit f9bbe5dd9eba7c07a72615685bfffb30c4b7660f
Merge: 17890fced 9b791b038
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 5 10:33:32 2010 +0100

    Merge bug23077 into default.

commit 17890fced8fab250c79fd49fe15522dd089a2fc5
Merge: 19a317a25 8b1ea8d95
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Aug 5 10:29:32 2010 +0100

    Merge bug23060 into default.

commit 19a317a25f2aaf55c0eb32f7a061688cecc7cb67
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 5 10:01:55 2010 +0100

    cosmetic

commit 656666f1d6a18ce6b7d2e8a4c32b2c4524a50d64
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Aug 5 08:19:56 2010 +0100

    don't barf on tx.commit when some queues have been deleted

commit 9b791b038c2a7c4b0e6b876414d677215be4eb03
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 4 22:03:12 2010 +0100

    hide rabbit_event initialisation details

commit be5fa5cff3ef85d17e6743dc3894f33cca54c2a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 4 22:02:13 2010 +0100

    better description for rabbit_event

commit 1bc6463b6143d3fa1c05ad7efd5f072bdd1e2843
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 4 18:12:46 2010 +0100

    more useful comment

commit 55601957ca6c8a0dd1a98066617446499701d541
Merge: caff9aeb5 3de7fe140
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Aug 4 18:09:15 2010 +0100

    bug23071 into default

commit 3de7fe14067d7af23a52767efead5f6fe82c8451
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 17:58:48 2010 +0100

    Use now() instead of os:timestamp() for compatibility. now() uses a per-node lock, which is not great, but this is only invoked on lifecycle events, plus every few seconds per queue / channel / connection when the stats level is > none.

commit caff9aeb51595415d98061d24056360d674e0166
Merge: 98ff3f15f 48aaafeba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 16:31:18 2010 +0100

    Merge bug22964 into default.

commit 48aaafebaebf971d5a6affc5e22fca7346ac4282
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 16:29:51 2010 +0100

    Cosmetics.

commit c596ac517edbc679c841b68dd07993d37fc42676
Merge: fe6f045b7 94051850d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 16:29:30 2010 +0100

    Merge heads

commit 8b1ea8d958d56e224a68757105b62c0999b05ce6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Aug 4 16:16:01 2010 +0100

    synchronously delete exclusive queues on server-initiated close
    (not just on client-initiated close)

commit fe6f045b7ff4cd6dcfc2476fea51b162dd79d45c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 4 14:56:51 2010 +0100

    fixed broken function calls; tests pass

commit 94051850d4b526921cea6e6c19854d5b9706a13e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 14:02:53 2010 +0100

    Cosmetics

commit 9214ec835068f874deb150a44be3cafb5df0463d
Merge: a90903dc5 98ff3f15f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 4 13:52:52 2010 +0100

    merged default into bug22964

commit 98ff3f15f3366fd85e6f63e4797e8f34a11f770e
Merge: 2fb0da0b3 0c4962c27
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Aug 4 10:58:31 2010 +0100

    Merge bug23059 into default.

commit a90903dc5061f7b3f97a8452225387994774e58c
Merge: 2b47eed18 98831545b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Aug 4 09:53:26 2010 +0100

    merged default into bug22964

commit 0c4962c277a7df2b23cc6bb993f59e14115a57cf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Aug 3 19:40:14 2010 +0100

    make queue collector shutdown asynchronous
    and add a spec for it

commit 22a99dc7c4040a53c78d74baa29a0ede6f87b905
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 16:12:56 2010 +0100

    correct horrendous coding mistake

commit 2b47eed18f51c388204ce11d82afa7fcfb7b5a05
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 16:10:48 2010 +0100

    moved option parser to rabbit_misc

commit f756a0e4dc6a157854131d8cb9d48dddc41f7efd
Merge: 6a00e4d18 2fb0da0b3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 15:23:57 2010 +0100

    Merging default into bug 23027

commit 2fb0da0b3994152e97b7bb44ab40fe7703791139
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 15:00:11 2010 +0100

    Correct specs of post functions from exchanges. none() is the empty set. No value belongs to the empty set. So clearly none() was wrong

commit be0511cbb4391055524d666f110744b1a92bd0b7
Merge: 65ab6f24a 169d99cf8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 14:57:13 2010 +0100

    Merging bug 23048 onto default (again)

commit 169d99cf8815e514af794a4e8e10025fd0d2465f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 14:56:53 2010 +0100

    Correct missing _ prefix

commit 6aead2372028762ccc879bb1d0a73c0e3f380bb7
Merge: 28762641b 65ab6f24a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 14:56:24 2010 +0100

    Merging default onto bug 23048

commit 65ab6f24a5441aa17b73d43912c6973a31592bf0
Merge: 98831545b 28762641b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 14:55:06 2010 +0100

    Merging bug 23048 onto default

commit edbab94bfd1a88d45e336d8b1dc4d5ec60d8f9e5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 14:26:05 2010 +0100

    Reverted 'shutdown' to 'normal' for our own programmatic exits. This then leaves us with a problem with the reader shutting down channels as previously the framing_ch was trapping exits (so Reason of 'normal' gets converted to EXIT msg), but now it's not (Reason of 'normal' does *not* cause process to exit). Thus use framing_channel:shutdown instead . Also, a child may not return {ok, {pid, pid}} from its startup. But it may return {ok, pid, any} where any is passed back to the caller.

commit cc483697f7cff6c7013ae4a92545496d71f20b4a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 13:47:52 2010 +0100

    added option parser tests

commit a549c6f23b4e468c9cd2766a03e5230dc9dba854
Merge: d6e40e197 98831545b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 13:11:48 2010 +0100

    Merging default into bug 15930

commit d6e40e19762e63eab49f31113b81ba3808fad24d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 13:11:27 2010 +0100

    Avoid the unnecessary callbacks in the various new _sups as much as possible by breaking the declarative child specs but trying hard to keep them declarative as much as possible.

commit 28762641b3702e8b1901fd9f42d0f1563a4903ae
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 13:06:49 2010 +0100

    updated specs

commit 6afa4ad266e14bc42628d18180d0ebfccfc505cf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 12:17:20 2010 +0100

    rabbit_exchange:type_to_module/1 no longer throws protocol errors

commit 98831545b0205444b69de77bb617434714b3212e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 11:54:06 2010 +0100

    Provide a better protocol() type

commit 2d51577016f3a91dc1312236defc1e6c5b8122ff
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Aug 3 11:47:51 2010 +0100

    Print a count + list of plugins that are activated.

commit 215d6eb4451f3f26efb33612e1cb92af82be57ac
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Aug 3 11:41:35 2010 +0100

    Don't dynamically start up the channel_sup_sup - it doesn't gain us much to predeclare it with the Protocol and it makes the children of the channel_sup_sup less obvious

commit 1db512b6896c7adfd0a17571d584047af1980f5f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 11:38:04 2010 +0100

    updated tests to use the new rabbit_control:action/5

commit 8e62e37ab6ae3574dac9935686094ab48674b0a6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 10:06:39 2010 +0100

    updated docs

commit 6deac66223691400e460ed1fb0b88aad289318f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Aug 3 09:59:27 2010 +0100

    treat no-arguments-given as a special case; refactored opt parser

commit af1703ce37ea59b217711cb1595a6683e66d1c8b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 18:25:53 2010 +0100

    Make similar fixes for Windows.

commit c57de2a68bd8d285afedc55f61122c5f6ab5eed4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 18:16:52 2010 +0100

    Fix typo.

commit 5cad73bd60c0847800350d61db4f6ed295209682
Merge: 618900804 df0e930c9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 18:16:11 2010 +0100

    Another debitrot but a smaller one. Did it again due to several largish branches landing on default today and less expected in the near future

commit ee4fa13e7a2a043a2a4840b8f2e04f5742115d3e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 2 17:59:24 2010 +0100

    homemade opt parser
    
    It's either this or ~400 lines of code from github under a
    non-standard license.
    
    The idea here is that you specify options with tuples like:
      - {flag, <flag string>}, or
      - {option, <option string>, <default value>}.
    
    Then, you let get_options separate the flags and options from the
    arguments.
    
    The spec for get_options is:
    
    get_options/2 :: ([{flag, string()} | {option, string(), any()}],
                      [string()])
                     -> {[string()], [{string(), any()}]}
    
    For instance:
       get_options([{flag, "-q"}, {option, "-p", "/"}],
                   ["set_permissions","-p","/","guest", "-q",".*",".*",".*"])
    == {["set_permissions","guest",".*",".*",".*"],
         [{"-q",true},{"-p","/"}]}

commit 6a00e4d18f89987239ec3ff2fb6ac337a364ad1f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 17:53:04 2010 +0100

    remove dead code

commit df0e930c949a6bfdb1fc8d7d699970502c2ab304
Merge: 5e724a3f2 d60ccf9aa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 17:43:42 2010 +0100

    Merging bug 21387 onto default

commit 0eb0de9ba777bed06c8875cda89c59618df45ff4
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 17:37:21 2010 +0100

    Move unpacked plugins and boot script to /var/lib/rabbitmq/plugins-scratch.

commit 9c455da6a7a64b90e0039e93c6546ea6a788ec3e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 17:23:57 2010 +0100

    add Makefile targets to simulate memory pressure
    to be used in tests

commit d60ccf9aa7813adb7675529967afeec3de0094bd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 17:21:27 2010 +0100

    Corrections to specs and export suitable event specs

commit 0eb6880f1d45b51f9ff0c2bec46a9f08ec728232
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 16:56:21 2010 +0100

    Attempt to improve specs.

commit d2e2fa6099077c1f2cf6cb82fdddadca4858bc5a
Merge: b28f42806 2efd9f8a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 16:44:14 2010 +0100

    Merging default into bug21875

commit 5e724a3f2a65f995553b05631a798732448d24fa
Merge: 2efd9f8a2 a6d94f913
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 16:36:35 2010 +0100

    Merging bug 23022 onto default

commit d074060b4ebeb366d3bc061effc5073d066431d4
Merge: 5bb9266f0 2efd9f8a2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 15:57:38 2010 +0100

    Merge default into bug21387.

commit 49114bb7af82dd73bfd482a8bbd5a135653ffcdf
Merge: a678afd58 2efd9f8a2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Aug 2 15:44:49 2010 +0100

    merged default into bug22964

commit 6189008045055d86b08ec2d290d1ef30c734c27a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 15:11:11 2010 +0100

    Forgot to _ prefix

commit 8c2c3dc042ad659afcc4c547fc7adce967942588
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 15:05:22 2010 +0100

    update reader state docs

commit 949b4e5e187083dea6a28375b3878aa751bc7b8d
Merge: 43420d3dc 2efd9f8a2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 14:51:24 2010 +0100

    A ginormous amount of debitrotting, rewriting, debugging and refactoring to merge default into bug 15930

commit 224ab397d38bcc714b8f93aae7038dc63a96c6f6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 14:51:02 2010 +0100

    don't overload meaning of 'callback'

commit 8cd2cc175c11724729abbed67114a7f7886499a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 14:41:06 2010 +0100

    fold the memory conservation status into the connection state

commit 7b06cad028f3b7926009b16d633d5e3763e91aef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 14:02:25 2010 +0100

    only stop reading from clients that publish while memory is tight

commit 2efd9f8a2a2b167b21fc22b427613564b0bf6807
Merge: 2d6d7e7a9 e759510a5
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Aug 2 12:03:23 2010 +0100

    Merge 0-8 protocol header fix (bug23040)

commit e759510a5dcfa87b213609c4075a34e2664953bc
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Aug 2 12:02:12 2010 +0100

    The crazy protocol header is the 0-8 spec's fault; adjust comment to not impugn py-amqp's good name (and document other headers)

commit 43420d3dc8a4eaa0d4be08ab5f63c110cb2ad640
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Aug 2 11:57:38 2010 +0100

    Make the channel and framing_channel more flexible in terms of being created. This improves the API to reduce special casing needed by the erlang client

commit faa9adfa124e87bfbb8a3c2ae20db973d8e404f3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 11:50:08 2010 +0100

    pause/resume heartbeat monitor as required

commit 38256622552a196adcdd5b2f8bd18f667e938ff4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 11:22:22 2010 +0100

    remove unused type

commit 1f53c25d5d970ac85dc2add05434f29424c7eddd
Merge: d7567fad2 2d6d7e7a9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 10:45:59 2010 +0100

    merge default into bug23027

commit 2d6d7e7a9f8b70c71306ce6b5b86006d71a28910
Merge: 3dcf9e0f4 35015e8c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 10:44:01 2010 +0100

    merge heads

commit d7567fad21fd01987e233f1c6c62743ac70a0cf0
Merge: e029170a8 35015e8c6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 10:42:55 2010 +0100

    merge heads

commit c76a37ac41de8f00525dbe09dd47567443078616
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Aug 2 10:24:40 2010 +0100

    Work around broken py-amqplib handshaking

commit e029170a871ef937d1d0222aedb3fb20b67b15e8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 10:17:50 2010 +0100

    react to memory pressure by pausing socket receive
    which is much more prompt and effective than issuing a channel.flow

commit 3dcf9e0f4022db355733f3cc1e2219c95438e2b3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Aug 2 09:19:01 2010 +0100

    cosmetic

commit 0e30bd1f369d510ffb4e0e79b48c33c9109cac2d
Merge: c929581c5 f28485a29
Author: Michael Bridgen <mikeb@rabbitmq.com>
Date:   Mon Aug 2 00:13:54 2010 +0100

    Merge bug14647

commit f28485a299a57eb125b4acc71471ec2b01f14b62
Merge: 7af8b7184 c929581c5
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Sun Aug 1 23:00:44 2010 +0100

    Merge default to get json filename changes

commit c929581c5d29e55dd9c036e6ddeb8cd4b8be6200
Merge: 1bcb40284 656269bcf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 30 20:04:07 2010 +0100

    merge bug22886 into default

commit 656269bcfb28437820f2814bdb2fcbe593debb9d
Merge: 9b3784c4c 1bcb40284
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 30 19:07:47 2010 +0100

    merge default into bug22886

commit a6d94f9132ac1a5d797e08571e8c0f8e0bb5947e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 30 17:22:45 2010 +0100

    added connection_exit() and channel_exit() to relevant function specs

commit 6a6d6d3831aed9a985a556ff52455ba3ec88efef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 30 16:59:02 2010 +0100

    This works for generic unix, deb, RPM, Windows bundle.

commit 1bcb40284def8ae490a4dc9356bcd829e081aa2b
Merge: 44b0742a9 dd999bfef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 30 16:19:05 2010 +0100

    Merge amqp_0_9_1 into default

commit dd999bfef9b58a5b80624beab56ab8fa20b3dcfb
Merge: a4d03b70d 44b0742a9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 30 16:17:39 2010 +0100

    Merge default into amqp_0_9_1

commit 44b0742a979a4fed2780fa876bc56dea1d58dffd
Merge: 6c2cba890 a2f177611
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 30 15:18:37 2010 +0100

    merge bug22889 into default

commit a2f177611cc552d20f833a6955a4c28d68fe7858
Merge: 1575f277c 6c2cba890
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 30 14:14:55 2010 +0100

    Merge default into bug22889.

commit 6c2cba890ac542ca44c15482cbcab6638f33f21e
Merge: 4be6a49a3 e2c6672b5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jul 30 12:35:56 2010 +0100

    Merging bug 23032 onto default

commit 5bb9266f08771a963e838093bf0f5e8ce6f30a5e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 30 12:30:59 2010 +0100

    Re-abstract the stats timer thing in reader.

commit 35015e8c651eb5a08ece9bda07a1db6fed199d08
Merge: 4be6a49a3 b8b51eceb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 30 11:57:25 2010 +0100

    merge bug23034 into default

commit b8b51eceb12cc0a04d2d0ee66b38450cbef42612
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 30 10:04:56 2010 +0100

    tweaks to heartbeater
    - make it return the pids of the created processes. That gives us a useful
    future extension point, e.g. for pausing/resuming
    - add specs
    - get rid of the Y combinator - it actually makes the code longer

commit e2c6672b591af80bd3eef35f78d4ecaf4a81336d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 23:51:39 2010 +0100

    consistently return {ok, Pid} from start_{link} functions

commit c27fac485669a82f6ecd603d0edc811dd560e965
Merge: 4f49ec5f4 4be6a49a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 22:41:26 2010 +0100

    merge default into bug15930

commit 4be6a49a3c7504681d49722af2b82e9d79e27475
Merge: a22a06a9e bb9907c1d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 22:20:15 2010 +0100

    merge bug21396 into default

commit bb9907c1df568dd6733bb2fabd5742d7a7d6fab0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 22:11:38 2010 +0100

    simplifying refactor

commit 3d3be6a69c87f7d2386e18eeb5f8acd0b19f03bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 22:03:37 2010 +0100

    remove unnecessary export

commit e45d0f8c0161a416e61ca85912224e4c27f9d55d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 18:02:21 2010 +0100

    Add an attempt at specs. The second part of the state type should not be an atom but a timer; however I can't find that easily.

commit 6eb05bcedfe1985d911f2ebc88233a8cc63771db
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 17:36:40 2010 +0100

    Fix warning.

commit b31655129a3af26a7d9c3219d261316a39060508
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 17:36:26 2010 +0100

    Revert reader changes in 1451c9523971 sicne they force us to start / stop a timer all the time.

commit 5c0e7ad41982e9a563d58d93e3f2c9e46259b83c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 17:16:09 2010 +0100

    Cosmetics, add pid to CREATION_EVENT_KEYS, don't emit stats when stopping when timer does not exist.

commit a22a06a9e261f4fc048aaf04be2de66fe21e51d5
Merge: 878e8a2c8 0a99dac31
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 29 16:12:49 2010 +0100

    Merging bug 22973 onto default

commit 406f55288a51903e53cc1f61394337be858fcbec
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 29 15:42:50 2010 +0100

    Extend test coverage of delayed restart to simple case and fix exposed bug

commit 4f49ec5f4f210359e4397bad0d7aef6fbe1749dc
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 29 13:50:46 2010 +0100

    Remove unnecessary stop code which was never being called

commit 34452e678c9ed845cca2826a7b7521d3a3033e73
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 13:27:44 2010 +0100

    Refactor: abstract some things into rabbit_event.

commit 188108c3bac6c43222c69c55e32c5e235b390ced
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 29 10:35:57 2010 +0100

    Construct channel creation event as a comprehension.

commit 865565f1907452ffd55adce2cfa7a52bbe5afd9a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 29 07:56:12 2010 +0100

    reduce time taken by tests

commit 5785c909d75949df1ab028cd06fbfeadb80f55c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 17:37:55 2010 +0100

    Typo.

commit 3abd7a2a6eaf93d323c0641082476b2ab1378225
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 17:36:27 2010 +0100

    Clean up tests a bit, avoid the retry count and sleeping.

commit 07b00f19eba2efcac7e355f903d7ae6e80758838
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 16:53:45 2010 +0100

    Don't need retries the first time through.

commit 7af8b7184827752c9343335776d5a2faecf5a481
Merge: 4a16a0410 878e8a2c8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 28 16:49:48 2010 +0100

    merge default into bug14647

commit 59709426b8d66e55134ecc11e10091a51a6ee3c9
Merge: 3beed69a7 878e8a2c8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 16:44:43 2010 +0100

    Merge default into bug21387

commit 878e8a2c846847bfe090fa4a927cbd4e5c835825
Merge: e8fdd69c9 a0ce002c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 15:21:00 2010 +0100

    Merge bug21922 into default.

commit a0ce002c94a915aabc27fde52c1d1a524ddf9dbd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 28 15:06:51 2010 +0100

    Only start the expiry timer if no consumers, and only reset on ch_down, cancel and get

commit 4a16a0410b1566920251ea310ecb26801473487d
Merge: a621678fb e8fdd69c9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 28 14:18:50 2010 +0100

    merge default into bug14647

commit e8fdd69c97d525f2ad769964d4adae1852aa36e0
Merge: b4e27ac40 bd1e178fa
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 28 14:06:48 2010 +0100

    Merged bug23028 into default.

commit bd1e178fa7dbba63560848348ba096187f2bdb42
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 28 12:59:07 2010 +0100

    issue correct error for basic.ack with unknown delivery tag
    as per the 0-9-1 spec

commit c8c23c418b00465c84b63403798efac82c6b1e43
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 28 11:53:44 2010 +0100

    Renaming and minor refactor

commit 3beed69a7c0a4c73740666e78b919671cd3732f5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 18:15:11 2010 +0100

    cosmetics

commit 3cd0341c0cfc9e1951d6d98684ad7fbb01549c6a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 17:01:03 2010 +0100

    Remove dead code and get supervisor2 to hide some error messages when MaxR is 0

commit c090fe522b1b492163934546ac52c15a4c6c9e01
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 15:56:49 2010 +0100

    Correct tests by making the fake writer obey the same flush protocol as the genuine writer

commit b4e27ac400855bf0b88927958b70844c63137b0e
Merge: c1a9bccce febd5b0f9
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jul 27 15:54:11 2010 +0100

    Merge bug23019 into default (Index directories have too long names)

commit 36221346f4faede63aa7ca5a13607403d31dd3e3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 27 14:49:49 2010 +0100

    Rename these to avoid name clashes in the management plugin.

commit 364023482e25a51284bfc24b0c7f79e4b4787190
Merge: 8b18c3028 c1a9bccce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 14:33:22 2010 +0100

    Merging default into bug15930

commit bf33e83919e39a259993c0b06bbfd7e54da2a19e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 14:10:17 2010 +0100

    Added test for delayed restart in supervisor2

commit 02e1398352d292648fcb928db4645c2ecd78fa35
Merge: eacd5eecd c1a9bccce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 13:07:27 2010 +0100

    Merging default into bug 21396

commit 4d33d7ee31d448d94a6ba50211ecc7d94273ce6f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 11:30:01 2010 +0100

    Minor refactorings

commit a621678fbedecae97bd8226a2db197453ee4c018
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 27 11:22:06 2010 +0100

    implement basic.reject
    the simplest flavour that seems useful

commit 5946ee28f4cab80aaac239bb85334140c8fea537
Merge: 8fe7f07e4 c1a9bccce
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 27 11:18:11 2010 +0100

    Merging default into bug 21922

commit c1a9bcccece68e8db7b4ac58c1006cc9829eb40b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 27 09:09:00 2010 +0100

    remove superfluous warning
    We don't complain about similar situations elsewhere, so there is no
    point doing it here.

commit 8fe7f07e412bd21182e55f8f4b3b9ba7613045de
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 27 07:18:57 2010 +0100

    cosmetic

commit 423bf18367d3b599e05fedbb87e39ac4b4d962dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 16:24:03 2010 +0100

    Oops, don't turn into a timer bomb.

commit f4e39903693a58872288213f06dd16ff11db0723
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 16:18:28 2010 +0100

    Send a stats event as soon as you wake up.

commit cb2bb7e6ab0458b559f2683dd65b6e81299d8ce7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 16:12:52 2010 +0100

    Use apply_interval rather than apply_after, cosmetics.

commit febd5b0f94ce00a3329f7ddcf4016daf53c353e4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 26 14:09:40 2010 +0100

    md5sum the queue index directory. Also detect and crash if a collision occurs

commit 4288eb76d59f9de3e4f05b92b4b561058129ee8e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 13:59:12 2010 +0100

    Make statistics collection into an application parameter, switched off by default.

commit 17f64ef2bff3f22503e42ac0195bf187562e91d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 13:16:07 2010 +0100

    Tweak priorities a bit.

commit 232c7c8c043068ba3317cb8318e8fd729d19b39e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 26 13:12:12 2010 +0100

    Revert to the prior, process dictionary-based way of storing statistics.

commit ced21e20f50597d1a7fb49b25aa394ada64ba815
Merge: 3ebcb5c24 e583729ce
Author: Vlad Ionescu <vlad@rabbitmq.com>
Date:   Mon Jul 26 12:34:19 2010 +0100

    merging bug23010 into default

commit e6af65a8d61b247584930b5f0cdc33f425f36f1e
Merge: 1b5bcc5a1 3ebcb5c24
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 26 10:59:45 2010 +0100

    Merging default into bug 21387

commit e583729ce620d628735e784da1a8104c58ef667f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 26 09:45:12 2010 +0100

    selectively receive more messages during tests

commit 1b5bcc5a1207263bd1a8047a1104da97a76da3ef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 23 10:36:04 2010 +0100

    Base the connection_created event on the updated state; needed to get vhost name.

commit bb892b5585a67016282ce3e9627d7bdf106ae13e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 22 16:32:20 2010 +0100

    extract encoded subject field from certificate

commit 3ebcb5c24e092550f9c3e43682991c590b1ef254
Merge: f35fbf96b ab8ec9bee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 16:21:57 2010 +0100

    merge bug21673 into default

commit 2d84cfa0cd2fe037b9623e81aecffa95875fe3b2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 22 16:02:10 2010 +0100

    Allow the complete test suite to run.

commit f35fbf96bd2643c82a575b8c2af8e5e93c3bb0a5
Merge: 2dcfe26c5 bf28bb9ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 16:00:41 2010 +0100

    merge heads

commit ab8ec9beea79bd6cfc3ab55a85047add1d2d0892
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 15:14:07 2010 +0100

    replace use of dict with orddict for per-msg_store partitions
    which is much faster for small dicts

commit 559c81fbd628faa5c319356917523acbeda508cb
Merge: 876dda34e bf28bb9ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 15:12:58 2010 +0100

    merge default into bug21673

commit bf28bb9ef3489530e9704a8fa112900910fb1233
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 15:12:36 2010 +0100

    add rabbit_misc:orddict_cons helper
    analogous to dict_cons

commit f5f88ac1bf169193e5a96d9d91ae478b52f98a68
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 22 14:05:41 2010 +0100

    Unit test, and fix a bug found by the test.

commit a678afd58d21558f6a19e10079d1fd603166a367
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 22 10:57:26 2010 +0100

    Spelling

commit 2dcfe26c5ba97c5e8e6ef28caff1b9b145a2c3a1
Merge: ddd7eb9d6 2516dc575
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 22 10:32:09 2010 +0100

    Merge bug22992 into default.

commit 876dda34e8e4cb77868a1270be38e0bf132bffac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 22 09:36:55 2010 +0100

    refactor: extract rates into separate part of vq state

commit c71772ba218365b91cbd13c4371cf8f39cc35ffc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 21:26:23 2010 +0100

    Rewrite the channel stats again to use ets. Not sure if this is any faster, maybe a bit.

commit 198cd549594c185281d10ddd14f3306d150a0687
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 19:17:11 2010 +0100

    Cosmetics

commit 84ca7ad4736289a4a93af33378a05c19c775cfa7
Merge: 9fb229328 ddd7eb9d6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 19:10:41 2010 +0100

    Merged default into bug21387

commit 532129c29b434ab86156faeb2f22309f4e3ecf4f
Merge: c6a619aeb ddd7eb9d6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 17:30:18 2010 +0100

    Merging default into bug 21673

commit ddd7eb9d66921dcf99a793719799d22bf4bb9f5c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 17:29:24 2010 +0100

    Bump specs requirements to R14A

commit 9fb229328b35ba8952e185865ce37f11cd826f4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 17:27:33 2010 +0100

    Increase priority of stats messages for channel and queue. Don't use gen_server2 for reader since it's not a real gen_server anyway.

commit 8b18c30283e796730cb5377c556a8dde4844de18
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 16:46:41 2010 +0100

    Fixed channel shutdown mechanisms

commit 5327f905660ddf4b45b437b0ddded46695175bb2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 16:36:54 2010 +0100

    Store (channel, exchange) stats as well as (channel, exchange, queue) since we can't derive the former from the latter.

commit 6482e6d649ca43e6ec965f313e5ff8ec2ce169dd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 16:17:01 2010 +0100

    Store queue/exchange stats in the process dictionary since that's rather a lot faster than dict:

commit 990da82944cd356c7ce9c909f250385dc07949f2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 15:29:42 2010 +0100

    Correct shutdown to use API

commit 942ac6ae6e624a4e0edddd8faf318d142f3af9eb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 15:10:12 2010 +0100

    Well the rabbit_tests now pass owing to being able to support a very similar API to previously wrt channel, but shutdown seems to be sporadically successful at best.

commit 036b6f14a125f5355f300d9068e261f3c96a0572
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 14:38:45 2010 +0100

    Whoops - revert to avoid deadlock with supervisor trying to call itself during child creation

commit f7de7d61ddccf1f9503c4ad1f2e498400a0bf6af
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 14:15:31 2010 +0100

    Invoking os:timestamp and timer:now_diff all the time is too expensive, use timers instead.

commit 169172e2ea254db5e1f609db568b31f41296b517
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 13:59:59 2010 +0100

    Add framing_channel:start_link/1 for use by Erlang client

commit 625b8f96c6ac75225c88116ccde1d243fca7a974
Merge: 48b8e6e4a 79de0821e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 13:57:14 2010 +0100

    Merging default into bug 15930

commit 0d2d9f4cca3ce00cd3d22f3358fce6b4c4700a62
Merge: 459a365dd 79de0821e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 13:24:03 2010 +0100

    Merging default into bug 21922

commit c6a619aeb40e5385f3e81fb93478df0ef001baaf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 13:20:15 2010 +0100

    use the new BQ:stop/0 function in tests
    for better symmetry

commit 459a365dd2e23fcc6ba365fd56d5ac9484b22dad
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 21 13:16:20 2010 +0100

    Move logic for validating arguments to queue declaration out of the initialisation of the queue process.

commit 3e15fa35920f7be97dddca250eb9e5e0969ae434
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 10:53:09 2010 +0100

    If a new QPid appears more than once in the list, only monitor it once.

commit c1c6fe20d0febaefe1984398ea0bbbcfa5b10fba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 21 10:32:13 2010 +0100

    Store (channel, queue, exchange) stats instead of (channel, exchange). Unify the two stats dictionaries in the channel.

commit bb4f38da62a8e64d564aad589fd6ba2637d8fc21
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 07:39:10 2010 +0100

    rabbit_amqqueue:stop already stops the msg_store

commit b3a3d43d84d7987ffa201218169824090334f553
Merge: c674f807e 5e1a01349
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 07:04:55 2010 +0100

    merge default into bug21673

commit 5e1a01349a8e2ba636938ad5424c40cc45a6240f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 06:59:57 2010 +0100

    flesh out backing_queue API

commit c674f807ee154d331b3c496aea3e5788ecb04203
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 06:05:07 2010 +0100

    cosmetic

commit 99ebe3327109ec3fc9a3a2839b511598721bf049
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 21 05:50:03 2010 +0100

    cosmetic

commit 2516dc575e258a8b90e70799fa66f9d17cb11753
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 20 22:49:18 2010 +0100

    reformatted comments

commit 15d2e89a1416564e733051af7e14f5091852d396
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 20 22:38:58 2010 +0100

    list_connections can now print a peer's ssl certificate

commit 8549e3801f91facf376aa908f66828aef86edf89
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 20 18:33:13 2010 +0100

    more vq test refactoring

commit dec6c75f600b30e3cfad8b45b4a5615173c2d24c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 20 18:17:32 2010 +0100

    Refactorings in observation of commonality between queues and exchange arg equivalences. Also cosmetics, and various specs fixes.

commit 3997c6928b8ec4c5886ceb7ca152a517418a3d2b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 18:02:03 2010 +0100

    Rename some variables.

commit d1406db0fa572727655efde534eaf813e765f3e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 17:07:20 2010 +0100

    Standardise on "stats" rather than "statistics" since we were getting rather verbose. And inconsistent.

commit dd51403732f86fddffedd438cd106070d44bb9e1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 17:04:31 2010 +0100

    Store both channel-exchange stats and channel-queue stats in the same format.

commit eacd5eecd014b6adedf364b1ab18b9df76a5cd34
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 20 16:55:26 2010 +0100

    Merge the timed/delayed restart code originally from supervisor3 in shovel into supervisor2

commit 73fe309b586f9307e1e3ec3df6307d3fd1142be4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 20 16:48:01 2010 +0100

    vq test refactoring

commit 79de0821eae1c6507ca4d98244fe2718f5914102
Merge: 67ea4e971 1fc0dec87
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Jul 20 16:45:59 2010 +0100

    bug22917 merged into default.

commit 1fc0dec870ec8c756ec911a23c991d76debb0eb4
Merge: 31a3ca38d 67ea4e971
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Tue Jul 20 16:09:19 2010 +0100

    default merged into bug22917

commit 35524687bce5ba40caa04064f3c1956fa0260a6e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 20 15:27:32 2010 +0100

    cosmetics

commit 67ea4e971110b9d1540f271134e4488c7b45f953
Merge: 89d63aa67 e1a3ae46c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 20 15:00:41 2010 +0100

    Merging bug 22677 onto default

commit a1df9866a29d3c6cb8272b7f46b55219c789e838
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 20 14:22:44 2010 +0100

    reporting of cluster node types now works

commit 1575f277cd6b477f5747d8f2253c6cf12a0a0c62
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 13:01:41 2010 +0100

    Cherry-pick the last differences between bug 22889 and amqp_0_9_1.

commit a4d03b70db850684671068ccc82a21e959645646
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 12:54:12 2010 +0100

    Make more consistent with bug 22889 - see comment 83 on that bug

commit 27e731e99210bd4102af32eb78bb118da895b17c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 20 12:52:50 2010 +0100

    remove superfluous test
    this is covered elsewhere already, notably in
    test_variable_queue_partial_segments_delta_thing.

commit 3b93007137e1a5d2259ca954bfbc77d81f622d26
Merge: 4ff838e74 89d63aa67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 12:46:47 2010 +0100

    Merged default into bug 22889

commit 9fea75aea00f8bb545ee9aa4834bf73d405421e9
Merge: 88e22f5b8 89d63aa67
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 12:30:24 2010 +0100

    Merge default into amqp_0_9_1

commit 88e22f5b85aff7d678f13ebb16507b353c28eb9b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 12:25:56 2010 +0100

    This function was merged wrong; fix.

commit 0e5d2ec0915e693ad16412d246362303c9e57537
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 20 11:28:17 2010 +0100

    made one of the vq tests a little less obscure
    ...and don't rely on timing

commit 3579c99cdaf9752fada6098ed40886b76b3e958c
Merge: 78e31457c 4ff838e74
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 20 11:06:36 2010 +0100

    Merge bug22889 into amqp_0_9_1

commit e1a3ae46caa93f22efe19fdc176ec0b8eb991386
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 19 23:21:34 2010 +0100

    applied qa notes; refactoring

commit 238663a465428e1f1c7512b61c72a84bd6b98266
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 19:47:27 2010 +0100

    cosmetic

commit ca90ebf989e34c93f11fa5b7c37e1296975ddedb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 19:37:12 2010 +0100

    cosmetic

commit 3bf50f860f8e62f2a0d537aad2a9f9d0ca4f159b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 18:13:10 2010 +0100

    All sorts of improvements to the queue lease code - simplifications and removing dead code

commit cd3637175967b5049c26370a4315bf031283384a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 17:42:01 2010 +0100

    Missed out arguments in binding_created.

commit 6ff816f09817d6f2c0d2e30632dfe3435be13007
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 17:39:40 2010 +0100

    Lifecycle events for queues, exchanges and bindings.

commit 61925909efc0fa9dfb8de20fca60038ffb07323a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 17:33:49 2010 +0100

    minor refactoring of vq tests

commit 54aef899ac9d7d76ac4840de1b48c8c4a9356c0c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 17:13:40 2010 +0100

    The channel has a few statistics / state of its own too.

commit 771d0b6d33f5adb6ab91ae4a21121e8e992dfc2e
Author: Ask Solem <askh@opera.com>
Date:   Mon Jul 19 17:09:13 2010 +0100

    Initial commit of Ask's work

commit e928c25e5612b1f6fc08ba47abfbd903abbe1725
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 17:00:45 2010 +0100

    simplify qi tests

commit e22a73081d052b46261daeb7823bff02aab78614
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 16:51:14 2010 +0100

    Use list comprehensions to build the stats proplists.

commit 978d2722996c48ea5a2e9e1c6613f56c1841983b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 16:48:13 2010 +0100

    simplify qi tests

commit d774350da98eadc3f7ca2fdcfd7a57913a255151
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 16:21:59 2010 +0100

    Switch to using proplists rather than records for events.

commit 341451c746d9c840755be085d73e1db0dbd08096
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 16:15:41 2010 +0100

    simplify qi tests

commit 8f45d98d50da977183afc1b8b4e4e8f485916418
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 16:00:14 2010 +0100

    cosmetic

commit 2f6f18cec790b873e4682a255deb07546f4b5841
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 15:53:02 2010 +0100

    simplify qi tests

commit 938bb6e88a9538d109448362006c03ef1338af24
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 15:27:04 2010 +0100

    refactor msg_store starting/stopping in tests
    using the new funs in vq

commit e3ecb0f03bf0a0ecaa5cd8137339c3f9eecabb94
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 15:26:13 2010 +0100

    flesh out vq API with funs useful for testing

commit 8d489ef9a3fd1861ca32ce90ff37caa0a6e0d3b1
Merge: 1bfc20d99 89d63aa67
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 15:24:06 2010 +0100

    merge default into bug21673

commit 89d63aa6763a95e85c5afb8b587c693871fe3afb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 15:23:40 2010 +0100

    flesh out APIs somewhat
    useful in tests

commit 5d1744d3b0b262bf3fd29cfccf5c9b70e77f5f12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 14:56:34 2010 +0100

    Make channel monitor queues for which it is gathering statistics, and remove the stats when the queue goes away.

commit 1bfc20d996018627c5d3a4d1f536d512590c2a99
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 14:47:59 2010 +0100

    More documentation

commit 1d07d00858a7cfa221de04f8b658caf34ba5412e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 14:33:51 2010 +0100

    That's not needed.

commit 985667c28c4ab5f906437bd5aa76ae9158d414f8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 14:20:41 2010 +0100

    Improve documentation and document persistent vs transient msg store are for

commit 48b8e6e4ab66b73c414e10a98b889de39eeb0345
Merge: 54c3910fb e1ab80226
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 14:12:06 2010 +0100

    Merging default into bug 15930 and a little debitrotting

commit b9019ea142d1e3e13f8e21388304cd7e85d8ac1b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 19 14:11:48 2010 +0100

    Emit events for connection and channel statistics and creation / deletion.

commit 6146e3c0844c3f039befa0b50c0c0cdc08055b35
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 13:35:01 2010 +0100

    refactor: simplify msg_store tests

commit 4ab86a312669dd37fc9215784cebc9759e11991c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 13:26:04 2010 +0100

    refactor: simplify msg_store tests

commit d01623eb6c8f181fec389830b2ed1b75fd7db929
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 13:11:22 2010 +0100

    refactor: simplify msg_store tests

commit ddd2dc8517095b03c9b6e7aa52a02c2c77064d5e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 12:55:34 2010 +0100

    tweak

commit ffd635e220621a47f19348a830fcc20ce1b51149
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 12:51:30 2010 +0100

    refactor: take adantage of l/r symmetry in bpqueue tests

commit c2c3e4325f29665adcfa642f08c8c8746760459c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 12:20:19 2010 +0100

    dict:find -> dict:fetch andalso lists:flatten -> lists:append

commit 0cc7ae93dd082685c2bd9dd8101b01193454c19f
Merge: 006060a30 ea240729c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 12:09:46 2010 +0100

    Merging bug 22987 into bug 21673

commit ea240729c7dc5335a89af0344a49c4d8c9a2c539
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 19 12:08:26 2010 +0100

    Cosmetics

commit 1fab86b6baf1d4da0310edab718629c5c8da7273
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 11:10:34 2010 +0100

    optimise qi:sync call in tx commit
    call it with acks for persistent & durable messages only

commit 0a99dac3126362b54ffc0be72027ce3447afda5b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 19 10:00:21 2010 +0100

    application:get_env/2 -> application:get_env/1

commit 006060a3024f7caf7cddf22f43fc7256ed9386a3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 09:01:28 2010 +0100

    refactor: 'cons_if' helper function

commit 266211fda73a9a02c5c3efdd34e482a5c3240cde
Merge: b3bc13a4f e1ab80226
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 08:09:08 2010 +0100

    merge default into bug21673

commit b3bc13a4fc5da9428d2aefed6dbd0fa06c37d14e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 08:08:48 2010 +0100

    cosmetic

commit e1ab8022667cfdbfacab2ecbc71f9c73f1abe3e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 08:06:13 2010 +0100

    tweak to assist testing
    ...outside the context of the rabbit app
    cherry-picked from bug 21673.

commit 68c2a43dc7a26950d7076da97c8836c3eddc1ff4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jul 19 08:02:39 2010 +0100

    'sync' -> 'idle_timeout'
    cherry-picked from bug 21673.

commit 6bc6c7e5aae2afb6d2c069f447fed85788947fb6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 19 00:23:07 2010 +0100

    moved rabbitmq_cluster.config into the cluster_nodes field of rabbit in rabbitmq.config

commit 16a111b8fd470357de1edd61c84febe0c34c2f26
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 18 17:45:54 2010 +0100

    tweak msg_store API to make it safer
    ...by not allowing clients to be deleted w/o terminating them too

commit c094929eb41935924f01581d818850ca065ee92c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 18 14:29:29 2010 +0100

    tiny refactor

commit b8e189feabbb0505125a9d03488c7c3afacde7bf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 18 14:20:46 2010 +0100

    add a 'todo'

commit 92fd77450013b71f53a56c76fc7c63c4ec545b4d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jul 18 13:32:09 2010 +0100

    don't log warnings on clean startup of a msg_store

commit d908ae902801e3cde1d502816489cc775912a3c2
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 16 16:30:25 2010 +0100

    cleared up manpage

commit c4e94388e8b2c8f9544ea66e3e4c30b400e341ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 16 15:40:22 2010 +0100

    cosmetics

commit 3bb8a2ecde30222ae9f3d401ea34ec6fb5eaaf6e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 16 15:37:17 2010 +0100

    Use timer:now_diff, don't double-wrap.

commit b523ee6a1f5fe918d8a8753003b9af443fcaa651
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 16 15:25:13 2010 +0100

    q_pid -> qpid

commit 82bd9b5b57e924b84d8be8e98ed6125a7dfca40b
Merge: 507610f99 179615f9f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 16 15:18:16 2010 +0100

    Merged bug22140 into default.

commit de6f13d562d9a63c1df99fb779cc55206073832a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 16 14:52:26 2010 +0100

    Get queues to emit events for statistics.

commit 805372c092366e678005c258851310e7d90c97ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 16 11:51:30 2010 +0100

    don't forget to process transactional acks
    ...when the tx doesn't involve any persistent messages, thus plugging
    a leak in pending_ack and qi.
    
    To reproduce:
    
    rr(amqp_connection).
    Conn = amqp_connection:start_network(),
    Ch = amqp_connection:open_channel(Conn),
    Q = <<"Q">>,
    amqp_channel:call(Ch, #'queue.declare'{queue = Q, durable = true, exclusive = true}),
    amqp_channel:call(Ch, #'basic.publish'{routing_key = Q}, #amqp_msg{}),
    amqp_channel:call(Ch, #'basic.get'{queue = Q}),
    amqp_channel:call(Ch, #'tx.select'{}),
    amqp_channel:call(Ch, #'basic.ack'{delivery_tag = 1}),
    amqp_channel:call(Ch, #'tx.commit'{}),
    ok.
    
    and then
    
    $ ./scripts/rabbitmqctl list_queues name messages_unacknowledged backing_queue_status
    Listing queues ...
    Q       0       [{q1,0},{q2,0},{delta,{delta,undefined,0,undefined}},{q3,0},{q4,0},{len,0},{pending_acks,1},{outstanding_txns,0},{target_ram_msg_count,infinity},{ram_msg_count,0},{ram_index_count,0},{avg_egress_rate,0.0},{avg_ingress_rate,0.0},{next_seq_id,1},{persistent_count,0}]
    ...done.
    
    Note the pending_acks of 1.

commit 4fb7de5a232e4fccef5fdc40d635bb22c2a560db
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 16 11:30:08 2010 +0100

    add pending_acks to bq state report
    it turns out to be useful

commit 2111eefcfa8783c3581a68c9a9bf9359420879b8
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 16 08:44:13 2010 +0100

    refactor: invert some conditionals for better readability

commit e72b5f9f9efc9569fe6e30d0134b4f48f3d2c57f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 16 08:04:12 2010 +0100

    refactor: trim args for msg_store_callback
    we only ever need a msg_store_callback when we have persisted pubs

commit 4691226a5b4997acbe1d83ffdb9b2dd3af47f7ee
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 14:56:41 2010 +0100

    another place were averages could end up being integers instead of floats

commit aec3a8b2ea3de0aaa94eb83e29c05cd7dce611cd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 14:13:00 2010 +0100

    rate averages are meant to be floats

commit 5f3637cad2692c4ef1fd1a0899d1a5e08b36b66e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 14:11:28 2010 +0100

    avoid >= between a number and an atom

commit 281cdb6ef30b07c9d58d6c0f434c26e9c1a3c7f5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 14:06:31 2010 +0100

    improve type specs

commit 748697a7b73babf6f23d716d7ffd9deedb537465
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 13:54:08 2010 +0100

    cosmetic

commit c631dd6645ca3660e296d1c62d661704f8a675f6
Merge: 73f611ac9 507610f99
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 13:52:33 2010 +0100

    merge default into bug21673

commit 73f611ac92bd6c7a9ad9db55816b3bbf0b7ac8e2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 13:37:54 2010 +0100

    add some msg_status invariants
    these are quite important for understanding much of the code

commit 1a9461e99cda69b05713c62d7ccade6b56cd5394
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 12:59:59 2010 +0100

    cosmetic

commit a5dbf0a0aa13d0868f37fd94e72a1d0434e885e6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 15 10:40:41 2010 +0100

    renamed variables; alligned code

commit b18c0ae4381dff070d569307413d94c89079e137
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 08:53:21 2010 +0100

    cosmetic

commit 54bf86a0fb51fd091a2eb63ee5b6898cdeedb01a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 08:53:04 2010 +0100

    refactor

commit 2c94632fd5e0e370f16d8fc4a445d63f27e40277
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 08:21:54 2010 +0100

    simplify remove_pending_ack
    The pending_ack dict should always be empty at the end. Previously we
    kept the ack records of persistent messages when KeepPersistent=true.

commit bf34fd55f2159c524a37159a7a3d3cd1540f8f93
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 15 07:54:25 2010 +0100

    cosmetic

commit 7549aa28632606b314c4f2371900320a5a18d0d9
Merge: ba2417742 507610f99
Author: Vlad Ionescu <vlad@rabbitmq.com>
Date:   Wed Jul 14 18:28:23 2010 +0100

    merging in from default

commit 507610f99444e187ed7d2c6216d2bbbd0325c138
Merge: b5c07d02b 5b3f0b86b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 14 16:56:52 2010 +0100

    Merged heads

commit 5b3f0b86b561409c98db4125191dca0f80edbdfd
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 14 16:50:47 2010 +0100

    Changelog updates for release 1.8.1

commit a3d42df9d459b1afad4bc03be9ae2d27ef94843f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 14 15:56:28 2010 +0100

    cosmetic: more sensible order

commit b5c07d02bbafcbc011ef803d0979b95c3ac9b931
Merge: 3c753971c 10cf7fbbc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 14 15:53:49 2010 +0100

    Merge bug22875 into default

commit 10cf7fbbcee3ef89b27a4228563c6dad01a4f247
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 14 15:39:15 2010 +0100

    >80 lines fix.

commit 2869d77ab9bbaceaf55234a140f9b1f83f663e67
Merge: 230b71284 78ecc347e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 14 15:35:07 2010 +0100

    merge bug22875 into bug22964

commit 78ecc347eef876669d6e848de787eaf345dd2bcd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 14 14:04:16 2010 +0100

    added insightful comment

commit 230b712847a1dd8ab1c497bee381da701f997166
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 14 12:52:28 2010 +0100

    scope is not set via the -s flag

commit a8fee1bf4a6626e4cc03be8060052e7984202860
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jul 14 12:06:58 2010 +0100

    Added tag rabbitmq_v1_8_1 for changeset 5d9e3ff32dcb

commit c352c9cde25e776aeeb923e0adfc3f89340beaec
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 14 12:03:25 2010 +0100

    added coverage tests

commit 3c753971c2272be4ee93318c003f75133db19535
Merge: c765132fe 354c3731c
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Wed Jul 14 11:59:13 2010 +0100

    bug22914 merged into default

commit 1849d6af7ea940f557a643c30ff67e091a3f863e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 14 10:56:38 2010 +0100

    added a flag to set_permissions to control their scope
    
    set_permissions -check_user_named is the default and checks
    permissions only for user named permissions.  I.e. server generated
    names are not checked.
    
    set_permissions -check_all_resources enables the check for server
    generated names.
    
    I had to shorten the argument names in the man page because otherwise
    the set_permissions line would have exceeded 80 characters.
    
    All parameters passed from rabbit_control to rabbit_access_control are
    binary(), hence why we're passing <<"check_user_name">> rather than
    'check_user_named'.
    
    Rabbit_access_control:set_permissions now takes 6 parameters.  There's
    also a 5 parameter version that sets the default value for Check and
    calls the other one.  I've added it because I don't want the default
    value for Check in 10 different places.

commit 179615f9f68d3aeaa21b7c65278fbd309d58833c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 23:14:20 2010 +0100

    replaced call bad:bad/0 with a call to exit/1

commit d4f80e47089b67f2d9c7d56390e26c8ce06f2fd8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 17:20:12 2010 +0100

    updated man page

commit 74a64a59adc4515f08c7a61034be9ec6bad08210
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 16:10:37 2010 +0100

    fixed compile errors; all tests pass

commit b37863e2838d9e237daa247ae13f1bd46fe8f749
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 15:51:41 2010 +0100

    permission tags are now displayed

commit 4a7811105c3c47658e57061e3661911b883891dc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 15:37:40 2010 +0100

    check_all == 'true' => permissions are checked for server-generated names as well

commit 28123839b89811ee80c0bb6da5fea36830c565b5
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 15:16:45 2010 +0100

    added necessary fields to records

commit 50876ed3a8d0f0ff78809ad748f83a721daf86c8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 13:23:34 2010 +0100

    empty permissions are not printed as "" anymore

commit 7d904109ed65cdfadc7a969a2f2bb4dc0ac46a8d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 10:06:00 2010 +0100

    "" is changed to "^$" when checking permissions
    
    % rabbitmqctl set_permissions guest "" "" ""
    Setting permissions for user "guest" in vhost "/" ...
    ...done.
    
    % rabbitmqctl list_permissions
    Listing permissions in vhost "/" ...
    guest   ""      ""      ""
    ...done.

commit 2e6d37c2920ac6ee80d1c6081e813a47cb56b9b8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 09:51:38 2010 +0100

    empty strings are displayed as ""
    
    % rabbitmqctl list_permissions
    Listing permissions in vhost "/" ...
    guest   ""      ""      ""
    ...done.

commit cae26efb81a9cd1b973bdda48080d3c6d745cbbc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 13 09:38:02 2010 +0100

    corrected regexp
    
    Used character escaping because erlang-mode has problems correctly
    parsing "^$".

commit 36f6cc2b419c17ac880f2c03dfcc7ccbf5a45ec6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 13 08:38:10 2010 +0100

    simplifying refactor

commit 31a3ca38d7da0b3bc04dbe07859e75ea91ff6c4c
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jul 13 03:00:33 2010 +0100

    Adjust the CONFIG_FILE default with the macports prefix

commit 354c3731cfa8fc71d523cfc0753bf9dccbc6fe42
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jul 13 01:49:28 2010 +0100

    Remove IFS setting on the su command
    
    The script has lots of IFS vulnerabilities before it reaches the su
    command.  If we really want to guard against IFS, we should set it at
    the top.  But how many shell scripts have you ever seen that do that?
    If the user sets IFS, and breaks things, it seem reasonable to regard
    that as their problem.  There is no security issue here because you
    should already be root or the rabbitmq user to run the script.

commit d33f188d9423144fc0c743d06cb1992fc277c2ce
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jul 13 01:49:18 2010 +0100

    "make clean" should clean all the macports-generated files

commit 182d83dc772ff5af27c73843bc355b503c71d354
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 12 15:00:45 2010 +0100

    "" is transformed to "$^" in rabbitmqctl set_permissions

commit 4ff838e74360176024305c2101f4fc6b1c09e50b
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 17:51:50 2010 +0100

    Remove maybe_encode_properties

commit 15fe9989cea3c207d69be81e219a88bb28aefa4f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 17:29:19 2010 +0100

    version should come first

commit d382fe392339afb01f6434ca11019b985f33abd1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 17:21:23 2010 +0100

    export protocol/0 type
    to avoid compiler warning

commit e180e09b035d9f92dac45b018e7ee31413c53093
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 17:19:05 2010 +0100

    put the 'none' check back into ensure_content_encoded
    it's safer and more obviously correct that way

commit 9b3784c4c4ae45f145e62b756680ac748b4d06e1
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 14:25:44 2010 +0100

    refactor: extract error helper

commit ff90a4a0698e2682548d922fd6c0cbec178fb2e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 14:14:50 2010 +0100

    don't log content on framing error
    plus some minor refactors and cosmetic changes

commit 215fbbe7d43fcaf9402238a4f5c6867ee15838b9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 13:09:33 2010 +0100

    slight optimisation

commit c765132feb7dabdcb2cd3e30e3ad4150d6f6952c
Merge: 279c8ed54 6a1a950d6
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 9 13:03:10 2010 +0100

    Merged bug22877 into default

commit 6546ca9cc3b7620f8fe67c54be8526e78a736672
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 12:59:30 2010 +0100

    finished transition from regexp to re

commit cdb63918b8ca115269d4cbbefd2d971652057927
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 9 12:55:04 2010 +0100

    0-9-1 error codes in a multi-prococol broker

commit d1c8a30c546c275e46b3de846bbe203e39ade609
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 12:42:19 2010 +0100

    This wiped out rabbit_framing_channel. Never mind.

commit 4133883b371e2aa03a2980a1157511bec5e47ce9
Merge: 367e8b451 279c8ed54
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 12:41:39 2010 +0100

    Merge default into bug22889

commit 367e8b451e056c8425058886a3bf945a74b3e518
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 12:21:59 2010 +0100

    Don't change the signature of ensure_content_decoded.

commit 861991d28252005cf24189f21d7965832da6889e
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 12:11:22 2010 +0100

    replaced regexp with re

commit e0511f50fcc5b84176b656991b6cb55c341669bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 12:00:12 2010 +0100

    Fix idiocy

commit 6a1a950d67d0e831ea20dfb5fcc794e0b7f03f06
Merge: 245f59d74 1a655af08
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 11:58:49 2010 +0100

    merged default into bug22877

commit 86c1934ee3f4a7d6d06472038a20139de9e87e76
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 11:56:47 2010 +0100

    Make sure one does not accidentally build a server containing old rabbit_framing when switching branches.

commit 459ee51cab12da7a45e590ab26fbd98e23108981
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 9 11:56:10 2010 +0100

    Store protocol with encoded properties, use it to transcode if needed.

commit 245f59d740cafae6f8aa0e689c0c2f74c131d177
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 11:03:00 2010 +0100

    deduplicate even the current node

commit dcd2201141fac321f3b2634e3db3b0c9f478e339
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 09:53:54 2010 +0100

    added deduplication of cluster node list
    
    Deduplication happens for both cluster and force_cluster because
    clustering with the same node twice doesn't make sense in either case.

commit c1198829512fe2b27a90c2fd13f021405076a884
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 9 09:29:21 2010 +0100

    improved docs

commit 279c8ed54b8ef1eee5cba54fb90692722e923768
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 9 05:14:17 2010 +0100

    refactor: introduce rabbit_misc:protocol_error/1
    so that the channel can get away with knowing a little bit less about
    error handling

commit 03ab56687cd0f959c5a47906430a6e1182055f05
Merge: ebdd43e4c e9c3652cb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 8 17:23:17 2010 +0100

    Merging bug 22935 into default

commit e9c3652cbac26a80254668dbe8aeec813b3f13e6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 17:14:11 2010 +0100

    amqp_error is a record. Duh.

commit b8c7d7e3d7629b9bc7eeba9c9ec45a556708b493
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 8 16:58:29 2010 +0100

    Expose the persistent count in the vq status

commit e93b8f218dfeb98b668ba89bc9a411fdb6a1e7ae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 16:58:03 2010 +0100

    Fix type of inner_fun, cosmetics.

commit 8fa063bd998c2f03a966c995e3016af22e69bc8d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 8 16:48:58 2010 +0100

    Document ram_index_count

commit 8bfd1a054be9ec05bddf6fc8339a16366cc71876
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 8 15:30:53 2010 +0100

    don't force storing of binary properties
    see also bug 22957.

commit 6b4377154da24d33d1258798171f1201cbe0027b
Merge: a75035108 ebdd43e4c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 8 15:17:27 2010 +0100

    merge default into bug21673

commit ebdd43e4c7c0fc19be9e99e71ae6b6a71a44a771
Merge: 1a655af08 b4f087bc0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 8 15:11:12 2010 +0100

    merge heads

commit 99571554b451a205505265fdcbfb73444deecdb7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 14:05:31 2010 +0100

    Update inner_fun spec.

commit 222ac7445c785f79d3f48b6ff7d06936ef4ebf12
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 14:02:17 2010 +0100

    Make add and delete more symmetrical, tidy up a bit.

commit 682d46fc9c1538c0b25bafdb2ddf4aca18c53833
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 10:55:33 2010 +0100

    Update comment.

commit 137eb1c628eb7d03808962dd4d9db7357fffa34e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 8 10:52:05 2010 +0100

    Wrap much less in try / catch

commit b4f087bc0c2d4ae53d93cc3e2d1b93d182462cf9
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 23:56:58 2010 +0100

    remove incorrect comment
    We actually never decode the properties on recovery (or later) since
    the broker doesn't need them after the initial stages of message
    processing.

commit a750351082950358a41189f7a00dca1c6203a587
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 23:44:36 2010 +0100

    minor refactor

commit 82cead22a08638503c311b854f89cda3446d62d4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 23:16:14 2010 +0100

    cosmetic

commit de12df8853a6ec2ee1511d67e86e6b56a08f121e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 7 17:40:34 2010 +0100

    Unwrap amqp_error and rethrow

commit 1a655af08bf4c820dbc24dbeafa65db0eb4338c0
Merge: 3ea5c8c70 69de56ccc
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jul 7 17:13:11 2010 +0100

    merged bug22950 into default

commit 69de56cccb8a9860f2b9d4e8826915b3d7b87e1a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 7 15:36:23 2010 +0100

    Rename rabbit_reader_queue_collector to rabbit_queue_collector, and shorten some function and variable names.

commit ede95978fcf441bbbe8aae55f65e97f3892c8b9e
Merge: 37b377866 975c06c95
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 14:26:46 2010 +0100

    merge heads

commit 37b3778664a83f5d632a0a73110aa60d55e03e06
Merge: 6978ff64d 5f810eca3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 14:26:20 2010 +0100

    merge bug22896 into bug21673

commit 975c06c95d13d4426d063d59cd266739cc9e2d60
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 14:22:17 2010 +0100

    Bump the msg_store file size limit when testing from 128bytes to 512bytes (normal operational limit is 16MB). This ensures that the GC code is hit

commit 6978ff64d9d952603f5ac3859d65a332eaa4a876
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 14:09:47 2010 +0100

    When pushing β to γ, *always* do the youngest β first as they will stay around the longest and thus have the greatest chance of reducing the number of subsequent βs pushed to γ

commit 5f810eca3ff2ec81a4760e0ad1e3c5ed71711918
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 14:01:32 2010 +0100

    remove redundant heads

commit d66435f6652014c4ae2fd0c7e536c15401c573a2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:45:39 2010 +0100

    Minor typeo

commit 57636ecb35a82f9ff35a69e9637c2b183e044acd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 7 13:44:28 2010 +0100

    More renaming.

commit b5753e0dfe5d998d9d131079508d76df9477f419
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:27:11 2010 +0100

    Correct documentation for variable queue and the chunking of transitions

commit 78b1f8f27b839d746402e8c837961b8642dcd7b2
Merge: 397519aed 7f2f52216
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:15:08 2010 +0100

    Merging bug 21673 into bug 22896

commit 7f2f52216203fb6506f70d39df4ff79d8695b38e
Merge: 1ab7fa38b 3ea5c8c70
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:07:17 2010 +0100

    Merging default into bug 21673

commit 2ce4e01927d1af5425604a9f89df95fb031f46c2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jul 7 13:07:11 2010 +0100

    --allow-overwrite became --allow-accumulate.

commit 3ea5c8c70fd111854e149e4e477c37a2871fb9e8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:06:09 2010 +0100

    Correct some dict() to dict:dictionary() that were missed.

commit 1ab7fa38bcf9dae0056275ed9b77ee14ca633e4f
Merge: f609f086d 39e3bdf99
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 13:01:51 2010 +0100

    Merging default into bug21673 and correcting specs and types

commit 39e3bdf997ac271c30797504624ffcccae3a6796
Merge: 594c76a73 3b9088ff3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 12:29:19 2010 +0100

    Merging bug 21954 onto default

commit 3b9088ff343673699f7fbb340f3587734304de57
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 12:27:37 2010 +0100

    Whoops, forgot to export it

commit 2b983e954501c8b2a77461e7287a9b0637b0605e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 12:19:52 2010 +0100

    Bump use_specs to R13B04 or later

commit 5f0df9e92877e7448b1b738c96e8bc9f69838d4e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 12:12:42 2010 +0100

    Introduced and used ok_or_error2(A,B). Also verified everything seems happy under R13B03

commit 13be763b54558adc422e62994b9a3f30063dbea9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jul 7 11:43:27 2010 +0100

    r2 -> r3.

commit 397519aed69328d69afb51200215e4899d0fde86
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jul 7 11:40:24 2010 +0100

    unify the phase change predicate and phase change operation
    so that the logic for determining the necessity of phase changes is
    kept in one place and cannot diverge.

commit 4f71eaade3615e794f25d58a239b0acde0ad950d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 23:35:07 2010 +0100

    cosmetic

commit 6ccd2026cc2193a772c9669dca1ae49845869cd2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 23:09:47 2010 +0100

    oops

commit 0f8ab46e829954ffbbba436c57be640360a41705
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 19:18:25 2010 +0100

    simplify memory reduction decisions

commit 54c3910fb015e5165b0417eaeb48898823fef41a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 18:31:56 2010 +0100

    And now the channel, writer, limiter and framing_channel are also all suitably supervisored

commit 29cf9fa7bf60c0691a4ba694258114a64fefaeed
Merge: a180a8c1e f609f086d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 17:29:02 2010 +0100

    merge bug21673 into bug22896

commit f609f086d2fc18aa87202ec5f89c7d769c7f91fa
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 17:28:06 2010 +0100

    tiny refactor

commit a180a8c1e56d5c249e16495b914240fa8701b862
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 16:19:36 2010 +0100

    cosmetic

commit 10ae11e5ebd14c39c38c5f2217d1f93e794373d2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 16:12:46 2010 +0100

    Ensure that a supervisor, when attempting to stop a process that turns out to be already stopped with either normal or shutdown, does not winge

commit b8e72a850d90018a1a42ace17a871ed03be109d4
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 16:12:14 2010 +0100

    added test

commit 0615a83e51fc2a981aba84b58ac35d37ce746c06
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 16:09:23 2010 +0100

    Added ability to stop supervisor2, which means children only need to be transient, not permanent, as we're no longer relying on reached_max_restart_intensity to nuke out the supervisor. However, we still don't quite have the error-free shutdown because supervisor still complains if it tries to stop a child and finds the child already dead.

commit 83ba15267b71ed0ffa1a72b3b37ea598a05db837
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 16:05:02 2010 +0100

    cosmetic

commit a7dfc4f8cc57849456911d2d3308e9ab537875d1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 15:59:02 2010 +0100

    all tests now pass

commit 68456e1208017a9a44690955227cd7a6edfd5fed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 15:13:28 2010 +0100

    The heartbeater doesn't need to signal the reader in the event of a timeout - it should just exit abnormally and rely on the supervisor to tear everything down, esp seeing as the reader previously was just throwing the timeout exception.

commit f73504b914a42baf349acbfaebe5a5958a508fcd
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 14:56:32 2010 +0100

    added links inside docs

commit af67e8736822f1c83a0e1ac3703365b439895803
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 14:51:55 2010 +0100

    updated docs and tests

commit ea509739dbcb8caeb301d93100a499276a548970
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 14:43:51 2010 +0100

    Now we have the reader, heartbeaters and queue_collector all under the same connection_supervisor, with one connection_supervisor per connection. Tests pass. The framing_channel, channel, writer and limiter are all still just linked as before, without supervision

commit 7f7593de924911b24514b2ab243fe31f5ba245fb
Merge: 4b5344f40 594c76a73
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 14:33:40 2010 +0100

    merge default into bug21673

commit eb9405616f86571f9f892b46e41d901444975b38
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 14:29:37 2010 +0100

    changed cluster -f to force_cluster

commit a5e69a7578e79946a5c1ef0c39f5aa3f30baf72c
Merge: c261a0f8d 594c76a73
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 13:33:44 2010 +0100

    merged default into bug21954

commit c261a0f8d58595a0279cef5ffb36cce269ebb7be
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 13:28:46 2010 +0100

    include cleanup

commit 4b5344f406c772c1cb677af2a32168aaabe89f69
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 13:27:01 2010 +0100

    add some comments and TODOs

commit e8d2ad810e7b024d254e38a684f5fb244a84326d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 13:16:38 2010 +0100

    cleanup

commit 902ce2edacb1e64c8f48fa6814175eb7b50799be
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 12:35:58 2010 +0100

    removed line at top of rabbit_mnesia.erl

commit 9614267a5dab3f458e0708cc27a0f947c0294c4c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 12:35:30 2010 +0100

    Branch change

commit 7fdfa0192e95de1cef0b068278e92c496a9968b6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 12:35:16 2010 +0100

    dialyzer doesn't support overloaded types

commit dc4c1b3072f7712b6f4c6eaec4f8db5938f9930f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 12:20:56 2010 +0100

    As a first step, get the channel, framing channel, and writer to exit with shutdown, not normal, as shutdown is the correct exit reason for supervised processes. Tests adjusted, and still pass

commit 12a8b8ca2839190e5f83ab86f0c2aa14c5cf59ac
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 12:18:16 2010 +0100

    refactored r types and specs

commit 87837d55fca544c9ea8d413a02ae61fd845739d7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 12:11:24 2010 +0100

    cosmetic

commit 6af02e2807be5700b7f85051d8a7ec8cb794ac29
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 12:01:04 2010 +0100

    cosmetic(ish) - avoid unnecessary thunking
    and some layout fixes

commit 13cd048d50328c0ce4b08bc0b8cfd2485cd4f136
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 11:46:40 2010 +0100

    {'ok', A} -> rabbit_types:ok(A)

commit 594c76a732b82a43b1635ad3e341010f293383b9
Merge: f045edacf 35ca7c600
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 6 11:44:58 2010 +0100

    Merged bug22938 into default.

commit bddcc0ac758cadc2d52f3b0c31790d515add0b41
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 11:31:18 2010 +0100

    {'ok' | error(...)} -> rabbit_types:ok_or_error(...)

commit 2335304e35399fa0a9b2a200489429204c0a23b2
Merge: de3269eeb 867360565
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 10:56:44 2010 +0100

    Merging heads

commit 8673605650985a11c9af424d52b2fb9b388e220e
Merge: 5cca679cd ea69d64c7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 10:55:56 2010 +0100

    merge default into bug21673

commit de3269eeba1bb0efbafa40891cbcb30a7a16c9bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jul 6 10:55:13 2010 +0100

    Forgot to fully initialise qi state.

commit 1dff479dc24af4b411a6acb8c5aca5f21a268bb7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 10:50:28 2010 +0100

    {error, A} -> rabbit_types:error(A)

commit f045edacf7c5dab0cfff860fdfd7b7df2986f65c
Merge: ea69d64c7 f5e51d755
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jul 6 10:41:23 2010 +0100

    Merged bug22908 into default.

commit 46090b481301088c31c373e77534d6e4def64697
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 10:19:21 2010 +0100

    moved all rabbit.hrl types to rabbit_types.erl

commit 747956bfe26e3f79f2134dbb16bf4d7c9b663986
Merge: d3f4271a2 ea69d64c7
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 07:56:17 2010 +0100

    merge default into bug22889

commit ea69d64c7ac832ed15b5d553c8865f5f73bbf0e5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 07:49:24 2010 +0100

    make test_content_framing less dependent on codec internals
    ...and invert assertion, for clarity

commit 81b3f9ffbe058f221e3b9d0aceab328d0079e03b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jul 6 07:37:21 2010 +0100

    fix bugs in tests caught by dialyzer
    these didn't actually cause anything to break

commit 97208c1df58105c825ff459715f842bc49698984
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jul 6 00:22:29 2010 +0100

    moved common types rabbit_types; move net types to rabbit_networking

commit 9a9507b75431227f0c0fae8b4e45d417bc89c659
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 23:39:33 2010 +0100

    moved export_types to inside ifdefs

commit d3f4271a2916df4028c1d2daa614ea955154e78e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 18:46:16 2010 +0100

    Rename unknown protocol to none, fix tests.

commit 5d033df8b6b56507a50f26ab7db0132fe51583ee
Merge: b2283b6c3 cf86b976d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 17:52:16 2010 +0100

    Merge default into bug22889

commit 35ca7c600f23e89839753c94dde4857ff614caf5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jul 5 16:35:15 2010 +0100

    Ensure that after asking the writer to exit, we unlink from it. We're usually in the channel when we ask it to exit anyway, which has trap_exits on, so the selective receive is appropriate. In the erlang client we're in amqp_network_connection, which also has trap_exits on, so it's fine there too. However, the point is to ensure the *writer* isn't destroyed early by the channel exiting too quickly, not the other way around, and without turning on trap_exits in the writer.

commit b2283b6c3e8700ad59e27194cea46adf93c58640
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 15:19:21 2010 +0100

    Use --allow-overwrite

commit 18ea280a3b6b3f70271ea05b8090c2ad6e5ec68a
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 14:18:06 2010 +0100

    added missing export_types

commit 954568f0704c96856c10605b3bb3f68f884ea604
Merge: 807937bc5 cf86b976d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 13:43:56 2010 +0100

    merge default into bug21954

commit f5e51d7557403f53868a26ab530e411dca7dc421
Merge: 5c54bf9e9 cf86b976d
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 13:40:36 2010 +0100

    Merged default into bug22908

commit 558545e182d3df9779afe13e1a44504ca08c0459
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 11:51:36 2010 +0100

    updated man page

commit 807937bc528ef7f449cfce310a9ee75988daa5a8
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 11:35:03 2010 +0100

    cleanup

commit 78e31457cf34bb02b4d66f12d4fdf0e906d6abae
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 10:54:02 2010 +0100

    Fix compilation on R14A.

commit e8d8500de8b553707712ac7673435ad4f9b1041c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jul 5 10:24:29 2010 +0100

    added -f switch to rabbitmqctl cluster

commit cb7992786a1ab6f576e9e55d04b6f5ebce61e84a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jul 5 10:16:15 2010 +0100

    Update protocol format

commit cf86b976d4b0be38c973352e1130ca993b7b01d5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 18:26:57 2010 +0100

    cosmetic

commit 154c5f202b1f3b5c685d9e2c3b765049ad490bdc
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 18:25:36 2010 +0100

    cosmetic

commit 13bf65187a7b429fa5da6e4f037d7c3cc2846446
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 17:59:15 2010 +0100

    Correct spec; correct dependencies.

commit 5ca897a50105d0e5bd40dedca0d7fcca42bb3f11
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 17:55:30 2010 +0100

    This is the default anyway.

commit c65407d34f2f8f9b33a73d6ec3c1e74092a57042
Merge: c0e1669e9 453c140b1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 17:44:09 2010 +0100

    Merged heads

commit c0e1669e9e34f82b43ef4c9713da906faaceebf8
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 17:43:45 2010 +0100

    Get codegen to build Protocol:version().

commit df22ca67e9055b425e30f8cade4989c2ec6bfff2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 17:11:48 2010 +0100

    Remove remaining hard coding of rabbit_framing_amqp_0_9_1 from the codec.

commit 453c140b1c5d219cbf171a8ddfba24af65434645
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 16:26:15 2010 +0100

    cosmetic

commit b12b37d042c71e715d5c12ea99a5d57435aeebdb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 16:22:19 2010 +0100

    oops

commit cc02e78c26074b62bab6441c8a022421e18c6cd6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 16:17:56 2010 +0100

    cosmetic

commit 584e123ba8e72c3bc3ac039f89b6ecbd4b162f72
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 16:11:50 2010 +0100

    improved types

commit b8467461e92481bb23815ea9362895fae2c302b5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 16:03:59 2010 +0100

    Send the right connection.start in 0-8. Amusingly, this doesn't matter for the Java client due to http://hg.rabbitmq.com/rabbitmq-java-client/file/3dfa3f6eb6fd/src/com/rabbitmq/client/impl/Version.java#l95

commit 71a81b6b80bd9e39a0355a8a86d8906053a48be3
Merge: 5c121848c f4b7a1380
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 15:50:45 2010 +0100

    merge default into bug22889

commit f4b7a1380468081f0b5baa58dba0049111df2c5e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 15:47:43 2010 +0100

    cosmetic

commit 2204d90e4aa8ba0c25fe42a8cfcaba0a95709324
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 15:41:11 2010 +0100

    better types

commit 5c121848c1198e270dc8153db57b47833a7d626c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 15:34:46 2010 +0100

    cosmetic: more sensible place for protocol in info items

commit 52af3d70e77a3ab84c7d22e01d324f5dba5c2005
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 15:18:31 2010 +0100

    updated dict() to dict:dictionary()

commit d39aff8867bb26ec690bad6b06430dceddcfdc53
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 15:14:30 2010 +0100

    because inet doesn't export all its types

commit 3e02099c9a37eb1bcbe93a7d898261314e127518
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 15:05:26 2010 +0100

    tweak: don't need protocol_name type

commit 74cc5646ce5b08da068bf261a53dba4bf04b650d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 15:01:15 2010 +0100

    better types

commit a98b9aa64b79a0b536ec806b1811b87cbcd6eb45
Merge: b84cecb52 654ceb7ac
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 14:56:27 2010 +0100

    merge default into bug22889
    and in the process remove yet another hard-coded protocol

commit 654ceb7ac2260ba5fb6b36827764a06ff88568bd
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 14:46:51 2010 +0100

    minor simplification of test
    This isn't quite the same since rabbit_basic:build_content only
    creates decoded properties, but for the test in question that doesn't
    matter.

commit b84cecb52c1175b02a4184b3894a1410aa066467
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 14:25:51 2010 +0100

    Update the names of our JSON files, don't use the 0-8 extensions file.

commit 37a0072ab9740bee7ad39f5be2f45e7a743a5353
Merge: 6b0eb3c6e 2938cfac3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 13:39:04 2010 +0100

    Merge default into bug22889, and remove another hard coded protocol use.

commit 2938cfac31bbb97513d5ae179ca248bfa07a5de3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jul 2 13:34:24 2010 +0100

    minor refactor

commit 6b0eb3c6e6252b134d2168ceacb129b3cd38f8a3
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 13:31:43 2010 +0100

    Oops, missed one.

commit 97e6379b573ac80e25d17587d15474214be78096
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 13:22:49 2010 +0100

    Remove an instance of hard-coding.

commit 6c8ddd2849d7273b886325f1ff24ccad388d4e04
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 13:19:54 2010 +0100

    This clause can indeed go.

commit a9011fca063dc68662c4984cbc4407f8a98c72bd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 13:08:02 2010 +0100

    Remove the rabbit_framing shim, pass around a module name and use that.

commit bc482e7ffcc2cea901419f738ac7cb9db4aa6182
Merge: e404734a6 1a78a06f6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jul 2 12:43:43 2010 +0100

    Merge default into bug22889

commit 69d1c9f6a4cd9ff95b664a60365df0bb77379ccf
Merge: 1a78a06f6 2fe2bef15
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jul 2 12:26:05 2010 +0100

    Merged bug22925 into default

commit a44454c71869a2346c7e7bd8038a711276a11110
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 12:25:30 2010 +0100

    moved most hard-coded types from rabbit_framing

commit d9fa7c5806df89c4432c5618548dea605ba8da22
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 11:55:40 2010 +0100

    fixed compile errors

commit 22d395e11ed73c7932885c43832f9378f30f1d57
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jul 2 11:51:10 2010 +0100

    redistributed all types from rabbit_framing_spec.hrl and rabbit.hrl

commit e404734a6af2f14fb2ac60ca767ff23c136ea6a1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 17:01:28 2010 +0100

    Protocol is negotiated first.

commit 68bd4feb290065793f179e4c66bda898f2f95acb
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 1 16:48:32 2010 +0100

    partially moved types out of rabbit.hrl

commit f7433f82d4024f23bfe38fb450bbdc7bb17a1dd9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 16:42:10 2010 +0100

    Refactor connection negotiation a bit.

commit bd5653a8d7da7c9b1254d1d0fd5925451ce7dabc
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 16:38:41 2010 +0100

    Remove backslash so that IFS gets the intended value in the wrapper script

commit 5030069c63cd9332adee85503095981aadf8c480
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 16:30:38 2010 +0100

    Undo removal of IFS

commit f5d09b3b06fd520a7c9d3e97fce9054074ae0770
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Jul 1 15:55:14 2010 +0100

    Dropped IFS variable from macports wrapper script.

commit bd788673530b385d8ec15922913a4576763a2281
Merge: 22286b8a0 1a78a06f6
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Thu Jul 1 15:54:28 2010 +0100

    Default merged into bug22914

commit d8e24a3bf4a7e0660ba2fd9954825017a6ff8dfd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 15:41:01 2010 +0100

    Protocol is not actually very interesting; take it out of the default list of connection parameters.

commit 1a78a06f6105172dc1b10d8e5dfbf666d993bcaa
Merge: 6737f81df 1e2f98da0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 14:39:11 2010 +0100

    Merging bug22927

commit 6737f81df4bc1bb0a7ed5434b486a10b60627f6e
Merge: 312cb0498 9760d7b73
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 13:59:22 2010 +0100

    Merge bug22911 into default (make srcdist creates README and BUILD)

commit 2fe2bef15f40a0513780e4765db1faad94ac5d6c
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 13:54:32 2010 +0100

    Inline qstats

commit 312cb04986c4dc36f20d87a3d6c34b6472f38a68
Merge: d6ac0a2cf fe7e73419
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 13:48:41 2010 +0100

    Merge bug22910 into default (stage.rabbitmq.com no longer exists)

commit 2680d3dc56845b4fa6a6c72a06f324f119827586
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 1 13:33:19 2010 +0100

    updated file-related specs

commit 1e2f98da0e89578725230a6b9ebf3ea30bc3c333
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 13:29:10 2010 +0100

    Omit the --stringparam option for old versions of xmlto
    
    Version 0.0.18, as included in RHEL5, doesn't support this option.  It
    was introduced in 0.0.19.

commit 25ee567b70a6419437d0c92c9b0fea5665937264
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jul 1 13:17:12 2010 +0100

    Remove stat_all/0, remove queue name from stat.

commit d5d79ac35c706a9a70273725149b718ad5b29041
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 1 13:16:47 2010 +0100

    updated inet-related specs

commit 3e71c3c4fb6be26a68130836d40064ab1517b871
Author: David Wragg <david@rabbitmq.com>
Date:   Thu Jul 1 13:10:38 2010 +0100

    Refine the inclusion of deps.mk

commit 27f2b79982be73e7071848e9ce093abfc89d32e6
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jul 1 12:37:07 2010 +0100

    solved new warnings; now we get the same warnings as with dialyzer 2.2

commit d6ac0a2cf366f8be2c52e60de9632bcc4dcdbb68
Merge: d91cc93d8 f4d79dabf
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jul 1 12:23:01 2010 +0100

    Merging bug 22924 into default

commit f4d79dabfcec5e405e50e7a4565219d2a8fc6d01
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 1 11:59:37 2010 +0100

    move queue equivalence and exclusivity checks into amqqueue module
    ...from the channel, since the latter should have no in-depth
    knowledge what these checks entail.

commit d91cc93d8c0332f699bec19b1da4d844eb8c0641
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 1 11:32:56 2010 +0100

    cosmetic

commit e7c16764d755ec9b8c6d0b15f862eeb4fd091d52
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 1 11:06:09 2010 +0100

    cosmetic: remove trailing whitespace

commit 149b528f306664dbce5de3f46a06ee49b9a7f4cb
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 1 10:43:59 2010 +0100

    recurse with the correct value
    not that it matters

commit eecf51debb0f660384b97f86bfd03354a2e476e6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jul 1 10:43:27 2010 +0100

    cosmetic

commit 493de8971b5c61c138b8cbfc90e3e89bec629b43
Merge: 9e896c4f7 e20219f2a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 17:51:25 2010 +0100

    Merging bug 22918 into default

commit e20219f2a80ba4d242db374d17722f2bb63b67d9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 30 17:38:19 2010 +0100

    Rename no_delete to not_deleted, makes things clearer.

commit 6edd9e70e6eab8817dd802706839375aeb9c3aba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 30 17:21:06 2010 +0100

    Fix auto-delete on unbind.

commit 9e896c4f76311cfd2ef935ee8304bffe5bd730f7
Merge: 2b1ae05e3 f9a2b1554
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 30 14:53:15 2010 +0100

    Merged bug22392 into default

commit 2b1ae05e3a4df0c48f52233bac905fd45efbfb5d
Merge: ce658f9bb 716841165
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 30 13:13:44 2010 +0100

    Merge bug21830 into default

commit 7168411651eae2181ab112762b74da08155c7172
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 12:35:37 2010 +0100

    Refactoring and cosmetics

commit 90ff70a20162ca1c9fd8f20bb16d9c5ed416f682
Merge: 85586512a 5cca679cd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 11:58:20 2010 +0100

    Merging bug21673 into bug22896

commit 5cca679cd5057a1962ef23ddbfb6e98b79b92129
Merge: 8bbcb423f ce658f9bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 11:57:18 2010 +0100

    Merge default into bug 21673

commit 8bbcb423fb6f79cce91f29472d745f0b6e986c8c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 11:56:54 2010 +0100

    tid() -> ets:tid() == able to compile on R14A

commit f9a2b1554f07742c8ff4c8d51f2c61be761db85e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 30 11:46:59 2010 +0100

    As predicted, changing this from sets:from_list/sets:fold to lists:usort/lists:foldl has a decent performance improvement, moving from being able to sustain 8kHz on a topic exchang to 8.5kHz on a topic exchange

commit 22286b8a0a57d345ea5b31eb73be977cdb32fd35
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jun 29 20:29:01 2010 +0100

    Explicitly set all the environment variables that su on Linux would

commit ce658f9bbab8ef4df386b4845a5705a8f0728ff9
Merge: 4216b575a b385b8030
Author: David Wragg <david@rabbitmq.com>
Date:   Tue Jun 29 20:27:45 2010 +0100

    merge bug22882 into default (ssl is even more broken with rabbit in R14A)

commit 887e986ca2fe029eaa8d0ddf30276aa743d9b228
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 29 16:44:03 2010 +0100

    Cosmetic

commit 286919c43f55bda9fd9e5e840ec9dd35adb1c812
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 29 16:40:53 2010 +0100

    Make tests pass again and correct placement of permission check

commit a781e9c0efb9b531d71f73c437ff79e5bb4e58ae
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 29 16:07:32 2010 +0100

    Rework queue declaration to avoid a race condition that could result in incorrect values in the queue.declare_ok

commit 5c54bf9e94bafbf40d7d225471fb31e8492d155c
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jun 29 11:43:01 2010 +0100

    updated error code for re-declaring a queue differently

commit 6716eaa4969a6105d37eeec902bcbb15a1c75d68
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jun 29 09:48:41 2010 +0100

    corrected error codes when re-declaring an exchange

commit 9760d7b731d7e0a0ee64476e33a12cba0f1f665b
Author: Tony Garnock-Jones <tonyg@rabbitmq.com>
Date:   Tue Jun 29 20:11:20 2010 +1200

    Switch from BUILD to README, both for the .in file and for elinks.

commit fe7e73419111d248f18f35d7828d0cff4cbf318f
Author: Tony Garnock-Jones <tonyg@rabbitmq.com>
Date:   Tue Jun 29 20:00:08 2010 +1200

    Switch to www.rabbitmq.com by default (was stage.rabbitmq.com)

commit 7c5a3ecb2e2a71c8e764f961afb1c2b66c369cfe
Author: Tony Garnock-Jones <tonyg@rabbitmq.com>
Date:   Tue Jun 29 16:39:35 2010 +1200

    Rename README.in to BUILD.in

commit 4216b575aa8c9a1350cd06a52a88804e4f14dba7
Merge: 3cbacf027 10e097929
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 28 11:16:49 2010 +0100

    Merged bug21872

commit 10e097929d0e1a0156430db4a4705e4c3b57a5d2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 25 16:56:03 2010 +0100

    Avoid unnecessary mnesia lookup and significantly simplify queue declaration code

commit d67e8c446106168fb387663ac7ff58a5f790b09a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 14:29:41 2010 +0100

    Show protocol in rabbitmqctl list_connections. I *think* this is interesting enough to put in the default list of info items.

commit ecf4739616d100401bbe7738dbf18a689b383303
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 14:11:30 2010 +0100

    Multi-protocol broker. Let joy be unconfined.
    
    The resultant broker passes the entire 0-8 test suite on default. Unfortunately we can't run the full 0-9-1 test suite as that ends up trying to rebuild part of the broker which fails due to rabbitmq-codegen being on the wrong branch. However the Java functional tests all pass bar one; the exception is UnexpectedFrames.testMissingHeader which fails due to different error codes used on default. This will be fixed by bug 22886.

commit 95da785c401e299ece5ac09937ce553182a2472a
Merge: 63dcb6eb0 3cbacf027
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 13:48:53 2010 +0100

    Merged default into bug22885

commit 3cbacf0271930d77e14fcf6fac495c13be504c3d
Merge: 31be1722e a24c0cf5a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 13:01:05 2010 +0100

    Merging heads

commit 31be1722e51d700d8bd8c7e0e6c726bfaf398c72
Merge: 03c206117 70b9783cc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 12:49:08 2010 +0100

    Merging bug22895 into default

commit 85586512a898bd0a2757a586d274e26137d185a8
Merge: 1b5c90084 c3a6ed3d2
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 25 12:47:43 2010 +0100

    Merging bug21673 into bug22896

commit c3a6ed3d284c59b2f313e31b5f7d8a4d9c6dc1ef
Merge: 9b774d7f1 a24c0cf5a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 25 12:47:09 2010 +0100

    Merging default into bug 21673

commit a24c0cf5ad5b4751e840a520ff093693d6830949
Merge: 03c206117 921af2df6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 25 12:19:05 2010 +0100

    Merging bug 22879 onto default

commit 921af2df64e66ad52b8bf71e079313a694d58c3b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 25 12:14:30 2010 +0100

    Simplify logic, plus cosmetics. Both conditionals can now be read as: if we find the eldest of our requirements and the current version, and if that eldest thing is not our requirement then we must have something older, so we take some action

commit 63dcb6eb059686af62c54388beef21af2f9a8219
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 25 12:00:48 2010 +0100

    Replace some stuff I stripped out that's used by the Erlang client.

commit 70b9783ccc3b08940f4a87743fed740031d2a307
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 25 10:17:01 2010 +0100

    Rebase bug21849

commit 9b774d7f15c1571743fde8cd2fbb18cb917d1b84
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 24 19:53:53 2010 +0100

    refactor: don't use module:Fun

commit d26b55fa4ea98356f4301038dc5bd5bef1d97c0b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jun 24 19:50:34 2010 +0100

    blow up if make is to old

commit 1b5c900842fa6845d343fa7856197ae893ac714a
Merge: f5db5e3fa 9e9aa7733
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 17:53:37 2010 +0100

    Merging bug21673 into bug22896

commit 9e9aa7733a67e05ca913d31785fd5395e1112d08
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 17:53:15 2010 +0100

    Glad to see I'm not the only one who's made this mistake: release and remove are two different things

commit a8cc007914d86b098cd4912f6702e7deb214cb59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 17:44:02 2010 +0100

    Don't specify a value for cluster_id and known_hosts, they already have a default of "".

commit f5db5e3fa3f005344b78ac42c046e2dce26f2ab3
Merge: 43ba51419 d51f4ba4e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 17:30:47 2010 +0100

    Merging bug21673 into bug22896

commit d51f4ba4ed5a1e597a3b3742aeb0780e2368725e
Merge: a964c1d5c 03c206117
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 17:29:47 2010 +0100

    Merging default into bug 21673

commit 104c4b99423fc0af7d8ed2f8b2236f21a8b470b6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 17:27:38 2010 +0100

    This is used, by the Erlang client.

commit 43ba51419b344026bcac7ba1c2846fd37a8106c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 17:11:20 2010 +0100

    Corrections to tests, and actually make the needs_idle_timeout logic do something which might reflect what happens when the idle timeout gets called. All the tests pass.

commit b96616fe108a62cd48face19ca216eb1b73a240a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 16:58:11 2010 +0100

    Remove a * that crept in.

commit 54e7807e288b84fc0a574a43bc784a090e2341f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 16:55:14 2010 +0100

    Codegen up two different versions of rabbit_framing and provide a dispatcher to choose. The codegen now builds header files that are the union of 0-8 and 0-9-1.

commit 93a8fe6cf2e16814108a8c5f4c1d62e7a38113ac
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 24 16:52:50 2010 +0100

    Rebase bug21848

commit 03c206117f0879b8f66022edd0acf18eda55dccc
Merge: 5a9571b72 addb87571
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 24 15:31:30 2010 +0100

    merge bug22888 into default

commit addb87571dc82529ad355c1e218cb49c779743a6
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 24 15:31:03 2010 +0100

    tweak error message

commit 454a0b5f0868f9b44abd1e4dec76104b229828ed
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 15:14:34 2010 +0100

    Yup, missed a few more too

commit 9d03553a9768c71a6e7120841d2c355595eb8e19
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 24 15:02:36 2010 +0100

    Whoops, missed one

commit db860cf6087f03170081792065b4f89c7dba7b04
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 24 14:36:19 2010 +0100

    get rid of channel_max checks
    ...until we actually support channel_max settings properly.
    That way we avoid dead code / unused var warnings from the compiler

commit 91aee115be7cfbff56ada0bfe979ce7598325875
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 13:36:42 2010 +0100

    Don't pull protocol version from the JSON.

commit 8dcc9c5f50b4c470c37ad93a0745e85355946ad6
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 13:17:53 2010 +0100

    Rename protocol constant.

commit 47a902d81151a201ca44ef02992fa5ed7c2a7360
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 13:01:40 2010 +0100

    This is clearly driving me insane. channel.tune-ok does not exist, even in 0-9.
    (And this was not caught by tests since our Java client seems happy with either version of open-ok, but we shouldn't count on that.)

commit f8ece9ffd114abe663e7f9bb76ac5cbfdffdfc08
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 12:55:50 2010 +0100

    Add protocol to reader and writer state, and pass it around in enough places to let us switch based on protocol. Remove a couple of unused exports while we're there.

commit 29c0652d733d148239f7dc25bd35f36133b12c5d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 24 12:25:16 2010 +0100

    shut up compiler

commit b21fd7fac3c80b1f5837feb1005c91de90fe53cf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 11:29:34 2010 +0100

    Use ~w rather than ~p.

commit 1e6d343efdd7fd3de0cc6a48ed84d70f22b2b4ad
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 24 11:24:00 2010 +0100

    Handle 0-8 channel.tune-ok.

commit 29c67607331e9c0c781c81249c174e1c045b47f8
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 23 19:01:59 2010 +0100

    Chunk up work to do when converting α to β. Unfortunately this violates one of the invariants (Q1 or Q2 or Q4) -> ¬(TargetRamMsgCount > 0) because it might be ==0 but the work is still in progress. I prefer relaxing the invariant over requiring a "big push" once we get to 0. Some of the tests now don't pass as they assume certain values for δ - this should be fixable.

commit 41f7db4c3d5da75bd401b62c22175fa13de2cbea
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 17:09:50 2010 +0100

    Fix up connection.close/ok and basic consume. I think we're now talking real AMQP 0-8.

commit 614c62f5ec9ab880e3438f17e5e843d4d5cf9bef
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 16:15:11 2010 +0100

    Use the new merged JSON for codegen, stripping out redirect and trace frame support on the way. This results in a broker which doesn't quite speak 0-8 as it gets connection.close wrong.

commit b385b803079282c5b7e69f82fa8ec54908cf798f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 23 16:13:33 2010 +0100

    ssl works again

commit 37705d576f72b5dbab9527b9ed20352ea3e9c381
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 12:23:53 2010 +0100

    Argh.

commit 0fbab77169fd1b54f34269a71c81277f2079c4a5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 12:22:42 2010 +0100

    I think this logic finally makes sense.

commit a964c1d5cb2a40515bff14e4d4aa93b9ea55c420
Merge: 09c3e3d41 5a052e30b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 23 12:15:23 2010 +0100

    Merging heads

commit 09c3e3d41249d37dda5493e348ec1d9d1e46abcc
Merge: 5d403c081 2049d6665
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 23 12:14:45 2010 +0100

    Merging default into bug21673 so that it builds again...

commit 301dadc0a1f9d79b431546796cac9139d9db2c23
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 23 12:06:45 2010 +0100

    added support for make-3.80 (and a deprecation warning)

commit 92127450995d66e2ba90aea45b967c33982786d2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 11:44:37 2010 +0100

    Reinstate channel_max check.

commit bbf0194ae40193970d34e849419dcdaabb071ecc
Merge: 93d3d6f00 2049d6665
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 11:28:07 2010 +0100

    Merge default into bug 22888

commit 5a9571b723e33526b424d50914b6acaddd4c7956
Merge: 2049d6665 def4803ae
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 23 11:16:51 2010 +0100

    Merged bug21845 into default

commit 93d3d6f008beb28b083723a538ed28576004e144
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 11:16:20 2010 +0100

    Remove commented out code to enforce CHANNEL_MAX, we don't care.

commit d24a40497b3e0a01f5656de8e3ab4ad18f0a32f2
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 23 11:12:40 2010 +0100

    Cosmetics

commit 5a052e30baf440b0b7bab1b0f8697f944dc9d36b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 18:56:00 2010 +0100

    cosmetic

commit a12b6fc42d414800352f4538a55d9e116b43f9b2
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 18:55:07 2010 +0100

    make beta->gamma conversion part of general memory reduction scheme
    While it doesn't reduce memory itself, it is still part of the overall
    memory reduction logic.
    This allows us to cleanly separate the beta->gamma conversion from the
    major phase changes.

commit 94d5c4ec874b806fccacc5ffe12d10cc7245a633
Merge: 1de614dfa 34bf47a1b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 18:18:28 2010 +0100

    Merging bug 22867 onto amqp0_9_1

commit 7756a7ca0510446b1d95d2b14d1c4d89688f3bf9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 18:17:49 2010 +0100

    Make error messages terser.

commit bec07b9dda4770e4c5a98057856b1469738ba403
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 18:09:50 2010 +0100

    Or maybe we do want a protocol_error, but let's use a real one.

commit 916539f31d540596fa919fc246331435de46301b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 18:03:11 2010 +0100

    cosmetic

commit 5c7936831d25fb5ad2cb0afce2a31311a54e2779
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 17:49:54 2010 +0100

    Don't use protocol_error as we will not send one and mistuned does not exist anyway.

commit 2049d666556fb9cddea24bec32e3170b309d988f
Merge: 10829f72c 429f09d87
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 22 17:29:33 2010 +0100

    Merged bug22864 into default

commit 5d403c0812caeb05b241fe2e72b430968cd49296
Merge: 68d74c993 dc60ef5fb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 17:11:00 2010 +0100

    Merging heads

commit 68d74c9937912c3ea1a380548422b593ccb871e7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 17:10:40 2010 +0100

    Improve code coverage further

commit dc60ef5fb3780d432873c21c3e0e14e21b265f09
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 16:41:10 2010 +0100

    optimisation: don't call reduce_memory_use quite so often
    specififcally, on requeue and tx_commit_index only call it once at the
    end rather than for every single message.

commit 10829f72c43e8f07b5e08916d6a4bd67a6ca9141
Merge: 78bb3b119 d34f20f24
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jun 22 16:39:19 2010 +0100

    merged bug22874 into default (ToC links on online man pages do not work)

commit 720ac1d35ce1bc21bcdfb70a13cfe3999ee08c1e
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 16:04:59 2010 +0100

    Still at 95.5% but less overloaded

commit 274625e3e19d7c3c404318be92054599636694f6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 15:34:11 2010 +0100

    Remove meaningless assertion

commit ee9c2828a73edaa1d84d1415b4a3601b1d3834a0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 15:33:41 2010 +0100

    Move frame_max handling from amqp_0_9_1 to soemthing branched from default.

commit 73dfa4367eb2007c1fdd70a57d653767427a7ad6
Merge: f92f8c0a2 aa5ca5a9c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 15:31:37 2010 +0100

    Merging heads

commit f92f8c0a212bdce8377b05fdd26206f1b7156516
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 22 15:31:11 2010 +0100

    Further code coverage improvements. Up to 96.52% on VQ

commit 34bf47a1bce50deb54cfeb908920cc19bf61c04e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 15:00:42 2010 +0100

    Fix >80 columns

commit aa5ca5a9c89a8ed5db29bcad59de79cbcafa396c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 14:31:30 2010 +0100

    refactor: simplify maybe_push_q{1,4}_to_betas

commit 1de614dfa220ca8c90a1e9385dc516f517b00c9e
Merge: 368aacd1b 78bb3b119
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 22 13:45:43 2010 +0100

    Merge default into amqp_0_9_1

commit fafcc3051120e22f610726b1ea0739be18681c78
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 13:32:06 2010 +0100

    massivly simplify variable_queue:publish
    Rather than trying to figure out which of q{1-4} or delta a message
    should go into, we make a straightforward decision to stuff it into
    either q1 or q4 and then use the existing logic for dealing with
    memory pressure to shuffle it to the right place.

commit f1f88f65323d694ea68366fd8b0dfe3f42b84a61
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 11:53:18 2010 +0100

    refactor: simplify limit_ram_index

commit 2993e75072b5ba8921d79367bcd8a446a5416f1b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 22 09:08:47 2010 +0100

    add some more variable_queue state invariant checks

commit 36661f2e27f44a9c08fdaf07dc1225297458f191
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 21 18:05:49 2010 +0100

    Improving test coverage of VQ

commit 9ee6d80c13ed614901fca989bfeb78eb475e594c
Merge: 4acc3d914 fc839abbc
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 21 17:42:33 2010 +0100

    Merged bug 21848 into amqp_0_9_1

commit c7af8e11b27a82187b8525fa441e9be42873469b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 21 17:16:37 2010 +0100

    remove redundant conditions and assertions
    ...already covered by state invariant

commit 571c002220ae2c0422f121088e4f16fc8f9ad280
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 21 16:40:11 2010 +0100

    Apparently this is better

commit 9f15075dbfbef16537ba8a7c47e737f2ff2b749a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 21 16:38:15 2010 +0100

    Ensure that this macro doesn't accidentally cause unification with variables in scope

commit 7d362473fc22c662cde3e7853ca3bcff3979ab4d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 21 15:40:33 2010 +0100

    change queue_index:read API
    ...to read exactly the messages within the specified bounds, rather
    than just up to next segment boundary. This API is cleaner and means
    we no longer rely on a hidden invariant in variable_queue.

commit 1eff3e2269f589872a081d03c9491eb93e6d9e11
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 21 15:36:32 2010 +0100

    Renumbering of variables

commit 78bb3b1190c21b1736e9192475c2068d81d6aa40
Merge: 5345308f8 37cc9c345
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 21 14:00:01 2010 +0100

    Merged bug 22767 into default.

commit 37cc9c3454755c8543e9dbe73151f6771fef8820
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 21 13:59:24 2010 +0100

    Cosmetics

commit 5345308f802e1b1f8ca8e75289fa98d8b9bba655
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Mon Jun 21 13:40:15 2010 +0100

    Macports portfile, let's not repeat port:erlang twice.

commit 4acc3d91479106f0c7158705023f8b0f0bd884ac
Merge: 368aacd1b 12afce708
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 21 13:27:42 2010 +0100

    Merge bug 21849

commit d34f20f243c1392a1a852841c4505665cf8f3b9e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 21 12:19:52 2010 +0100

    This may be more robust in the face of docbook weirdness. At least it forces the anchors to be exactly what's visible on screen.

commit 04b880f1712502c8b4a4383ff4f7b05d2f5ffa2b
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Mon Jun 21 10:47:37 2010 +0100

    Make use of 0.9.1 error constants

commit 608aced406cbb2f64e692d4e8eb5137d15560da5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 19 10:46:25 2010 +0100

    don't unify on function results that just happen to be side-effect free

commit 9c333ee78860c47620971d54aa443b412ffd0071
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 19:47:45 2010 +0100

    cosmetic

commit b39d55b09b96e3f45732d7d1dfa2853d6846582b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 19:43:01 2010 +0100

    a little bit of inlining

commit f05592fc3f4821f57f505de0582b8b27625f639a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 19:30:38 2010 +0100

    yet more refactoring of push_betas_to_deltas
    finally make the q2 and q3 processing use the same code

commit 12afce7089cdbd60a3ae52d7fcc9617019bafe85
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jun 18 17:29:18 2010 +0100

    updated comments

commit 82e0ad06425e2ed16bcc8b2e0c7c472626faef2f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 17:27:50 2010 +0100

    refactor push_betas_to_deltas even further
    making the handling of Q2 and Q3 even more similar

commit 8f124ae4c1fb62baa0336a32eae43005d4fc4a85
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 17:08:55 2010 +0100

    refactor push_betas_to_deltas
    to make the similarity of the treatment of Q2 and Q3 more obvious

commit 8b2008b3a6fdf6b2110abd582b6ee64d99a370b0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 14:51:04 2010 +0100

    cosmetic

commit 19a44edbfa9f59e6ce944e08bcac232ffd31eca7
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 18 13:54:13 2010 +0100

    Guarantee that we're only reading max one segment when we load in from δ to q3(β)

commit 9f61337d1a4cd6f2d371f32c4db821d67362f620
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 18 13:29:14 2010 +0100

    sanitise ram_duration and target_duration_count so they don't have to both cope with being all of infinity, undefined and a number.

commit def4803ae6df2a23ed9d9dcdd27c0e315d4fd3c5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 18 13:23:37 2010 +0100

    Rebalance blank lines

commit 7d7b49a3e4c61f74c3431398964f751beec06a1f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Fri Jun 18 13:19:43 2010 +0100

    Permit basic.recover on a transactional channel.

commit 0e01ca40fab1b62eb55687c42b9a2ab35903ee0d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 18 12:59:30 2010 +0100

    cosmetic

commit d4251f5c0014be4a268bef5eab98f924305f85b3
Merge: a18973391 037caf0dc
Author: Marek Majkowski <marek@rabbitmq.net>
Date:   Fri Jun 18 11:29:49 2010 +0000

    Merged bug18062 into default (macports stuff)

commit 037caf0dc29a3f1b965a1c72727b299cee38c743
Merge: 2a07023aa e1e41b2dd
Author: Marek Majkowski <marek@rabbitmq.net>
Date:   Fri Jun 18 11:04:45 2010 +0000

    rabbitmq_v1_8_0 merged into bug18062

commit a189733917b84c08ffc8d0069f7e1f6c7fafbaad
Merge: 04c98fd4f 3eeff7e5d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 12:00:15 2010 +0100

    merge bug22871 into default
    that change wasn't really meant to be on that branch, but it's harmless.

commit 3eeff7e5d816afcca9c0b23244f235db1eb3c2ce
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 11:57:37 2010 +0100

    correct some specs - ram durations can be 'infinity'

commit f1b10de2a5c2ca6c5665c390ea27c323b47c756d
Merge: 46e7d37b1 04c98fd4f
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 18 11:34:53 2010 +0100

    Merging default into bug21673

commit 04c98fd4fae7205955463c7178c06b3e328e86a2
Merge: e031cb9b8 d47b286ac
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 18 11:34:25 2010 +0100

    Merging bug 22871 to default

commit d47b286ac8fdceb7270af4bec6589feafdb163ef
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 11:30:10 2010 +0100

    fix syntax error that prevented compilation under Erlang/OTP R14A

commit 46e7d37b131c7d076aeaf1cbf85a32d095ad9925
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Fri Jun 18 10:22:58 2010 +0100

    slight tidying up of permitted_ram_index_count

commit 8bb31dbe6384aeadd3c5ffdd897b88b99778564f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 17 18:35:22 2010 +0100

    correct comment

commit d2c67b9fb4f9cbaa884fc05657bb9d6c9ee70c41
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 17 18:22:00 2010 +0100

    cosmetic

commit 9fcc68170a6545990a00145ca26f3423fccb5d60
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 18:12:05 2010 +0100

    delete1 is not needed and never called

commit 230cb6a611d88ba80d510be5ed759345ba741aad
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 17:46:01 2010 +0100

    Reduce msg store file size limit and queue index journal size temporarily whilst running intensive tests

commit 1bdc38f8076bdbda5bee5b96433c666c8554d869
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 17:28:34 2010 +0100

    Make the queue_index max_journal_entry_count configurable

commit cb148d3f4da962a2e9a205b70c34d313d5f62482
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 17:12:58 2010 +0100

    Fix msg_file scan block size at 4MB

commit a976be13513623ede58ba24263b80917078b052d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 16:34:19 2010 +0100

    Expose the msg_store file size limit to configuration. Also some suitable derivisions in tests.

commit 3d4e3704f0547bc90ac0561418899dd98bdd2148
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 15:02:29 2010 +0100

    Added test to invoke the queue index walker

commit c651b112e4813147bbbf17297057b9f8e6309749
Merge: db18287dd eabe30f8d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 13:12:44 2010 +0100

    Mergin' heads

commit db18287dd0f59c553314a189cdc6d87d14320d1d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 17 13:12:27 2010 +0100

    Removed unenforced redundancy in function args

commit 429f09d8779f81e219dd534087f4ef7292f6b199
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 17 13:05:52 2010 +0100

    Put all our extensions in one file.

commit 3ef6f74e28da0ac88b1ff08d4b851eac57fc7473
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 17 12:58:43 2010 +0100

    Move synchronous basic recover to the 0-8 broker.

commit eabe30f8d88af2c2cbcbe3202b0ae2bee1c1da0c
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 17 12:53:07 2010 +0100

    rename betas_from_segment_entries and make it more efficient
    ...by exploiting the ability of queue_index:{deliver,ack} to take
    multiple SeqIds

commit 246260869c0703a6b1a98f052eeb252b9885cd27
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 17 12:29:11 2010 +0100

    make queue_index:deliver take a list of SeqIds
    ...rather than just a single SeqId. This brings it in line with 'ack',
    simplifies the code, and is useful in variable_queue.

commit 2bf4f4559bca46f10df81cc0a06503e4b80ae203
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Thu Jun 17 10:33:00 2010 +0100

    get rid of vq:read_one_index_segment
    The purpose of the function was to keep reading until either some
    data was found or the end was reached. However, both call sites
    contain loops already that effectively do the same, making the
    function redundant.
    
    There is also a small tweak to the qi:read API - it now returns the
    "next seq id to read". Previously it was returning 'undefined' when
    the requested (exclusive) End was inside the same segment as the
    Start, so now we simply return that End in that case.

commit 368aacd1b838775a2e8170fdfb8480b6b9d84fcd
Merge: 2adbfa30d a7403ea13
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed Jun 16 18:41:28 2010 +0100

    Merged bug21835 into amqp_0_9_1

commit 89b87729658e09af5891e39f655bd3df62e6af7e
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 17:53:26 2010 +0100

    rename

commit c8d70271150f9fc3e99cd5ac745fa50886d91f6a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 16 17:52:42 2010 +0100

    Revert exchange auto-delete removal, and tidy up a couple of whitespace diffs from default.

commit e031cb9b8303d66401dc56eab8bd45a5f9b9e452
Merge: 1c95e3708 33f5df0c9
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 16 15:40:27 2010 +0100

    Merged heads

commit 1c95e37084f031036191dab792c82c8599bd477f
Merge: 79f8803b4 9d18532b0
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 16 15:39:36 2010 +0100

    Merged bug 22597

commit 33f5df0c919a6880b59bd0640f801ceb8ab32a3b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 16 15:38:29 2010 +0100

    Added tag rabbitmq_v1_8_0 for changeset 81694676ea97

commit e1e41b2ddc8e973e4efb6e0bd62ef742a708a6dd
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 16 15:36:55 2010 +0100

    v1.8.0 release deb and rpm changelogs

commit d7935cdb7d5cd9ccfe3c71d3aef2d0bbe7c73077
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 15:35:40 2010 +0100

    refactor: invert condition to make it easier to read

commit f0d0ce48288390c4550dddb8618d0735ed5e4553
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 15:24:59 2010 +0100

    minor refactor

commit 64702bceb77392ed58979a0405801d3499f92e50
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 15:12:14 2010 +0100

    cosmetic

commit fc839abbcdb4e6b0f3f95a31df2deca51be447f7
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 16 13:28:39 2010 +0100

    simplified Channel.Close code

commit 17c42d6aad97aacc4e62e15d27bc394c76e2be9d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 16 13:07:52 2010 +0100

    server implements 0.9.1 connection shutdown protocol

commit e76bd79ffd2a0a3d5232a94bd47af9f444fcc390
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 08:38:34 2010 +0100

    restructure 'purge' in order to make its operation more obvious

commit a8644df219e9742f524dd0269d3d060aa4a84459
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 08:17:54 2010 +0100

    simplify 'purge'
    it doesn't need to compute the Count since we already know it

commit 901ac3e5c569793a2ffa6eec70faed0276a08a09
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 16 08:01:53 2010 +0100

    cosmetic

commit 0743b3186d58067b7861132305e346b775b71eda
Merge: 0e421723c 90c6ec6c3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 15 18:59:49 2010 +0100

    Merging heads

commit 0e421723c045973a31de184de4cd22f21cb0f325
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 15 18:59:39 2010 +0100

    Improved test coverage of the queue index walker

commit 90c6ec6c3fa27ad5f1c62db61aa4923b6c5ea5a4
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 15 18:40:20 2010 +0100

    assert vq state invariants
    as a post condition on all exported functions

commit a7403ea13bdcfe04bb6f8158928027bc9a1cdcaf
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 15 18:20:37 2010 +0100

    Send unexpected_frame if we get the wrong frame type or mismatched class ids.

commit 74f5c9ca871208523454fbd3be5def4cc21a98c9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 15 16:08:13 2010 +0100

    Good lord, how did that get through?

commit 2adbfa30d8f58d9c66f0bb3259af775f1dd6d353
Merge: 916e35763 79f8803b4
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Tue Jun 15 15:01:11 2010 +0100

    Merged default into amqp_0_9_1

commit c984186f18facb467d28f49dfdf7b3afc17090b1
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Tue Jun 15 14:28:38 2010 +0100

    server implements 0.9.1 channel shutdown protocol

commit e359e2e2218e51cde1ae93b524136f121b89007f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 15 08:29:55 2010 +0100

    cosmetic

commit 8fddb286e59038dcfa4bb7a76e533676c6bd731f
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 15 06:43:14 2010 +0100

    minor refactor

commit 4cbebceb0e5efd6591cd2f8fe07e6cacb31fcc6a
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 15 06:33:04 2010 +0100

    tweak: trust our own code a bit more

commit ccb2835c505c3f8be0ea7c7f8e2884de55b96208
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Tue Jun 15 06:02:50 2010 +0100

    minor refactor: rename function

commit 36e971a26173b2436f435ce91cf68a642dcaee8c
Merge: e57e0c2b0 79f8803b4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 14 19:02:39 2010 +0100

    Merging default into bug 21673

commit e57e0c2b07a0be43bddbbcbd524ca3ad3ca95373
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 14 18:42:55 2010 +0100

    Very important cosmetic fix

commit 79f8803b480cab6974c6f212e3644a8f0893596b
Merge: 11150fac8 c428a0b69
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 14 15:36:28 2010 +0100

    Merged bug 21842.

commit c428a0b691c5baa76d7862921f9e7119741a1842
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 14 15:17:38 2010 +0100

    restart bug21842 off default

commit 11150fac886584c2c6ac8fc45c088c5a1ffdfcca
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 14 12:32:11 2010 +0100

    Clarify comment.

commit 416d9968ba498d0b50751b4a0995f383cae34d70
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 14 10:05:52 2010 +0100

    refactor: inline {publish,ack}_in_tx

commit ccca12049ade4f11602ec71a30459e315f4b15ab
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 14 09:46:00 2010 +0100

    minor refactor

commit 0a53cb9c40c220fd173a100e99b763ce1cd2cf8d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 14 09:22:02 2010 +0100

    refactor: rename and simplify test_keep_msg_in_ram

commit 872e74eb90f2d001ae2e4e92f981dc6b6cb2a6a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 14 08:43:26 2010 +0100

    cosmetic: more sensible ordering of state components
    essential vars first, followed by derived vars and counters/rates/etc

commit b402675bad2927026351612494016545f2d6893d
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sun Jun 13 14:47:17 2010 +0100

    minor refactor

commit 35d254959611009178bab681699398957fbd7917
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 16:53:19 2010 +0100

    refactor: extract accumulation of SeqIds and Guids from acks

commit 40dfa16cd0d264831c74707260ccd4cfe61b35e0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 16:51:57 2010 +0100

    refactor: simplify 'fetch'

commit 4aef6d9c6bafc0eb9a99d0abc93a065218342daf
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 14:03:40 2010 +0100

    refactor: extract conditional calls to qi:deliver

commit 004227b1286f0811f3582a810973bd46e25dc6c5
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 13:38:14 2010 +0100

    refactor: extract #msg_status initialisation

commit 267192debdade3bea25e50cf9e74efa8ee3a2337
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 12:56:04 2010 +0100

    refactor: simplify publish_delivered
    - extract recoding of pending acks
    - use maybe_write_to_disk

commit 0fcd1609386fb7b487e00173099d23a118e616b3
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 08:39:35 2010 +0100

    refactor: extract similarities between ack and requeue

commit 6a7530bc79e343a7a06b6d822256e8810e05bf1b
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 07:39:05 2010 +0100

    refactor: make 'ack' and 'requeue' look very similar indeed
    ...prior to combining them

commit e4dc30e15eca767d8b9c256351c5ebe074b72251
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Sat Jun 12 06:55:14 2010 +0100

    fix small persistent_count counting bug
    ...which doesn't actually matter since it would only result in the
    persistent_count of transient queues being wrong, which get nuked on
    startup anyway (the only place that makes use of the persistent_count).

commit 47fd76339d10ce82c431dcbd1293bd9eb2d8cbfc
Merge: 5f5050dcb 0c0cad2e0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 11 14:47:58 2010 +0100

    Merging bug 18524 onto default

commit 5f5050dcb6260436cc0120e5ec47ffd5eeeeb4e3
Merge: 81b61da3e abc38b911
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 11 12:43:56 2010 +0100

    Merge heads

commit abc38b91168f56d99a9f1cd2aa63c100ad75f029
Merge: 1d0e0153c 2bf8cf657
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Fri Jun 11 12:42:28 2010 +0100

    Merged bug21846 into default

commit 0c0cad2e0c1a7e8be813128e1faf364f60d3ef02
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jun 11 12:10:41 2010 +0100

    removed unnecessary ifdefs

commit 81b61da3e46159646c494216f8be3bfeb357e880
Merge: 1d0e0153c 9c629d1c0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri Jun 11 11:18:18 2010 +0100

    Merging bug 22847 onto default

commit 9d18532b053ce463a6db33c8559097278e8f87ec
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jun 11 10:31:00 2010 +0100

    moved common spec to rabbit.hrl; rewrote status code

commit ec874df3e7eebf632f48e8f05680c98d87d97ecf
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Fri Jun 11 06:54:14 2010 +0100

    ifdefs surround ALL the specs

commit 1d0e0153cbef324231783644b4293d2d9b7904ad
Merge: 3582902a3 fe67b2947
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 18:35:39 2010 +0100

    Merging bug 22848 onto default

commit fe67b2947582180d8022947488bd80b9a746a2ec
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 10 18:13:45 2010 +0100

    Use precondition_failed for equivalence failure.

commit 9c629d1c0698e38f0ab90675ee3692d27339068a
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 10 17:48:04 2010 +0100

    Don't reply after replying.

commit 79b54e87e99c3fce9da8251c77e2e1859139033f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 10 17:35:37 2010 +0100

    Cosmetic.

commit 5c2b7377d268e53e28bb9198b679cb3335624e6f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 10 17:35:28 2010 +0100

    Use unification rather than when clause. Also remove separate assert_type as it's buying us very little.

commit 7ea93a06f86a9e970901c40213f82d92d737d466
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Thu Jun 10 17:34:39 2010 +0100

    Add spec for assert_args_equivalence/2 for plugins.

commit 3582902a33944fcf0ae4c014e59b9318929779de
Merge: b194ea119 7c6aaa312
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 16:56:04 2010 +0100

    Merging bug 20153 onto default

commit 7c6aaa312d34f462014b69fbf69598afb1251944
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 14:17:40 2010 +0100

    Remove a HOSTNAME which should have been removed already...

commit b194ea1198fc93d892cfbe014f0b92db0c999fee
Merge: 546cac102 8c5dab3fa
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 14:03:26 2010 +0100

    Merging bug 22850 onto default

commit 8c5dab3fa0db0dabe3b6ad09cc12c2dc6c4d64b1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 14:01:31 2010 +0100

    Fix testing for variables so that you get as many errors as possible at the same time. This solves the very annoying problem of a build dying for some reason, then you fix the reason, build again, and end up with a very slightly different error at the same point.

commit fde8a552d689c78ac3ec3d57a5f4835b3f059249
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 13:39:55 2010 +0100

    Avoid very strange weird side effecting dependency thingy

commit cb09a100711be74fa6d7dc9cee275147289ec1eb
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 10 13:24:31 2010 +0100

    Make nodename available to rabbitmq-env in startup scripts

commit 546cac102b654f2a1c7664bc5a0c2f661facc1c8
Merge: 1a665a9fd 9b7e614a1
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 12:54:51 2010 +0100

    Merging bug 22833 onto default

commit 9b7e614a1e01a4b5807599d2ac03450b891526a5
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu Jun 10 12:50:49 2010 +0100

    Convert all tabs to spaces

commit 5e209eabc1abdf937d7d4759977f6d6d4b7e3a54
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Thu Jun 10 12:45:51 2010 +0100

    fixed crash when rabbit:status/0 called after rabbit was stopped

commit 1a665a9fde78c20d7bd2aefe287234471c5b0d26
Merge: 76dacbbe9 cb62e2ca3
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 10 12:43:47 2010 +0100

    Merged bug22771 into default

commit f634ec37692ba97eb445b944bc08927d9071beaa
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu Jun 10 12:03:26 2010 +0100

    Use hostnames in node names

commit 768a4385ae6ca68f6adaea1c93ffa7f689c16e4f
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 9 16:27:57 2010 +0100

    Make assert_args_equivalence overridable by exchange plugins.

commit cb62e2ca3edf74c81e4dd9e1b31b56a5ec1a56a7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 9 14:49:05 2010 +0100

    Use the error code as specified by 0-9-1.

commit ffd25861078925bf75a1e3a7a4401369d6272284
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 14:15:51 2010 +0100

    fixed specs

commit db003d71517a2d093656517691a4bce691b086fd
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 9 14:11:14 2010 +0100

    might as well do the reply first thing, before the case.

commit be0c8e1da79e2ddc98cd18d08902012438b77952
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 9 13:19:23 2010 +0100

    Move exchange and queue equivalence semantics from amqp_0_9_1 to default

commit 55df709438e322c7079df43bd8355e6e547a7331
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 12:57:27 2010 +0100

    merged Florian's 10th patch: replace sleep 2 with sleep 1
    
    OCF resource agent: replace "sleep 2" with "sleep 1"
    
    We want to complete operations as quickly as possible, and whether we
    check the server's status every 2 seconds or every 1 second makes
    hardly any difference to Pacemaker.

commit 1132c6874c99e8a1ba74827e9ec2084716d593d9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 12:54:50 2010 +0100

    cosmetic

commit 091127c82093fa418c55ada8c5c0c244df9390a0
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Wed Jun 9 12:41:46 2010 +0100

    complain about missing env vars in the right place
    especially before trying to use them

commit 39695c5bbd3379cdbc1479fe0a0856b20cf99b24
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 12:37:58 2010 +0100

    enclosed generated specs in -ifdefs

commit 3110b6a90282867f78a6bbc3ce3575ae72c330f9
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 12:27:45 2010 +0100

    spaces instead of tabs in autogenerated code

commit ac1d667b939c8baf0c0f224457b064cdf478d71d
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Wed Jun 9 12:17:43 2010 +0100

    removed duplicated code

commit 230a4dc9cc263d85b8bac62a475849262abf1ae1
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed Jun 9 11:56:29 2010 +0100

    Move synchronous amqqueue:requeue/3 from amqp_0_9_1 to default

commit 2bf8cf6574d765ee1e185fa4d77da3c57d10c2b7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 18:01:22 2010 +0100

    Remove unused variable.

commit c47df9f4b2bc022648d2f8be727d21f3c28106ce
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 17:50:03 2010 +0100

    Prevent the same delivery tag being used more than once.
    
    Note that we change from command_invalid to not_found as the former is a
    connection error, and the latter a channel error. Both 0-8 and 0-9-1 specify
    a channel error.

commit 76dacbbe97589bece750a63a8596852079cc7ac0
Merge: d34c1a4c3 0b8c95b29
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 8 16:39:26 2010 +0100

    Merging bug 21841 onto default

commit 9bc9ceb9c3ea48d59c9323a1cfe1edc3d3abaae5
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 14:48:44 2010 +0100

    Start bug22597 again.

commit 0b8c95b29663487760c7cf27f3bb7f8f40fc1732
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 14:46:40 2010 +0100

    Permit binding of durable queues to transient exchanges

commit d34c1a4c348b2a208efe32c6a6f76ab3b037589e
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 14:43:40 2010 +0100

    Dummy commit to create new default

commit 916e35763a4c5e0149bdb1987c220b2f3201c7ce
Merge: 4c035fae8 ff481de59
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Tue Jun 8 12:22:17 2010 +0100

    Merged default into amqp_0_9_1

commit ff481de59d0562cccaf1514a553f8e333941fa56
Merge: d371f89d7 acdf16cf0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 7 18:27:17 2010 +0100

    Merging bug 22821 onto default

commit acdf16cf0ca9547832b2a1ba9f535b4fcb8391c6
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 7 18:15:38 2010 +0100

    The previous 'simplification' went a little too far, and failed to spot than in queue redeclaration we don't want to permit exclusive redeclaration of a non exclusive queue

commit 604c03544ffa59aef505aa93ab2bbe48d2a90c83
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon Jun 7 17:16:43 2010 +0100

    cosmetic

commit e7756637522586c7c12199ce4021e098c4ba0689
Author: Matthias Radestock <matthias@rabbitmq.com>
Date:   Mon Jun 7 17:06:01 2010 +0100

    simplify exclusive access checks

commit 99e132b3befd489c81bbd5ce80c15a2aecdde7ba
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 7 16:04:35 2010 +0100

    Don't do another dirty_read to get a queue we already have.

commit e29f0edda8c7d7996eee79a79a466daf47ce1e88
Merge: 76a634b3b d371f89d7
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Mon Jun 7 15:27:59 2010 +0100

    Merged in default

commit d371f89d7602ddf38b3beb532fbd7afa21fa5729
Merge: 47889b9f6 0dabe4e84
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Jun 4 17:25:51 2010 +0100

    bug22824 merged into default

commit c344088af6adc0d7e7027e2e13afd4e70c57d180
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 22:16:23 2010 +0100

    cosmetic

commit 2ef796e992cdaf6637a098eae0d011fab6ac51a1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 21:29:28 2010 +0100

    cosmetic

commit d65be7e3a925bb366532d1e644b86f8923ec4a59
Author: Alexandru Scvortov <scvalex@gmail.com>
Date:   Thu Jun 3 16:13:13 2010 +0100

    codegen.py now works with latest rabbit-codegen

commit 364b51a34bc3d0d4be1010c86d721095404bc3e8
Author: Alexandru Scvortov <scvalex@gmail.com>
Date:   Thu Jun 3 14:49:13 2010 +0100

    updated .hgignore

commit 6f22a1a8aa9051bba1d9bf24250a466310f2bb53
Author: Alexandru Scvortov <scvalex@gmail.com>
Date:   Thu Jun 3 14:47:25 2010 +0100

    rabbit_framing_spec.hrl is now generated

commit e951aed7ee92181f9974127a9d8b6423fcbc1c35
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 14:33:47 2010 +0100

    cosmetic

commit d4c5750f8663fc4fb899ecd108226c3d735487f1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 14:07:28 2010 +0100

    refactor: introduce helper fun

commit 24d60ac49c1bdadf96f3f38b48078356aefead63
Author: Alexandru Scvortov <scvalex@gmail.com>
Date:   Thu Jun 3 11:30:15 2010 +0100

    auto-generation of all function specs for rabbit_framing

commit 043a2932acbc8e4bd7554a8a6f2209c81779b163
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 08:09:07 2010 +0100

    cosmetic

commit 63177a0dc99101ca513922c61d57fab3b8e3f8b4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 3 07:52:05 2010 +0100

    refactor: simplify code with some helper funs

commit fa55c6ff436387b4d876eed6db778790bccf866a
Author: Alexandru Scvortov <scvalex@gmail.com>
Date:   Wed Jun 2 23:59:43 2010 +0100

    more rabbit_framing specs are generated automatically

commit e9d5fc942bf542dcd4f9a0bd3dba896732286861
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 22:48:23 2010 +0100

    drop segment num from fun call in segment_{fold,map}
    to abstract away from the dict-ness of the segment store.
    
    The segment number isn't actually needed in most cases and can be
    easily extracted from the #segment.

commit 4ee7258ba4e5256e9552c48e287e28ff160f84a1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 22:45:48 2010 +0100

    refactor: rename segment_fetch_keys to segments_nums
    to abstract away from the dict-ness of the segment store

commit d79a22e53591f30dbf8758335f1a3d95348ec44e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 22:44:28 2010 +0100

    refactor: remove superfluous clause
    ...which was an optimisation too far, particular since a similar
    clause is not present in the related functions

commit 598929c44a81287913e99666ee51b39e49000488
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 22:42:33 2010 +0100

    tweak: more LRU-like cache behaviour

commit 65539b7c16e1fdc574cf864b489d7f35db477366
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 21:17:35 2010 +0100

    remove erroneous comment

commit 47889b9f62f0c1c0eb2bb7d3ee47b8162f24f2a7
Merge: e31bf3c05 3bae7673b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 17:50:09 2010 +0100

    merge bug21932 into default

commit 3bae7673b31ba1378495d18e57f7537e65fd1944
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 2 17:36:23 2010 +0100

    refactoring

commit 0dabe4e843e06a978068dc6796ad09b32a99add3
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed Jun 2 12:37:20 2010 +0100

    2009 => 2010

commit f3c21214ceb79578e20a9d502d76741274f8ab6a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 1 15:15:22 2010 +0100

    Delay the issuing of channel.open_ok if under memory pressure. Also revert changes to tcp_acceptor. Also add test

commit 5b5301e8ba3b18eadd31e9dfecbd3a1e784d8710
Merge: a1d9c6d1f e31bf3c05
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue Jun 1 14:01:49 2010 +0100

    Merging in from default

commit 67c855fb8d13a1d356b43b62f3372289e27345a8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 28 16:25:25 2010 +0100

    cosmetic

commit 0718dff0192a6730927bf78654bfd862ebfb1fd2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 28 16:25:12 2010 +0100

    inlining

commit e31bf3c052e4b8bfae5594e4da14d4185dbdf6a4
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri May 28 16:07:59 2010 +0100

    s/fun(/fun (/g

commit 76a634b3b2f97f08360d62920576d298b43447a0
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri May 28 15:43:46 2010 +0100

    Cosmetics.

commit c042462589ed769e1db2b2d75cf30ff4981ace56
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri May 28 15:36:05 2010 +0100

    Cherry-pick the queue-exclusivity-on-basic.get thing from amqp_0_9_1.

commit dbf36558fe3c1fa369b5ffc1988b6cf2089d51b0
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri May 28 15:29:05 2010 +0100

    Cherry-pick the queue-exclusivity-on-(un)binding thing from amqp_0_9_1.

commit 4c035fae81a0d07529c8c18c115bfdcf02ef8514
Merge: f5bb52f0b ab9024d76
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri May 28 14:25:05 2010 +0100

    Merge default into amqp_0_9_1.

commit 695a70cfdd18eb08855f0a3cab973dcbbed7afdc
Merge: cdb3ab6c6 ec61eac4c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 28 14:24:08 2010 +0100

    merge default into bug21673

commit ec61eac4c71d8645655029e28d3ec251f65df80f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 28 14:00:27 2010 +0100

    remove misleading comments

commit cdb3ab6c61bf7679d303bd873eb3bbf220bd10d9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 28 13:54:58 2010 +0100

    introduce helper fun to fold over segment entries
    and use that in 'read' and 'queue_index_walker_reader'. That makes the
    code in the latter less of a jumping-through-hoops exercise.

commit ab9024d762cfc1eb3da82d0a0293cbfd69d2bfea
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 27 19:52:27 2010 +0100

    cosmetic

commit 28825467ed4584635ed04ca060510b150e7a44b6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 27 19:27:40 2010 +0100

    some minor refactoring

commit d417394c3c2b21c7b705ad8fa8765ee7fbf1d374
Merge: 4c3516817 5b439f592
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Thu May 27 16:40:15 2010 +0100

    Merge bug22596 into default

commit 4c3516817658ec625c83993dbd21cf323f669e50
Merge: b6abff351 7326058d4
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 16:04:18 2010 +0100

    Merging bug 21824 onto default

commit b6abff3515fbb3545b6f40a9d2975dcf361f45f5
Merge: 98f915848 494995345
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 15:43:55 2010 +0100

    Merging bug 22812 into default

commit 4949953453c24b9dc962c1dd849534fd13ffb433
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 15:42:09 2010 +0100

    Minor refactor

commit 866f6f858440473c223ea2467ff72f230e2d4f58
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 27 15:04:31 2010 +0100

    We were only applying the local shortcut in the case when we were *only*
    talking to a local node. This is wrong because:
    
    1) We could then happen to pick a local delegate and a remote delegate that
    were the same process, and deadlock.
    
    2) There's still a possibility of messages overtaking if sometimes they go
    via delegates locally and sometimes not.
    
    So fix that to always avoid the delegates when communicating locally, even if
    we're communicating remotely at the same time.

commit 7326058d408eb85f6e68a5012dcf84472ea75f66
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 15:00:27 2010 +0100

    Cosmetics and formatting

commit 0465d1e3689c86c58183dba130805614c634e143
Merge: b91b55db4 98f915848
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 14:44:22 2010 +0100

    Merging default into bug 21824

commit 41c800936c023b0ba0be1410556f1d5f3e750b78
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 14:35:41 2010 +0100

    Don't ignore return codes

commit 98f915848d0fe0df620baf934718792b2e42a4ba
Merge: 859184811 6f6249994
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 14:17:25 2010 +0100

    Merging bug21915 onto default. Note that this has some semantic changes which are 'safe' for 0-8 and more in line with 0-9-1. This is: an exclusive queue can only be redeclared in the same connection as created the queue and the redeclaration must also specify exclusivity.

commit 6f62499940745463508daffe3c624a65c4f77b6a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Thu May 27 13:44:08 2010 +0100

    Cosmetics

commit ca5d17c25b018fdb576b5f68b25511663b07ee84
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 27 13:36:57 2010 +0100

    cosmetic

commit 784ad2b82c1df0535fee8f4d0c4b277b4ee3865e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 27 12:47:15 2010 +0100

    close segment handles straight after use
    This keeps the number of open fds low (just two - one for the journal
    and segment) whereas previously it could be as high as the total
    number of segments during a) the qi walk in msg_store recovery, b) qi
    dirty recovery, qi journal flushing.
    There are two nice side effects of this change:
    - #segment records no longer need to contain a file handle
    - load_segment can use a read-only handle

commit 85918481172ed1f2b9c684d337a35874af91c7b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 27 08:35:08 2010 +0100

    change the silent-close delay unit to seconds
    for consistency with all the other time interval values
    Also rename the constant to something a little less specific

commit a1d9c6d1faf7de49ab9f6d3681eef89d667cf742
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 26 20:10:38 2010 +0100

    cosmetic

commit b9298ea015696b410ec88413eb00b45d98464f5e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 26 20:10:30 2010 +0100

    improve error handling code

commit 2f02b3fa31fa44464334f51ab992a5bc19dadf20
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Wed May 26 18:40:30 2010 +0100

    Sorted out exception handling correctly, and added many more tests

commit 79e0804661b83c72d105db883efffd335963bb32
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 17:21:57 2010 +0100

    Don't eat errors that could be returned by F.

commit 0c0026dcc2f70bcf6bcd1ced414955b71c550bdd
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 17:03:54 2010 +0100

    Clean up a bit.

commit ecb23eef0dae5eb6a4a51bd7e5514528aa2a6008
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 16:49:09 2010 +0100

    Move F into with_or_die.

commit c031debe0aefbdbfb80e7fd797576c3dcee7d87f
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 13:37:53 2010 +0100

    Make error messages in the logs a bit clearer.

commit f5dcc2180b76129791349cca269f83a73f5382a1
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 12:52:50 2010 +0100

    Correct specs.

commit 39be6b976a5f3b5733941bf76333349e129238e2
Merge: b061ba282 0e00781c7
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 12:47:51 2010 +0100

    Merge default into 21915.

commit b061ba2823117bca31d167e8a3aa6e34d7266e38
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 12:47:01 2010 +0100

    Move our protocol_error outside the with_or_die to stop it being eaten.

commit b4e557a02c34d255bfeec3b172ec0096b884259c
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 12:23:31 2010 +0100

    Reinstate check_configure_permitted in queue.declare passive when queue already exists.

commit d0c9695731f667dbe8c4c29b15cd164d2d7453b1
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 12:16:36 2010 +0100

    Revert bug introduced in "cosmetics" commit 41b7270f9546.

commit 548fae2fa7ec22c91c731362e9ec83b215e22be1
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 26 11:48:31 2010 +0100

    80 col fix.

commit 6ff847e817f5582a94d2ae0ddfa64c4377c82c08
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 26 11:30:45 2010 +0100

    cosmetic

commit 5e4e8c0a8eb2da6837a87299c658f6cd3d096afa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 26 10:38:42 2010 +0100

    improve flow control logic
    - hopefully easier to understand
    - handle unexpected channel.flow-ok with an explicit error

commit ff084083c8424564615b541a6911ef5f3c45939d
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 18:12:57 2010 +0100

    Whoops

commit 8f7011f3ac2054d2e470224c3ffc598c153be120
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 17:56:56 2010 +0100

    cosmetics

commit 95af8ab9e1b8293dd49231de67dcfc4bdfd0c639
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue May 25 15:25:21 2010 +0100

    0-8 equivalence rule.

commit 6c8e27ad5c55d1e501d90325e22ad52333241c54
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue May 25 15:07:48 2010 +0100

    Replace exclusive_access_or_locked with something cleaner.

commit b4bebd253ea3c36e5ffe14208ec243b23f213fb9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 12:42:00 2010 +0100

    Minor refactorings

commit 0e00781c73b3b639b5095730d84ab1cea8507d7f
Merge: 046c06148 865ddf453
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 11:42:32 2010 +0100

    Merging bug 22774 onto default

commit 046c061480839e06cf10b5ea9d7e97545fc67ac8
Merge: 8b18a7c75 fa6533b0e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 25 11:40:00 2010 +0100

    merge bug22752 into default

commit ccc1a6463ee7d24ab1388d64af13a854ab9f8a02
Merge: 9220fbd07 8b18a7c75
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 11:20:56 2010 +0100

    Merging default onto bug 21673

commit 9220fbd071539d20dcd1df1fd7d32901060a16af
Merge: b54129b04 c6aedf1bb
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Tue May 25 11:20:38 2010 +0100

    Merging bug 22752(bug21673) onto bug 21673

commit fa6533b0ee23c36852d39e5e89f7d4c8ed711359
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 25 11:08:44 2010 +0100

    refactor: more sensible and consistent arg & field order

commit b14787b88f1203b0df92cc3e774bc1859820f255
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 18:22:25 2010 +0100

    Writing some tests revealed a number of mistakes

commit ebaba13714f1ef4a0c530be8b8bdff75f142dc9b
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 16:15:40 2010 +0100

    1) stop accepting new connections

commit 865ddf4538f5f35e430e301a02085d127a8cf1e1
Author: David Wragg <dpw@lshift.net>
Date:   Mon May 24 15:26:40 2010 +0100

    Handle quoted node names by parsing with erl_scan:string
    
    If the node name contains characters which cannot be used in a simple
    Erlang atom (e.g. a hyphen), then pid_to_string will quote it;
    e.g. <'rabbit@centos5-64'.51.0>.  If in string_to_pid we try to
    convert the node name part back to an atom with list_to_atom, the
    quotes will be included in the resulting atom
    (e.g. '\'rabbit@centos5-64\'') and so the two functions will not be
    inverses.  So use erl_scan to parse the node name instead, to recover
    an atom that exactly matches the original.

commit c86c6961b53c7f007161fdf97e50a1b78480aa0a
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 14:57:51 2010 +0100

    3) wait for some reasonable time to receive a flow-ok; 4) if we don't get a flow-ok then close the channel with an appropriate error

commit 17e65367666c09138ff371129ae8135e6ea5634c
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 14:05:49 2010 +0100

    active is much easier to think about than blocked. Deal with the possibility of receiving various conserve_memory messages whilst waiting for a flow_ok to come back from a client

commit b54129b04098ec48124f635ba42d68db8807af88
Merge: 8a6e5ad71 c5fb85cc7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 24 13:56:05 2010 +0100

    merge heads

commit 8a6e5ad71035c40b6ace5ca5bddcc8cb626d0f6c
Merge: 239aad5cf 3be640d0a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 24 13:54:20 2010 +0100

    merge heads

commit 2da7bcef7ebde327a913603cad7f73ffe425d614
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 12:54:38 2010 +0100

    5) if we get a flow-ok but then still get a publish, throw away the publish and close the channel with an appropriate error

commit 8b18a7c75d1df0d0fa60d4c95688f5a69fd64628
Merge: ce43301b1 dd82e3016
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Mon May 24 11:47:15 2010 +0100

    Merging bug 21763 into default

commit 239aad5cf469d24c54e93c9137f3bb5717a089b2
Merge: 69bc3e33a ce43301b1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun May 23 09:27:12 2010 +0100

    Merging default into bug 21673

commit 3be640d0add86b327c17274a34e6231e0b70f66a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 21 23:12:31 2010 +0100

    better factoring of queue_index termination
    - make the whole thing less parametric
    - get rid of idempotence - we don't need it

commit c6aedf1bb07b0d651074655d9c934aed8b81d1c9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 21 18:01:41 2010 +0100

    Rip out now-unnecessary logic for setting the persistent store to the transient store: that solution allowed the persistent flag to be honoured in non-durable queues by sending the message to the transient store; we've now decided that we don't want to send non-persistent msgs to any store and are handling that by (effectively) unsetting the is_persistent flag for all msgs arriving in a non-durable queue

commit 05b140a3c0820ae62a4201bceb60cd364a3a4eb0
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 21 17:18:44 2010 +0100

    Stop persistent msgs in non-durable queues from reaching disk

commit ce43301b1a8554e9687c4d955d40e1931d13b832
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 21 16:30:29 2010 +0100

    Don't hardcode the name of the mac build host

commit 19259bcede5c31762470ef6bf545461b09fdc511
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 21 14:22:51 2010 +0100

    Stop persistent msgs in non-durable queues from reaching disk

commit 6811a5cf781e5291d6732a0ce5c14c702e9d11cb
Merge: 2604ad8d6 30181bea9
Author: Matthew Sackman <matthew@rabbitmq.com>
Date:   Fri May 21 13:59:08 2010 +0100

    Merging bug 22340 into default

commit b6f2d5f8cd6ee97f3fd6cd8fb29685f38eed2785
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 20 23:42:19 2010 +0100

    rename queue_index:terminate_and_erase to delete_and_terminate
    to match the corresponding function in variable_queue

commit 30181bea93e69b1bfb1b3584c66bb0a11987cab1
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 17:32:53 2010 +0100

    Don't allow the error_logger mailbox to grow unbounded when flooded with connection attempts.

commit b91b55db490b0633619a2bce3555194486e042f9
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 16:11:44 2010 +0100

    No reason for this to be a dict of lists.

commit 04e79cecc6ee95b4b48dba1e7533836f5e38aee8
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 16:02:16 2010 +0100

    Forgot to add this.

commit 226cf1c6d6bc83d48717e37810f0278877eae980
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 15:57:32 2010 +0100

    Move the former bug21824 into a new branch that comes off bug21915 (and thus default) rather than amqp_0_9_1.

commit 0f03cdddb9e954ff30cef612dc14c140f264d57d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 15:23:06 2010 +0100

    Cherry-pick a8d7d2ed4471 and e7ccda77c177 from bug22695.

commit 07d41db76a8817be05bca6d01e72d49b3774ca93
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 15:20:04 2010 +0100

    Cherry-pick 8f43450de344

commit 7fd408c58df3558aeab7860153fbf4a026441a2d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 15:00:04 2010 +0100

    Cherry-pick 268c69708cb655beae46b8f025602c1ecd205488.

commit 8acffe9e960c9e0ea13e29ea4386cfcac8c4f31d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 14:24:36 2010 +0100

    Cherry pick 9dd01b19c85e2648a8ef3b18b3848f1b07281c5a.

commit 7a06fb86618776cca96e26c3b90ff6935c680b9d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu May 20 13:59:01 2010 +0100

    Cherry-pick 9f4bf96b07a3f6e066792d92a1c3252a1d98842c.

commit 69bc3e33a6840e66ef539441d6845024d30d0260
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 17:58:25 2010 +0100

    more efficient 'bounds' function
    This no longer touches the file system. It's still O(n * log n) in the
    number of segments though.

commit c5fb85cc756078eb43edcd6f7651b03c544de6a4
Merge: 14fa1ee3f 2604ad8d6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 17:53:07 2010 +0100

    Merging default into bug 21673

commit 2604ad8d6faa63be8628c2d8cb9b440504a5d1ce
Merge: ca35c2510 98e1a2751
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 17:31:35 2010 +0100

    Merging bug 21239 into default

commit ca35c251038c741970c7042e35f108d5c7bf58e0
Merge: 0cb70028d 6bd433308
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 17:09:38 2010 +0100

    Merging bug 22759 onto default

commit 0cb70028d3a08eaaae5b43a998e2945bc4a71348
Merge: 6b56c4a54 9900dbe4d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 16:40:50 2010 +0100

    Merging bug 22761 onto default

commit 14fa1ee3f19dc9aacf683669437a7a0278ea82b3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 16:22:14 2010 +0100

    cosmetic

commit 5846f38afb6eeabf4a9c3f63fc4fe9dce34a21f6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 16:21:16 2010 +0100

    cosmetic

commit 98e1a2751db91a531fee6da583cd5dee13e41186
Author: Simon MacMullen <simon@rabbitmq.com>
Date:   Wed May 19 16:04:06 2010 +0100

    Delay before silently closing the socket, removes an obvious DOS vector.

commit d7b87754b8b7ec01e8d4586f754bb6a5636b9a50
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 15:33:27 2010 +0100

    do the minimum amount of work necessary on clean queue recovery
    Only read from the journal. No segment reading. No writing.

commit cf0ceee78f5efbb059dbf4b3e5714ec58d621693
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 15:08:35 2010 +0100

    Added test which hits all cases in journal_minus_segment which do not require duplicates between segment and journal

commit 645ba16b338338005902259890eebbb4fec36771
Merge: 82d04bc93 204a8cd94
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 13:54:53 2010 +0100

    Merging heads

commit 82d04bc937324d87ef0859ccce4ccb939d76a36f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 13:53:27 2010 +0100

    Full code coverage of segment_plus_journal

commit 204a8cd94600e5dc9011b01b5f4f67cd7ad791a9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 13:36:13 2010 +0100

    refactor

commit d5816a10609d2a20de494b10e58cc03c8e276685
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 13:33:04 2010 +0100

    cosmetic

commit b366bc7f483cc54e53a7bf19a580d0b9c0868db3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 19 12:40:00 2010 +0100

    Drop PubCount and AckCount in favour of UnackedCount

commit 84c899894fd06f0929220593cfcbf8458c5bd365
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 11:35:47 2010 +0100

    some inlining
    and removal of some comments that weren't particularly useful

commit 21f2ba993915ddf22d711171a0f43d0f40faf540
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 09:57:35 2010 +0100

    avoid unnecessary match

commit 9f7f4449be747d9bab8c94172567fecbec83b53b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 09:05:03 2010 +0100

    keep complete pub/del/ack entries in journal on recovery
    IF there is no entry for that message in the segment
    
    This is
    - more efficient, since there could be quite a few of these and we are
      avoiding an array update for them
    - more consistent with the other 'keep' cases
    - the same as would happen if the journal had been built up by queue
      operations rather than through recovery
    
    The entries are filtered out eventually when flushing the journal.

commit 697235703495a36b596ea2ef91d44bb1f4f6b7ca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 08:56:25 2010 +0100

    seed journal_minus_segment with the original journal
    ...and modify/remove things in/from it; rather than building a new
    journal from scratch.
    The result is the same, but this way of doing things a) better
    reflects what this function is about, and b) should be more efficient
    in the common case where the journal does not contain stale entries

commit 83b9512dec13fc71d3d99f04193e4d32f1cbd38d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 19 08:00:33 2010 +0100

    journal_plus_segment -> segment_plus_journal
    This better reflects what we are actually doing, i.e. we take the
    segment and add the journal.

commit 26c086256d881ac89c19e8d014b570264cf29c3e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 19:27:52 2010 +0100

    KeepAck -> KeepAcked

commit bbe80f0ae6b869f542caa6def142d707a0ded5bc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 19:27:26 2010 +0100

    minor refactor

commit 957d2ed75f29a22258937cecd9ea03c3a07c817a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 16:55:44 2010 +0100

    Added documentation regarding the clean shutdown and startup optimisations

commit 09f36d1254f3d57e988a6bf704440051a6125dbf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 16:34:39 2010 +0100

    Added specs for msg_store_gc

commit 1244097e1c6adb20808fda79f2a8d02b4d0d039a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 16:29:12 2010 +0100

    No need to build up a list of transient queue indices to delete

commit 99b9e4f61cfa0243817ca1ed223248586f176436
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 16:21:50 2010 +0100

    Removing erroneous conjunctive clause in test

commit 6624f4275edca8898d0ee7020baadf75c543ca4f
Merge: f62e5cb4e 970f432cb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 15:57:33 2010 +0100

    merge heads

commit f62e5cb4e28529a180a4dfd00470285a6578ec46
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 15:56:57 2010 +0100

    correct comment

commit 970f432cb535a3949a4fe047675519c5d713bc3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 15:55:11 2010 +0100

    Refactored bpqueue tests

commit fd10acefa0e9ac776bdd13b2da191bb16864dc3a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 15:40:24 2010 +0100

    take the journal into consideration in recover_segment
    which removes the need for an initial flush

commit d95c60baffae89d962f33fa0353e48261e6a229d
Merge: be1e06df0 6b56c4a54
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 15:22:36 2010 +0100

    Merging default into bug 21673

commit be1e06df00b7cdd4b148557f77f4b93970137419
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 15:18:39 2010 +0100

    vq:delete1 does not need to return nor pass around any count

commit 29a19aee52d91aef333dde32711bfcfb5581e34d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 15:02:25 2010 +0100

    Because of the change to qi:read, we now don't need δ to start on a segment boundary. This removes the need for current_segment_boundary

commit c06cebee9707c71769aa4b30f75792fd13c691f6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 14:22:10 2010 +0100

    Cosmetics and documentation

commit 0f915894a406256d00f30f87f448143381ba3116
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 14:02:18 2010 +0100

    cosmetic

commit 29b43b7761cd4ddf9861982b367431db65f7b363
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 13:28:01 2010 +0100

    Apparently it's wrong to do the least amount of work possible.

commit afdeb07ef3abf056976078ea3b68a3cb6a94f266
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 12:53:54 2010 +0100

    Reworked reading from the queue to still be limited to a maximum of one segment, but with a more natural start+end interface

commit c75f81a640cff9ecb4a6e4e5c25b207c9399d94d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 11:40:45 2010 +0100

    Corrections to documentation in queue_index

commit 3b8df23285a29c054b1730471b8def8c699aeb99
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 11:25:43 2010 +0100

    Drop segment_size and instead have a current_segment as well as a next_segment function

commit 3c33e69b6c3455e1d06b1d8bc0aea3e6231a4dd2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 18 11:08:40 2010 +0100

    Renaming some very long function name to a much shorter name

commit 9fd7e7df4b77abf9c64589fe0622c92042ebf80d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 18 07:04:52 2010 +0100

    rename some qi funs

commit 6781a33feb32355fc43bb987c7093f509bc17aa6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 17 22:11:02 2010 +0100

    cosmetic

commit 50dcdc9d72e69dba9bd2ee0e80f671384e15cfdd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 17 21:50:10 2010 +0100

    fix typo

commit 94186864554fabb2a85884263550d3018fc4a8c1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon May 17 18:34:38 2010 +0100

    Change how we handle a gc finding concurrent readers on the same file. Previously we were just waiting and trying again. Now we get the readers to signal to the GC when they're done. This itself introduces a race and so has to carefully deal with such notifications arriving after the GC has completed, but it removes a magic number. Also fixed a bug which mean readers were reading from locked files. Whoops.

commit 15d267347b9833e4b8ddcc661705af6b218d39fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon May 17 17:10:13 2010 +0100

    Improved incorrect or outdated documentation in msg_store

commit 34991b85654ea849d0c8d5d1243eb99fea116a81
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 17 14:51:58 2010 +0100

    commenting on the non-obvious

commit 6b56c4a54c57f15b01fc6f8c4b65eabdd80f7c23
Merge: 9a57aebae b11a85c43
Author: David Wragg <dpw@lshift.net>
Date:   Sun May 16 17:40:52 2010 +0100

    Merge bug22763 into default

commit 9a57aebae7c66aa8c23537c0735e203e55f4efa2
Merge: be15e202e 5dc2f6b81
Author: David Wragg <dpw@lshift.net>
Date:   Sun May 16 17:40:52 2010 +0100

    Merge bug22762 into default

commit be15e202ee57483da61196f453c35c7631b2daf1
Merge: 44fe8d966 3b0fddfd0
Author: David Wragg <dpw@lshift.net>
Date:   Sun May 16 17:40:52 2010 +0100

    Merge bug22756 into default

commit d97a9e548b646a24ea134b9c08f0c0880d84c260
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 16 11:26:22 2010 +0100

    refactoring: extract segment recovery
    also rename maybe_add_to_journal to recover_message, which better
    describes its purpose.

commit 389cfc6e763f3d109914e1d429c9f140588cbcb6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 16 11:24:06 2010 +0100

    cosmetic

commit a5e282ab97f58eedc7cb5af72d5cab565d31348e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat May 15 21:06:00 2010 +0100

    Correct an accounting bug in queue recovery. By incorrectly counting duplicated acks, we remove too few acks when constructing a segment's combined ackcount, leading to an ackcount that is too high. On (dirty) recovery, this will cause the qi to report it's length as being shorter than in really is, which will then cause the δ record in vq to be too short. Subsequent loading of segments (δ => β/γ in q3) will then crash as more publishes will be found than expected. Note that to trigger this bug, Rabbit must crash/be-killed in the first place, during flushing of the qi journal in a durable queue with persistent messages.

commit ee8fca41ef33791d149338aa7f2fd1c6f1f06d48
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 20:43:47 2010 +0100

    cosmetic: more sensible order of clauses

commit 71bd30bc9e5a7f5701e35179bf5703fbbccbab24
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 19:31:25 2010 +0100

    tweak

commit 2ea02e900f282ae61eadee19798fd562e88f8743
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 19:22:47 2010 +0100

    fix up comments

commit 65bdccc49c12885f50b6db30425f4230513b0f6f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 18:51:52 2010 +0100

    minor tweak for consistency

commit b15fa959d6ee8292763ea0663bfe7cc350f3c26f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 18:34:52 2010 +0100

    cosmetic

commit d4d55afebf74edf68e039784d7c05c1a93338792
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 18:27:38 2010 +0100

    convenient macro

commit 932a2e493670b85f536fa1b5b0fdc7e0b1168ee0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 18:23:36 2010 +0100

    refactor: more concise journal_plus_segment

commit 998ced84c1b0eb4d1531806a95bfdeaa84b7dd10
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 18:03:07 2010 +0100

    refactor: more concise journal_minus_segment

commit 21b9ee86387dc095cc77ddaec4c181f58cd4e702
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 17:26:38 2010 +0100

    fix typo

commit 8a9dd51ada181c9ce136f3295f34b13b147614ed
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 17:26:20 2010 +0100

    cosmetic: more consistent and easier to read match syntax

commit b5cb4324a2b25a5ba79f4b2865e63ad7cebe4e6b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 17:25:14 2010 +0100

    cosmetic: group functions by purpose

commit 596b6087ca0176a9fd30f0f6588830f59ba11895
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 11:36:49 2010 +0100

    refactor: more sensible ordering of result tuple

commit 57bbfb01fa226539b780958a146505c315c0da08
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 11:36:00 2010 +0100

    tighten guid size check on 'append'
    the guid must be *exactly* the right size; the rest of the code will
    break if it isn't.

commit 5f34d8fdcfa3af18bb27bf2555ed05e1fe71a4d1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 11:34:44 2010 +0100

    remove unused constant

commit c8b86f5de876cb5ed859798d8628d67f3946d723
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 15 08:57:22 2010 +0100

    minor refactoring and some cosmetic changes

commit 5dc2f6b812024bbf9054c002ab48014e0c4cf0a4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Sat May 15 13:15:58 2010 +1200

    It's _rabbit_erllibdir, not _maindir

commit 4400c7ca11b3456b99a7a897b90031721283ebb4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Sat May 15 12:56:29 2010 +1200

    Clean out plugin activation state on uninstall and upgrade

commit b11a85c434ce1b9923f6e03ac32977e3a1bd5875
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Sat May 15 11:35:55 2010 +1200

    Warn, rather than die, on not-found module in boot step construction

commit 73d0ee7112079d2c8df0f97eb0873d7d1647e130
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 20:55:59 2010 +0100

    cosmetic

commit e726e2bf4df24f361f1f22bc2b7a82713ee04495
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 20:42:58 2010 +0100

    move startup_fun_state type def
    since it is only used by the msg_store

commit 600839cdd655dc3fb2d4be7f7cb62fcc8dac3fdf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 20:34:02 2010 +0100

    minor refactoring and cosmetic changes

commit ba24177421fecdfb30defb32b46268b1ba60cfcb
Merge: 87556da94 44fe8d966
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Fri May 14 18:28:07 2010 +0100

    merging in from default

commit 9900dbe4d4df317931807fa6c1f3078a81c3c7fe
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Fri May 14 18:07:39 2010 +0100

    handling the case of empty payload in rabbit_binary_generator:build_content_frames/7

commit 1001250bf532063e716bcbbfef45041680d46641
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 17:43:35 2010 +0100

    cosmetic

commit 44fe8d966f437ab4778049deaf1bd50a5eddec59
Merge: 41c0dbfb3 33a15328e
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 14 16:06:22 2010 +0100

    Merge bug22754 into default (nothing to do with floating point)

commit fb6fd884780857888d04515bcfbb073aaaa7f94c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 14 15:37:24 2010 +0100

    Rely on badmatch - no need to throw

commit 1ce7188508d637b1c88fa80739434de307d91a86
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 14:03:56 2010 +0100

    cosmetic

commit 6bd4333084b9c9faaffff4b9ef62cf4a7961c664
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri May 14 22:54:40 2010 +1200

    Ignore obj_out_of_date for crypto, too

commit b28f428065dcc90a6937782cd69d353aedf0ebe1
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Fri May 14 22:09:54 2010 +1200

    Don't include the (de)activation scripts in the windows package.

commit b2045d4b7347c95ff7f549082d94d42ab610b9d3
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri May 14 21:48:13 2010 +1200

    Attempt at an equivalent patch for the Windows scripts. Untested!

commit 7ab13d4d1f637b8891b09c96a46d8e44e238cde9
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri May 14 21:36:53 2010 +1200

    Move plugin activation into the startup script for unixes. Update packaging and some docs.

commit b0fe2b269464dedd90ffd8737112d2b8afae7f94
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 09:11:36 2010 +0100

    log msg_store recovery failures as warnings

commit 3b0fddfd09bc5a7a040b3e55d948297cfed98e27
Merge: a28e2fc79 41c0dbfb3
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Fri May 14 19:54:53 2010 +1200

    merge default into bug22756

commit a28e2fc79118bb029de9a31a88d1c42e9e0089d2
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Fri May 14 19:52:46 2010 +1200

    Remove traces of plugins on "remove" and "upgrade" as well as "purge"

commit a4387400eb0bf83149c4ab44b602ac7852e406da
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 14 08:46:20 2010 +0100

    whoops

commit 92b450f80a6778002467c1eb1014873d0d911aa4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 13 19:42:07 2010 +0100

    use exact comparison
    this is just for consistency; functionally it doesn't make any difference

commit bb37b2e220419cfa12f273cc8f29e755c913c2a6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 13 19:18:51 2010 +0100

    cosmetic

commit 33a15328e62b2f57f828cb0b39ec73eabb7af6da
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 15:27:07 2010 +0100

    Do not install the INSTALL file in debian packages

commit 5830bad0236626fe483c85a57823901774417ac3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 14:42:02 2010 +0100

    Cosmetic, and move to 100% code coverage of bpqueue

commit 6bec44b9485bf7868e8e3f98b2192f274bf7f691
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 14:22:07 2010 +0100

    One more test, and simplification of the bpqueue:to_list function

commit 76ed373cea0a6b1b53e49e8abcb483061393c738
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 13:45:38 2010 +0100

    Added a couple more bpqueue tests

commit e1ea9ab049f0691e734fc9bfa8aa3f6eed032114
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 13:36:50 2010 +0100

    Improved documentation and added additional tests for bpqueue

commit b9f4fbbdb6f1ad21d523f34ce6855f8951eb007c
Merge: 9772b7ebd 41c0dbfb3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 13:07:28 2010 +0100

    Merge default into bug 21673

commit 9772b7ebd0723521eaa3f4fb442d5e77375efea3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 12:38:59 2010 +0100

    Reverse the order so that we stop and then unlink+capture_exit. We don't think this should make any difference, but it's a little neater

commit 41c0dbfb3c6504f0b4d7e7da80bc21499f9de46d
Merge: 5ea720eb9 805fe0ac5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 13 11:44:06 2010 +0100

    Merging bug 22732 into default

commit 31dbffcc0d96cbe345efb8876e7348befad7a665
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 13 11:20:41 2010 +0100

    tweak msg_store_index initialisation API

commit 148d26a89abceff4ab9553fbd0f12c16b1bc0857
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 13 11:19:58 2010 +0100

    cosmetic

commit 805fe0ac5b9a70383548f1aa5bc23349977441a8
Merge: 17613c33f a3997cb36
Author: Emile Joubert <emile@lshift.net>
Date:   Wed May 12 16:02:38 2010 +0100

    Merge duplicate commits

commit 17613c33f42e7608fe7bbbe9d08834cf52f87a85
Author: Emile Joubert <emile@lshift.net>
Date:   Wed May 12 15:52:33 2010 +0100

    Register memory alarm after channel open

commit a3997cb36853f7c9bb605f2f17f9c54c6aeee779
Author: Emile Joubert <emile@rabbitmq.com>
Date:   Wed May 12 15:49:57 2010 +0100

    Register memory alarm after channel open
    
    to prevent a closed channel from producing channel_flow

commit f5bb52f0b28e7c628290e7596ea866c0dcc2f8aa
Merge: 42092de9b 8ae5ab9ad
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 12 15:26:37 2010 +0100

    Merging bug 22695 into amq_0_9_1

commit 8ae5ab9ad31f9d07be04c1c08f7bfeb7f0d2ec84
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 12 15:22:35 2010 +0100

    Correct formatting

commit 1f63259ef87ea48c0e81014692b5de064993f5b3
Author: Florian Haas <florian.haas@...>
Date:   Tue May 11 18:20:52 2010 +0200

    OCF resource agent: log debug messages on status
    
    Log simple debug messages when the resource is running, or has been
    stopped gracefully.

commit 8947d1a293497b8bd905b7afcb8cdb80f7e4f16c
Author: Florian Haas <florian.haas@...>
Date:   Tue May 11 18:12:29 2010 +0200

    OCF resource agent: remove bogus parameters for monitor op
    
    "depth" is actually not used, and "start-delay" is strongly
    deprecated. No need to advertise them.

commit 5b85d08ce890c17d23d4c5508c9b83210537bd86
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 7 13:42:51 2010 +0100

    merged Florian's 07 patch: OCF resource agent: add status operation
    
    Even when it is identical to monitor, a status operation should still
    be advertised.

commit 8c298727ddf4517bfd3a64e5b7485ac7827adc06
Author: Florian Haas <florian.haas@...>
Date:   Tue May 11 18:07:53 2010 +0200

    OCF resource agent: fix incorrect parameter type
    
    Any IP port should be an integer. Fix metadata so GUIs and the CRM
    shell report the parameter type correctly.

commit 095e0e083948039c253ab21df8c8e3a174d44522
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 7 13:34:53 2010 +0100

    merge Florian's 05 patch
    
    OCF resource agent: fix validate exit codes
    
    Exit with $OCF_ERR_INSTALLED if validate fails due to non-availability
    of a required binary, or config file.

commit d5361c177cc0aa6715bbe365f7efeb15b5bd0f3f
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 7 13:28:30 2010 +0100

    merged Florian's 04 patch

commit 4cf5f5e5af010f8860cc77e8fb2705f66ea7b328
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 7 12:25:03 2010 +0100

    merged Florian's 03 patch

commit c1682cd57e831dede2807775c0384cee251c820b
Author: Alexandru Scvortov <alexandru@rabbitmq.com>
Date:   Mon Jun 7 12:12:49 2010 +0100

    we should still run rabbit_validate_full when rabbit is started

commit fb3b1d8953ab9cd7140aaf8f2c1d3499abb7d192
Author: Florian Haas <florian.haas@...>
Date:   Tue May 11 17:47:48 2010 +0200

    OCF resource agent: use ocf_is_probe
    
    Linux-HA comes with the ocf_is_probe function to determine whether a
    probe operation is in progress. Use this to determine whether to do
    full or partial validation.

commit a1519128452e9d78c3e3f4b3c9b5fb481274ad8f
Author: Florian Haas <florian.haas@...>
Date:   Tue May 11 17:45:08 2010 +0200

    OCF resource agent: use $OCF_FUNCTIONS_DIR
    
    Linux-HA introduced the $OCF_FUNCTIONS_DIR variable to make resource
    agents executable in-place.

commit 2368e2ad89027883a31690c7a74c890398b8409b
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue May 11 13:37:41 2010 +0100

    Don't recover exclusive queues if the owner pid has gone away.

commit c4a0ea1d28dad8d10dc13cc90fd2170e490149fa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 10 19:26:09 2010 +0100

    correct harmless off-by-one mistake
    a gc can only take place if we have at least three files - the current
    file (which we cannot gc), the source file and the destination
    file. We do a quick check wether there is enough data - garbage or
    otherwise - to require more than two files. This can give false
    positives since the last message in a file can overrun the
    limit, but that's ok as the code that follows performs more accurate
    (but also more expensive) checks.

commit 0909e6d20ee72fcfb8c57d24f8ef90151be8904b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 10 19:12:00 2010 +0100

    nitpick

commit 750515bccec0f7cd0da60ae70572af9bde248b7e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 10 18:51:09 2010 +0100

    change the way we pick gc candidates
    instead of picking them with a random geometric distribution, which
    requires a magic constant and involved some rather obscure code, we
    simply pick the eldest suitable file pair.

commit 42092de9b1f3fa73b5b439bf6cdb2c5cece60331
Merge: 2969c6b6c 5ea720eb9
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon May 10 17:41:34 2010 +0100

    Merge default into amqp_0_9_1.

commit 2969c6b6c6a8fa32c426c2a345a538132df2e66d
Merge: 4e12216eb 13291e27f
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon May 10 17:11:47 2010 +0100

    Merge a182153c2578 into amqp_0_9_1

commit 4e12216ebecd90afc97ddfea31b6f4394e8bbfbd
Merge: 6324169a1 b57ebc9d1
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon May 10 16:39:01 2010 +0100

    Merge up to a8da11d231ff from default to amqp_0_9_1. This causes
    testConnectionQueueSameNode to fail due to a race in recovering
    exclusive queues (bug 22695). We'll need a fix from default, so
    leaving as is for the time being.

commit 0c97a23c3976b1aee572e97960975270973dd1e5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 10 16:23:14 2010 +0100

    trigger possible msg_store gc in all the right places
    - on removal of a message (since there is now more garbage)
    - at the end of init (since the recovery may have created garbage)
    - after rolling to a new file (since the old current file may be
      eligible for compaction with it's left neighbour)
    - at the end of gc (since we may not have reclaimed enough garbage to
      drop below the gc threshold)

commit 073e0eec578bff3ea7f31777242d0fc1ea59123a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 10 08:20:32 2010 +0100

    more obvious check for current file
    and some cosmetic tweaks

commit 5ea720eb963451955b8e57c807a47952dbafa6ce
Merge: d53d2e4cb 02bd58dc3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 7 17:43:08 2010 +0100

    merge bug22697 into default

commit 02bd58dc37473d14f40b1c68221bb680d3e0b089
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 7 17:34:12 2010 +0100

    get rid of now redundant 'sync' call handler
    and some cosmetic changes

commit a8f28a9654bea108a8be0a2be7494f29824454eb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 7 17:13:25 2010 +0100

    minor refactor

commit 0720c99eba4f4fd9901fdafa72ad76dbf4d97167
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 7 16:04:26 2010 +0100

    More sensible registration and cancellation to various services

commit c392a7cf804c11856fa1e476ca8cd11c78844a89
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 7 15:40:14 2010 +0100

    Move the internal declare step into the queue process side of things

commit 6fa41a2c6279c0483db21ce70af5b377e25f3dd5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 14:03:08 2010 +0100

    oops

commit cbfb743434829f751ed3b6078b41dda720c19b2a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 13:54:05 2010 +0100

    refactoring and tweaking of gatherer code and usage
    - better function names
    - get rid of the notion of named forks; just counting them is sufficient
    - don't terminate automatically, which results in a more symmetric API
      and allows gatherer reuse
    - in the gatherer usage, spawn workers with a thunk rather than MFA,
      which is less cryptic
    - use of folds and list comprehensions in queue_index_walker, in
      preference over recursion

commit 23ff3a598c34dc603ef7c2f95f73489060a23a8c
Merge: 6f8272c47 d53d2e4cb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 10:06:48 2010 +0100

    merge default into bug21673

commit 6f8272c47d45a0d07e90738052f9bf2affde3e6d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 09:33:34 2010 +0100

    whoops

commit 9664f07c47a2adb0128b9bcef0615abd8ea022ab
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 07:20:04 2010 +0100

    cosmetic

commit 3946353d89493d26bddcef75a7c7008998529cce
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 6 06:22:20 2010 +0100

    cosmetic

commit d53d2e4cbf5a4c10623b469fb153aae28c593276
Merge: 7fcb22416 fe0607a93
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 17:00:58 2010 +0100

    Merging bug 19844 onto default

commit fe0607a93fd0d8c427a87f3bcbd39a1ac06cc2ae
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 16:42:37 2010 +0100

    Cosmetics

commit 417e3893b3b390001dd6f55e35f38ae85baff47f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 16:03:37 2010 +0100

    RecoveredFileSummary => IndexRecovered. Also added an apparently crucial comment

commit 3beb6e09ad43852d1abaf25efbb83649e3aef756
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 15:57:26 2010 +0100

    Separation of Recovered and Recovered1

commit b34ea9780387142da4a70beefe2f2eed6c99f9bc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 5 15:56:43 2010 +0100

    more precise comments

commit 1b0cf4e6a13fc943ee84ca3985eb6ea9ae2931af
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 15:44:41 2010 +0100

    Correct insertions into dedup cache

commit 81964120f447a2286eb3c86cdd5e165aad53cbef
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 14:55:48 2010 +0100

    %%

commit b954950f973d80c5864187f53f8cf5093f8f1118
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 14:55:05 2010 +0100

    %%%%

commit e4579eca831999fc66f0545f7d6af93aa182db19
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 14:52:22 2010 +0100

    Whoops

commit c4b64a68e087cea2a1627db45b614cf7aff3549c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 14:43:42 2010 +0100

    Whoops

commit 26dc9bbc43a3c50fdef18a505fe35a348ffeb55b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 5 14:41:03 2010 +0100

    Various fixes and improvements to client reading

commit 9713e016dca7fee42e490061bd2ba343be2489a2
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed May 5 10:32:13 2010 +0100

    Retain all exception information if thrown. Use that to rethrow in the single pid case, and mimic gen_server:multi_call in the multiple pid case.

commit 9d71a0d9038c86dda92689f90515df9caea168c3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 5 09:03:19 2010 +0100

    cosmetic

commit 07db471e177140dbf92a3c8ad1d810f156143af3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 5 08:10:42 2010 +0100

    refactor concurrent ets manipulation logic

commit df3c84837b7021031f1c99acbc70f1e36d3fa70f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 5 01:08:41 2010 +0100

    made shutdown term structure opaque to qi
    only the vq needs to know about it

commit 04178c056f9c666f31c5f42cf94d76d6191299eb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 23:48:24 2010 +0100

    disentangle qi from msg_store

commit 68fcf268b9280ea57796b1d1023a5497b5ff4327
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 23:05:19 2010 +0100

    cosmetic

commit 7e1c28e5069b5c0efee97eb611920cc8c3b85d6f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 22:54:15 2010 +0100

    cosmetic

commit 7efb98f5dc25bf21c47c1c438728b816afb29803
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 18:55:21 2010 +0100

    oops

commit 4ea87dc8437d84bba51b8ea81f902549b845d71b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 18:16:49 2010 +0100

    cosmetic

commit f78fd8fdf03f7081973bcf39e71276bf48f60a2d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 17:55:52 2010 +0100

    cosmetic

commit 7fcb224166ba0eeec3564bc0b6b01311fe552ebd
Merge: 13291e27f a52a3b1f3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 4 12:12:56 2010 +0100

    Merging bug 22671 onto default

commit 9f463b31b70e35f8983181f7ab9f431704fbc9a3
Merge: 3eb7649eb 13291e27f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 4 07:49:49 2010 +0100

    merge default into bug21673

commit 13291e27f56b107b1585d3937aad5ec16ea66d38
Merge: b57ebc9d1 3269e674f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 4 00:07:18 2010 +0100

    Merging bug 22616 into default

commit 3269e674f1cc588388dc16e86c8914dc134ba8ec
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 3 21:20:14 2010 +0100

    pluggable queue backends
    - behaviour and specs for pluggable queue backends
    - reworking of the queue code to support pluggability, including
      hookups to memory monitoring and file handle management
    - interface to existing persister via the new API
    
    All these changes were cherry-picked from the bug21673 branch.

commit 3eb7649eb43eb01e19eea7ee0f4b6c874b310af7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon May 3 15:56:06 2010 +0100

    Improvement to docs on BQ:sync

commit e118da00ff6e6d789fff8adc059465556c49934a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 19:46:30 2010 +0100

    cosmetic

commit 122fc41988c068d2925b95804aeab8bf4c167dd9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 19:16:41 2010 +0100

    cancel queue's timers on shutdown
    This is cleaner, though not strictly necessary.

commit 9fb731afcc9758cd445acc870d27900fbfd338e8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 15:07:02 2010 +0100

    cosmetic

commit 74979e5c28b2577b6f1cae2d9c49e70d1bba5bb9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 15:05:50 2010 +0100

    restructure backing queue sync'ing
    The code very much relied on the fact that sync_callback would always
    return the same fun when a sync was required. So it makes sense to
    capture that in the API by splitting sync_callback into a 'needs_sync'
    predicate and a separate callback handler.
    
    As a result we do not need the backing_queue_timeout_fun state member.

commit 835f6480f5f0c00c60c056807e4ea0c29eda8159
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 13:24:24 2010 +0100

    correct backing_queue:tx_{commit,rollback} descriptions

commit efd50fbde7bdf15655325bd0fbdb5da2d189e020
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun May 2 12:24:48 2010 +0100

    refactoring of sync timer setting

commit c4cbc18a833b9b8c9ec09d5bcb975ee5895bb95a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 18:31:25 2010 +0100

    cosmetic

commit e85420786aba085470d76f2bbaf13b1bbad0fa60
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 18:13:08 2010 +0100

    cosmetic

commit c3659f15e9fd3cc6342c4d01110eb556cd54feab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 17:40:13 2010 +0100

    FPid => Fun

commit 757f0550c47d52b24219ed3498fe0c4f81efc05c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 17:35:01 2010 +0100

    Cosmetics and minor refactorings

commit ad2797a3c86d3da1ecfaf1336f134af1f1b239a7
Merge: 799f59b18 8d60005b2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 17:34:21 2010 +0100

    merge bug22616 into bug21673

commit 8d60005b21990e744fab93c15c7b2d0baed4592f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 17:31:42 2010 +0100

    hook queue processes up to file handle cache
    This doesn't do anything here, since in their current form the queue
    processes do not use the fhc, but that will change in the future.
    
    This change was cherry-picked from the bug21673 branch.

commit 799f59b186094c6510675f5af76c09f9862adf5d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 17:29:12 2010 +0100

    move queue's fhc registration from startup into init handler
    so we don't do any unnecessary work in case the queue process gets
    terminated before initialisation is completed

commit 6c0a44b866048162b44f49791305d9caab7d1800
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 16:40:35 2010 +0100

    cosmetic

commit 5e52def50bfb33718cf8a518f4011c67187d947e
Merge: 0a1b06271 b4b40403d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 16:23:35 2010 +0100

    Merging bug22616 into bug21673

commit b4b40403d6d3a8431ec174e15bea84a1b0f615dc
Merge: 9612925dd b57ebc9d1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 16:21:30 2010 +0100

    Merging default into bug22616

commit b57ebc9d104ab2db4b44b874181db1cf21ecd2c2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 16:14:42 2010 +0100

    Pulling good patches off bad head of default

commit 0a1b0627161542d554ac70bb30df69795d787f0f
Merge: 12368aa04 9612925dd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 16:13:56 2010 +0100

    merge bug22616 into bug21673

commit 9612925dd09b90cb88595e5a31ba681aab2f131a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 16:03:35 2010 +0100

    cherry-pick file_handle_cache from bug21673
    and its integration with the tcp_acceptor and worker_pool code

commit 12368aa0434440862bf6bb51145f70b5d7528084
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 15:41:29 2010 +0100

    Make the msg_store_gc register an fhc callback

commit 3800c0edf4c5073bda8a6427be233021948456bb
Merge: 5f9e91a36 c925bba84
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 15:29:15 2010 +0100

    merge bug22616 into bug21673

commit c925bba84ec637b82f0180e9234d1e12c19fc364
Merge: 4eeddb1ba 86ab54a9e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 15:24:52 2010 +0100

    merge default into bug22616

commit 5f9e91a36dd2836c4deb3f24784dd87f2f1e918c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 15:07:58 2010 +0100

    Add missing specs

commit 6b61e6579e782d3ea6e71c7564580165d549ff4c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 14:55:34 2010 +0100

    Make the logic on result of soft_close match that on hard_close (i.e. full put if there's an error. Don't touch the gb_tree if there's no error. Also, revert back to two diffs for client callbacks and mrefs

commit 86ab54a9e59139a42f927ad3480d11e520dd7dd4
Merge: f2e7894c1 9b63f6949
Author: Marek Majkowski <marek@rabbitmq.com>
Date:   Fri Apr 30 14:38:40 2010 +0100

    bug22637 merged into default (erlang version check on start of the application)

commit da356417787d39f06d58a285eb1025b0327c2c2a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 14:37:54 2010 +0100

    gb_trees:delete crashes if the key is not in the tree. I kid you not.

commit a52a3b1f3eab0c9c558966cfa5704a3365441cb2
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 13:51:58 2010 +0100

    Revert incorrect R12 cleanup
    
    The corresponding change actually went into the R13 gen_server.
    Update the comment accordingly.

commit 8ff0007d52838870cf31133a51529b4b9a13cf4f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 13:28:53 2010 +0100

    reduce_timer_set => timer_ref

commit 2c9320f061a83adca550597f2a69afb698efe331
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 13:22:16 2010 +0100

    Don't allow lots of timers to be started

commit dbf7bd2c0d6f3725c295d2ee1288755ec279ea00
Merge: 36bd21122 f6e3fee4b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 13:12:52 2010 +0100

    Merging heads

commit 36bd21122a387c0be477b1a8cabe52dfd15883e2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 30 13:12:41 2010 +0100

    Change register_callback to a cast, don't send messages in absence of a callback, and combine two dicts

commit f6e3fee4bc90155d41f746f8f2933bc6c6181e32
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 13:00:21 2010 +0100

    cosmetic

commit a4b80f1c9576b23837aa7c47b5df35170eee6ab8
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 12:25:45 2010 +0100

    Take advantage of R12's re in rabbit_misc:string_to_pid

commit dc4f18c5b3ea2198d4fd04902354349b20ed5604
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 12:25:45 2010 +0100

    Remove OTP-7025 workarounds - it's fixed in R12.

commit 68c8d3a5cedacd35e87bc39bab9e4565faede0b4
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 12:25:45 2010 +0100

    An R12 cleanup in rabbit_persister:handle_info

commit 087cdcbd0baf4bd5b064226263d25d644cda7afd
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 12:25:45 2010 +0100

    An R12 cleanup in gen_server2:name

commit 8b3497ebc435f158079effc6ff1e788c8fffc4cd
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 30 12:25:45 2010 +0100

     R12 cleanups from new persister branch

commit eab7e12334a3839e362c3ab762a5fd545f7f739c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 12:20:14 2010 +0100

    fix error handling in fhc:clear
    and remove some wrong (though benign) code

commit 2f64e75a56837113051974582b32189799dfade8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 30 10:35:52 2010 +0100

    cosmetic

commit 0beb8502628f2863bcc8289ba6f7dc38518b9d88
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 23:29:54 2010 +0100

    refactor: made 'close' control flow more obvious

commit a03fe938e8c81b7b3fd407852330ab30de934129
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 22:44:11 2010 +0100

    cosmetic changes and a little bit of refactoring on the file handle cache

commit dd764737b0d8440c5a538cb0e1a572bc23f2cc32
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 19:25:43 2010 +0100

    refactor: extract age tree manipulation
    These functions only have one call site each, but they are non-trivial
    and perform a distinct function and hence were cluttering the call
    sites.

commit 60994623b0706d4ecf70794a9933b63e79388cfa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 18:37:44 2010 +0100

    made logic in fhc:close1 less obscure
    the previous code was working ok, but only because handles were
    soft-closed at most once

commit 84bab75788c80aea64a2a4672beebaf8baedfb80
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 29 18:17:20 2010 +0100

    result, not return...

commit c9b044843fb1bda99111c90da5346da98f909dcb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 17:54:20 2010 +0100

    cosmetic

commit 5ef29ffd0acb5473224048cfd2a52e66bbd96744
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 29 17:47:12 2010 +0100

    Rename invoke_async as it's not really async.

commit f2e7894c124c07bb67fffd6b7483e5138713f853
Merge: d0d66420e 672c88563
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Apr 29 17:43:18 2010 +0100

    bug22264 merged into default (print erts version on startup)

commit 674c0be24bb33ba7b47c85012bc95ab5301a0966
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 16:49:27 2010 +0100

    cosmetic

commit a54862a3f1f7a46d528678f449034bc4c670aeed
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 16:45:23 2010 +0100

    Allow people to specify append, but silently map it to write

commit 4294a16ee355d5745db53e5198e517c8635eace7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 16:30:03 2010 +0100

    More meaningful specs for the backing queue, and removal of duplicated and potentially divergent documentation with the specs

commit 7f48fc21cd521f4926b7e3ebfce87805b0ae7f64
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 29 15:51:24 2010 +0100

    Commit 0ab19fce3677 broke effect visibility again! This time, go through a predictable process on the local side.

commit bfd6d1e53778ef710b2bbede50c880de551ecd89
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 15:44:59 2010 +0100

    Minor corrections to specs

commit 482b7aa06d03c15b22a7e4555ecc8275058247a0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 15:30:29 2010 +0100

    clean up fhc sigs

commit 62adff596dfba7580e519d116cfc3e50da87326f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 29 15:28:04 2010 +0100

    cosmetic

commit 672c8856360ada703a6b1b6a11d3ffca8d888f72
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 13:25:39 2010 +0100

    Apparently, we're not allowed to clutter the bunny. Hence added it to the settings listing below

commit 1d7af7b853501fb08489e279320b993225ca3b96
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 13:15:53 2010 +0100

    Display the erts version in the bottom right of the Rabbit banner

commit 9b63f69499147f03f40fd5d2481dafe0a4e61ab4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 13:06:42 2010 +0100

    Modify version_compare so that eg 5.0 is eq 5. On application start, check that we have a sufficient version of erts

commit 7922ef966f891b3211fab666c353a909e9012cd1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 12:36:29 2010 +0100

    Force the RPMS to only be installable with erlang 12b3 or later (though interestingly, it looks like there was no Fedora R12B-3 package - the closest I can find is R12B-4 which was in Fedora 8)

commit d0a21a68c6320775ee24cde87aa89a1f73f35624
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 12:18:52 2010 +0100

    Force the debs to only be installable with erlang 12b3 or later

commit d0d66420ec31e15ac27365ab8c76fd3a5bc1a77b
Merge: 086ed6664 782ca037a
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Apr 29 12:08:46 2010 +0100

    bug 22315 merged into default (+P 1M, process count set to 1M by default)

commit 782ca037a41abc3661322ed225ca6b6725002867
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 29 11:29:06 2010 +0100

    Bump the default number of processes to 1M

commit 79be0e2bebe8417785cf6ff0ee981c3247ac7e2a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 28 22:28:37 2010 +0100

    tiny refactor to align with 'default'

commit dbf1c9301160031151f350d7e5e649708ef0fec9
Merge: 9637395a6 4eeddb1ba
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 28 19:57:26 2010 +0100

    merge bug22616 into bug21673

commit 4eeddb1baa2972febb90af36e2a1f6a92b981b46
Merge: b1f3aad64 086ed6664
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 28 19:56:49 2010 +0100

    merge default into bug22616

commit 6324169a1041a601712c8dd12a36bfaed56b3cd4
Merge: 843339a9d e223ba8ff
Author: David Wragg <dpw@lshift.net>
Date:   Wed Apr 28 16:08:22 2010 +0100

    Merge default into amqp_0_9_1 (for the sake of bug22619)

commit c2384ddaef8a5fe1a6d3745efe12725bf44b5be9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 28 15:51:25 2010 +0100

    cosmetics

commit 95a04cb4b51a8760845900b44ef780c24e5b7a27
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 28 15:40:30 2010 +0100

    cosmetics

commit 086ed666442fe4be31fc4b965f0f6d54b2f8647c
Merge: 661cbcfd6 ddcf5b09c
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Apr 28 13:46:35 2010 +0100

    bug22629 merged into default

commit ddcf5b09ccca8c8cd52c17235559cba38f38349f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 28 13:26:18 2010 +0100

    Removal of 12B5-ism. All tests now pass

commit 9b12f0c30a2f001cc99da0a9072f0a474d326ffb
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 13:18:02 2010 +0100

    Don't use server(Hash) to name the delegate process.

commit 0e939912ef57f87c5de6dd96d2e4a62305e82d43
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 12:51:06 2010 +0100

    Explain asyncness.

commit baafee52be6f551fa26d13a5274e9a23ec7fc216
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 12:41:09 2010 +0100

    Always catch, don't ever allow the server process to die.

commit 4a6dad447066a372e6c10543d3d5a82825053586
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 12:38:27 2010 +0100

    Parallelise communication with multiple nodes.

commit 9637395a6117cf7ed626280de5b5fb723e89b109
Merge: 03f6fafc8 661cbcfd6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 28 12:25:57 2010 +0100

    Merging default into bug 21673

commit 661cbcfd65cc609ce6123d7d202e2e571df09817
Merge: e2fdeecfc daa79fb3b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 28 12:14:52 2010 +0100

    Merging bug22657 onto default

commit c65c7756f09035f7603c632de4391eb2415b0521
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 11:16:50 2010 +0100

    Move the gen_server2-via-delegate code into amqqueue; it should only be used there anyway.

commit 2da5a751ad3ad953f30cbdcc723304d81834b943
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 11:12:51 2010 +0100

    Rename delegate:call and :cast to :invoke and :invoke_async.

commit 5fff15ce420147aaa62936e28375d8aad21b95a2
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 11:06:01 2010 +0100

    Cache the actual delegate process name, not the result of process_count.

commit c5a04e9a064e984db85645458649309baff81702
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 28 11:00:27 2010 +0100

    Remove gen_server2 use, bump up timeouts, tidy GoodRes / BadRes checking.

commit daa79fb3b9532674c4a49140afc341a12c7bbb0c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 21:26:08 2010 +0100

    remove tx-related queue info items
    since their presence exposes an implementation detail

commit 03f6fafc836faec6a63fac992f7616374b80bc59
Merge: b5c81df9d b1f3aad64
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 20:15:25 2010 +0100

    merge bug22616 into bug21673

commit b1f3aad647a7e7c0bcc522430a0acdaec9041921
Merge: d1d73c580 e2fdeecfc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 20:14:40 2010 +0100

    merge default into bug22616

commit e2fdeecfcb86f736f42d5bafb61479674b84041d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 20:14:04 2010 +0100

    cosmetic: remove trailing whitespace from doc templates

commit 8bfb74f07287956b6c25680275bd009f67a5cf52
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 27 17:32:51 2010 +0100

    cosmetics

commit 98122bb54b687457ac04573f40d370e2a6e7e5e3
Merge: 9be1b2ce2 0c27fe840
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 27 13:18:37 2010 +0100

    Merging default into bug 19844

commit b5c81df9ddee18bb0e0f65fcac986580922b5df9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 13:07:55 2010 +0100

    refactor: move type spec since it's only used in one place

commit 82cb346aac9a4260c3e76dcdf98be33d2afaa286
Merge: 932640294 d1d73c580
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 13:00:11 2010 +0100

    merge bug22616 into bug21673

commit d1d73c58024f42b9b16fa6fd6ff0e00e46838c0b
Merge: 2863a4581 0c27fe840
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 12:58:51 2010 +0100

    merge default into bug22616

commit 932640294bd4d2c42f20f54af0fda16fa71e993f
Merge: 951103a3b 5bdd65b8b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 12:56:13 2010 +0100

    merge default into bug21673

commit 0c27fe84074529409350dc8eb56519390434a396
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 27 12:49:03 2010 +0100

    Sanitise boot steps somewhat - a couple of steps had no 'enables' clause, meaning potentially they could be run last, which would not be desirable (eg exchange recovery after networking up?

commit 5bdd65b8b35c043fed3565116b28f4408d3fba45
Merge: e223ba8ff eb44578ec
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 27 12:32:07 2010 +0100

    Merging bug 22651 into default

commit 951103a3b68add0f9d44fc3a3fad5d999783f0eb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 27 12:06:37 2010 +0100

    Turns out on commit, the msgs really really should go at the end of the queue, not the head of the queue

commit 16ab3b0f892cffc95af60066794d6a7c3e9fc484
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 11:13:35 2010 +0100

    minor refactoring

commit 6550aafab253053c226376752a011d49bf914cee
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 11:02:30 2010 +0100

    simplification

commit 848792f5adb5843d35d4343267169cbe100f406c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 10:50:12 2010 +0100

    some inlining

commit e223ba8fff109678397c561fda3b4e0b5011864c
Merge: a0af3c4ff 2abce2db6
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Apr 27 10:35:43 2010 +0100

    Merge heads

commit a0af3c4ff23b3921f0e2615a8a5e4cfef072a3e5
Merge: 9637b0056 ab7d11a27
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Apr 27 10:29:07 2010 +0100

    Merge 22619.

commit eb44578ec9261160bb7c47259a9c7a9b023719d6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 05:43:20 2010 +0100

    explode on attempted double initialisation of queue
    which inidicates a serious bug and thus we shouldn't ignore it

commit 9f619c31bafe8726d13f810d34738d54a1805cfe
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 05:42:07 2010 +0100

    explode on attempted double initialisation of queue
    which inidicates a serious bug and thus we shouldn't ignore it

commit 9adca0465222f0b90b129daf9a505a24b30c394b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 05:40:03 2010 +0100

    more selective backing queue initialisation
    Tell BQ:init whether queue contents should be recovered. In the case
    of invariable_queue this allows us to suppress any interaction with
    the persister on queue declaration, which is beneficial since the
    persister can be a bottleneck.
    
    There may also be scope to utilise this knowledge in variable_queue at
    some point.

commit 94bbff94e5e042a8143b47b230c53a9955cbca84
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 05:16:48 2010 +0100

    oops

commit a872bd426153d9d8a7d3f255f92241c9ca1ad926
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 27 05:12:25 2010 +0100

    turn queue recovery upside down
    instead of the persister pushing recovered messages to the queues, the
    queues pull recovered messages from the persister.
    
    This allows us to perform queue recovery before recording the
    existince of the queues in mnesia, and thus prevents access to
    potentially uninitialised queues from other cluster nodes.
    
    It also makes the dependency between queues and the persister one way.

commit 40a5ea96100bc33ca209471e4ee331869fc36feb
Merge: 5ac0dae17 2863a4581
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 21:09:41 2010 +0100

    merge bug22616 into bug21673

commit 2863a4581e0032bd267f196c1ac3a73168f7f5bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 21:05:58 2010 +0100

    fix typo

commit 1a9e37fbe7576b5312192f3eeecbb3fccef10507
Merge: 7b3fd92c5 2abce2db6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 21:05:43 2010 +0100

    merge default into bug22616

commit 5ac0dae17e7721fc18fdff31fae20fdeed7496d7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 20:54:41 2010 +0100

    cosmetic - less obscure function calls
    Unfortunately fun M:F/N only works if M and F are atoms.

commit 2abce2db6cb2af6f0f55efdc8f409f8b7a0470e5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 19:13:28 2010 +0100

    cosmetic

commit 04df18da4a906194530abdb6d55e5571257e5e3d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 19:00:00 2010 +0100

    guard against operating on uninitialised backing_queue_state

commit 9be1b2ce233388e407cfe8ff51b196c831bef0a7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 26 18:50:45 2010 +0100

    Fixing up coverage - it would appear the coverage is *very* sensitive about how it gets started

commit af5be2c30446e6fb83c83096b7ca6d929f103c5e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 18:45:02 2010 +0100

    remove redundant call to memory_monitor:deregister

commit 9f1cd2e1905daba7e15642f542fc23a22b32307a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 18:44:10 2010 +0100

    consistency, consistency

commit 61474916926f6ea04457aa43b7e09ae6efb2b651
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 18:19:16 2010 +0100

    simplify queue startup
    by going through the same three-step sequence (start process,
    init_backing_queue, sync) in both recovery and creation

commit 843339a9d5b94264d157859cc57cc0cf8b3c60b3
Merge: 12fa85e5c dd2c9913d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Apr 26 18:05:20 2010 +0100

    Merge default into amqp_0_9_1.  There was a conflict in
    rabbit_amqqueue.erl, due in the main to recover/0 being removed and
    refactoring of durable queue recovery in general.

commit 7c667f7005d66983188ae21c4e498ba219830f93
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 17:52:22 2010 +0100

    ensure queues are fully initialsed before we advertise their presence
    Previously in a clustered setup a channel on another node could have
    found a recently recovered queue before that queue had been fully
    initialised and recovered its content.
    
    Fixing that turns out to be simple since the main obstacle - the
    re-declaration check for recovered durable queues and the associated
    atomic update of the record with the new queue pid - can be removed
    since it became superfluous with the changes in bug 20916.

commit b3bb364725f16585433cb9b5c8019a98a5a7a2b2
Merge: 7e671d094 9637b0056
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 26 17:43:34 2010 +0100

    Merging default into bug19844

commit 765cb302de7b1e01a84490d56f4b8ed8e0f32801
Merge: fb85ee7b0 9637b0056
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 26 17:13:55 2010 +0100

    Merging default into bug 21673

commit 9637b0056fb1112022bda43e5451bee9237d7f63
Merge: a11602c05 aaf0564c8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 26 17:03:43 2010 +0100

    Merging bug 22584 into default

commit fb85ee7b086fa06cebe0eb22dddc1a89e3b6b4e4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 26 15:55:55 2010 +0100

    simplify queue recovery in old persister
    instead of constructing a temporary data structure for all recovered
    messages we simply extract the messages from the snapshot on demand.

commit d1a7c2ac8aabf7446d86ccb7d5c0d59aee428aa2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 26 15:02:31 2010 +0100

    Because of the exposure of AckRequired into the interface, the counting of persistent messages has potentially been wrong for a while (previously only decr on ack, but actually need to maybe decr on fetch too). This can have the effect on startup of telling the queue it has more messages in it than it really has, which can cause an infinite loop

commit 5d13241c57732c7197678f381ccc2e6efab57b6b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 25 11:59:57 2010 +0100

    unused var

commit a6055b7173f25ef59bb188c6d7f96f0bdc27fd81
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 25 11:59:18 2010 +0100

    A cosmetic in vq, and a fix in tests for a bug which was causing the persister tests not to run

commit 00e61d46b64953e503e84a37a144ed81a743d302
Merge: 6763c0db0 a11602c05
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 24 14:28:06 2010 +0100

    merging default into bug 21673

commit a11602c05cc18553325f2a2f87d43c7d1617e2f4
Merge: b5371af45 a612c922b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 24 14:20:49 2010 +0100

    merging bug 22647 into default

commit b5371af45771885b58ac84bcc27972ebeb8224e0
Merge: 0e5d69286 3e5063939
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 24 14:18:04 2010 +0100

    merging bug 22646 into default

commit a612c922bced1725dbcf7e5365d57fc3ceec17c1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Apr 24 13:11:25 2010 +0100

    change guids to fixed-size binaries
    This change was cherry-picked from the bug21673 branch and brings
    'default' closer to that branch.

commit 3e5063939d5d9dd251b83f30c25b1606b454fcd4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Apr 24 12:22:27 2010 +0100

    remove legacy serial seeding
    thus making the guid generator fully independent of the persister

commit 0e5d69286fe6826da4def40023c30c5f9232b057
Merge: a05c341bc ce60eb13a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 24 02:27:57 2010 +0100

    Merging heads of default

commit a05c341bc1ffcf2f87e5bf600e3f32f8690bf5a7
Merge: 1bbba45fd 4ecdc79c2
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 23 17:58:55 2010 +0100

    Merge bug22407 into default

commit 6763c0db04b4d3332a8f4175f68edc4fcb98a792
Merge: c0d68bdbc ce60eb13a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 23 17:47:54 2010 +0100

    Merging default into bug 21673

commit ce60eb13aa1676e0805e6a00850c0a0b6afd5906
Merge: 1bbba45fd 445d19332
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 23 17:39:02 2010 +0100

    Merging bug 21974 onto default

commit 445d19332c98e02cea3bd70c7f773405a0251987
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 23 17:37:36 2010 +0100

    re-fragment content
    so we only produce the minimum number of frames necessary

commit c0d68bdbcad03b27f0d8d0ad6c552bd645606e08
Merge: 92e5da9c6 1bbba45fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 23 11:40:18 2010 +0100

    Merging default into bug 21673

commit 1bbba45fd6e09989da671c4454a31098b3f6ef04
Merge: 0a51929e0 264733d01
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 23 11:39:48 2010 +0100

    Merging heads

commit 264733d0183c60a6e5ed713308f1bb2919b6cc73
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 23 11:38:54 2010 +0100

    Backed out changeset 1db0ab47b6d5 as the change will create silent failure for configurable plugin users who have not moved from the default config location.

commit 7e671d094da670ca0b519ee8936cce9da016b0c9
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 22 18:29:25 2010 +0100

    Add / fix specs, and remove some unreachable code.

commit ca953358dbd6dfc611eb5b5eba1cd8342a3e079d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 22 16:56:42 2010 +0100

    If the other node is down and we're only going to delegate:cast anyway we don't want to log an error, so handle badrpc by ignoring it.

commit 21a21dd66a01957699f110bd85a192303bea2365
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 22 16:41:43 2010 +0100

    Use 2x CPUs as the number of delegate processes.

commit 0a51929e0fbed5d6895b9577a55dbc561daaa36f
Merge: bd7712735 66c8d1334
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 22 14:49:18 2010 +0100

    Merging bug 22615 onto default

commit 66c8d13341a074fd3e7978e5b385f765c8d7d895
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 22 14:44:57 2010 +0100

    Cosmetic, and missing specs

commit 565f05c2b5098292c70813b12e2899e9d9ef4e70
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 22 14:33:32 2010 +0100

    cosmetic

commit 0e6225f1195594225ccb3a834c110e7911aeae5a
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 22 13:10:16 2010 +0100

    Use phash2/2, remove string:concat.

commit 26dc835803fc00b3305745e06f989432538b447b
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 22 13:07:13 2010 +0100

    Remove delegate_sup_sup, make delegates restartable on error.

commit 6b5f032f6043db8066570145d5f0b2ee63396d69
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 21 18:13:56 2010 +0100

    Roll secondary node coverage into "make start-cover"

commit 5d1d5400b5c1027d91dba12cb758be648a915b47
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 17:43:49 2010 +0100

    Cosmetics

commit 617bf6e64470e7946e6a355b88e0d67c2054d539
Merge: 5cfa6ee0d 7428f95d6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 17:13:26 2010 +0100

    Merging default into bug 19844 (debitrotting)

commit bd77127353240e3c9694a47579ae940c10a0e985
Merge: 7428f95d6 34199cb7c
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Apr 21 16:03:50 2010 +0100

    bug22500 merged into default (OCF/Pacemaker)

commit 92e5da9c6f30dafdf3ece603f0563a2c4866f66f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 15:53:33 2010 +0100

    Added the old persister (slightly mutilated) and an invariable queue as a backing queue which uses it. Passes all the tests.

commit 6044c25d7d3aa6aabcd269ebed7f402eab29735d
Merge: a1508bd55 7428f95d6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 12:59:57 2010 +0100

    Merge default into bug 21673

commit 7428f95d69a819bf809d9c22156a64d4032cbcf9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 12:59:25 2010 +0100

    Correction of specs which have been wrong for ages

commit a1508bd5542e5f04ce41806ea24acf639568f164
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 12:32:43 2010 +0100

    Adding a forgotten type spec

commit 9b93f98947c13848c9ac861b2b3d57b91b6ecb83
Merge: 154119315 33d1a8e83
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 21 11:35:21 2010 +0100

    Merging default into bug 21673

commit 33d1a8e83877de9a743995b87318118a8a74d59d
Merge: 39f523444 8e6dda99d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 20 21:56:22 2010 +0100

    merge bug22628 into default

commit 8e6dda99dc05e978dc9bd7706bba4e9214435ae2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 20 18:20:03 2010 +0100

    Flatten out a tuple

commit dfe3a488ba1d750543db6c85d3b6c4965d72bfff
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 20 18:10:21 2010 +0100

    Correct list comprehension

commit 39f5234446eaefa988517821851af8fab02ce3a7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 20 16:20:24 2010 +0100

    cosmetic

commit e394a91af44c7a6bbe03d84260f0c59e58b53a9c
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Apr 20 16:01:46 2010 +0100

    Make start-secondary-cover actually do something, stop Erlang tests blowing up.

commit af162a6fd5fbc5db1eca923b3431940e7c812600
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Apr 20 16:00:52 2010 +0100

    Allow enabling cover for secondary node.

commit cac00556631b8cd150a71fa3ebae3cd67bdfda1a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 20 15:45:56 2010 +0100

    Use a sequence ID when combining entries into the snapshot. This can then be used to correctly sort the messages and remove the dependence on increasing guids

commit 1541193155b4dd1870111fcb4f7a61ab11b5d369
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 20 14:15:51 2010 +0100

    Switched the From to a Fun and hence CPS

commit dd2c9913d29f9abfbcf82ab53ef5c388900e89bc
Merge: 0d8d542ce 0b970f91e
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Apr 20 20:29:37 2010 +1200

    merge heads

commit 0b970f91ef7d5a6a810110a661c9a14c8af348ef
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Apr 20 17:22:26 2010 +1200

    Have a default config file for testing with make run

commit 7531d0f281c1a7a652336e31dbcaeb502b6715ab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 19 16:19:56 2010 +0100

    Lots of fixes for handling of acktags, which was badly broken in some places

commit 5ea831a8b641f8282f375972a65038d85440760b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 19 15:49:36 2010 +0100

    Whoops

commit 4602409e598987b94bc9a519d0e64c1694a06e00
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 19 14:31:40 2010 +0100

    Sort out handling of acktags in the queue_process. Use a set throughout - this avoids the unpleasant lists:usort on every ack (which is what ordsets:from_list does). Also, don't bother with the intersection - just assume that we're only given acks we really know about, which the channel should be able to guarantee. This results in a performance improvement from MulticastMain -s 0 -r 12750 to MulticastMain -s 0 -r 13900 : i.e. 9%

commit 5cfa6ee0d45225df5b14ea51e8003aa9f551e873
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Apr 19 13:37:32 2010 +0100

    orddict is much faster given we only have a tiny dict.

commit 42b0b0f3695edeb479164738332dad172583082f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 19 09:10:46 2010 +0100

    Beef up assertions on combine deltas, but it doesn't appear there was a bug here anyway

commit 3b654cdd71366f6cbdae37a7fff95a6b38cd35a6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 17:21:09 2010 +0100

    Switch four megs to a fraction of the file size limit

commit 1b2194acf4ed96507129f5f50d7c7413efcbb923
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 16:47:25 2010 +0100

    Correct mistake in indexing into pairs of GC candidates

commit 4e0e38054ce7c1351da8d23e50895b3dbbd37d14
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 15:04:56 2010 +0100

    Make use of fhc:delete now that we have it

commit 90a5aacaf717c8d34e6dd710afe54d38681822d9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 12:19:54 2010 +0100

    Another missing infinity on a call

commit 3f8a89eed73fdef9dd0df51a744449e69d31ce0f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 12:18:49 2010 +0100

    A cosmetic and a missing infinity timeout on a call

commit 28c6ed4a02943e19ce9c65f9a856f463f27a79d6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 18 11:58:35 2010 +0100

    Rewrote scanning of message files, to read in blocks of up to 4MB (hence bounded) but can still cope with variable sized files. The advantage here is vastly reduced number of OS calls to position and read. The results is that in tests, GC time is reduced from around 35 seconds to about 2. Code is also 7 lines shorter - and arguably simpler - the only tricky bit is reusing left over data from one block with the next read block, hence different read and scan offsets

commit ab7d11a2797402cd26fc385bd557f1856715a9bc
Author: David Wragg <dpw@lshift.net>
Date:   Fri Apr 16 18:50:27 2010 +0100

    Increase the backlog on the listening socket backlog to 128.
    
    The erlang default is a rather low value of 5.  128 is the default
    maximum under Linux, so seems a reasonable value to go for.

commit 3c5fb288e4fb9533da6143dd30770c2f7194fb70
Merge: f92a772f6 7b3fd92c5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 17:45:08 2010 +0100

    merge bug22616 into bug21673

commit 7b3fd92c552d9b114c25f7f8077185fcfe92c2ea
Merge: fa7eeb56b 0d8d542ce
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 17:40:58 2010 +0100

    merge default into bug22616

commit f92a772f6b759945b17c01dca29f5c611b27b46d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 17:38:03 2010 +0100

    On commit we must know about the channel

commit 0d8d542ced01c0ff63abb2336cd963e9acb237b4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 17:38:01 2010 +0100

    tweak tx API on amqqueue
    commit_all and rollback_all take the channel pid as an additional
    arg. This brings these functions in line with deliver and ack, which
    also take both a txn and ch_pid.
    
    In the queue process this saves us some book keeping.
    
    Also, in the queue process we need to clear the txn field in the ch
    record on commit/rollback, since otherwise a subsequent channel 'DOWN'
    results in some suprising and unnecessary, though perfectly safe,
    control flow.
    
    Finally, there is no need to check that a commit relates to a channel
    the queue process knows about - this is always guaranteed to be the
    case.
    
    All these changes were cherry-picked from the bug21673 branch and
    bring default closer to that branch.

commit 092187dee9b4cb5c5c86bf38eb4d1d4a13978dbb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 17:11:48 2010 +0100

    set channel txn to none on rollback

commit af028953deb139b92a1cdaa455dae927a25b69cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 17:11:33 2010 +0100

    cosmetics

commit 819908f534c13d3f31d775a315956178ef897012
Merge: 103567b6a 3aa6365ce
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 16:23:52 2010 +0100

    Merging heads

commit 103567b6a6f28d23051072f9cd8d26e6ff392076
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 16:23:42 2010 +0100

    cosmetic

commit 3aa6365ceab44e87d82f7a010182e788baff4b9b
Merge: b53e55cfc fa7eeb56b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 16:06:14 2010 +0100

    merge bug22616 into bug21673

commit fa7eeb56b6ed840bba5302b4f3e8bec117f59ce6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 16:05:42 2010 +0100

    add memory_monitor

commit b53e55cfc5e96834325b38dc75bb107f417f242b
Merge: cf5688e4c dab4d70c7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 15:54:00 2010 +0100

    Merging heads

commit cf5688e4c5ceaf3e8e176126732206fcd08db279
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 15:53:46 2010 +0100

    Capture more information for the next time the freaky GC error pops up

commit 814aabb780c3aa3dc848fe936a737b7f811d6218
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Apr 16 15:25:18 2010 +0100

    Don't pass around lists of lists for no reason.

commit af27f4f21ee67cc2b59b2496f9c1d78b4a318ecc
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Apr 16 15:16:15 2010 +0100

    Reimplement the local optimistion, refactor quite a bit, fix delegate to actually do fanout properly (oops).

commit dab4d70c7c600b833ee1d05c39e5fa0e9b126a26
Merge: b3f14754a 9ac8b397d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:38:08 2010 +0100

    merge bug22616 into bug21673

commit 9ac8b397d0a1e86ce18930eb271463f3dd767dda
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:37:35 2010 +0100

    oops

commit b3f14754a325f3516ade05ee630793e24e8281d8
Merge: e8707c3e0 b286b0c57
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:34:48 2010 +0100

    merge bug22616 into bug21673

commit b286b0c5793e30e8b22d04f3c79bf3a70eac9e71
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:33:17 2010 +0100

    qa supervisor2 and its use in amqqueue/amqqueue_sup
    Queue processes are now terminated nicely (and the supervisor waits
    for the termination), but this won't make any difference until queue
    processes trap exits and do something interesting on shutdown.

commit e8707c3e061125e853bff2db886e12283987d4b9
Merge: 2f081e4a6 77001fd4d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:21:42 2010 +0100

    merge default into bug21673

commit 77001fd4df8f02954d3c3c24ef636f997c228aab
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 14:16:07 2010 +0100

    minor refactoring

commit 2f081e4a682fb3f0bedcd619a85f88ba22f470ca
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 14:14:35 2010 +0100

    Whoops, wrong record

commit c0ba7b2d281834605eb60c67b5cfa97d6c24b759
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 14:02:22 2010 +0100

    Changes to the way we track messages that are pending acks to ensure that on queue deletion we remove everything from the message stores that shouldn't be there

commit 67b986d695826fe3d906f95e0b886a26790c75c2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 11:55:02 2010 +0100

    Cope with queue death even though there are in-flight commits going on

commit a38eb2d9ffb1740bde3f79c38505f19db4646cee
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 11:21:25 2010 +0100

    Updated documentation

commit e536883a55eeacc6c49cbc6276571ce50e09921b
Merge: e6ab220d0 58c4ddd6e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 11:14:54 2010 +0100

    Merging heads

commit e6ab220d0f26546730ce34d126e010028c8d2320
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 16 11:14:08 2010 +0100

    Thorough reworking of API - the BQ is now responsible for hanging onto unacked msgs and all details of transactions

commit 58c4ddd6e58a4c6aab8d3e6a4fd44e1836bdf5f2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 16 09:58:24 2010 +0100

    cosmetic

commit 51602c4f929368e8ac34eff1aae9f8d801f6bd74
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 18:39:19 2010 +0100

    Go back to using closures now that we can, refactor a bit.

commit d2c4ae88b0b524c9a53f35e032e6344826fd06f2
Merge: f50ee71d7 01ea18f76
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 18:11:27 2010 +0100

    Merge 22615 again.

commit 01ea18f7697eecfcbd72722bb5337d41b07ee4d0
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 18:09:53 2010 +0100

    Make start-secondary-cover actually do something, stop Erlang tests blowing up.

commit 2a07023aa1c4e1a867a65636b85d38cc7e995596
Author: David Wragg <dpw@lshift.net>
Date:   Thu Apr 15 17:33:01 2010 +0100

    Final small portfile tweaks to exactly match what's in Macports.

commit 369fdd03cdc8225ecbaa562aec975b489af015e0
Merge: 52bc28f38 5c5c868ba
Author: David Wragg <dpw@lshift.net>
Date:   Thu Apr 15 17:20:57 2010 +0100

    Merge from default

commit f50ee71d77000bb193bf5b6f63e217295a519e49
Merge: 9d4ec7e06 92e6b5e52
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 17:20:40 2010 +0100

    Merge 22615 in order to carry on.

commit 92e6b5e5277b7136d209023e904891467e8db0cc
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 17:19:12 2010 +0100

    Allow enabling cover for secondary node.

commit 40fce1176a4630817e7d65103d2559c0659c45dd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 15 14:03:05 2010 +0100

    cosmetic and minor refactoring

commit 9d4ec7e067788a614751ce5df7e72e7be7cc4324
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 12:15:08 2010 +0100

    Java tests need the cluster to be left up if there's more than one node, see bug 22613.

commit 16a88175f8e00bab805bbfd28eec0e78f6939c6f
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Apr 15 10:55:20 2010 +0100

    Don't run delegate tests if there's no second node, remove use of closures since the coverage analyser breaks them.

commit 183085e1c386bac6342302a92ea2cf865ebdb8fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 13 15:47:20 2010 +0100

    tx_commit takes a list of publishes, not a list of guids

commit e3c5ef30c51c62ad6ccc290bd35d0371a84ed91a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 13 12:32:32 2010 +0100

    Whoops - redeliver was only used by the old persister and was removed from _process months ago

commit 170ab1dccdd137115de074f6d585949f9dfa31e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 13 11:55:56 2010 +0100

    queue_index doesn't need to reimplement recursive delete

commit cad9206fa97c1c0364cd55a1c099818180148bc5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 20:24:14 2010 +0100

    rename backing_queue_type to backing_queue

commit b83ae1f9f68af4792979b94507b715650f2b8c44
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 19:59:14 2010 +0100

    fix typo in docs

commit 5c5c868ba1e4e1f64cda44ec5d5b6e51241f0964
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 19:56:03 2010 +0100

    fix sigs on persister that have been wrong for ages

commit 34199cb7c7e211c7bb9047c44acf5f35e7932eb8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 17:26:43 2010 +0100

    Only export vars when they're needed, and don't do a full verify unless it's needed - the problem has been that the verify dies because eg the config file doesn't exist, but it doesn't exist because of, say, drbd not being primary+mounted...

commit 3799e9be9f1cf8fd1cae1f61029e173079f14170
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 15:41:31 2010 +0100

    Whoops

commit c44b5d55def44fb58a5cc432d46451218a307639
Merge: f14a729ba d5babd41f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 15:37:46 2010 +0100

    merge default into bug21673

commit d5babd41f6b04efca189c6fdc14776cc46b584e1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 15:35:06 2010 +0100

    introduce rabbit_misc:recursive_delete/1 helper

commit f14a729bad712c784dfefa39b48221793467e0e6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 15:33:14 2010 +0100

    Removed rabbit_variable_queue.hrl

commit 06059184b1e55ec86efd83ea5de9f8588f1de9d8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 15:27:58 2010 +0100

    refactor: introduce file_path() type

commit 3de13e6483e3c3ebf3886b0862a22bedb9b58e77
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 15:27:36 2010 +0100

    Reworked msg_store startup sequencing so that qi need not know about the msg_store

commit 06e55232d23d43b95e7df4b9c5aa4328cc9db955
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Apr 12 13:52:57 2010 +0100

    Clean up exported function names.

commit f57d4ad92f64c59c1d64147db03830de1abba17b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 13:45:11 2010 +0100

    Refine the type of recursive delete

commit ca7b5943e84557fe5ea15d579696b62e13e24fe8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 13:41:31 2010 +0100

    Be more consistent about errors

commit 81295777b2e867ac321be609965abbd92b035897
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Apr 12 13:41:01 2010 +0100

    Remove upmap that was causing tests to fail, remove "optimisation" as it's not doing the optimisation we wanted.

commit 8f353e401feccfff4bbdd8bd552d0d67a76999d0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 13:23:16 2010 +0100

    Fixed recursive delete - it now takes a list of paths, and it deletes directories it comes across

commit 99705adce48e010cdb17916c9b0aa63d5343fcb1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 13:22:21 2010 +0100

    cosmetic

commit 1bb28855cdf86b1abb3f3c5300e0e5d0de5bd0a6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 13:12:52 2010 +0100

    refactor: inline rabbit_misc:random_geometric
    it's a tiny fun and is only used in one place

commit f9f396f90d214abbecbd21361e78502c1b3ce42f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 12:43:37 2010 +0100

    cosmetic - reduce diff w default

commit 3e968fe80353d62def78fa25dc33bb48d672c6a6
Merge: ce8e794a8 0c30a3f63
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 12:42:12 2010 +0100

    merge heads

commit ce8e794a8b3d6c77d65a14295bfd9bacb15f9929
Merge: 9f3b55b93 1dab90ba8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 12:41:45 2010 +0100

    merge default into bug21673

commit 0c30a3f63b84644a8ebd4f11e7b02a497c9379e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 12:40:20 2010 +0100

    s/(rabbit_variable_queue:)update_/\1/g. Also, fix in amqqueue_process where the result tuple was the wrong way around

commit 834f532f059b894f401ef385907fab5c8db29621
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 12:30:37 2010 +0100

    Combine ram_duration and update_ram_duration

commit 1dab90ba8b50902e3da172f05bd73bab95fb90b7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 12:22:51 2010 +0100

    combine queue sup startup and recovery
    There was actually no compelling reason to start up the sup earlier -
    nothing needs it, not even the node_monitor that supposedly depended
    on it.
    
    This narrows the interface on amqqueue and brings 'default' closer to
    the bug21673 branch.

commit 9f3b55b939b29c46188e7e90937bf8edc204793f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 12:21:50 2010 +0100

    MsgId => Guid. All tests still pass. The distinction between msg_ids and guids is now complete

commit 703a4168d0f612544f657d0f51bdd8710f5dca1b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 12:05:56 2010 +0100

    Fix the refactoring which broke bpqueue

commit 2a30a233aeca8fb95a3312ce9c950d1749081144
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 11:55:36 2010 +0100

    msg_id => guid in type specs, field names and function names. Vars still todo

commit b28110d7200286b92e17ad4bb1d728aa9c89215a
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Apr 12 11:37:21 2010 +0100

    Port various queue operations over to the new delegate system. Unfortunately this doesn't fix the underlying bug!

commit e71d2d1311d53ea099e83e765c7db64f7407eb9b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 12 11:28:16 2010 +0100

    Apparently, abuse of empty queues is unsightly. Also, minor improvement to documentation

commit a4196b06525dffd8fb53362d4a54dc55c17dbb7b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 11:24:59 2010 +0100

    rename rabbit_misc:geometric/1 to random_geometric/1

commit 16a3cbcf6e34977d6a4b49492b09e9ac512f2c02
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 10:17:49 2010 +0100

    refactor

commit 18be7aa751659004030380c963edaef929092ea2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 12 09:20:31 2010 +0100

    add rabbit_sup:start_child/3
    This fleshes out the API. The change was cherry-picked from the
    bug21673 branch.

commit ae0e2e274b2448cd2aec8858b49666f0867183a0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:41:30 2010 +0100

    Cosmetics for unification with default

commit 5fd2883bb3e196b1682e399d08ba31753c980056
Merge: e8983d647 fa0aa0302
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:37:09 2010 +0100

    Merging default into bug 21673

commit fa0aa0302e26fd45294c52e00c5d773828ed8fc1
Merge: 14333df08 ad5c97566
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 18:32:51 2010 +0100

    merge bug22603 into default

commit ad5c975667caeb553a3685357bf35818f9a1b596
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:32:09 2010 +0100

    Cosmetics

commit 447d6d610c1b96402893d0443ccfdc3c7ef320f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:27:37 2010 +0100

    Fixes

commit 8fe6964f0ec5a03776f1303d9ef38051eec6e673
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:25:30 2010 +0100

    Corrections to rabbit_basic:message/4 and refactoring of is_message_persistent such that message/4 doesn't permit disagreement between is_persistent and the properties

commit 408fc06f8c245393ec78ade90bb36e1b7047acd0
Merge: 3dd129490 14333df08
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:17:07 2010 +0100

    Merging default into bug 22603

commit e8983d647d5fc4d817a2e108679fb6cfee35b03d
Merge: 62a67bbe6 14333df08
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 18:01:40 2010 +0100

    Merging default into bug 21673

commit 14333df08bbb986c982fdf7a908cbb1cc1fc2ff9
Merge: 417be4110 3dd129490
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:57:10 2010 +0100

    merge bug22603 into default

commit 3dd129490755235c6261b38ce39c614a64f1212c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:55:00 2010 +0100

    cosmetics

commit 62a67bbe688bc5ce5aa0400da25a89fb9e852acb
Merge: 1c6d89e39 417be4110
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:52:51 2010 +0100

    Merging default into bug 21673

commit 417be4110aa613f248dbb64f2b4534661f9fa078
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:47:43 2010 +0100

    renaming type sigs

commit d06575e9af21adcf7c5e74d4d2bd11a115e6ee3e
Merge: 1374ed455 84583ff8a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:39:10 2010 +0100

    Merging default into bug 22603

commit 1374ed455898d7de2f9e9c473807f5a96e8b6dd7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:38:55 2010 +0100

    persistent_key => guid + is_persistent

commit 1c6d89e39997ae63422e6d0fa81e49baf35a0c8b
Merge: ac7f7e114 84583ff8a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:35:00 2010 +0100

    merge default into bug21673

commit 84583ff8ad3b78804f9adb3e37f7ed62d84610d7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:33:46 2010 +0100

    cosmetic

commit ac7f7e1149cc91ad21ae0a905313d5dcc8769c9a
Merge: 0a47cb9a4 11764cc1d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:26:42 2010 +0100

    merge default into bug21673

commit 11764cc1de802b4f21566f525f066e6e1a7a885a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:25:47 2010 +0100

    refactor: put hibernation constants in one place
    This was cherry-picked from the bug21673 branch

commit 0a47cb9a4049e6295644ff7fd06fd39a33bf775a
Merge: fcb86e551 d3817865c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:14:03 2010 +0100

    merge default into bug21673

commit d3817865c0ef6cd15a376c9b502d415f10fb3e6c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 17:12:37 2010 +0100

    add worker_pook:submit_async/1
    This was on the todo list and got cherry-picked from the bug21673 branch.

commit fcb86e5510b702d78892eaa0de5d00471339918f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:09:48 2010 +0100

    Corrections to specs, docs and exports

commit 603cb38b0b87d5efc6d7450640a074947c6f01b0
Merge: 5efdbcddf f7101619c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:02:34 2010 +0100

    Merging in from default

commit f7101619c67081449b505efb660cade532864191
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:01:34 2010 +0100

    Cosmetic

commit 5efdbcddfad4784318c308939655c0563b6da605
Merge: eefe36bc3 6f65a10c7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 17:00:00 2010 +0100

    Merging heads

commit eefe36bc371f32cb6cf824508e8260f65d94a2bf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 16:59:49 2010 +0100

    Converted the maybe_run_queue_via_backing_queue to take a thunk, and also vq:needs_sync => vq:sync_callback

commit 6f65a10c71f696a488f21d6dba3692826411aeb7
Merge: 61bdae34f 50922d670
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 16:53:34 2010 +0100

    merge default into bug21673

commit 50922d670bd872d95d64f9907facd3c9f7f88e0e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 16:52:20 2010 +0100

    tweak: better signature for 'ceil'
    This was cherry-picked from the bug21673 branch

commit 61bdae34fbe1a34f6f9afb7c5003866369d4ce6d
Merge: c73475948 f7ebdabef
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 16:25:32 2010 +0100

    Merging heads

commit c734759488c352befb472d2dace5f30a31e6f86d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 16:25:00 2010 +0100

    Startup only requires durable queue names, not the whole amqqueue record

commit f7ebdabefa02a26ef5506d2348816a6604f426b4
Merge: cf75c80eb aa49051b3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 16:10:45 2010 +0100

    merge heads

commit cf75c80eb8e0f40dda0d000def867a7743d3949d
Merge: 996677caa 5b764b648
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 16:10:33 2010 +0100

    merge default into bug21673

commit aa49051b35b5bdf14c046f815dbf7db04b531a84
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 16:09:28 2010 +0100

    Hide the startup of the msg_stores behind the pluggable API

commit 5b764b6483830c2b380281d076cc1b453fe002a7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 16:07:12 2010 +0100

    refactor: add rabbit_misc:unlink_and_capture_exit/1
    This was cherry-picked from the bug21673 branch

commit 996677caa9cb816415751195d49f34de4116a6dc
Merge: dee56eb6e 0803a8a4f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 15:54:09 2010 +0100

    merge heads

commit 469f762f90c3793f72c0dff104f1aee2c0c56e3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 15:39:30 2010 +0100

    Added type specs to version_compare

commit dee56eb6e77d4fd719b1dfabdf3dbeaf6e1bed39
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 9 15:37:12 2010 +0100

    All sorts of tidying, cosmetics, reorganisation and pruning. A veritable smörgåsbord of improvements.

commit 0803a8a4f955a37680eb01e264cf53a9668a2922
Merge: 2829795d6 d28f156fc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 15:35:05 2010 +0100

    merge default into bug21673

commit d28f156fc9d9071366d49df108bc257afb8411cf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Apr 9 15:31:31 2010 +0100

    refactor: introduce rabbit_misc:dict_cons/3
    This has been cherry-picked from the bug21673 branch.

commit 066233b63a487faaca7317fdbc1f94c31c78eb69
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Apr 9 14:14:39 2010 +0100

    Rename delegate_{sync,async} to delegate_{call,cast}.

commit 2829795d6ed0857892cc23c161fcade87fd114cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 18:01:16 2010 +0100

    Just making the order of the specs match the order in the behaviour

commit 8f879274e5cf1eeb26e9296eb63206bb8b06f9b2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 17:46:35 2010 +0100

    Ooops, missed a few

commit 874cb3e1b472be6b28707d8c8a27cd70eee6a87d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 17:26:45 2010 +0100

    set_queue_ram_duration_target => set_queue_duration_target and ram_duration => queue_duration for censistency

commit 67dcfb8be3b0f44ef22064452e7af9b387ece627
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 17:20:11 2010 +0100

    Rearranging GC code and tidying up of some common dialyzer type defs

commit 332d920fa5d8c1ba3adb249f638ff07587bdcbf4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 16:05:08 2010 +0100

    Pluggable queues land

commit 23e259db14f2cd45c2d76a157a96f3e166febb9d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 14:44:15 2010 +0100

    Rationalise the entire VQ api in preparation for making it pluggable. Just a behaviour, the externalisation of the specs to follow, and a means to specify the internal_queue module to come.

commit b8105271c1fe59997851cc7a7fb60b0e0677700d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 13:02:49 2010 +0100

    Unify the APIs of the various commit callbacks. Prevents running the queue when we are doing ack-only txns

commit 5b439f592a7795a11b0668523880b93292d1ffc5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 8 12:23:39 2010 +0100

    clusternode is a list

commit a5d175f5b4f5930739917ca418ce26be9d369ddd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 7 17:46:38 2010 +0100

    Cleanup and improvements to the txn commit system. We now ensure: a) if the txn consists only of acks, we do sync those acks in the qi (assuming the acks were on disk already); b) txns in non-durable queues never cause fsyncs, even if the messages are persistent (or the acks are for persistent messages); c) transactions which contain no publishes can now overtake txns which do contain publishes; d) txns which do not need to be sync'd in the qi can overtake those that do need to be sync'd in the qi (eg a txn with only acks for non-persistent msgs can overtake a txn with persistent publishes). The overtakings are all safe as commit is a sync operation on a channel, and can only overtake other txns, not other operations in general.

commit ed5ec5b25777a51e5baf1c501ed998d44031b1b1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 7 15:33:07 2010 +0100

    Fix a leak in the fhc - all clients of the fhc now have a monitor created for them to enable us to tidy up after the process dies. The distinction between these monitors and the ones created in release_on_death is that the release_on_death ones are not stored in the client_mrefs dict, thus if a monitor DOWN message appears which we can't find in that dict, it is assumed it is a release_on_death monitor

commit 9fca2ac37c4f85bdfd91ef6a2df34ed6924f7e76
Merge: 76b43be63 81fa43bd8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 7 14:57:27 2010 +0100

    Merging default into bug 21673

commit 87ab69f95a5e1ad5c84bcb7dbed84c798f1cb3c4
Merge: 4cc024855 81fa43bd8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 7 14:49:54 2010 +0100

    Merging default into bug 22500

commit 76b43be634a465624c8ac7317935f9edd601ece1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 7 14:35:59 2010 +0100

    Simplification of function called from one place only

commit aaf0564c857b6bf97ba71903fb930b988d8933f7
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Apr 7 10:39:11 2010 +1200

    Add persister_hibernate_after configuration variable.

commit eb8add1e061d65ba150935c2733abcb023643d81
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 6 18:13:51 2010 +0100

    Large accountancy bug in queue index leading to great confusion and indeed infinite loop. Fixed.

commit 81fa43bd8070a377c5bb0efce9f8bc63864f6b8e
Merge: f318a056c 6fd8ef556
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 6 14:43:48 2010 +0100

    Merging bug 22582 into default

commit 70c11fb19bbc6970950b29ada906eb42171cbe02
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 6 14:00:34 2010 +0100

    Removed code duplication

commit 45a9ed69352fc4600f33f9e308dc57c97e368d82
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 6 13:49:24 2010 +0100

    Whoops, API changed...

commit 02c232663d4059c5a489523f027070b6d1650bb2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 6 00:18:05 2010 +0100

    Fixed a leak - if we have many queue index segments which were written to disk but contained only references to transient messages then on restart, they would never be removed. Unfortunately, this does potentially introduce further work on startup (the queue will try to ensure that it loads the persistent contents of the first segment which contains a persistent message, which can involve scanning through a lot of segments. However, this is actually pretty quick. The only way to fix this would be to keep per segment counters of persistent messages and ensure that's written to disk too, but the extra code cost and complexity may make this just not worth it.

commit 69ac8068271a48be671699a330d12fd74c7f2779
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 5 23:08:27 2010 +0100

    The walker is run within the msg_store process, which traps exits. Thus need to be careful to unlink and ensure we have received any EXIT message generated

commit dde6c60b61ce3cf371f76b4422fe991085ed6504
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 5 23:07:12 2010 +0100

    Corrected comment

commit 12fa85e5c300c05bf3865fa7335223bf486ff2c8
Merge: fe277b6c8 f318a056c
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Tue Apr 6 09:55:58 2010 +1200

    Merge default into amqp_0_9_1

commit 62859413de673f6ce2278ca3e9b9e82d2c640946
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Apr 6 09:54:32 2010 +1200

    Create persister_max_wrap_entries configuration variable.

commit e81e10507bb4fbfcf2fdedb971ffe52d99cc6712
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 5 21:29:29 2010 +0100

    Forgot to remove a printf

commit 0227797f19d04a7cce315bfeb6c5f94cb2ed9592
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 5 20:58:48 2010 +0100

    Given a clean shutdown, near instantaneous startup, regardless of queue length. Note most expensive element in startup is loading in the msg_store index. Also note for some unexplained reason, this currently doesn't work with toke - the toke plugin will need reworking to become available to both msg_stores simultaneously.

commit 85812ceafa7ecf102c5a05b976a04140624caa19
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 5 16:36:22 2010 +0100

    The msg_store now avoids building the index and scanning files iff it is shutdown cleanly, and all the clients that it previously knew about were also shutdown cleanly and found on startup.

commit 7c10eef2999807f2a20837e0388a44d15dfcdce6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 15:05:56 2010 +0100

    Altered API of rabbit_msg_store_index so that terminate is mean to save out state too, and init can be asked to attempt to recover previously saved index

commit 5cb64c654ae58d09d54cb2677d08edff1032aed3
Merge: 2b781c1f3 f318a056c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 04:05:08 2010 +0100

    Merging in from default

commit f318a056c0c6999fe5d9d853440f4a49e92530b3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 04:00:48 2010 +0100

    Missing hibernate timeout

commit 2b781c1f318f7ee7d444e4249c50404920098234
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 03:55:55 2010 +0100

    Abstract out the "farming out work to the worker_pool and gathering it back in" pattern (gatherer.erl), and then make use of it when scanning queue indices and msg store files. Note the gatherer's exit signal was being caught in the handle_info of msg_store because trap_exits was on, hence moving that to later on in the msg_store init.

commit 51cfb3b2ce5a82861b1f43182067e1c41420dcb0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 03:23:02 2010 +0100

    If we submit to the workers jobs which use the fhc, the workers may receive messages from the fhc, thus need to be able to process them. Also, that then requires that the fhc is started before the workers

commit fb912a1f7f078c9848c3b1bf6cadd1d5280e5c1e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 01:40:53 2010 +0100

    Mistake in opening files leading to process dictionary being wrongly populated and updated when file opening fails (eg enoent)

commit b1028e1a249dbc3e1f2df8d17f48bba374ff678c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 4 01:39:10 2010 +0100

    Cosmetic simplification of logic

commit ca1181e79d77b89ead1bb210d5744e6301cd2000
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 3 20:56:46 2010 +0100

    Introduced rabbit_misc:dict_cons/3 which ends up being used in 3 places. Also fixed a bug which I'd sleepily introduced in vq:requeue where a msg_store:release had accidentally become a msg_store:remove (no idea how the tests managed to pass after that enough to convince me to commit - certainly had the tests failing today due to that one). Finally, persistent msgs in a non-durable queue should be sent to the transient msg_store, not the persistent msg_store. Thus they will survive a crash of the queue, but not a restart of the server.

commit a133685fb5097a6c5fbef9a1c6afb9a78fdbf069
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 2 11:34:43 2010 +0100

    The 2 part init of the queue must be complete before the queue is committed into mnesia. Furthermore, it must be a call, not a cast otherwise it could be overtaken (though it returns first, and inits second). Note that this means on a collision, the queue may get > 1 init calls, hence need for idempotency, and the 2nd call may be delayed while the first init completes. Also note that the queue index init alters disk content. Thus initing the same queue with disk content concurrently will lead to unexpected results. However, this can't occur because durable queue recovery is the only time we are initing queues with disk content, and there will be no collisions at that point, so safe. In normal queue declaration collisions, there will be no disk content anyway.

commit dba92b6916160e849863ab7d7459e783dea81d4c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 2 03:14:35 2010 +0100

    Next step on making startup faster is to allow the scanning of the queue indicies to occur in parallel (per queue). Also, queue creation can take some substantial time due to queue_index:init. Therefore, stagger the startup of a queue so that this potentially expensive step (a) doesn't get done at all if the queue already exists etc (b) doesn't block amqqueue_process:init from returning. Thus on startup now not only do we do the seeding of the msg_store in parallel (per queue), but the durable queues that come up can also do the bulk of their work in parallel, thus speeding recovery substantially.

commit 755f382800d70c33e1f96750d00b98ae9bae3526
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 2 02:39:15 2010 +0100

    Support async job submission

commit 036343b0ef74c0db648ae19afd4649171b1db27f
Merge: fc74ffd36 746dbf892
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 19:26:55 2010 +0100

    No, Mike didn't forget to merge, I forgot to pull. Sigh

commit 24b5e23adafda4ce541d4a7372b076e3a289f042
Merge: 72519fca9 746dbf892
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 19:13:31 2010 +0100

    Merged default into bug 21673

commit 746dbf892db28a41bdaca3550b44741a229b20b7
Merge: 11783f7e7 15c2ffa84
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 19:10:41 2010 +0100

    Merging bug 22563 into default (MikeB QA+'d it and forgot to merge to default)

commit 72519fca997e48195c1ef56e26597fa3395c99d1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 19:08:04 2010 +0100

    Split msg_store into two msg stores, one for persistent and one for transient. This is the first step in trying to make startup and recovery of data on disk much faster.

commit 6fd8ef5561465d2714bd54de612e2799850ecbe0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Apr 1 10:41:06 2010 -0400

    Use atomic rename

commit 8d7d10caa292812a3bdda501d61f5dfdbcf14cce
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Thu Apr 1 10:39:38 2010 -0400

    Split up a long command into several shorter ones without continuation lines.
    This doesn't change the meaning of the stanza with respect to temporary files.

commit b7d60531ee2d24705cea87592b035d1f2ab0c167
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Thu Apr 1 10:36:16 2010 -0400

    Avoid deeply quoted quoting

commit fc74ffd36ef4dfaa718669ea6c15af59324f5871
Merge: 11783f7e7 15c2ffa84
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Apr 1 14:50:26 2010 +0100

    Merge bug22563 into default

commit 15c2ffa84f287d481d95281c16300888a7e95d9c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 14:40:05 2010 +0100

    Fractionally better - the actions of the recursive call are now displayed, though sadly only once they're completed

commit 5650efa3fec2dd8abcfe7345c8a962adf0621efd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 12:26:00 2010 +0100

    1. If our entire goalset is to make the deps file, don't include it; 2. We don't want the error msg when including the deps file when it doesn't exist, but at the same time we do want all errors if they occur when generating the deps. Hence -include is not permitted. Thus if we need the deps file then make it explicitly before including it.

commit 7c691d118046c391dd03da7400aac4b371aa7b97
Merge: cd1f96394 11783f7e7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 1 12:00:26 2010 +0100

    Merging in from default

commit 11783f7e7dd9e0a1382826093680c338664e4c57
Merge: 5b2bc44ee 9523f79fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 29 15:54:31 2010 +0100

    Merging heads of default

commit 9523f79fe9c0c522ba3422f7bce11ac49c4c835b
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Mar 29 15:50:01 2010 +0100

    A couple more cosmetic fixes to the usage messages.

commit 5b2bc44ee6707752719fe4778a5de6f4c7c36d80
Merge: b53eacfac 628fa17dd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 29 12:18:04 2010 +0100

    Merging bug 22559 onto default

commit 628fa17ddacdaf59c573d5707bbb6b5b84891f25
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Mar 29 12:14:17 2010 +0100

    Don't reinterpret the usage message.

commit b53eacfaccd14cd60fb06722b41a85c6cba36c62
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Mar 29 12:02:39 2010 +0100

    Reinstate whitespace and [] in usage message broken in 600668c4da36.

commit 433f39d115823ef85219231a94348910e536eb10
Merge: 15f088c35 8794f5cdc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 29 11:25:34 2010 +0100

    Merging bug 22554 onto default

commit fe277b6c8edb6f9f9e578129108ae5c198d886a6
Merge: 02becf40e 15f088c35
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 24 16:11:55 2010 +0000

    Merging default into amqp_0_9_1

commit 15f088c3548423489161324c3b8bb8f6c1ed0b7a
Merge: 2e6266850 2cb314f6f
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Mar 24 15:49:15 2010 +0000

    Merge bug22560 (worker pool to avoid stacking mnesia txns) into default

commit cd1f96394e75496569201206a2db2ad80a9a1f83
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 24 14:01:23 2010 +0000

    Remove pipeline use in the _usage.erl target.

commit 2e62668507336df1cb9272c167278d5d202127d1
Merge: b2de14577 96841b3aa
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 24 12:31:20 2010 +0000

    Merged bug22550 to default.

commit 96841b3aa041a825b5b2e650abe140158b128eb7
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 24 12:26:51 2010 +0000

    Only build beam files for the usage messages we're going to use.

commit 9329a7b0d3d8f185b8e792c1621536df4ef526c3
Merge: f3d1c1f36 b2de14577
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 24 12:18:18 2010 +0000

    Merging default into bug 22550

commit 9e86ec60fe85175fd9616e2e9724e757160c7e35
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 24 10:24:50 2010 +0000

    Make the generated usage functions just return a string, not print and halt.

commit 8794f5cdc1690dc3081bb579ac53646136ab60a4
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 23 17:44:20 2010 +0000

    Handle multiline examples in man pages separately.

commit 2cb314f6fc7870eb20b0cb1fa79d7ff67b838e67
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 23 15:51:20 2010 +0000

    cosmetic

commit e3305075a1efb5dda71526635687d42aea1826ac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 23 15:28:03 2010 +0000

    Created worker pool system, and pushed the rabbit_misc:execute_mnesia_txn through it.

commit b2de145777065528fa258cef162f44ae29d54d33
Merge: 71f7e5bdc 5418774c0
Author: Tony Garnock-Jones <tonygarnockjones@gmail.com>
Date:   Tue Mar 23 08:17:51 2010 -0700

    Merge bug22457 into default

commit 71f7e5bdc4938874a30927f06340a682e89761aa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 23 15:00:23 2010 +0000

    Additions to specs to prevent dialyzer errors

commit 4ecdc79c259476e8ef86c1607ac644c8dba2b734
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 23 14:45:54 2010 +0000

    Add build dependencies to Debian / Fedora / Macports

commit 5418774c028b840f4d289a12add864f26e32b5b0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 23 11:23:55 2010 +0000

    Correct logic so that a 'make' with no explicit goals still behaves correctly

commit a3831175081f8226314b80ee362145cecdced205
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Mar 22 23:23:36 2010 +0000

    They're not pods anymore. It worked before this by accident! (Stupid shell expansion)

commit 7b95e373a08605d787ac9914daf237038137d687
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Mar 22 21:52:15 2010 +0000

    fold(1) is POSIX and works consistently on macs as well as linux, unlike fmt

commit 41be81600ddb1433199fee4344cd61ddc9cae1b6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 22 11:44:06 2010 +0000

    The previous logic was saying 'if we can't find 'clean' in there, load the deps file'. This is wrong - eg make cleandb run. The new logic says 'if removing all targets which have 'clean' in them doesn't result in the empty string, load the deps file'. This means make cleandb run does load the deps file, whilst make clean cleandb doesn't.

commit d4894895bff41762397dad3b3eae95d58143962a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Mar 21 19:31:57 2010 +0000

    Allow clean and clean-like targets to not bother with the dependency generation

commit f3d1c1f364da19e5c9bdbe7efeb5e326bb18f1ef
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Mar 21 19:19:25 2010 +0000

    All module names must start 'rabbit_'.

commit c2172c77586d3c02f5a7e27594eff779c93ea6a2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Mar 21 19:05:15 2010 +0000

    Corrected build system:
    a) Do not bother with the intermediate docs/.erl
    b) Define USAGES_XML and USAGES_ERL correctly and incorporate with SOURCES
    c) Declare the dependencies between the usage erls and usage xmls dynamically (define, call and eval are our friends here)
    d) Correct use of automatic variables and take advantage of (a)
    e) Given use of SOURCE_DIR, EBIN_DIR and such like, define and use DOC_DIR
    f) Correct order in generate_deps to ensure the .erl is the *first* dep of the .beam. This means we can drop the .erl in the .erl => .beam automatic rule and rely on the deps file populating $< with the .erl
    g) Tidy .hgignore

commit 82e36802cea188f815602522e0c3863a988ce0ba
Merge: 928aa9c03 dba50911f
Author: Emile Joubert <emile@lshift.net>
Date:   Fri Mar 19 16:44:42 2010 +0000

    Merge bug22407 into default

commit 02becf40efe0665aef62493554fd3c12a5e16bfa
Merge: 2bfce36f9 928aa9c03
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Mar 18 12:42:57 2010 +0000

    Non-trivial merge of default into amqp_0_9_1.  Queue exclusivity (bug
    20578) and exchange hooks intersect in a few places.  The main things
    to take care over are that the post-queue-deletion hooks gets called,
    and the exclusivity check is called. NB: exchange auto-delete
    machinery needs to be removed, which will simplify things in a few
    places.

commit a79130522baf268592b5419241bd90405f4e6261
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Mar 18 11:05:59 2010 +0000

    Reimplement rabbit_router in terms of delegate.

commit ce5c7109aedf7bcd2fdd75d23682d242e3c64c8d
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 17 18:21:05 2010 +0000

    Return statuses (and pids where appropriate).

commit 7402cf2c5de8c9174cc0cbdce1c37475fad14480
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Mar 17 13:47:44 2010 +0000

    Generic delegate mechanism, similar to what the router did before.

commit 928aa9c03865357b82539bdcb1cd22f5f4ca3dc8
Merge: 7e59adb3f 4baddcc3e
Author: David Wragg <dpw@lshift.net>
Date:   Wed Mar 17 11:23:34 2010 +0000

    Merge bug22400 into default

commit dba50911fce247d98e1e732cf780be692561e318
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 16 17:59:30 2010 +0000

    Make rabbitmq-service page look a tiny bit less like a manpage.

commit 92237fc7429a57aef031bc87e77192519ed828e5
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 16 17:00:33 2010 +0000

    Build the windows service page for the website too.

commit c12fb07ea8317fd673d687c2d8524a237e4a99b8
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 16 16:40:19 2010 +0000

    Fix some mistakes that were in the Windows Service documentation.

commit 8134a43ab4e62daca257c44129922a8aa90723b3
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 16 16:38:27 2010 +0000

    Convert Windows Service instructions to DocBook verbatim.

commit 5eee6c7ac019816b4ff8cd9a187f1118ba63c685
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 16 15:59:35 2010 +0000

    Escape dots.

commit 7e59adb3f234d1a38d8a13c7372611f6c53f024c
Merge: 107adaa41 fba62b91d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 16 15:52:49 2010 +0000

    Merging bug 22379 into default

commit 4cc02485583ba5104de6b34eee8c6f4ab83f2eaf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 16 15:12:02 2010 +0000

    typeo

commit 543414e7dc4efaa77b0621004e32d5d6242ce46e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 15 16:35:57 2010 +0000

    Cosmetics, and remove bashish -a to generic -e (semantic preserving)

commit dc44808b2cca8b088c6b07102f56f12f2141b036
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 15 11:21:04 2010 +0000

    Make sure the ocf script goes in /usr/lib/ not /usr/lib64/

commit fba62b91d929a4c9ae0273dad78ce695a89e8704
Author: David Wragg <dpw@lshift.net>
Date:   Sat Mar 13 23:08:40 2010 +0000

    Install into /usr/lib, even on 64-bit platforms

commit 76c0bf22a9117e04735f69bac80543ab3e1e4601
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Mar 12 13:49:50 2010 +0000

    Remove DOCTYPE with --novalid and namespaces with XSLT.

commit 4b6005a442fe7bea7f457b41b8f6abb652d2362e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 19:18:47 2010 +0000

    Minor fixes

commit f15819a486129b88f0d8d0431c3fab49dbd63d00
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 19:11:32 2010 +0000

    Nope, no idea why it still jams on unload

commit 2ea28eeb6d065608e88883db0c67c173c2c6278a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 18:27:48 2010 +0000

    Well it nearly works...

commit 2c46e58aef33b359abe9c39edc695b87c72bde18
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 17:58:57 2010 +0000

    Getting there. Still doesn't really work in anger though...

commit 624a992e872833770e62bb0bd8a43b28d48266fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 16:21:33 2010 +0000

    Slightly more convincing for the rpms

commit 8fca70092fbe2a645edfa24737c59c95e821dd54
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 16:05:28 2010 +0000

    Try to install the ocf script in the right place

commit 0367fc0a296dc206764e8874865005c59f76438e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 11 15:48:44 2010 +0000

    OCF script

commit ae47f65d16cb229e4298aea435e543f1ccd55f16
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 9 23:53:51 2010 +0000

    Missed a 16#ffffffff

commit 7400f7036354304e8e10a70daf89351b83c891da
Merge: 2e9283c0f e61d28a8e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 9 13:06:36 2010 +0000

    Merging heads

commit 2e9283c0fa72f5f41750c89707655f006c94805f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 9 13:04:30 2010 +0000

    Unnecessary variable

commit e61d28a8e857ff12b5b0ed079d35913029c613a0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 9 09:06:18 2010 +0000

    remove unneeded exports
    and some minor refactoring

commit eae0845e8829aeadd8b65b776e0108081bde27f9
Merge: b9790f78e 107adaa41
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 17:34:34 2010 +0000

    Merge default into bug 21673

commit 107adaa41c70b749999cf97a4f7c5f0234ed10a1
Merge: 347781cea fe2662ecf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Mar 8 17:24:36 2010 +0000

    merge bug22456 into default

commit fe2662ecf96313aa87804c70a17bb617e424e61e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 16:48:50 2010 +0000

    Missed one

commit 15d64b003e3cd21261c44123fb2c77f286349d5e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 16:26:25 2010 +0000

    Apparently 'No, you can't include rabbit.hrl in tcp_listener_sup'.

commit 5acbdd466e0ea4591fb077174709cbe2aba84b65
Merge: d656a8ccd 347781cea
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 16:04:50 2010 +0000

    Merging default into bug 22456

commit 347781cea7a6d528c60dffa6c9cdd0e5024e2d5c
Merge: 43acb2b32 cb1a12dd4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Mar 8 15:59:04 2010 +0000

    merge bug22454 into default

commit d656a8ccd03fe76eaf5d911ae759ce0aadbed2ca
Merge: 2908a1ea8 cb1a12dd4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 15:41:58 2010 +0000

    Merging bug 22454 into bug 22456

commit cb1a12dd4957b0c95e805174a28f0dcdf3688624
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 15:34:35 2010 +0000

    Reworked the supervision heirarchy again

commit 2908a1ea8281ffbb426ffde3366fd93381288349
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 15:12:24 2010 +0000

    Extended all timeouts

commit 43acb2b32a8952fbb731e3698a99c26876f278ce
Merge: 6432b18ed 65aada05a
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Mar 8 13:55:17 2010 +0000

    Merge bug22399 into default

commit 65aada05ad2ddb6bf4bec5c47c44f879234abce3
Merge: b54755ae7 66814729b
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Mar 8 13:50:23 2010 +0000

    Merge default in

commit 6432b18ede852874fd37f76af39a66e08a732ea8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 12:29:17 2010 +0000

    cosmetic

commit b9790f78efd60c1a9f525998d4260002122cae99
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 12:20:29 2010 +0000

    Push memory monitor and fhc into the restartable sup

commit 9575deaa2207d3e5c703ebc4f2455543d2f41ee0
Merge: 9fca249c3 66814729b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 8 12:14:06 2010 +0000

    Merging default into bug 21673

commit 66814729b3e136f2f90f9e9727373434a9eeb56b
Merge: 0118ddda9 cf25d3940
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Mar 8 12:06:03 2010 +0000

    merge bug22454 into default

commit 9fca249c3060f10c0bb51a548825c62eac8edae8
Merge: c66b64de5 0118ddda9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Mar 7 18:52:14 2010 +0000

    Merging default into bug21673

commit cf25d3940f0c3c2fa54b0f424da4762d0db38cce
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Mar 6 13:38:56 2010 +0000

    Should stop and delete under the restartable sup too

commit 7ab67545134a174eeda0083749351a773b321fbf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Mar 5 17:37:44 2010 +0000

    Supervisors should have timeouts of infinity

commit 0118ddda953a333f43b41245fd3104f234e826fe
Merge: 4487f6fab b6a9ef3df
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Mar 5 17:30:56 2010 +0000

    Merging bug 21939 into default

commit 37103b750c48f22b8f10c19b650d8617258ef812
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Mar 5 17:08:22 2010 +0000

    reworked supervisor hierarchy

commit 4487f6fab1bd6d5346f4c216ac8cc165ca7d0d4a
Merge: 136967a3f fd86529d3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 5 16:47:47 2010 +0000

    merge bug16653 into default

commit c66b64de5431d49755ce5c452d7014813164169b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Mar 5 16:21:38 2010 +0000

    Change to cur file cache. Rather than bother storing the file in there, just give a ref count which in inc'd when the client puts it in, and dec'd when the process actually writes it. On roll, delete everything with a ref count of 0.

commit 95ed9fa5e8de814ae6ba491ecad314f1e0a3f7f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 18:21:18 2010 +0000

    Minor bug fix, but I don't think this is what's plaguing majek atm

commit 0f391d502030f4cad2a3d07b737a01eeb1e66fda
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Mar 4 17:48:06 2010 +0000

    Add IDs for individual commands.

commit cc60355886e99494edc9c0468b1eeaec8200a3d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 17:27:46 2010 +0000

    Whilst erlang's namespace provision is poor, it's not quite /that/ poor...

commit 91d80f003ef4a07adb0081373c78d45292033cc0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 17:27:01 2010 +0000

    Minor relaxation of boot dependencies

commit f2aa32b05497587eff96e842a4b1f21267371f2f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 17:15:48 2010 +0000

    Correct boot sequence and rearrange msg_store / queue startup and recovery into amqqueue rather than queue_index

commit 807136685252de3d669673d6394ddf46360d8c4c
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Mar 4 16:18:28 2010 +0000

    Make web versions of all the man pages.

commit ebc771d907a83a8c77ef0660e3fab106c70ee664
Merge: 431def74f 136967a3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 16:12:39 2010 +0000

    Merging default into bug 21673

commit fd86529d3b0f7c1bb1919e2014e8472caa9a6d0a
Merge: b84db2017 136967a3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 15:29:17 2010 +0000

    Merging default into bug 16653

commit 136967a3f34afe0cdb1ccca80a1c55488fdf66ee
Merge: 42c631ace 3be9b74f0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 15:11:45 2010 +0000

    merging bug 22169 into default

commit 42c631acede96a4a8f2e3876eff12b1448e7655a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 14:09:52 2010 +0000

    s/( * %)([^%])/$1%$2/g

commit 8573763d4adc8dc3398e54fa886520782c37a6da
Merge: f53aee7bf 2a896988e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 4 14:02:08 2010 +0000

    Merging bug 22397 into default

commit 431def74f94aca9e7868f97cce10470077cedf03
Merge: 8a8bab65a f53aee7bf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 18:31:35 2010 +0000

    Merging default into bug 21673

commit b84db20174d443f9ebdd6848a3e0899a5b678a1d
Merge: 75fa8b116 f53aee7bf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 18:21:17 2010 +0000

    Merging bug 16653 into default (now permits client side channel.flow to be used with shovel)

commit f53aee7bf6cc84caf3521c3945b87666c6574111
Merge: a0e433961 7a17fac32
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 3 17:58:51 2010 +0000

    merge bug22423 into default

commit 7a17fac3276320fd9b49021c1d9bd81dd7dd7203
Merge: 728948398 dac60a505
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 17:38:54 2010 +0000

    Merging heads

commit 7289483989d027a2d465285c909e039567e3d672
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 17:37:53 2010 +0000

    Better handle the limiter exiting

commit dac60a505e9b78c3c1f5ca6d14624d4b6d0c1961
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 3 17:31:18 2010 +0000

    cosmetic

commit b9c76a0935cd3049b809a9644490c8e8914f00a0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 3 17:18:16 2010 +0000

    cosmetic

commit 34f906ebaeff4389214000dd5b016383cbd44d70
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 15:13:04 2010 +0000

    Apparently, consistency is a good thing

commit 3ac66b0a682ee10765e1dcbbd83516fd5948133c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 14:30:18 2010 +0000

    Made the very generic invoke call into a slightly more specific flush call

commit dcdbc648acba235d9ada61518b6948bc3100d28c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 13:35:58 2010 +0000

    Deal with the possibility of there being no queues to go through

commit 96ddd6baec383e6a8f97b29497e719b68f3880f9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 13:18:34 2010 +0000

    Implemented the rest

commit 9c957923ec5228a35f8094e20f321b46b61c70e3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Mar 3 12:26:39 2010 +0000

    Fixes to limiter - logic mistake in maybe_notify and some refactoring and cosmetics

commit 54e3ef0d54a2f93e79213c6fb838aa4e08083c0b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 2 18:45:17 2010 +0000

    Incomplete implementation

commit 649bf2f2f04f1479778c1407a5832843953741a4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Mar 2 16:07:13 2010 +0000

    Problem: if the limiter is blocked due to a client flow, and the client then issues a qos = 0, we can't have the limiter exiting. Thus limit needs to become a call, plus associated changes. Note that we *have* to know whether or not the limiter is about to stop - if we just wait for the exit signal then there's a race with a new qos setting being sent to an expiring limiter and the limiter thus getting lost. Also, the channel *must* be responsible for telling the queues to forget the limiter, otherwise again there's a race between a new limiter starting up and telling the queues about it, and the old limiter dying and telling the queues they're unlimited. This is why the limit_queues function cannot be moved into the limiter - the channel must drive this.

commit 17f4674365c8840d1b811a45acec47101910dade
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 2 13:18:49 2010 +0000

    Move the prefix / suffix to the XSL file, cleaner and works with echo from lenny.

commit 3a7576d1d7e74504ef297bc9e308e7e3752f8b94
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 2 11:26:01 2010 +0000

    Work around what appears to be a bug in DocBook.

commit 7842adbb41ebc687a61cf9f0eaa42c1dfce893e2
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 2 11:14:10 2010 +0000

    Fix breakage of usage introduced in 600668c4da36.

commit 993401a909afc0face5034b9ee1a8239a5bb181a
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 2 11:07:06 2010 +0000

    Move description of default list items to after the list.

commit 541869e0dea85f4c7f9b553de3b03a3ccbf81dea
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Mar 2 10:53:31 2010 +0000

    Use correct cmdsynopsis form for subcommands, don't manually add [] as docbook will do that for us now.

commit 89ac334518285b50c081a4b7d36690e6b8e08ffd
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Mar 1 17:22:57 2010 +0000

    Make optional args visibly optional on website.

commit a0e433961a44679244dbe3817b2c4abdba244be6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Feb 28 11:00:32 2010 +0000

    lower priority of conserve_memory below that of 'info'
    This really is more of a principled change than of practical
    significance since we are unlikely to end up with channels having
    mailboxes full of conserve_memory messages.
    The change brings 'default' closer to the 'bug21673' branch

commit 8a8bab65a093ab2be6052d57d94b17665f5f3d39
Merge: 808fdc56d cd7ada1e2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Feb 28 10:25:51 2010 +0000

    merge default into bug21673

commit cd7ada1e2101c8e15dcfbafa7979d56142dbddbb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Feb 28 10:18:31 2010 +0000

    change priorities in amqqueue
    We change all '8' to '7' - this has no effect but brings 'default'
    closer to 'bug21673'

commit 76828d2c092fd47e5a28781692d96fa35377ff91
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 17:52:08 2010 +0000

    Fix a couple of mistakes noticed by Matthias.

commit d8090aa37be61ed734d3a7c73a8273b04f781f26
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 17:40:26 2010 +0000

    Remove some extraneous whitespace.

commit dc062865837bb3fc2483f14e892f12ecd44e105b
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 17:10:11 2010 +0000

    Rebuild when XSL changes.

commit 2e278e11ebb69470a034e170193735b7eb68df1b
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 17:09:54 2010 +0000

    Add some extra paras from the usage message, and make sure they get through. Try harder to control white space in the usage message.

commit 311661f24b7c940ee129291f8a5a4b23ec8ee87d
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 12:52:44 2010 +0000

    Fix internal links in the generated page.

commit 3014307bec01fa5066afcb5e29467fe3b6fbe866
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 12:29:10 2010 +0000

    This mode thing is not needed.

commit 875933a3b2a783a4d06a5b7ce0d6effa556fae9f
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 26 12:25:34 2010 +0000

    Transform our generated rabbitmqctl HTML page back to our ad-hoc XML format for the website. It looks OK now.

commit 2a896988eeb0270b595ed9c3843a622baf17e902
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Feb 25 16:12:06 2010 +0000

    don't use inet:getaddr, try to use inet_parse:address

commit 18a9b92d531f166b705956f73f24472308551349
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Feb 25 15:08:52 2010 +0000

    Remove -85 nastiness, prevent overlong line from wrapping by making it shorter.

commit 895719022357663145744bd9c038fe65166ef6db
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Feb 25 14:48:05 2010 +0000

    Further tweaks to usage messages: only show subcommand option lists, not descriptions, make a couple of corrections, explain <regexp>, rearrange, etc.

commit c2a4431b59d492bd734df6878bd6d14490712add
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Feb 25 13:49:02 2010 +0000

    Convert all the other man pages to DocBook, fix rabbitmq-multi usage message.

commit 60c14baa96118e587b12716b49f7d66e487a5939
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Feb 24 14:49:10 2010 +0000

    Rewrite rabbitmqctl man page as DocBook XML taken from the website admin guide. Generate man pages, usage guides and a web page from man pages.

commit 3be9b74f0be2872d8b6ffdcfd231e4cf1418bfc5
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Feb 24 14:05:24 2010 +0000

    Reimagine delete_binding/2 as remove_bindings/2.  The hooks are now
    called without reference to the initiating action; e.g., if a
    queue.unbind causes an exchange deletion, Module:delete/2 is called
    rather than Module:delete_binding/2.

commit 808fdc56da58b075744c47d15e1d6db716d1e556
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 23 15:39:55 2010 +0000

    Missing call to terminate_client in msg_store

commit 93f26e835c510214f2f7597c904efc0e2f27c63b
Merge: b6b5c6fe0 1cfbca8ce
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Feb 23 15:06:54 2010 +0000

    Merge heads

commit b6b5c6fe0f87054070395db66d116543d2dad485
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Feb 23 15:06:01 2010 +0000

    Of course, we want to return the type atom rather than the module (but still check it's actually registered)

commit 1cfbca8cea3bfafaf80292fa998ac45fee629d1f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 23 13:14:48 2010 +0000

    Superfluous whitespace and inaccurate comment

commit 33717bc9227d7633a35f62d3b1a6ff4b8dd97e0e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 23 13:12:09 2010 +0000

    cosmetic

commit 4baddcc3e85fdaf01e64f1f21793d459546168e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 23 12:29:38 2010 +0000

    Switch to using su, not sudo. Given the command line is already quoted, this seems to work.

commit b54755ae7aad85157e3e7c4cbc5636634a5751f7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 23 11:28:20 2010 +0000

    Accomodate weird American spellings

commit 8f37e77354d46162ef37f5987f23afd7cb6c3be9
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Feb 23 07:18:16 2010 +0000

    Check exchange types for conformance when they are registered, rather than when they are declared.  We have to be a bit careful, because the attribute can be 'behaviour' or 'behavior'.

commit 9b1f90dc069d7c7256e3bf43c58c7a60072d759e
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 22 18:12:11 2010 +0000

    Specs for the exported functions in the exchange type registry

commit 0b4e064301c746676b1a97c76630c3786146b0ee
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 22 17:58:33 2010 +0000

    All these Exchange should be the same

commit 98b8b29e3f1de2604e2ab9c657b8bd7c524a81aa
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 22 17:47:41 2010 +0000

    Remove duplication in delete_binding

commit dd7de3226d36f330eaca23befab1a64bb8762b81
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 22 17:35:32 2010 +0000

    Distinguish between situations in which we're checking if a
    client-supplied binary corresponds to an exchange type (the type may
    be bogus), and just looking up the module for the type in an exchange
    record (we expect the type, and the module, to exist).
    There'll be a better way of doing both the lookup and the sanity
    check in check_type.

commit 25e6064c944d7380bd16497ccdbfaf4a30711933
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 22 12:41:54 2010 +0000

    Nicer formulation of cleanup_deleted_queue_bindings, thanks to
    Matthew.  This one has the same number of function heads, but is much
    clearer.  Also, correct the previous re-arrangement of the bit just
    above that calls the hooks; it wasn't calling delete with the
    bindings, but delete_binding followed by delete, in the case of an
    auto-deleted exchange.

commit 109dd61a57fae4e5f593e8bc1dcbb2f305820c46
Author: David Wragg <dpw@lshift.net>
Date:   Fri Feb 19 21:34:39 2010 +0000

    Declare the RPMs as noarch, and drop the 64-bit builds

commit 16418a9488e15c4d8ef3bfa9fce69190fb8ec796
Merge: e1107dc9a 141752a59
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 19 17:47:53 2010 +0000

    Merging bug 22188 into default

commit d2b579f2ef05a327c2ec105c7ce32a027cbc2410
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Fri Feb 19 17:08:11 2010 +0000

    Remove duplication in queue deletion callback

commit 81884f39b9333553e7790832c0f4d729e417e910
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 19 16:17:51 2010 +0000

    Cosmetics

commit 952d6fcee0a38e2ece3aae4323d5b870bf72c585
Merge: 61a8de863 e1107dc9a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 19 15:08:41 2010 +0000

    merging default into bug 22169

commit 141752a59263c2c2d45a73e5b33f9d7ebc2b995a
Author: David Wragg <dpw@lshift.net>
Date:   Fri Feb 19 13:53:12 2010 +0000

    Use a suffix other than .rpm for file lists, to avoid confusion with rpms.

commit a6f03c6c0fc917cb15f6bb903f713244c19b4e29
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 18 15:38:30 2010 +0000

    Sort out priorities: Only info should be at 9. Conserve memory and messages relating to memory monitoring or file handles or such book keeping are at 8. Messages that are higher-priority but nevertheless amqp messages (eg acks, commit-related-actions, notify-sent etc) are at 7.

commit 5756f3dd99fa6ef710c539172b534d82c9b3913f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 18 14:47:56 2010 +0000

    Several fixes:
    1. Both the msg_store and the amqqueue_process can have their mailboxes get very long. In this case, it's a problem because close messages from the FHC can't get through (Plain !, and no priority). Therefore, add callbacks registry to FHC and equip both msg_store and amqqueue_process with high priority casts to solve this problem (ftr, msg_store can get swamped with writes, whilst the amqqueue_process can get swamped with delivery notifications and acks).
    2. The GC was missing the ability to deal with close msgs from the FHC
    3. The FHC, when reopening a file, uses the same mode as the file was originally opened with. If that mode is just write, then when the file is reopened, its contents get trashed. Thus when reopening, add in read to the mode, but don't record this anywhere - the file still acts (API wise) as if it was only opened writable.

commit e46a9048be642fe8e89a46775312e92f2a71d644
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 17 18:20:26 2010 +0000

    supervisor2 => ?MODULE

commit 75fa8b11634f6ddcb43df825cad68b2225680e3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 17 16:05:40 2010 +0000

    Backed out changeset 4922b15fa148 as it's not needed.

commit 316f49c3fd57a0e987dcf7ff896cb04bb3a28294
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 17 15:56:38 2010 +0000

    Add support for extracting field names for class properties

commit 52bc28f38f5a60c4bfd4570690bd1aed2e2c2c75
Author: David Wragg <dpw@lshift.net>
Date:   Wed Feb 17 13:59:52 2010 +0000

    Add a script to assist in the macports submission process

commit 09c0e33011e742e2b9278f7926fb9d73139bde44
Author: David Wragg <dpw@lshift.net>
Date:   Wed Feb 17 13:52:33 2010 +0000

    A couple of Portfile fixes
    
    The revision should be 0 for a new release of rabbitmq-server (it gets
    bumped when the port changes for the same version of the base
    package).
    
    Sync with the maintainers line from the macports subversion repo.

commit e1b9ba49aec2722af1d71a4e4e107a733169ee6b
Merge: 29597039d e1107dc9a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 16 14:48:29 2010 +0000

    Merging default ⇨ bug 16653

commit 127080f20bd3755513d289c277e90968a3dd7093
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 16 13:55:35 2010 +0000

    Promote reads over writes in the msg_store.
    This is safe. The cur_file cache contains all msgs in the current file and which haven't been processed by the msg_store. Thus if reading can't find it there, and for some reason we can't actually do the disk read directly from the queue process (eg the file is locked due to a GC, or we first thought the msg was in the cur file, but then it subsequently rolled over), then we know the msg has been written to disk. Thus raising the priority of the read call to the msg_store will never allow it to overtake its own write. Certainly leads to a performance improvement in some tests, and generally helps avoid queues stall.

commit e1107dc9ab7ab91e8a3ce9f95f4cf85773aed3cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 16 12:03:17 2010 +0000

    Added tag rabbitmq_v1_7_2 for changeset bacb333d7645

commit 758c952bf09cb933955a97c90271bfa80ea7c366
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 16 12:03:04 2010 +0000

    release v1.7.2

commit f20ce77105b37c9e783b853caeed81bc86a25b29
Merge: fb3049db7 4bd04cce9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 15 17:57:42 2010 +0000

    merge default ⇨ bug 21673

commit 2bfce36f9575fb2465550b095e9e612b0ba159f6
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 15 15:48:46 2010 +0000

    Fix up things that dialyze complains about

commit fb3049db75b4aaa1f54b431db42dfcfd4af4ffd4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 15 15:48:16 2010 +0000

    Yet another API consistency design win for the Erlang OTP team. ets:update_counter throws badarg if the key doesn't exist. ets:update_element returns false if  the key doesn't exist. The bizarre error that I've been tracking down for a week, and have still not replicated (but was a badmatch false (which means it's likely that it should have been true)) is almost certainly this.

commit 4bd04cce92e09bd9b39fe77d2837e2307051a835
Merge: e10fc75f3 167bfd5df
Author: David Wragg <dpw@lshift.net>
Date:   Mon Feb 15 14:53:25 2010 +0000

    Merge bug22363 into default

commit e10fc75f392c5beeb3ac0aacd722f194540ea695
Merge: dc574a8ef 4d526677e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 15 13:59:44 2010 +0000

    Merging bug 22361 ⇨ default

commit 9ffa1197553f6fead9eb4e89bb4148b29f29e68d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 15 13:56:17 2010 +0000

    Remove usused variables.  That includes removing ReaderPid from the signature of rabbit_amqqueue:basic_consume/8

commit 167bfd5df6d5d83d14e7ebdb1745a1de3e64e6e6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 15 13:54:46 2010 +0000

    Well without this, I can break the test frequently (> 50% of the time, with [rabbit_tests:test_pg_local()|| _ <- lists:seq(1,10000)]. With this, it's still not brilliant - but then it actually can't be fixed properly, without extending pg_local. This fix is "good enough" to stop my machine barfing on it, though it is still racy - "we" could process our monitors and go onto the final pg_local test before pg_local processes the monitors in its mailbox (well, actually before the monitors *arrive* in its mailbox).

commit 04070fc945b9619e98007b0d574f92fe1e7a8b67
Merge: c73b4da7b dc574a8ef
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Feb 15 13:05:01 2010 +0000

    De-bitrot by merging default in.  Passes rabbit_tests:all_tests() and
    the ../rabbitmq-test test suite.  Some unused variables appear to have crept
    in during previous commits to the branch; will fix in another commit.

commit 4d526677eabf7c747e2a95ff2474479f80ba7db4
Author: David Wragg <dpw@lshift.net>
Date:   Mon Feb 15 12:44:56 2010 +0000

    Avoid the use of spawn_executable on non-Windows platforms
    
    The Windows-only issue addressed in bug22282 requires the use of
    spawn_executable, which was introduced in OTP R13.  But for other
    platforms we'd like to continue to support R12, and so we should stick
    to plain spawn.

commit b6a9ef3df9279deb61d17f32f40f1ae022510867
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Sat Feb 13 22:19:11 2010 +0000

    exporting rabbit_reader:server_properties/0 so it can be accessible from the erlang client

commit dc9bf08b21dedbf4f2cfee557229f09f6471c0a7
Merge: 964be0e9f 170f35b1e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 12 11:32:49 2010 +0000

    merge heads

commit 964be0e9fc737f6d16ef39420a566b4c56e2111e
Merge: 6f4108b31 32c687649
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 12 11:32:24 2010 +0000

    merge heads

commit dc574a8ef52dd292084dedfc0692665285f3a7a7
Merge: 94fb93099 0cf466290
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 12 11:29:21 2010 +0000

    merge heads

commit 6f4108b31d5bcc8f5ad7b7557a4144b8b6559631
Merge: 9bc47b08f 94fb93099
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 16:59:34 2010 +0000

    merge default into bug21673

commit 94fb9309966e6aab82d2514027d873865f02ae9b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 16:46:23 2010 +0000

    cosmetic

commit 1065ca9a0de20bed017a3d38d3c6f732f65f4e01
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 16:45:54 2010 +0000

    minor optimisation
    when handling channel closure in the queue process, don't do any
    unnecessary work when we end up auto-deleting the queue.
    Specifically we don't rollback any transaction or attempt to deliver
    any messages. The formmer happens in the termination code
    anyway. The latter is a change in behaviour, but one that is permitted
    by the spec, and arguably deleting the queue as quickly as possible.
    
    The bug21673 branch already has changes along similar lines.

commit 9bc47b08f57f23b3368631087519f177fc9262e8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 16:03:07 2010 +0000

    minor refactor: move erase_tx call into commit_transaction
    for symmetry with rollback_transaction

commit 0cf466290e35a3dc97a9541d0850a457c1c73a6a
Merge: 692d43f10 44794ec46
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 11 16:00:26 2010 +0000

    Merging bug22262 ⇨ default

commit a15849a0616e6eb6d57cdedd79204e38b9deb9b0
Merge: 45f4df8e4 1f1b32e62
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 15:56:45 2010 +0000

    merge default into bug21673

commit 1f1b32e6207ba233958314627f679109a03248bc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 15:55:15 2010 +0000

    cosmetic: moving things around
    to shrink the diff with bug21673

commit 45f4df8e444676502fc5e41a2abe63f49b2b9631
Merge: a9cdac1ce 315537ea1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 15:14:11 2010 +0000

    merge default into bug21673

commit 692d43f10c1d999edf02a5648ed5e5083e624abf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 11 14:57:06 2010 +0000

    unix2dos has gone away on some systems, and was always an alias for todos anyway (well actually fromdos) so todos should work on all systems currently

commit 3b94b84aef2a70e70b9f40673f628a9b2f9617b7
Merge: 3d7dd610e 3cce88989
Author: David Wragg <dpw@lshift.net>
Date:   Thu Feb 11 14:29:57 2010 +0000

    Merge bug22336 into default

commit 44794ec46c05836c2f15ae4971b85561e6d9d645
Author: David Wragg <dpw@lshift.net>
Date:   Thu Feb 11 13:48:47 2010 +0000

    Both of the macports makefile targets are deploy-time, so merge them
    
    We need to know the REAL_WEB_URL in order to generate the protsfile
    and index the resulting macports tree, and all this has to happen at
    deploy time.  So there is no point in distinguishing the indexing
    step.

commit 315537ea138470c93a91d2ddccd7b701d42bfd39
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 11:31:25 2010 +0000

    minor refactor: s/Delivered/IsDelivered
    ...in all cased where it refers to the state of a message rather than
    an event that has just occured
    A similar rename was done in the bug21673 branch, so this change
    brings default closer to that

commit 170f35b1e9ffc8abcbf64a36067502550d30e695
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 11 11:19:34 2010 +0000

    Fix potential leak in cur file cache if the msg is both already known and in a different file - eg same msg gets added to 2 queues, one very long, the other very short. Then memory becomes tight. By the time the short file pushes msg to disk, cur file may well have rolled over

commit a9cdac1cec789914008ffff0d9cee3b81d07e2f8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 10:19:11 2010 +0000

    refactoring: rename attempt_immediate_delivery to attempt_delivery
    that's what it's called on default

commit 304cbc2740e5067985b8cf92aa72ba4012700451
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 10:12:07 2010 +0000

    refactoring: rename Msg to Message
    that's what we have on default, and it matches the type (message())

commit 8e1511d1bd65868eebe7a97c688ae44a3e666bfa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 11 10:10:51 2010 +0000

    remove some debugging code
    this is gone on default already

commit 7b42cc024a23c2570a3548ac00006dafa0a74df6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 10 17:41:53 2010 +0000

    Agressively check caches before risking deferring to the msg_store. This often is very beneficial because in practise, the last messages to be pushed to disk under memory pressure are the messages at the head of the queue, not the tail. Thus in the event of the msg_store being overloaded, due to pushing to disk due to memory pressure, checking all the caches first is very effective at keeping the queues moving. The downside is that when we read from the cur_file cache, we don't get the ref count (at this point, the write is maybe only in the mailbox of the msg_store, so it may not even have an index entry, thus we have no chance of knowing an accurate refcount). The result is that the message may end up existing having been read from the cur file cache, then pushed to disk, forgotten, and read in again, only to be added to the dedup cache. However, this is as bad as it can get - there could at most be two binary copies of a message in memory. This actually holds, even though there's a slightly amazing interaction on ack: on ack, the copy read from the cur_file cache will decrement the dedup cache, possibly evicting the entry. At this point there would be no copies in the dedup cache, maybe one copy in the cur_file cache, and maybe one copy in RAM, which is the copy read from the dedup cache. The copy read from the cur_file cache has been ack'd, so has gone. The next read, if there is no copy in the cur_file cache may add to the dedup cache, which will then be emptied on the ack from the first dedup read. I.e. you can achieve a chain in which no more than 2 copies are held in RAM at any one time, but each read really goes to disk. It is left as an exercise to the reader to come up with a test case that exhibits this behaviour.

commit 7a1b0abac9733eaaad3fe8db7591f4c956655ba2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 10 16:54:54 2010 +0000

    Refactoring of client concurrent read

commit eb1e4916c538481d6fdf8e1180f48aeb17598960
Merge: d1d700d34 3d7dd610e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 10 15:58:41 2010 +0000

    Merging default into bug21673 and correcting further copyright dates

commit 3d7dd610e0a6733617909e608ff43ae7f0acf7ac
Merge: c2e9b8c88 9a58f7381
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 10 15:49:52 2010 +0000

    Merging bug22332 onto default

commit d1d700d34f31d4585823c5eb0d8b0cd7e5341089
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 10 13:22:53 2010 +0000

    Fix all sorts of concurrency races in the concurrent readers versus GC

commit 7a3aa2a1fd9edeb5089f8e103f9bf91b37488541
Merge: 709069603 c2e9b8c88
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 10 09:40:16 2010 +0000

    merge default into bug21673

commit c2e9b8c88a0d16fd283365f07aa6adfd0e0b0a58
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 10 09:36:00 2010 +0000

    minor cosmetic changes and refactoring in amqqueue_process
    these bring it more in line with the bug21673 branch

commit 709069603086704267055ea50b22a19b47c748aa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 10 09:07:18 2010 +0000

    osmetic

commit 2db11990abb85ce83c114dda76961b9e244b1af7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 10 09:01:48 2010 +0000

    cosmetic

commit 2bce382b64f7f666079236453eb80808ea86326c
Merge: 071ee6ef2 a193b2267
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 9 19:13:10 2010 +0000

    Merging default into bug21673

commit 071ee6ef2004dc906ebc0689538b93518faf1d7e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 9 18:45:19 2010 +0000

    Remove ets:inserts which should have been ets:update_element

commit 3cce88989da7f84bdfc8d7af73ba6c2b23982a07
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 9 17:50:10 2010 +0000

    Don't set env vars to the empty string

commit a193b226765e85f51a4334f7d725c46cfb815d03
Merge: bdb1591dd ff0a705ca
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 9 17:26:51 2010 +0000

    Merging bug 22289 into default

commit ff0a705ca9614aeb8b8289f6fd324296d816e702
Author: David Wragg <dpw@lshift.net>
Date:   Tue Feb 9 16:56:33 2010 +0000

    Fix rabbitmq-multi issue with parentheses in path
    
    rabbitmq-multi would fail to start rabbitmq-server.bat if the path had
    parentheses in the first few characters of a path component (but not
    after the few few characters, due to short names being involved; so
    cases such as 'Program Files (x86)' do not trigger the issue).
    
    This fix makes rabbitmq-multi run rabbitmq-server.bat indirectly via
    cmd.exe, working around the erlang issue from bug20526.  So we no
    longer need to involve short names, and by sprinkling double quotes in
    the right places we can handle parentheses too.
    
    To test this properly you need a path component with both spaces and
    parentheses in the first few characters, e.g. "foo ()".

commit 3134c266c9d8c82d2c63aab73cdc4e285d668cea
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 9 13:37:21 2010 +0000

    Stored the ch_pid in the txn

commit bdb1591dd990c87a3eed93dcc3ec8f53048ea678
Merge: 07836a9fa 738beef37
Author: Paul Jones <paulj@lshift.net>
Date:   Tue Feb 9 12:39:42 2010 +0000

    Merge bug22295 into default

commit 043e943a46523a2bd50efed1faf0829fc26a8a24
Merge: 103a49569 07836a9fa
Author: David Wragg <dpw@lshift.net>
Date:   Tue Feb 9 11:54:03 2010 +0000

    Merge default into bug22289

commit 9a58f7381d3d6688d7c851a95e73c23d4350cb8a
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Tue Feb 9 11:07:10 2010 +0000

    update copyright notices to say 2010 where appropriate

commit 07836a9fae75cf538a887e5ee0d1be0bc8851539
Merge: 90b34ec16 7f1813c07
Author: David Wragg <dpw@lshift.net>
Date:   Tue Feb 9 08:25:34 2010 +0000

    Merge bug22303 into master

commit 7f1813c07bfcd7f3376939bdd9b79ba48c50dc4d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 8 15:06:37 2010 +0000

    Don't hardcode erts path, instead, search

commit 86db502f9adf2fb1436a8c6787447359cd56795e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Feb 8 10:55:42 2010 +0000

    Some cosmetics, but also make service_manager_path be based off erlang_home if it's not set

commit 90b34ec16f049f5631475ef8549a8dd4fa2ebea3
Merge: 373c98939 9e5681976
Author: David Wragg <dpw@lshift.net>
Date:   Mon Feb 8 10:18:04 2010 +0000

    Merge bug22259 into default

commit 103a4956910798a5969b46459701e4ef0b79ea8b
Author: David Wragg <dpw@lshift.net>
Date:   Mon Feb 8 07:55:58 2010 +0000

    Convert all batch files to use deferred expansion

commit 53f113e6e4ac5b2294fdfa4481fbcdece6c7e467
Author: David Wragg <dpw@lshift.net>
Date:   Mon Feb 8 07:55:58 2010 +0000

    Remove exclamation mark from an error message.
    
    It will be more trouble than it is worth to preserve this with
    deferred expansion.

commit 32c68764945a542bd5e433fece9a172b52cc3202
Merge: cf12d1898 373c98939
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Feb 7 01:28:42 2010 +0000

    merge default into bug21673

commit 373c989397d96b9655f70c44aac6b056e520fe94
Merge: b7cfc6fa7 57b490004
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 5 20:51:26 2010 +0000

    merge bug22310 into default

commit 57b490004da5a5bad7d41aa443f081b20d570bad
Merge: 7a02669af b7cfc6fa7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 5 20:28:16 2010 +0000

    merge default into bug22310
    in order to resolve merge conflict going the other way

commit cf12d1898ebdfaabfadd05723dd1528c36a31d6e
Merge: 0c5bcb5b3 b7cfc6fa7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 15:55:55 2010 +0000

    Merging default into bug 21673

commit 738beef379b43b7c8ccd78e4ba6948c732fa701f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 15:42:33 2010 +0000

    Stripped out sndbuf and recbuf

commit b7cfc6fa743cf201aaf6f6050b6fc016e8443fc1
Merge: 9aca08e82 a93f013b6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 15:31:03 2010 +0000

    Merging bug 22309 onto default

commit a93f013b6b8f4c2cd0ecca6f0f241b57b1a2dee0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 5 15:24:53 2010 +0000

    handle attempt to close connection with a non-connection pid
    which was previously hanging at best and causing things to explode at
    worst

commit 9aca08e82e52503bce4dd924c2eab0eef11b7abb
Merge: 13d1504f7 004f28b95
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 14:32:59 2010 +0000

    Merging bug22300 into default

commit 004f28b9515007cd51d964043510d123cc9bd1e5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 14:21:24 2010 +0000

    Correction of spec

commit 13d1504f7a711f4c28e9b380d821021257593c34
Merge: 76020578b 6f65ddb23
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 14:00:38 2010 +0000

    Merging bug 22309 onto default

commit 6f65ddb23dfae6df1081e720d677212c630df9e9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 13:13:43 2010 +0000

    Minor correction to regexp

commit 76020578b833c56af72d7f5e5b1a0a58dd818a8c
Merge: 395b7374e 69254843d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 12:52:42 2010 +0000

    merging bug 22301 into default

commit 395b7374e7852f1d1803e6cc4ae0cbaa25296ae3
Merge: 75c480ff4 e7b2fda90
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Feb 5 12:22:15 2010 +0000

    merging bug 21966 onto default

commit 3f7e5d6e570fa646fce3125712bbf1a53752f759
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 22:53:27 2010 +0000

    docs

commit 9c4138f756c63a1f075c64a5f2c8240e1c27ff3c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 22:23:26 2010 +0000

    add test for 'rabbitmqctl close_connection'
    This provides at least *some* coverage. Testing what happens when a
    connection is in the 'running' state is too hard.

commit 2bc033ea10ff9846a7af45abe437482709b6d027
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 22:17:36 2010 +0000

    refactor: move pid<->string conversion funs into misc
    since they are generally useful

commit 21218f795e8416bbd9f0b3e091354b2e21367e37
Merge: f6c9404bc 75c480ff4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 21:31:55 2010 +0000

    merge default into bug22309

commit e7b2fda90f41d2af0ed4e8788f6db462d0e419c5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 21:09:26 2010 +0000

    make channel 'messages_unacknowledged' item semantics match that of queues
    namely, don't decrease the count for uncommitted acks
    Also, add 'acks_uncommitted' info item, for completeness

commit debb99228661962df355b90f28b5ecb836076d71
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 20:37:59 2010 +0000

    exercise some more code paths in tests

commit fb44220bd0418791eded2570c320c1e60760caf3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 20:21:25 2010 +0000

    oops

commit 1f5a2d6b1e1e3628d3e60860b116b4f174c0fe72
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 19:12:17 2010 +0000

    ditch API for channel-based consumer listing

commit 52dbedbbe9118627e05ccdac7475d5a14ccbd665
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 19:09:46 2010 +0000

    move consumer listing from channel to queue
    The main motivation here is that queues, not channels, are the logical
    home of subscriptions. And rabbit plug-ins and other extensions may
    bypass channels when subscribing to queues.
    
    The queues also know more about consumers than channels, namely
    whether a consumer requires acks. So this additional info we can now
    display too.
    
    And with the switch to queues the listing is now scoped by vhost.

commit ba336ead7f121c5f49321f9082fc4f98566e1536
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 18:07:24 2010 +0000

    test for list_consumers

commit 0c5bcb5b35d3ba5bf5a435d39acd8fba0f97d539
Merge: a1200e949 75c480ff4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 16:08:26 2010 +0000

    Merging default into bug21673

commit 75c480ff41d4568334a5bdc92c6aa6c8ee572516
Merge: 2ce7e4b60 176938146
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 16:06:25 2010 +0000

    Merging bug22254 into default

commit 176938146041104f7c69de8458506bb1834dbe41
Merge: 11e63b9c2 2ce7e4b60
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 15:40:56 2010 +0000

    merging default into bug 22254

commit a1200e94985fd46dcf70e950910d120131c89380
Merge: ac74eb4e3 2ce7e4b60
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 15:19:34 2010 +0000

    Merging default into bug21673

commit 9e56819768d386260807ffaa6174d35080babe18
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 14:01:49 2010 +0000

    Everything uses su except for macports which uses sudo. On OS X, man sudo suggests that -E is needed to preserve environment. Manually checked and indeed it is. Hence added -E to the one call of sudo in entire codebase

commit 9b0b037059bd52d17b4237cb489d3ff924e7f327
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 13:55:37 2010 +0000

    Detect version of os_mon, and if we have version > 2.2.1 then we trust its output

commit 7a02669af084489cb89a0778d028cd1f0e0a6558
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Feb 4 13:05:52 2010 +0000

    Initialise a channel's limiter with the current number of unacked msgs

commit 48810590e37f91643874ce7e8fb368d002fc24c8
Merge: 82d3065e1 b3711bfb0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 03:50:20 2010 +0000

    merge bug21966 into bug22300

commit b3711bfb0cf231d352ef96d9b95f01780d2731a2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 03:40:20 2010 +0000

    add tests for pg_local
    these give us nearly complete code coverage

commit e40b1a9d3e92edd821e9e914bb406970268ce361
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Feb 4 03:38:56 2010 +0000

    add pg_local:sync helper function for testing
    turns out that making any kind of assertions when everything is async
    is pretty much impossible

commit 962191542021e002a4e330c29085be439557d7bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 22:30:20 2010 +0000

    automate testing of 'rabbitmqctl list_channels'
    and add rabbit_channel:info_keys/0, in line with other info-providing modules

commit f3282d3aa4f777a2402adb4c6741ba43f902aa45
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 22:07:46 2010 +0000

    add info item for channel number

commit 1ee896c9f0735434a75a646570a48cec613c8994
Merge: 8cf09dc16 2ce7e4b60
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 21:57:14 2010 +0000

    merge default into bug21966

commit 2ce7e4b604f2750ee5031d67cee2d20a8f2f5a53
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 21:52:39 2010 +0000

    allow programmatic extraction of available info keys
    ...which avoids copy&paste, instantly improves test coverage, and
    seems generally useful.

commit 8cf09dc169c95b378c4e5a94bff260e50b8cbd48
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 19:57:46 2010 +0000

    introduce exponential hibernation backoff in channel process
    so that things like a scheduled 'rabbitmqctl list_channels' don't
    cause the channel to spend all its time hibernating and waking up

commit c2d4432ee5f331dcab315347574ee09745cb1486
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 19:24:10 2010 +0000

    minor refactor

commit 61a8de863032ccea2b9f4e53a81dff964091a9a5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 18:11:02 2010 +0000

    Matthias-approved cosmetics

commit bd29fbd484acba62a321d506b710f1f7a987949b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 17:14:22 2010 +0000

    Cosmetics only - line length, consistent whitespace, and a couple of if -> case conversions

commit f6c9404bc1977d7fbddde99d8f3916bcfb4bd1e8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 17:00:34 2010 +0000

    better error reporting
    Don't mis-report errors on the remote end as "unable to connect" errors.
    The reason this didn't come up previously is that the function we call
    for close_connection is the first to fail with an 'EXIT' signal rather
    than a 'throw'.

commit 4d0e6a11f8cad7268631e95a3afaac88304bbbdb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 16:57:20 2010 +0000

    add 'rabbitmqctl close_connection'

commit 593d0146d9bf1493d71c4c33c7d2a5e9c657cf1d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Feb 3 16:55:41 2010 +0000

    extend rabbit_reader API with a shutdown fun
    This is wired into the same logic as the handling of a
    supervisor-initiated shutdown. When the connection is in the 'running'
    state we send a 'connection.close' with a CONNECTION_FORCED code and
    follow our normal connection closure logic. In any other state we just
    drop out of the mainloop and thus close the socket.

commit 5cbaae5abb3d345c5f74b8d8166b96d5168664fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 16:39:19 2010 +0000

    Missing error case in delete_bindings

commit 9721b47b52f55b09bc007cf5df2fdcf4c39240af
Merge: 2aa502426 3dec42150
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 16:24:06 2010 +0000

    Merging default into bug 22169

commit 2aa5024266f75dad4e91ad9fa2537f05be8df718
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 16:23:35 2010 +0000

    One fix for a missing error possibility. Another fix for the spec of table fold. Dialyzer now happy

commit ff6abb689eb0f72926f3e8947ecdb05306952a00
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 16:16:43 2010 +0000

    Neater and less magic special case default exchange type registration

commit fe1c54f80f5fcf27ec288388f19780f5150bea8a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Feb 3 16:15:12 2010 +0000

    rabbit_exchange_type.erl => rabbit_exchange_type_registry.erl; rabbit_exchange_behaviour.erl => rabbit_exchange_type.erl; rabbit_exchange_behaviour_spec.hrl => rabbit_exchange_type_spec.hrl. Plus associated changes

commit 69254843dc48eb50911f3f7c0e42096e094b0cf6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 2 20:13:45 2010 +0000

    extend 'rabbitmqctl list_queues' command with info on exclusivity

commit 82d3065e1303085f5bf590a4f21f561161ed2fd9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 2 19:37:04 2010 +0000

    add 'rabbitmqctl list_consumers' command

commit 19642833f120e6b52fd41e77f37d57b40504f74e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 2 16:05:23 2010 +0000

    extend channel API with funs to get hold of consumers

commit b2b6200f753c96c79e2ae53b2ce1a9d42f6bbdd9
Merge: 3dec42150 ff5f2a016
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 2 15:35:59 2010 +0000

    drag in code from bug21966
    since we need the ability to find all channels

commit ff5f2a0169cc98414a2509b11088bcf0b496b66f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 2 14:37:10 2010 +0000

    fix typos

commit 3dec42150daa769a118eba7358b5eca73b3d6554
Merge: 43b475aec 0ddffb407
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Feb 2 12:44:24 2010 +0000

    Merge bug 22266 into default

commit 7ae26d13d4f141556bf498b01024a8be113a95df
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 23:34:20 2010 +0000

    cosmetic

commit 43b475aec4979e1a3e5c77f7dfeae3951264a3b9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 22:59:59 2010 +0000

    correct typos in rabbitmqctl list_connection man page

commit 209e5914c0329c51efa9463bf5806641344624fc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 22:58:09 2010 +0000

    add 'rabbitmqctl list_channels' command

commit eafef585eb6c367d99dafcccb605e517e7c60839
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 22:09:43 2010 +0000

    add prefetch_count channel info item
    This forces us to make the limiter a gen_server*2* at last, since we
    want to issue info-like calls at higher priority, as elsewhere.

commit e307ae7484eb6615358a47a2d2bd5f737c280eb7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 21:48:26 2010 +0000

    first set of channel info items
    the low hanging fruit

commit 8754ce0801eb79bd46557e95ff361ca78d273136
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 20:47:30 2010 +0000

    s/all/list

commit d337e971ea1fc7cb6bedcc8661fd5e6c172dfdd4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 20:38:02 2010 +0000

    introduce channel registry

commit ae44f419a09699504168ae47e8f5ce3780f19bfe
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 20:23:01 2010 +0000

    make pg_local do what it is supposed to

commit 14a18a52e39722981014b7cb71b92571417c3bc7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 19:29:31 2010 +0000

    rename pg2 to pg_local, prior to more substantial modifications

commit 91ea68ed5e3e4eeab21fb63ca865c6767fb82a15
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 1 19:28:06 2010 +0000

    check in R13B-3 version of pg2, before modification

commit 29597039d2141c373d7422e09bf834d8e88be5e5
Merge: e4dcf1dc7 5fff93381
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Jan 31 22:30:27 2010 +0000

    Merging default into branch bug16653

commit aac34f6d43a16bc47fabb5ae87e36ce09fdd4064
Author: David Wragg <dpw@lshift.net>
Date:   Sun Jan 31 12:36:31 2010 +0000

    Protect %*

commit e19b62c92925a3a0613b01a52d24888d598e3a39
Author: David Wragg <dpw@lshift.net>
Date:   Sun Jan 31 12:28:22 2010 +0000

    Convert rabbitmq-server.bat to use delayed expansion

commit 11e63b9c20ef5201cd6c65d4b8c3ff90f18c3726
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Fri Jan 29 19:54:06 2010 +0000

    improving shortstr overflow checking

commit 0ddffb40779e5a65bc3ef61141b60ef97399c50e
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Jan 29 12:46:52 2010 -0500

    bug22266: fixed language in a comment, due to suggestion from Sophie

commit 98d1db4b65ec61265874247b2c4322ed7f316253
Merge: bc586033a b22d79752
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Fri Jan 29 17:39:22 2010 +0000

    Merge from default to get an abundance of fixes; including (this is the
    only non-conflict resolution) pre->enables and post->requires.

commit 5fff93381a8bd21657b587793cf7fddefa570c3c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 29 17:01:49 2010 +0000

    Decided against preventing deps include on clean, given there are other targets that don't need deps either, and keeping track of them is going to be unpleasant at best

commit b22d7975219f1260b22431950ce1206aab2fdba0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 29 16:58:20 2010 +0000

    If the only target is clean, don't include the deps file. Also the deps file gets built automatically if we need to include it, so all doesn't need to depend on it, and using  is neater

commit e4dcf1dc7b50d708d556fe66aa03986749455042
Merge: 76de2544a 226bccfaa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 29 15:49:01 2010 +0000

    Merging default into bug 16653

commit ac74eb4e324a85e817a12292c541eda2aca93e29
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 29 15:29:30 2010 +0000

    remove outdated comment

commit f6fbe5575df5e3d46cc3dae4641e41bff72cbe72
Merge: 348b99b78 226bccfaa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 29 15:14:50 2010 +0000

    merge default into bug21673

commit 226bccfaae1ac7c2d94ec8dc00812138565c502b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 29 15:04:07 2010 +0000

    automatic, and accurate, make dependencies
    ...taking into account includes and behaviours
    This code was originally committed as part of bug21673

commit f1c34ec00bb3d908e7833528812889be4a2a0a30
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Jan 29 09:49:07 2010 -0500

    bug22266: we don't depend on os_mon any more, though other parts of code still depend on cpu_sup, so we can't remove os_mon dependency

commit 76de2544ad74b63db5b9f09e7f7b711a30a6bb1a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 29 14:12:09 2010 +0000

    Remove the response verification as errors should cause the channel or connection to be closed

commit cb5d035c3731285e26687d7455e64ad00c2a0cfd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 29 13:11:19 2010 +0000

    Need to be able to verify that the response got back from the server is ok, when declaring resources.

commit 348b99b787783f3ded4f6522f1d1fd5e7e5cc2e0
Merge: e9c12ff44 9e2f1c40a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 29 12:41:53 2010 +0000

    merge default into bug21673

commit 9e2f1c40afef9d34ede9f0157da2cb0d37feb876
Merge: 340b9dab1 f942d51b5
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 29 08:25:11 2010 +0000

    Merge bug22213 into default

commit 63a1de1021781266eb39a786872003c365797958
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Jan 28 13:22:24 2010 -0500

    bug22266: make magic numbers less cryptic

commit 3e22803b7d0ae10b10b528bf6d777774ea05ca9f
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Jan 28 12:51:12 2010 -0500

    bug22266: get_vm_limit now made exception for Windows, but it doesn't matter any more as I also disabled memory probing on windows completely. So I guess the virtual memory on windows is just for the sake of completeness.

commit 59db1345dde316eee80f24a472e403da83fd7f16
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Jan 28 11:34:29 2010 -0500

    bug22266: redefined what memory limit shall mean

commit e9c12ff44433592d9932f36f3e0edd4612d6b468
Merge: 97a25e98e 340b9dab1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 18:30:40 2010 +0000

    merge default into bug21673

commit 340b9dab1e3fb9a03c7addba549a04472e705750
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 18:29:45 2010 +0000

    flesh out binary_generator API
    ...for symmetry with binary_parser and because we need it in bug 21673

commit 97a25e98e862b5c41889c5d93204ea79b7ea8cf1
Merge: c3bc15650 e4f81545e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 17:43:00 2010 +0000

    merge default into bug21673

commit e4f81545eb5ed120a85b4c8737e05568bfb641ef
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 17:42:31 2010 +0000

    minor addition to vm_memory_monitor API
    We need this in bug 21673.

commit c3bc15650fbe69c53f36b5b0a3e9c8d31e9fc863
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 17:07:21 2010 +0000

    revert accidental though harmless change

commit a051cc3c759149c0889ab16a4eb9b5e581e8986e
Merge: cdb564a4e 9181d3406
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 16:36:36 2010 +0000

    merge default into bug21673
    and make new vm_memory_memory:get_memory_limit gen_server:call use an
    infinite timeout, for consistency with the changes on default

commit 9181d3406c85be7dd8c79448f8d9fb701874a60c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 16:34:39 2010 +0000

    infinite timeout in all vm_memory_monitor gen_server:calls
    since we have come to the conclusion that this is generally preferable
    to things failing after some some semi-arbitrary interval.

commit cdb564a4e372a4eb1602aaf843b59d8ecd438cb7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 16:29:40 2010 +0000

    move the handling of absent vm_memory_monitor process to call site
    ...for consistency with rest of API
    Also, use gen_server, not gen_server2, to reduce dependencies

commit 546ca100675a06616895d9187aec6769270d4815
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 15:30:35 2010 +0000

    it turns out we no longer use gen_server2 insomniation

commit eb7592af985055f665da52c94c54bb808163d2ee
Merge: 0bfcb208b 4691d6a87
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 15:03:19 2010 +0000

    merge default into bug21673

commit 4691d6a87e77737f9b02b4375be88f290cc07d5a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 15:00:43 2010 +0000

    refactor: eliminate code dup

commit 0bfcb208bf84ef5f2e9f449e6f2a239beba00ae2
Merge: 92978516e 5ce861e6c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 13:22:08 2010 +0000

    merge default into bug21673

commit 5ce861e6c5a334013bd937f93abea4671b343816
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 13:01:29 2010 +0000

    cosmetic: give startup messages a bit more space

commit 9b916a846354edea15da0d20127cc619fe1ea0ac
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 13:00:30 2010 +0000

    fix embarrassing arithmetic bug in 'ceil'
    0.0 doesn't case-match 0, but 0 == 0.0

commit 92978516e166e50d3f10e709d690a8bbe3e9888f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 12:49:24 2010 +0000

    revert uncosmetic change

commit d40e548c5d33dcdf5f15273721a753c77ca8c4cd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 27 12:42:24 2010 +0000

    Added method_record to codegen.py for the shovel

commit 93d302c594c11e7442f424c90daba924650af4e5
Merge: a79a36d32 659272ff3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 12:37:44 2010 +0000

    merge default into bug21673

commit 659272ff3aa79f725961b8e8a931ae6d443cf926
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 12:34:19 2010 +0000

    cosmetic: squash trailing whitespace

commit 329fd4ad3b298911b600f5933c9e17bf387c32a2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 27 12:33:41 2010 +0000

    cosmetic: re-indent rabbitmqctl help message

commit a79a36d32f5237b0174ad1efb78ed3f96462d372
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 26 17:45:21 2010 +0000

    cleaner handling of rabbit_framing dependencies
    these are now computed, like all others

commit c7a2d629b1098e1648d61143ad788c0391ffb471
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 26 17:03:12 2010 +0000

    make generate_deps less aware of its context

commit 3a4053a6be8b536bbe618c30706f2f2d51dd90fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 26 13:45:24 2010 +0000

    Opps, they may not match

commit ee7fbe8e162494c532fb72585b9edbf60ae65ac3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 26 12:27:32 2010 +0000

    Converted to get epp to do the transitive closure by giving it the include path. This all seems to work, but it does make deps generation nearly twice as slow

commit 9087606d4bba1b6b44c0b9232373084d9bc7ea27
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 25 17:59:19 2010 +0000

    explain the non-obvious

commit db3ae490776deb62ac7c3602fd142b4d2ff1b03b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 25 17:37:03 2010 +0000

    refactor

commit 6c50d41e41ebf15d8941b8177361aeb82404e469
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 17:06:42 2010 +0000

    (Minor refactorings and changes to deps generation)²

commit cd6a9e6122ccf32abfb787ecb7abf5259a122715
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 17:00:57 2010 +0000

    Minor refactorings and changes to deps generation

commit 4169d8a6457945c78a97e25e3601f9162a4fc270
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 16:08:00 2010 +0000

    There's the possibility that the timer may fire whilst we're doing the vq sync callback thus leading to a 2nd call to that, hence specialising a noop clause

commit 739d37737f7d9a668010a49784c1151336062faa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 15:46:20 2010 +0000

    Patched supervisor2 with support for simple_one_for_one_terminate

commit 142363e1346ba66ca48e15858494a1ab32ed89ef
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 15:43:34 2010 +0000

    Added supervisor2 straight from R13B03

commit e5a69ebae90f25822c4ed649b552e47d4a21be0f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 15:42:46 2010 +0000

    Removed supervisor2.erl

commit eef24935008ae65f561074323a26f14da56476cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 15:42:21 2010 +0000

    fix

commit 81017e0a35e52d009a9c3407dd8bd2d8a5d30247
Merge: c03f54957 41b0830d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 15:15:00 2010 +0000

    merge default into bug 21673

commit 41b0830d2dd47a9db96452f60f7b8c915f298e2e
Merge: ae89fa664 5bf7be1d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 14:40:21 2010 +0000

    Merged v1_7 into default

commit 5bf7be1d2ccc87602a013c40ef46f5ba711421d3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 13:52:03 2010 +0000

    Added tag rabbitmq_v1_7_1 for changeset 90e101fd8b67

commit 40f2d31176de132472fca1393de7a02cf8c28de8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 13:51:05 2010 +0000

    release v1.7.1

commit c03f54957f88e8b08abd296f016c265f9932eefb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 12:49:40 2010 +0000

    Made the deps file depend on the includes too, and also force on use_specs when generating the deps otherwise we miss out some transitive includes

commit d511eab3ab944bcafb2b254677cc5e07ab5aec5f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 01:04:23 2010 +0000

    Minor tidying

commit 3b1a4ba372ae31a1c6dacd86557f8380d06e9243
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 25 00:57:09 2010 +0000

    Added dependency analysis so that we know to compile behaviours first, and we track deps on includes (+transitive) correctly

commit 4c6b3ba492eb171d37d800e708f65f0543e89073
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Jan 24 00:44:45 2010 +0000

    Added supervisor2 with simple_one_for_one_terminate strategy and wired queues to use it

commit c73b4da7b75f2bec2a81ae26e756780355361134
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Fri Jan 22 17:31:52 2010 +0000

    fixing merges

commit bc586033a279ffc7c18b40be1865d4867f94241d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Fri Jan 22 16:33:18 2010 +0000

    Remove the unnecessary reverse-lookup table fom rabbit_exchange_type

commit 93def88653777bf641bfea90c767ffc82971be0b
Merge: 8261002b5 2b3f363f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 22 15:48:17 2010 +0000

    merge default into bug 21673

commit ae89fa66458946ff3fad466b5c27967e9bea13da
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 15:46:33 2010 +0000

    Leave 'hg stat' clean after macports packaging

commit f942d51b54d95073229f3a43649c760d9ef534b4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 22 15:38:47 2010 +0000

    pre => enables, post => requires

commit 3d297e6b5ad16af5bbf0ff42876680e140fc0e51
Merge: 1df0380ac e0db1ab53
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Fri Jan 22 14:39:14 2010 +0000

    merge with previous head for merge of default into 0_9_1

commit 1df0380acd1e64fcfd2ec539fef7425bee72ce93
Merge: 11fe6b478 a9433b4bb
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Fri Jan 22 14:25:31 2010 +0000

    merge of default into amqp_0_9_1. Not quite working yet, but runs and passes some tests

commit 2b3f363f537873f19560b34650f9e8044f7f5b1c
Merge: c462b3841 9d7eaa6af
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:33:50 2010 +0000

    Merge v1_7 into default

commit 9d7eaa6af0a44ff3b38e13329a02b075122fbc6e
Merge: f7c003a67 eeba079ca
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:32:39 2010 +0000

    Merge bug21930 into v1_7

commit eeba079caa9394273ce9056a08ca53adaf5353f5
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    The macports Makefile should by default construct the macports package

commit 7ae9a6b1b3cb084d17eded58a258e756487c8d10
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    Incorporate the minor changes from the macports svn portfile

commit 16dc269136e701d7e6ff59a397abb6e1144d55a5
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    Get portindex to produce the tgz files required for an http macports repo

commit cef1abc2345484dd2d90a653f0d46f20b406e767
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    Generate the macports index files by sshing over to an OSX box

commit bcec81d0c64799a7fdc6c24109bf8fc14a4c93b8
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    Templatize rabbitmq-script-wrapper so that it works under OSX

commit 617a495bbc2030644a04a7c58ba050109f38d48f
Author: David Wragg <dpw@lshift.net>
Date:   Fri Jan 22 11:30:48 2010 +0000

    Introduce a Makefile to produce the macports artifacts
    
    The checksums in the portfile are automatically updated, and the
    relevant scripts are copied across from packaging/common.  However,
    due to differences in the options supported by su in Linux and OSX,
    the scripts don't actually work for OSX at this point.

commit 87556da94328e5dec49f113304189309faa37402
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Jan 21 18:38:21 2010 +0000

    unsplitting map_exception; erlang client will be using map_exception directly

commit ea42491d35112d28c8ef5c23aeedaae1043abe53
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Jan 21 17:59:03 2010 +0000

    moving rabbit_reader:map_exception/2 to rabbit_binary_generator and spliting it into amqp_exception/1 and map_exception/2 in order to use amqp_exception/1 in the erlang client

commit 8261002b5ed1d6f9f60485881398b3fd8ad89144
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 15:21:05 2010 +0000

    typeo

commit 4361c141f301b766b5411bd400a4ee240db11138
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 15:07:06 2010 +0000

    Wrote new documentation for VQ

commit dcb54f9601fbed091629e3340ee4a780b2421aaa
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Jan 21 15:01:09 2010 +0000

    Make the return type of maybe_autodelete distinct from that of
    conditional_delete, and be more strict matching its return values.
    Confusion over those led to the delete hook not being called when an
    exchange was autodeleted as a result of a queue being deleted.
    
    It now calls delete_binding then delete in this scenario, rather than
    just delete, to be consistent with the other place in which exchanges
    are autodeleted (when a binding is deleted directly).

commit be52749839a2a1f56de64d9c8b8092d066974765
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Jan 21 14:34:48 2010 +0000

    adding lookup_class_name to rabbit_framing

commit 686708b6ee829b5c2e9d2863eddbeab05d0ac8b1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 14:24:23 2010 +0000

    doc improvement

commit 91fda7dfb7aec70a24de0419e9717a2758589086
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 14:21:43 2010 +0000

    Added documentation for qi

commit 0e6a36cab0dd953d61d42616b35128f84d39066f
Merge: e1ca83601 c462b3841
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 13:38:55 2010 +0000

    merge in from default

commit e1ca83601402e403106c0db14b20b98b16bccff7
Merge: 873e3dfcc 7f992290a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 21 11:41:09 2010 +0000

    merge bug22218 into bug21673

commit c462b3841e055f6e95472c4144649f7ae33dcaa7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 21 11:32:31 2010 +0000

    this looks prettier

commit 7f992290a62cb70c8d7b1e5b3503303f4f059b7c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 11:16:07 2010 +0000

    fixed²

commit 201957e436b9b41c415824e0b16e7b83979476a2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 21 10:51:34 2010 +0000

    fixed

commit f7c003a672b26bc00099b60e204ec17d3c993fd9
Merge: 85b9f37c5 e99f20c19
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 20 18:23:07 2010 +0000

    merge bug22225 into v1_7

commit 8f6837ef5bd9ba97b7e8513307e9a1b692511c7a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 20 17:31:30 2010 +0000

    Given we know all of those processes are about to be enabled, the order in which we do that is actually irrelevant

commit 1c0359b36186a67de9b43f99775572b0527d6926
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 20 17:24:01 2010 +0000

    A mistake in the error case in accept, and elimination of one reverse

commit 2c5d3fee352f71c34db6da79cbf3e696447f776f
Merge: a9433b4bb 85b9f37c5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 19 21:45:38 2010 +0000

    merge v1_7 into default

commit 85b9f37c52e7d5b79cc722c03f423600089777c8
Merge: f9524331f 10f37652e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 19 21:40:42 2010 +0000

    merge bug22223 into v1_7

commit f9524331f4796f3288195085d6dadf83aa7d9ce3
Merge: 81dfdbfb1 8eb62868a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 19 21:09:53 2010 +0000

    merge bug22221 into v1_7

commit 8eb62868a8850707d05d0a40fc1f112373d9f3af
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 19 21:06:42 2010 +0000

    no need to match on 'ok' twice

commit 873e3dfccca03eefcc781c388c2cc8ee6f951947
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 17:45:47 2010 +0000

    documentation

commit 51c879d3069024a8264a61dd4037f914d10cb2fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 16:53:42 2010 +0000

    Added behaviour for msg_store_index and tidied includes, and updated makefile appropriately. Good lord it'd be nice if erlang did proper build dependencies...

commit f46b71cf9d8b0c4f389cad5de80b8efc74cdade9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 16:02:40 2010 +0000

    documentation

commit c28ca505c625bf19da0482432596b790f3618ddb
Merge: d84e28ac5 8d1b348f0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 16:00:00 2010 +0000

    merging in from bug21673

commit 8d1b348f0aad58bbf492603090800d6a15190bb3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 15:59:28 2010 +0000

    documentation tweaks

commit 33fb64b1eb0fb1762fd502b4012857020e11d8c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 14:51:23 2010 +0000

    Make sure the fhc server is started early on in the boot process

commit e99f20c192825c5ec8d5676c426b4b12526c0fad
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Tue Jan 19 13:06:01 2010 +0000

    put the erlang crash file in an erl_crash.dump file in rabbitmq base rather than as a text file named log

commit d84e28ac566667bc259c71149d7e151322e713bd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 19 12:13:30 2010 +0000

    The motivation for the cast in init is that if the first obtain blocks then without the cast, rabbit won't startup because of the fact that start_link blocks on init thus the boot process won't finish. Switched to monitoring the spawned process which is much much nicer than passing through a fun to be run at the end of the process and is a much more generic solution anyway.

commit 25e0a6ef39d5151af66b128cffc65a9e4f0c05e5
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Tue Jan 19 12:10:47 2010 +0000

    vertical alignment of -> in queue_fold

commit 6cb2ca71750b0cc8825583993bd66b3a5ba892c6
Author: David R. MacIver <david.maciver@lshift.net>
Date:   Tue Jan 19 12:00:20 2010 +0000

    rebranch off v1_7 rather than default

commit ff9c5f2bede565788bece4772d979861a0fd68bd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 18 17:52:29 2010 +0000

    Initial pass at solution. Seems to work. Interesting realisation that the fhc server was never previously running (post new boot sequence).

commit 826f35f4ad150b6ca7c48c78b8d3d9cb456f5e52
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Jan 18 16:32:40 2010 +0000

    Switch (back) to using the type name atom in #exchange, rather than
    the module.  This is to restore the indirection between types and
    their implementation.  Note also that we no longer need the reverse
    mapping.

commit 10f37652e57e2e9272816022cd889b3b491df99d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 18 13:44:24 2010 +0000

    Bumped priority of acks to match that of the unblock and notify_sent calls

commit 473d2da7cc4a25ee9e71a690eaa100b673bbfaad
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Jan 18 13:14:37 2010 +0000

    More indentation regularisation

commit 41bc7e41ca1d2ba23950fd143262b270b7246160
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Jan 18 12:54:45 2010 +0000

    Indentation, and consistently ignore hook returns except for validate/1.

commit 79b01c4b17db14eaefac52f1f6c7a9cc89676cd8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 18 11:40:08 2010 +0000

    Of course, there's no reason not to add into the current file cache immediately, thus allowing a write followed by a read to have no delay at all

commit 638f2c94e1fc201806710056641685d3ca169ae7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jan 18 11:01:44 2010 +0000

    Of course, we should only delete messages when they're, err, due to be deleted...

commit 33caa1d97ca81b59ebc44bef84feaaef2cf86e2c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Jan 17 20:48:11 2010 +0000

    Refactored and generally tidied the msg_store. Also added a write-back cache for the current file. This means that the clients don't need to go to the server when reading a msg from the current file. Managed to avoid using any further lines!

commit 236aeca90193e83bc46c75d1c29f52f9e876c8eb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jan 16 20:21:54 2010 +0000

    Correction of modes in reading

commit 608f3186dac8b869788fc124ff4b1b2cec3ccd8f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jan 16 19:35:05 2010 +0000

    When publishing delivered, the fact is, the message has already been delivered. Thus it should be marked as such, otherwise bad things happen when you eventually try to delete the queue (i.e. crash).

commit d1a303c7f424be55f03b3adc4e8e7e8a2067fd6d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jan 16 18:24:04 2010 +0000

    Inability to do basic maths

commit 81dfdbfb14e974d281648f03f1da26f4220cd489
Merge: 2131feb67 5be0d84db
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 15 18:11:08 2010 +0000

    merge bug22013 into v1_7

commit e6f2d6fabaa90f576feaa46ee6b2640aec1c7f4a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 15 18:09:36 2010 +0000

    Refactoring of bpq

commit a34e9313713a20eebaacc564977323c27708cbca
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Fri Jan 15 17:18:03 2010 +0000

    Change to different exchange callbacks.  Requires a bit more
    calculation in delete_queue_bindings and recover to collect the
    bindings.

commit 5be0d84dbe38bd1303facd13032985d4c906e96b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 15 16:47:11 2010 +0000

    The DEFAULT_ values should not be available to the .conf file

commit b8d4e87b64098e5be1280a152c2f8a3683d21f7c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 15 16:10:50 2010 +0000

    Fixed. If the env vars are not set, combine them from the .conf file (non-RABBITMQ_-prefixed). In the case of one set but not the other, use the DEFAULT_ values.

commit 2131feb67089a700661cbf080b197d706d988756
Merge: 76fd4528b 7a7b104a7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 15 08:34:31 2010 +0000

    merge bug19111 into v1_7

commit 7a7b104a79a6d2e241f2613036dddd860f031918
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 15 07:55:33 2010 +0000

    recreate branch in correct place

commit 27c7662298ef60b2406090d764256ac55fd2b850
Merge: 86fb3e2f0 a9433b4bb
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Jan 14 15:10:48 2010 +0000

    Merge from default, to get new boot sequence among other things.

commit 9de346af92ef333e1f2c18c81fced1c2c9f96434
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 14 13:46:13 2010 +0000

    Extensive testing suggests the batch size was previous set too high

commit 86fb3e2f089653d3951bd564633eb5c7ae156ad1
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Jan 14 13:23:59 2010 +0000

    Change to (almost) the mooted API, and support recover and validate.

commit 52e495c11e490002327a4c728c86d4f0cef936a6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 14 00:47:22 2010 +0000

    Should actually be working on the ratio of betas to betas+alphas. Thus subtract out deltacount

commit 0e4c51443bc8b40f3e83db85e01c26604053263d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 13 23:53:40 2010 +0000

    the ratio should always be 1. Hence removed.

commit f6bd5fbaeb6c1413daf5c7107d2d6009d60b9034
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 13 23:46:08 2010 +0000

    Much better. The reason why batching is important is because if you're walking through the bpqueue and doing very little work before stopping then you don't really get the amortised constant time behaviour. But the goal is achieved - throughput is maintained and very slowly diminishes with no major interruptions and the queue gets fuller and the transition is made to betas and then deltas.

commit 6bf6e7a2e39d7484307ac5cd664c6547a0367b3f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 13 19:40:46 2010 +0000

    Forgot to remove an io:format

commit 24add8edcbeddbdfc5e0998e964984ee72e7c8c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 13 19:32:51 2010 +0000

    Mechanism to limit the number of betas which don't have their index on disk is now in. Testing showed that if the queue is long, the change in target_ram_msg_count can be large, thus driving the number of ram indices directly off that still doesn't solve the problem. Thus am driving it from publish, with a limit on the maximum amount of work that can be done. This should allow the queue to remain responsive, as it works towards its goal. However, further testing, tuning and thinking is still needed.

commit 2778cb7181909ab5efbd46d5191ade2b85718c66
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Jan 13 17:53:33 2010 +0000

    Run the hooks outside and immediately after the mnesia transactions,
    if something newsworthy happened.  Mostly this is just a case of
    changing the thunk run in the transaction so it returns an indication
    of what the result was (e.g., a new exchange).

commit b7c1a4b15f129bf920adfc59881ca9498034499f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jan 13 16:56:18 2010 +0000

    Refactoring of vq - pulled out the inlined block-prefix queue code and generally tidied profusely. Also efficiency fix in remove_queue_entries by avoiding an intermediate list (which could potentially be massive).

commit 2470679859e26119837fcc9a7704be77055b3456
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Jan 13 15:33:13 2010 +0000

    Remove mnesia event implementation of exchange hooks, again.

commit a9433b4bb71c81c579e6b3222603bcea529917f4
Author: Alexander Schmolck <alexander@lshift.net>
Date:   Wed Jan 13 15:15:39 2010 +0000

    bug22209: added a comment to use upmap carefully.

commit 1e4ecb8f788103cb2d52cbf551e16a3fe0d829f2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jan 12 18:33:37 2010 +0000

    Right, getting there - some major reworkings to vq which have fixed bugs. It doesn't quite do everything I want it to do it - in particular, on memory reduction, it needs to ensure that the inner queues nearest δ have sufficient non-ram-index msgs, but all thet tests pass and adding that feature shouldn't be too painful.

commit 872a13632237b4c9440320a819afd413e9231685
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jan 9 19:03:56 2010 +0000

    some minor refactoring (more to do), and spotted and fixed a race condition

commit e2ef3eda466a5de318ffc87f8c40b42b8b5aae74
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 8 23:08:41 2010 +0000

    Scanning the common operation, so that should be prioritied. The open->close transition is much rarer (only on GC startup and file deletion) so can be slower.

commit e4b3284c281268c7cdf86117bbc2f1c79f55142b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 8 17:53:06 2010 +0000

    Correct the closing mech. Sadly I'm currently scanning the whole table every time, which is bad. I might change that to scan every, say, 1000 reads

commit c9daa780ac0b11a7a19d756d2d97f8a64865c92c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 8 17:05:32 2010 +0000

    Whoops, forgot to remove an io:format

commit 003bcc5a106b5de17318c8a475ce0c9837b8923e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jan 8 16:58:54 2010 +0000

    Msg_store now supports concurrent reads when it is safe, directly from the queue. This means that even if the msg_store process is flooded with writes or acks, it won't (necessarily) block queues. This is extremely useful and has substantial benefit when memory has been exhausted and the queue is operating off γ only (effectively, no message content held in ram).

commit 3274299179812bfc5be48886ecee4d29d02d22c4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jan 7 16:26:24 2010 +0000

    Toughened up cache accessors and switched to using named tables in prep for concurrent readers of msg_store.

commit 3e2f565c8a10fc6fdded8dc081e8d3b96f7cb8c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 26 21:34:55 2009 +0000

    Env var does not need rabbit_ prefix

commit 3f469ccfdb7b3386d365e7f16406f82da528fb50
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 26 21:30:15 2009 +0000

    Put the default index module (ets) in the .app template, and assume the env var exists

commit 37223b15449631c87605676a42ba677a31bdcb52
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 22 17:34:41 2009 +0000

    Support pluggable msg_store index module through the rabbit_msg_store_index_module rabbit application var

commit 5853e213c08caa57ecd1e54b43a0b60926fe87e6
Merge: 95f466aa1 4e6dfcb12
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 22 16:42:49 2009 +0000

    merging in (and adjustments for startup) from default

commit 4e6dfcb1256cdab73233df88dba1aad543e71095
Merge: c63aadd5c c1f42a6cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 22 16:12:02 2009 +0000

    merge bug 22039 into default

commit 95f466aa10e9ae29bf0d8b6b3f81846bb55bfbd0
Merge: 1e2f77364 57baa1db6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Dec 20 19:04:58 2009 +0000

    merged bug 22161 into bug 21673. Lazy, concurrent msg_store GC landed.

commit 57baa1db68397e308c57a738a29ec136065eee8c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Dec 20 17:22:43 2009 +0000

    Ensure that :contains calls can't overtake :remove casts. Also modify the tests slightly.

commit ce04e209a546f85e1630cf358c8ef37b3d238a61
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Dec 20 04:10:45 2009 +0000

    Must start msg_store *before* amqqueue_sup, otherwise on shutdown, there's a nasty race which blows up the channel on notify_all_down because the msg_store exits wrongly, first, killing the queue process when it calls msg_store:read, and then the channel can't call the queue. Thus start msg_store before queue_sup, and none of this problem exists

commit 0599f5e85ec9149109561b3954818c5db7a2d25b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Dec 20 03:43:21 2009 +0000

    background lazy GC in and working

commit 90f9a5f213b1ae2d47c4d78d8e44505c563f285d
Merge: c733a5308 1e2f77364
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:37:52 2009 +0000

    merging default/21673 into bug 22161

commit 1e2f77364d773a726d775b1a5b76cd599e32e6af
Merge: 4130618aa c63aadd5c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:36:25 2009 +0000

    merging default into bug 21673

commit 4130618aac68fc5903ed7ddeae95ba538f2f3ba5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:36:06 2009 +0000

    msg_store traps exits, and so it should have a handle_info clause to catch that

commit c63aadd5c4a81a2435c5e8660b80a5e352ccd097
Merge: 832a287aa 76fd4528b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:33:02 2009 +0000

    merging v1_7 into default

commit 76fd4528bbafbccecd8e94f19874e17e85a42959
Merge: 21b9b3d0d 21e43c867
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:32:40 2009 +0000

    merging bug 20916 into v1_7

commit c733a53080902ca719ac2029f92615efedc3c1c0
Merge: f0bcbed84 97d6bd33c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:28:03 2009 +0000

    merging into bug 22161 from bug 21673

commit 97d6bd33c0c4b4c6946eacb0aff518c3dec001d4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 16:27:30 2009 +0000

    Any exit signal arriving at the amqqueue_process should result in the process stopping and calling terminate

commit f0bcbed84b2fe7e9b3791f2d676ed650dd9fa2d3
Merge: 4b881accc 72d55a5e0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 15:56:22 2009 +0000

    merging default+21673 into bug 22161

commit 72d55a5e0fbe50f279b1230b68967289d14b96b1
Merge: c10282711 832a287aa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Dec 19 15:55:33 2009 +0000

    merging default into bug 21673

commit 21e43c8673020db8a6a7dc02c6856ac47a77fbd6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 19:30:44 2009 +0000

    not_found error on attempt to declare a queue that exists on a stopped node
    this prevents loss or duplication of messages when that node recovers
    
    I considered returing {ok, Q} | {error, not_found} from
    internal_declare (and subsequently declare), and let the channel deal
    with throwing the appropriate amqp error. But
    - that would be a change to a crucial internal API that is used by
    quite a few extensions
    - it would make the return type inconsistent with
    rabbit_exchange:declare, which too only returns X, not {ok, X}.
    - the rabbit_amqqueue module already knows about amqp errors - see
    with_or_die. So this is not breaking any concern separation.

commit 4b881accc7b8a43df6b67e8b462bb52faf631d1e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 18 17:32:16 2009 +0000

    document insomniation and also ready the msg_store for such gadgetry

commit 7e533199d0d190896c4c2614b78cbbdd0d8314f1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 18 17:21:43 2009 +0000

    support insomniation

commit 73afe0db73876aa321f098bed1de0816e6c85391
Merge: 407b5126c f87f1d9d1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:59:38 2009 +0000

    merge bug22068 into bug22169

commit 407b5126c3ac523f7023f517e3520b5d12dee7f3
Merge: e0b99deb2 b72071659
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:57:45 2009 +0000

    post-backout merge

commit b720716599070a8a496563d6f686a4d7eaee9ea5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:57:28 2009 +0000

    Backed out changeset b2ff7bbc3df6
    re-introducing pluggable exchange types on a branch

commit e0b99deb2b560681ac30a0743927be44828e7ea9
Merge: 30455af1c 767e10de1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:56:40 2009 +0000

    post-backout merge

commit 767e10de15e908c4d04f5a4b4c45687ed248e420
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:56:25 2009 +0000

    Backed out changeset f878dbe8e0be
    re-introducing pluggable exchange types on a branch

commit 30455af1cbedc51f09a300d84949c1e3ccd733f4
Merge: 3d9113021 fc0371664
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:56:07 2009 +0000

    post-backout merge

commit fc03716646b50ff5478821e3edb433a8103b72bb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:55:53 2009 +0000

    Backed out changeset 443c7b2d7e1
    re-introducing pluggable exchange types on a branch

commit 3d911302114e283b1388972017625e9443dbb572
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:55:10 2009 +0000

    create branch for bug 22169

commit 832a287aa5527e347cdb39961890e11adf555faa
Merge: 174bf6f2d d74a371b2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 16:54:39 2009 +0000

    merge bug22082 into default

commit 21b9b3d0d7c337fd562e2d03610a7fd8ea1b03dc
Merge: c706e4f9d d74a371b2
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Fri Dec 18 15:36:58 2009 +0000

    Merge no-pluggable-exchange branch into v1.7-series branch.

commit c706e4f9d3daebd9ed992e3280ff2b0b921af347
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:50:02 2009 +0000

    create branch for v1_7

commit d74a371b279a99373f5580084879b5e12e2a8e62
Merge: e8edd6215 f315f005c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:45:07 2009 +0000

    post-backout merge

commit f315f005c3dc25c89d2dd99693f9a30521520263
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:23:25 2009 +0000

    Backed out changeset 71e93e17450c
    pluggable exchange types are not ready for prime time yet

commit e8edd6215adc8502c11950c6e3e1e042e6b6a0f0
Merge: 6639c6d05 4e5b4d665
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:21:46 2009 +0000

    post-backout merge

commit 4e5b4d6656737e02b434d8ff42dfebe478b02ba0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:21:34 2009 +0000

    Backed out changeset b2363fc1a51a
    pluggable exchange types are not ready for prime time yet

commit 6639c6d054a9f0d8421e0047fe0d6b25408d1d42
Merge: 33c2260bc 7a28f1b4d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:21:06 2009 +0000

    post-backout merge

commit 7a28f1b4d9b82fa3c6ad37fc9fd1574a5f22638d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:20:50 2009 +0000

    Backed out changeset 3ab59ae0f0e9
    pluggable exchange types are not ready for prime time yet

commit 33c2260bcd4187f3c6adc70511499b37fdafc699
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 18 14:18:25 2009 +0000

    create branch for bug 22082

commit 4b9976db82880cb3cdba8d37509223e5606db60e
Merge: 3bc49c563 c10282711
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 18 12:00:57 2009 +0000

    merging 21673 into 22161

commit c102827117fcf636501869286bed73459d261015
Merge: 719a8ff67 d5522a16f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 18 12:00:30 2009 +0000

    whoops, we seemed to end up with multiple heads here

commit 3bc49c5632550e69aa569120e0e02b63de30a011
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 18 11:49:21 2009 +0000

    correct condition for doing GC

commit f87f1d9d1950eee917ff95a8e24be3ad5077d85d
Merge: 26f823825 174bf6f2d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Dec 17 20:07:48 2009 +0000

    Merge default into bug22068

commit c1f42a6cf5316a2a1de65bb88388780dc35275ce
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Dec 17 19:22:52 2009 +0000

    Refactor away boot_core_processes.

commit 1d83e5c61a414c9f05f4d294f256508d9b69c6dc
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Dec 17 18:55:22 2009 +0000

    Refactor boot_recovery, boot_tcp_listeners and boot_ssl_listeners

commit 876f04b36d16926488d0dbb372ee796473f4a3f7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 17 18:50:02 2009 +0000

    geometric distribution

commit a3d94a990ec7cfe9e22b6c3524b0d833aee0efc5
Merge: 77c5ce5a1 174bf6f2d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Dec 17 18:45:36 2009 +0000

    Merge default into bug22039

commit 78adc6d026300c7ebd29abf97e4f295e949e5636
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 17 18:42:12 2009 +0000

    All sorts of stuff. See the bug. GC is off here (other that deleting empty files). File locking is in. Some other machinery is in wrt background GC. Lots of reworking of the GC code to get it into a more useful state (everything from adjust_meta downwards). Tests do actually pass, but with GC otherwise off, you'd be mad to run this.

commit 719a8ff67308eb1b80a61ada6bfae7b7ef8da64b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 17 13:08:01 2009 +0000

    Reworked the GC of msg_store so that it scans the files themselves for their content, rather than a select on ets. This bounds the time it can take (ets could have many billions of other entries in it), and also makes it simpler to make the msg_location pluggable => toke. Also reduce the msg file size to 16MB from 256MB as tests show that although max write speed drops (more fsyncs and fclose), the GC is much faster. This may go back up a bit when lazy+background GC arrives.

commit 174bf6f2d5862f048fb093f9e8ea9a175f273f44
Merge: 8cadb59d8 12ab14af5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 17 11:16:21 2009 +0000

    merge bug22013 into default

commit 9542e4d24e3968ed973a549370a120b9d222ecde
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 16 19:14:53 2009 +0000

    Added accountancy for file size and sums thereof plus sums of valid data. This simplifies build_index slightly and complicates remove_message slightly. Also found that in delete_if_empty, was failing to close any file handle open on the file prior to it being deleted.

commit 77c5ce5a108166f67940e8509e79823b534efc5d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 16 17:25:08 2009 +0000

    cosmetics (mainly line length, alignment and trailing WS)

commit 8cadb59d87fbc09aae02bf71090c333348fab212
Merge: c7eb7731d 64f12679f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 16 16:12:35 2009 +0000

    merging bug22113 into default

commit c150ac5ca0ed6c57b8f59c95103e8877ccd12073
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 15 17:43:03 2009 +0000

    Don't reverse the entire list, only to pull off one element

commit be240e47b20c631e50b394a888e7eb785c278e36
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 15 13:30:00 2009 +0000

    Noticed that sometimes the shutdown message that appears to the queue process is of the form {shutdown,{gen_server2,call,[rabbit_msg_store,{read,<<96,94,147,36,83,202,129,231,131,151,203,11,95,112,69,118>>},infinity]}}. I presume this is when we're shutdown whilst in the middle of a call. In any case, it was falling through to the wrong case in queue process terminate, and resulting in the queue being deleted. Brilliant. Sadly, the fix is pretty much code duplication because you can't do a partial pattern match / unification in a guard.

commit a38cf00a8179ed38181756b178245724bd7d24a8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 15 13:11:40 2009 +0000

    qi: all_segment_nums was not returning its list sorted. As a result, find_lowest_seq_id_seg_and_next_seq_id could return the wrong values. vq: because of the bug in qi, vq could construct γ wrongly, violating the vq invariants. This would lead to explosions elsewhere.

commit 4fecf7d54eaa370465b6a7343ae88682adfa5edc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 15 11:11:34 2009 +0000

    Turns out that it's actually important to stop erlang from time to time...

commit 33f9c618daa53f6d5e6966c2d0d9b0764adf1712
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 15 10:57:11 2009 +0000

    Do not kill rabbit after 1 second when being asked to stop. Also, the default timeout on startup should be the max value allowed, not 30 seconds. Sheesh.

commit b44cdb699d8b89b978f21d76c01b64411877b3db
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 22:55:00 2009 +0000

    Split up and tweak startup order.

commit babf9d28807d3b5aad8e9f2ad609f5e6e5c9d64f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 22:27:17 2009 +0000

    Switch to explicit MFA, and symbolic boot step names.
    Add comments to sort_boot_steps.
    Reject duplicate boot step names.

commit 69f5859a2e2b6631cd21896d267543e9627ea101
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 21:45:31 2009 +0000

    Move planning code out of activator and into rabbit proper.

commit 64f12679fac670630cd616d58773e58970b58791
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 20:47:52 2009 +0000

    New process to own the tables. API for accessing the tables.

commit 0b511d1b3f4872c0bc96fa06d73e163ab1cb41ec
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 18:31:30 2009 +0000

    Enforce acyclicity; check presence and export of steps.

commit f45367349216f956b2110aa396c6e84f08784dfd
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 17:38:01 2009 +0000

    Fixup specs.

commit dd3ee26525947b1efbd57f8d34184a75ad602404
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 17:32:28 2009 +0000

    Add "-rabbit_boot_step" module attribute to specify startup sequence.
    
     - The plugin activator prepares the startup plan.
    
     - This means that it's no longer going to work to run without a boot
       script. Consequently, I've added a call to
       rabbitmq-activate-plugins to the Makefile for the 'all' target.
    
     - I've refactored the old boot sequence to use the new method for
       specifying boot steps. I've conservatively put dependencies forcing
       them into a straight line, as they were before.
    
     - Since the plugin activator runs so frequently, I've made it
       suppress the (spurious) warnings we get about core beam files being
       out of date on Ubuntu.

commit ef3ee6a2f755959d99aa8afc46470e4b477daa4e
Merge: 7a26ea1c8 c7eb7731d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 15:20:30 2009 +0000

    Merge default into bug22039

commit c7eb7731d3b2b73ffeb9ff733283fab5dc099236
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 15:19:57 2009 +0000

    Delete trailing whitespace

commit 7a26ea1c88634de1116e122afa549384cb88fa00
Merge: dab836094 dbcd94fe4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 14 13:51:55 2009 +0000

    Merge default into bug22039

commit 0a9c2d9b0a17289cf8556614a6c4642f8bc3045f
Merge: ff7ddc2ea dbcd94fe4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 23:39:23 2009 +0000

    merging in from default

commit ff7ddc2ea6167a0cfa532af32c18c0090390d9a8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 16:55:19 2009 +0000

    load_segments deliberately does not adjust the pubs and acks count in the segments because doing so would clobber over values carefully constructed to contain both information from the journal and from segment, which is used to detect when flushing to a segment is unnecessary because the file is "full" and so can be deleted (i.e. pubs == acks which is sum both of in segfile and journal). On startup, we were failing to set the pubs/acks counts correctly, leading to queues doing recovery correctly but then returning a length of 0.

commit 1612a81eaefa08bbc00a8bc786b25e02fbda894d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 16:32:22 2009 +0000

    Read 2 bytes instead of one at the start of load_segment_entries. This makes the code cleaner and avoids a further read in the case of a del or ack

commit dbcd94fe46c541751680556269187daff58065ba
Merge: 3502199f5 0ba27035d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 13:17:18 2009 +0000

    merging bug 22117 into default

commit 3502199f58c8b8a0caab8d24f32b4b9edc5838b6
Merge: 0956e2487 3eac759ba
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 13:04:31 2009 +0000

    merging bug 21963 into default

commit 0956e24876c6a37e2e703e3df2a9b8ed6f167160
Merge: be0a85368 ab1c96631
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 12:40:03 2009 +0000

    merging bug 21948 into default

commit be0a8536892206d5f5cc13fe0f1efe45af05c725
Merge: bdc9366e6 895123456
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 11 12:23:41 2009 +0000

    merging bug 22125 into default

commit ab1c966311275990f57cafbcfa60a8f8dbab28d7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 22:39:57 2009 +0000

    add client_properties info item to 'rabbitmqctl list_connections'
    showing the amqp table transmitted by the client as part of the
    connection.start_ok method.

commit 89512345610e67940a151c286b26ae4d64961a48
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 21:41:09 2009 +0000

    don't escape space (ascii 32) in rabbitmqctl output
    It was never meant to get escaped in the first place, according to the docs.

commit 3eac759ba3e4cc745de6fa6a2bc83b0ad572f32f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 19:30:17 2009 +0000

    display pids instead of nodes
    The challenge here was to find a way to display pids portably,
    s.t. the same pid is displayed in the same way everywhere, every time.
    
    We exploit Erlang's well-defined and stable external term format to
    take apart pids.

commit bdc9366e621cd466b3ffe6e7154ceb0cfe4e8500
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 19:19:57 2009 +0000

    replace deprecated guard

commit 0ba27035dc6a192f4193a0b085105067ec88231f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 17:21:08 2009 +0000

    don't wait forever for ssl negotiation to succeed

commit 67ddef33b687064ffba23712fd2b568d3c80019b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 10 17:16:03 2009 +0000

    move ssl negotiation into reader process
    thus freeing up the acceptor to handle new connections

commit 4cf8e5c45547d31e2f86b3a00642a9125b99f326
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 9 18:06:31 2009 +0000

    No longer rely on magic module naming; use an explicit registry

commit 815bb128ea65d5c7bf6b33e797378d23b18691ac
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Dec 6 13:51:11 2009 +0000

    cosmetic

commit ff7f229037c78ae167403ddf3d42cf31acd26bfa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 4 22:12:30 2009 +0000

    cosmetic and some refactoring

commit 3be853a684363e0deacbd41fead1dc34ddafc292
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 4 13:16:36 2009 +0000

    appropriately renamed

commit c5cc3a617d8affed4586bb9bb27ca2845ae0a27b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 4 13:10:21 2009 +0000

    cough, splutter, sneeze etc

commit bf4f2458f688d259179bae41a1e0fcac95553e39
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 4 13:02:00 2009 +0000

    segments now stored in array, not dict

commit 8a435be43cc41ddc626eb04faa399f3e96227fbf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 4 12:38:51 2009 +0000

    cosmetic

commit 41805b590d507f3c9a443d48b3661364e052e9ae
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 4 12:10:10 2009 +0000

    refactoring

commit b51ba757d4e71fb86259c69f3693747d1d122e38
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Dec 4 00:06:44 2009 +0000

    combined steps 3 and 4 of init, and made segment_find have the same type as dict:find. Dropped the Dir from the Segments, and added find_segment_or_new/3

commit 2b3c37e243009a5261a7710b5ca21e906bb48fc7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 3 17:55:38 2009 +0000

    cosmetic

commit d5522a16fe8528f494a38ab2c6350e731fddab3a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 17:55:34 2009 +0000

    With R13B03, it would appear we need to be slightly more hesitant: currently I'm seeing the memory limits being hit and the queue duration is still fairly large. Whilst it does eventually fall, setting this scalar a little lower should help. However, this will probably need tweaking again, once we've moved away from ets in the msg_store

commit d1fd1f4acd9f852b2a1779a4008809f3bd32d292
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 17:52:34 2009 +0000

    What a difference, two characters make...

commit eae92cf1d4165cd1652691d442fbc0a4c7fdc130
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 17:00:20 2009 +0000

    Make the arrays fixed size and tell them the max size. The don't actually take this much space initally, but it makes them a bit faster as they can make more sensible balancing decisions, we think.

commit a8a36d800b223995175f0d7a4d41debf354528f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 16:39:12 2009 +0000

    Switched to using array instead of dict for the inner journal. It's about 10% faster.

commit 9f617991fe0a150264795803388b76ec5493b143
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 15:59:00 2009 +0000

    If I write it this way then it saves code and is maybe slightly faster. maybe.

commit 77f9e0f3ad3583962a42c9617764ed26a7227d60
Merge: f26991818 db1a21035
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 15:41:42 2009 +0000

    merge heads

commit f26991818879ac44c62c856d9f01e7d1ff3f07b7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 15:41:16 2009 +0000

    Abstracted the segment caching in the qi, and associated improvements as not all the state needs to be passed around all the time.

commit db1a21035bbdd9d417ecd2ac3c50bf1a709eee3a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 3 13:38:48 2009 +0000

    cosmetic

commit 32f53ad4535a5a1055236bcd64c89afde4da996f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 13:10:59 2009 +0000

    Some renaming in the fhc and associated changes in qi and ms.

commit 6b2bd295b04f74fcff1564f06f2e0777ad613458
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Dec 3 12:00:06 2009 +0000

    source code file compression

commit 7053edfd7fdb60061dbd811f5593d9f54c411320
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 2 23:35:26 2009 +0000

    cosmetic

commit 19bb74623da7a270ba6bfbc6e8f4a0bbb4f363fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 22:29:05 2009 +0000

    Up to 11kHz persistent on my home machine. Still a little way off the 13kHz that I was getting before, but there were bugs in the previous QI (eg missing syncs) which could well have led to the old version being too fast. Added two functions to fhc: delete/1 which deletes without flushing any data at all. It will refuse to delete if the file isn't open; discard_write_buffer/1 which does what it says. We use the latter after scattering the journal as after we hit each segment, we sync the segment, so at that point there's no need at all to force out the data in the fhc for the journal prior to truncation.

commit 13ff649097a4c3f0baa9549e0a32d37d1e326264
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 18:34:17 2009 +0000

    Allowed the journal to grow substantially bigger. This helps performance substantially.

commit 25225ff599df43c6c496bb1f38732412257cf0a5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 18:04:53 2009 +0000

    New qi in place, tested and debugged. It works. It's not quite as fast as before because of use of nested dicts. This can be solved by using sets for publishes, deliveries and acks within each segment - we don't actually need what the dict provides and sets will go much faster. That change should be fairly straight forward to do - the code will get a little longer, but not much more complex.

commit 11fe6b478e764d5001c8c528bca80f455202c03b
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Dec 2 17:42:46 2009 +0000

    Bug 21838: check equivalence on exchange.declare

commit 1ce1bdb2011928da4d8d12881ca51e624445ea97
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 15:38:43 2009 +0000

    Finished. It might work - untested though

commit acc6bbb9f6b29f194ddd0e60087489147ea5234d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 14:56:32 2009 +0000

    More good progress on qi3. The code still almost looks pretty in places. Its prettiness is not diminishing.

commit de9f98808343b0ec249c95a672112a32e0b5df7d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Dec 2 13:04:56 2009 +0000

    Bug 21838: Don't check the type in a exchange.declare{passive=true},
    as per the field doc in the spec.

commit 6f18886520e8e7356c1efd84a2e1cc6aa66624f6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Dec 2 13:04:46 2009 +0000

    Lots of good progress on qi3. The code almost looks pretty in places

commit 26f823825509269e9c31de3c17969f33f5bedc23
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Dec 2 08:01:03 2009 +0000

    Ignore any old records

commit a01627c9acc9d7053a7112f66d49e2588d4205ae
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Dec 2 06:55:17 2009 +0000

    Cope more gracefully with failed callbacks.

commit d1ed3feb06fbf9bf117c5978f158b8e181c68cdd
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Dec 2 06:47:57 2009 +0000

    Add declare/1 callback.

commit 8643064c82a17e36c38fb09098868c76ffc86add
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Dec 2 06:09:11 2009 +0000

    Use mnesia table events instead of in-transaction callbacks.

commit f8b9b92c6a33c7da267fe3b734194274c78458ea
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Dec 1 23:47:10 2009 +0000

    Wrote two key combinators which will be used by the new queue index shortly. qi3 is very temporary

commit e0db1ab53353c5f08a958c58db1a4e62b0ba58ae
Merge: eab18481f 3bc4d27f0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 1 16:14:01 2009 +0000

    Merge default into amqp_0_9_1

commit dab83609432d34fec0c1811c4828bbf0859929d4
Merge: 3444f1555 3bc4d27f0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 1 13:38:15 2009 +0000

    Merge default into bug22039

commit 12ab14af50838111c4b50c019cd89be65b8e3834
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 1 12:56:54 2009 +0000

    allow nodes to be started with no listeners

commit 614ccfc42c21a29bf04b760d9a838f323e871f65
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 1 11:20:31 2009 +0000

    two bug fixes and some refactoring
    - the IP address in the config is meant to be a string, not an atom
    - special case node name of first node

commit 3bc4d27f0b3df7c98e16a7a2b121dbc22461dd20
Merge: 89f3e8fea 9d3831393
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 1 09:09:31 2009 +0000

    merge bug22063 into default

commit 3444f15551855685017371b47bdcf0acd3613844
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Nov 30 22:50:05 2009 +0000

    Avoid compiler warning about unused term; weirdly, the replaced idiom works elsewhere

commit 9d38313939c07298fe153fafa0cde026ef0d5df5
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Nov 30 22:45:28 2009 +0000

    removing is_amqp_hard_error in rabbit_framing and adding amqp_exception function to lookup amqp error codes and turn them into atoms

commit a74501435a007b980b4d61bae62c732f60b0f89d
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Nov 30 22:31:40 2009 +0000

    Change tactic to examine modules in .app files for rabbit_static_hook_* modules

commit beb6c32b0b195d18420f1dba7a17f0687cc9ffe6
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Nov 30 21:55:52 2009 +0000

    Initial stab at the problem

commit 89f3e8fead76e8692b8c3f641c962ea9e3c36ec7
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Nov 30 20:25:56 2009 +0000

    Try harder to find a simplejson-supporting python

commit 7cae3cf57979f5b8643e03c285a5a0c4f1d585cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 30 18:29:35 2009 +0000

    Only pull in one segment at a time from γ into q3

commit 5214d9b04817e87a7cfbb2ae1a1b44276a4789a9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 30 17:49:34 2009 +0000

    Remove the garbage_collect call as this doesn't seem to be necessary in R13B03

commit 4d73f607eb390f4a231002dc1327b0d3da58194a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 30 16:57:44 2009 +0000

    Garbage collect on memory reduction; remove delayed_write in queue index as we're handling buffering ourselves; add a hack to get the raw vq status out of rabbitmqctl

commit 8a33d0617d912504364421f217aff8c93b17fec5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 27 17:56:01 2009 +0000

    Removal of unnecessary clause in handle_info for queue process as prefetcher has gone. Bump rabbit supervisor to allow all processes to take as long as necessary to exit. This should ensure cached data gets flushed out.

commit 4e03a59592424036d3880bf80c5eeaf54c8162f3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 27 14:45:30 2009 +0000

    Removed mnesia table and dq_msg_loc record that's no longer needed

commit 86f859cb22f7181826779903120178883bbdf85e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 27 13:44:47 2009 +0000

    There was a bug. Now it has gone away. It arose when γ has a partial segment, and then memory is made available, and the next msg is persistent. It will go into the partial segment in qi, but will also be in q1 in vq. This lead to the msg being duplicated. Solution is to track the max seq id beyond the end of the γs, and thus drop anything being returned in the segment from qi with a seq_id above this max seq id.

commit 0d4dafc9d4f28eccc03bbdb4927697510fd294b4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 27 09:24:22 2009 +0000

    storage_mode is long gone

commit 2f7b21dbe5bf9795090299877d35baa194a13114
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 27 09:05:01 2009 +0000

    unintended variable capture

commit e51630ac77625d6078739f59cc04f4492acbc992
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 26 21:51:35 2009 +0000

    s/full_flush_journal/flush_journal and some refactoring

commit e31a0bac30163971375c798223497a92a5d4ce4f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 26 21:28:00 2009 +0000

    better const names

commit e7fa0917c55237a97d5d98dbb2e7d47fbc3d310e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 26 21:06:14 2009 +0000

    cosmetic

commit cf893fe294da6f173aea8f8e9f5c0f46446b2ad0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 26 18:20:36 2009 +0000

    cosmetic and inlining

commit e5b4ebbbcc858a3b4ffbf1052d328a7344b4a9b6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 26 18:20:13 2009 +0000

    use ?SERVER wherever possible

commit 8aab49213274d25c00cf870f65aba95474f820e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 17:48:21 2009 +0000

    Don't demonitor if we received a DOWN msg.

commit 3c22c6fda7163eb37eb0a595387d7827fc6b45c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 17:21:50 2009 +0000

    remove unnecessary comment

commit d1a508effe82628fc0e088afbeb8783b56bd5f4e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 17:19:42 2009 +0000

    Added demonitoring, corrected counting on deregistering, and got fed up with the lack of whitespace

commit 961f6078f099e462980001ac1b88ea17ae42ef29
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 17:10:27 2009 +0000

    Don't need this variable anymore

commit 1915489d9762806b0c84a9b43651436895eba2be
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 16:28:46 2009 +0000

    Remove the small_duration_threshold, and instead smooth the ram_msg_count over the last two periods. This seems to work reasonably well.

commit a978d0ef8b14df543f3beb05405f8c83c140574b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 15:29:56 2009 +0000

    SMALL_INFINITY_OSCILLATION_DURATION => SMALL_DURATION_THRESHOLD

commit b38451168cacb2e93e96a72dbc5d4ad6ab1668ad
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 15:06:01 2009 +0000

    s/b(.)t/s\1m/

commit 4578759320d14668519bdb4d89439f48041074e3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 15:04:36 2009 +0000

    Improved documentation and code regarding fast moving mainly empty queues and the SMALL_INFINITY_OSCILLATION_DURATION definition. Oh, and clamped zero.

commit 0ca125b08addaa6a775b430ca4e18829e9385737
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 13:20:59 2009 +0000

    beautifuler

commit b1d4166c64d05e898a0091a8258fc5b878f9a0cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 13:16:36 2009 +0000

    Improvements to documentation, further improvements to conditional and refactorings. Removal of max queue duration because the rate calculated by the queue doesn't decay in the way necessary to make the max queue duration necessary

commit 6c09bbdbb1713851955d9bb804f1f5c145387538
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 12:40:48 2009 +0000

    Further correction to conditional; line lengths; extract all magic numbers and -define them and document them.

commit 6e122e3710f2fc76f4524d94e9dcb364dc69b018
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 11:52:32 2009 +0000

    Lots of improvements: o) merge the dict and ets; use a record there; o) drop record memory_ratio; o) corrected where we clamp to non-neg numbers; o) correct conditional in internal update

commit f4ff01381ee9813040cc99e8226241c7d77c6ab3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 26 11:16:08 2009 +0000

    Added deregister and stop to MM

commit 90d747e73fa9aa33f77f5d5cdc01ad27f0fe2ea9
Merge: 6a2901709 b8892e984
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 21:53:15 2009 +0000

    merge default into bug21673

commit b8892e9842e6e46bdc6ad2734e4ea364b6cbafbf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 21:51:31 2009 +0000

    cosmetic

commit f7d8d4323243de29d9b3fad55c9a17acffa02316
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 18:14:26 2009 +0000

    multi is a convenience. It should blow up when starting > 1 nodes when we have multiple tcp listeners. When starting > 1 nodes, make sure we export the discovered node ip address and port. When starting just 1 node, don't export anything - either rabbit-server will rediscover it in the env, or it's all configured in the config file.

commit 6a2901709a33998d27ad2add7e3e838a105d4212
Merge: a6dfa4a57 c855102f7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 17:09:39 2009 +0000

    merge default into bug21673

commit c855102f709b1f0956e465e3241cc6e14a26df54
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 17:02:54 2009 +0000

    put things in (the right) order

commit 4b406e7931a8f5b525576be7067b4c7f42482cb2
Merge: 1022dc07a 71e1abd66
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 16:53:03 2009 +0000

    merge bug22042 into default

commit a6dfa4a57a8022ee90614c9826d878ad32155728
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 16:34:08 2009 +0000

    (kinda bug 22042) inline rabbit_misc:cmd seeing as it's not used elsewhere and we want to allow vm_memory_monitor to be used outside of rabbit

commit 71e1abd6657bc136f1ad42a449c86e7fafe0e5f3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 16:28:15 2009 +0000

    don't use rabbit_log; use gen_server, not 2; correct long lines

commit 973c73544ade75764f7cf0626cb58fb86ab93269
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 16:22:43 2009 +0000

    remove trailing spaces

commit 7b8b7d2734c7c8759395c118c4896c1ec7ad394d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 15:56:04 2009 +0000

    typeos to novel

commit a2f11253715327c335c4fbd08e00edface018a97
Merge: 35bb4495f 46b42c723
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 15:46:36 2009 +0000

    merging heads

commit 35bb4495f0d1a58477c2b646b8ee72b515e57c01
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 15:46:26 2009 +0000

    A novel

commit 46b42c7237057f06feaebc61b35703cb3da450d2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 15:11:45 2009 +0000

    cosmetic

commit 09b71fc6cce4e613ebf028c5e0a56f7f4def2496
Merge: 69caa8ecf 14221bca2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 14:49:13 2009 +0000

    merging heads

commit 69caa8ecfbae5710684ad32a1c1093e3e99791fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 14:47:40 2009 +0000

    Stop using _misc:cmd and use os:cmd instead

commit 14221bca29e50b494b658d7e49c171c482df4aa4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 14:36:29 2009 +0000

    use plain, old gen_server instead of gen_server2 - for better compatibility

commit 1af739636733cb31e690017398ce2cdad5ab4f6e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 14:25:29 2009 +0000

    cosmetic

commit 9a90caea595220767033c14a68e5de5c834d70b4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 13:52:38 2009 +0000

    Make sure that trusted_offset in open1 is set to an absolute offset

commit 9fa61279a0b00ee622c336b0c6c12fa2f983bf21
Merge: b8b9490d8 d22715389
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 13:35:30 2009 +0000

    merging heads

commit d22715389937e165ac3ffbb7255ef560c5ee61b0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 13:28:31 2009 +0000

    Utterly baffled. I thought this was the obvious refactoring I was doing earlier, but apparently not. Anyway, this works.

commit b8b9490d8cd02180689dfc539dc3475f47046744
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 13:26:18 2009 +0000

    cosmetic

commit 8069d8cff9613aee28c319b631e106534d07b8d7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 25 13:18:18 2009 +0000

    inlining

commit 373e95a80cf90c3bb7993ea3e8c53e78171cfcc5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 13:07:29 2009 +0000

    Corrected spec for open and inlined the internal versions. Also used the with_flushed_handles for truncate and position. It breaks sync if you do *both* the flushed form and then the obvious refactoring within it (i.e. pull the Handle1 up) and I can't quite see why

commit 47c5772a5a4e8dc15ac4f392c3c7877c8470025f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 11:33:56 2009 +0000

    removed calls to rabbit_log, using error_logger instead. Still one call to rabbit_misc:cmd. Not sure quite what to do about that...

commit 2d776a2bc7914ee5de21300f5a83ca474a91a7e6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 11:30:40 2009 +0000

    corrected order of cast tuple; improved set_maximum_since_use; corrected bug that led to a /0, due to exhausting fhs just through calls to inc and dec (from sockets - only happens when the limit is very very low)

commit 0d05597f6068b31c29ea7df752892d13d5f2927f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 25 11:16:48 2009 +0000

    Remove the double indirection of fhc_file and fhc_path; make open non-recursive

commit fa446fd4fc67e8e6ccc96d6fcb0bdb05deec55fc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 23:55:55 2009 +0000

    minor refactoring

commit cd2918c5851f8cba7f69ec3df17f805d3ddfc0b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 23:55:18 2009 +0000

    cosmetic

commit a5b946dabf41a6f4de76ca2cb71d0b9b281be189
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 20:06:48 2009 +0000

    more cosmetic

commit 82311d1c3e741d0edc5f8801e2c3a28ac171e3cd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 19:39:29 2009 +0000

    more cosmetic

commit 5c433b51d4a70d268d2f42c61cda8b359763c5c3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 18:24:11 2009 +0000

    more cosmetic

commit b930ba473c7799c631be5df0d7fe9b597ebfbd7a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 24 17:49:37 2009 +0000

    Reintroduced traces of tcp_listeners where it turns out to be a jolly good idea, but don't set either one unless the other has been set. Thus if neither has been set then we don't do nowt.

commit 823ec255d39a636a05af0ecd6085f39b48c73e4a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 17:19:13 2009 +0000

    cosmetic

commit d2a6da1d866701a886b9014b1e40836f698d4e72
Merge: f75f2fba3 1022dc07a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 24 17:11:10 2009 +0000

    merge default into bug21673

commit 81bd9ff305087b7238ede7803504fa9049e4559e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 24 17:06:37 2009 +0000

    Removed all traces of tcp_listeners from the scripts

commit eab18481fa7c4790fa435af97a9c487204820ebf
Merge: 210421063 1022dc07a
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 24 11:24:43 2009 +0000

    Merge default in.  This includes bug22020.  There were some
    non-obvious conflict resolutions:
     - getting rid of the q/x durability agreement check
     - in getting rid of the exchange may_auto_deleting, making sure all
     branches returned 'ok' (the tests all start failing!).

commit 1022dc07a5ef997eb40efe8d0ec00cf2621b244f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 16:16:44 2009 +0000

    Spec for rabbit_misc:sort_field_table/1

commit f75f2fba3f8298b132719d0cd203977b79fe89a4
Merge: da020f623 a8baa57ce
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 23 16:16:12 2009 +0000

    merging in from default

commit a8baa57ce91fbdf7b95fdc4c4618c0961314299e
Merge: 0b1c5175a 89469471c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 23 16:05:53 2009 +0000

    merging bug 22020 into default

commit 89469471ce747ef4228a45f19ba1ef1a65a9b8a9
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 16:00:33 2009 +0000

    Oops -- it's supposed to be a .hrl, not a .erl

commit 2001b9ed42c1b9073802c619e5127f819a87bc36
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 15:39:50 2009 +0000

    Speculative specs, pending R13B to try them out

commit ee62ea1068aeddb4d5728e880a90578e1aebe8b4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 14:59:43 2009 +0000

    Rename sort_arguments to sort_field_table

commit 08a3a0dc08c22132482ebc4350b53444f711115e
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 14:53:22 2009 +0000

    Comment lists:keysort in delete_queue_bindings

commit 75021f92951a14ccdc9e36e7b7ad1e026872ddc1
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 23 14:48:38 2009 +0000

    Catch list_to_existing_atom error, throw command_invalid

commit 941e298345a2f768815790b5df029147b7511749
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sun Nov 22 13:04:31 2009 +0000

    License headers on new files.

commit 4b631aed1505904787034f7ca5f2593f08677f5e
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Nov 21 23:23:35 2009 +0000

    Change to publish (= route-and-deliver) model for exchanges.
    This lets exchanges do arbitrary delivery inspection for routing,
    arbitrary content rewriting or discarding, and arbitrary content
    and delivery synthesis.

commit 63312b23cb762295d36063f299d05899fd749caa
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Nov 21 21:24:15 2009 +0000

    Make exchanges modular behaviours. Added
    rabbit_exchange_behaviour. Split fanout, direct, topic and headers
    into new modules that implement the new behaviour. Added convention
    that for exchange type X, a module named rabbit_exchange_type_X must
    exist.

commit 210421063e374da609a5e00c21d555439cf17b8d
Merge: 9d8f56e2a 0b1c5175a
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Nov 21 16:19:34 2009 +0000

    Merge default into amqp_0_9_1

commit 0b1c5175af70c6651ef7b031b37c615f7cd181b3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 20 15:48:25 2009 +0000

    Oversupply of E

commit da020f623e371d45a0116c8711a2f5002b488f8c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 19 18:11:12 2009 +0000

    Did Matthias's requested transformation of the fhc. Saved 50 lines. It's not quite as neat as I wanted due to passing extra args through (the difficulty is in writing the with_flushed_handles - you can't write the fun in there to have any arity), so it's always a 2-arity function :: ([any()], [handle()]), but hey, it's still quite a lot nicer than it was.

commit 847ca84878fe7c61a04601f6119220134c959b71
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 19 16:43:17 2009 +0000

    Finished the file handle cache. It works as follows:
    1) Every client keeps a gb_tree of timestamp-when-fd-was-last-used => fd_ref. This is updated for each action.
    2) When a client opens a file or closes a file, it sends a suitable msg to the server, including the smallest timestamp-when-fd-was-last-used (i.e. least recently used fd)
    3) The server counts how many fds have been used
    4) When too many fds have been used, it finds the average age of the least-recently-used-fds and tells all clients to close anything older than that
    5) This is likely to have no effect, because the clients may have since used the fds, thus the ages will be wrong. Regardless of whether any fds have been closed at this point, all the clients send back to the server their current smallest timestamp-when-fd-was-last-used
    6) 2 seconds later, the server checks to see if the situation has improved, and if not, using the now updated information (thus the average age will be lower) may choose to further ask all clients to kill off fhs. This will repeat, albeit not that fast until enough fds have been closed.

commit b0f200b3d34872eac03121cde58073e1aeec63c8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 18:15:03 2009 +0000

    started on the server part of fhc

commit 33f89e3651f345cf0f2fb5bb20e907d2a487f242
Merge: c90d308c1 bb9a90ddf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 16:19:18 2009 +0000

    merge in from default

commit bb9a90ddf33cf6bdcc2809cf3736a248d24f95a5
Merge: 4159a9a3a fbbcb18fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 16:16:19 2009 +0000

    merged default heads

commit c90d308c1b25d0f2d8b4e3df87c84ed3d1a15571
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 16:11:03 2009 +0000

    correction of documentation in absence of prefetcher

commit fd0810b35e361bee323386c60d1b69d4533c702e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 16:01:21 2009 +0000

    Lots of tidying. Also, don't allow rates to decay infinitely. Instead avg over the last two periods, and assume zero rates when we hibernate.

commit b774496c02308acc61aa65d50769c60f5caca805
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 14:20:19 2009 +0000

    Documentation improvements

commit 855ad0129e0320ef2a09b7d13f9af798368da753
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 14:10:02 2009 +0000

    Minor bugfix

commit 47d2804ac573ac2c169988116508a42aa9f9708f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 00:14:51 2009 +0000

    and now remove the accidental commit of the server script. it's late...

commit 00746e3a10a97541db6a022690bd83340c5ac3d9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 18 00:14:09 2009 +0000

    yeah, duration shouldn't be truncated. reverted

commit 9d8f56e2a79242a057f0a1e4a03eb3453bf956a2
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 17 18:31:43 2009 +0000

    Bug 21986: Use gen_server2:call instead of gen_server2:cast to make
    this synchronous.  This means recover_async is now also synchronous,
    but it's deprecated, and anyway we do the same thing with no_wait
    elsewhere.  This way we have just the one code path.

commit 5d165153c209a7d6f52a5db67e0082a5110ca4d3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 18:19:19 2009 +0000

    truncate desired duration as I've now seen rounding issues cause behavioural problems

commit e00350fa28b02f253f0a04a3524ae5c53d83978b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 17:59:11 2009 +0000

    some cosmetics to MM. Also, there's a problem where if all queues have been pushed out to disk (duration == 0), and then more memory becomes available (eg queue death), then no queues will be brought back in. Therefore, if >= 5% of our memory is available, ensure that the sum is at least 1. This allows queues to come back in.

commit 6e59f6bb13d5d457ffdf095bc73808c76164fe51
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 17 16:56:20 2009 +0000

    Bug 21986: Implement synchronous basic.recover

commit 219ac1df31cff229bcf94ad1e89ac54e727ff656
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 16:47:37 2009 +0000

    Tidying of msg_store as per QA discussion with Matthias

commit 78756f0f0e667a7045a4c88f1b4db0af3fc4311a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 16:18:12 2009 +0000

    Well tracking down that transposed error took about an hour... sigh.

commit 46ec89c47e6847b1aa5876c284b866904decc8e5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 15:57:50 2009 +0000

    1. A bugfix in MM, in internal_update. 2. In MM only enforce limits if we're using more than half the available RAM. 3. In VQ, sum the ingress and egress rates - this makes things much smoother when queues go from being flooded to being consumed, and vice versa.

commit be0f4ad53d7a365686eef57e9f7edb157d9c98f4
Merge: 1950114f1 4159a9a3a
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 17 15:52:13 2009 +0000

    Merge from default, to get recent work as well as support for field-array.

commit 7acd4c2d736820df513b8a50c584e338d80244ac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 14:20:57 2009 +0000

    If a queue reports 0 duration, then the MM may well calculate that the desired avg duration should be 0. The queue will then be told this on its next report. This is potentially disasterous because for a fast moving queue, setting the duration to 0 will force allmsgs via the disk, which will destroy performance. However, it is not sufficient to just tell all queues reporting 0, infinity, because doing so would result in queues which have been pushed out to disk, suddenly coming all the way back in. Thus if a queue reports a duration of < 1, and the last value we told it was infinity, then we tell it infinity again. Thus fast moving queues are not restricted, and queues which have been told real numbers, and slowly squeezed out to disk stay squeezed out.

commit 81924a0fd9a04d42e76bfceb78b860bacbe3778b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 13:10:52 2009 +0000

    In the absense of an egress rate, use ingress rate instead. Also, if there's been no fetches/publishes since the last measurement, use the previous measurement, appropriately scaled. This means that the rates will gently fall off and approach zero in the absence of activity, which is preferable to them suddenly jumping to zero. Also, the average is now the sum of the fetches/publishes in the last two segments, over the time since the start of the last segment (i.e. it's better than before, which was just a straight /2, which would be wrong if the segments are different sizes, which they could be, given a very busy queue).

commit 79919ede08cc81cc7f1ea4bf9b0b4b4314069532
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 17 11:11:23 2009 +0000

    Remove most of the vq tests which are now invalid given the prefetcher has gone.

commit 148dc35396c672c12513b5a8269684ce6df06408
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 16 17:40:15 2009 +0000

    stripped out the prefetcher. Note that I've not fixed up the tests yet, so they won't pass

commit 4159a9a3afdc3fad8f5331c00321733ce398b7af
Merge: 8a3d0b4a9 6f274fcde
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 16 17:25:01 2009 +0000

    Merge bug21929 into default

commit 8a3d0b4a9cbb1673445f2431c6366997b13ec75e
Merge: 0e5c73726 7ae9d36e3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Nov 16 15:04:20 2009 +0000

    merge bug21975 into default

commit 5a7d9cee4faa420bd1cbdb7677a9d1fc8c528ddc
Merge: da724e2da fbbcb18fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 16 13:27:02 2009 +0000

    merging in from default

commit fbbcb18fd5cdd925b8f8c92b31f07d381d4bf056
Merge: 5219ddbda 92a780eb6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 16 13:19:00 2009 +0000

    merging bug 21903 into default

commit 5219ddbda778d0351d133c482f7a054f28043008
Merge: 0e5c73726 bd87e87ea
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 16 13:03:48 2009 +0000

    merging bug 21947 into default

commit 7ae9d36e313e6b71b4a24bca67a47bbebd6ed288
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 16 11:57:41 2009 +0000

    all done

commit bd87e87eae26defa8421208c1ae69c0b4ef9dd6a
Author: David Wragg <dpw@lshift.net>
Date:   Mon Nov 16 00:33:51 2009 +0000

    Remove traces of plugins in the debian postrm

commit 1950114f16206399ea00bf6434298767ed3a9f2f
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Nov 12 18:59:20 2009 +0000

    Enforce frame-max negotiation

commit e7141e943094bc7b984b9996671951400e46055a
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Nov 12 16:56:47 2009 +0000

    Bug 21836: Test that the content framing code doesn't produce frames that break frame-max

commit da724e2dae03806d1be72a4a9df1c9d5dbc2a207
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 12 13:24:25 2009 +0000

    reverting a change to the start up script that I never meant to commit. Also further simplifying logic in the previously faulty function.

commit cd1d1235861e39c6d0ce2046cf1f33bd85868ebc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 12 13:02:10 2009 +0000

    It makes sense only to fully flush the journal prior to hibernation. Other than that, the qi can take care of when to flush the journal out. Adjustments to tests

commit 170dcdf440b21b90a0250c9f35e15b5f998a98a8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 12 12:07:59 2009 +0000

    Err, as I said in the last commit, make sure the desired queue length isn't < 0.

commit 72f90d15deb6e60f34ff6771fa7f3c70398f0a5d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 12 11:57:55 2009 +0000

    Firstly the desired queue length shouldn't go negative. Secondly, testing shows that the amqqueue_process should not flush the qi journal when idle. Doing so can lead to disk thrashing.

commit 0654c41ab845f43e4dfdcac4da274451d5829def
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 12 11:50:09 2009 +0000

    Found the bug. What was happening was:
    1) γ contains a range, say a to b, where a is a segment boundary but b-a < segmentsize
    2) γ -> β happens, so all of γ gets loaded into q3 as betas. γ is empty
    3) then push β to γ happens. There was a logic failure in there, which meant that with γ empty, _all_ of q3 would be pushed to γ, but incorrectly accounted for, making the vq think there is less in γ than there really is
    4) now γ -> β happens again, vq is amazed to find more in the segment in γ than it was expecting. cue explosion
    The bug was simply not ensuring that if γ was empty, only push out enough to leave q3 with a maximum of one segment, ending on a segment boundary

commit 0e5c73726cc696a5c30a4d8f7af887ab9b3d9121
Merge: e9b49a380 70af4f4ea
Author: David Wragg <dpw@lshift.net>
Date:   Wed Nov 11 23:38:43 2009 +0000

    Merge bug21928 into default

commit e9b49a380c45fca26dbe6a8ff58cf29cbc9e795b
Merge: db85d68e5 36433dd83
Author: David Wragg <dpw@lshift.net>
Date:   Wed Nov 11 23:38:17 2009 +0000

    Merge bug21913 into default

commit db85d68e5684b14be727c2078f51c2f1daf566be
Merge: 6df515d78 3a6fcfcda
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 11 22:23:20 2009 +0000

    merge bug21876 into next

commit 52d6b72b14a50577dc7bceb5c846ed525c294e03
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 17:56:38 2009 +0000

    Wired it all together. It does seem to work, but there seems to be an off by one bug somewhere in vq, wrt γ length counting. Which pops up sometimes... Joy.

commit 560c3ba48999ef174386ca91c2381f6af94f6f6e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 16:48:26 2009 +0000

    unused vars

commit fcaf98d936b4ec1889d90964f37e887edda7e14d
Merge: 33e51bc4e 979ccce8a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 16:47:37 2009 +0000

    merging in from bug 21742, ignoring all of its changes to amqqueue and amqqueue_process

commit 33e51bc4ed2198870c05e2506e11a85fc1279ce8
Merge: 2e5301bb5 6df515d78
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 16:39:18 2009 +0000

    merging in from default

commit 979ccce8aecdbe8ca99fe2d3f11ab9bf7ce68ef4
Merge: bdb2b8907 6df515d78
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 16:38:44 2009 +0000

    merging in from default

commit bdb2b89077d47d2b185c15b6a0819281a07786c9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 16:29:14 2009 +0000

    Various amounts of tidying, post testing and a large amount of cosmetics.

commit 6f274fcdec1653f6995b75d7803063c1ce7ac18d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 11 16:06:42 2009 +0000

    Support field-arrays in the parser.  This involves a similar factoring
    of field-value to the generator (since field-value is used both for
    field-table and field-array).
    Also fixed a dumb mistake in the array bit of rabbit_binary_generator.

commit e942644287d7e96a3f5d455b98bc6857fb747124
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 15:16:20 2009 +0000

    Unhappy with the idea that the desired duration is affected immediately by new queues and queues dying, but the memory ratio, which reflects the amount of memory erlang has used, is updated periodically. This mix of up-to-date and stale information in the calculation of the desired duration alarms me. Thus store the desired duration in the state, and always report that. That is then update periodically, thus is only ever calculated using current values.

commit 862159f445f21fc128c5e93e746859b3c961ea8c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Nov 11 15:02:08 2009 +0000

    Cosmetics

commit afcb6ae973b521f682d4e41ef64d59ca9abc41ad
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Nov 11 06:25:21 2009 -0500

    QA: quoted atoms in specs, timer:now_diff

commit 3d64a0c5ab481461a802acde36dc882319c29bce
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 10 18:03:42 2009 +0000

    Cosmetic

commit 5e8f08aa8dbc488579244b13a11666e93eb02405
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 10 18:01:05 2009 +0000

    Refactoring of encoding code, so that it uses the table encoding erm,
    code.  Test case which mostly exercises the table encoding code.

commit 36433dd8309f9cbc917a9f55cd0e6b44224dd3b6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 10 16:27:02 2009 +0000

    replaced echo -e with multiple echo calls

commit 70af4f4eab59a0f166a7be60a11cd40d23edce20
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 10 16:10:50 2009 +0000

    Fixes as suggested. Having tested, the asroot wrapper is used only with activate/deactivate, which don't take any arguments anyway, making testing argument passing a little challenging. However, minor editing of those scripts suggests that it does indeed seem to work.

commit 2e5301bb55a8cb7556ec519abc043f868b0b847d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 10 14:07:28 2009 +0000

    Fixed. There was a choice of having the qi do its own seqids, which would have been fine, but for the fact that at any point, there is the possibility of the vq deciding to flush everything out to disk. Thus to avoid rewriting in order to preserve order, instead we cope with the fact that there may be partial segments. The solution is to have a dict of segments which received fewer than the expected number of publishes before a different segment was written to. Then, when adding acks, we check to see if the number of acks is now equal to the partial number of segments, if it is, delete. Also, when moving to a different segment, we potentially delete the seg file if the number of acks is equal to the number of publishes. One key aspect of this is that the current segment to which we are publishing never appears in this dict, so it is not possible to delete the current publish segment by having the same number of pubs and acks, without it being really really full. Added and modified tests accordingly.

commit a6a6707c97e74e586bb6fb5ee1e0172350c64a38
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 10 11:15:39 2009 +0000

    Added test which slowly reduces the duration target of the queue as messages are pumped through at high rate. This has revealed major flaw in the queue index which goes as follows. In the queue index, we assume that all segments have the same number of entries. This is in fact not necessarily the case, because a segment may very well have a mixture of messages, some of which are on disk and some of which are not. There are a few solutions to this, and I've not decided yet which is right.

commit 9add76728a35e9d09b1c752e67d57698e0d82d2a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 9 18:12:00 2009 +0000

    Cosmetic reorganisation of vq. Added specs and made sure usage matches specs

commit e16ec9889f9c693484013167c65e8454157dbba7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 9 17:10:28 2009 +0000

    Wrote specific test of the case mentioned in previous commit, and fixed code accordingly. Also added some other tests. With the overal test suite, up to 92% code coverage of vq, and 70% on prefetcher. Also factored out common records between those two modules to rabbit_queue.hrl

commit 6df515d78eb54478b960c454c27745e41d2c5e50
Merge: c1e3115d1 015084646
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Nov 9 15:49:20 2009 +0000

    Merge bug21715

commit cf418d2441594dea34f5321f68f48481ee9f9e76
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Nov 9 09:57:28 2009 -0500

    Using vm_memory_manager.

commit 5fd1c1493c488631c56d180117c055c2f23ddb7c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 9 13:46:19 2009 +0000

    Made the tests work again. Also one tiny cosmetic in vq. However, uncovered major mistake in VQ which is that currently, when the prefetcher starts, that may empty q3. A subsequent publish may then go straight to Q4, thus overtaking the previous msgs. Even worse, when the prefetcher is drained, there is no attempt to join it into the existing q4, it just replaces it. What should happen is that the existence of the prefetcher is treated as if both q3 and q4 are non empty. This makes sense, because there are some ways in which the prefetcher can exit, returning entries for both q4 and q3. Thus pubs that happen after the prefetcher is started must go to q1/q2/γ, and so we know that entries already in q4 when the prefetcher is drained must have got there before the prefetcher was started. Finally, when the prefetcher is drained, if γ is empty, q2 and q3 can be joined, and if q2, γ and q3 are empty, q1 and q4 can be joined. Or something like that.

commit 015084646b421438f318668fb812183c86ae3cb6
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Nov 9 07:03:32 2009 -0500

    Build args are also dependant on platform

commit e3598c965896854b5f23d1fa42abbb78273fee15
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 9 09:08:42 2009 +0000

    modified vq such that when we're bringing entries back in from gamma to beta (q3), we bring all entries in, unless we know that our target_ram count is 0, in which case we only bring one segment in. This massively helps the prefetcher as it means the prefetcher is finally allowed to prefetch more than one segment. However, it has had a negative impact on the tests, which I'm still working through to correct.

commit 98e2b55d875301e5210dbb07dd16264183a2a037
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 6 18:20:24 2009 +0000

    Making progress with vq testing and debugging - up to 75% code coverage overall, and ironed out several bugs

commit 69ee2ea4922ac3d4d0aa04e6fb0c7989d3185d5a
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Nov 6 13:01:12 2009 -0500

    Forgot one checksum

commit e78774cd3fd58b05ee2c15b39d0d7689b69e8b67
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Nov 6 12:46:40 2009 -0500

    Let's support 1.7.0

commit 6ef7c1449078f740eaf2ab07198d35d35d68501b
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Nov 6 12:36:18 2009 -0500

    don't depend on simplejson for snow leopard

commit 4c8dcae91ec74a85783b0793d0bbc8af39134174
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Nov 6 14:18:51 2009 +0000

    man 2 write states:
     POSIX requires that a read(2) which can be proved to occur after a write() has returned returns the new data.
    
    This means that in the msg_store, when we're reading a msg, we only need to make sure that write has really been called on the msg. We do not need to sync here. So, add a test, explicitly to hit this condition.
    
    We were using both buffering in the fhc, and also delayed_write. This is dangerous, because we can think that we've written out from the fhc, but even though we're writing > the 64 kbyte default limit in delayed_write, we may not be writing a whole number of 64kb blocks, thus there may be something left in the delayed_write buffer, so remove that. Performance doesn't suffer because we're writing blocks of 1MB anyway!
    
    Also, the current_offset/1 fun in fhc was returning the virtual address - i.e. where we would be if we flushed out the write buffer. We actually need both variants - getting the real raw offset of the handle, and getting the virtual offset.
    
    Finally, as a result of all of this, the sync fun in msg_store now has no need to do any work unless there are outstanding transactions.

commit 66ce4890b83be5bb02799cfd447fe2279c30911f
Merge: 68d168857 c1e3115d1
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Nov 6 14:06:38 2009 +0000

    Merged default into bug21742.

commit c1e3115d1388121c3563f1ab9bd83f57e2e8395a
Merge: a820f3840 2cf30f366
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 5 15:19:05 2009 +0000

    Nuked a head

commit a820f3840de6838bc8089f1deb57507e6de5640a
Merge: 592cb287a fb186ebf3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 5 15:11:41 2009 +0000

    Merged bug21775 into default

commit 7a636944bcd9c951af1c3ce32f63a6d132106728
Merge: 50e004b14 2cf30f366
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Nov 5 14:58:02 2009 +0000

    merging in from default

commit 92a780eb6ceb5e97cff03dd31e336955dc56f3ab
Author: David Wragg <dpw@lshift.net>
Date:   Thu Nov 5 14:43:43 2009 +0000

    Move the pkill to after the check that there is a rabbitmq user

commit fb186ebf31f0938cd2835bd1531dc25b78ab8486
Merge: ad2923d59 592cb287a
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 5 14:43:08 2009 +0000

    Merged default into bug21775

commit c88ed6566ea28116fb303c9c8ffcc52d78c2968b
Author: David Wragg <dpw@lshift.net>
Date:   Thu Nov 5 14:39:49 2009 +0000

    Move epmd killing from the init script to the Debian postrm script

commit 2cf30f366aced9bf3e02d28360f588cd0aac8586
Merge: 592cb287a d5c9fd6f5
Author: David Wragg <dpw@lshift.net>
Date:   Thu Nov 5 13:58:38 2009 +0000

    One head is better than two.

commit 3a6fcfcda58d1233fe7a033be59eea57f1021d5d
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Nov 4 20:55:21 2009 +0000

    updating rabbitmq-service.bat to reflect changes in rabbitmq-server.bat

commit 592cb287ad55faa9c9c30645b67ddf791498ecb8
Merge: b0743d29a 590b4bd6f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 4 17:34:53 2009 +0000

    merge bug21831 into default

commit 0c062af08c8edf06cd9da0e713bb9c4950362973
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 4 17:11:23 2009 +0000

    bug 20578: factor out the check-if-the-queue-has-changed pattern of the two branches

commit 838907a0ad4a9ccd48be95d55378304a74cf6a05
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 4 16:50:02 2009 +0000

    bug 20578: Spring-clean queues on recovery by checking each to see if
    it is exclusive to a dead process (connection); and if so, deleting
    it.  As things stand, a queue can't be owned by a connection on
    another node (so the aliveness check is redundant), but this will
    account for such scenarios in the event of connection- or
    queue-mobility.

commit b0743d29a715343c813eff898d187d02cb02ca4c
Merge: 5b6ca852f f381c6f7f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 4 16:08:35 2009 +0000

    merge bug21782 into default

commit f381c6f7f6d7defc7aeb7011cbe5117c828082b4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 4 16:08:13 2009 +0000

    cosmetic

commit 5b6ca852ff301c0ad9e45562d8d89ebbf23645b3
Merge: 3394efabb 852c0ba85
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 4 16:02:26 2009 +0000

    merge bug21570 into default

commit d5c9fd6f5018e39a3edae0468f87f54a0240d4c6
Merge: 3394efabb 0118aec41
Author: David Wragg <dpw@lshift.net>
Date:   Wed Nov 4 15:59:41 2009 +0000

    Merge bug21802 into default

commit 997ca6aa36dbec1e46321bb626c8e3e8e6193f10
Merge: 11b5c0872 3394efabb
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 4 11:56:02 2009 +0000

    Merge from default to get, among other things, better memory management and synchronous auto_deletes

commit 11b5c08721455051fef2dc547510a087c87ae9ea
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 4 11:44:36 2009 +0000

    Update test to rabbit_amqqueue:declare/5

commit 1bd21d7c2c2055a2e48f9f656ab6507afc159f7b
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Wed Nov 4 11:22:38 2009 +0000

    bug 21385: Make basic.get respect exclusivity

commit 50e004b1488080cd9ae8e6c95f69b43bd82fb063
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 3 18:23:18 2009 +0000

    subtle bug in queue_index in that there's a sort of race because scattering the journal out to the segments can cause the publish file handle to be closed, should the segment become full. Fixed.

commit d239db13197fc07b56843c5d0594556ecaa03c82
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 3 17:13:10 2009 +0000

    bug 21385: check exclusivity for queue.bind as well.  Because I need
    to do the check inside the transaction, I had to change
    rabbit_exchange:add_binding/4 (and delete_binding/4) to take another
    parameter for the check.
    I also made the exclusivity check more obviously run for its
    side-effect.

commit 3d8a846b69581cb4372903b9dd27361077fb8ad5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Nov 3 16:58:17 2009 +0000

    Fixed a few bugs in fhc, pushed fhc through to msg_store and msg_file. API change to fhc:position to match file, also extended fhc with copy. msg_store must also trap exits so that it will shut down cleanly - especially important given that data to be written is now cached more aggressively. Removal of stop from msg_store as it's part of a supervisor and so the correct way to stop it is via the supervisor.

commit 1ce6443849ac8086ac7afb10ee53ff3f91a07104
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Nov 3 15:41:26 2009 +0000

    bug 21385: Move exclusive queue checks to rabbit_channel, and add them
    in to the queue operations mentioned in the 0-9-1 spec's "exclusive"
    rule (except for queue.bind which is a bit harder).

commit b10788b74928824690cddee5cfc8da930c7282ef
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 2 18:11:18 2009 +0000

    started work on properly testing the vq. Caught several bugs already. Also hooked in the remeasuring of the egress rate of the variable queue, which will also eventually form the driver to inform the memory_manager. eventually.

commit bf1029db49ed642f270c78f0420e6aec691f1d95
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 2 15:43:04 2009 +0000

    Still haven't discovered any real bugs in the refactoring that happened to qi on Friday, but quite a lot of cleaning, extra code comments and general polish to qi

commit 4eec29a3d5d1f1d0da31c546b060cd59d327fcc4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Nov 2 11:50:13 2009 +0000

    Documentation, cosmetic and tidying up test artifacts

commit 4a1b5e5279127cbcf75880b4ce145dd4aefae050
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 18:00:26 2009 +0000

    Well, the transformation is done. Hilariously it works, first time. However, whilst all tests pass, I suspect there may still be faults, eg in the counting of entries in the journal etc. It still needs further checking...

commit 6c2709a85d3a1a16ebc1da263ceef42b2e5a54cb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 15:28:25 2009 +0000

    Made the qi keep counters for the publishes and deliveries and flush to disk (minus sync) at the right points. All tests pass. However...
    
    ...it's actually wrong. Deliveries really don't have to happen in the right order. For example, if you deliver a load of messages, then publish a load, then requeue the initial lot, then you'll be publishing those msgs with new seqids, and marking them delivered. That could be in a different segment file, thus upsetting the counters.
    
    So really deliveries need journalling too. In theory that looks straight forward because deliveries and acks look exactly the same in segment files, and so just using the very same code for acking and deliveries should be totally fine. But, it's not because of the issue of duplicates. During scattering of the journal out to the segments, there's a period in which there could be three entries (pub + del + ack) for a msg in the segment file, *and* an entry in the journal (ack). This is fine, and we make sure when scattering at startup that we don't reack msgs that have already been acked in the segment. However, we could now have two entries in the segment file (pub + del) and an entry in the journal, and not know whether that entry is the ack or a dup of the del. So we have a choice - either use 1 bit in the journal to indicate whether the entry is a del or an ack (bringing the space for seqids down to 2^63), or use two journals, one for acks and one for dels. Assuming Rabbit can do 50kHz, 2^63 will still last 5.8million years, or 2.9million years at 100kHz. I think this is still fine, so will take 1 bit from the seq id.

commit 2c8ccb231bd7dcc635bc8e2b6c866a052c33c0fb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 13:39:08 2009 +0000

    Added specs to fhc

commit 62e8bcdaaa9855f6c016bb0f8e5520066059584a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 12:36:19 2009 +0000

    bool() => boolean()

commit f1c04a6dcdb0cff53eee637eeb4fcdd540c2fa5b
Merge: 10a3d6a57 3394efabb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 12:33:25 2009 +0000

    merging in from default

commit 10a3d6a573a168d6df8ae59fe315215ec70949cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 12:28:19 2009 +0000

    cosmetics to fhc - just moving and tidying

commit 79f0d28ffd22f72dea5c392633181cc2b2eb3e34
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 30 12:02:51 2009 +0000

    Added destination file, and lifted the code from rabbit_misc:write_term_file (though with ~p, not ~w)

commit 3394efabb87ad14d20a8df7bd681345658594e09
Merge: accc8e47b b7cdf2bc5
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Oct 29 19:14:31 2009 +0000

    merging bug21804 into default

commit accc8e47b44e9d112cd11fa4badb0e8ab990bb29
Merge: 54165fd04 ee4c58998
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Oct 29 19:09:43 2009 +0000

    merging bug21877 into default

commit 54165fd04f0ad4b961e898fad78457a95154c62f
Merge: 75ecf9990 f52a5e243
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Oct 29 18:59:39 2009 +0000

    merging bug21789 into default

commit 590b4bd6fadbca156000b92680cddd6694763022
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 18:08:21 2009 +0000

    When clustered, on application:stop, make sure we call on_node_node(node()). This is necessary because application:stop does not constitute a node failure, thus other nodes won't notice. Tested by creating a 2-node cluster, creating durable and non durable queues and checking that they're removed from mnesia tables as appropriate on application:stop on one of the nodes. Of course, even with the application stopped on one node, rabbitmqctl status still reports both nodes in the list of running_nodes. All tests pass.

commit 75ecf99902ae35a308f595c24a7e821d530c86a6
Merge: e13ef6f44 bbfe1e56b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 17:49:12 2009 +0000

    merging bug 21457 into default

commit bbfe1e56bc931765d0a411a8e1022e0596efbde7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 17:39:56 2009 +0000

    set limits for 32bit to 4GB and 64bit to 256TB. Set default vm_memory_high_watermark to 0.4, and adjust display of memory size in undetected OS case

commit ad2923d593161fe349f009c8fec0ca95523519c2
Merge: 21815f728 3783ff77b
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Oct 29 17:29:30 2009 +0000

    merging from default

commit 5a4bee772eec493a17353a67baf6cbaf0360b5e4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 16:48:59 2009 +0000

    Minor improvements to spec and some cosmetics

commit 852c0ba85aa3b018017911cd648fa0ad3cf3e80a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 16:24:03 2009 +0000

    Added extra spec which may shut up R13B01

commit 0e9981881db3cee11dd88f224984059c3f04c6c9
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 29 14:17:29 2009 +0000

    QA: specs

commit 0118aec4142ab506a26908eb7fba8e07d0377493
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 13:55:24 2009 +0000

    typeo. Or something.

commit 2182aad253461529d361a1408cf1af7e891862c0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 13:54:11 2009 +0000

    placation of Matthias - more sensible rabbit_mnesia API

commit 587a8da97e2df7370df757d73e6b97156f7dfe7b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 13:43:03 2009 +0000

    Made the wrappers slightly smarter so that they also detect when they're the rabbitmq user and just pass args straight through in this case (which, after testing, really is the right thing to do). Note that at least on debian, the rabbitmq user has the shell of /bin/false, so shouldn't be able to log in, but even so, either edit that to /bin/sh and then su to rabbitmq and then rabbitmqctl list_queues works, or su rabbitmq -s /bin/sh -c "/usr/sbin/rabbitmqctl list_queues" works. In short, it seems to work.

commit cdaffe9b1039457f1367a256cb436cd41e729428
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 29 13:06:02 2009 +0000

    QA: yes, that's better error handling...

commit ef9ca08092dba4e038ff44d9ccda79b093446ab2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 13:00:09 2009 +0000

    On application:stop, if we're not clustered, walk through all the ram tables, and clear them. This has been tested by declaring durable and non durable queues and checking that they disappear on application:stop from rabbit_queue table. The durable queue does correctly still restart on subsequent application:start

commit 4012156bbc9837ae9fdba8ca7e422e32e1a0738c
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 29 12:22:58 2009 +0000

    QA: Removed useless comments, added 'no such command' guards.

commit ee4c58998abda4928a5338681f200d4e4dcd298f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 12:14:39 2009 +0000

    correct default path to erlsrv.exe
    to point at a likely location of an R12B-5 install instead of R11B-5,
    since the Windows bundle now contains the former rather than the latter.

commit 6ad92b5d266554940fd822ca8f12c3f9b5fe06b2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 29 12:01:23 2009 +0000

    Added specs which, importantly, feature no_return() as the return types, in order to shut up dialyzer

commit b7cdf2bc5098df216d6f04de00676a8e857307c4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 11:51:42 2009 +0000

    stop batch from tripping over vars containing parentheses
    The root cause was a missing quotation.

commit f52a5e243d5d4952a76bf157b732dddde8151ac4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 09:50:37 2009 +0000

    missed one

commit 68a77dede5e1b40c8496853fed4eb3a03478b210
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 09:49:05 2009 +0000

    prevent vars from escaping the script and polluting the env
    also some minor cosmetic changes

commit e13ef6f44f474a22861ce27fac356323b93daaa5
Merge: 9c601a14b 5643ed682
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 09:43:26 2009 +0000

    merge bug21788 into default

commit 5643ed682075cd8f500cbf3f2a2d35b109d55d88
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 29 09:43:03 2009 +0000

    missed one

commit 9c601a14bba52e9bf368c460290ce4c2b385e362
Merge: 3783ff77b 7ceb43e0e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 19:02:36 2009 +0000

    merging bug 21457 into default

commit 7ceb43e0e89469bbc55a1762c4a4467b2c3a9559
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 19:02:07 2009 +0000

    512MB => 1GB

commit e34cf7251d6af55fdb34e6ca4b135aa2edb5e521
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 17:32:53 2009 +0000

    We don't need two ways of disabling the mm, and 0 tends to mean unlimited elsewhere in amqp (eg qos)

commit 8edb8876148244131af332686663f2415b0a2f6d
Merge: 12115e38c 3783ff77b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 17:22:16 2009 +0000

    merging in from default

commit 12115e38cd1ee39e1636d424822099015f789dad
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 17:21:38 2009 +0000

    system_memory_high_watermark => vm_memory_high_watermark

commit ea5bad14e67fd26e69d93db58ac9eb26439d85bb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 17:12:44 2009 +0000

    More cosmetic

commit ffbd06cbbe16a624836b09c894e4166f234bc75a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 16:53:09 2009 +0000

    more cosmetics and formatting

commit 209238010fb84b1fdc2045e8f0b34ef3d8c0f600
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 16:35:46 2009 +0000

    More cosmetics and reorganisations

commit 66b3d1addc2ef990c74ffabaa5c4d998d91f0528
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 16:06:03 2009 +0000

    cosmetics and rearranging only - conformance and consistency

commit 3783ff77bfc20e491e5fc9fc91061f5255179d44
Merge: a2f5c52f6 8e445e6a6
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Oct 28 16:03:05 2009 +0000

    Merge bug21788 into default

commit 8e445e6a6b7e23a0e379f0928640904fd9ee2544
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Oct 28 15:57:28 2009 +0000

    Add missing quoting RABBITMQ_EBIN_PATH on the deletion of rabbit.rel

commit 0b8a18cfb2ad1a63683945d08d0be48220156a36
Merge: bb19594ca a2f5c52f6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 15:54:03 2009 +0000

    merging in from default

commit a2f5c52f61a53e3754f011d490febada626461bd
Merge: 96ddaed9b d32711d62
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 15:43:40 2009 +0000

    merge bug 21796 into default

commit d32711d62a8b9097d8d5184b3cee44c82d3d3ebc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 15:38:52 2009 +0000

    removed ssl_base64 use in cookie_hash

commit bb19594cabc7bc4d6dcafc3afeaddf5ecddc3f76
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 15:25:14 2009 +0000

    Some minor cosmetics in qi, but mainly extend the qi tests so to cover one other code path that is pretty easy to hit and deserves testing (auto deletion of full segment files).

commit eea836fb25d38fecff1b58896bd1a37b8d0a9081
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 14:36:17 2009 +0000

    Statically configurable fixed width msg id size in msg_store. Associated changes in tests. All tests pass.

commit 9cc1cdd8f2e4563457133cb845f7553862ced792
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 28 14:12:58 2009 +0000

    escape env vars in .bat scripts on use rather than definition
    We did that on most env vars already, except recently introduced ones,
    which caused nasty quoting bugs.
    
    Some cosmetic changes and minor refactoring too.

commit 0ea9fc147f6bbffc6173fa74cec9664525a4fa08
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 13:43:35 2009 +0000

    Added comment explaining delightful code

commit 9312697b3a360f90764e71e377c922606b3feac8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 28 13:31:50 2009 +0000

    Work around in scanning in msg_store files to ensure we don't explode memory. Also drop read_ahead when scanning files because there's just no point given the way erlang works

commit 96ddaed9bfb720a36f406886067fbe8dee1e9c66
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 28 13:02:12 2009 +0000

    fix typo

commit 1edefa401e9ea67eb2e1a376e2710e375878ab6b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 27 16:49:53 2009 +0000

    Firstly, delete does not return ok, but {ok, Len}. Secondly, whilst we could delete the child spec on an explicit delete, given the issues raised by auto delete, there's not much point; so Thirdly, add prune_queue_childspecs which is called whenever we delete or declare a queue. This means there will be at most one unused child spec under the queue_sup at any time, so we still need the already_present case in start_queue_process, in case we're unlucky and come across the unused spec (actually not that unlikely).

commit 50f13e8d138e77c98f7e6c0e71521355b78d51fd
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Oct 27 16:01:27 2009 +0000

    On the way towards perfect indentation.

commit d6e2b9114df81dd31a5feb9c17cd216d9987b944
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Oct 27 15:57:57 2009 +0000

    Fixed tabs.

commit 39cb3799a516469befdb9d1f8e081edeb9664ee1
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Oct 27 15:42:31 2009 +0000

    Added support for solaris

commit b1f881885c7e3104d7c0d69bee93de057bbc6758
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 27 15:38:52 2009 +0000

    changed the queue supervisor from simple_one_for_one to one_for_one. This then means that children can take as long as they need (well, up to 2^32-1 millis) to shutdown (flush files out to disk), which turns out to be important. This change has impact on queue creation and deletion too. Also, cl.ean => clean.dot

commit c756708c05452776830415124dd4d297d67720c4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 27 13:07:24 2009 +0000

    Apologies for the previous commit message. What this commit and the previous do is to move the msg_store under the rabbit_sup. This turned out to require some changes to the tests too.

commit 8c494411e88e56f60a614e196c616d36f6bbad41
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 27 12:44:43 2009 +0000

    make

commit c4dc225c0a2520506490ae29d01be64647ea49f7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 27 11:31:57 2009 +0000

    added to qi so that it will store that it was cleanly shutdown, and on startup, if it wasn't, then it marks all msgs as delivered.

commit e489eaf0fc027407fb4b176fd29ac8f28ec727e0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 17:39:55 2009 +0000

    Added check in the qi startup that msgs must be in the msg_store. This affected some of the tests. All seems to work.

commit 0bf33182c2274d83a286369c32c4b41720558b28
Merge: d1a918647 5d0375a9c
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 26 13:24:15 2009 -0400

    Default merged into bug21457

commit 5d0375a9c9f32a4afd327545b3348fe3288336f2
Merge: f280daebf 0955d135f
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 26 13:16:11 2009 -0400

    Merged bug21415 into default. I missed it previously.

commit 68d168857188d58f9a31c8c58d16825cc01d16c1
Merge: 884d689bb f280daebf
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 26 13:09:47 2009 -0400

    Merged default into bug21742.

commit 884d689bb1c35ab6dbc38f718328cb29d41eb905
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 26 12:54:48 2009 -0400

    Major refactoring including ets, saving last-send-value and call instead of cast.

commit ba4d3e0e1aadcfe367b55717bce2f3ec370f44cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 16:28:53 2009 +0000

    rewrote the qi populating the msg_store (delta function), sidestepping queue scattering. Seems to work fine.

commit a2191649b05773c76661ffe41a7d85e4e1c9b4e3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 16:05:17 2009 +0000

    correction of ordering of exports, specs and functions. And correction of specs. All just for qi though

commit 896dee8c4acffe20e2e3c4dda3358678ca02e5ac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 15:29:56 2009 +0000

    Mainly a load of cosmetics, and some minor API changes, but also manage to hook in getting the queue to flush the journal out if the queue is idle and has no work to do. This takes advantage of the ability to incrementally flush out the ack journal.

commit 595098e4b5c04b5031facfec20c9c92f337191ec
Merge: 5c6a61461 f280daebf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 13:04:28 2009 +0000

    merging in from default

commit f280daebf105d43752ff3a1f524c4d39db67c980
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 13:02:38 2009 +0000

    bug 21758. Missed the first case in handle_ch_down which was noreply(... and needed turning into {ok, State} in order to match the other cases

commit 5c6a614616804771ff86d6a65e686e7e83553982
Merge: d12aed060 6f2e0baad
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 26 13:00:00 2009 +0000

    merging in from default

commit 2c83195cacfb4879f777ce588fe2c7f8d847f267
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 26 12:58:48 2009 +0000

    use base64 module instead of ssl_base64
    The former is part of stdlib and hencd available in all Erlang
    installations, whereas the latter is absent if ssl was disabled during
    compilation.
    The downside is that base64 was only introduced in R11B-4. However,
    all the major distributions ship stable branches with Erlang releases
    later than that, and for exotic distributions the user can always
    build Erlang manually.

commit 6f2e0baadf31ceb6ad37bef0fab2102acb51675a
Merge: b934e3951 c252ea7de
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 26 08:52:47 2009 +0000

    merge bug21777 into default

commit c252ea7de18116cb432d3ee2f14d756822296c82
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 26 08:52:22 2009 +0000

    cosmetic error formatting changes

commit b934e39511abfbfed1c463ce5aaaf16dfc3ec86e
Merge: 6517c6c21 3f4051835
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 26 08:40:40 2009 +0000

    merge bug21758 into default

commit 21815f7280b6fca68e87c8e16dab224babb3900c
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Fri Oct 23 19:49:49 2009 +0100

    adding support for determining if an amqp reply code is either a soft or a hard error

commit d12aed0607ee8d49f5dcfab0f59226b676541f63
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 18:13:16 2009 +0100

    in queue tx coalescing is in. It works too - doubling the number of producers does not halve the tx commit rate for each producer. It does go down slightly, on each doubling, but appears more log like. Also, debugging shows that the coalescing really is working

commit 715b396ca692d3e57ff2a7445a7c126529026569
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 17:17:28 2009 +0100

    removal of dumb code - need to find a better way of dealing with this problem

commit 1bc8295bf8cd4cf02cbe5c3fad9c05dd936e0e30
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Oct 23 10:59:29 2009 -0400

    dict->ets, and a refactoring

commit 115f9c247483cbe53bd9a788f01b44e0b4643c5b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 14:48:27 2009 +0100

    should definitely sync after truncating the ack journal

commit b1bd75a4062900c67213c39d94e3dd04547defdc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 14:39:55 2009 +0100

    Yes, turns out it's a good idea to observe the is_persistent flag...

commit 9ab1135f64baa7f59fbc3cb2e6b43f2a1614c748
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 14:28:24 2009 +0100

    mainly cosmetic renamings. Also added support to queue_index:sync so that you can indicate whether or not the ack journal should be sync'd. Use of strace shows that in the test in bug 20470 #c6, we're doing 2 fsyncs per txn, which makes sense - one for the qi, and one for the msg_store. However, only getting about 180 txns/sec, as opposed to 350 as reported in that bug.

commit 21cca2413fcf784f44058c207b59bbc92e519856
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 13:38:56 2009 +0100

    finally added support for smart syncing of the queue index on commit. Note performance is pretty bad as although the msg_store is doing coalescing, the queue index isn't yet, so it's fractionally above one call to file:sync per commit

commit 882ca0d5945b0c092e88aa6d9a2f5760fc1f455b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 13:37:38 2009 +0100

    Added is_dirty, which is necessary so that we can avoid unnecessary syncs. It's not good enough to just look at the write buffer, because the write_buffer may not be being used. Also corrected gross mistakes in sync, moved around the last_used_at update, and some cosmetics too

commit ced4fd7cf1a74bd0bbbdc18819d632a4aae87be8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 23 12:15:41 2009 +0100

    Removed state from fhc. The reasoning is as follows:
    1) the fhc uses the process dict
    2) the fhc needs to receive msgs from its server process as to limiting the age of unused fhs. This is clearly per process
    as such, it's daft to cater for a process having more than one state for the fhc. Thus any state necessary will also be put in the process dict.

commit 6517c6c2185976661adb940aa123940b074814a9
Merge: b770dd42d 71ad88947
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Oct 23 06:42:56 2009 -0400

    Merged bug 21807 into default (list_bindings order).

commit 71ad88947c14e344a900bc712340a0a902923541
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 22 18:59:40 2009 +0100

    correct list_bindings result field order

commit abf7da7eb8bc832f594bf030d7ea6c709ad650ff
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 17:54:07 2009 +0100

    drop the offset arg to read, also account for the possibility that we didn't read as much of the file as we asked for. All tests pass.

commit 00c9d76ac93f9bf76d1701c70996a78a3601e08d
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Thu Oct 22 17:17:05 2009 +0100

    - keep track of the owner in the amqqueue record.  We need this so we
      can check equivalence on queue.declare
    - speaking of which, implement the "equivalent" rule of queue.declare
      (bug 21832)
    - queues are exclusive on creation, and don't change owner, so get rid
      of claim_queue
    - also check exclusive in the passive version of queue.declare; this
      is explicitly mandated by the spec (queue.declare, exclusive)
    - bug 21385: exclusive queues are deleted when their owners go away,
      as per the spec.  This didn't actually change implementation -- it
      was wrong for 0-8

commit bffe10e741cdc19f727ca8f50e22b3603a861254
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 22 12:13:14 2009 -0400

    QA: changed names to: queue_duration, changed MemoryOvercommit to be available/used (instead of used/available)

commit 91edec707b01d130854686ad2de589ec01175f2e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 17:04:51 2009 +0100

    starting to deal with the idea that fhs may disappear because of hitting limits

commit 7d78971a0eef645b34905cd681e48012ce7cf07d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 16:23:55 2009 +0100

    bug fix in fhc:read (not tracking change in offset). Also made qi use new fhc, and remove hdfhc

commit 966a760267e30aa0d0c3a5b2a841fa9350238689
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 15:23:09 2009 +0100

    not quite complete, but much much simpler, and prettier

commit ec183a402d8a964ce7ebf9f52ef7262f60b2c049
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 22 09:00:57 2009 -0400

    QA: specs, and LOGDEBUGS

commit d1a91864747b84f2cafb03e2f2e5833fccead598
Merge: a52cd8d94 b770dd42d
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 22 06:55:44 2009 -0400

    Default merged into bug21457

commit 283cd95333fb49eef6a9c60c38f561971b1b85b5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 11:49:47 2009 +0100

    More work on the real fhc

commit 4cb3ed5008d54c6c61016ac0ff175550074e7245
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 00:23:11 2009 +0100

    trivial and cosmetic

commit b5a56fbc6c9d57ee6f3a4d0f67e92120b7115802
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 22 00:12:44 2009 +0100

    Started work on the real file handle cache

commit 062199e0329321153838b080a3c5b6ebe087bfe2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 21 17:05:38 2009 +0100

    Added write buffers. Performance now very very good, and could get better if can get msg_store to use the new fhc. All tests pass. Sometimes.

commit a10db26a6dfc303b5551dafbf4575a77926eca12
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 21 17:04:36 2009 +0100

    Added sync_all for queue_index, trap exits in amqqueue_process, make sure that terminate calls terminate in variable_queue which calls through into terminate in queue_process.

commit fc2c7042a23873e638cc02cc1485875fafa140bd
Merge: a99b501b7 b770dd42d
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Oct 21 10:32:26 2009 -0400

    Default merged into bug21742

commit b770dd42d49f251518caace98d7167704cc3d5e1
Merge: 0aca55dbe 15b536e72
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Oct 21 09:22:39 2009 -0400

    Merged bug21771 into default.

commit 15b536e7238c7e09ada636c269355ec9b334c680
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Oct 21 09:21:39 2009 -0400

    Minor QA fix

commit bd006be70b6fc03f2d7226a4aaa337e8daf42697
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 21 12:50:41 2009 +0100

    remove unnecessary rabbit_ prefix in process dictionary entries in fhc

commit 028b0dda8fad6642a25553ea7583598c5e7a962e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 21 12:26:55 2009 +0100

    fprof shows that dict really sucks hard, so switch to using the process dictionary in the fhc. This eliminates all need for state, however, I've not removed fhc state from either fhc or qi because of the likelihood of needing some state back in for the real fhc. Performance is now much better because I went back to the original qi before the fhc modifications and realised that I should have been opening files with read_ahead enabled, which I wasn't before. In fact really, performance is now quite a fair bit better than before the fhc came in.

commit aee6641710fe42a7606964349a8b87186a7733b6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 20 17:57:08 2009 +0100

    still far too slow

commit 92addf3ac62337fdf3c25b058d5f1f8a1aff1e48
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 20 17:28:06 2009 +0100

    well, it's about 4 times slower, but the dumb fhc works on the queue index

commit 3f4051835d88405b95d3e3f554dd73b391ea7d18
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Oct 20 15:37:32 2009 +0100

    Typo and style fix

commit 761f1c51f163b44a81d2f9b8a65eeb7794e54aed
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Oct 20 14:05:54 2009 +0100

    Use a specialised return value for handle_ch_down, rather than reinterpreting what used to be a handle_call return value

commit 343e2827a0f04d6c5c71a7ae591b17d5066c3506
Merge: b14c1e9bc 0aca55dbe
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Oct 19 23:53:02 2009 +0100

    Merge default into amqp_0_9_1

commit 588d183c81a77b93543ade52583d32b8759ee78e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 17:36:52 2009 +0100

    don't use foreach seeing as I'm not using it anywhere else

commit 626cb737b63644a97d0e62aa54005b4c816ac8ca
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Oct 19 17:11:50 2009 +0100

    Do the queue deletion synchronously.  Instead of replying immediately
    using gen_server2:call, then doing the work, we include the reply in
    the return value for gen_server2 to pass on.  It happens that
    gen_server2 will terminate the process, on getting stop, before it
    sends the reply on -- just what we want here.
    
    NB: here we translate between the return value of handle_ch_down/2,
    which was intended to be the return value for handle_call, and an
    actual return value.  Slightly nicer would be for handle_ch_down to
    return the state and (say) 'ok' or 'stop', to make its contract more
    explicit.

commit c195f7ded31b013c15be5d194c1cd41223ddedff
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 16:54:43 2009 +0100

    make sure we stop the msg_store at the start of the queue_index tests

commit 8aed74110a5a16b6076342b890f91847c0dd695c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 16:48:29 2009 +0100

    Extending queue index test slightly

commit e00a2c087ef5aa7008e6fe70a1c9585c49b74b8f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 16:11:46 2009 +0100

    reversing previous change, as I had actually got it right first time

commit efbf8fca2ee1da46760e7e9689483df774065555
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 16:09:53 2009 +0100

    more helpful when the bugfix fixes the bug

commit 76be0ae44548d41df6839ecf72fab272840bea9f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 16:00:29 2009 +0100

    tidying up end of test_queue_index

commit 7e2848234bf3ab1500db09dfcc555c44e2c273f9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 15:57:03 2009 +0100

    Some minor API changes which are pretty sensible anyway, but also make writing tests much easier. Also, tests for queue_index which hit 90% code coverage for the module. Profiling in progress to try and figure out why it's not quite as blazingly fast as I expected.

commit cb7542b5afd0f7bc1bdbeadd48299a4bdf3720b9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 14:42:55 2009 +0100

    added missing spec

commit ede93322b078db421c9fcdb81a147aade58ec907
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 13:25:59 2009 +0100

    spelling

commit 13f0c5c47a83473dc6f7fbfa89e150eeaa3e70e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 13:20:30 2009 +0100

    now() -> make_ref()

commit 689e6891d261cef91868966d070e5d2474aa68ac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 13:14:42 2009 +0100

    preemptive refactoring

commit b14c1e9bca13e34beb216c4c04f8fb0cf9ec1497
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Oct 19 13:09:31 2009 +0100

    Include protocol revision in banner

commit 0bdbad3bff1615a2506f949c0ae171e2149c8a0c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 12:56:20 2009 +0100

    factoring out of some magic numbers

commit 6cab4bfa645307da9fdb663d5ff24abfda69bae3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 12:54:30 2009 +0100

    stop the msg_store at the end of the tests so the rest of the test suite can run. Also, fractionally increase code coverage.

commit c2f658e49a585928ce93316258d39bc150a77fba
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 12:44:14 2009 +0100

    test suite for msg_store - hit's 80% coverage - uncovered code is for recovery from crashed compactions

commit 946a57300e0865986786d239faf06e5cb7aa5aa6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 19 12:43:43 2009 +0100

    on requeue, make use of msg_store:release

commit 52fa85c4018007d1944302f6f315ef5fc7f5d724
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 18:17:15 2009 +0100

    If we don't fully flush the journal when it becomes full then we are negating the point of the journal as it means we very frequently fill it and then have to empty it to one file, whereas if we fully empty it then it takes much longer to fill, and then we empty to several files

commit 5e5f0bce867136740b7989540aab674d4339021f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 17:48:40 2009 +0100

    empty queues that get deleted should, um, be deleted

commit 03376e026f7e9705a8c7000f93c515a63a7becc1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 16:55:43 2009 +0100

    assertion that the purge count equals the queue length

commit 01346bcfb11aa88e5a1ab51361997f5415ce0dd6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 16:43:15 2009 +0100

    Bug fix.

commit 641a66abb12a2605c4538b53b336ca11755b0560
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 15:50:44 2009 +0100

    Bug fix.

commit 6defdc9c1f59e95d802675eec3c2333ca45291f1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 15:15:27 2009 +0100

    Bug fix.

commit d36651e3f53e4be5f96752611e81fb924380a793
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 14:55:41 2009 +0100

    Bug fix.

commit 4dfaaebf75782966558879647dc84a1787850db9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 14:35:15 2009 +0100

    Bug fix.

commit fd898a5062c75057f1d7979ada125a0f5ac1ae0b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 12:12:28 2009 +0100

    bug fix.

commit 42fac66afc783aecba5c6828aa82a0330f498067
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 16 11:27:45 2009 +0100

    bug fix.

commit 6fd72ad3a1e7e2dcef5adb68913c3b96bf84937b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 18:15:01 2009 +0100

    A load more fixes. Seem to have uncovered the possibility of finding many acks for the same msg when reading in a segment file...

commit 4734d563612ef60fbca873a035c2aa0b5e3ef948
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 17:36:36 2009 +0100

    use lists:flatten, not hd

commit 51edc03f72c6b826bc4b46a24acf5f7abf8582b9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 17:25:48 2009 +0100

    some more fixes. durable queue recovery seems to work

commit cc86d0f3ff7de862626f7a55d9de30f3a5969470
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 16:31:01 2009 +0100

    some initial fixes

commit 68ffe14519589afcd689141855602c3c94c16366
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 15:51:50 2009 +0100

    the deletion of transient msgs via the scattering of the journal at startup was wrong because there is no guarantee that the journal will touch all the segments. Thus now in the formation of the ack counts, add deliveries at that point where necessary for transient msgs. Acks for these msgs are not added at this point because they need to go via the journal scattering mechanism so that full segments can be removed.

commit 9dfa3c6b67c7352407122f05f257adcaee842965
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 14:19:58 2009 +0100

    slightly more likely to work

commit 10bd87cb3bf44d5604c1566bde622dc38a69cf30
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 13:34:45 2009 +0100

    cosmetics and also removal of bitstring syntax as it seems far too modern, and actually isn't necessary because at no time do we need to deal with non byte-aligned binary data

commit 6f78fe2c212b11a9192c68f5be8d05734e4b3249
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 12:25:09 2009 +0100

    the queue index deletes transient msgs on initialisation. This is rather elegant because it means that the delta gen fun used to seed the msg store does not generate any deltas for transient msgs, which means that the msg_store will take care of deleting transient msgs without any further interaction.

commit 01a461a749bf63a8b9ae6f5e06308c2fb9325f71
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 14 11:18:56 2009 +0100

    Wire up the tx_commit callback. Note no coalescing because no sync on queue_index because no fhc. Also added notes about the deletion of queues on startup.

commit d45430efc624b8a0a81f2aceb415942e25af30f1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 18:07:23 2009 +0100

    Be a bit more clever on starting the message store and look up durable queues. However, it's still not quite right because queues can be deleted by other nodes in the cluster between extracting the list of durable queues in msg_store startup and the startup of queues themselves. This means that we can end up seeding the msg_store with msgs from queues that won't actually start up. You might think that we'd be saved by the fact that _process:terminate deletes the queue, but no, because fwics, _process isn't trapping exits, meaning that the terminate won't be called (and most likely rightly so so that it doesn't upset mnesia's state) by the exit(Pid, shutdown) in amqqueue:recover. So there still needs to be some sort of fix somewhere and somehow

commit 4ef2ed434c2f3c2c8e83ff6670ad7347f390b562
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 16:15:29 2009 +0100

    most of the rewiring is done. Need to sort out how to delete non durable queues on start up, which is a bit cyclical, as I'd like to not start the msg_store until we know which queues are durable and which aren't, but we also can't start the queues until the msg_store is running. Fun.

commit 02e5493c4de8be92e447d904b7bc41cd5475da02
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 15:32:15 2009 +0100

    added publish_delivered/2 which deals with adding a message, when the queue is empty which we already know has been sent out to a consumer, so it's really just a case of writing to disk the message, and index pub and deliver entries iff the message is persistent

commit f08c39dc0b10a312644a84a96457d19e95b2e225
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 15:15:13 2009 +0100

    publish/3 -> publish/2 because the IsDelivered bit is always false when called externally. Also rework requeue, because with the ability to indicate that persistent msgs will already be in msg_store, we don't need to call msg_store:write for persistent msgs, which means that we can also avoid the call to msg_store:remove that would have happened in the call to ack

commit 86189f50af06b7a92ef451fb9f49bdbc25550fe8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 13:47:30 2009 +0100

    it starts up again

commit 2b0cc92ad344d1e3431b8eae505d3f86d9764902
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 13:39:04 2009 +0100

    Added ability to seed the msg_store. It's a bit hairy.

commit 19df3a8e2daea018cf3aaaf3986cd84d54af2a23
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Oct 13 13:19:48 2009 +0100

    Bug 20768: Accept a protocol header with 0-9 or 0-9-1 only, and disconnect otherwise

commit 67999bc6837d267bc80f6156c6c17b4d4aee99da
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 11:45:41 2009 +0100

    Maybe done. Maybe time to start hacking out mq and dq. Maybe.

commit d444fd443b8a324a08add6ab54f6e6889473108e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 13 11:11:16 2009 +0100

    factorisation and application of DeMorgan

commit ff94f3c3a6bff3d3b2e1bc0d256b9bc2951fe9ce
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 18:05:16 2009 +0100

    in preparation for commit, need to be able to indicate in a publish that persistent msgs have already been sent to disk

commit a1100da255e7186636085b934570319edb62083d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 16:49:19 2009 +0100

    cosmetic

commit 194569a16d18370d8733c803786109944f535c8e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 16:27:48 2009 +0100

    tx_publish and tx_rollback done. Only tx_commit to go...

commit 9f1f2a2935e1abb2134b1d8a42245539a3ced2f8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 14:56:07 2009 +0100

    Requeue turns out to be vastly more elegant and predictable than in mq.

commit dd82e3016fe8a5ef3b6f4bf996d9191a5c529dcf
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Oct 12 13:57:23 2009 +0100

    Remove demo extension, and clean up the makefile.

commit c8b80cfff12651244ff461a598551e0dfc1102ff
Merge: 21eb440a5 0aca55dbe
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Oct 12 13:53:22 2009 +0100

    merge default into bug21763

commit 95851b9ab2968536138371d79cb01633dde4c404
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 13:33:56 2009 +0100

    implemented delete. This is slightly less than pretty as, after doing the purge, we have to walk through the index on disk in order to pull up msgs which have been delivered and not acked

commit a52cd8d94a8eaada768c4a12f9ea330f2b03ff1b
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 12 13:25:20 2009 +0100

    QA: erlang:trunc -> trunc

commit e6f2c09625f9cc81a11fe0f5150df36b4ff62525
Merge: 11137ab1a 0aca55dbe
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 12 13:20:41 2009 +0100

    Default merged into bug21457

commit 2b503a75d5a6dd551174f30a23e68643ef6d55ab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 12:34:31 2009 +0100

    for queue delete I need to be able to discover the lowest and highest non-acked seqids thus splitting out this functionality

commit 11137ab1adfde763d079a468cb9eb64dad08f9b0
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Oct 12 12:23:17 2009 +0100

    QA fixes

commit aa704e71a575555b69036acaa58b79b9c79665d9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 12:22:16 2009 +0100

    a couple of full list sorts were unnecessary and should only have been max or mins

commit cbdf3da7c001844eb3cbb1dfb3d512e87172793e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 11:44:59 2009 +0100

    Well, it was beautiful, but it was also wrong. Firstly, purge needs to return the count of the msgs purged. Secondly, it needs to remember to purge msgs and indices on disk that are in q1 or q4.

commit ab00b22f45feb9643a5efd22b87b488a927bd46f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 11:05:44 2009 +0100

    given the way in which the vq works, the removed tests were unnecessary. For example, in store_alpha, q1 *must* be empty unless one of q2, gamma and q3 is non empty. As such, to determine whether the alpha goes to q4, we only need to test for emptiness of q2, gamma and q3, not q1 aswell. Similar logic holds for store_beta

commit 78bbcafeff1f0abc713bc195ff12f81dc9adde34
Merge: 4fc3412a0 0e3b669fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 12 10:57:38 2009 +0100

    merging in from bug 21368

commit 0e3b669fd2f02abb41299a0df6ed38e1d790aea8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 11 14:02:44 2009 +0100

    rollback transactions on queue termination
    That way we don't leave garbage - transactionally published, but
    uncommitted messages - in the message store.
    Also, we we can get rid of the pending_commits state wart in
    disk_queue. That is possible because both tx commits and queue
    deletions are issued by the queue process and tx commits are
    synchronous, so there is never a chance of there being a pending commit
    when doing a deletion.

commit 4fc3412a0dbd940a6b8f5974fbdfb4e7de974e6b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 18:17:45 2009 +0100

    Beautiful!

commit d397c015d90be9f08054259b7b87ffb6184c77a8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 17:01:13 2009 +0100

    cosmetics

commit d4490aaa6a3944b0cd0b852a9a8fe1237c56d0a9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 16:52:22 2009 +0100

    Added ack to vq. Realised that ack no longer needs the msg itself, so there've been a few associated changes in queue_process.

commit ac042d70eaf31c10bec0692a55039508b20afd3c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 16:18:29 2009 +0100

    gee, can you tell none of this has been run yet?

commit 569579cadf4db05fd75f980f142356d5fc0d2774
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 16:14:27 2009 +0100

    tidying of the beloved msg_store

commit 1031b829a0e48910c4048beb41d95f339c4ce880
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 15:43:22 2009 +0100

    Prefetcher has priority over q1.
    However, we actually assume that the prefetcher does no work. The only other possibility is to assume that the prefetcher always completes, which can lead to q1 being pointlessly evicted to disk. Also, we stop the prefetcher as soon as have to reduce our memory usage, and at that point everything should work out. So, when starting the prefetcher, we don't adjust the ram_msg_count, but as we drain or stop the prefetcher, we include the prefetched alphas in the ram_msg_count and then evict q1 to disk as necessary. Whilst this means we will have more msgs in RAM then we claim, the fact that we stop the prefetcher as soon as we have to reduce our memory usage saves us from ruin.

commit a9149a4a4ab9e99de7d2571b74647fb625d9a6bf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 14:32:23 2009 +0100

    switching back to lists:min and lists:max as erlang:min/max do not exist in R12

commit 2b962b08311054ee40b24093879d6a653b3ae035
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 13:58:31 2009 +0100

    altered the prefetcher to drive the msg_store directly, and wired into vq

commit 5a634b7fd8c256b619756fc11f3f27b7d7e2b434
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 12:46:10 2009 +0100

    having discovered that erlang:min and erlang:max do exist, swap them in in place of lists:min and lists:max where appropriate

commit fbf5a614b1e83c1977c183d8aa6f09ea2c64d617
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 9 12:13:41 2009 +0100

    adding len and is_empty. Renaming in -> publish and out -> fetch. A bit of moving around. Generally trying to work towards the mq API so that it can be dropped in

commit bf31b990407fc8c5cf255591e029d595f4b9bdfb
Author: Paul Jones <paulj@lshift.net>
Date:   Fri Oct 9 12:07:25 2009 +0100

    Fixed formatting for string-based errors

commit 097acd07612dae61177cac2ec62b972d757bef9a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 8 22:05:27 2009 +0100

    cope with suffixed node names in scripts

commit 3ce9813fd375baea72f9225d90989afd9812842a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 18:18:09 2009 +0100

    on out/1, if the msg or its index are on disk and they don't need to be, take them off disk

commit 4c8ef89985c59c679439477bb5feb799d0740816
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 17:50:47 2009 +0100

    And now actually make sure that on start up we load in the first segment from gamma to q3 if possible. Hence a refactoring here.

commit 0c9a7ab8868bfe47682c4ef05eb283b23ef852e5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 17:38:21 2009 +0100

    The calculation of the highest seq id in the index queue was wrong - it was simply returning the highest unacked seq id, instead of looking for the highest seq id ever encountered. This could have led to reuse of seq ids. We also need to know the total message count in the queue index which is the number of unacked msgs recorded in the index, and we also need the seq id of the segment boundary of the segment containing the first msg in the queue. This is so that we can form the inital gamma correctly.

commit 1ecb08930cfd4cfad92ac382fd8208c8f889a0d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 15:32:27 2009 +0100

    minor further corrections and modifications

commit 50c79aa71c0356c202b5a64c39aea5d62f384d07
Merge: 144137b12 0173f708d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 14:51:35 2009 +0100

    merging in from bug 21368

commit 0173f708d93d55a85dd33d7bef2744ed3acfc752
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 14:51:02 2009 +0100

    fixing erroneous use of thunk(_) in spec to fun()

commit 144137b12fb4af9a30a56406e17fef2b7b1c17be
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 14:46:45 2009 +0100

    Tidying and refactoring of the variable queue, some documentation, and the removal of a lot of algorithmic bugs. No real new features, but code in much better state.

commit 845c25497ce2c31de762bb815b7218138c38f089
Merge: 2ecdaa38b 9dea28e72
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Oct 8 10:50:46 2009 +0100

    merging in from bug 21368

commit 9dea28e72e4ea0857a3da23a31a34efc012d87e6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 8 03:33:11 2009 +0100

    cosmetic

commit bfb9afede0a4393a47664de78f42321e0b01ba76
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 8 03:09:49 2009 +0100

    make msg_store responsible for sync'ing
    The API to the msg_store has changed: now instead of asking whether a
    sync is needed for a set of msg ids, and subsequently requesting a
    sync, we request a sync for a set of msg ids and supply a callback
    that is invoked when that sync is done. That way the msg_store can
    make its own decisions on when to sync, and less logic is required by
    callers.
    
    During queue deletion we must remove *all* queue messages from the
    store, including those that are part of committed transactions for
    which the disk_queue has not yet received the sync callback. To do
    that we keep a record of these messages in a dict in the state. The
    dict also ensures that we do not act on a sync callback involving a
    queue which has since been deleted and perhaps recreated.

commit 98a679a1e632dbeb768e8dc436d9bf7aac91e582
Merge: e1c21592a 0aca55dbe
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 7 21:01:39 2009 +0100

    merge default into bug21368

commit 2ecdaa38b99b2878325cbf5597537162f9f8684e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 18:46:12 2009 +0100

    implemented out. This is getting pretty disgusting, needs some refactoring, marginally more useful variable names, and more API, in particular proper support for the prefetcher. Also, totally untested.

commit a99b501b7c83511d563b3ae42923890b694f12a2
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Oct 7 18:16:48 2009 +0100

    Rewritten the couting, hopefully, it's simplified now

commit e7c22ad29957e2d217f80b3b0b57c2506683a2cf
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Oct 7 16:27:41 2009 +0100

    Few more lines of comments

commit 686c68c85696a2916f65de4127956a806ce4318f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 16:27:23 2009 +0100

    More work on variable queue

commit 21eb440a5b13940262b3ce8e711b77b6ea28105f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Oct 7 16:12:11 2009 +0100

    Demo extension.

commit 0aca55dbe898a61a2379cff6b151822de2dd3834
Author: David Wragg <dpw@lshift.net>
Date:   Wed Oct 7 14:56:24 2009 +0100

    Added tag rabbitmq_v1_7_0 for changeset b1089fcc31b7

commit ca4368bc0a353afbf0a8cfd602003960381556d3
Author: David Wragg <dpw@lshift.net>
Date:   Wed Oct 7 14:47:05 2009 +0100

    Bump version to 1.7.0

commit b1c6afd12806ac531cec46c9007db49e29ee9016
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 13:53:03 2009 +0100

    initial hacking on the variable queue

commit 25b0c82ec68026260ae7fad8dbe2ea1859bc1034
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 13:52:48 2009 +0100

    Make init include in its result the next sequence id to use

commit d14be783c9dc0ebb674f5fce0f654b78a97647bf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 13:51:14 2009 +0100

    removing bogus and flawed fhc2

commit 993d751ce1e1c0041bd263bac17b683229cf2a3a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Oct 7 13:50:44 2009 +0100

    just some fixes as a result of dialyzer, but the module is actually about to be deleted

commit b2b1590fb3a2699a21404798a5d66e4866134d1a
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Oct 6 18:22:36 2009 +0100

    Changes to amqqueue_process required to proove that the code works.

commit 3c2a649064939068c089fa38a82b287553f85582
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Oct 6 18:21:58 2009 +0100

    Memory monitor code.

commit 2d963ccd809bdb9382169d24015253de5b35cf4c
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Tue Oct 6 14:51:13 2009 +0100

    auto_delete is no longer a property of exchanges

commit 01c7de5a9adbab716437c0890eeb40f8a9bb2c16
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Oct 6 13:18:14 2009 +0100

    Well fixed a few bugs in the fhc2, but it's fundamentally flawed by the fact that raw files can only be manipulated by the process that opens it. Thus the whole design is wrong because the server process can't be responsible for holding on to released but unclosed fhs.

commit 2fbcc4c836a824a5a56fbc7f1ddb943ab49b05bb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 5 18:11:02 2009 +0100

    mainly cosmetics

commit 234628c76a7269d8f8cad7def3fea39ff8bacd11
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 5 18:02:00 2009 +0100

    more work on file handle cache. However, untested, and liable to extreme change

commit 540e35ecf35e50e2b97a59e0a31ead7251b8bf6f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 5 16:04:05 2009 +0100

    initial work on new file handle cache. Public API not done yet.

commit ab32347d3460f036b82c00f5ea84d21b910401dd
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Oct 5 16:02:19 2009 +0100

    auto_delete is no longer a property of the exchange class (protocol spec section 1.6)

commit e205a1f1873b19f9dfb4ec934da1b4ee91e461a2
Merge: 88d5f01b0 1ff98eb52
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Oct 5 15:31:53 2009 +0100

    Merge from default.  Resolved some conflicts due to bool->boolean in
    type specs, and a bad automerge in rabbit_reader.erl.

commit 1ff98eb5204ee7edda8b85d74667e3d31e4bc5ac
Merge: 69a9b7954 18c10d599
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Oct 5 12:28:44 2009 +0100

    Merge QAd bug21738 into default

commit 93d4da21ab5dd95b8ed8b4d1b2c21761665dd268
Merge: eb6f3f416 69a9b7954
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 5 11:16:15 2009 +0100

    merging in from default

commit eb6f3f416c2d2d38ba6e823ec6267ebb007eb170
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Oct 5 10:31:42 2009 +0100

    minor corrections to documentation that I failed to commit on Friday

commit 69a9b79549694c6896903a8a09b7eeb1ab89b4e8
Merge: 820085ad2 ffdd1ea92
Author: David Wragg <dpw@lshift.net>
Date:   Sun Oct 4 23:18:58 2009 +0100

    Merge bug21222 into default

commit 18c10d5997b6460bca16db430584fe51f399ac88
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Oct 2 20:37:03 2009 +0100

    fix race condition in list_connections test when in a cluster

commit 96dcf1e348c19b16c0bb11e89ec46a4fa84038fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 2 17:53:05 2009 +0100

    Added documentation. Also discovered that opening a file in append mode seems to be slower than opening it read/write and seeking to the end. However, further tuning delayed until after the file handle cache appears

commit e933eecec7be89f0542213cd6ad0424880c078f4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 2 17:09:52 2009 +0100

    when loading a segment, we should of course take into account the acks which have not yet made it into the segment file. Also fixed one further bug.

commit f27b0455a9468b304f61865eb5947ef30f050695
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 2 15:26:37 2009 +0100

    fixed some more bugs

commit 820085ad2cd580f9704ed24c41fcb29e2264812a
Merge: 65c78832f f07274672
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Oct 2 15:04:47 2009 +0100

    Merged bug 21294 into default.

commit 993959790fe5ccca6670cd34160d0a8aaf998a5d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 2 14:33:53 2009 +0100

    ...and now some of it actually works

commit b7abb6d9a8afe2786bfe5640dc5754ca108d168f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Oct 2 13:21:31 2009 +0100

    first cut at queue index. Untested, and uglier than necessary due to absence of file handle cache

commit f0727467268f59a85f9976ddfc6eaebcc29fdaaa
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Oct 1 14:56:01 2009 +0100

    Shuffled the config file element declaration so the debian defaults file will be able to override it

commit f1bc19ca791a3ab367abb1f40cd3b496f090bef7
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Oct 1 14:53:55 2009 +0100

    Changed location of the configuration file on windows

commit ffdd1ea9203acc3ffceceeb5d7107396b762e672
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 1 13:30:00 2009 +0100

    setting log dir for startup/shutdown messages

commit 65c78832fcfd95bb7947ac1fcc94a3a433d66e06
Merge: 522c9e733 d41e26b43
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 1 12:19:53 2009 +0100

    Merged bug 21682 into default

commit 522c9e7336483820be6b119a007ae81d4ba1a83d
Merge: 9dd6442c8 5003afbfd
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 1 11:59:31 2009 +0100

    Merged bug 21273 into default

commit 5003afbfd67642614b5b35ddd14dcebf537ec470
Merge: 75d3715c2 9dd6442c8
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Oct 1 11:55:01 2009 +0100

    Default merged into bug21273

commit 9dd6442c81aaf9b7bebe5586dcc505413d27c2be
Merge: 8d4e9e46d bd9b004c6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 22:01:09 2009 +0100

    merge bug21669 into default

commit bd9b004c686847f77013a360536fd5d2164d3241
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 21:26:56 2009 +0100

    leave error reporting in rabbit:prepare to context
    also:
    - tabs->spaces
    - a few cosmetic changes
    - extract error handling & termination in rabbit_plugin_activator

commit d41e26b4323ef045447217fbd0dce031965a2d23
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Sep 30 19:54:17 2009 +0100

    Introduced realsbin directory

commit 39ab83503e728ed893cdb45d1d7d7143a66238a5
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Sep 30 19:43:52 2009 +0100

    Reverted rabbit:boot to rabbit_misc:start_applications

commit 022d1df47b194e172238eafd6daef80e29d8afb9
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Sep 30 19:35:24 2009 +0100

    Removed application starting changes, since these were causing a number of problems

commit 8d4e9e46d18dd41b279f7b0d93d07ab91ebb61a7
Merge: b35f6b0ee a69f8c88d
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Sep 30 18:29:45 2009 +0100

    Merged bug 20399 into default.

commit e1c21592a5bd33e6189b8ef71b9cf678e89a29d6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 17:59:28 2009 +0100

    cosmetic refactoring

commit b35f6b0ee9fe69b84336292fd940bff11bdd7e8e
Merge: 0f237dafc 6fc762e67
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 17:49:15 2009 +0100

    merge from bug 21397

commit 0f237dafc1faca982465ecf04aac144150fdbd28
Merge: 0271621ac c3cc82c67
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 17:38:09 2009 +0100

    merging from bug 21449

commit c3cc82c67b142484ca8167cb9870b57b1a9add88
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 17:34:41 2009 +0100

    cosmetic

commit e6cfdebe34120a934b284ddba47db7e53c48a4fa
Merge: b51b34d83 0271621ac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 14:37:21 2009 +0100

    merging in from default

commit 75d3715c22bcdc4e052592710e1088d49cfe5c02
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 13:04:56 2009 +0100

    handle errors during connection establishment more gracefully

commit 0271621ac9c395b6514eabbc817e13aeb04ba127
Merge: ef14e0031 fc3fcc64d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 30 11:29:13 2009 +0100

    merging in from bug 21714

commit fc3fcc64d9d592830944c5bbf64567c2fbf71133
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 09:52:42 2009 +0100

    s/bool()/boolean() in type specs
    since in R13B02 erlc spits out deprecation warnings otherwise

commit a69f8c88d4338e0ff08294622fc44f576804783d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 07:21:47 2009 +0100

    cosmetic

commit cc770689c4c247acc0a582cf0810ea2874a6bcdc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 07:13:46 2009 +0100

    fix handling of precondition_failed

commit 9e6524bdbf83bd7c6ba746181f242700e765eb46
Merge: f83fd775a ef14e0031
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 06:48:04 2009 +0100

    merge default into bug20399

commit ef14e003116cec8bd99fa360994477f977e4f1ad
Merge: c38b573f9 eb1661f17
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 00:13:09 2009 +0100

    merge branch heads

commit c38b573f9dfcd05d9cd4bc11f7e89b319a211f13
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 30 00:12:05 2009 +0100

    cosmetic

commit d63d9c99c07b37ae294c7ee927939c7d8c022b51
Merge: bca6c5311 7325eb512
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Sep 29 17:26:56 2009 +0100

    Merged bug 21662 into default (debugging info badrpc).

commit 7325eb512c4a9c3394a051f9d6eb3997c5915ea3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 29 14:49:25 2009 +0100

    display helpful diagnostics on badrpc error in rabbitmqctl

commit 63b28edec9dfbbcbcb004babf9d1d42a47b2488e
Merge: 9354c7fda bca6c5311
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Sep 29 13:22:11 2009 +0100

    Default merged into bug 21457

commit bca6c53111013d880d88794440d8923f9c97ffe1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 29 12:56:42 2009 +0100

    do not ignore error on 'rabbitmqctl status'

commit 435d6f1e8c5d332487b42fca88ff0bda77247e59
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 28 19:41:07 2009 +0100

    Updated boot modification code to support catching errors

commit c2656476a310b6f146c308edf2cec46268521986
Merge: 3add06c45 f83fd775a
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Sep 28 16:51:16 2009 +0100

    Merged bug 20399 into default

commit 3add06c45a22f8a0fb352e3d663b5c40e82f7caa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 28 16:15:10 2009 +0100

    produce error 2-tuple
    since that is expected by things like application:start

commit 9354c7fdacc49a3fa9a40eea66df897feb4f1328
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Sep 28 12:44:07 2009 +0100

    minor os_mon fixes

commit 1c39aee526fdc54fc7f03b5ba23a4d0156768ac3
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Sep 25 17:45:27 2009 +0100

    renamed to vm_memory_monitor

commit 9c96e2a00e776ce845c7241cc18859edcad07675
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Sep 25 17:31:13 2009 +0100

    qa fixes, some refactoring

commit b51b34d83dcd19d2c5ab9c007309db703354d5a6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 25 14:49:54 2009 +0100

    turn the msg_store into a separate process

commit 24c0dadffbd1d5bf12e688eb9c13abb2734f2094
Merge: c7f6e84de b441f9e9f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 25 11:40:11 2009 +0100

    merge default into bug21368

commit c7f6e84de3e3df2d8069927ec16fa1d99ead6281
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 25 11:26:08 2009 +0100

    move constants to where they belong

commit b441f9e9f251859aa3e72a63c92a04cb1040ee3f
Merge: 9640c26cb 319d2344d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 24 12:06:08 2009 +0100

    merge bug21559 into default

commit d2095944c2bf98db37344f445041711dc5b6e998
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Sep 24 11:09:48 2009 +0100

    Added rabbit:prepare to the generated boot file; removed call to rabbit:start when using a boot file

commit 319d2344da30a0bd4211baafccbe9d5653abe777
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Sep 24 10:16:44 2009 +0100

    Added pod file to describe rabbitmq-deactivate-plugins

commit a151955cac138399c0e3202bbb7c630f9c46c034
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Sep 24 10:12:05 2009 +0100

    Changed target of reinplace calls to prevent macports converting symlinks to files

commit 9640c26cbd8488b0321ec96c350abf1e24f242f2
Merge: 978685e6e cad0006cc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 24 08:42:05 2009 +0100

    merge bug21670 into default

commit 4e5be6475404c8a5a799b8edd9faba971b3be245
Merge: 1db8635cc 978685e6e
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Sep 24 08:20:43 2009 +0100

    Merged default

commit cad0006cc066fd08a56d98a2a01124bba5a0fa3b
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Sep 24 08:14:08 2009 +0100

    Removed redundant -s rabbit from the startup args in Makefile

commit 978685e6e075a102776fb3a1cd799ea2a48024cc
Merge: 14b0e58a2 a1403421e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 24 06:53:28 2009 +0100

    merge bug21023 into default

commit a1403421e3306dc253ddf6737dfc73a068fd0ed2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 24 06:52:47 2009 +0100

    cosmetic

commit d98def54f39380e5bab33fde78cd863e436c7830
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 24 00:29:29 2009 +0100

    get rid of message attriburs in msg_store and msg_file

commit 3ac34b2a2765d359f946e37ec42c06c11411b106
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 19:01:31 2009 +0100

    replace msg_store:attrs with contains
    This is a step on the path to getting rid of message attributes in msg_store.
    
    msg_store:attrs was only being used in disk_queue:prune, to detect
    when the store contained a non-persistent message and remove that
    message from the store and the rabbit_disk_queue table.
    
    Now rabbit_disk_queue records contain an IsPersistent flag. By making
    the msg count delta generator pay attention to that flag we trim
    non-persistent messages from the store during its initialisation,
    disk_queue:prune no longer needs to remove messages from the store, it
    just needs to remove all messages from the rabbit_disk_queue table
    which are no longer referenced by the store - hence the new
    msg_store:contains function.
    
    Keeping the IsPersistent flag in the rabbit_disk_queue table is
    sub-optimal since it means we store it once per message reference
    rather than just once per message. That's a small price to pay though
    for the cleaner interaction between the disk_queue and msg_store, and
    the opportunity to remove the notion of message attributes from
    msg_store altogether.
    
    Populating the new field in rabbit_disk_queue is straightforward in
    most places except disk_queue:tx_commit. That used to just be given
    {MsgId, IsDelivered} tuples, so I had to change the API to {MsgId,
    IsDelivered, IsPersistent} tuples.

commit 94b28a4fbb2e232c980e3892cba35348afbb5bf1
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 23 18:27:31 2009 +0100

    comment for create-plt make target

commit 71f7201c5958142b9bcfce82eb1857b31112810f
Merge: ba07a491d b674fa169
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 16:05:54 2009 +0100

    merge heads

commit ba07a491d6a199722e536c6bef2c5b5526b91c01
Merge: 57f3b795d 7b3b37ff9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 15:59:44 2009 +0100

    merge heads

commit b674fa169820c5719d68acbb587f63e3b9502bce
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 15:54:31 2009 +0100

    compact (well, delete, actually) files with no valid messages

commit 7b3b37ff9c065845f120962036ef9b063abd02d6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 15:35:47 2009 +0100

    on startup, compact files from which we removed unreferenced messages

commit 57f3b795d931899c8a1da7314d08bb3f0070691f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 15:33:05 2009 +0100

    english is better

commit 201a9d85e0d434f19de946625c9036e81d7f8d24
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 15:23:16 2009 +0100

    inverting previous changeset...

commit b50bd5a58457eeaf0ea9b24b12c9607912018013
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 15:11:48 2009 +0100

    overload open_file so it can cope with filenumbers and names, plus associated minor refactorings

commit 14b0e58a217c93eb5334eb9b2694c055bc828877
Merge: 46bb73b94 9fbaa79e8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Sep 23 14:50:06 2009 +0100

    merged bug21285 into default

commit 9fbaa79e8caf25d74a3ffe15f218fca97e105b46
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 23 14:31:30 2009 +0100

    removing rabbit_misc:absolute_path

commit 4dc5390b52acf2a32403cadc3b553b39b5b40f1b
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 23 13:58:05 2009 +0100

    broker now prints the location of rabbit.app on startup

commit 354602a6583f6f03a7ae1e3b19fd9ae322381858
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 23 13:26:31 2009 +0100

    Made sure the magic marker message cannot be produced by a client by forcing the guid to be the empty binary

commit de02ebf5d71fcd363c48dc2d19c53a8331f8082d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 12:42:18 2009 +0100

    rename load_messages to build_index
    since that's what it does
    plus some minor cosmetic changes

commit 97fcedd1cd8d5946eb68b18311eb2aa3d37c4769
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 12:00:05 2009 +0100

    remove verify_messages_referenced check
    This can actually fail, e.g. when a message got ack'ed but the
    corresponding mnesia delete in dq hasn't been flushed yet.
    
    load_messages and the pruning in dq take care of this situation.

commit 49b6351e1b2c0733eb3313513d1009e207acfbee
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 23 11:43:59 2009 +0100

    get rid of message cache limit
    limiting the size of the message cache is pointless. Firstly, the ets
    memory info does not include binaries. Secondly, the cache is only
    holding onto messages which current queue processes are holding onto,
    so we are not actually leaking any memory, and the only cost is the
    cost of the cache entries themselves, which should be small.

commit ed8b9f138f30749a3e38600f46284a8408c8bb33
Merge: 2bb52b060 46bb73b94
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 16:49:00 2009 +0100

    merging from default

commit 2bb52b060f3f0f8e0c645927bcf89f67780d27b7
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 16:41:50 2009 +0100

    getting rid of the .last_valid_dialysis approach; better erlang termination on failed dialysis

commit a3e0f937bf85c5979e5883216e4be4a441e503ed
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 22 15:58:06 2009 +0100

    refactoring: get rid of MnesiaDelete flag to remove_messages

commit 6fc762e673896d9a80c4c41f20a9373e77cc22c4
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 14:59:30 2009 +0100

    using ?= operator

commit eb99746359fbe4591fceb0d8b5b80f4cece1e2bf
Merge: 16f901964 46bb73b94
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 14:55:12 2009 +0100

    merging from default

commit f83fd775aa396088172cf9641f14fb8f3b39e32b
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 13:45:10 2009 +0100

    renaming expl to explanation in #amqp_error{}

commit 46bb73b94cfb4bb044096ae75ec5234c46ada561
Merge: 83f43ca27 e318fdcfd
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 13:17:01 2009 +0100

    merging bug21650 into default

commit 83f43ca2754cd1fb9a2359fd118421370cfc0e8a
Merge: f9823d110 d2808d93e
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 11:34:12 2009 +0100

    merging bug21560 into default

commit f9823d110749b54f1b4352f91afadf85fc704781
Merge: fca497ded 222db8dfc
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 11:24:00 2009 +0100

    merging two defaults

commit 222db8dfce66987c6fb3c306953587dc7c9cb555
Merge: b56db4780 aafc8c970
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 22 10:56:14 2009 +0100

    merging bug21644 into default

commit fca497ded39b788b9d2d4acda1b9a89339be77b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 22 10:55:57 2009 +0100

    remove extra_startup_steps from app config
    This should have been done as part of bug17880.

commit eb1661f17f036daa9d025d1eb96b7590297d5369
Merge: b56db4780 61211d6e2
Author: David Wragg <dpw@lshift.net>
Date:   Tue Sep 22 10:55:24 2009 +0100

    Merge bug21649 into default

commit b573cde7ceee9b1eba416a11aa3087aafcacd1d0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 22 07:53:16 2009 +0100

    do not call msg_store:attrs/2 from disk_queue:{phantom_fetch,prefetch}
    It turns out that we don't actually need the 'persistent'
    attribute. So this saves us a potentially expensive interaction with
    the msg_store.

commit ff4c2ad5c0f6879c4e3a0818600e1252424000b5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 22 05:26:16 2009 +0100

    fix typo

commit 2b282d9ec280bd1f964a0b8d20b186961b9d3f5e
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 09:49:01 2009 +0100

    Added ability to provide configuration file to windows server startup too

commit 05cb961868b813878585eab8cc79b235431a185d
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 09:28:46 2009 +0100

    Added facility to provide a configuration file to rabbit startup for Unix systems

commit d2808d93ec1ebf17217289777d85ac3494dc2c1d
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 09:18:03 2009 +0100

    Corrected behaviour of run-node so the boot file is not used

commit 1db8635ccb9e12af63e23459f6d3188c751b2448
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 08:59:39 2009 +0100

    Added deactivate plugins wrapper in RPM packages

commit 8d06d02b30ed0564a12bd6ba0a1f5f1822f73d2f
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 08:55:48 2009 +0100

    Added rabbitmq-deactivate-plugins to output package

commit cb790cd51f867541481533d4b46a3132db5ef738
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 08:44:49 2009 +0100

    Added unix and windows variants of deactivate plugins script; initial packaging changes

commit b56db4780b1e3979ce4155f5aabe7d4ab19ce499
Merge: a65aac4bb 4de0062ea
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 21 08:30:14 2009 +0100

    merge bug21643 into default

commit a65aac4bb26169b1277ef29f147f4435fb105c52
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 21 08:22:59 2009 +0100

    include channel# in unknown_frame error

commit 4de0062ea6f12152e1db00373c1773d38109457f
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Sep 21 08:21:34 2009 +0100

    Removed unused .boot generation target; added rabbit.rel to list of files removed on clean

commit e318fdcfd257f5e5700566d7e5de61400c5a848a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 21 08:19:07 2009 +0100

    get rid of closing_chpid process dict entries
    They were entirely redundant.
    It is now the case the the chpid process dict entries only get removed
    when receiving an EXIT signal from a channel, which is more obviously
    correct.

commit a07c9407289e4ae99ae919c36e7dd1afe731632a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 21 07:24:38 2009 +0100

    do not time out waitng for channel.close_ok, wait forever instead
    This is to prevent the following observable protocol violation:
    C->S: 1:channel.open
    S->C: 1:channel.open_ok
    C->S: 1:some command that triggers a channel close
    S->C: 1:channel.close
    (client waits for longer than server close_ok timeout)
    C->S: 1:channel.open
    S->C: 1:channel.open_ok
    
    The second channel.open should have been ignored by the server, and it
    should not have returned a channel.open_ok.

commit 11a829e5e72de0ac766ecbcf3ede2ef4a0307cd6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Sep 19 05:47:05 2009 +0100

    minor, mostly cosmetic, tweaks

commit d62825381b55505912f8750e3df9615c4e5ee134
Merge: 0a4693288 5ed1782ed
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Sep 19 05:05:05 2009 +0100

    merge default into bug20399

commit 61211d6e24c891b4305fb4c822138d24871eb943
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 14:17:49 2009 +0100

    Escape *all* the double-quotes in an arg, not just the first one.

commit 5ed1782eda1ef139a807cbce2a99af44eefe3835
Merge: 79b4481a8 a95080fdf
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 14:09:30 2009 +0100

    merge bug21346 into default

commit a95080fdfe8a7d2fdbf25fba6654abc77fd1d2ba
Merge: 218f55288 79b4481a8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 13:05:47 2009 +0100

    merge default into bug21346

commit 79b4481a858020c2486f5b561b63d427c61bcf35
Merge: c0200cb4a 19ab55907
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 12:56:33 2009 +0100

    merge bug21596 into default

commit 19ab5590797d1d37dddbe4449ce2f17cd4405387
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 12:55:21 2009 +0100

    Escape atoms as lists and binaries are.

commit 08e35ea4e7d9566ee046a16d8621e92b278d2562
Merge: 0987dd424 c0200cb4a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Sep 18 12:49:00 2009 +0100

    merge default into bug21596

commit c0200cb4a37d2365a64bc4147da3ce81bd14da62
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 18 06:12:26 2009 +0100

    fix .hgignore regexps

commit aafc8c970e2ecc90595c722c459534d02f194bf9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 18 06:08:44 2009 +0100

    handle timeouts in cpu_sup:avg1 gracefully
    Also, it turns out that the load avg is an int, not a float

commit 30fdbff09d12a4806ccaf7ef536a42261e50d09b
Merge: 5d2bd7561 037c7ef39
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 17 22:40:19 2009 +0100

    merge bug21470 into default

commit 037c7ef39218761d6ffdf8468d07ceba303c7a77
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 17 22:26:30 2009 +0100

    small simplification

commit 7822716acc2eb85a39e678055bfbb228df6df10e
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Sep 17 14:06:29 2009 +0100

    a little refactoring; fixing case patterns order

commit c3506174699605119db4ddd7e3ec32188f1cda44
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Sep 17 13:49:11 2009 +0100

    changing back a few usages of proplists:* to lists:key*; changing usages of proplists:lookup to proplists:get_value

commit 0a4693288fcb86d5f2e6bfc3a61383974aba6d3f
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Sep 17 12:49:15 2009 +0100

    using #amqp_error{} instead of {amqp, ...}

commit 9c2b418f410abc8886a5e994557cd22df3edf751
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 16 15:55:42 2009 +0100

    changing uses of lists:key* functions to proplists:*, where the key is of type atom(); changing parse_status to is_rabbit_running in rabbit_multi

commit 44b553f111c613b76ff21f372ff919bf7514435d
Author: Marek Majkowski <majek@lshift.net>
Date:   Wed Sep 16 14:42:17 2009 +0100

    new memsup code

commit 16f90196497b609743987c67bbbfb2e1fc7f338d
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 15 19:29:56 2009 +0100

    wrapping some makefile vars in ifndef's

commit 9eed4fd8995a84ddce55dde604bd004a52851ffc
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 15 13:18:59 2009 +0100

    fixing basic.plt dependencies

commit 5d2bd75617efc5b70a96650b4b9cf93fe51224c2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 15 10:05:51 2009 +0100

    fixed unused var warning

commit 5fa1eda0d38250162e7759104d1a3d2eff8791cd
Merge: a02a114ca 41872a474
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 15 10:00:37 2009 +0100

    merge bug21529 into default

commit 0987dd424bc04a7f986ee5cc8ab399f646554c72
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 14 19:15:27 2009 +0100

    updating rabbitmqctl.1.pod

commit ad23d6076e206051dbdb3845ae752868623fb39c
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 14 18:06:42 2009 +0100

    updating comment on list_connections in rabbit_control

commit d2cd0afd5ec41f8696d44dd52bf6f0b59d4e46da
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 14 16:10:21 2009 +0100

    using '' instead of '$none' for undefined username, printing nothing for undefined username; adding state to the default list for list_connections in rabbit_control

commit a02a114ca9e1e5604503809bc7c4a8f32dbbf2de
Merge: d15cc2d71 8a3e49ba8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Sep 14 15:55:06 2009 +0100

    merge bug21583 into default

commit 41872a474b511d3749f888d0b6369666aa9eed44
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Sep 14 15:29:27 2009 +0100

    fixed R12 incompatibility in gen_server2

commit 93742a0b3633f26811f9827de5c0eb9b15dd9c03
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 14 13:51:05 2009 +0100

    displaying (none) for '$none' atoms in rabbit_control; changing value for undefined usernames to '$none', not to confuse with none username

commit 16372db61549aab660f49b7fb86a58b20bbe0ac6
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Mon Sep 14 12:48:49 2009 +0100

    replacing ERL_DIALYZER with ERL_EBIN in makefile

commit 2466bbbc7794f91a7aea670e54bc2afe57140cd3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 10 03:41:03 2009 +0100

    drop disk_queue/msg_store disk_only mode
    and all the mode switching and memory management logic that goes with it.
    
    The 2G limitition of dets make the disk_only mode not worthwhile.
    
    In the process I refactored the msg_location access in msg_store
    s.t. it shouldn't be much effort to plug in a different index store in
    the future.
    
    Also some minor tweaks and tidying up here and there.

commit eeb480d1e5d8fec0d98196f4332d115fa5c98c2a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 10 00:04:14 2009 +0100

    initialise msg_store ref counts via a generator
    This is more flexible than the previous ref_count function, allowing
    the ref counts to be obtained w/o consuming any memory at the
    supplying end in a variety of scenarios.
    
    We use the dq_msg_loc ets/dets table to store the ref counts. That
    table is later updated with the full details of the messages (their
    file and position, etc). At the end we prune any entries that have a
    ref count but no associated file - i.e. the referenced message
    couldn't be found on disk.
    
    This change should also fix the "All replicas on diskfull nodes are
    not active yet" error observed in bug 21530 since we no longer need
    the indices on the rabbit_disk_queue mnesia table which we identified
    as the most likely cause of that error.

commit 2f6b4e661dd6ed3ae3f942fc337891a4bef1c402
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 9 15:12:29 2009 +0100

    fixing dependencies in dialyzer-related make targets

commit 6c55a1516d8a98106d5b55408c67ecff0ce6ac98
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 9 13:48:07 2009 +0100

    fixing compatibility with latest dialyzer

commit cd6aed9e02dd24c59a4ddd62184ee7b0e290622c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 8 15:26:54 2009 +0100

    refer to files by their number not their name
    This makes matching faster and keeps record sizes smaller. It also
    means we can get rid of one bit of state.

commit 4c56adbe121efad7803bf33b3a713abfd35bcdca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 8 14:01:28 2009 +0100

    minor tidying up: use symbolic record indices instead of numeric ones

commit 564fd500cd7bf64009bec118fd235883e983a115
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 8 13:21:49 2009 +0100

    api tweak: pass durable queues in list rather than set
    lists are more pleasant than sets in APIs, plus in our use we have a
    list to start with.

commit f7aaa4f2423f05cadaa1c04a9fe684bedfd29b16
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 8 11:18:26 2009 +0100

    change guid to a binary, using the md5 of term_to_binary
    The main motivation is to reduce the memory and on-disk footprint of
    the guid from ~34 bytes to 16. But it turns out that this actually
    results in a speed improvement of a few percent as well, even for
    non-persistent messaging, presumably due to the memory management
    effects and the fact that 16 byte binaries are easier to copy between
    processes than the deep(ish) original guid structure.

commit 6d89e86148174f2abc8a83ddb71555c498a25a16
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 17:41:13 2009 +0100

    refactoring: move dets/ets match into sort_msg_locations_by_offset

commit 8a3e49ba84425dd57c5693e027378424da0a7706
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 17:12:53 2009 +0100

    oops

commit 089c379b017ea263fee44a20975eb0d66650be5b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 17:02:45 2009 +0100

    don't attempt rollbacks on non-tx channels

commit 6ce99b7c6ff4707b1fb6f7d87dba932eafd50e8e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 16:48:55 2009 +0100

    rename prune_mnesia to prune
    since we prune more than just mnesia

commit bead512b293b379732ad698bad8013d9028534fd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 09:44:39 2009 +0100

    shut up dialyzer

commit 9b8b9efce232aaf7839fcfa3e2847f58b4b0647c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 08:05:46 2009 +0100

    refactoring of delete_empty_files
    giving it a name that describes what it does, and extracting recursion
    vestiges into caller.

commit 28f974ef79de8a52d50a8441300c2b09082c14dd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 07:43:59 2009 +0100

    generalise persistent flag to message attributes in rabbit_msg_store
    This is just a renaming exercise, but it turns rabbit_msg_store into
    a general purpose message store.

commit 47fd8d8869ec5710e38d00905f5528909b11c75e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 07:22:14 2009 +0100

    generalise persistent flag to message attributes in rabbit_msg_file

commit 65da253fc1703c39948bec6e388659809cf1bc54
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 06:22:08 2009 +0100

    resolve msg_id type confusion
    rabbit_mixed_queue and rabbit_disk_queue see guids, not non_neg_integers.

commit 5ec33189ebe4137ec8d5f4a60c0af69c6bc249da
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 06:00:54 2009 +0100

    perform term/binary conversion of msg body in rabbit_msg_file
    thus further generalising rabbit_msg_file

commit d33ca7441695703d2c9922fa4862bb00dad8bd85
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 7 05:07:53 2009 +0100

    do not return body size from rabbit_msg_file:read
    it's not used anywhere and was cluttering the api
    Also, make type sigs more meaningful and do not include rabbit.hrl,
    thus underlining the general nature of this module.

commit 9d3dc5a14236a709387c6036c11dae58901b043e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Sep 6 23:12:45 2009 +0100

    big refactoring: extract msg_store from disk_queue
    The msg_store knows nothing about queues, or message structure.

commit 1ec76ab881dda86c30314c100c95a44d0e7b0f46
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Sep 4 17:45:48 2009 +0100

    rabbitmqctl now accepts -nodename

commit 6d69f8ef184fb31e4cf790b3cea0e2cdb32b640e
Merge: 7dea2c144 d15cc2d71
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Thu Sep 3 15:41:24 2009 +0100

    merging from default

commit eff425bbce70399ea9078e4e562deeb004300e2d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 3 15:10:44 2009 +0100

    rename #file_summary_entry to #file_summary
    to match what we call the containing table

commit 82bad5e71fafb91fba327cc1699df763b07ce24e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 3 15:03:31 2009 +0100

    rename #message_store_entry to #msg_location
    to match what we call the containing table

commit e32ffbe4f0e0de4aa8071e5f074117b963684f29
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 14:33:37 2009 +0100

    Switched to using a file to hold the disk_only data. Also found a bug where vaporise was wiping out the disk_only data (both as a file, and when it was in mnesia). The result was that if the dq was in disk_only mode before being vaporised, it would refuse to start up again. Thus vaporise now pushes the queue back to ram_disk mode if necessary, after wiping out the contents of the mnesia table. Finally, all tests pass again.

commit ed467dd9d88c219f74fa1736a94623c680f92785
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 14:03:31 2009 +0100

    the disk queue sometimes needs much longer to shut down safely if it's heavily loaded - up the limit to 5 seconds. However, I suspect something like 60 seconds is more likely to be realistic value

commit 856b57c545cba8fdce350d71678cb2ce9b4dcb02
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 14:02:42 2009 +0100

    use a record in file summary

commit 93780fd09e67d8375853e0bf60eb88a371e05f63
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 11:55:53 2009 +0100

    ensure that we fsync after copying messages across during compaction

commit c3d1000a4db4a6148715ccb795306d98bc8923e9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 11:45:49 2009 +0100

    commented on purpose of cache

commit e51355478f8ae924cc6df1dc021790b67601fc1e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Sep 3 11:39:10 2009 +0100

    sort files for compaction numerically

commit 7dea2c144ae932be118991a2c53a2fae5b134a56
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 2 20:53:08 2009 +0100

    nicer rabbit_dialyzer:otp_apps_dependencies_paths

commit b8e53c7e60b6b9b7da9154f051f6ee74dd386c78
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 2 20:01:38 2009 +0100

    moving dialyzer stuff to src/rabbit_dialyzer.erl

commit f21402056a977af1a8b33938597d3d89e72c7313
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 17:51:21 2009 +0100

    Guarantee that any oppressed process reporting 0 memory use will get liberated.

commit c5bfb74c942e004fbb33137b4ebc1deebbd7396d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 17:34:26 2009 +0100

    Made the disk queue start up in the same mode it was last running in.
    
    This is slightly grim because I have to store some values in the mnesia table which then have to survive all the start up logic, so there are a couple of annoying 1-line changes elsewhere. However, it does indeed work.
    
    There was also one bool() -> boolean() fix in the memory_manager.

commit 198349ed4d2f06f98ba0bda1e05e183548b3e52b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 16:34:24 2009 +0100

    factor out sublist and disjoint tests

commit 6d3330e7e4f0a0f4c5df8fdce946cb5ddf60f6dc
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Sep 2 16:15:01 2009 +0100

    basic.plt created via erlang shell; fixing create_plt make target name

commit f0daa43f6f09711186e3cd21ba6c74d6f2e2926f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 16:00:18 2009 +0100

    Shutdown III: Inline Vaporisation

commit ad16306f66de365f14afeb18605ae5a9985e9c9a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 15:20:35 2009 +0100

    another attempt at stop/terminate/vaporisation/shutdown/suicide/deathsquad

commit 3eedbafc20c3a465fb9a289385ac62a0f0f92148
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 15:12:58 2009 +0100

    renaming of variables.

commit 1ce4547796a1a5c9689853f4982d09a8b2437e12
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 15:00:45 2009 +0100

    A couple of cosmetics - grab_msg_id went away, but tidied up terminate and vaporise - hopefully sufficiently that both Matthias and I are happy with the result\000

commit c3aa97272cd0667c378559cab177ed873799a746
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 14:10:41 2009 +0100

    made dq:delete_queue a call, not a cast. This eliminates a race condition between queues being deleted and new queues with the same name being created and published to

commit 0c7017a36e2ee6d522b88a8b6a9777f2ca44173e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 13:38:46 2009 +0100

    Fixed the mistake Matthias spotted in recovery from crash (comment #211). Tested by deliberately breaking the compaction in a variety of ways and then coverage and startup and ensuring the correct code paths are taken.

commit 88a24812eefde667fa1b16aa963b8706810fd6cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Sep 2 11:09:29 2009 +0100

    made type signatures almost as useful as comments

commit 5f06c3f77569736c3dcb426b1d2a6be9ef9cf685
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 23:40:44 2009 +0100

    refactoring of (no)reply1 to eliminate duplication

commit 387533145bbd4e95b46f6bb7e50cde4855bfdeab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 23:30:44 2009 +0100

    specs for msg_file

commit c97b00e17c066e41256569486d0b7902c766dce5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 23:22:21 2009 +0100

    specs for rabbit_file_handle_cache

commit d15cc2d713ff3eaf4c52379ad40bbff7036523f0
Merge: e0c502266 3e32eb614
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 1 17:16:44 2009 +0100

    merging bug17880 into default

commit 0955d135f4dfda3e64d177080eeb12f2a94e21be
Author: David Wragg <dpw@lshift.net>
Date:   Tue Sep 1 17:15:15 2009 +0100

    Don't 'chkconfig --del rabbitmq-server' when upgrading.
    
    This would disable the service even after the sysadmin has decided to
    enable it at cetain runlevels.  Since this 'chkconfig --del' only
    happens during an upgrade, and is always followed by a 'chkconfig
    --add' anyway during %post, removing it should be safe.

commit 65ddcb3da8bdab5ac2a676650cdaadeb04335224
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 1 16:43:39 2009 +0100

    checking if required applications exist in specified ERL_HOME

commit 32330a3c23276a77d6ecc89450191c534d344923
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 1 16:14:42 2009 +0100

    nicer enumeration of otp applications rabbit depends on

commit a6238f41cf1a96e8d1ee995b42222525eb201e81
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 16:13:05 2009 +0100

    The multiplier for the memory thresholds should not be on the number of available tokes. In extremis, when available tokens is 0, this makes queues very likely to switch mode (bad, memory is tight), and when there are lots of tokens available, this makes queues less likely to switch mode (bad, memory is plentiful). Instead, we should be using constant offsets, based on the total number of tokens in the system.

commit 1d931a1f5deb943076d8da3c3e0f357d716a6caa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 15:48:31 2009 +0100

    comments on magic 2.5 scaling of memory report, and removal of unnecessary initial calls to report_memory

commit d4848d68012418c78c39fdbfc4a5bf38588c7501
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 15:47:19 2009 +0100

    Before the magic_marker_msg was introduced, if the queue was entirely on disk already and was then told to go to disk_only mode, it would form a single requeue_next_n call, where the N would be the length of the queue. This would be detected by the disk_queue and become a no-op. Because of the introduction of the magic_marker_msg, that is no longer possible - we want the marker to go from the back of the queue to the front. As such, the N will at most be 1 less than the queue length, causing unnecessary work to be done.
    
    This patch removes unnecessary work by observing that we do not need to rotate the entire queue should we find that the queue consists of zero or more disk-stored msgs followed by zero or more ram-only stored messages. If this is the case, we only need to publish the latter ram-only messages, and have no need for the magic marker msgs at all. Furthermore, if there are no ram-only messages we have no work to do at all. The only situation in which we must rotate the entire queue is when we have ram-only messages followed by disk messages. In this case, we have to get the ram-only messages onto the disk queue before the disk messages, which requires the full rotation.

commit 74018f6feadbf3dcf79207e31a2d32a56475f598
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Tue Sep 1 15:40:12 2009 +0100

    improved dialysis

commit 590800c2b2711c79cc87981afc67b7f6d903532d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Sep 1 12:09:33 2009 +0100

    Read through all of Matthias changes, no problems. In here, one cosmetic, and one change so that rmf:read returns the MsgId off disk to be later matched. This is purely defensive.

commit 8a5b3cdf7c705d3e8194af0ac32c52e2a9780db5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 11:15:16 2009 +0100

    refactoring: move all the low level message file i/o into a separate module
    The details of how messages are encoded in files are opaque to disk_queue.

commit 6b3c6014ef7164638dd1658d8251271716163291
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 11:11:41 2009 +0100

    remove unused constant
    This was added in revision b48919ed4e12 for no apparent reason

commit e30eba75c782f5b6340fd7ebae835665cd336ea9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 10:32:42 2009 +0100

    banish ?FILE_PACKING_ADJUSTMENT from all but three functions
    The details of the message packing are opaque to high level code, as
    they should be. The TotalSize that code sees now is the total size of
    the message on disk, including all packing adjustments, which is all
    that is ever needed to perform all the necessary file positioning etc
    at that level.

commit ef2d908ab3b26aea0e832aa7197c877d93ff52e7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 08:30:03 2009 +0100

    cosmetic

commit dcb7e53ca45e2beda8feb11d4a1f22db2a7a3d2e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 08:28:46 2009 +0100

    cosmetic - mostly whitespace shuffling

commit 0b813e6894057ef593e031feec2cf65816f1d649
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 08:13:26 2009 +0100

    refactoring: rename non-sensical read_file_hc_cache to read_file_handle_cache

commit 0ef90a2e386c3e7618cf91eb3b6c75dd3009113a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 08:07:41 2009 +0100

    refactoring: (re)introduce {ok, ...} return on open_file
    This allows us to replace the last remaining file:open with open_file.
    Also, extract binary mode settings and use them in both open_file and
    fh cache creation.

commit 4a97d65c4b579860f1bac169ee95b301ee9f8cc1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:32:53 2009 +0100

    cosmetic: remove whitespace

commit 65434dd47400e1170b814a199d8e7984f6d4adc2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:20:22 2009 +0100

    Other is KO
    accidentally changed in previous commit

commit ea9bfffbead3196dabe20e418a9718f8ffb1eb3b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:15:29 2009 +0100

    refactoring: extract reading of stop byte

commit 6940bbae66d15d7d1844dbbfbb32dfdcefb619a0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:14:39 2009 +0100

    cosmetic

commit 3f2b5e0385dcf3bc6eb6bae0ec45bcd1cad5f8b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:13:51 2009 +0100

    cosmetic

commit dcafc316efe0148b2aeb3eea62ae03f0ceef688c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:13:18 2009 +0100

    refactoring: simplify match in read_next_file_entry
    this is equivalent since the read entities are unsigned

commit 118b4e381e592088e83cf3397efe18febdec6ad2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:10:38 2009 +0100

    refactoring: eliminate code duplication in read_message_from_disk

commit 40cece9560359da9e268c4111d357134520ae1b5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 29 07:09:26 2009 +0100

    refactoring: extract file opening, and simplify file:position calls

commit f74e8dfd75f9f4b1859b7de8eb21666ecbd4bf3d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 20:25:07 2009 +0100

    refactor: pull msg_location_dets filename construction into separate fun

commit b96bcd7d3dccd320bd2a6b4023495ca53b7c6092
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 18:32:46 2009 +0100

    cosmetic changes to shutdown marker code
    move it to the right place
    reorganise constants section

commit a30c1802f985ccfc14aafe568df8e00bd792ab85
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 17:58:10 2009 +0100

    Use an mnesia transaction to record safely shutting down, and associated wiring on startup. Manually verified this all works.

commit 3e32eb614d61b2fbaa0301250c82280c71b6f4a7
Merge: e7a42e3e5 e0c502266
Author: Paul Jones <paulj@lshift.net>
Date:   Fri Aug 28 15:40:18 2009 +0100

    Merged default into bug17880

commit cdf508e5815e290c836bb60a4f6d8b235a8f69c9
Merge: 2391849da b95a5d7b8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 15:26:56 2009 +0100

    sigh, merge

commit 2391849dacc3ca253502f7afe4a2fe341a46266c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 15:22:59 2009 +0100

    minor refactorings

commit b95a5d7b8dd887905270537296fedf4c741ef18b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 15:15:28 2009 +0100

    cosmetic - visual separation of sections

commit c3638834b1d6b4bd706686860b1dcde6af54a954
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 15:13:00 2009 +0100

    dq: revert the table change to earlier on, so that recovery isn't as horrendously slow. amqq_proc: correct order of actions in delete_queue and document.

commit 4bb858953e0ab08cf9721b90b521ed50c19b65c8
Merge: b9ac94e8f ca2cdcefc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 15:01:18 2009 +0100

    more merging

commit b9ac94e8f1370488fdf570c2e04e4db3e9af0b39
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 15:00:58 2009 +0100

    superdooper. Recovery from crashes mid compaction tested, corrected, working.

commit ca2cdcefc6a1b746a16449d5a461077da74dbb1c
Merge: 5e94e9276 8b1d8f2b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 13:54:49 2009 +0100

    merge heads

commit 5e94e927664a88c828bec8ac9d8af65f24d2a937
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 13:53:29 2009 +0100

    minor refactoring
    make it more obvious that ReqRem will always end up being <= 0

commit 8b1d8f2b093ee4d76a0e18371befb1b4fe6d795d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 13:07:41 2009 +0100

    cosmetic

commit 827ebdeac9073462f405825d3aa4c798121d5062
Merge: 85c7dd830 d6bfe2c30
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 12:49:29 2009 +0100

    merge heads - gratuitous shuffling

commit 85c7dd830e8a30e7b0b4c52889a896691e9b2fd1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 12:48:56 2009 +0100

    cosmetics - documentation

commit d6bfe2c30e41c89ea02e899c7313bd5bae8e270f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 12:48:06 2009 +0100

    cosmetic: move things around

commit 550f8691838add69c5dd6b8138f883377ce01d22
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 12:44:35 2009 +0100

    cosmetics - formatting

commit 3ecb7479e4adabc75717b68bbe866bd93ac14ecf
Merge: 676fcdb73 10a8c5ccb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 12:33:56 2009 +0100

    merging heads

commit 676fcdb73331c1e55ac3c446685aaac3c5ddf676
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 12:31:33 2009 +0100

    Changes to memory_manager. Watch for change in overall amount of free tokens, not requested amount

commit 10a8c5ccb89aa63fe229d3a559ec1f869a0d98a7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 12:11:31 2009 +0100

    reference bug21489

commit 7a5b7c2cf7e7acc41ce464486cfbdc24ba08a5d0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 28 11:15:22 2009 +0100

    cosmetic

commit 0f4b03a21ee3c838c3a6fe18326815bcab55883f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 05:21:03 2009 +0100

    less noisy startup

commit 8b4a191b64db2d0de4d5cc19a9aecd337e0e5441
Merge: 1e4be9b81 e0c502266
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 05:00:23 2009 +0100

    merge default into bug21368

commit e0c502266bdb5f0e7d6de05cae0a731c76983bc0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 28 04:52:49 2009 +0100

    slight resequencing of core process startup
    - perform crucial check a bit earlier
    - start memory alarms as early as possible

commit 1e4be9b8114a89fc8fb88b5eac349fc6575dacc2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 23:44:39 2009 +0100

    Lots of things:
    1) disk_queue: remove prealloc - fs's that support holes do it really fast and it buys us nothing. fs's that don't support holes get crippled.
    2) disk_queue: make sure we fsync before closing. This is crucial. Posix is perfectly happy to close without flushing data to disk.
    3) disk_queue: bug in recover from crash during compaction (*still* not tested), where we were opening with just write, not read+write, hence would have stomped over existing content.
    4) memory manager: track oppressed processes and only liberate if they're reporting a memory usage 5% different from what they last had.
    5) minor cosmetics to amqqueue_process.
    6) start up guid earlier. Necessary because it is actually needed in recovery of queues.
    
    I'm not happy with memory manager, but am utterly knackered and need to sleep. All tests pass.

commit 7e4f744b0ec187118ad44c5f22d5b47f3e2d030f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 20:23:36 2009 +0100

    Hacked out the lowrate stuff from memory_manager, and associated adjustments elsewhere.

commit ba313c56dc92b226d9ad84c783c681e7ae31873d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 27 19:20:23 2009 +0100

    cosmetic

commit a5ed9ac81b002018fd55a3aee5974223234aaf55
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 18:32:09 2009 +0100

    cosmetics

commit 210835025b0c98ec313cd33731bc29ec6acbe609
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 18:12:12 2009 +0100

    All QA comments relating to queue_mode_manager

commit c6ad55e7e6096ed2d5f2b1043b4dedc33317c432
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 16:06:39 2009 +0100

    cosmetics

commit d8896bb2e4c1de2098d6fae051ccb93e6ec96926
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 15:56:36 2009 +0100

    QA-corrections to prefetcher.

commit 063305f12676de3c94c9bf5323777892be517d19
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 15:21:50 2009 +0100

    filesync is unnecessary because tx_commit really is synchronous.

commit 49c93fc7abdb776c6d59f8b01b72860958628872
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 12:25:17 2009 +0100

    cosmetic

commit 452ec5b61e50506aa44047fdea0701547726ba68
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 12:22:02 2009 +0100

    cosmetic - MarkerCount => MarkerPreludeCount

commit 9621889821c49e51e44f6298eeea10767f2825a5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 12:07:56 2009 +0100

    documentation

commit 5fc13e26ff8a1a0b5dbacec2aa19326fbbd8cd1f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 11:55:09 2009 +0100

    Reworked handle_ch_down so that we detect early whether or not we should auto_delete the queue and only do rollback and requeue if we know that the queue isn't going to be deleted. ALSO minor refactoring in MQ with magic_marker

commit 9577456310849f81d03ac7be111879bb40f8373a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 11:11:18 2009 +0100

    and of course the run length encoding should not include the marker message.

commit 6ac9ab5f7d6ae13b1aacca6e26f92429bcd2e024
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 11:08:43 2009 +0100

    Tiny cosmetic, but also, we shouldn't include the size of the marker message in the inital size calculation.

commit a12101207fd9b8a33e4d25f6edf9ce92df235a39
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 27 11:03:22 2009 +0100

    As Matthias spotted, if we crash in the middle of a mixed -> disk transition then we potentially have messages in the wrong order.
    To fix this, we push a marker message into the queue before the transition. When the transition completes, we find that that marker message is at the head of the queue. If we are unlucky enough to crash during the transition then on recovery, we have to foldl through the entire queue anyway, so we keep our eyes open for the marker message, and should we see it, we simply move all that is before the marker message to the end of the queue, and then remove the marker. By avoiding putting any numbers into the queue, we neatly sidestep the issue of the disk_queue deleting all non-persistent messages on startup.
    
    This has been tested by merging into 21444, then, erlang client:
    α> Conn = amqp_connection:start_network(#amqp_params{}), Chan = amqp_connection:open_channel(Conn).
    β> [begin Q1 = list_to_binary(integer_to_list(R)), #'queue.declare_ok'{queue = Q1} = amqp_channel:call(Chan, #'queue.declare'{queue=Q1, durable=true}) end || R <- lists:seq(1,100) ].
    γ> [begin Q1 = list_to_binary(integer_to_list(R)), ok = amqp_channel:call(Chan, #'basic.publish'{routing_key = Q1}, #amqp_msg{props = (amqp_util:basic_properties())#'P_basic'{delivery_mode=2}, payload = << 0 : 1024 >>}), ok = amqp_channel:call(Chan, #'basic.publish'{routing_key = Q1}, #amqp_msg{props = (amqp_util:basic_properties()), payload = << 1 : 1024>>}) end || _ <- lists:seq(1,1000), R <- lists:seq(1,100) ].
    
    Then, when that lot's done, get hold of the pid of rabbit and prepare a kill -9 $rabbitpid
    δ) In another shell, do:
        for t in $(seq 1 100); do ./scripts/rabbitmqctl pin_queue_to_disk $t ; done
    ε) When you get to about 50, kill rabbit.
    ζ) Then start up with just make run-node
    η) In another shell make start-cover
    θ) In Rabbit's erlang shell rabbit:start().
    ι) When all started up, in the other shell make stop-cover.
    j) Check the lines hit in mixed_queue:init/2.

commit 1fba9f2f33d22bef23e485e8b16085b9115adf1f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 27 05:57:00 2009 +0100

    tiny bit of refactoring

commit 793f87097ab7c60ceaa955b362fc113b7e4b392a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 23:15:13 2009 +0100

    cosmetic

commit 2b6981ae3384b61882acb4ac49c4822153067b87
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 23:12:55 2009 +0100

    A comment and a small amount of refactoring. Nothing outrageously exciting.

commit 0c8dc46663459832ada1cf3bd4d2ea050cffca73
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 26 18:54:44 2009 +0100

    cosmetic: place functions in appropriate sections of the file

commit 20ee9f43ab02afd06774f2440d555d9ed4ba6662
Merge: b34e177a4 37115f1fb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 17:22:32 2009 +0100

    merge in from bug 19356

commit 37115f1fb84a15928d93504a36b00d51a0e2b917
Merge: df67e4daf b34e177a4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 16:34:19 2009 +0100

    merging in from default

commit 3b8c39f4114b1b28770a65886c182986c2d3dbdf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 16:19:21 2009 +0100

    cosmetic

commit d47e5236d78971aa323131c6f9f8498e6eaf0f46
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 16:18:23 2009 +0100

    cosmetic

commit 672fac1a7e5d76c74aa26a5659a15f87e0ee79f5
Merge: 1b9f4af11 b34e177a4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 16:14:37 2009 +0100

    merge in from default

commit 1b9f4af11f2ba425e71b01368afa7197a0ee6902
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 16:07:11 2009 +0100

    pushed the encoding of the properties into the binary_generator. Plus associated types and changes to MQ.

commit 65cb1da3f4fe3a018144b69c41832ecb55841906
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 15:52:11 2009 +0100

    cosmetic + assert major invariant of queue_process on reply and noreply

commit 10d0bc116137460a0890a052163916c7e70bb71a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 15:28:42 2009 +0100

    Removal of pointless calls to run_message_queue

commit 2bd0541ad102ec76334dbc7cdf1d414e182b363c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 15:01:58 2009 +0100

    made sure that messages that go through the MQ have binary properties added. This allows us to measure their size. The effect of this is that all messages that come out of the MQ have binary properties, even if they went in without. This might be controversial. The only reason for doing this is that otherwise, we'd have to convert-to-measure twice, once on the way in, and once on the way out. If people feel strongly about this, please yell.

commit b34e177a440396b6a3270c482c09a36861636eca
Merge: ae00b843d 341ddb922
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 26 14:20:01 2009 +0100

    Merged bug21493 into default

commit 610e4a3ec1dc35d00ca0f804665fcf2722715cdf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 14:07:36 2009 +0100

    cosmetic

commit 80643baa902f4b01fdae3b8ffc0096568cd86be1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 14:03:03 2009 +0100

    cosmetic

commit 1bbb4a1681059830077a7a09a373078f2d5da70b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 14:01:02 2009 +0100

    Everything outstanding on MQ. +prefetcher:stop. Also give DQ more time to shutdown (well, give everyone more time to shut down...). And tx_cancel => tx_rollback in MQ and DQ

commit 87699ea5ef84a0f9fec27733290e2542674744cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 13:19:03 2009 +0100

    cosmetic in MQ. Refactored purge and requeue in MQ. Spotted that read_ahead was back in DQ. Also got noisier about reporting misreads in DQ.

commit 341ddb9220dc3f9185554f056bb681e9a52a109f
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Aug 26 12:33:08 2009 +0100

    Also check for a nowait field on synchronous records

commit 493a17637a4fabb7c7037d16b9e9c113b5c76dc9
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Aug 26 12:14:05 2009 +0100

    Added code generation of is_method_synchronous

commit 086aef1889b8ff4f90d77aae3f768ea3683899f2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 26 10:05:03 2009 +0100

    Application of Matthias's patch. Can't find any faults in it, and the tests all pass too. Code definitely has got shorter!

commit d18bfa1b6704542f2c6ab379a75b4bfd918a1d14
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 26 06:27:55 2009 +0100

    cosmetic

commit 8ba75b2767bb24396dbc9e5707b110f3c382aa08
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 26 06:21:54 2009 +0100

    cosmetic

commit df67e4dafc6a147cb7e330c4fd44c3704535600c
Merge: 01c010089 ae00b843d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Aug 25 14:24:56 2009 +0100

    merging in from default

commit 01c010089a9923af81b374a6d79ca343a70bf834
Merge: 3e3aa9ad4 0e3b435c1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Aug 25 14:00:50 2009 +0100

    merging in from default

commit 70a6b3d5b5312e704b63750ff0dd27ab2d422134
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Aug 25 13:10:43 2009 +0100

    consistent field order

commit 846b176a7c02e245b5580e56900a69e34b691f2f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Aug 25 13:07:32 2009 +0100

    s/erlang:length/length

commit 8cc0432c21604729c4d5444194d685e3b6e3f337
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Aug 25 12:10:00 2009 +0100

    MQ: length/0 => len/0

commit ae00b843da3e5bacca3d3bcfad7ac5e96871a408
Merge: 0e3b435c1 6d63523ef
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Aug 25 12:09:41 2009 +0100

    Merged bug21353 into default (encoding in rabbitmqctl)

commit 8fd8e8aa2c70134c8ccf0e88b861026e4d0e1e2b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Aug 25 12:04:54 2009 +0100

    MQ: Made run length encoding more obvious; Added comment about logic for starting up prefetcher; Tidied API for dec_queue_length and inc_queue_length

commit 88689b125975c1fc5a91edf5d3ea39a671ab876e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Aug 24 18:30:11 2009 +0100

    cosmetic

commit 0e3b435c1e181a76b2d7022e0c1399adf72a86b4
Merge: a43adab41 fb030c03e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Aug 24 18:20:06 2009 +0100

    merge bug21429 into default

commit 0d05ba73eb3c894ebccc27555e43734a5283b637
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Aug 24 18:15:56 2009 +0100

    cosmetic

commit cdb228fbb76aa640b3043ba53d460ca3a9717de9
Merge: 183ba68a1 a43adab41
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 18:06:58 2009 +0100

    merge in from default

commit 183ba68a125927970814f70c275d4e49c59be5d9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 18:06:15 2009 +0100

    Removed is_persistent from tx_tracking. Removed auto_ack_next_message as it wasn't needed as the one case where it was being used in mq was wrong. And some cosmetic stuff too.

commit 186ae813835218bf5c3c5fb1aff2658a745a29b6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 17:46:30 2009 +0100

    remaining items from comment 92

commit 6d63523ef9160bdb614edbf3ec1ba77f4e6358da
Author: David Wragg <dpw@lshift.net>
Date:   Mon Aug 24 17:33:15 2009 +0100

    Update the rabbitmqctl man page to cover the new escaping scheme
    
    And make it describe the output format more precisely in various
    places.

commit 7c7801ee159c2f594dca66e0f91516c2f19bb4ee
Author: David Wragg <dpw@lshift.net>
Date:   Mon Aug 24 17:32:19 2009 +0100

    Reformat man pages, using more features of the pod format
    
    This allows proper indentation, while still allowing the re-flowing of
    paragraphs according to the terminal width.
    
    Also, begin paragraphs consisting of sentences with an upper-case
    letter.

commit c3155a188e0e845294340210b2ad6f5e1af4a69d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 16:53:35 2009 +0100

    handle_cache => file_handle_cache.
    Also switched to using the #message_store_entry record throughout.

commit 07de2fa67a02377f0a6d46701c6ebb3e9830fafa
Author: David Wragg <dpw@lshift.net>
Date:   Mon Aug 24 16:35:56 2009 +0100

    Escape non-printable ASCII characters using a backslash.
    
    Replacing the previous percent encoding scheme.  This approach should
    a more natural fit from a Unixish command line, and preserves UTF-8.

commit a43adab41db006818c846af80ed7a72e1180872c
Merge: 85e814ea9 70022af38
Author: Marek Majkowski <majek@lshift.net>
Date:   Mon Aug 24 15:57:09 2009 +0100

    Merged bug21467 into default (POD formatting).

commit dc7c6605ab76a2bd32261881f8eac1276df392cb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 15:25:32 2009 +0100

    english preferable to gobbledegook

commit 2f6f113da83e37bc55c075dcfdfb1a6edf339cd5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 15:22:19 2009 +0100

    All the below, done.
    
    - encoded body size is being cached, but doesn't need to be.
    - extract_sequence_numbers and remove_gaps_in_sequences should just
      take #dqstate.sequences, not the whole #dqstate.
    - rename length/1 to len/1 - that's what it's called in other APIs,
      e.g. queue. It will also allow you to remove the erlang: prefix from
      the calls to erlang:length.
    - load_messages/3 - instead of taking and returning a state, make it
      take the file_summary only, and return {current_file_num,
      current_file_name, current_offset}.
    (not done due to Good Reasons, but the 1st base case that was objected to has vanished)

commit 99b96b785868d61a4a4a07136ee5109515546d2c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 13:06:11 2009 +0100

    More cosmetics. Also, if the seek failed, it's probably safer to assume that we've not changed position. However, it's really expected life will stop pretty soon after anyway, so it's probably not too important.

commit 62861adca3511e1c089eb26101e080757e30c158
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 13:01:46 2009 +0100

    cosmetic

commit 07fd4cc4321ddb0fc21b50738ce7d3a2b77557b0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 24 12:56:29 2009 +0100

    Abstracted out all the read handles stuff to a separate module, and refined the API as discussed.

commit fb030c03e96e54f131ef1d71d28948a1ccd67b5e
Merge: b48f74f2b 85e814ea9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 23 20:37:09 2009 +0100

    merge default into bug21429

commit 85e814ea9379184ce076603d29f40edfdc4944c4
Merge: e2d822841 b48f74f2b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 23 19:44:03 2009 +0100

    merge bug21429 into default

commit b48f74f2b62ee04e59eee22433fee6c80b644e69
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 23 19:43:17 2009 +0100

    cosmetic

commit 2940ef9035d139458c1f6a184ebd11f8cbc437a5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 23 18:51:02 2009 +0100

    preemptive refactoring and other assorted changes

commit 545267414ab31f8784fe401e74c21965768a405a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 23 18:35:31 2009 +0100

    more simplification of the table copying code
    and address "unused var" compiler warnings

commit 9f7b9ce856b7b174b574560669f95a9b28f1fec4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 23 18:17:50 2009 +0100

    done

commit 2057297e947a5f9995308082a00b7fd79084b03d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 23 17:19:51 2009 +0100

    renaming

commit 9989de598228781c3a979d2932bb5fa3cbf5a919
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 23 17:00:22 2009 +0100

    Sorted out transactions within the disk_queue, ensuring that if they do restart that other data structures cannot be left partially updated, and can continue successfully, in particular, manipulation of ets tables within mnesia transactions.

commit cb4f27280ecc3c578b5098e4e8fb6e5c92e842a0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Aug 22 18:23:04 2009 +0100

    Could repeatably read zeros.
    
    With the handle position caching in, avoiding seeks opened a lovely opportunity for reading zeros. The read handle had read_ahead turned on, so even though the write handle was being sync'd correctly, the next read was reading cached data. Consequently, reading zeros instead of the real message.
    
    This makes a valuable point which is that with read_ahead turned on, the seeks on every read, as was happening previously, were evicting the read_ahead cache, even if the seek was in effect a noop. Thus read_ahead, in combination with the seeks, made no performance gain.
    
    Consequently, turning read_ahead off and only seeking when necessary is a performance gain, over (pointlessly) having read_ahead on and seeking every time. Turning read_ahead off also solves this reading zeros bug.
    
    Finally, corrected some maths so that we now check to see if the sync offset is < the offset we will reach rather than <= the offset we read from. Because the offsets should only ever be on message boundaries, both will work, but the new version is more intuitively correct.

commit 70022af387ae13f5277046c7e56874e77ba2bccd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 19:13:10 2009 +0100

    correction of formatting of man pages

commit 08b05fae992823443d75fb8fd2eb1ddf88c4aeb3
Merge: 0312c4699 abd83b738
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 19:01:28 2009 +0100

    merging in from bug 21444 with the vain hope that 21444 does not need further work!

commit abd83b7380fb66c59d38d489d5e5e096fd12b4b8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 18:57:22 2009 +0100

    And another go. If the new node is a ram node then local_content tables are still honoured as to their own table storage type

commit 0312c469939bfa25647ddae1f5210f609b7a3dd7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 18:24:02 2009 +0100

    mode => storage_mode in most places
    Also removed chattiness of mixed_queue on queue mode transitions

commit 3ecada5db2976cf44b777a1ac1a0e4693fa74e86
Merge: 7d3a1dc92 e9f81f2ab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 17:23:19 2009 +0100

    merging from bug 21429

commit e9f81f2abcfa4c51410904bf9b01f1c5d5f9dd77
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 17:22:50 2009 +0100

    oops. Need to support ram nodes which still have local content as disc_copies

commit 7d3a1dc92ad46b07269900880e5defd76905bb29
Merge: 327c02daf e2d596b7f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 16:49:17 2009 +0100

    merging from 21429

commit e2d596b7f4fae2cd3180ff608d23048a9621ed31
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 16:49:01 2009 +0100

    Refactoring as suggested. This has been tested by for local_content by patching 21368 and ensuring clustering still works

commit 327c02daf7964d2444712fbe43571e5561ac8cfc
Merge: d4ffc1ae9 e3c9e9532
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 16:32:32 2009 +0100

    merging in from 21429

commit d4ffc1ae9034745bff6ef63111ebc809fca8356f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 15:14:59 2009 +0100

    cosmetic -> with_queue_head => queue_head
    
    Also, time for a new optimisation! YAY!
    
    Previously, reading a message off disk meant seeking to the correct position and then reading the data. Now if the handle is already in the right position, then that seek is a waste of quite a lot of time, as it is an OS call. Now, I cache the location of the handle and so avoid seeking when possible. This has a MASSIVE effect on performance, especially in straight line cases, eg where a single prefetcher can drain a queue of disk in about one third of the time it used to take. Just looking at the code coverage from the test suite, there were just 534 seeks and 8582 cases where we found the handle in the right position already. This is a fairly small amount of code, and provides very useful benefits.

commit e2d82284182eb66b50e7cc98beeba3e432cd64e8
Merge: eafb28495 f38c2d42a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 14:07:20 2009 +0100

    merging default heads

commit 8d57331105d78a08fe5fbebd8f8c1a9f877f453f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 14:02:30 2009 +0100

    Refactoring out code used in multiple paths through internal_fetch and internal_read_message, tidying of API.

commit e3c9e953242917e88dddfc8330a28722c7ee5f62
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 21 12:50:50 2009 +0100

    tiny refactoring

commit eafb2849520a94020bbda99fff9ab1fe9049e196
Merge: d54b3cce5 0e42a1034
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Aug 21 11:46:51 2009 +0100

    Merged bug20013 into default (memsup support for OS X)

commit 8d815c914eae45eddd9f7e223b56b5c1e4050fca
Merge: ce35cd4df f38c2d42a
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Aug 21 10:14:45 2009 +0100

    Merge default into bug21368

commit f38c2d42aac5d43ca8d303f3c84c912cbc423f1a
Merge: 49157676d beea3ad2a
Author: Paul Jones <paulj@lshift.net>
Date:   Fri Aug 21 09:02:37 2009 +0100

    Merged bug19973 into default

commit ce35cd4df98e6d3eb9766b5f0a078e02406786d5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 23:11:33 2009 +0100

    tidying of memory estimation

commit c64467821190b10c8e9d05b829602f4a2c916185
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 23:06:15 2009 +0100

    remove ForceInCache at it's not been used since before the current prefetcher.

commit aab597c18c21e4629ab9934efbf843ace3d33516
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 22:57:26 2009 +0100

    typo in docs in previous commit.
    Also changed internal_fetch so its result construction, which whilst not wrong, was at least confusing, and had unexecutable code in it. Associated changes elsewhere.

commit 79823b5509b0853b0760879186adaa68e158aea3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 22:42:39 2009 +0100

    Made messages be marked as delivered during prefetch *before* they are passed to the prefetcher.

commit 4345618a753e8667365e3eac3890ec81140336f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 15:43:20 2009 +0100

    remove the unnecessary sync from tx_cancel. A cancel cannot be misinterleaved with a commit for the same transaction so it's not necessary.

commit d54b3cce513fc6c1cf9420b2cd424268c74e261f
Merge: 49157676d 551063399
Author: Marek Majkowski <majek@lshift.net>
Date:   Thu Aug 20 15:22:55 2009 +0100

    (freebsd stuff) bug21432 merged into default

commit 1f4f6d0654c6d852313bdb066319f75600b2621f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 15:01:36 2009 +0100

    Well, this was a very very sneaky bug.
    
    1) create durable queue
    2) send persistent msgs and send queue to disk_only mode (note, requires branch bug21444)
    3) when done, set queue to mixed mode
    4) send more persistent msgs
    5) when done, wait for the prefetcher to do its thing
    6) restart rabbit
    7) observe that queue length is wrong
    
    Bugs fixed:
    o) in the to_disk_only_mode code in mixed_queue, msgs that had come out of the prefetcher weren't being acked. This meant that on a restart, the msgs would be recovered. Given that we have to requeue everything anyway (sometimes) in a mixed -> disk transition, we obviously have to ack these msgs before republishing them. Note that we do this as part of a tx_commit, so it's perfectly safe
    o) in the to_disk_only_mode code in mixed_queue, there was a recursion which swapped an IsDurable param with an IsDelivered param. This caused substantial fail.
    o) transaction commit coalescing is dangerous, especially when you're relying on calls to the disk queue to happen in order. For example, should you tx_publish, tx_commit and then auto_ack, or requeue_next_n, you would expect that those last calls get to see the msgs tx_published. This is not necessarily the case. A further good example is a tx_commit followed by a queue.delete. So, in the disk_queue for such calls, make sure that we flush properly, but also expose this functionality (it was already exposed, but as a cast, and although not absolutely necessary to be a call, if we're tx_commiting anyway then that's a call, so another full round trip isn't a problem).
    
    One final note, there is no way that this bug would have been discovered and so easily replicated and debugged without the pinning code in bug 21444. We will seriously hamper our own ability to debug and aid clients should the new persister get released without 21444.

commit beea3ad2a7cce52b2a90bd49c01d41856ef33ef3
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 20 14:34:59 2009 +0100

    Hg overestimated its ability to handle a merge

commit dd56a8132e6076e8690e5cb1fba2da567fbb2997
Merge: 5f3ee0a97 49157676d
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 20 13:58:22 2009 +0100

    Merge default into bug19973, resolving conflict

commit 06c83c2e075826a0391b627d8f09b3968a4200fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 11:11:08 2009 +0100

    > You should just *replace* to_{mixed,disk_only_mode}_mode with set_mode, not make the latter a wrapper for the former.
    
    Done.

commit 49157676d8179402e9474e80ed25e8aa6f95087c
Merge: 02f308b38 c343b7747
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 20 11:00:35 2009 +0100

    Merge fixes from bug20342 into default

commit e4d5badbb083140a759c5cd8096a047d4be1640a
Merge: bc61f0b7f 02f308b38
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 20 10:58:47 2009 +0100

    merging in from default

commit c343b77479247a4ba9ff2bdba00213d1d919f929
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Aug 20 10:56:38 2009 +0100

    Removed the default setup of ERLANG_HOME

commit 02f308b38e41b516691e99dd782f9a7ef83b34fa
Merge: a0cd42787 511ef37aa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 10:52:21 2009 +0100

    merge bug21426 into default

commit d2d6792347fc8547c97cd455d4439cba0fd9cf37
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 02:42:32 2009 +0100

    some cleaning up
    mainly remove the (now) badly named WasDiskNode var

commit a0cd42787325be33f62c66705edb064cbb116db6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:38:46 2009 +0100

    eliminate unused var warning

commit c0acd6a76879f0979f7fe34dcc55a2396bd8feff
Merge: 218ec7a26 149691e4f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:36:24 2009 +0100

    merge bug21427 into default

commit 149691e4f4df4012289419973f8586052bd092ee
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:29:08 2009 +0100

    it's a serial, not a guid

commit 5443559f004157e449d9c8669723abc722b67ffe
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:22:46 2009 +0100

    don't ignore errors

commit 2a33c54e47b4c2c366db04899eb5ded12ae32088
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:16:24 2009 +0100

    use new term file helpers

commit 05ff6215c3d44fd55cc98913535b077a0b109ed1
Merge: ab248de32 218ec7a26
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:10:35 2009 +0100

    merge default into bug21427

commit 218ec7a261271a213bd0e63994330e2a6a51788a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:06:19 2009 +0100

    use new term file helpers

commit 4f70847bc9ffed308d1b08e2d837a579b816ff1c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:05:38 2009 +0100

    introduce helper functions for reading/writing files containing Erlang terms

commit 69b2f9a9767d0648b201acad2cbb286da6b877f3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 20 00:04:28 2009 +0100

    minor refactoring of signatures

commit ab248de326cc11e4c944fd6cb1e9479a578d827f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 22:09:13 2009 +0100

    stuff as according to QA.

commit 317153bf6145a054985109d33b77d5a584e28784
Merge: 4de3d262e c1c9fdde8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 19 21:38:14 2009 +0100

    merge bug21428 into default

commit 4de3d262e5c23a8e9e357c7984dbc9a267d0600b
Merge: d1cb178e8 e6df59a9e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 19 21:31:35 2009 +0100

    merge bug21425 into default

commit bc61f0b7fbea972eb305c7d16bf7570eaa6cc6cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 18:29:39 2009 +0100

    Pretty much all the low hanging fruit. Need to check the ets access in txns in disk_queue and also deal with the clean shutdown and delivery bits.
    
    > ** queue_prefetcher
    > - s/publish/deliver ?
    
    No, I really don't like that. Publish is about pushing messages to the receiver. Thus it's named correctly.

commit e6df59a9e679ef0b60a287290e3dd8b33f1f799d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 16:28:42 2009 +0100

    100% code coverage of join. Also made in have 100% code coverage. The remaining out case I don't think can exist without manually constructing the necessary structure. I don't believe the API permits it.

commit f422662d84296f46c71195770887c355e18a6d9d
Merge: 3c3ed9716 37c3b5f8c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:18:43 2009 +0100

    merging in bug21427

commit 3c3ed97162b330cdf7b43a90625555e683d2fef3
Merge: 69f592b88 511ef37aa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:17:47 2009 +0100

    merging in bug21426

commit 69f592b88940cfe2981cc54cbc4ec256f5431829
Merge: 9d440e33f 8840378e2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:16:41 2009 +0100

    merging in bug21425

commit 9d440e33f9c96964882b8edc0680c7ce0191d6fc
Merge: 9966edcaf 0e42a1034
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:15:49 2009 +0100

    merging in bug20013

commit 9966edcaf16691ebf7b22b0e39f11bfa186cd676
Merge: afe4be9ee c1c9fdde8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:13:02 2009 +0100

    merging in bug21428

commit afe4be9eea994d2bb376af42f8b118d330854526
Merge: 857ab133c 1a05739c4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:12:06 2009 +0100

    merging in bug21429

commit 857ab133c6905a762c7fcbfb89b3115e4580f449
Merge: 715b2fa4c d1cb178e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 12:04:38 2009 +0100

    merging in default

commit 715b2fa4c6dea6c19bd392c5ced4ee7fc443a8b5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:54:40 2009 +0100

    New branch for bug 21368

commit 1a05739c4e7df3db4140e77497098384b0720109
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:28:12 2009 +0100

    New branch for bug 21429

commit 37c3b5f8ce2e5b24cc621402ced1169d1b88c9de
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:24:54 2009 +0100

    New branch for bug 21427

commit 511ef37aa14feacba3673cbbf0f19dc5380603bb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:23:54 2009 +0100

    New branch for bug 21426

commit 8840378e20a541cfd86048f27aa3fdc6619711a6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:22:26 2009 +0100

    New branch for bug 21425

commit 0e42a1034669fb112f66d4e2a8d6198f39b3a100
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:20:38 2009 +0100

    New branch for bug 20013

commit c1c9fdde82ab9b07769e0fdb1e4a9f8abf2eaaf4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 19 11:18:35 2009 +0100

    New branch for bug 21428

commit d1cb178e854bc7943953019c8535c7bda4ce6783
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 19 01:37:58 2009 +0100

    remove outdated comment

commit fede0abe6ba0b68149b5432ab7953b4031595f9e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Aug 19 00:30:22 2009 +0100

    cosmetic

commit 438506e2e7796ab91b84dd0e1a0123920c9eb58a
Author: Paul Jones <paulj@lshift.net>
Date:   Tue Aug 18 12:56:32 2009 +0100

    Removed misc space

commit 551063399a9921a6313ee3f79f708daf019ef9d1
Author: David Wragg <dpw@lshift.net>
Date:   Tue Aug 18 11:10:58 2009 +0100

    Python is /usr/local/bin/python on some unices.
    
    Use env to avoid hard-coding it.

commit 07ecf11d15147062a239445ddeff6a0a938da18d
Author: David Wragg <dpw@lshift.net>
Date:   Tue Aug 18 11:10:40 2009 +0100

    Invoke make as $(MAKE) from within makefiles
    
    Our makefiles require gnumake.  Under some unices, gnumake is
    installed as gmake, with plain "make" referring to a something less
    featureful.  So it's necessary to invoke make as $(MAKE) from within
    makefiles, in order to make sure we invoke the same variant.

commit fde61026f700a18e40eb1d94e3ce3e09e781d812
Merge: 92b0c968f 17d143e79
Author: David Wragg <dpw@lshift.net>
Date:   Tue Aug 18 06:54:40 2009 +0100

    Merge bug20463 into default

commit 92b0c968f159101336fcac8b1c959373c6b47249
Merge: baf7f5375 779cbbcaa
Author: David Wragg <dpw@lshift.net>
Date:   Mon Aug 17 17:26:25 2009 +0100

    merge fix from bug20342 into default

commit 779cbbcaa7d59b8b9626eb8643179d3c9cf15c80
Author: David Wragg <dpw@lshift.net>
Date:   Mon Aug 17 17:25:32 2009 +0100

    Fix an incorrect variable name in rabbitmq-env

commit baf7f537533ba5a707803b6900fc663d41e4d69f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 17:02:01 2009 +0100

    see bug21368 for details. bumping version required for specs, and making consistent requoting of STARTUP_SERVER_ARGS

commit b65c5dd93eb843a31365d8aa522a5513f7f11264
Merge: 5e2822695 4fbe8f7ae
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 16:47:02 2009 +0100

    merging in from default

commit 5e28226954220ec56f9fedd177bec3ed03b6de60
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 16:28:14 2009 +0100

    making a comment accurate.

commit d164288b4eba2a063fa08526f9ca8dc69fd8e604
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 16:16:58 2009 +0100

    made memsup work on mac os x. Substantial refactorings. I will shortly move this out to another branch.

commit a0a4366e0a1e011030beba08177a19756203755e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 13:48:21 2009 +0100

    ...in which case the todo comment can go away too.

commit 7665d669957721b0e1046116834928af696800fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 12:59:52 2009 +0100

    if memsup isn't runnig, we get back {0,0,undefined} from memsup:get_memory_data/0. Thus adjust maths to cope with this. In the absence of memsup, we don't hand out tokens at all, so everything stays in mixed mode all the time, and we can cheerfully run out of memory (another good reason for the manual pin_to_disk stuff).

commit 75dbcf5a4d97f568d1e2db4fb8ffaf88f876c1d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 12:44:00 2009 +0100

    Make sure the queue mode mananger can never tell a queue to go back to mixed mode when memory alarms are going off

commit b99edb893e39ac72d8796611952ec74c36ad7e6b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 12:23:10 2009 +0100

    Reworking of mixed queue.

commit 376e6350bbbeaa4c891fd10c7d577413cf9d96be
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 11:39:35 2009 +0100

    corrections to amqqueue_process.

commit dbb7fb7bd593f97b58d72cad6b1890baf4e1bcb0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 11:11:32 2009 +0100

    Changes to avoid having strings going to binaries going to strings going to atoms in the control.
    Also dialyzer spotted that multiplying by 2.5 can sometimes result in not-an-int. 'Atta boy.

commit 68fbf57b46cfd5a8bf8de4515373b356ee141707
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 10:38:27 2009 +0100

    adding mnesia threshold to rabbitmq-service.bat

commit 5ab7af06f74b81d5b6d0fe26126f4aae1020dcc0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 17 10:32:16 2009 +0100

    switch to using with_exit_handler.

commit e7a42e3e545061309773f9ca172016181285275e
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Aug 17 08:37:16 2009 +0100

    Removed extra_startup_steps from being applied at startup

commit 3a69615fae0fabd893f59b99f5c0d0cfbc3f56f7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 16 23:19:53 2009 +0100

    A Matthias stipulated refactoring. Also, in testing found some issues with the prefetcher, found a couple of places where it being stopped wasn't being recorded properly but that wasn't the cause of the problem. Eventually found the cause to be the disk_queue attempting to publish to the prefetcher and getting back exit:{normal,_} instead of exit:{noproc,_}, which I didn't know could happen. To test:
    
    1) create 100 queues
    2) fire 100 msgs to each queue ((1 msg to every queue)*100)
    3) pin all queues to disk
    4) unpin all queues
    5) do step 2 again
    6) wait for the prefetchers to start up (watch CPU load and disk activity)
    7) pin all queues to disk
    
    In step 7, the prefetchers are being stopped whilst the disk_queue is feeding them messages. I believe that exit:{noproc,_} comes back when sending a msg to a non-existant process, and exit:{normal,_} comes back if the process existed when we sent the message as part of the call but the process exited (normally) before our message was replied to.

commit c6ca402ff9b4763b3d1c7758db6c94b8354beff1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Aug 16 21:08:30 2009 +0100

    More fixes to the queue_mode_manager.

commit 531d817bb9142194c29e6c05dfe08bc930a453cb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 19:47:19 2009 +0100

    removed pout and friends from priority queue as requested. Large refactoring of queue_mode_manager. Appears to still work but needs a rereading in the cold light of day!

commit 4fbe8f7ae4ee7e56bfea864d97b3f9a849207a8b
Merge: e886c8fe1 31c9a6fa2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 14 17:23:26 2009 +0100

    merge bug21066 into default

commit cade9b2f39c6cab02389accbe163a8ab2c7d4564
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 15:20:35 2009 +0100

    Bumped requirement for checking specs to R13B.

commit e886c8fe159393bd04d70b3489453b0254b25620
Merge: e84abd31f 9a1638d58
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 13:59:11 2009 +0100

    merging in bug20978

commit 218f55288615945c9c3dcca7fb862b7b5e5ec2b2
Author: David Wragg <dpw@lshift.net>
Date:   Fri Aug 14 13:42:08 2009 +0100

    Use /bin/sh for rabbitmq-script-wrapper, not /bin/bash
    
    There's nothing in it that is an obvious dependency on bash, and some
    testing with dash as /bin/sh doesn't reveal any problems.  Neither
    does checkbashisms.

commit e84abd31f517f05e50e9c61c57d95f2f70a1bd46
Merge: 345d4d0ce 98206e0cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 13:40:30 2009 +0100

    merge bug20342 into default

commit 98206e0cc2dd7f6ba24a6b23f99b6f37cbf6d6e0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 13:38:36 2009 +0100

    oops, 4 spaces, not 3

commit 2cfd9a5d93dec498dea1024b360741c82a3b4369
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 13:18:06 2009 +0100

    removing tabs

commit 3204a927abbcf9d1079d3be740c2b5b60aaf4b80
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 12:51:41 2009 +0100

    case => if. This is the last of the corrections for the prefetcher from comment #8

commit 202138a1d722a806891ddada37bf42df31f68ca8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 12:46:40 2009 +0100

    Made the prefetcher only consider hibernation when it's fully drained the queue.

commit 17d143e798f43e34d22f446111880333dff4303d
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Aug 14 12:42:48 2009 +0100

    Rabbit automatically adds /ebin to coverate directory

commit 6da285ab1609ba470cf3a22ef936d3290ea344d8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Aug 14 12:38:16 2009 +0100

    Adjust the prefetcher in light of the bug matthias discovered. Documentation updated too.

commit 37d0c8d21a00bb23860a7688f8774507029f177e
Merge: 3744e9042 345d4d0ce
Author: Marek Majkowski <majek@lshift.net>
Date:   Fri Aug 14 12:37:26 2009 +0100

    Merging default to bug20463

commit 5f3ee0a97a30a9dcd06d16efcab53716b52949c8
Author: David Wragg <dpw@lshift.net>
Date:   Fri Aug 14 01:15:27 2009 +0100

    Restore the LOCK_FILE support, as demanded by rpmlint
    
    On Debian, we set the value of LOCK_FILE to the empty string, thus
    disabling use of a lock file.
    
    Now tested with rpmlint and lintian.

commit c7397e4419bce2a3c2bc58e709d703336609a42e
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:34:46 2009 +0100

    Use a common init script for RPMs and debs
    
    Put the common init file into packaging/common, and modify the RPM and
    deb builds to make the one substitution required to this file at build
    time.

commit 9a046e9f16434b217d23fe97842377e88cb0d567
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:34:00 2009 +0100

    Change RETVAL when showing usage message to 1
    
    While the Fedora skeleton init script uses 2, it doesn't seem to be
    universal across their init scripts, and the specs aren't clear on
    what the value should be.  So follow the Debian init script in this
    case.

commit 5f5f235157f181cf2d4dda649186b5a91042e2b5
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:31:50 2009 +0100

    Reconcile actions peformed by the init scripts
    
    Not all the actions behave according to specs, but this is a general
    issue with our init scripts.

commit 9ea57afedb17f7cde5cfc8fa246906d72fa1a0f2
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:30:41 2009 +0100

    Remove the LOCK_FILE bits from the RPM init.d
    
    The RPM init.d has some lock file support, but its not really
    functional (we never actually check whether it is present).  So rip it
    out for now.  We should put proper lock/pid file support back later.

commit 3753d7e959ce9f9c22fe6b7bd8971fc7a27845d1
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:29:36 2009 +0100

    Omit runlevel list in the LSB Default-{Start,Stop} comment
    
    Neither our Fedora/RH or Debian packages actually depend on the value
    in this comment - the list of runlevels to install the service into
    comes from somewhere else in both cases.  But Fedora guidelines say
    that "Only services which are really required for a vital system
    should define runlevels here".  So don't.

commit 6de1aca363e4589334d524ce9f1ea2aa7f80daa4
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:26:08 2009 +0100

    Reconcile LSB "Provides" facility name as rabbitmq-server
    
    rabbitmq-server seems a more precise statement of the facility than
    rabbitmq.

commit 22fd5b38198d840bd8dc86a16b052bdf3ab5e479
Author: David Wragg <dpw@lshift.net>
Date:   Thu Aug 13 17:17:16 2009 +0100

    Add chkconfig preamble to debian init.d
    
    chkconfig is a Redhat thing, so this has no practical impact for
    Debian.  Some other Debian packages also have init.d scripts with a
    chkconfig section, so hopefully the Debian gods will not take offence.

commit d01625c878889c1230237d869a9c2c0b86a93766
Merge: ca64232d1 345d4d0ce
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 13 13:38:01 2009 +0100

    merge default into bug21368

commit 88d5f01b0241679fed1b1032dfde1d4760eaeb9d
Merge: 534d0faae 345d4d0ce
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Aug 12 17:57:53 2009 +0100

    merge default into amqp_0_9_1

commit 345d4d0ceb837d6a69a91b26d63349fc83837152
Merge: 4d019b5fc dcefa2af3
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Aug 11 16:43:48 2009 +0100

    merge bug18748 into default

commit dcefa2af3818363df5e0ceee74c9ab9e8151013e
Author: Paul Jones <paulj@lshift.net>
Date:   Tue Aug 11 15:25:42 2009 +0100

    Added notify_remote method, allowing a remote node to be notified of a hook

commit f13717736976dc5527f355835f6a046b51eb52e6
Author: Paul Jones <paulj@lshift.net>
Date:   Tue Aug 11 15:03:07 2009 +0100

    Changed hook function to be a {M,F,A} set instead

commit 9a1638d580d25d5a68d06fb67aa8776d7aa0aaf9
Author: David Wragg <dpw@lshift.net>
Date:   Tue Aug 11 12:28:26 2009 +0100

    Reconcile the Deian and Fedora package Makefiles a little
    
    The Debian package makefile has the useful feature that, if VERSION is
    not provided, it will guess the value from the source tarball file
    name.  Make the Fedora Makefile do the same, and adapt the common code
    to use make-builtins rather than $(shell ...) commands where possible.

commit 852d8cf253378cd965a6b0ed4dc295e2b0afb59c
Author: David Wragg <dpw@lshift.net>
Date:   Tue Aug 11 12:14:37 2009 +0100

    When stopping rabbitmq server, kill any rabbitmq-owned epmd process
    
    epmd is the Erlang Port Mapper Daemon, which maps Erlang node names to
    TCP port numbers.  It is shared by all users on a system, and started
    automatically by the Erlang start-up script if not already running.
    As a result, epmd will often be started when the rabbitmq server
    starts, and so will be run as the rabbitmq user.  This process will
    linger even after the rabbitmq server is stopped.
    
    This can have surprising consequences: The deluser program in Debian
    Sid checks whether any processes owned by the given user are running,
    and will fail if so.
    
    This change addresses the problem in this init script.  When stopping
    the rabbitmq server, it will also kill any rabbitmq-owned epmd
    process.

commit ca64232d121b3abe9ea9070caffda266fa58b80d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 10 18:18:57 2009 +0100

    tidying up specs with dialyzer which was good enough to find one genuine mistake in the disk_queue.

commit 9c358627c4529a60c2c48b9af8b6443cc5948527
Merge: 792d20388 4d019b5fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 10 17:41:29 2009 +0100

    merge in from default. All tests seem to pass.

commit 31c9a6fa23b285268dd6d886b14bb0b1f1a42cbf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 10 15:50:50 2009 +0100

    tidying

commit e92691cee2acdb0a6ce1072457998a5e7a56011b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 10 15:43:35 2009 +0100

    Channel now catches the exit of the writer and signals the reader explicitly. It then exits normally, thus avoiding the pointless and expensive formatting of its error message

commit de9507bb551f735b0fa1af70a52a6743ee053487
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Aug 10 15:13:18 2009 +0100

    Implementation of hook mechanism using ETS table for storage of hooks, along with test cases to validate functionality

commit d3cf489f550d5e4c7f258a2e8d340d493c2f7ad2
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Aug 10 11:43:57 2009 +0100

    Added license boilerplate

commit 4d019b5fc64e7643b76d691fdc084633a5bd4b58
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 9 01:57:21 2009 +0100

    tabs -> spaces

commit 09f73c7fc396fdf19e866a82b583c10f4a5866d1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 9 01:55:31 2009 +0100

    tabs -> spaces

commit 4783dbd5c8076380fd48b9499e3220edf192965f
Merge: 9eab578b3 6ee16c0ca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 9 01:43:13 2009 +0100

    merge bug21335 into default

commit 6ee16c0ca187c31fd994a2ef3e4800ffefe114b0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 9 01:04:41 2009 +0100

    assemble fragments in correct order
    and handle the case where both props are available in both binary and
    decoded form.

commit 0170a7f3914bce82a70062e4c87f97aa32e1fee0
Merge: 2f70ccc19 9eab578b3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Aug 9 00:05:34 2009 +0100

    merge default into bug21335

commit 9eab578b3af8c6e9fff0c50d6fa42d46a750aeef
Merge: 2038aca3a 71dafaaa6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Aug 8 23:07:20 2009 +0100

    merge bug21087 into default

commit 2038aca3a23791de637fdf660654b65e74e8a7e3
Merge: b61cc2930 188dc7084
Author: David Wragg <dpw@lshift.net>
Date:   Fri Aug 7 13:08:20 2009 +0100

    Merged bug21202 into default

commit 71dafaaa69a9e4618f368d0a3605a5840d25fbca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 7 00:55:46 2009 +0100

    factor out common termination handling

commit 8b99b9b278d7bee1d2b5eb13da831e16656c26c6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 7 00:46:17 2009 +0100

    don't ignore Debug info in pre/post-hibernate hook return handling

commit a47fbc03f8e62d2fbc2179aa3f0dd9dedc565e83
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 7 00:39:19 2009 +0100

    refactoring of pre/post hibernation code
    to make it simpler and shorter

commit dfe9b7455972476f22556295b44567e3b662b8fc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 6 22:51:51 2009 +0100

    trimmed some fat from docs

commit b61cc29300ba4377f12538e107819a4d9e675b96
Merge: e0aa3e890 91a6c79c0
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Aug 6 16:05:10 2009 +0100

    Merged bug20602 into default

commit 91a6c79c0ef709e229f4864cfa8e7c940f66f480
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 6 15:21:19 2009 +0100

    Bother, should have diffed before ci. I hate that RABBITMQ_SERVER_START_ARGS= line being in the Makefile but it should be dealt with in a different bug.

commit 3b46b961a31dc4429db7447b7cd35ac628cada96
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 6 15:15:12 2009 +0100

    An evocative and inspiring bunny.

commit 64dc43f2616139973bdda02280cd72e8b68305c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 6 14:07:55 2009 +0100

    more documentation

commit ce687c86b38f8f49bb2861f78afb9ede84c0f2b9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 6 13:18:06 2009 +0100

    documentation

commit d9f616b786c3514ed3bd93df7a5160793fd4bdb5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Aug 6 12:49:25 2009 +0100

    All done.

commit e0aa3e890e5c14e2d1324e13c48942ffab94f3fa
Merge: 6b6bd7cb6 2f70ccc19
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Aug 6 11:59:01 2009 +0100

    Merged bug21335 into default

commit 188dc7084250642c5478689f85a2bb96c67e4782
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 5 23:31:40 2009 +0100

    21202 => bug21202

commit 6b6bd7cb618f8a2d8628691169c9252435789729
Merge: 237afcc77 2664543e4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 5 19:25:25 2009 +0100

    Merged bug21234 into default

commit 2664543e4df6d580eafc7d3a8658b62c990ef304
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 5 19:11:55 2009 +0100

    Applied patch for enabling coverage with a specific directory

commit 237afcc77429a3ce4e4841d3d66655d16f8c4a07
Merge: 98b19bb62 da2f2f438
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 5 16:24:07 2009 +0100

    Merged 21046 into default

commit 792d203882a9911a83c1baa396fec71d8f730670
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 5 15:18:45 2009 +0100

    Removed some transactions and made all transaction bodies idempotent. They were actually fine before: a) the rabbit_disk_queue table is local_content and b) only one process ever accesses that table - thus there is no reason why any transaction will ever retry. However, this change is probably still beneficial. The only slight loss is that tx-commit is no longer atomic (ref counting of messages in ets, not mnesia, was resulting in non idempotency, so moved outside the transaction). This means that you could have msgs in a tx committed, but the acks not enforced, in the event of power failure or other catastrophic event.
    
    All tests pass.

commit 2f70ccc19b9a7534b1f5919492cd880f2a69fd54
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 5 14:19:36 2009 +0100

    Added a helper function to make dealing with the crazy content record a bit more sane

commit 98b19bb6227d7ed886a81522b6d67734adf66d0f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 5 12:31:38 2009 +0100

    bug 20546. Just removing cruft which got missed in QA

commit 2c5da669c782682981bea720f78a4a16a2dd6ed0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Aug 5 11:58:13 2009 +0100

    change rpc timeout to infinity

commit da2f2f438f55f969e8c0b2af466750a017a578e2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Aug 4 12:27:50 2009 +0100

    Done. Testing the latency between the call to conserve_memory and when the msg gets processed shows this is benficial:
    
    In the erlang client, hammer in a few million messages, with no consumer. This causes the channel mailbox to get pretty big. Without the higher priority can demonstrate a delay of over a second before the conserve_message gets processed. With this, it's a mere fraction of that.

commit 5600a234d1c143a2976d115aab71c18129feb346
Author: Paul Jones <paulj@lshift.net>
Date:   Tue Aug 4 07:48:10 2009 +0100

    Added manpage for rabbitmq-activate-plugins

commit 519e73a0ad74c25ca8169322a1cfe5f42b2f7ab9
Merge: fd792ab2a 091b70039
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 3 17:42:02 2009 +0100

    merge in from 21087

commit 091b70039aee2701a42b7e19ce1e48889638bb79
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 3 17:25:01 2009 +0100

    Matthias wanted to be able to cope with the possibility that we get woken up without having a msg to receive. We have no idea if this is possible. Nevertheless, in the previous code, it would block waiting for a msg (mirroring OTP behaviour). Now it'll work, but we have to avoid a potential crash elsewher.

commit 7723b5d4340fb6a9978ec7b306bc0d19a58a0ae5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 3 17:04:04 2009 +0100

    The bug was not as advertised (it actually popped up when merging into 20980). However, we should definitely make sure we receive at least 1 msg when coming out of hibernate, and in loop we don't care too much. Also, use now() to seed the rng as erlang doesn't do it for you (rng state is implicitly per process).

commit 8a3dfd9ccb8d7b097804e4f960ad3237d2cc213f
Merge: 39d8c604b 7d855da06
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Aug 3 15:04:57 2009 +0100

    Merged bug20539 into default

commit cf714a38b3f36fb9be07ba1d909c5b8db6ab4c50
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Aug 3 14:04:55 2009 +0100

    All done.
    
    Introduced drain explicitly because to do otherwise would have made life even harder. Everything addressed as per bug and IM. Test once for functions being exported and cache

commit b482ac70be2902b845cdfdea38fa6e7e80984f16
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Aug 3 13:48:58 2009 +0100

    Eliminated parsing of ls output

commit fd792ab2ad5126425dbc23774218db547542fecb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Aug 1 21:30:40 2009 +0100

    just making set_mode as a pcast in the disk_queue just like it is in the amqqueue

commit a297f995c54f48f2be51265ffb257377a1b8a81e
Merge: 734b8e60f 2a571d8b5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 29 14:55:16 2009 +0100

    merging in from 21087. All tests pass.

commit 2a571d8b582fade0bdc34084cc08cd11c920b881
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 29 14:10:59 2009 +0100

    Implemented. Seems to work well. Changed the design and behaviour of the backoff as discussed with Matthias over IM. Documented in comments, reproduced here:
    
    %% 5) init can return a 4th arg, {backoff, InitialTimeout,
    %% MinimumTimeout, DesiredHibernatePeriod} (all in
    %% milliseconds). Then, on all callbacks which can return a timeout
    %% (including init), timeout can be 'hibernate'. When this is the
    %% case, the current timeout value will be used (initially, the
    %% InitialTimeout supplied from init). After this timeout has
    %% occurred, handle_pre_hibernate/1 will be called. If that returns
    %% {hibernate, State} then the process will be hibernated. Upon
    %% awaking, a new current timeout value will be calculated, and then
    %% handle_post_hibernate/1 will be called. The purpose is that the
    %% gen_server2 takes care of adjusting the current timeout value such
    %% that the process will increase the timeout value repeatedly if it
    %% is unable to sleep for the DesiredHibernatePeriod. If it is able to
    %% sleep for the DesiredHibernatePeriod it will decrease the current
    %% timeout down to the MinimumTimeout, so that the process is put to
    %% sleep sooner (and hopefully for longer). In short, should a process
    %% using this receive a burst of messages, it should not hibernate
    %% between those messages, but as the messages become less frequent,
    %% the process will not only hibernate, it will do so sooner after
    %% each message.
    %%
    %% Normal timeout values (i.e. not 'hibernate') can still be used, and
    %% if they are used then the handle_info(timeout, State) will be
    %% called as normal. In this case, returning 'hibernate' from
    %% handle_info(timeout, State) will not hibernate the process
    %% immediately, as it would if backoff wasn't being used. Instead
    %% it'll wait for the current timeout as described above, before
    %% calling handle_pre_hibernate(State).

commit 4bedf0ea86889fcdb46d34fe777febcb77ec68c1
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 13:12:34 2009 +0100

    Fixed lib locations and root wrapper mutation in macports

commit 6cdd1a508bbf886cf700fd7ba430e5fc68133604
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 13:01:16 2009 +0100

    Added macports specific version of asroot-script-wrapper

commit 04aa5eb5b68869b9a2bc3b090b1f20cc55eb7dfb
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 12:55:23 2009 +0100

    Cleaned up Portfile, added rewriting for rabbitmq-env

commit 7217efefd247aea60128db3d9ad72cf68d6cf84a
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 12:52:12 2009 +0100

    Updated packaging configurations to handle new rabbitmq-activate-plugins script, along with its requirement to be run as root

commit 890a21ca83314dab87249b04e48f54db56b71249
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 12:50:02 2009 +0100

    Renamed activate-plugins to rabbitmq-activate-plugins; changed scripts to use rabbitmq-env to source paths instead of embedding the logic themselves

commit 5367d72b3ca4595a97e0ace82616df4ceaa8591e
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 11:16:25 2009 +0100

    Corrected copy command for activate-plugins script

commit dace1588bd7ffda01148c7bacf81d132dd3de10d
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 09:57:30 2009 +0100

    Packaging location changes for debs, macports, windows and RPMS

commit 9398b1a9413be8430c061c5f0513aca55eb3264a
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 29 09:42:51 2009 +0100

    Patched all scripts to be able to auto-detect their directory, even when symlinked

commit 3e3aa9ad4397dee291d64ebc84f3107cbca8dcc8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 28 15:47:11 2009 +0100

    If we don't do this then it means that scripts which call both run-node and start-background-node have to do different things for each of them wrt quoting of the RABBITMQ_SERVER_START_ARGS var, which is a pita. Thus it should always be requoted consistently.

commit 39d8c604b32471fbf0afac857f02f0793c7d44e6
Merge: a081ca5b6 f94bf63bf
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Jul 27 10:39:13 2009 +0100

    merge bug21243 into default

commit f94bf63bf7a96b18a493aae4a54dfec85e6adb80
Author: Paul Jones <paulj@lshift.net>
Date:   Mon Jul 27 09:32:13 2009 +0100

    Factored out ebin root from rabbitmq-server script (windows and unix)

commit 9ca2be481ba6c3014e801b7bbc09e06d8d5dfbf9
Author: Paul Jones <paulj@lshift.net>
Date:   Fri Jul 24 21:58:59 2009 +0100

    Factored out RABBITMQ_EBIN

commit c4d1152bbc7fd0a0f214a1b5d700f87f29376bc8
Author: Paul Jones <pauljones23@gmail.com>
Date:   Fri Jul 24 21:30:42 2009 +0100

    Eliminated error macro; changed location of error printout

commit 8ab36ee368da5c155cff0107a2d2ad0cab39a3b9
Author: Paul Jones <pauljones23@gmail.com>
Date:   Fri Jul 24 21:24:26 2009 +0100

    Fixed handling of symlinks; compacted list comprehensions

commit 5356d0f3e360525ec7f479a8dbdec35e87103541
Author: Paul Jones <pauljones23@gmail.com>
Date:   Fri Jul 24 21:04:51 2009 +0100

    Fixed variable name - changed from UNPACKED to EXPAND for consistency

commit 6cd0e375a48c6b38dbdfae0b65368f79e2ab3215
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 24 18:42:25 2009 +0100

    cosmetic

commit e14431f715a1edcc9a2b5df1757b4bd574c11196
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 24 17:50:54 2009 +0100

    cosmetic

commit 57e0a3be3fa973db550f917c9c88a3a2b4a22f2a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 24 15:18:26 2009 +0100

    don't include TimeoutState in status formatting
    ordinary timeouts are not shown as part of the status, so it doesn't
    make sense to show the special ones. Also, the code was incorrect.

commit 16e27751f94f5ffa847573457db546853627dec8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 24 13:49:02 2009 +0100

    remove R13B-1ism

commit a081ca5b67d101f92657422f3742fab6c798c14b
Merge: 98d1423b6 ffdd99b4e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 24 13:02:33 2009 +0100

    merge bug21029 into default

commit 48048bc16a23bf7af44f317409d5dcad1ddf667d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 23 15:37:48 2009 +0100

    cosmetic

commit 4c20ef3422392bb451f13702b7a550c34df31e49
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Jul 23 11:51:02 2009 +0100

    Delete the plugin unpack directory before starting

commit aa9fb479012e7d3660ecb00211d6817ecee2ae55
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Jul 23 10:53:18 2009 +0100

    Added Windows plugin management/support scripts

commit 4a1472e5d6681f600b1800a3d83a4a5618811eb6
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Jul 23 10:53:05 2009 +0100

    Added more conditional diagnostics

commit 0faabecf7bbe9bfe5a92547797305b40208a098f
Author: Paul Jones <paulj@lshift.net>
Date:   Thu Jul 23 09:28:30 2009 +0100

    Reworked dependency expansion mechanism to not overexplore known dependencies; eliminated crash-dump when an unknown dependency is encountered

commit 7d855da0676962fbf9c86831e67964c47ac7a86d
Author: Vlad Ionescu <vlad@lshift.net>
Date:   Wed Jul 22 16:24:03 2009 +0100

    adding support for sync-ing the writer with the erlang client channel

commit 6684041b528470a10ed620d0425adb9d323cf789
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 22 16:17:53 2009 +0100

    Hid debug statement using a disabled macro

commit a184554804de3905c01e3bbb49c0308ed3b51b14
Author: Paul Jones <paulj@lshift.net>
Date:   Wed Jul 22 16:17:32 2009 +0100

    Updates to rabbitmq-server script to eliminate warnings about hidden files; ignoring generated directories

commit c0d98e1713f9e21c9e03615ef24dec6cc0d11639
Author: Paul Jones <pauljones23@gmail.com>
Date:   Wed Jul 22 15:48:50 2009 +0100

    Added a rabbit_plugin_activator to generate a .boot file for Rabbit; changed startup script to use this file if available

commit 1a3b107a92397fdf60ed370ad11877024922c2c0
Author: Paul Jones <pauljones23@gmail.com>
Date:   Wed Jul 22 15:13:00 2009 +0100

    Removed the existing rabbit.rel file, which does not appear to have been updated in many,many versions

commit ea0ec284855f706e65a9643ac1d6335c1439332b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jul 21 23:14:17 2009 +0100

    cosmetic

commit 734b8e60fdf05fc541c61fed025cd35a3c07311f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 19:30:49 2009 +0100

    Prefetcher appears to be done and working well. None of the tests exercise it though because I decided to only start it up when in mixed mode and when the amqqueue_process starts to hibernate (otherwise, we start it up too soon, it doesn't make much progress and then we just have to shut it down anyway). However, other manual tests definitely exercise it and it seems to be very effective. Certainly can't make it crash now.

commit 8e48a4bbb3ae51e2b6eb6b2f8b8154e24a25c14c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jul 21 17:43:55 2009 +0100

    raise minimum required otp version for dialyzer support to R12B-5
    since we depend on some new features, notably the 'timeout()' type.

commit 21d96ff7298e027d954bdd0058d0adaffebfa36a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 13:44:30 2009 +0100

    sigh, another stupid bug which none of the tests catch and which I just happened to spot by reading the code. I am deeply alarmed by how many of these sorts of bugs I am finding and how many more there must be. OTOH, they do seem to crop up much more in code which has been changed substantially and repeatedly, though it's very possible that's just because I'm looking there more than elsewhere.

commit 1c003c407e9c727189343a97a5f80d036914bb0c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 13:07:23 2009 +0100

    Fixed a bug in the mixed_queue which could lead to messages being marked undelivered when in fact they have been delivered when converting to disk_only mode. In truth, this bug didn't exist because there is no way in which a message could end up in that form in the mixed_queue which had previously been delivered. However, that will change when the prefetcher comes in, necessitating this "bug" gets fixed.
    
    The solution is to make tx_commit not just take a list of msg ids in the txn, but to take a list of {msgid, delivered} tuples. In this way it mirrors the disk_queue:publish function in that the delivery flag can be set explicitly.
    
    Tests adjusted. All tests pass.

commit 021518d51c71981e7cf44cf55e2739ae0ae8709a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 12:45:49 2009 +0100

    minor doc typeos and formatting

commit dd90570105929f29fa2c4e78e98ee544952af3e2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jul 21 12:34:47 2009 +0100

    make dialyzer happy

commit 3744e9042d23445ca5742316efc32f1bd95cf5da
Author: Marek Majkowski <majek@lshift.net>
Date:   Tue Jul 21 12:30:02 2009 +0100

    code coverage is a bit more generic now, removed reference to hardcoded ebin directory

commit fbb198bfdebf3cecd7469821d61a7261cc8f3ca2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 12:23:42 2009 +0100

    bare non-functioning skeleton of prefetcher. Essay written on design of prefetcher and its limitations.

commit 83d676cb1221e86bcaec55e3291262b7fc88627f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 21 11:29:18 2009 +0100

    Stripping out old broken prefetch. Also reverted gen_server2 back to the revision at the end of bug21087 on the grounds that the min_pri stuff wasn't enormously compelling and added a good chunk of complexity. Also, I don't believe it'll be needed for the new prefetcher. All tests pass.

commit 0ed5c3fc2db7c1e865d204836df3d1bb55f85186
Merge: eff819096 98d1423b6
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Jul 21 09:19:27 2009 +0100

    Merge with upstream. Clean no conflicts to resolve

commit 98d1423b60938225c7e0797a5b191928193bfa82
Merge: 0d611f118 fd58bef97
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jul 20 17:12:28 2009 +0100

    merge bug21189 into default

commit fd58bef978feaef4c5f56334581d9d50eabc270f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Jul 20 09:10:12 2009 +0100

    No longer call cleandb from clean.

commit e3503c1672da06391ff10a301ed751931fd89407
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Jul 19 16:47:14 2009 +0100

    Fixed the commit bug. Really this should probably be in bug20470 but I really didn't want to have to deal with merging and the other information about this bug is in the above comments in 20980 so it's in here.
    
    Now on commit, we test to see if we need to sync the current file. If so then we just store all the txn details in state for later dealing with. If not, we really do the commit there and then and reply. Interestingly, performance is actually better now than it was (see details in bug20470) but, eg, the one-in-one-out at altitude test has further reduced fsyncs from 21 to 6 and now completes in 2.1 seconds, not 3.6 (altitude of 1000, then 5000 @ one in, one out, then 1000 drain). All tests pass.
    
    We now guarantee that the messages will be fsync'd to disk _before_ anything is done to mnesia, in all cases of a txn_commit.

commit 1c3e228929a4828e8d731b63db05d31b4d66107d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Jul 19 00:48:48 2009 +0100

    Spotted and corrected some mistakes where messages published to the mixed queue in disk-only mode would not be marked delivered even if they were persistent, thus resulting in redelivery on broker startup without the message being marked predelivered.
    
    Also, spotted (not fixed yet) bug in commit coalescing in which the mnesia transaction is always commiting before the messages are flushed to disk. What should happen is that if coalescing is going to happen, the mnesia transaction should be delayed too, and happen only _after_ the disk sync. I.e. it doesn't matter if we disk sync and then the mnesia txn fails, but it does matter if the mnesia txn succeeds and then the disk sync fails.
    
    Also, I think I've worked out how to do prefetching properly. It's not actually that complex.

commit 1cf7c30120d48a2d6e4820e7f858119463e3ae51
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 17 17:26:37 2009 +0100

    ok, limits on the cache, and on prefetch.
    
    I decided the right thing to do is to prefer older messages in the cache to younger ones. This is because they're more likely to be used sooner. Which means we just fill it up and then leave it alone, which is nice and simple.
    
    Things are pretty much ok with it now, but the whole notion of prefetch is still wrong and needs to be changed to be driven by the mixed queue, not the disk_queue. For one reason, currently, if two or more queues issue prefetch requests, and the first fills the cache up, then the 2nd won't do anything. The cache is useful, but shouldn't be abused for prefetching purposes. The two things are separate.

commit 3e16b75ac21e8dabd5c8bcfe4ac11cd67a4f19c7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 17 15:12:04 2009 +0100

    part 2 done. The mixed_queue is back to using only one queue. Start up time isn't too bad with big queues, and memory use is stable. In disk_queue, when iterating through the mnesia table, do the normal limited batching for removal of non-persistent messages.

commit b1f86bacbee9d1d3a61dd8f03d7ea3b47484ed52
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 17 13:03:17 2009 +0100

    The use of the in-memory run length queue in disk_only queue is considered a show stopper, and rightly so. I personally don't like the idea of adding additional tokens to the disk queue to indicated queue switch because it can substantially increase the number of OS calls and writes and reads from disk and, eg, getting queue length right and memory size right is made a fair bit more complex. So abandon the two queues idea.
    
    Instead, store the persistent flag in the stop byte on disk. Then on startup, the persistent flag turns up in the MsgLocations ets table. This is all done and all tests pass.
    
    The next stage is that on start up, go through each queue and just wipe out non-persistent messages. This should be pretty fast. Then call the shuffle_up function as is currently being done. This will eliminate the gaps in sequences. This really should be enough. Then the mixed_queue can go back to just talking about a single queue.

commit c196178600ced8eec833902be30309d076f98e4a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 16 18:08:41 2009 +0100

    Well it's better. The memory size is now recovered at start up by doing a foldl on the entire queue. This seems excessive, but it does work. It only takes 75 seconds on my machine to get through 1e6 1024-byte messages, and 160 seconds to get through 2e6 1024-byte messages. So that doesn't worry me any more. Also, it's done in constant memory... ish[0].
    
    Also fixed the queue_mode_manager. Registration does not now produce a mode. Instead, it assumes you're starting up in disk only mode and then the first memory_report will result in the correct mode being set. This is safe and prevents a potentially deadly prefetch being sent when a queue starts up in mixed mode only to be sent to disk_only mode.
    
    However, the disk_queue has to start up in mixed mode because if it doesn't it has no way to estimate its memory use for disk mode. As such, it registers and then sends a report of 0 memory use. This guarantees that it can be put in mixed mode, thus it can then respond as necessary to the queue_mode_manager.
    
    I've not done anything further at this stage with the use of the erlang queue in the mixed_queue module when in disk mode (the potential per-message cost). Really you don't want to send individual entries here to the disk_queue, you want to batch them up... makes this rather more complex.
    
    [0] Sort of wrong. It can use the cache, and if you think about not too big queues sharing messages, this is clearly a good thing. But if there are lots of shared messages then it all goes wrong because the cache will get over populated and exhaust memory. Furthermore, the foldl is entirely in the disk_queue process. This means that during the foldl it won't be reporting memory and it won't be able to respond to request to change its mode.
    
    All of which points pretty strongly to the requirement that the prefetch needs to be somewhat more sophisticated.

commit b7296160859f56a9052fa8c79536f956c6fc4d3a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 16 14:34:29 2009 +0100

    Make cleandb no longer stop the node

commit 6467e9a1c93c5b88cee3b214f8e9fc89b83743cb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 15 18:03:21 2009 +0100

    Substantial changes to mixed_queue.
    
    Previously, persistent and non-persistent messages went into the same queue on disk. The advantage of this is that you don't need to track which queue you're currently reading from and for how many messages. However, the downside to this is that on queue recovery you need to iterate through the entire queue and delete all non-persistent messages. This takes a huge amount of time.
    
    So now this is changed. Each amqqueue is now two on disk queues. One for persistent messages and one for non-persistent messages. Thus queue recovery is now trivial - just delete the non-persistent queue. However, we now _always_ use the erlang queue in mixed_queue to track (in disk mode) how many of each queue we need to read (i.e. run-length encoding). This, in the worst case (alternating persistent and non-persistent) is per-message cost. It's possible we need some sort of disk-based queue (AGH!). Not sure. Provided the queue only contains one sort of message, it degenerates to a simple single counter.
    
    All tests pass. However, there is a bug, which is that on recovery, the size of the queue (RAM cost) is not known. As such, the reporting of the queue to the queue_mode manager on queue recovery is incorrect (it starts of 0, and can go -ve). I've not decided how to fix this yet, because I do not want to have to iterate through all the messages to get the queue size out!

commit eff819096a55a95284598cb14d5a9a9932bab764
Merge: 2d7d9016c 0d611f118
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jul 12 20:29:21 2009 +0100

    Merge with upstream

commit 407314953d34d39f38178b99797adf45d31b2f53
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 10 17:28:56 2009 +0100

    Just adding a bit more testing really just to bump the code coverage up.

commit 6e324890acea784e06eb413a0adedd6d3c27d299
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 10 13:24:25 2009 +0100

    prefetch part 1. When a mixed_queue sees that the next item in its queue is on disk, it issues a low priority prefetch instruction to the disk queue, which populates the disk_queue's cache. Note that this shouldn't impact on memory as by virtue of the mixed_queue being in mixed mode, the contents of the queue are already accounted for in memory even though they were on disk. The effect of this is that when the deliver comes, it doesn't need to go to disk to read the message as the messages are already in cache. Testing:
    
    A 100,000 * 1Kb msg queue takes 15 seconds to drain (basic.get, noack) when the messages are in memory, in the mixed queue.
    On disk, without prefetch, takes 32 seconds
    On disk, with prefetch, cache hot, takes 25 seconds.
    
    The next step is to get the disk queue to signal back to the queue that the prefetch is done and for the queue to grab the messages from the disk_queue in advance, thus meaning that on delivery, all that is needed is the async acks being sent to the disk_queue (assuming the messages are not actually persistent).

commit 7ad7748202180cbf25322a133757cce143f71d71
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 10 10:00:12 2009 +0100

    Adjusted documentation

commit 8e28836f1e870eaaef82827e6c78543f9a44e2b3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 17:26:50 2009 +0100

    *cough*

commit 547824a8c5eed6a2d1d7104767cc68c01fe04a32
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 17:25:40 2009 +0100

    ...and with some testing and debugging, it might even work as described in the documentation!

commit 0adb21fbca543428a06e968e6d91d6d770864cb8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 17:10:10 2009 +0100

    additional documentation

commit b69a05cf71eca2b083fe5c370eb7a2595d0f52e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 17:06:30 2009 +0100

    Initial work to permit low priority background tasks to be catered for.

commit 30d8f863ab27e650d57559b1fd20ae43a4d709f8
Merge: efba2704f 40b218b94
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 15:30:55 2009 +0100

    merging in from 21087. In testing, observed oscillation - with lots of queues, give 2 queues the same length such that they can't both fit in memory, and slowly trickle in messages. As each one gets a message, it'll force the other one out to disk (the other one will either be in the hibernating or lowrate groups). This is bad. Therefore, adjusted the conditions under which we bring a queue back in from disk to exclude queues that are either hibernating or low rate (don't forget, even a list_queues will wake up a queue and cause it to report memory). If you have two fast queues then neither of them will be in the groups of low rate or hibernating queues, so neither will be candidates for eviction so the problem doesn't exist there, instead, if they need more memory and can't fit in ram then they'll evict themselves to disk rather than anyone else.
    
    Also realised that a million queues isn't unreasonable, so minimum number of tokens in the system should be more like 1e7 if not higher.

commit 40b218b9469666282e6fb4b5c075ad3b37b9b6b8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 15:01:14 2009 +0100

    *idiot*.

commit efba2704f58ed58c8e0b7310eeff7974024e0177
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 12:27:59 2009 +0100

    length is never used in disk_queue, so removed

commit 43b0c22c9b5fd2f0990e3ca6a35cab1e6959de88
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 11:37:10 2009 +0100

    minor documentation fix.

commit 638246ba369774db9ad268dc6a8bb68d3b7b8a59
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 9 11:00:48 2009 +0100

    Fixes from removing the non-contiguous sequences support from the disk queue that I failed to spot last night, but apparently came to me during my dreams. I have no idea how the tests managed to pass last night...

commit cb8e40836c51fa9a731360f60dedc69abc6a120c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 8 23:59:30 2009 +0100

    The mixed queue contains in its queue knowledge of whether the next message is on disk or not. It does not use any sequence numbers, nor does it try to correllate queue position with sequence numbers in the disk_queue. Therefore, there is absolutely no reason for the disk_queue to have all the necessary complexity associated with being able to cope with non-contiguous sequence ids. Thus all removed. This has made the disk_queue a good bit simpler and slightly faster in a few cases too. All tests pass.

commit bcd079cd3960b7aa3259148f825898410f5477e2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 8 14:28:01 2009 +0100

    added requeue_next_n to disk_queue and made use of it in mixed_queue:to_disk_only_mode. This function puts the next N messages at the front of the queue to the back and is MUCH more efficient than calling phantom_deliver and then requeue_with_seqs. This means that a queue which has been sent to disk, then converted back to mixed mode, some minor been done, and then sent back to disk takes almost no time in transitions beyond the first transition. The test of this:
    
    1) declare durable queue
    2) send 100,000 persistent messages to it
    3) send 100,000 non-persistent messages to it
    4) send 100,000 persistent messages to it
    5) now pin it to disk - it'll make two calls to requeue_next_n and should be rather quick as it's only the middle 100,000 messages that actually have to be written, the other 200,000 don't even get sent between the disk_queue and mixed_queue in either direction. A total of 100,003 calls are necessary for this transition: 2 requeue_next_n, 100,000 tx_publish, 1 tx_commit
    6) now unpin it from disk and list the queues to wake it up. The transition to mixed_mode is one call, zero reads, and instantaneous
    7) now repin it to disk. The mixed queue knows everything is still on disk, so it makes one call to requeue_next_n with N = 300,000. The disk_queue sees this is the whole queue and so doesn't need to do any work at all and so is instant.
    
    All tests pass.

commit cc9b1438b2441ebc7bc3c345fbc2b2b1f528821a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 8 12:35:10 2009 +0100

    found a bug in the memory reports in combination with hibernation in that if a process comes out of hibernation, then does under 10 second's work before hibernating again then it'll only issue a memory report when it goes back to hibernation, thus it'll always claim to the queue_mode_manager that it's hibernating. Thus now, when hibernating, or when receiving the report_memory message, we set state so that when the next normal message comes in, we always send a memory report after that message. This ensures that when a process wakes up and does some real work, the queue_mode_manager will be informed.
    
    Applied this, and the ability to hibernate to the disk_queue too. Plus some minor refactoring and better state field names. All tests pass, and the disk_queue really does hibernate with the binary backoff as I wanted.

commit 9e722b4cb4f1a49a3cc3f50b9e1e4fcf442996fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 7 18:02:52 2009 +0100

    Sorted out rabbitmqctl so that it sends pinning commands to the queue_mode_manager rather than directly talking to the queues. This means the queues and the queue manager can't disagree on the mode a queue should be in.

commit b94bc69b0694ddafc81301006c3a09f9f81b39ad
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jul 7 17:28:12 2009 +0100

    lots of tuning and testing. Totally rewrote the to_disk_only_mode in mixed_queue so that it does batching. This means that it won't just flood the disk_queue with a billion messages, thus exhausting memory. Instead it does batching and uses tx_commit to demarkate the batches. This means the conversion happens as quickly as possible and does not exhaust memory. Dropped the memory alarms to 0.8. This is a good idea because converting queues between modes transiently takes a fair chunk of memory, and leaving the alarms up at 0.95 was proving too high making the mode transitions exhaust ram and swap to buggery.
    
    However, there is a problem when going to disk_mode in mixed queue where messages in the queue are already on disk. A million calls to phantom deliver is not a good idea, and locks a CPU core at 100% for a very long time.

commit d4c8c48f33176426c5fcfaf0da2f7a76ef335f89
Merge: 804c4e605 1bc10a531
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 17:57:15 2009 +0100

    oh look, another merge in from 21087

commit 1bc10a5312d6b7e622bf79a7e7022755955131fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 17:56:55 2009 +0100

    a) reverted the change to do_send which had come in when I updated gen_server2 to R13B1 - this was a change originally made by matthias to ensure that messages cast to remote nodes are done so in order
    b) Add guards and slightly relax name/1 so that it works in R11B5. All tests pass in R11B5 and manual testing of the binary backoff hibernation shows that too works.

commit 804c4e605133b36efaded6bb05e20998255d2b01
Merge: d5887a30d 16aa27d41
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 16:59:40 2009 +0100

    (another) merge from 21087 (not 21097 as mentioned in previous commit)

commit 16aa27d41a49e98560d819dad1578b431c812e12
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 16:59:04 2009 +0100

    All cosmetic (line length)

commit d5887a30de3921f4447b7069a64780450150b040
Merge: 8889e29c5 f74caf2fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 16:52:32 2009 +0100

    merge from bug21097

commit f74caf2fce579ac9fe9842d66fb09affa7c199a3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 16:39:28 2009 +0100

    Pushed the binary exponential timeout / hibernate system into gen_server2. Adjusted amqqueue_process to use it. Added documentation. Tested thoroughly with explicit test module (not added), and full test suite, which all passed. Existing tests further up in this bug similarly pass and demonstrate code is functioning correctly.

commit ffdd99b4ec70ac416ab30d49adaba043ecbda374
Author: David Wragg <dpw@lshift.net>
Date:   Mon Jul 6 15:17:29 2009 +0100

    EPEL no longer need this PATH setting, so get rid of it.
    
    EPEL now includes the erlang-R12B-5.6 package, which has a
    /usr/bin/escript symlink.

commit e113f301ad2e6de05752698c9d2b851ff9127c5a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 13:54:17 2009 +0100

    updating gen_server2 with latest from R13B01 in order to ensure this doesn't slip badly behind the shipped version.

commit 8889e29c54f5adde8310eba77c23dc837cf46230
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 12:29:50 2009 +0100

    Added documentation

commit 87f54b87942e72ed663ea2272ee49d835e4605c8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jul 6 11:50:28 2009 +0100

     testing shows these values work well. The whole thing works pretty well. Obviously, converting a mixed queue to disk does take some time and the values are deliberately set low to save memory because on this transition, the disk_queue mailbox will go insane and eat lots of memory very quickly. But it seems about the right balance. I'll add documentation next

commit e5962c4232be43111fb7ca4a60fa0360f49ee9f5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 3 17:43:52 2009 +0100

    Reworked. Because the disk->mixed transition doesn't eat up any ram, there is no need for the emergency tokens, nor any need for the weird doubling. So it's basically got much simpler.
    
    We hold two queues, one of hibernating queues (ordered by when they hibernated) and another priority_queue of lowrate queues (ordered by the amount of memory allocated to them). We evict to disk from the hibernated and then the lowrate queues in their relevant orders. Seems to work. Oh and disk_queue is now managed by the tokens too.

commit 9fc504937632389a8570606f3b9518f13e6a8e24
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jul 3 10:24:33 2009 +0100

    report memory:
    a) when we're not hibernating, every 10 seconds
    b) immediately prior to hibernating
    c) as soon as we stop hibernating

commit 79c53e4fa94c79d2de98f2d68d2ffa6997862ac0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 18:20:05 2009 +0100

    wip, dnc.

commit 232fc2a35b8836c81c401db0279dba7951a56edc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 17:42:17 2009 +0100

    cosmetic

commit a29a0b1e7e135e6b10f38900ff2426302fe8d1bd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 17:35:48 2009 +0100

    well if we're going to not actually pull messages off disk when going to mixed mode, we may as well do it really lazily and not bother with any communication with the disk_queue. We just have a token in the queue which indicates how many messages we are expecting to get from the disk queue. This makes disk -> mixed almost instantaneous. This also means that performance is not initially brilliant. Maybe we need some way of the queue knowing that both it and the disk_queue are idle and deciding to prefetch. Even batching could work well. It's an endless trade off between getting operations to happen quickly and being able to get good performance. Dunno what the third thing is, probably not necessary, as you can't even have both of those, let alone pick 2 from 3!

commit 9c1c368264f6845e36e710180291202290ac4b35
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 16:29:13 2009 +0100

    Sorted out the timer versus hibernate binary backoff. The trick is to use apply_after, not apply interval, and then after reporting memory use, don't set a new timer going (but do set a new timer going on every other message (other than timeouts)). This means that if nothing is going on, after a memory report, the process can wait as long as it needs to before the hibernate timeout fires.

commit 2de81da3082a0f9010c7e89001ea3df91d21da84
Merge: 99f80aea7 010fc2a0c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 15:38:36 2009 +0100

    merge in from 21087. Behaviour is now broken because the timeout can get > 10seconds which means the memory_report timer will always fire and reset the timeout - thus the queue process will never hibernate.

commit 010fc2a0cc744109eef8d6e8be34297518df5d4d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jul 2 14:49:06 2009 +0100

    Done. In order to keep the code simple, the detection of naptime is done in reply and noreply functions. This means that the now() value there includes computation relating to the last message in. This is maybe not desirable, but the alternative is to wrap all of handle_cast, handle_call and handle_info. Nevertheless, testing shows this works:
    
    in the erlang client:
    
    Conn = amqp_connection:start("guest", "guest", "localhost"),
    Chan = lib_amqp:start_channel(Conn),
    [begin Q = list_to_binary(integer_to_list(R)), Q = lib_amqp:declare_queue(Chan, Q) end || R <- lists:seq(1,1000)],
    Props = (amqp_util:basic_properties()).
    
    [begin Q = list_to_binary(integer_to_list(R)), ok = lib_amqp:publish(Chan, <<"">>, Q, <<0:(8*1024)>>, Props) end || _ <- lists:seq(1,1500), R <- lists:seq(1,1000)].
    
    Then, after that lot's gone in, in a shell do:
    
    watch -n 2 "time ./scripts/rabbitmqctl list_queues | tail"
    
    The times for me start off at about 2.3 seconds, then drop rapidly to 1.4 and then 0.2 seconds and stay there.

commit 99f80aea7d1afe8c0137dbbd3228f370cf82a91c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 1 18:48:35 2009 +0100

    When converting to disk mode, use tx_publish and tx_commit instead of publish. This massively reduces the number of sync calls to disk_queue, potentially to one, if every message in the queue is non persistent (or the queue is non durable).

commit f58589539ce169a0e23ee05dfd43fec170250e13
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jul 1 17:53:53 2009 +0100

    Well after all that pain, simply doing the disk queue tests first seems to solve the problems. I don't quite buy this though, as all I was doing was stopping and starting the app so I don't understand why this was affecting the clustering configuration or causing issues _much_ further down the test line. But still, it seems to be repeatedly passing for me atm.

commit 0d611f1188edc7b8f9da7935e21865fb49163a14
Merge: da5a1fd5b d87dab3ea
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jul 1 13:43:18 2009 +0100

    merge bug21060 into default

commit d87dab3eaa2d7e88a3be2fd8d724a36d6fa63144
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jul 1 13:23:57 2009 +0100

    better exception tag

commit ce40f4fce04ca0fc9482d483981a11b682d50f85
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jul 1 13:23:26 2009 +0100

    fix another off-by-one error

commit 092af4767e05b179ae7e00e27471c2289b79fb00
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jul 1 13:23:08 2009 +0100

    fold

commit 2da0708dd41a59562cc133022f1493b81a49a114
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jul 1 13:06:48 2009 +0100

    Fix off-by-one error (discovered by Matthias)

commit cd42e2fe64cdd1f993a2917a162de22edf707bef
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jul 1 12:55:41 2009 +0100

    cosmetic

commit 0467f46ce844d8e08e919f502d2a9dd686b11a47
Merge: d66a20081 d42a1dd62
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 18:09:14 2009 +0100

    merge, but it still doesn't work. Sometimes it blows up on clustering with "All replicas on diskfull nodes are not active yet".

commit d42a1dd62a29a31a1cd79685a1053c9af2af0190
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 18:04:11 2009 +0100

    Well, this seems to work.

commit 5934ddc48aa095c95eb9dd8260a74c72614d5673
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 17:49:32 2009 +0100

    and now clustering seems to work again...

commit d66a200813e0483d4a171f3815a16436371fac92
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 16:24:50 2009 +0100

    changed disk -> mixed mode so that messages stay on disk and don't get read. This means the conversion is much faster than it was which is a good thing, at the cost of slower initial delivery.

commit 675e13c1ade6c1a13d6215ab52f5c9095e09547f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 12:52:50 2009 +0100

    just adding timing to the dump test

commit c246eefb2e42029ecfa18a57f1fb3e55a5c03aac
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 30 11:00:35 2009 +0100

    doh!

commit 5c64ee0c50de0d9b3f6e382b9ec8d66ea5a4d51b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 29 18:01:10 2009 +0100

    mmmm. It maybe sort of works. Needs work though

commit 10aa354784bb711c8c0329a5623fc9a6a90c40d2
Merge: 00485709f 19b343acf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 26 18:30:03 2009 +0100

    merging in from 20470

commit 19b343acfe0e7698eab93539f8d2bd612a4b9570
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 26 18:19:34 2009 +0100

    Had been thinking about this optimisation for a while but someone mentioned it to me yesterday at the Erlang Factory conference.
    
    When you sync, you know that everything up to the current state of the file is sync'd. Given that we're always appending, we know that any message before the current length of the file is available. Thus when we're reading messages from the current write file, even if the file is dirty, we don't need to sync unless the message we're reading is beyond the length of the file at the last sync.
    
    This can be very effective, for example, if there are a few hundred messages in the queue and then you're reading and writing to the queue at the same rate, then this will mean that rather than doing a sync for every read, we now only sync once per size of queue (altitude or ramp size). Sure enough, my publish_one_in_one_out_receive(1000) (altitude of 1000, then 5000 @ one in, one out) reduces from 6089 calls to fsync to 21, and from 15.4 seconds to 3.6.
    
    It's also possible to apply the same optimisation in tx_commit - not only do we now return immediately if the current file is not dirty or if none of the messages in the txn are in the current file, but we can also return immediately if the current file is dirty and messages are in the current file, but they're all below the last sync file size.
    
    Surprising very little extra code needed.

commit 534d0faae75ee774dfae6a7e378bba2351f9a7f8
Merge: 31d8836db da5a1fd5b
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Jun 24 23:31:48 2009 +0100

    Merge default into amqp_0_9_1

commit 00485709f0b41a09014deb355490036a9a52c062
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 24 23:27:29 2009 +0100

    some more scaffolding for tokens

commit 0a02dd9cd09af2132c4bf72e82a2d33daeb34cc1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 24 15:42:30 2009 +0100

    Changed reports so that we get bytes gained and lost since the last report.
    
    Also, the sync version of publish is unnecessary as we were only ever using it in one place where we threw away the result. Thus even when publishing a message and marking it delivered in one up (as opposed to publish_delivered, which is quite different ;) ), we can make it cast, not call, as we don't need the acktag.
    
    Also, the memory accounting was wrong for requeue in mixed_queue because requeue doesn't actually change the memory sizes (memory goes up on (tx_)publish, and down on ack/tx_cancel. Requeue has no effect. Nor does deliver.).

commit 681a2deadac15035531000daba40964e67c45ae7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 24 13:16:47 2009 +0100

    memory size tracking was wrong on startup in disk mode for mixed_queue (and actually for mixed mode too, given that mixed mode starts up in disk mode, then converts, which maintains the same size).

commit cb6cc18ed1abda641025bfb5ff5eba907f99bac2
Merge: 3b867a011 583511797
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 24 12:35:04 2009 +0100

    merging in from 19662

commit 583511797127748468d289dcce26d055b6d849dc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 24 12:31:48 2009 +0100

    Removed the dumb timer:sleep, and after testing, properly sorted out the mnesia clustering details. This means that wait_for_tables now waits for _all_ tables which means the bug that was requiring the timer:sleep has gone away.
    
    The solution to the clustering issue was to make sure that tables which are local content only are created explicitly on each node before you call wait_for_tables.
    
    All tests pass.

commit 3b867a0119b14e84b6edb65dadaa54349c2cded3
Merge: d2d83a733 9bcdac9c7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 17:30:06 2009 +0100

    merging in fix from 20470

commit 9bcdac9c76c5049c57fa510156dbe9f96a635320
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 17:29:21 2009 +0100

    Failed to either watch the logs or remember that the timer is cancelled on disk_queue exit

commit d2d83a73310a420656fad07007ba5a14a74938e2
Merge: de6a18c21 36d6cbebf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 17:05:31 2009 +0100

    merging in the recent non-tx performance fix in bug20470

commit 36d6cbebf04f68ad8563a71fafb064459695ae8a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 16:58:55 2009 +0100

    Right, whilst tx_commits were being coalesced, this was not done properly protect non-tx publishes from unnecessary syncs. As a result, performance, of say:
    
    rabbitmq-java-client/build/dist$ sh runjava.sh com.rabbitmq.examples.MulticastMain -r 3500 -s 12345 -f persistent -z 20
    
    was horrible when compared to bug19662 - about 5 times slower.
    
    Careful consideration of when we want to set the timer, when to cancel, and when the timeouts should be set has led to this revision which maintains the tx performance and restores non-tx performance.

commit de6a18c21c898d3b50289af08a16d6a4bd807af2
Merge: 5e9d51cbf cca6c8128
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 15:11:50 2009 +0100

    merging in bug19662 with reduced reverses

commit cca6c8128e4ddf2623c3bf837e07e51cd6a34d69
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 15:01:26 2009 +0100

    acktags in ack or tx_commit do not need to be ordered. Messages in tx_cancel do not need to be ordered either. Hence removal of quite a lot of lists:reverse.

commit 5e9d51cbf3b61c1b9bfe6bd176344dcc4b0e9ce7
Merge: 8f477b067 e9c209150
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 14:44:22 2009 +0100

    merging from bug19662

commit e9c209150c5f911928863498c0ee51784e5cb86e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 14:28:51 2009 +0100

    without this, rabbit_disk_queue seems to refuse to start up if there are messages to be recovered, due to mnesia not being running fast enough.

commit 8f477b067b49152a6e68f2197822002742bf6164
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 14:24:24 2009 +0100

    only reduce memory size when messages are acked, not when they're delivered.

commit afb63bcd59ea0bd7ba82316a42aba136d14a9963
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 23 12:07:05 2009 +0100

    Tidying up before starting to play with tokens.
    
    o) Removed redundant rubbish from manager
    o) Wired alarms straight to disk_queue (+ minor refactor)
    o) Removed reduce/increase_memory_footprint from control and amqqueue
    
    Testing shows that one of the reasons the memory estimates are off is because they only track messages in the queue - i.e. remove on deliver, not on ack. Watching ./scripts/rabbitmqctl list_queues name memory mode messages messages_ready messages_unacknowledged messages_uncommitted during various tests shows that acks are not getting through and so we actually need to track unacknowledged message size - i.e. remove on ack, not on deliver

commit 3cadfbd5c0fc45e390a414829bcf4ac388810cd8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 17:25:49 2009 +0100

    whoops, missed off a priority pcast.

commit 85f08fff3bc069fd4357e9b26da4aae0b4493d29
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 15:43:40 2009 +0100

    Added ability to manually set queue modes. Also altered manager so that if you are in all mixed mode, and then set one queue to disk, and then call increase_memory_footprint, you will indeed set that one queue back to mixed mode. And vice versa with mixed and decrease

commit 2413328c6add2a745480256a4a7d8cc4d0d4dc27
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 13:50:47 2009 +0100

    Added a time interval so that we report at a maximum of once per second. I guess the only reason for keeping the other counter which is the min number of messages the process has received between reporting memory, is that it's much faster to decrement that counter and ceq0 than do the time calculation for every single message.

commit 790e6cf6e736a95f89e13ebeb5f7659114d3359c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 13:32:44 2009 +0100

    Switched to tracking memory size of the queue at all times. Removed use of process_info(memory,self()) for reasons outlined in the bug comments. The annoying thing about using a 10% change as the threshold is that it means you get many many more updates when the queue is empty because the % change is much greater.

commit 8b558751b966b3e9cf7077bac999862de379f7d8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 12:51:02 2009 +0100

    These two fixes were done in 20980 but should really be in this branch.

commit 64e4ba35b4db99cd992c728741448a7a24bbb958
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 12:27:51 2009 +0100

    annoying bug which appeared ages ago and has only just been squashed. Meant queues were being started up in the wrong mode when in the "middle" mode...

commit 80572e52c3423b58ad4509564a64f9cf29a8035e
Merge: be7cce80e ce5ae4dc0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 12:04:47 2009 +0100

    merging in from bug19662

commit ce5ae4dc0d7857eb8748b847c90724bfb7ac7abb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 11:48:41 2009 +0100

    substantially bulked up the tests for this bug. All tests pass.

commit 0493ab53154269357795bbf602a3cbcc8a6e86e9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 22 11:02:16 2009 +0100

    fixed.
    
    There was a choice here of either pushing all the txn accountancy into the mixed_queue and taking it out of queue_process or just passing in all the txn pending messages to the mode switch. I chose the latter because the queue_process is already the more readable of the two modules and I didn't want to further complicate the mixed_queue. Also, this way is a smaller API change and really not that much code.
    
    Tests pass but I'm about to rewrite the test and bulk it up a bit. Also, running the previous tests - rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/MulticastMain -y 50 -r 100 -s 104857 -m 100 -z 120 - whilst running (reduce|increase)_memory_footprint is a good thing to do.

commit 281e1749de96329510f44fe986a579fe3ffbef9e
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Jun 22 10:34:03 2009 +0100

    Convenience rabbit_basic functions.

commit 2d7d9016c699a6650082b5a996dd551b6d2cd7b1
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jun 21 22:04:16 2009 +0100

    timeout() is now built in. Redefinition is deprecated

commit c412342142a3e3b1c92f85b5ee829f8f8e1a0d0a
Merge: 27e15fbe1 da5a1fd5b
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jun 21 22:02:38 2009 +0100

    Merge with upstream

commit ea2c26453586d616d0e37679f7d66c766000463d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jun 20 23:43:23 2009 +0100

    A test. The problem really does exist. Not worked out how to fix it yet.

commit 8f84cce78788d89d9d78ca61f77f7a130d148183
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jun 20 23:20:43 2009 +0100

    fixed bug documented in preceeding comment

commit be7cce80e3b9f47c7b326bfb97864de53e6cf4c2
Merge: a1a0c042f f39bd2efc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 19:11:49 2009 +0100

    Quite a horrendous merge of 19662. All tests pass.

commit f39bd2efcc19fc5ac8983fd78a542887f347fa6f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 18:26:39 2009 +0100

    comment typeo

commit e2735d50ed60bf8882c536cd2439bdf0a4a3a055
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 18:17:16 2009 +0100

    get_cache_info ==> cache_info.
    
    An even better test (see parent commit message) is:
    
    rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/MulticastMain -y 50 -r 100 -s 1048576 -m 100 -z 120
    
    Rabbit will now happily just sit there and work away (again, run reduce_memory_footprint twice first) even though it's seeing 100MB new a second which is going to 50 consumers, so 5GB a second. Needless to say, go back a few revisions, and it blows up within seconds.

commit ae6989591b7a6e430a4f4c6ec4e51ebb15377b38
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 17:52:00 2009 +0100

    Just added a means to get the ets:info out for the cache. Testing shows that it does seem to get emptied successfully.
    
    So, using this revision, if you run:
    
    rabbitmq-java-client/build/dist$ sh runjava.sh com/rabbitmq/examples/MulticastMain -y 10 -r 50 -s 1048576 -m 100 -z 120
    
    then over the two mins, I see beam take between about 30% and 45% of my memory, once it's up and running.
    
    Using the revision right after the API change, i.e. 9f0ee0399838, the same test tries to take between about 45% and 60% of my memory.
    
    Don't forget to run:
    
    rabbitmq-server$ ./scripts/rabbitmqctl reduce_memory_footprint
    rabbitmq-server$ ./scripts/rabbitmqctl reduce_memory_footprint
    
    before running the above test.

commit 6096fe52182b61165a5f36fe87c44730e645e2fa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 17:17:56 2009 +0100

    fixes

commit 3fc57e1b7fdfb948e8470b0b63d7ebe1e9c91c25
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 16:49:29 2009 +0100

    Added caching layer using ets which, when a message is shared between multiple queues, eliminates the need for multiple reads, provided the /next/ copy of the message is requested before the previous copy of the message has been acked. Should reduce memory pressure.

commit 656cbf75101146cac83dffee1ff708bc39d1498d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 15:35:44 2009 +0100

    Altered API so that the disk_queue understands about #basic_message. This means that the mixed_queue avoids unnecessary term_to_binary calls. Tests adjusted and whole test suite still passes

commit a1a0c042f5ce52807960287b1f44d7da03223a44
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 19 11:28:11 2009 +0100

    Reworked reporting of memory requests so that the queues are proactive about deciding when to report. This isn't quite good enough though because GC means the memory size fluctuates too much. Need to switch to just grabbing the size of the messages in the queue.

commit 58ea63ab02b7bebd9c442e018bc32ed1955095ba
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 18:16:26 2009 +0100

    wiring things up

commit 31789bf730f2e6d70719b7096da5479bf4480190
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 17:30:51 2009 +0100

    exercise tiny area of the code to try and suggest it might be a zero-sum game.

commit 8b71dcf0fb2e41fe3dc6adc5f044ef0b9b65caee
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 17:27:27 2009 +0100

    initial work making the mixed_queue keep track of some number vaguely related to memory use when it's in disk only mode which could be used to estimate how much more memory is needed to switch to mixed mode

commit 3d4e44e5a7cca75ce09c1bfa86d5eccd271f37ce
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 16:52:03 2009 +0100

    cosmetic

commit da5a1fd5b839d2ccbf83f17d618aae2184731ece
Author: Tim Clark <tim@lshift.net>
Date:   Thu Jun 18 16:16:35 2009 +0100

    Updated portfile for 1.6.0 release

commit 10bec707349d7c5f2935b7ce3c159fc92b423ea6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jun 18 15:54:55 2009 +0100

    tabs -> spaces

commit 2c635d61153bc3d5a6c953dc8c632129babbdc8b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 14:19:16 2009 +0100

    stop the commit timer if we're no longer dirty. This means it should no longer be a repeat timer because once it's set were either going to receive the explicit sync call or we're going to timeout on message queue at which point we're no longer dirty and so we'll then cancel the timer....

commit d51da63d259e8a687849b694d3a9ea2725b2fa56
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 14:03:48 2009 +0100

    Done. Problem was needing to reply instantly if we're not dirty.

commit 8e591680477737f657bbe1ef4485acd9bf548dc9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 13:27:42 2009 +0100

    well, I think it works, but it's now much much slower.

commit 80cd8f686e4efc52c07703015ecd1f4c781dcbab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 10:54:39 2009 +0100

    removing two usused functions: publish_with_seq and tx_commit_with_seq

commit 487491b83974137277eddc2c0c63af62d4074d05
Merge: 89abd7a1e 203aeae69
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 10:33:24 2009 +0100

    just merging in identical change from default

commit 203aeae69f987c7e7809e2c99297dc8841c60c8e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 10:32:56 2009 +0100

    TMPDIR should be honoured by Makefile

commit 89abd7a1e9b7a046d46d8f2f46c9f77ad2824763
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 18 10:25:22 2009 +0100

    fixing up my issues with tmp dir, hopefully once and for all. TMPDIR is a standard unix variable which should be honoured

commit bd121a01a2c12df6ef68a094cdf9407834676947
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 23:44:25 2009 +0100

    removal of two unused functions from disk_queue. There are two more unused functions which I can't work out what to do about... Also cosmetic

commit 5b76f375732b0598ae75243ff0642b4cbbb8b919
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 17:40:23 2009 +0100

    preemptive tidying

commit 1e82dd6080d98a8403dc8895587901e9716b873e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 17:31:47 2009 +0100

    sorted out specs.

commit acc792f4e979b8def4268ccdfc25b396a3af334d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 16:37:51 2009 +0100

    comment

commit 57e318d588dd424370d68f61d01b8e946f80ec5a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 16:31:01 2009 +0100

    FunAcc0 ==> FunAcc

commit 873a328c0467adca7a44e8ee4545f4b2404336e1
Merge: ca74c1e10 369c7fa6b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 16:26:07 2009 +0100

    merging in default

commit ca74c1e1091c837c79e8d2cd8c0156837481a18f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 16:07:02 2009 +0100

    more renaming and mnesia change to bat file

commit b66751612a51666f989de580a8c3f4fd5c27d27b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 15:44:55 2009 +0100

    Renaming variables. All tests still pass

commit dbfc0120b8738ecb283a104a57a12dbb4fb64866
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 14:54:46 2009 +0100

    added batching for autoacks for general run_message_queue

commit d0343eeae8640130339cc65fb647b13e4204241b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 14:10:17 2009 +0100

    adjusted HO-ness in deliver queue beautifully. Thus in the deliver_from_queue case, we now reduce n calls to mixed_queue:is_empty to 1 call and pass around the remaining count as the acc. l33t

commit dec6c5116961922efb237618445bdede02001b79
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 13:33:38 2009 +0100

    More tidying

commit 798932efee2b15f8d3bf7549fc8337a0722ff510
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 13:20:25 2009 +0100

    further discussion

commit c46fb0b9d87e5dcbfc0d3bec8755e6d1bb1a575c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 13:18:15 2009 +0100

    post case/if discussion

commit bd4eeb1707296cff0af65ccfa524b761d21fbbb9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 13:09:57 2009 +0100

    mainly if ==> case in suitable places, but also some formatting

commit 4ad4f4f855d32a0336c6a5fb46ae90ad0eea2234
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 12:53:27 2009 +0100

    tabs and line length

commit 0f044b9ee0564b24668c1ef3995248bea6e19c51
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 12:52:35 2009 +0100

    fixed line lengths

commit 1e1f45c489012726832f68faf2f0ea6a76623c6a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 12:14:09 2009 +0100

    Removing the failed experiment that was the odbc db queue

commit 2ac7f05027f68eee0d6600abbc2a05face219c0e
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 17 12:13:42 2009 +0100

    just removing tabs

commit 369c7fa6b90cf063ac31288b62f56629e33e2bee
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 15:09:18 2009 +0100

    Added tag rabbitmq_v1_6_0 for changeset 1588df06f913

commit 1db54c1fa3ed00f756c9779d778b64db139108fd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 15:07:12 2009 +0100

    add package changelog entries for 1.6.0 release

commit 9a2ea1f5f7f44041ffebc13953c031456d7a8017
Merge: d8fcfa932 e326cde5c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 13:55:21 2009 +0100

    merge bug20961 into default

commit d8fcfa9325aea778c21aaa5172504371b9761dfa
Merge: 7bb1f75fd 0bca5bdb6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 09:16:02 2009 +0100

    emergency merge of bug20958 into default
    further qa is still required

commit 7bb1f75fd47505f60178738bc8c16d84efdc17e5
Merge: 2ba7e3fbe 527a72bf8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 07:14:55 2009 +0100

    merge bug20979 into default

commit 2ba7e3fbe3183f647bd7e2eda5c0bea9fe20a4c5
Merge: 549f17cfa cf1d31bc7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 16 07:12:59 2009 +0100

    merge bug20976 into default

commit 0bca5bdb67206d3f327cda53aa7f41ca40d156e3
Author: Tim Clark <tim@lshift.net>
Date:   Sun Jun 14 18:30:30 2009 +0100

    FIx for escaping of arguments

commit e326cde5cba9eb68db71b0695168142078257ffa
Author: Tim Clark <tim@lshift.net>
Date:   Sun Jun 14 18:28:38 2009 +0100

    Fixing up escaping of commandline arguments

commit 527a72bf8e3a4782edd3483c62e31a7d4ef168ee
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 12 16:05:46 2009 +0100

    cleandb is now an rm -rf and build depends not on mnesia

commit cf1d31bc784452fa597c1b7d751918d51763a835
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 12 14:57:13 2009 +0100

    Altered dependencies and added comment to the app

commit b954691aabfddd323c2431dffe17c99991029e14
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 12 12:51:45 2009 +0100

    Yep, as I'd thought, the next_seq_id field was totally unused for anything useful. The code is thus now a good bit simpler.

commit 5f60f56f04b9a2654465648f3e1757f6a0d8ed86
Author: Tim Clark <tim@lshift.net>
Date:   Fri Jun 12 10:17:11 2009 +0100

    Attempt to fix regexp in Portfile

commit 45985629a920cdc2e66fdd67d63a15edf12fc778
Author: Tim Clark <tim@lshift.net>
Date:   Fri Jun 12 09:45:05 2009 +0100

    Changes to version and checksums

commit be5837815fad0f5073031c4c5c377836267cd702
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 12 00:54:48 2009 +0100

    Made mixed_queue track its length by itself. This avoids synchronous calls to the disk_queue when operating in disk only mode and seems to have substantially improved performance (in addition to avoiding a sync call, repeated lasting for the length of a queue (erlang stdlib) with a million+ items in it can't have been cheap). It now seems to be very much the case that when coming out of disk only mode, huge back logs are recovered reliably.
    
    Also, added reduce_memory_footprint and increase_memory_footprint to control. Both can be run twice and alter whether the disk_queue changes mode or the individual queues.

commit 45bc68c0f95116be2a54c7cab546e7cee607db0b
Merge: f66d8d4e1 549f17cfa
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 11 23:15:59 2009 +0100

    merging in from default

commit 549f17cfa6f1b305991e4df6765f06d0f43001b8
Merge: 4948fcbb6 5c21de904
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 11 22:17:46 2009 +0100

    merging in bug20943

commit f66d8d4e1b3be9f43762677abf0d4a39128ad658
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 11 11:52:38 2009 +0100

    And suddenly it works. Testing showed that removing the crude limit UNSENT_MESSAGE_LIMIT made performance better. This then made me wonder if the unblock and notify_sent messages weren't getting through fast enough, and sure enough, using pcast is much better there. Also, turning on dbg:tpl showed that the common path in mixed_queue was to call publish_delivered (i.e. the message has been delivered to a consumer, we just need to record this fact). Making sure everything in there for the non-persistent, non-durable but disk-only mode is asynchronous also helped performance massively.

commit 5c21de9043cc51059f27bfc875c2d11dd4cd68dc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 23:50:40 2009 +0100

    refactoring: rename "round robin" to "active consumers"

commit 096e6d4324034290f20bcad5f86c70189130616c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 23:39:52 2009 +0100

    proper round-robining even when blocking
    This involved some substantial changes to the queue internal data
    structures - mostly by choice; the new design is cleaner:
    
    - We no longer keep a list of consumers in the channel
      records. Now the channel records just contain a consumer count
      instead, and   that's only there for efficiency so we can more
      easily tell when we need to register/unregister with the limiter.
    
    - We now keep *two* consumer queues - one of active consumers
      (that's the one we've always had) and one of blocked consumers.
    
    We round-robin on the first one as before, and move things between the
    two queues when blocking/unblocking channels. When doing so the
    relative order of a channel's consumers is preserved, so the effects
    of any round-robining the active consumers get carried
    through to the blocked consumers when they get blocked and then back
    to the active consumers when they get unblocked.

commit a99b541be0332defa32c8ce7548acd9830c56892
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 21:02:54 2009 +0100

    well, I've made the acking for messages which are on disk but are not persistent/durable async, and it has improved some issues. But, if you switch to disk only mode, then allow, say 10k messages to build up (use MulticastMain) then switch back to ram mode, then it won't recover - the receive rate will stay very low, and rabbitmqctl list_queues will continue to grow insanely. This is very very odd, because querying the disk_queue directly for the queue length shows it drops to 0, but at least one CPU is maxed out at 100% use, messages continue to arrive, but the delivery rate never goes back up. Mysterious.

commit cf5e1ae896b8aceca66c776b3b98806eb3bfefcf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 20:06:04 2009 +0100

    Took advantage of the gen_server2 priorities.
    
    Reversed order  - i.e. now when swapping out, the first thing is to alter the disk_queue, and the 2nd thing is to alter the queues.
    And vice versa.
    
    The reasoning is as follows:
    Changing the disk_queue is a BIG operation because it affects every message in there, from all queues. In order to minimise the impa
    ct of this operation, we must do it first, not second, because if we do it first, only persistent messages from durable queues will
    be in there, whereas if we do it second, then all messages from all queues will be in there.
    Similarly, when swapping in, altering the individual queues is the first thing to do because it prevents the disk queue from growing
     further (i.e. only persistent messages to durable queues then make it to the disk queue), and each queue pulls out from the disk qu
    eue all the messages in there and so subsequent delivery from the mixed queue becomes very fast (actually, this is a total lie because of the call to rabbit_disk_queue:phantom_deliver in rabbit_mixed_queue:deliver - if I could get rid of this or at least make it async then that would greatly improve matters).

commit bff27f50060f08aed88e16c7473750b371eeee3b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 19:04:58 2009 +0100

    Added means to alter all queues and switch to disk_only mode in the disk queue.
    
    rabbit_queue_mode_manager:change_memory_usage(undef, true).
    
    this will first ask all queues to switch from mixed to disk mode, and will on a 2nd call, ask the disk queue to switch to disk only mode.
    
    rabbit_queue_mode_manager:change_memory_usage(undef, false).
    
    moves the other way.
    
    This all works, eg set MulticastMain pushing in messages and switch modes, and it's fine.
    
    One immediate problem is that as soon as everything becomes disk only, the performance suffers, so as a result messages build up. This is as expected. Then, going back to the middle mode (i.e. disk queue in ram_disk mode and queues in disk mode), the switch in the disk queue eats up a lot of memory. I suspect this is the effect of converting the mnesia table from disc_only_copies to disc_copies when there are 40k+ messages in there (one row per message). As a result, this conversion on its own is very dangerous to make. It might be more sensible to use the "weird" mode, where the queues are in mixed mode and the disk queue is in disk_only mode so as to try and get the queues to drain as fast as possible, reducing the size of the mnesia table so that when it is finally converted back, it's small.
    
    More experimentation is needed.
    
    I'll hook the above commands into rabbitmqctl soon.

commit 4948fcbb601f4828410eff13e46fac2341a3e488
Merge: 932be4e66 11ab8c4ff
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 18:33:06 2009 +0100

    emergency merge of bug20958 into default
    We point to the macports files of the default branch from our web site
    and they got broken with the merge of bug20333. This hopefully fixes
    that, but further qa is required.

commit 11ab8c4ff602be96e6e452a5921118a5d145e539
Author: timc@afallen.home <timc@afallen.home>
Date:   Wed Jun 10 18:27:53 2009 +0100

    Removed default shell, changed wrapper to work without default shell

commit 8d9514935a03c30a22a406c7d477dac9991c0df5
Author: timc@afallen.home <timc@afallen.home>
Date:   Wed Jun 10 18:02:41 2009 +0100

    Creates rabbitmq user with a default shell and uses correct arguments to the os x su command

commit e8f690e23c4f350f6eb8dc9ccd8350a9439afc35
Merge: 6c013060a 932be4e66
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 17:08:25 2009 +0100

    just merging in default.

commit 932be4e660f438eb35beaaf76c0388b62bd67da5
Merge: 979810d23 248c83d08
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 16:43:40 2009 +0100

    merge in bug20955

commit 6c013060af8af871693ed3377d0958bb5fb97990
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Jun 10 15:44:54 2009 +0100

    Two things have happened here. Firstly, the mixed_queue now functions correctly when being run in disk_only mode. This is _much_ more complicated than I had thought because of the fact that the presence of a message on disk has nothing to do with whether it is persistent or not. As a result early acking is required and requeuing operations are horrendous to say the least.
    
    When going from disk-only mode to mixed mode, we don't ack anything at all. It's arguable that we should ack non-persistent messages at this point, but the problem there is that if the conversion fails then we lose messages. Therefore, we then arrive at the sitation where we're in mixed mode, and we have messages held in ram that are not persistent, but are still on disk, and require early acking when being delivered (again, requeue is hell).
    
    The conversion to and from disk-only and mixed mode now seems to work well.
    
    When starting up, non-persistent messages on disk are deleted.
    
    Finally, in disk_queue, publish now takes an IsDelivered flag. This allows you to publish messages and mark them delivered in one go. However, the message is still available for delivery (i.e. it's not waiting for an ack).
    
    Also in disk_queue, requeue_with_seqs is now [{AckTag, {NewSeqId, NewIsDelivered}}], which allows you to requeue and unset the delivered flag. Note however, that it is still not safe to requeue a message which isn't waiting for an ack.
    
    (Please note, it's now very important to distinguish between messages which "AreDelivered" _and_ are waiting for an ack _and_ are not going to appear if you call deliver(Q), VERSUS messages which "AreDelivered" but are not waiting for an ack and will appear (eventually) if you call deliver(Q).

commit 248c83d08f9b4acafff74edc787dd19c4f222e0c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 15:30:49 2009 +0100

    respect channel blocking when adding consumers

commit 979810d2346ae31350e2a5d08d4cf48db36451c2
Merge: 29243c829 3b8c7ad5f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Jun 10 14:24:10 2009 +0100

    Merge bug20801 into default

commit 29243c8295239285398a46c492613d0da70ff0a7
Merge: e113459fa 4cb58da79
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Jun 10 14:23:00 2009 +0100

    Merge two default branches into one.

commit e113459faed6e5b43f6a1801411a7b2d4472c20b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 13:56:33 2009 +0100

    fix off-by-one error
    not that it really matters much

commit 3b8c7ad5f73d075514d5a1fc6dd5ee9ee2d901d3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Jun 10 13:38:17 2009 +0100

    Use dist macro for building correct distribution versions.

commit 4cb58da79f017c80b27d9b60346cbbaef7cb8232
Merge: 4a9485fc3 7851f13f3
Author: timc@afallen.home <timc@afallen.home>
Date:   Wed Jun 10 12:17:41 2009 +0100

    Merge from bug20333 post verification

commit 50827e5bf8d35a2cf4c1b9bc77a4b3a69769f29f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 11:41:22 2009 +0100

    cosmetic

commit 4a9485fc3bd605b21686dce9e8858aa3e8c3e977
Merge: 2f4f19b38 8254b8f5f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 07:00:40 2009 +0100

    merge bug20940 into default

commit 8254b8f5f38495407747813860763ed05883752d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 10 06:42:10 2009 +0100

    cosmetic

commit 91bfb6912503717901a8fd36a80fa9dc9bcf01fc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 9 17:55:33 2009 +0100

    just committing as need to work from home tomorrow. Code in "interesting" state of flux. disk mode to mixed mode in the mixed_queue is annoyingly hard.

commit a05bed30922f63f0ea547148085cd0e19add2a5d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 9 13:26:35 2009 +0100

    Made can_send/2 into can_send/3.

commit 69e4cf9db368b26753a52ef12379f50772f6c3d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 9 12:52:14 2009 +0100

    Using delayed_write batches together small writes and reduces the number of OS calls. This is a good thing and makes writing to disk much faster. However, we can have the situation where we are trying to read a message off disk before that message has been fully written out to disk. Therefore, we need to fsync at choice times. Because fsync is quite expensive, we want to call fsync no more than absolutely necessary. Thus we now have a 'dirty' flag which tracks whether the current file has been written to sinc the last fsync, and we call fsync whenever is dirty and the file to read from is the current file. This has also had some similar changes elsewhere in the disk queue. In short however, it seems this does work as I'm no longer able to reproduce reads of messages which return all blanks.

commit aab6cdda63645d3253be6382a5504128c4a82dee
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Jun 9 11:06:11 2009 +0100

    Logic failure which only came to light when trying to run the consumers as documented in bug 20470

commit 9bf1d86e4b4b919f7799c0f1dec99b1043ef9707
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 18:06:51 2009 +0100

    can now switch the mixed queue between modes

commit 835ee0039f6e1adb1ed8e9505d97e532b78b21fd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 16:46:20 2009 +0100

    tiny refactor

commit 30841299c5151220bf4cebc97fe4ee2c7d6245bc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 16:26:36 2009 +0100

    refactorings and code cleanup

commit 31d8836db7122d72f4be162246f5c20ba111669c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jun 8 16:03:56 2009 +0100

    Removed check for durable queues on transient exchanges

commit 8129668ce72e3e7633eef287c947d7f7d719074a
Merge: 9c1ad3540 2f4f19b38
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jun 8 15:27:24 2009 +0100

    Merged default back into amqp_0_9_1

commit 0f849b8497806fe72bd2b2441c2d8cdb352a91f6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 12:24:21 2009 +0100

    idiot

commit 658a6a9e61e723440dcd0a57884e7ce58f4a4a86
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 12:19:42 2009 +0100

    tiny refactorings

commit 117927964abd1adefc23fbab4b873d6e5b15b99f
Merge: 7242b9aed 2f4f19b38
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 11:56:43 2009 +0100

    merge in default, post the bug20782 merge. All the tests still pass and the test in comment #4 of bug20782 also has correct behaviour.

commit 2f4f19b38956afc27ab2075d2348ab14af04016c
Merge: e30c01224 1b43c217f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Jun 8 11:16:02 2009 +0100

    merging in bug20782

commit 7242b9aed25e91b536014f85042b3ac9a3c92fa9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Jun 6 01:27:18 2009 +0100

    was just watching the logs go by when running tests and saw an explosion. Pretty basic typeo which hadn't been caught so far.

commit 059a183f76528c62e321f08a4ff57c4cf6f57353
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 5 17:27:25 2009 +0100

    need to leave the disk queue running so that the rest of the tests go through

commit f2fd94e983f4f7007a6041576f12b07125722bbb
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 5 17:10:33 2009 +0100

    All tests pass. Including clustering tests. "ram-nodes" in clustering now have mnesia schemas, but the tables are created as ram tables (other than the disk_queue, which does its own thing and is either disc_copies or disc_only_copies, but that table is also local_content - we don't want to try and duplicate that state across nodes).

commit 8c0cb1225d6ffdee0df6a55cd42242c7536ce2be
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 5 13:37:50 2009 +0100

    all java tests now pass. tiny (but significant!) bug in the mixed_queue startup post disk_queue startup.

commit 0386c4a11a76a8d9a887c7c562b6b97dbba30f10
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 5 13:32:02 2009 +0100

    Java functional tests now pass.
    
    There was a bad interaction between delivery and the limiter.
    Previously, the limiter was only queried when we know we have a message to deliver. However, because of the fact that we now really store messages on disk, we don't want to read in a message only to then be told later than we have no consumer to send it to. Thus the message is not required until we know we can deliver it. The problem is then that there's a possibility that there is no message to deliver, in the mean time we've gone and asked the limiter to let us send.
    
    So the generator we pass into deliver_queue now must respond to the atom is_message_ready and tell us, without side effecting (gimme a type system, ffs), whether we have a message available, without required the message itself be presented. If so, we then check with the limiter, and proceed to deliver.

commit 57d7c85c2ff057617815e0cfca7bc5072f2413f6
Merge: 0a49575d4 e30c01224
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Jun 5 12:00:44 2009 +0100

    merge from default, which was more effort than I'd expected. Also, started working through the java functional tests, discovered one bug in the mixed_queue (cancel not observing durable flag) and one bug in the amqqueue_process (not committing txns if there's no consumer pid).

commit 1b43c217f415bc0cdd976229a2abcb18a8374c62
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jun 5 08:10:51 2009 +0100

    clean up tx records in queues when a transaction's channel dies
    
    Previously queues were only monitoring channels with subscribers or to
    which ack-requiring messages had been delivered. Now queues also
    monitor channels from which they have received transactional
    publishes.
    
    Queues record the last tx id they have seen from a channel. This then
    makes it easy and efficient to find the associated tx record in the
    queue's process dictionary when a channel process dies - the
    alternative would be to scan the tx records for matching channel pids
    - and perform the required rollback activities for the tx.

commit eb638c17b4ef2c97ae37962e633584d269700d3d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jun 5 08:10:26 2009 +0100

    refactoring: bundle up all the data for a publish
    Passing this around as separate args was becoming a pain. Also, now
    it's easier to add more data items.

commit 0a49575d4ab92e27b2b8633e0425419e1f1e112c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 18:37:23 2009 +0100

    Queue recovery on startup now works.
    
    o) All queues start up and ask the disk_queue for their contents
    o) Post durable-queue-recovery, the main rabbit process tells the disk queue to delete the contents of any other queues which have not been found as persistent.

commit c310db59b9098ff7632c0f4ddaf736df59ef5646
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 16:14:05 2009 +0100

    added dump_queue to the disk queue. This spits out a list of the queue contents from the current read pointer to the end of the queue (i.e. messages for which we are waiting for acks will not be included). Of course, at startup, all the read pointers are at the start of the queue (i.e. not waiting for any acks) so this grabs everything. Some minor refactoring was involved in the addition of this function. Also, I needed to change my definition of unfold so that it's now both simultaneously an anamorphism and a catamorphism instead of just an anamorphism (i.e. the accumulator / 'initial' value is spat out at the end). This could be a hylomorphism. Can't remember...

commit c384ec140a7c32631f2df37d39d6ad1bf50dc020
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 15:14:18 2009 +0100

    sorted out the disk_queue tests which had been left behind with the last set of API changes. By fixing them, discovered a bug in the disk queue. Also made the tests a little more rigorous, and discovered a the rdq_stress_gc test was not doing anything like what I'd wanted. Fixed.

commit e30c012241d4a041c36d6d1e1c9808492c355dd5
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jun 4 13:32:55 2009 +0100

    Split out internal_declare/2.

commit 4ff65bec96c96a3a7b2fa5a13f0902a714c31e4a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 12:28:23 2009 +0100

    removed the persister and modified guid generation to use a persisted serial id stored on disk

commit 1a96bfd21b5b8adbc9d856ba349e1ef6e063fe8a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 12:06:22 2009 +0100

    only write out persistent messages sent to a durable queue

commit d24468428b337c2a361872d102da06e0ceddba96
Merge: 56a9d55dc cfd34b0ee
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Jun 4 10:43:18 2009 +0100

    merge bug20633 into default

commit 56a9d55dcafc160671ffe7c27b72cfb0c53e69a5
Merge: c73554779 1deab24d6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 3 17:00:56 2009 +0100

    merge bug20877 into default

commit 1deab24d6ea3c7ea7efa6708f08caa30eecfd14e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jun 3 16:23:59 2009 +0100

    align

commit 6d62e9c26aa2be34b84b2892416c73b3d6ab3d4f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jun 3 15:26:47 2009 +0100

    Change from number to atom.

commit 9c1ad3540de6da792dee97ab67ab68be4e038e12
Merge: cbdc24c1a c73554779
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jun 3 13:39:32 2009 +0100

    merge default into amqp_0_9_1

commit c73554779aa309e576f88cad973484b72e0c2302
Merge: 21e007dae 4acd85206
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jun 3 13:27:45 2009 +0100

    merge bug20654 into default

commit 4acd85206cee5e439a45eabff1e8b567bd90cb63
Merge: 32ea13e03 b7068735d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jun 3 13:27:23 2009 +0100

    merger

commit cfd34b0ee65238450543cf51fc68c25700e26e2d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jun 2 10:44:01 2009 +0100

    make delete_binding return an error when the binding does not exist
    This required some refactoring in order to avoid duplication of the code
    that constructs #binding records.

commit 834e68f2f3f567f137b6cdab80f637f71da6f0d2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 29 11:05:22 2009 +0100

    (just for testing - switch to disk only mode)

commit 32ea13e0306b58799ef2894e057dda3a22b6741f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri May 29 06:37:30 2009 +0100

    fix typo

commit e5f82c4168712f69adf394d218df158cd13e8fea
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 18:02:45 2009 +0100

    gen_server -> gen_server2, delete_queue calls purge_queue first in order to try and reduce horrible inefficient mnesia_match_object call. Also some refactoring and tidying.

commit b7068735d23ed81921d1b428b662e966b3f33d89
Merge: 54f390194 21e007dae
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 27 14:32:17 2009 +0100

    merge default into bug20654

commit 21e007dae8bcf307fd6a20287e0774b647c2e519
Merge: 3120cdcb7 551326078
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 27 14:29:27 2009 +0100

    merge v1_5 into default

commit 6246085d1566ef701379006b2ed5ce1b45b4f434
Merge: 07a45e744 3120cdcb7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 13:33:24 2009 +0100

    just merging in default branch

commit 07a45e744d24384e3b2a1667d4b98650e83f671d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 13:11:23 2009 +0100

    Brought out starting the persister to rabbit.erl. Also, reduced the file size limit to 25MB. The reason is that it was observed that start up was taking a long time simply because the files were large (100MB). Given that the file being written to is never GC'd, reducing the file size limit forces new files to be created more frequently, thus increasing the use of GC and thereby keeping file utilisation higher. As a result, less time is wasted at startup scanning over delivered but not-yet-GC'd messages.

commit 54dd5c0194db230b8bd73e244529b539b51fc0fe
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 12:48:53 2009 +0100

    ugh, managed to forget the need to compile before running dialyzer, hence just committed broken code...

commit 8f15ae7d7ea53930d0b5614a1c65d9e78a5de93d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 12:45:53 2009 +0100

    o) fix up -specs
    o) add queue_delete - previously I was just (ab)using purge but this isn't right as purge won't eliminate delivered/unacked messages.
    o) refactorings and moving code around a bit

commit 884f90a00a1d2e15ca52e640a9156be713c67a5c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 27 11:43:06 2009 +0100

    preemptive refactoring

commit 22ebfeefb80c1bd9584e420aa803ec0a72c45e1a
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 18:46:53 2009 +0100

    duh!

commit 17cc6ac00585977c4e84fecd584fd89d024fc195
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 18:26:30 2009 +0100

    Yup, basically, same bug in three places. Fixed. It all works.

commit 76403c059d1ec0c418fe35a0d1e8a10ce09420a9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 18:08:45 2009 +0100

    Well, it /tends/ to work, but sometimes falls over, apparently trying to read a message which has been erased from mnesia. Mysterious!

commit 086f13e9a4b4192b769a0f0ff9706665213be1c8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 16:01:06 2009 +0100

    IT WORKS! (for SendString and simpleconsumer)

commit b6ec8493f9b606d4a7a76a46b2e38efc95222a74
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 15:32:53 2009 +0100

    It compiles.

commit 7b0f295c2e7acc3b6a40874d3feb5d000ea34c78
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 22 14:03:47 2009 +0100

    Tiny changes to amqqueue_process, but mainly getting the mixed_queue api into proper shape.

commit f4a4d7520cc2ddfe39d21b3fc6c70a39e41d423d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 18:15:21 2009 +0100

    just a couple more comments / TODO items.

commit 809d0768693f6a8b5218874848ef7c3e439a9840
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 18:13:16 2009 +0100

    Still WIP + DNC. However, deliver_queue is now rather funky, pretty much incorporating a HO fold. This does rather simplify matters as it means we get told inadvance that we need to produce a message only when we have a consumer for it, and at the same time we get told about whether this message is going to get an explicit ack, and we get an accumulator to play with as well. Pretty nifty - has simplified code elsewhere.

commit 3bbe9499b556f2871e41d9ac76646ce635925a7d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 17:34:23 2009 +0100

    WIP, DNC. However, I think the basic control flow is right, although there are a lot of bugs. One of the bigger remaining issues is the correct routing of AckTags around, and no doubt there will be assumptions I've made which are wrong, but I think it's getting there...

commit d0049ca2096664c05d00870874ec92261ffd7691
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 13:57:21 2009 +0100

    Made deliver (in its various guises) also return the number of remaining messages

commit 3756f096565791dfb1968164c67c047c322fa390
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 13:38:20 2009 +0100

    Added is_empty and length functions.

commit 9c18c3d9d2809bc419b50d6eb0f3a64aee310a40
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 21 11:37:02 2009 +0100

    Formatting only. Only just realised emacs was using tabs. Fixed.

commit 3120cdcb7b8f903c7236c636578ddabeb50068fd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 21:09:08 2009 +0100

    helper method for not_found errors
    There was enough repetition to make it worthwhile

commit 54f390194bb8d6042d69fd5b2deccc03a93bbc69
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 20:05:40 2009 +0100

    rename UME to AE

commit 2d97ee9586076c37808f75df69178cf0d7f40e76
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 19:41:53 2009 +0100

    break ume cycles

commit 3340a360fbe833246d42bce38e0ab27c09c11656
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 17:52:48 2009 +0100

    carry 'mandatory' and 'immediate' flags through to UMEs

commit 5df0a7433f63a5b0e9af5c9b1e1c96a8bf28626a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 15:31:16 2009 +0100

    refactoring of API

commit e322ba099c7db411dbe1c39c2d9f6496f2968c15
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 20 14:30:33 2009 +0100

    Wrote the mixed_queue. This is totally untested just now. This module makes decisions about when to hand off to the disk_queue and when to hold messages in RAM. Both UnackedMessages and the contents of Transactions are still held externally, by the amqqueue_process as they need to be associated with channels. Currently there is no way to create the initial state, nor make transitions between the two different modes. But in theory, it should work ;)

commit e720187f953f7b926bafd46dbae75f60c4251a9d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 20 12:46:57 2009 +0100

    So the mnesia table now contains next_seq_id. This means we can cope with gaps appearing.
    There are now two forms of publish, tx_commit and requeue. The first forms behave as before, with contiguous seq_ids. The second form (_with_seq(s)) take either a
    n extra seq arg or in the case of a list, a tuple in which the desired seq_id is mentioned. This can always just be the atom 'next'. The invariant on these lists is that the seq_ids are always ascending. Thus requeue now effectively takes a mapping: [{{msgId,oldSeqId} -> newSeqId}].
    
    On startup, because the sequence Ids are still private at that point, shuffle_up is still called as before, although now gaps can appear anywhere, not just in the delivered section. We collapse everything up simply because we don't know where the previous NextReadSeqId marker was. If we did know that then we'd know that beyond that point we had a well formed linked list, and only had to patch up before that. This further requires that even though we have a linked list, the seq_ids must be ascending.

commit d383423a040402a6c43ea7f0b092a0fdf6340447
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 20 10:10:20 2009 +0100

    Just adding a comment which was missed out some days ago.

commit 9bd7d21698da7ef8cc3c4ab5e33e2ae46e99d67a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 08:57:28 2009 +0100

    fix type spec

commit 1fa655601f96afd5f68d753a4d2286099cd0e410
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 08:45:37 2009 +0100

    add permission checks for ume configuration

commit 2706342d0799b54aea39fe6f80cc0a009ea2abfd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed May 20 06:25:28 2009 +0100

    rationalise publish/route result types

commit 803764bc442cbc2605a548c12357739a632a5ad2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 19 21:28:24 2009 +0100

    move publication logic, incl ume handling, into rabbit_exchange
    ...and make rabbit_exchange:simple_publish use it

commit 003b4167fef45b15bf8a123aa07ecda0b1660500
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 19 13:22:38 2009 +0100

    Some initial reworkings, making sure all messages have a guid, and moving the persister flag around slightly. Also various weird comments appearing in _process.erl for me!

commit d94afdb18a980fb13c23a2cf8077de4f332f383f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 19 13:22:34 2009 +0100

    document support for headers exchange
    We forgot to do this bug 20152.

commit b81f6ccf7329f5c3944bc8e63b4cfc3135db5112
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 19 13:21:30 2009 +0100

    Added support for purging queues. This is done per the 0-9-1 spec so we purge everything that hasn't been delivered.

commit 8549f92b6928f7772714a9bde1b5569e418522cf
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 19 11:36:05 2009 +0100

    Added a call to compact at the moment we start a new file. This closes a hole where the GC isn't being fired soon enough on new files. Also turned on preallocation for new files.

commit 55132607808a435a4906f17e9ba0107f99ab2850
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 19 10:03:54 2009 +0100

    Added tag rabbitmq_v1_5_5 for changeset 5dc463f43bb7

commit c5068a8d77491ae96fa8b25436548ebcc0a9db08
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue May 19 10:01:30 2009 +0100

    add package changelog entries for 1.5.5 release

commit 58cd8c9f6776cd6b1cf6465f64bd718b707c12ee
Merge: cce535693 dc2b74456
Author: David Wragg <dpw@lshift.net>
Date:   Mon May 18 17:39:56 2009 +0100

    merge bug20676 into v1_5

commit cbdc24c1ab730d3d5acf6215373b15c5cb351937
Merge: 8816dc179 9c799d509
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon May 18 17:34:41 2009 +0100

    merge default into amqp_0_9_1

commit 9c799d509b2b7bf310a63560bd9b25d862def6b2
Merge: 08c1136f0 cce535693
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon May 18 17:34:25 2009 +0100

    merge v1_5 into default

commit cce5356930dded21c93ed1ee1fa4b321f78b2984
Merge: 7e26531e9 a2b43cd66
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon May 18 17:33:48 2009 +0100

    merge bug20767 into v1_5

commit a2b43cd66430e30122a6f8112e3d01a57289d057
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon May 18 17:33:21 2009 +0100

    Silence unused variable warning

commit 9d25631c14b7a070bb3a21ab94f4b3f1fbeecc8f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon May 18 16:20:26 2009 +0100

    display node name and db dir on startup
    ...in a pretty and easy-to-parse way
    
    In the process we introduce rabbit_mnesia:dir() so we don't depend
    directly on the mnesia module - this also removes a dependency in the
    persister.

commit dc2b744567fa1253308f07bcc78b5bd170b84695
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon May 18 11:33:53 2009 +0100

    Change to dependencies

commit 2374b02b2cc700d9448faadfde3de078bc2eace9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon May 18 10:43:27 2009 +0100

    Removeal of unnecessary includes

commit 7e26531e98d2a3eb2d053334633df2578f4d9802
Merge: 751100208 bb5835382
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sat May 16 12:11:19 2009 +0100

    Merge bug20745 into v1_5

commit 751100208d64e8af416cafc20172afc343ea75f7
Merge: 21a10fd8d 2b45efaaa
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sat May 16 12:07:43 2009 +0100

    Merge bug20679 into v1_5

commit 27e15fbe128f946fb8b8d5f6fabe593452820952
Merge: 9b35a0aed 08c1136f0
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri May 15 16:41:55 2009 +0100

    Merge with upstream

commit d6e9d50eece7328bae67ad2fe01ac59e33d8030b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri May 15 11:39:44 2009 +0100

    added phantom_deliver. This does everything that deliver does but it doesn't actually read the message. This is useful if the same messages are being tracked in multiple different queues (eg a RAM queue and a disk-backed queue) and you want to mark the message delivered without it being retrieved. It still needs acking in the normal way.

commit e3150cae57e5638391390dbfc608dc138c79b0cc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 14 18:00:03 2009 +0100

    An implementation of the queue using database. This will only work with postgres - it really is impossible to make this kinda thing db agnostic. Performance is terrible, but it does work, and has an identical API to the rabbit_disk_queue

commit aeaf352012fe114b3e50cf90bd0aca0c18e85b74
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 14 17:57:42 2009 +0100

    Reworking shuffle_up to sate Matthias's passion for beautiful code

commit ede34cf5cfd141842babcd43f0c635614b2698a0
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu May 14 15:52:13 2009 +0100

    Some cosmetic changes (erlang style function names) and improvements to documentation.
    Also, implemented requeue, and corrected bug in startup which would have lead to crashes if acks had appeared non contiguously prior to shutdown.

commit bb5835382e96fbe359ec71627d6f1a48f756b5b7
Author: David Wragg <dpw@lshift.net>
Date:   Wed May 13 23:19:01 2009 +0100

    Don't package the INSTALL document

commit 8816dc1793f31c67d09a47fc1ebf361d44702b68
Merge: c5af3c372 08c1136f0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 15:30:41 2009 +0100

    merge default into amqp_0_9_1

commit 08c1136f058e41a7daec79fb9d6c45e36c1ab4b0
Merge: c652c6a18 21a10fd8d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 15:30:28 2009 +0100

    merge v1_5 into default

commit 21a10fd8d9a9b361c6cdf5b16400eeb1212601e1
Merge: 7ad17a13f b3280485a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 15:30:15 2009 +0100

    merge bug20702 into v1_5

commit c5af3c372c0750087d7448f2465ca59fc0434cff
Merge: 67aab1f6d c652c6a18
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 15:23:55 2009 +0100

    merge default into amqp_0_9_1

commit c652c6a18660ec0db2739dda17d508162b08cb64
Merge: 96ba6eb0c 7ad17a13f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 15:22:21 2009 +0100

    merge v1_5 into default

commit 7ad17a13fdd3b28881e0b4e41e72ccb890cc9887
Merge: 6f69ce47d b70866f3e
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed May 13 14:53:38 2009 +0100

    merge bug20649 into v1_5

commit 885575462f77893da94faccdaa8c490758d5bde2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 13 14:44:29 2009 +0100

    Made tx_commit take a list of seq_ids which are things to be ack'd. This means that some external thing should keep track of exactly what is in a transaction (this is already the case for publishes, it just needs to be extended for acks), and then present them for the commit. Also, fixed a stupid bug in the stress_gc test which was previously acking everything at once (albeit in a weird order as desired) which meant all files got emptied before the gc ran, not quite what was desired.

commit 25995387be653239513a9e00ae2abe885b167093
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed May 13 11:43:02 2009 +0100

    Startup requires a match in mnesia per message we encounter on disk. This lead to a 22minute startup time for 100000 messages. However, by dynamically adding an index during startup to mnesia, and then later removing it, this is reduced to 13.5 seconds. Note however, that to test this with rabbit_tests:rdq_time_insane_startup() requires the disk queue to be edited so that it starts up in ram_disk mode, not disk_only mode as is the code default.

commit 67aab1f6d3d86d947bf3d7d4ecb813567baca8b3
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue May 12 16:34:03 2009 +0100

    Cope with both 0-8/0-9 style and 0-9-1 style protocol headers.

commit 5f03e402dff344565656a7fc8c0252ce51b5915d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 12 13:40:10 2009 +0100

    sigh. I while ago I managed to commit in change to the Makefile

commit 5d6ba0740a11762bbd916a637df0f2f787c7afc4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue May 12 13:39:06 2009 +0100

    Added to the disk queue the ability to dynamically switch between disk-only and disk+ram modes. The disk+ram mode uses disk_copies for mnesia and ets for msg_location. This results in a substantial performance improvement (minimum 5 times faster), but is ram limited by number of messages. The disk-only mode uses dets and disk_only_copies for mnesia. This is much slower, but should not be limited.

commit 36a6847c036968359136b8a26b6fb2ad3f3e5162
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat May 9 23:26:42 2009 +0100

    cosmetic

commit 81122a17bedb82927be206e446654c4438415370
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat May 9 12:03:22 2009 +0100

    Move outbound tap to saner location; take advantage of extra info at that point

commit 22eb3828ed314a8cf8c03a35258bd075bfea077c
Merge: 8f01af0eb 96ba6eb0c
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat May 9 10:04:47 2009 +0100

    merge default into bug20589

commit 2b45efaaa15677422dde8a0108d1f61856e76ee1
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 22:05:13 2009 +0100

    Add Default-Start and Default-Stop LSB init script lines
    
    To shut rpmlint up.

commit 6f69ce47d0bcf2a66ec76b2c551279b8f0f00d41
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 22:03:28 2009 +0100

    Revert. No idea why that ended up going straight into v1_5.

commit 5055b97dea11ef55a7fe25a5a05dec38ca880ffa
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 21:55:06 2009 +0100

    Add Default-Start and Default-Stop LSB init script lines
    
    To shut rpmlint up.

commit b3280485a251db74ded654871e517a29ca802aa3
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 16:30:55 2009 +0100

    Set PATH to workaround case when escript is not in /usr/bin

commit b70866f3e38996c82a1cd45f919675315bf49264
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 15:44:58 2009 +0100

    Create user and group in %pre rather than %post
    
    They are referred to in the %files section, which leads to warnings
    if they are not created until %post runs.

commit 4a08c82320e67f8178cd99d6d964d1407a11c5b8
Author: David Wragg <dpw@lshift.net>
Date:   Fri May 8 15:37:29 2009 +0100

    Remove duplicated username in useradd command

commit e5c390df7c6a6b6d3ad17bfabb043be3b8db3954
Merge: d10f3828c 3c323c739
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu May 7 08:40:19 2009 +0100

    merge bug20471 into v1_5

commit d10f3828c48016f811b70f4cd4cd82ee826ee5e4
Merge: dfbab5250 6ea526c16
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 29 16:25:39 2009 +0100

    merging in 20592

commit 1a25579854e1ed17b0ff5689dde624622ea9109a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 28 23:22:54 2009 +0100

    refactoring

commit 9f7900665c0442ae4fd2e1ada5dbe74ce1f5037e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 28 23:08:41 2009 +0100

    add "unroutable message exchanges" feature

commit 685a875f1dc79b144539477ddd32c4510df98562
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 17:10:18 2009 +0100

    Fix up merge damage

commit ff1af96ccc5839d16f538708308a5578376884a8
Merge: e671dde6a 96ba6eb0c
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 17:09:21 2009 +0100

    merge default into amqp_0_9_1

commit 96ba6eb0ccfde19d80186408cb34f6778a35c3ab
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 17:08:19 2009 +0100

    Fixed unused-variable warning

commit e671dde6ac5f9719e34f88e64658739bd6ef4237
Merge: 8166ccce9 a337febda
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 17:01:05 2009 +0100

    merge default into amqp_0_9_1

commit a337febda4a68311750553a969d932e1e277e946
Merge: 616dc0bf7 dfbab5250
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 16:59:05 2009 +0100

    merge v1_5 into default

commit dfbab52506e4667cf0ae63b7fadfa219106a816d
Merge: 040746724 c06b2f499
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 24 16:54:53 2009 +0100

    merge bug20630 into v1_5

commit c06b2f49952d1aa497c34dd46906190c4a69fd2f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Apr 23 12:46:38 2009 +0100

    return the correct error (not_found) on exchange deletion
    in the process discriminate more on 'unbind' errors

commit 09b7163518b2b1e1ad6114ac1badee17f0171bb6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 23:53:26 2009 +0100

    just taking out the param of file handles

commit 269f1dc10a1b2727f799730bd48ed452620e2f0b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 21:39:57 2009 +0100

    added a test

commit ffba4bc3a76efa5f102db4d639403e2f0921e8f4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 18:01:48 2009 +0100

    some refactorings. Not all done yet.

commit 6ea526c16dece49dcf483ce54df450c7dce71986
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 22 17:57:53 2009 +0100

    don't conditionally/auto-delete exchanges that still have durable bindings

commit 36e2dee055754e7aa3bd56660e312385172ef903
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 16:12:58 2009 +0100

    added specs. ensured mnesia is local

commit 044eff474a1f3f85da2add310d99d02ab82eb3a8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 14:57:56 2009 +0100

    rename clean_stop
    remove extra mnesia index - this has significantly improved performance!

commit 95b7edb13d820bf4550fd1c6db22d25e0595a64b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 14:42:27 2009 +0100

    minor improvement to documentation

commit 631a97db8902208a83225393ec00b685c0d9ee23
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 14:30:23 2009 +0100

    copy + paste job extending essay

commit 30bc61f26b3a2c2e6ecca02ba3905455b014c2e3
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 14:19:52 2009 +0100

    wrote a short essay

commit 8e0df683b31d15039b4751554f9248809d10a752
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 13:01:53 2009 +0100

    a bit more refactoring. Also, drop file size and file handle count in tests to stress those code paths more.

commit 29d323a6881a508977d7382e15b379695648ed13
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 12:51:59 2009 +0100

    neater

commit 659194e683096c9ae0e3758f6dd6b95cd72b2662
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 12:43:50 2009 +0100

    more reformatting and refactoring.

commit 0056ad665a93ab048f6dce0c065ac7664d57f551
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 12:15:38 2009 +0100

    well it's now much less readable. But at least the lines are shorter.

commit 616dc0bf7200a1edde083a6356205b781955bd24
Merge: b3281d4f1 040746724
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 22 11:31:01 2009 +0100

    merge v1_5 into default

commit fafc70a12da00e750a2090c7375a4c7170888be6
Merge: c11d8c902 6f245fb59
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 11:21:03 2009 +0100

    merge

commit 6f245fb5987d1e600c9d183750ae6e905ae9db7e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 22 11:16:17 2009 +0100

    cosmetic

commit c11d8c902cc59e50d91266ab18b724af80253aa7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 10:54:17 2009 +0100

    stupid bug in start up code because I still fail to remember that messages only go away after being ack'd, thus we should redeliver messages.
    
    Also, reworked the stress gc test so that as before it really does ack messages in a non-linear order. This got quite a bit harder now we can't deliver arbitrary messages and need to build the mapping between msgid in the delivery and the seqid needed for the acks.

commit 65d6523be42f4ec44f83b2c542de15277eceadf5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 22 10:34:30 2009 +0100

    I don't understand why I thought I needed to adjust sequences in remove_messages.
    The only case that code would be called would be from acks, and the effect would be to increment the read seqid. But this would require acking a message which hasn't been delivered, which is clearly insane.
    
    Also, fixed a bug in the tests.

commit 9ceaa816c04422119c8010b1f41a24dafdeb3eb7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 21 17:56:00 2009 +0100

    *cough* *splutter* um. typo?

commit 9762dbe0416f67d34c9ff480ca38b62289bd31a5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 21 13:39:56 2009 +0100

    bitten.

commit a3003a0a60bef9a03d8cf2479a8b247c6fc8bdab
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 21 13:12:20 2009 +0100

    altered api so that deliver returns the seq_id (actually, it's a tuple of {msgid, seqid}, but that's irrelevant), and that ack requires this seq_id (tuple) back in.
    This avoids extra mnesia work and makes ack much faster. Given that the amqqueue already tracks unacked messages, this seems reasonable. However, if not, back off to the parent of this revision.

commit 7a35bdd921e3b24d2e1919b9e6f2023e1c7ea37c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 21 12:56:36 2009 +0100

    Introduced sequence IDs internally. Sadly, because of the need to lookup seqids for each msgid in acks, acks are now very slow.
    Thus I'm going to alter the API so that deliver returns the seqid and then ack takes [seqid]. This should make things faster.

commit 364fa5017fa13cd348b03742341532b18deac079
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 17:40:00 2009 +0100

    so I figured it was still going too fast. Fortunately, switching mnesia to disc_only has solved that problem...

commit 0823f1d578a748c32b2495341650a17befbe3b28
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 14:01:36 2009 +0100

    moved the message location table to dets. performance is slightly worse than 10 times slower.
    This means that the test suite which used to take about 12 mins to run now takes about 2 hours.
    Looks like we could now be talking up to 40ms to publish a message. Interestingly, delivery is only twice as slow as with ets, it's publish that's taken the 10+times hit.
    Worryingly, the numbers show that performance per message is not constant, and wasn't in ets either. This must be the effect of buckets in both ets and dets filling up and chaining. The dets man page does say that it organises data as a linear hash list, which is a structure I know well, and I am surprised performance is dropping off in this way - maybe suggests poor distribution of their hashing algorithm or rebalancing.

commit d1c8d63dc05b1f11cb99fe3c12bbb9cd70108ae2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 12:18:16 2009 +0100

    removed file_detail ets table and converted all use into use of msg_location ets table.
    Even though this is slightly less optimal because of the loss of doing index lookups in file_detail, this is actually slightly faster due to not having to maintain two tables. Performance:
    
    Msg Count       | Msg Size      | Queue Count   | Startup mu s  | Publish mu s  | Pub mu s/msg  | Pub mu s/byte | Deliver mu s  | Del mu s/msg  | Del mu s/byte
                1024|            512|              1|         2644.0|        41061.0|      40.098633|   0.0783176422|       156031.0|     152.374023|   0.2976055145
                4096|            512|              1|        74843.0|       328683.0|      80.244873|   0.1567282677|       629441.0|     153.672119|   0.3001408577
               16384|            512|              1|       373729.0|      3614155.0|     220.590515|   0.4308408499|      2969499.0|     181.243835|   0.3539918661
                1024|            512|             10|      1605989.0|       281004.0|      27.441797|   0.0535972595|      1936168.0|     189.078906|   0.3692947388
                4096|            512|             10|        85912.0|      2940291.0|      71.784448|   0.1402040005|      7662259.0|     187.066870|   0.3653649807
               16384|            512|             10|       418213.0|     37962842.0|     231.706799|   0.4525523424|     32293492.0|     197.103833|   0.3849684238
                1024|           8192|              1|      1347269.0|       144988.0|     141.589844|   0.0172839165|       173906.0|     169.830078|   0.0207312107
                4096|           8192|              1|        93070.0|       606369.0|     148.039307|   0.0180712044|       829812.0|     202.590820|   0.0247303247
               16384|           8192|              1|        20014.0|      4976009.0|     303.711487|   0.0370741561|      3211632.0|     196.022461|   0.0239285231
                1024|           8192|             10|        77291.0|       348677.0|      34.050488|   0.0041565537|      1877374.0|     183.337305|   0.0223800421
                4096|           8192|             10|       104842.0|      2722730.0|      66.472900|   0.0081143677|      7787817.0|     190.132251|   0.0232095033
               16384|           8192|             10|        21746.0|     44301448.0|     270.394580|   0.0330071509|     32018244.0|     195.423853|   0.0238554507
                1024|          32768|              1|       120732.0|       426700.0|     416.699219|   0.0127166510|       210704.0|     205.765625|   0.0062794685
                4096|          32768|              1|         9355.0|      1925633.0|     470.125244|   0.0143470839|       824304.0|     201.246094|   0.0061415434
               16384|          32768|              1|        14734.0|     10371560.0|     633.029785|   0.0193185359|      3594753.0|     219.406311|   0.0066957492
                1024|          32768|             10|         6052.0|       629362.0|      61.461133|   0.0018756449|      2100901.0|     205.166113|   0.0062611729
                4096|          32768|             10|         5546.0|      4203683.0|     102.628979|   0.0031319879|      8899536.0|     217.273828|   0.0066306710
               16384|          32768|             10|        22657.0|     50306069.0|     307.043878|   0.0093702355|     36433817.0|     222.374371|   0.0067863273
                1024|         131072|              1|         7155.0|      1913696.0|    1868.843750|   0.0142581463|       444638.0|     434.216797|   0.0033128113
                4096|         131072|              1|         6671.0|      8232640.0|    2009.921875|   0.0153344870|      1907439.0|     465.683350|   0.0035528820
               16384|         131072|              1|         1699.0|     33886514.0|    2068.268677|   0.0157796377|      7291762.0|     445.053833|   0.0033954913
                1024|         131072|             10|         7506.0|      1991032.0|     194.436719|   0.0014834344|      4564850.0|     445.786133|   0.0034010783
                4096|         131072|             10|         7486.0|      9551800.0|     233.198242|   0.0017791614|     18048697.0|     440.642017|   0.0033618318
               16384|         131072|             10|         2771.0|     71072559.0|     433.792474|   0.0033095739|     81144745.0|     495.268219|   0.0037785966

commit 4fa8ba984fedb54df8f6760202540149a0a32488
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 11:29:19 2009 +0100

    no sense running the same test twice

commit c922664ccba187289840a93237a355f42ec8f095
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 11:11:56 2009 +0100

    /byte figures so small could use a couple extra dp

commit bd290d007ecfcaf4c435c73bcdb773e0fede69e6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 20 11:09:47 2009 +0100

    just improving display of timing stats to make it easier to graph.
    This then means that it's much easier to test how performance changes with modifications to the disk queue.

commit b3281d4f188dd2b4ef2809dd98adcbc820d3b23e
Merge: 303167850 6e3f3ff2f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 20 10:12:40 2009 +0100

    merge v1_5 into default

commit 040746724b76cc79c4816439d2cabc44a44740b9
Merge: 71d2ec069 6e3f3ff2f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 17 12:57:56 2009 +0100

    merge in branch 20590

commit c8c3c5315085adf10b0356f979a20d5e89cc0075
Merge: 2f3206b4d 303167850
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 16 11:42:34 2009 +0100

    just merging in default to ensure I don't get too far away from it

commit 30316785078f18f69b213b2132861c53bd52d451
Merge: eddc7dc7b 77b03035b
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 16 11:40:04 2009 +0100

    merge in bug20354

commit 71d2ec0691eacf99a274881aaf50d3ba93f0d80a
Merge: dd689096c dd07646f4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 16 10:58:04 2009 +0100

    merge bug20599 into v1_5

commit dd07646f40a2ecdcd3637c08efb884dc563d580f
Merge: 097d47395 dd689096c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 16 10:55:47 2009 +0100

    bringing in v1_5 before merge back

commit 2f3206b4da474909b7ae055f9af319fe771132be
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 16 09:03:10 2009 +0100

    funny what you realise in the middle of the night...

commit 77b03035b527000ab490c96659f91cfd8cd337b8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 15 17:48:37 2009 +0100

    handle negative priorities

commit dd689096cfce851239646df70aaf1f22decd4d55
Merge: 0a3aa468b 639fe8ccc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 15 16:25:00 2009 +0100

    merge bug20597 into v1_5

commit 1f5f030b9394759f2a1f55e07d12eb89742cfc32
Merge: 8a6d284c9 eddc7dc7b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 15 16:19:32 2009 +0100

    merge default into bug20354

commit 097d47395bf810a2297d48dc15d0015ae5521bb9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 15 12:44:38 2009 +0100

    leave system in clustered state
    ...when testing clustering. That allows other tests of
    clustering-related features to commence subsequently.

commit de5273764d0843042b273e0cc5852b687996a908
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 15 12:42:53 2009 +0100

    better way to start background node

commit 23512c836c794b776c65cc5de39bd395637c8627
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 15 12:41:31 2009 +0100

    remove silly dependency
    'start' should fail when the node is already running, rather than killing it

commit 0a3aa468b4990772dcce07678f0f8f49b3a8c654
Merge: 7e4864aaf 13577fa7c
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Apr 15 11:29:22 2009 +0100

    Merged bug 20593

commit 639fe8ccc00ef07142a47a2f2985da030a4aac9b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 14 23:09:43 2009 +0100

    keep dialyzer happy
    - the spec for rabbit_misc:format_stderr/2 was wrong,
    - for rabbit_{control,multi}:start/0 we need to add a spec so we can
      specify the no_return() caused by the calls to halt()

commit 6e3f3ff2fc645f92c81e92cd6c0db701f8ab6efd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 14 22:02:58 2009 +0100

    don't remove a queue's durable routes on node_down
    ...since that means we can't recover them when the queue re-appears.
    
    Also, rename rabbit_exchange:delete_bindings_for_X to
    delete_X_bindings - the former was becoming a mouthful.

commit 13577fa7c34658af49b11a0c5a4fd0707fd4af01
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 14 17:07:56 2009 +0100

    correct default location of cluster config
    we inadvertently changed this in 1.5.4

commit c9c41fc670c97a57bc078374c285f5efdb08b7cd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 14 16:32:58 2009 +0100

    Bugs fixed, and tests written. GC works. rabbit_disk_queue is functionally complete. However, fortunately, Matthias this morning changed its requirements so there are now several changes to make.

commit eddc7dc7b9c93abb8e9f1c24f0ce6e92ab0a4bc3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Apr 14 14:54:51 2009 +0100

    Backed out changeset 4ee61cc2d6f0
    This was committed directly on 'default' in error.

commit d30830b7be0a2f6e1141beac06c934c05e2c4789
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 14 12:46:35 2009 +0100

    fixed bug. GC does seem to work, though no explicit tests for it yet.

commit 9b399fc817b9ef8c5992e3b4ca495e19e04df04c
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 14 12:31:59 2009 +0100

    well, the GC is _written_ now. Not tested yet...

commit 4c8ba43d6dc57b7f4574691648a3c587662bfe1d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Tue Apr 14 10:50:12 2009 +0100

    GC file movement is done, but updating the accounting information is not done. So don't use it!

commit 8166ccce9ec26136743f8be22792d693b0f3f45d
Merge: 397a7ed46 16186562f
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Apr 13 17:34:32 2009 -0400

    merge default into amqp_0_9_1

commit 16186562f5b7b91158772f6eaae8f87e7f85fedd
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Apr 13 17:34:05 2009 -0400

    Fix double-exchange-deletion bug

commit 397a7ed46b9f7ea4affd38230cf2daf786e4825f
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Apr 13 14:06:45 2009 -0700

    Use symbolic constants now available.

commit 9309d63b4780c8c654a2398eafa655f90f34c3f4
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Apr 13 13:47:02 2009 -0700

    Implement recover-async, rather than recover, while we figure out how recover should work

commit efb2d4151e4a8dec1918e8d71434457f9925566c
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Mon Apr 13 10:56:26 2009 -0700

    Initial 0-9-1 port.
     - exchange auto-delete no longer supported
     - access.request no longer supported
     - connection redirection no longer supported
     - trace frames no longer supported

commit 341f47f909e23645b7d3af4643ae721bb027c5c6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 13 10:46:43 2009 +0100

    initial logic prior to compaction

commit 7f5a97f78523cdf92016059efb227ff8ad902fa6
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 13 00:49:18 2009 +0100

    Fix for that bug. Basically, mnesia wasn't being deleted correctly, which meant on the subsequent startup, it would report messages which we couldn't find anywhere, as they'd been deleted from disk.

commit 6c07f9ea03541625f9113691a086165b4f44ca42
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Apr 13 00:14:07 2009 +0100

    tiny change to fix where the badmatch happens.
    Must be a bug in compaction as it would appear messages are being deleted early.

commit 4a6d328ff71764207186b355500d02b7a0d626e8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 23:59:02 2009 +0100

    initial work on compacter.
    If you ack messages in exactly the same order as they arrived in, then files will be deleted correctly.

commit 8f72c82f50fc75dc2f7388f65e30ccba76578cc1
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 21:29:36 2009 +0100

    gah, committed the damn makefile again. Sorry.

commit b3767f034d2dd4b15b21c9a1dcb513774d41aa08
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 21:28:22 2009 +0100

    removed some parenthesis

commit aac627de27d87a6c8e139243e70e53371d7bdd89
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 21:13:02 2009 +0100

    and now we have some substantial tests.
    This has already led to a good optimisation on reading, and found and fixed a bug in messages going to multiple queues.

commit f191d8413b4d0bdcf2f466da1dc5e42304bd241d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 19:54:19 2009 +0100

    initial stab at some tests (though still only 1 queue!).
    Also accidentally seem to have committed a change to the Makefile a while back so am undoing that.

commit cb87008620431c8f30269fba02f4aeffbc31e073
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 16:56:49 2009 +0100

    added a stop and clean_stop api to help with tests/benchmarks

commit 383558344a9103b4a250f729cc4380534bc07da8
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 12:30:38 2009 +0100

    switched mnesia to an ordered_set.
    Seems to match performance with bag for startup and without the issues on fanout.

commit d56092143a04fffce12dbd6b93bfcd0fdc4d3cfd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sun Apr 12 12:13:46 2009 +0100

    refactored out common functionality between ack and cancel

commit 8f01af0eb7236cb3778bcf785e8d3daec0a0e137
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Apr 11 16:24:15 2009 -0700

    Document rabbitmqctl changes in the pod

commit 9d4b466cd633593bb0938122d71544c024750f5d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 23:14:59 2009 +0100

    changed the mnesia table to be a bag of MsgId -> {Q, Delivered}
    This makes startup MUCH faster, but delivery could be fractionally slower.

commit b5d282cc9ac3a734331f86f2a9b9511c0c5a3c06
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 18:31:09 2009 +0100

    combine two writes into one and alter some file:open options.
    Profiling shows that file:write is by far the most expensive operation now.
    (roughly 140,000 to mnesia coming in at 27,000). So it looks like the next idea is to follow the advice in man 3 file and implement our own write buffer. Ensure we hit 4KB or more before calling file:write - though obviously chuck out early for suitable commits. This will also complicate deliver, tx_cancel and ack.

commit 824f5004729fdcbbec19fea80133418182e2606e
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Apr 11 09:35:03 2009 -0700

    Trace activity on a per-vhost basis

commit f8e12da9203484e9a2e820dd3aeda26d6ff6818f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 13:14:36 2009 +0100

    corrected some bugs.
    Performance still isn't quite where I would like it to be. Need to do more profiling. Seem to be unnecessarily CPU bound despite use of ets throughout.

commit cd8e9999fc072f56ce181058b0f993bbc3004de4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 12:58:22 2009 +0100

    typeo

commit 269d997356128e7536eeb03d7c442cacd6dcb781
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 12:57:15 2009 +0100

    switched summary to an ets table too

commit 4a6c6aac0e92ab80c5159689358b223150a48b01
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 12:15:47 2009 +0100

    switched back to ets for file detail. Also remember to call compact from tx_cancel.

commit 2ce46bd0507f5badfdc14cd6e1c86fc6451ccfcd
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 11:26:13 2009 +0100

    only do compact after having ack'd all messages.
    This should prevent unnecessary compactions (i.e. we now have the ability to scan and delete all now-empty files before attempting any compaction).

commit bd4dbc2bd9f93310a2297ef9553c8e76008fc870
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 10 19:03:47 2009 -0700

    Switch to two-arg version of get_env for performance improvement

commit a0329ef53a84049cfa7a111162391bef1849dc52
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 01:24:10 2009 +0100

    oops, forgot to remove that io:format in terminate

commit 7ebf39380b09a0f0f7035f5b0a37f3717f53ded4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 01:20:44 2009 +0100

    err, we only need to attempt compaction if we removed something!

commit b8b9896cf79bc62bc0e11da85e23922e024342de
Author: Matthew Sackman <matthew@lshift.net>
Date:   Sat Apr 11 01:05:09 2009 +0100

    Mainly removing the unnecessary file:position in append.
    This wasn't needed as I can track the position myself, and profiling showed that it is expensive (which I'd kinda been aware of before). Having removed it, things are quite a bit faster - though still CPU bound with smaller messages.
    Next step is to convert dicts in state into ets tables.

commit 1882d139375274368a3ab2bffe3695c2d3f5c9bc
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 23:21:54 2009 +0100

    did some profiling and brought out an mnesia lock much earlier.
    This means that for large commits, the resulting mnesia transaction is _much_ faster.
    
    also fixed makefile so that cleandb wipes out disk_queue too

commit a9ef08155fcfa72b7ba10f695781b6073aecb0e4
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Apr 10 15:06:44 2009 -0700

    Generalize rabbitmqctl to set_env/get_env/unset_env

commit a5e21a259e46557fc6d405fe38ce4685726d72e4
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 18:55:58 2009 +0100

    A couple more fixes.
    
    rabbit_disk_queue:start_link(1024*10, 100).
    
    List = lists:seq(1,1024*32), [rabbit_disk_queue:tx_publish(N, <<N:256>>) || N <- List], rabbit_disk_queue:tx_commit(q, List), io:format("committed~n", []), [rabbit_disk_queue:deliver(q, N) || N <- List], io:format("delivered~n", []), rabbit_disk_queue:ack(q, List), rabbit_disk_queue:tx_commit(q, []), io:format("acked~n", []).

commit 4bfc4dc263ee1a2339517ad90f2b1ce837084b21
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 18:01:31 2009 +0100

    refactored away from using the ets bag incorrectly.
    However, we're still cpu bound, need to do some profiling.
    
    rabbit_disk_queue:start_link(1024*1024, 100).
    [rabbit_disk_queue:publish(q, N, <<N:64>>) || N <- lists:seq(1,1024*1024)].

commit 3b5a7e084e11ca53b8c25ee36c2ffb071aab9ac7
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 17:21:23 2009 +0100

    many bugs fixed. Still no compaction. However, performance is horrible, because the test which established ets:insert_new did what we wanted was actually flawed, and we can't do that, and ets:insert is not fast enough in a bag with many similar keys. What I want is to be able to say "yes, just insert this, I guarantee that whilst there are other equal keys in this bag, you don't need to go and try to find matching values". Hmph

commit a1c140505e6bd32d57fabc37597981bc34f11e53
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 16:07:21 2009 +0100

    initial fixes from testing

commit 41376d3da57588fc5c3536e80edc048bbfaf6434
Author: Matthew Sackman <matthew@lshift.net>
Date:   Fri Apr 10 15:42:40 2009 +0100

    All but the compaction/GC done now. Not tested at all.

commit 1792cd3c3b5d61c8e312ac1f9e6e417cb4061312
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Apr 9 18:44:57 2009 -0700

    Use longstr instead of (nonstandard) binary

commit 24a45f99ebd9a6a95e15ecd3a141792f06e85661
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Apr 9 18:41:49 2009 -0700

    Use AMQP table encoding for the data.

commit 9b008dc39ac479cd267282edb6f0d7c8de5493b0
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Apr 9 17:16:57 2009 -0700

    rabbitmqctl tap control

commit f7c3527a5fc88646787d111663aa19a51018ed9c
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Apr 9 16:49:42 2009 -0700

    Initial solution. Remaining: documentation; rabbitmqctl interface.

commit 056b4b013476b0a6d447c81ec5fb598048241ac9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 9 18:01:36 2009 +0100

    internal_publish, internal_deliver, internal_ack done, but UNTESTED.
    publish will try and roll over to a new file if necessary.
    Ack has not yet been taught how to do compaction / GC.

commit cfbef7c8be341a243c8e4246f4dd8d3baf8d162f
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Apr 9 14:17:20 2009 +0100

    Well, I think I can recover crashes that happened mid way through a compaction.
    Note this hasn't really been tested yet...

commit ce276577310ace4cabd61bd7f6b784e73cea0c21
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 8 17:45:14 2009 +0100

    GRRRRRR. I marked the previous commit as branch bug19622, not bug19662. Sorry.

commit deaff254e2a2c91a074fb55df211c2fa887464c9
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 8 17:42:44 2009 +0100

    Seem to be able to reliable read and write...

commit 7851f13f32e4f7223d63c322247d9fca2de035c5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 18:12:38 2009 +0100

    remove/add files missed on previous commit

commit ba0ef93153857cfdc49ac24500eb2dbd14077d76
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 18:09:10 2009 +0100

    use wrapper scripts in macports

commit 7e4864aafe68384d56cd0dc168e79f3a94c025bb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 09:20:45 2009 +0100

    Added tag rabbitmq_v1_5_4 for changeset 5a3d301b27d8

commit 10d1421c0d985f96facc33182631852c8454544d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 09:20:34 2009 +0100

    add package changelog entries for 1.5.4 release

commit a2eac8852e9c5110a71c8e055fee6512b968a0b4
Merge: 107514ec9 b109eca76
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 08:52:14 2009 +0100

    merge v1_5 branch heads

commit b109eca766b004ab933a9f6d49c2ba53cc6d63ae
Merge: ba504eadf a5318963b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Apr 6 08:40:34 2009 +0100

    merge bug20552 into v1_5

commit 107514ec95ef56d180ec8a7c0150f10e98a06b1b
Merge: ba504eadf a5318963b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Apr 6 08:39:41 2009 +0100

    merge bug20552 into v1_5

commit a5318963b84e114c57223357b4e0c4797e5133d7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Apr 2 20:48:57 2009 +0100

    Forgot 'in place' option for sed.

commit 40cc23ce4796a38bfddaac1d11e568ca1fc282c0
Merge: 233c0af73 a9682552d
Author: Matthew Sackman <matthew@lshift.net>
Date:   Wed Apr 1 16:25:28 2009 +0100

    merge bug20546 into default

commit a9682552d4efd213a3718525605bf6dfe3783adf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Apr 1 15:08:42 2009 +0100

    wait forever

commit ba504eadf74c7231ce5607723597c5903e062729
Merge: 551cc704f 494e57bef
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 16:06:36 2009 +0100

    merge bug20527 into default

commit 8a6d284c9adeec24d93e009b3e4ceb9063883bf2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 14:40:53 2009 +0100

    add some signatures

commit 1e60251a2db885c60ddae6abcb617be4084c364c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 13:43:49 2009 +0100

    add some priority_queue tests

commit 318b78e8b75e56cc2d726f2d1096abc52ebdd560
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 13:18:07 2009 +0100

    fix bug

commit d36d44d4b9b91ddf396226fdff139688c2bbabcb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 13:11:32 2009 +0100

    small simplification

commit 78fadef2928be9e2d7533613bfcc98224ada1854
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Mar 31 11:47:44 2009 +0100

    don't call into queue module and don't break its encapsulation

commit 551cc704f2234e0799a86d35d3ac9abe278cc9c5
Merge: bf6ae605e ace5c5a69
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Mar 30 19:49:57 2009 +0100

    merge bug20461 into v1_5

commit bf6ae605e31e9a988e70eccf7b31f9594fe43e32
Merge: 7b21e68bf 71dc7d302
Author: Emile Joubert <emile@lshift.net>
Date:   Mon Mar 30 15:57:37 2009 +0100

    Merge bug20526 into v1_5

commit 233c0af733bd9fc1188b385fe7c35aedd700e4c5
Merge: 6c31c5657 455b0fcc5
Author: Matthew Sackman <matthew@lshift.net>
Date:   Mon Mar 30 13:30:22 2009 +0100

    merge bug20423

commit 494e57befe6dce628d0a8275beb1adc9d9e2415a
Author: Michael Bridgen <mikeb@lshift.net>
Date:   Mon Mar 30 11:10:35 2009 +0100

    Use a backup extension and remove the file afterward

commit 7b21e68bf1e8d7b79c87463501ec49790ff6cd23
Merge: 207666669 4dfb80bf3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Mar 30 09:33:34 2009 +0100

    merge bug20518 into v1_5

commit 6c31c5657d2dd3b8296e5ecd7a198dad9c40f15c
Merge: 4de15243b 207666669
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 27 11:48:15 2009 +0000

    merge v1_5 into default

commit 207666669781ca1c5a082b46dcad4f16c8817fff
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 27 09:37:06 2009 +0000

    spell out difference in licensing for the spec json
    patch submitted by John Leuner

commit 71dc7d3027e26ac81e541d73f9c3ac94ccb64ea6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 26 17:57:38 2009 +0000

    convert script home path to short name notation
    due to a bug in OTP that results in 'spawn' being unable to handle
    paths with spaces. See
    http://erlang.org/pipermail/erlang-patches/2008-August/000267.html

commit 4de15243b05ded070e48397159326fd811d7e3b2
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Mar 26 17:38:03 2009 +0000

    Correct name of table.

commit 4dfb80bf318aee02858c8afc34539826214a12e1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 26 16:27:22 2009 +0000

    on windows, write to stdout in stderr to avoid buffering

commit c5086603d1b37f9ca233c9399b6e24d4b92fb94c
Merge: 8835081a4 405752243
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 26 11:53:13 2009 +0000

    merging multiple heads of v1_5

commit 4057522430a92ceae017b54376066326fea4a427
Merge: f8fa3edf6 5981a69b2
Author: Matthew Sackman <matthew@lshift.net>
Date:   Thu Mar 26 11:47:08 2009 +0000

    merge bug20500 into v1_5

commit 8835081a481b8da24044dde561093481093fd9d5
Merge: 467bc5861 b8cc0c89b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 25 20:10:23 2009 +0000

    merge bug20460

commit 467bc5861a5b45b375da0b7dd35d2bf9af862da1
Merge: 4723b3e11 e312ace1d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 25 19:50:17 2009 +0000

    merge branch heads

commit e312ace1db117e589b703b1238381aa890f48fbe
Merge: f8fa3edf6 b7e6bd498
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 25 19:44:40 2009 +0000

    merge bug20454 into v1_5

commit 9156fffc9a80e8d681bbb167b7dddaad424dbf0d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Mar 25 17:50:29 2009 +0000

    Include generate_app in source tarball

commit 4723b3e114625d3c1a476130a4d2207042a827b4
Merge: e716da225 5fba5010f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Mar 25 11:20:43 2009 +0000

    Merge bug20516 into v1_5

commit e716da225fb914086dee4bf31277a0b7ac4bba3e
Merge: f8fa3edf6 ae6b70ba4
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Mar 25 10:39:04 2009 +0000

    Merge bug20454 into v1_5

commit 5fba5010fee525480756df42dd700b2bce0e0166
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Mar 25 10:26:34 2009 +0000

    Removed duplicate entries for /var/log/rabbitmq and /var/lib/rabbitmq in the spec

commit ae6b70ba457069ea0108f0e8fc4cbd5bcfb0a6f2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Mar 25 09:58:10 2009 +0000

    More sensible name for the macro and moved the definition to preamble.

commit ace5c5a694a2abeb4777feb6aa32c5dbead39c42
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Mar 24 11:35:30 2009 +0000

    Added RABBITMQ_SERVER_ERL_ARGS to rabbitmq-server.bat to be consistent.

commit b8cc0c89bba520f2e4ddd9ec10cff0be0df24534
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Mar 24 01:49:22 2009 +0000

    Added RABBITMQ_CTL_ERL_ARGS into rabbitmqctl script

commit b7c369a991bbb290c24586af38f38c65e72c4713
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Mar 19 21:57:42 2009 +0000

    Use RABBITMQ_MULTI_ERL_ARGS and RABBITMQ_MULTI_START_ARGS in the batch file

commit b7e6bd4989b4889d81b854bb8a313d9a72203208
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Mar 19 21:26:06 2009 +0000

    Copy the initial wrapper script to build directory and then fix the path, instead of directly running sed on the source file. There is no need to run sed on init.d script, since we no longer use any paths that refer to /usr/lib.

commit 5981a69b23d1b15840d391cd12aafd6c5bc7503f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 19 15:43:56 2009 +0000

    recover exchanges/bindings/queues in per-item transactions
    Because recovering them in large, single transactions is incredibly
    slow, with complexity that is far worse than linear in the number of
    entries we recover, presumably due to the way mnesia represents
    transaction-local storage.

commit f8fa3edf69227d62ab0fd4978affadebaeb89dae
Merge: 2ede065c4 422a8cf41
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 19 13:05:55 2009 +0000

    merge bug20455 into v1_5

commit 2ede065c4411c0d1dc95d17ac1a2dab93ebc6af8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 18 10:56:46 2009 +0000

    oops

commit 3e15309842d24ef4113b3ac446fb3efac083de82
Merge: 638179052 74b882c05
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 18 10:54:55 2009 +0000

    merge bug20462 into v1_5

commit 74b882c054a06359c602b1b46bd789f603312ba7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Mar 18 10:32:43 2009 +0000

    make it more obvious that RABBITMQ_MNESIA_DIR is special

commit 3c323c73951375b942704fb46ea007cb3db4509b
Author: Emile Joubert <emile@lshift.net>
Date:   Tue Mar 17 18:51:35 2009 +0000

    Update some 64-bit documentation

commit 1dc3656ffd8216e045700343782225e86c86badc
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Mar 13 16:25:33 2009 +0000

    Split out the environment variable munging as described in the ticket, except for those variables which are
    derived from other variables.

commit 8cdc8193dfec21a659bb5417650312545db6c8d6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 13 08:58:45 2009 +0000

    do not use priorities for notify_sent and unblock
    since the benefit is unproven

commit de5f50f4d73f6768f810d8aaa0f354ca785c89de
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 13 08:43:57 2009 +0000

    fix bug

commit b83f85e5f268e641d5e63d768267d9b86b949d83
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Mar 13 08:41:52 2009 +0000

    change representation from gb_tree to kv list
    which is much more efficient for small numbers of priorities; the common case.

commit 32ff34ae81fddd0707c5e699194cea42c5f7387c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 12 19:03:32 2009 +0000

    document priority functionality

commit f0a5e2c1cc96a2dc387b17dac7c551e5eb09c21e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 12 18:34:31 2009 +0000

    make in/2 insert items that are low priority
    and make to_list do something sensible.

commit e0dcd559dd7540daa5ec50a9cc79eae9d090d431
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 12 18:25:57 2009 +0000

    another bug fix

commit c44b6f17330915eb439cf24bcdbba1756604eca0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 12 18:13:52 2009 +0000

    fix bug

commit c61c5144f675d9c23c7ed738d65ec57a04c5da5e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Mar 12 17:05:31 2009 +0000

    first cut at extending gen_server2 with priorities
    This just changes the representation of the message queue; the API
    changes are still to come.

commit 422a8cf411958d4c8b767b9da6e2b3973507536c
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Mar 12 16:36:43 2009 +0000

    Make all the packaged scripts cd to /var/lib/rabbitmq, and remove a
    redundant "cd" from the init.d scripts.

commit 9125971827bee48265b84656d6691de24444e06a
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Tue Mar 3 08:27:05 2009 +0000

    Follow advice of MacPorts committer

commit c927f59ad6b428c2e64ef08782aaf66cf952b3aa
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Feb 27 17:41:20 2009 +0000

    Check in macports packaging contributed by Chris Pettitt

commit 455b0fcc5edb8995324c7ba6d91878f74c81c9a9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 27 01:46:03 2009 +0000

    persister hibernation
    also changed force_snapshot to do a flush before snapshotting, which
    makes forced snapshots behave like ordinary snapshots.

commit 68fc0eb08cbb2a5380ffcd04fe6530183c8a32b9
Merge: 3f5c0fce9 638179052
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Feb 24 19:21:48 2009 +0000

    merge v1_5 into default

commit 6381790521e37666d772654106112763ddc46071
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Feb 24 18:24:32 2009 +0000

    Added tag rabbitmq_v1_5_3 for changeset 3fd499569a57

commit cee628003601efa6ffd67088c78c8c58ccc97f4c
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Feb 24 18:24:12 2009 +0000

    add package changelog entries for 1.5.3 release

commit 90cf6f4071c0bb9989869041b51d7a2585773424
Merge: 0ccb25e44 b0a300051
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 24 17:37:10 2009 +0000

    merge bug20410 into v1_5

commit b0a300051132ca1bd56e206641994f0330a6b36f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Feb 24 15:05:01 2009 +0000

    Apply John's change

commit 0ccb25e4403ea12b2d640594cbc10659cb22223b
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Feb 23 16:07:32 2009 +0000

    Added tag rabbitmq_v1_5_2 for changeset 7db73a31654f

commit 5acfba7103efd4dc8e48e39c740f3ab1969bbfad
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Feb 23 16:06:06 2009 +0000

    add package changelog entries for 1.5.2 release

commit cc77aa9257aec17e5dc0d629a77f5281364c326e
Merge: 761fe9af5 cca79602d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 20 16:56:51 2009 +0000

    Merge bug20329 into v1_5

commit 761fe9af543fbc7943ead73d7f7d57dae438e1f0
Merge: 71077f0a2 ea37e79b0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 20 15:43:24 2009 +0000

    Merge bug20352 into default

commit cca79602d15ac39515a5435e23e537089c02eb9b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 20 15:31:32 2009 +0000

    Use _locastatedir and _sysconfdir macros in all possible places.

commit 783c28fc1ff31620fa99a26280a583f9da8a9c06
Merge: 9c8b9d142 71077f0a2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 20 15:13:20 2009 +0000

    Merge v1_5 into bug20329

commit 71077f0a21145fbd72db936b95c5075c0910e3e6
Merge: 6c2bf946b c47c1bcdc
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 20 14:35:02 2009 +0000

    Merged 20383

commit 6c2bf946b11adfe6bb67777c648e4b8adcc1f40e
Merge: e1714e5fd 3059d8c29
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 20 13:48:26 2009 +0000

    Merged 20327

commit c47c1bcdcd6270239c93d61c27ffaaf0233e310e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 20 11:10:54 2009 +0000

    Logrotate will report only errors and ignore anything in the STDOUT.

commit 9b35a0aed208f16f9cfa1fb63c6e5c2b75f02a08
Merge: a7c825b0d 3f5c0fce9
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 08:46:15 2009 +0100

    Merge with upstream default

commit a7c825b0dd8ef6828cca881dd6cfc6bfc2c6ecda
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 08:29:36 2009 +0100

    Cosmetic. Using a list comprehension instead of lists:foreach

commit 1185d2f86a2b59993c6f5006d05e798272245112
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 07:45:24 2009 +0100

    Cosmetic. Its better to match on [] than on length(AList),
    makes the code more concise.

commit a466a6dc1677e5d42fe1c9ec096d7ce55cbeaca1
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 07:29:41 2009 +0100

    Cosmetic. Keep variable names as normalized CamelCase for
    consistency

commit 3b917b2e78a78bfb226b7839f951180fddd8e894
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 07:26:26 2009 +0100

    Cosmetic. Move the ssl lines right after the tcp_listeners line,
    they're "logically" related

commit d9ba38747ba36527bc8cc6d415df4cb401ac463c
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Feb 19 07:25:32 2009 +0100

    Uhhh... put back the full error message. I misunderstood the
    QA comment before.

commit ea37e79b0b3ae6a09eb56d13e0f82d3b71f3cd32
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 18 00:34:45 2009 +0000

    Disabled starting the server in rpm packages according to fedora guidelines.

commit 3059d8c2905bb153f801ce3364bdaa4d1c9e181b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Feb 17 22:06:17 2009 +0000

    Fixed sed to properly handle rabbitmq.conf.5 and updated other man pages.
    /etc/rabbitmq is no longer owned by rabbitmq user.

commit 80d5c58c42d6ed73f067b374ed352ec5721fdb95
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Feb 17 21:14:12 2009 +0000

    Renamed man page for rabbit config

commit 3f5c0fce99c119abbe27ca1dd05e4bf57f27db3e
Merge: 7637fbde4 df8eb5505
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 17 14:12:12 2009 +0000

    merge bug20374 into default

commit df8eb5505a9822b6d085765b67fd118e9727dae2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Feb 17 14:11:32 2009 +0000

    make it easier to add more exceptions to the 'warning' category in future

commit 67dff52a1eb5df683e6a20eefb278cd16fad2fc0
Merge: 1ba5bef7b 7637fbde4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Feb 17 13:38:07 2009 +0000

    merge default into bug20374

commit 7637fbde4cae03f534dc53a6deb9bc3589b57229
Merge: fc8748a4c e1714e5fd
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Feb 16 16:02:02 2009 +0000

    merge v1_5 into default

commit e1714e5fd864767e3fbb0c17d154e75fff03146a
Merge: 517e79a95 21baacb3f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Feb 16 15:58:38 2009 +0000

    merge bug20348 into v1_5

commit 517e79a951c0368552e665a5cb59382776b92b1f
Merge: 0e04bc871 822ff8d74
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Feb 16 15:30:44 2009 +0000

    Merged 20345

commit 822ff8d745a9cbc6a43dc6d6850637c64e20b1c1
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Feb 16 15:30:15 2009 +0000

    prevent unwanted path expansion

commit 0e04bc871c41ea193c797d8ffabc30d0a2c6bcf7
Merge: 6d63ebc59 10fffbb05
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Feb 16 11:14:50 2009 +0000

    Merged 20326

commit 6d63ebc598bf1418e8df0359e2dcd37aea52a287
Merge: 6f0e6d40c 0a1157cf4
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Feb 16 11:13:51 2009 +0000

    Merged 20353

commit fc8748a4cc264c24b1c9f40fd42dd1e744376228
Merge: b4ad26ae0 10fffbb05
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Feb 16 10:50:45 2009 +0000

    Merged bug20326

commit b4ad26ae09de1db141469019deb0b054ddc09925
Merge: bc51775fe 3d469c969
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 13 18:31:41 2009 +0000

    Verified.

commit bc51775fe97d6c5567a70037449f1a0040761160
Merge: d821ba2a8 0a1157cf4
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Feb 13 18:15:42 2009 +0000

    Verified

commit 1ba5bef7bb2a8c2f80ff8147c4aefdc381b00552
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Feb 13 15:05:19 2009 +0000

    Special-case as a warning the relatively common abrupt-disconnection message.

commit d821ba2a80c9935751bae57108a1983e45752a6e
Merge: 14cc31c6e 21baacb3f
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Fri Feb 13 00:41:58 2009 +0000

    merge bug20348 into default

commit 0a1157cf4ac6b8b9747829853305efd6cd6eb587
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Feb 6 18:22:25 2009 +0000

    Added proper PATH env variable.

commit 3d469c9699845fefba18dfeae58a09c77b11e167
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 6 14:20:11 2009 +0000

    also prevent path expansion in rabbit-multi

commit 21baacb3fd7e7d3fafb3b62a9755c9f4ca92d6a2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 6 13:51:26 2009 +0000

    keep serial in separate process, to avoid persister bottleneck
    ...and move all the guid functions into a separate module

commit cedc376ef469b2c9b8350d34fcea4dc17867b2a0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Feb 6 11:49:26 2009 +0000

    prevent unwanted path expansion

commit 9c8b9d142e64b6975029f5c41421c3c4dc3022e9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 18:36:50 2009 +0000

    Use %{_sysconfdir} to locate /etc.
    Return 2 on usage error in init-script.
    Use %attr to define proper permissions for the /var/lib/rabbitmq and /var/log/rabbitmq directories and use -c parameter instead of running additional usermod command in the spec file.

commit 8e0d06624367a742004ac659a800d9ed3e61dad0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 15:54:10 2009 +0000

    Use shorter names for sources in spec file.

commit 320cb96d0c9f4e49537e3e26ad4209873b7bfd2a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 15:10:13 2009 +0000

    Included fixes for fedora review.
    Remove %debian macro and used --nodeps instead.
    Renamed /etc/default/rabbitmq to /etc/sysconfig/rabbitmq as this is the default configuration file on rpm based OS.
    Use make -j if possible in spec. Removed not recommended tags (vendor and packager) and added macro that prevents rpm from building useless debug rpm.

commit 10fffbb0584527e3809d04f1891b89cd311f9be3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 12:25:07 2009 +0000

    Remove PATH variable from init.d scripts. It is not the subject of this bug.

commit 08bf1ae266b3f6caa23e24dc646706e4dd8b5c3a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 12:15:17 2009 +0000

    Variables from /etc/default/rabbitmq can be later overwritten apart from NODE_COUNT. Don't use INITD_ prefixed variables.

commit 10ef518ba345ebe41f71dce4ac780f438339a853
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 11:47:14 2009 +0000

    Minor style fixes

commit 20c752b8f15c04f96050fb70e6d12a50545b3c7d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 11:45:04 2009 +0000

    Be consistend in using INITD_ variables in init.d script. Few style fixes in rabbitmq man page.

commit b9a882564fdd1a66cf30b2c6e58f4105982c4433
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 04:12:17 2009 +0000

    Moved main configuration from /etc/default/rabbitmq to /etc/rabbitmq/rabbitmq.conf. Updated man pages to reflect the changes. To avoid overwriting the variables those in /etc/default/rabbitmq need to be prefix with INITD_. Added checks in scripts to handle those cases. rpm and debian need to handle /etc/rabbitmq directory.

commit 04be2c05ed54a61a4e9a31f5d243fe7dc6a54fe0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 01:49:22 2009 +0000

    Use common wrapper for scripts in rpm packages.
    Fixed indentation. init.d script uses wrapper.

commit 7424a912b19ec6e2aaf6a03d291aedc4a9aaa8fe
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Feb 4 01:02:39 2009 +0000

    Provide common wrapper script that is used by all commands and requires root permissions to function normally.
    Also added PATH variable in init.d and use new wrappers.

commit b7955a4022ab83c939b36ec38b26eb0917d5632c
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Feb 3 22:57:30 2009 +0100

    Fix dialyzer spec for rabbit_net:send/2

commit eb887dc3154e2911a03361c9a30edb4a2407aa83
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Feb 3 10:13:19 2009 +0100

    Add 'Label' parameter so we can properly log SSL vs TCP listeners

commit 36016269737f45e9afb123ac951cec47de71a6a0
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Feb 3 09:35:31 2009 +0100

    Close the TCP sock if SSL upgrade fails.

commit fafbbdb99e7fab763969675e87534a82772b4460
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Feb 3 09:34:06 2009 +0100

    Make error messages nicer and consistent with the rest of the codebase

commit 14cc31c6e017db4d3fac44b39bb53aeea426b9a8
Merge: a37e39a39 6a7d628eb
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Feb 2 17:34:27 2009 +0000

    Merged bug 20179 into default

commit a37e39a39cb894bfecd98e4466a88d203984e839
Merge: 998448d1c 0c5a7d266
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Feb 2 17:28:51 2009 +0000

    Merged bug 20260 into default

commit 6f0e6d40c30079764b4e4e7472883d8abb9ff7e9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Feb 2 14:59:23 2009 +0000

    create v1_5 branch to supersede v1_5_1 branch

commit 998448d1ca360c5f7cf233c6ce77384d89d57bf7
Merge: 6fb6d987e 3d774ef31
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Feb 2 12:07:36 2009 +0000

    Merged 20288 into default

commit 6fb6d987e0bd3987615a255bd84ead8888bc5b07
Merge: 268703e9c fe34dc297
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jan 30 16:24:56 2009 +0000

    Merged 20275 into default

commit 0c5a7d266e42c9b71ef3a304fdf5614b85e2fe2f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 30 11:48:55 2009 +0000

    get rid of index on 'pid' field in rabbit_queue
    it's not used by any of our queries

commit fe34dc297e75bd98db1ec8c24bdc2ede4101cfe4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 29 21:06:23 2009 +0000

    don't terminate channel processes abnormally for amqp errors
    since that causes unnecessary error logging

commit bcb4308d58e71c4e8544c988e0a630717895cf7c
Merge: 0370c95e4 268703e9c
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Thu Jan 29 12:26:10 2009 +0100

    Merged with upstream

commit 268703e9cd1ccd4faa98dd23752a24e0336fe104
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 28 23:18:08 2009 +0000

    cosmetic: break some overlong lines

commit 3d774ef31a55d3da3068d9f99c5b9d499855f692
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 27 21:57:29 2009 +0000

    refine permission structure

commit 0a90720b0f3e8ad4d8619fd5e24d1601b71bd614
Merge: 25964d18a 7f080eeb7
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jan 27 12:51:00 2009 +0000

    merge bug20193 into default

commit 7f080eeb74d94c8d61ccda594dc7eadf486f56ca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 26 11:47:50 2009 +0000

    more efficient locking

commit fd0a5e07acd3d337cb979bfa820c342f2835c648
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 22 21:51:39 2009 +0000

    prefix all mnesia table names with 'rabbit_'
    and
    - get rid of plurals in table names
    - change rabbit_amqqueue to rabbit_queue
    - put table attributes in more sensible order

commit c05f6a1fcac559898d73a108f242469a59ed4437
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 22 15:54:44 2009 +0000

    don't infer table name from record type in mnesia ops
    This is in preparation for prefixing all table names with 'rabbit_' in
    order to avoid conflicts with other apps running in the same VM.
    
    This is a fairly straightforward change. The only tricky bit is the
    untangling of rabbit_exchange:indexed_delete.

commit 25964d18a56f65e94b64dace82bb409e64dab4e9
Merge: 33d0c4627 f02d49ed6
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 22 13:47:46 2009 +0000

    Merged 20173 into default

commit f02d49ed637a9033ea0dd841522ea6417be34375
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 22 13:28:50 2009 +0000

    refactoring

commit bdd7d91d30f50d3806384d865633ae135f75898e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 22 12:56:33 2009 +0000

    fix indentation

commit 9ae4a4a9a2ac7f8360ea5d5a6e015b52687b3bb2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 22 12:54:35 2009 +0000

    typo

commit 6a7d628eba8abde44601474982dfdfcd2fceb295
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 20:13:09 2009 +0000

    turn rabbit_router into gen_server2
    ...in order to protect it from the effects of long message queues.
    
    This isn't actually relevant at the moment because the bulk of the
    router code is disabled in order to deal with bug 19758. But we will
    re-enable that code eventually.

commit e6033f16979bb678adb32619ef8ef98349b9a37a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 17:21:32 2009 +0000

    anybody can do anything with server-named resources
    ...as long as they get hold of the name, which is strong

commit 9cc2808bbbcd1fb7765be0da53c5ac8657398e66
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 15:23:26 2009 +0000

    document new rabbitmqctl commands

commit 10627f44fb714cf01a8889c0bd594c151224a34a
Merge: 3afe3cc92 33d0c4627
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 14:36:08 2009 +0000

    merge default into bug20173

commit 33d0c4627618c5fbde6b2a85483ed038f4dba293
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 14:20:52 2009 +0000

    add forgotten docs for delete_user command

commit 0f30a08781406467f137d3526974209b3c0c68bf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 14:20:17 2009 +0000

    cosmetic: remove superfluous whitespace

commit 8a10b8ab18f02e742072dc77b1796189d38b130b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 21 14:17:54 2009 +0000

    remove merge conflict markers

commit 8c72256a0d812062f4e36d606953348cde2e42e4
Merge: e94eeb60d 1de06e45f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:24:17 2009 +0000

    Merged 20097 into default

commit 1de06e45fb1639c82ded2fb8b63f47e536c5c2f4
Merge: adc88315b e94eeb60d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:19:48 2009 +0000

    Merged default into 20097, again

commit e94eeb60d2fb7907eb3a44fe86b10ef5c590e308
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:18:34 2009 +0000

    Bad conflict resolution

commit adc88315b04e35123a69bcd30dafa5be70fc8787
Merge: 9604a10ae 51b19aaff
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:17:21 2009 +0000

    Merged default into 20097

commit 51b19aaff21998a54870db8ba893ee10a9531779
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:07:03 2009 +0000

    Fixed hg tag file

commit 679373c232c358a2d337e443399a22c5441835db
Merge: 7875ef690 e1fb7f0e3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 21 13:00:07 2009 +0000

    Merged v1_5_1 into default

commit 3afe3cc92d6c322c8f1d9eac671201186d09203d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 20 20:35:20 2009 +0000

    simplify resource access cache
    check_resource_access throws an exception on failed auth, which closes
    the channel. Hence the cache can be simplified to a simple list of
    {Resource, Permission} pairs for which authorisation has previously
    succeeded.

commit 86a83e889bea3b6803392a33e40eb75f871ccdfa
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 20 08:35:16 2009 +0000

    replace simple permission cache with lru cache, to make it bounded

commit d61b7206a3da2c8614b7083c8f1d1606197c207c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 19 22:21:27 2009 +0000

    clear permission cache before hibernating

commit 260e1a21a4a81bd1d0586d4bc784bd296dbfc9c3
Merge: 2ac306a64 d1a74d974
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 19 22:19:56 2009 +0000

    merge default into bug20173

commit 2ac306a6447ed68f04c6f354a540898a93dba8fd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 19 22:18:34 2009 +0000

    cache permissions in channel

commit 462687d62250efa4f161ddae4fab2f4c95f31868
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 19 18:01:34 2009 +0000

    replace list_{vhost_users,user_vhosts} with list_{vhost,user}_permissions

commit e1fb7f0e3d89c8431ba5520dff48fe939c072a1c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jan 19 15:53:28 2009 +0000

    Added tag rabbitmq_v1_5_1 for changeset 0f3f3a44ca0c

commit 90103f770d38fac6282c49890be7d96e394f8ec7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jan 19 15:50:08 2009 +0000

    add package changelog entries for 1.5.1 release

commit 7875ef690f84f2e422c3c3e5b6cfc0e35bda02d3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jan 19 15:27:08 2009 +0000

    Added tag rabbitmq_v1_5_1 for changeset 2e6e4090d44b

commit d1a74d9743071259b96ec246b303ea755cd0026e
Merge: 55b9634db 3f1dcabc6
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jan 19 11:38:23 2009 +0000

    Merged 19749 into default

commit a266dea2aa1e97814d9cc08e6f114141f726527b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 19 11:24:27 2009 +0000

    better documentation of message counts

commit 55b9634db41536abdc32ef9b5a2f3b5d729326c1
Merge: d204c60af daccae646
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jan 19 11:01:18 2009 +0000

    Merged 20099 into default

commit d204c60afe3722e77127e2bf393216eb5f2b1b4a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Jan 18 09:53:18 2009 +0000

    better documentation of message counts

commit 692e2835db587ba6722ef7e8e118586a14333469
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Jan 18 09:09:24 2009 +0000

    cosmetic: correct indentation

commit 611d8f00e7b1664ff9a69e3d91abff0fbe1191a3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 21:29:52 2009 +0000

    better docs and error handling

commit daccae64614d5404edd2c3ec595b221f10ad34bf
Merge: 116b4c434 3bb4decb5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 18:42:13 2009 +0000

    merge default into bug20099
    which involved a few conflict resolutions. The most complex of these
    was dealing with the termination of the limiter; we now unlink from it
    first so we don't get a spurious EXIT signal.

commit 3f1dcabc60567c60f7c66bd3445ad5d66155943f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 18:07:58 2009 +0000

    change a gen_server:call to a gen_server2:call
    for consistency with gen_server2:cast

commit 03734cd1dde7ea76c6af2851e66c308a1e8ed6cd
Merge: dc91c8f18 3bb4decb5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 18:05:08 2009 +0000

    merge default into bug19749

commit 4bb5b5cc0ec57db39331340eb2e60e2cc1c13249
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 17:45:49 2009 +0000

    hook in permission checks

commit ea7885a47d3b8c2c343f12d1a81ea0a4c684122a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 16:24:34 2009 +0000

    beginnings of permission admin
    
    I changed the table structure (again). It's a choice between two of
    efficiency, integrity and no data duplication - I picked the last two.
    
    We pass the permission regexps around as binaries and store them like
    that too, just as we do for all other string-y datums.
    
    I was toying with the idea of making set_permissions take a
    #permission record instead of two separate regexp params, so that it
    is easy to add more permissions later. But that is inconsistent with
    the rest of the rabbit_access_control API, which is "flat", and
    complicates the code in rabbit_control and the rabbit_tests.

commit ed334fbf951ddd6337a7bf93ba5225bbad23adfd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 16 13:46:15 2009 +0000

    modify table structure in preparation for permissions

commit 3bb4decb57c18d1ad382f5939ccb9f46c5ecb251
Merge: b98f55452 70280d747
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jan 16 13:31:38 2009 +0000

    Merged 20071 into default

commit b98f55452132043f05b0876c01b69416a6ceba89
Merge: ea13b1d4e 7b69f26e7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jan 16 12:20:37 2009 +0000

    Merged 18557 into default

commit 0370c95e47a65eaff8a3c3ca8c7c1904a0811d5b
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Jan 16 09:18:25 2009 +0100

    Actually run 'make dialyze'! and fix some type definitions.
    
    Redefine timeout() to also take -1.
    Define a type error() for {'error', any()}. Less code
    
    There is still a problem with rabbit_net:send/2 type definition
    using iolist().

commit b0ff33470345e353a92f30d59b795c7064b2e6fe
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Jan 16 09:13:49 2009 +0100

    Make use of start_{tcp,ssl}_listener again

commit 6492e5cd2c47e564856fdb0f487e7b18a064b99e
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Jan 16 09:13:14 2009 +0100

    Bring back start_ssl_listener/start_tcp_listener and make them
    call the renamed start_listener which is now intended private

commit 0bf61065bbf665286f6eb59d4ec3f1c548f8ee82
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Jan 16 09:09:32 2009 +0100

    It seems I don't have to define the record types recursively.
    So I can remove references to ssl's sslsocket record definition

commit b1fa1a10150b6ec7cc47ebd5732a53cce4ed53d2
Merge: a656f8218 f85f56638
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 16:57:56 2009 +0000

    merge bug20064 into v1_5_1

commit f85f5663878efdf6259390e263954c0668153639
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 16:56:41 2009 +0000

    BUILD has been renamed to README

commit a656f821812db68f7de0fdbf099a2ee1dd633c27
Merge: 60b587891 5a1723ab5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 16:44:02 2009 +0000

    merge bug20125 into v1_5_1

commit 7b69f26e71792e5d2e24211a0cd3e4d5506e9af9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 15:57:43 2009 +0000

    add some comments

commit d96c129997ba55b8327edad7b9dd1a5ced82788e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Jan 15 15:35:40 2009 +0000

    Renamed BUILD.in to README.in

commit 5a1723ab51660f8162716f59043b7f84ba6a2eb8
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Jan 15 15:15:39 2009 +0000

    Less restrictive pattern matching in debian/watch

commit ea13b1d4e250f07b5b0351df3672e69ed4881305
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 14:34:29 2009 +0000

    ignore rabbit.app

commit 6a3ba91db9d3256c7f33f1181a6d5c9011fe4c6f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 14:33:28 2009 +0000

    don't try to dialyze rabbit.app
    ...it won't work

commit 7ca227c1d109aed0754a3e8ac7e63ce030a875fa
Merge: cef2795d4 d7e593b4f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 14:20:03 2009 +0000

    merge bug20152 into default

commit d7e593b4f361040eca03a5337ed4bcb4e154775c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 14:14:12 2009 +0000

    minor refactoring: more consistent signatures/matching in routing functions

commit 5e75164e8f6cc1df4913537de949cf0fdd7220b5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 14:04:03 2009 +0000

    refactoring to eliminate code duplication
    ...between topic and headers exchange routing

commit 4088c214dfabafdc6a07231ac95c7400b7763885
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 13:43:06 2009 +0000

    cosmetic and minor refactoring

commit 60b5878913bedae040b15b19ea91ebee6773265c
Merge: 3b32d5da9 19266f662
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 13:12:21 2009 +0000

    merge bug20111 into v1_5_1

commit 74a4070769036768cc2b08440c56eeb00ac254b2
Merge: 8d89b27be cef2795d4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 15 12:34:31 2009 +0000

    Merged default into 18557

commit cef2795d474a216c6ba239b5071fe69779d2803d
Merge: c59331934 431d8b633
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 15 11:46:15 2009 +0000

    Merged 20088 into default

commit 8a1e94129d0b7fd3ab4888bb77026e837a1bb02a
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 16:51:58 2009 +1300

    The PDF requires amq.match. The XML requires amq.headers. Create both.

commit beb6e44312e4dc7182c51e88dd443cfe412386d0
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 16:13:58 2009 +1300

    Implement routing for headers exchange.

commit abe958ccd670441b92771329acf3cd383709215d
Merge: b506530be c59331934
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 14:52:52 2009 +1300

    merge default into bug20152

commit c5933193440dcb6f98172ff51853e1e7ff086cd3
Merge: 26e0b8575 833b197ff
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 15 01:31:39 2009 +0000

    merge bug20155 into default

commit 833b197ff5a2e9642927909c7fa6863f863cb6b7
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 14:23:59 2009 +1300

    Use io:read('') instead of io:read("") to avoid a "prompt" of "[]" ending up
    in the output.

commit c1e30f937aadd54e43c71a91f836d1f44f7a16a7
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 14:23:29 2009 +1300

    Depend on generate_app when deciding whether to rebuild rabbit.app.

commit b506530be5b93d8f39b3fdb7aae2c41592e2025a
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Thu Jan 15 14:13:25 2009 +1300

    Add "amq.match" builtin exchange; accept "headers" in exchange.declare; and
    stub out routing implementation for headers exchanges.

commit 19266f66285450e87dcd51856eea7baee770a64d
Author: Emile Joubert <emile@lshift.net>
Date:   Wed Jan 14 16:13:00 2009 +0000

    Updated POD (rabbitmqctl rename pid to node)

commit 431d8b633896b00d96fb7ec1741007a2e3943fc7
Merge: 055817000 26e0b8575
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 14 12:18:08 2009 +0000

    merge default into bug20088

commit 116b4c434c754565388342e9d8ecf43bf9a17be9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 14 12:09:31 2009 +0000

    fix bug in handling of writer exit

commit fc5e2907693525f198128148f4f1cde15e73f5eb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 14 12:03:38 2009 +0000

    make the channel process hibernate after 1s of idleness
    to conserve resources

commit 26e0b857593d1375ae30d4a63a6fbf2acd2e0560
Merge: 3751ddcac cfbd3b0d1
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 14 07:42:15 2009 +0000

    Merged 20141 into default

commit 3b32d5da94c00f776c19a3fafa541f2b86dca117
Merge: d56c0a3d4 cfbd3b0d1
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Jan 14 07:41:15 2009 +0000

    Merged 20141 into v1_5_1

commit 3751ddcacc288c481c88ed8fa4bb4271699d27cc
Merge: ce83057d7 0d17829eb
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 13 19:50:49 2009 +0000

    Merge bug20035 into default

commit 0d17829eba6e9f24c81322c0547acf1d734391e9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 13 19:46:18 2009 +0000

    oops

commit 6d82dcfeb7c42dde335eeca1d3f0f6d13750a0c3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 13 19:36:22 2009 +0000

    Added required debian/watch file for checking latest source tarballs.

commit 727eaa2abd65bdaa537a284a395ef8fd43e64c29
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 13 19:00:50 2009 +0000

    auto-generate rabbit.app module list

commit cfbd3b0d15ffd0954d03d9babf1e65d5328f50d2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 13 17:13:24 2009 +0000

    use halt() instead of init:stop()
    it's much faster and perfectly safe in these self-contained programs

commit ce83057d7f965f681cb3c1c79bd00517731f7f2f
Merge: de6ee9123 d56c0a3d4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 12 17:24:05 2009 +0000

    merge v1_5_1 into default

commit d56c0a3d410a026a20dff9a44a810d4014d67c38
Merge: 98f317f87 b5edffe81
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 12 17:20:13 2009 +0000

    merge bug20121 into v1_5_1

commit 98f317f871184185df6c4f02cdf53d3477e21f54
Merge: 66e92fa11 ce1be773d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 12 17:06:58 2009 +0000

    merge bug20098 into v1_5_1

commit 66e92fa1171b8a08f5b7544b7121ccc62526025a
Merge: c6bef4d06 073e35d59
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 12 17:05:08 2009 +0000

    merge bug20096 into v1_5_1

commit c6bef4d069447308623d0d8ad2aefc7690066cc0
Merge: 58c212d3d 01eacdaf4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jan 12 15:45:23 2009 +0000

    merge bug20111 into v1_5_1

commit 26c63842421fa2275824b115e7ce6c34d9f38b38
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Jan 12 11:37:25 2009 +0100

    start_applications has been moved to rabbit_misc.erl

commit 600d478096f4f14c33731ee8d54b70b63473e1cc
Merge: 138687033 de6ee9123
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Jan 12 11:17:35 2009 +0100

    Merge with upstream

commit 01eacdaf4d9c6dcd3a8f3030c05a6dec169c6247
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Jan 11 22:24:33 2009 +0000

    Better dispatching while formatting results in rabbitmqctl

commit 7babb719188cf0d1f4b7b197fb99b20c756ec708
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Jan 11 22:02:52 2009 +0000

    Report node instead of pid in rabbitmqctl

commit 138687033e9375efe730888ee9bb848bcff21431
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jan 11 19:03:49 2009 +0100

    Add dialyser spec definitions to rabbit_net.erl

commit 53a14672698aaca12679203e59e6c3b2c56dbb2b
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jan 11 19:03:15 2009 +0100

    Redefine type socket() in terms of rabbit's ssl_socket which is
    defined in terms of ssl's sslsocket

commit 083a060a92799f32abed99fbfd893f04e55eba15
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jan 11 18:11:21 2009 +0100

    Re-write start_tcp_listener to take an additional mfa() argument.
    Use this from rabbit.erl to pass in the mfa's needed to create
    a normal tcp and an ssl listener.

commit 8ec74ff05711a834e46c1b8f64099fd9fa4c5584
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jan 11 17:42:41 2009 +0100

    The ssl_* lines were not properly indented

commit 67b667855cc5616d56038d8ab650eeaa46a71c3a
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Jan 11 17:39:04 2009 +0100

    Change the style of the exports to match rest of code base.

commit b5edffe81833cc52443d7c938eddc6a4a329cca1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Jan 9 19:06:57 2009 +0100

    Output file is given as an argument, do not use stdout.

commit 073e35d593e0ff02ffc8e93a5b20bae08c9ccc8f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Jan 9 17:41:44 2009 +0100

    Moved user name to the end of the command.

commit de6ee912350011d9fbc8a2e6788ae2634b47d770
Merge: 44390de96 58c212d3d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jan 9 15:40:28 2009 +0000

    Merged v1_5_1 into default

commit 58c212d3d871f4fd378846d7e2dc07b86bd50912
Merge: f84c74f3b d29263cab
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jan 9 15:28:22 2009 +0000

    Merged 20089 into v_1_5_1

commit d29263cab1a545b309d7cd3e9ab4f99d79c5fe7f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 15:12:18 2009 +0000

    the #amqqueue.pid is 'none', so return self() instead

commit 8690695be48b8571218aecfc886bfd2b1d919187
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 13:39:41 2009 +0000

    get rid of now-superfluous proxy_pid in channel state

commit 92eb99750223e4bac520e8457e932b0322325bf6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 12:26:45 2009 +0000

    get rid of buffering_proxy

commit 19be256662f509babac6f28e630466bbb45d71d7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 12:24:15 2009 +0000

    fix normal termination case

commit 31d439c4900a3d3b7fff369e850b9cf8529ac5c9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 12:12:38 2009 +0000

    first cut of turning rabbit_channel into a gen_server2

commit 357eaefee1f55d7ae4e5a201668a343bb9f731d3
Merge: 44390de96 055817000
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jan 9 09:39:26 2009 +0000

    merge bug20088 into bug20099

commit ce1be773da92efd30e16ef24f2e8e55ace02adb0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Jan 9 03:01:14 2009 +0100

    Removed PATH variable from init scripts.

commit 2432ffd913eca043ef4df5d894f5d7e03d3410e1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Jan 9 01:28:24 2009 +0100

    Use --gecos option in adduser to add user's comments field,
    instead of running usermod.

commit 9604a10ae3fc86bc84ffdbbf017d8ad6081e6796
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:57:02 2009 +0000

    oops, meant to advertise this as an ordinary gen_server
    which it still is, since I left the gen_server:start_link in place.

commit 6ce643b65a4858d58c9c6e70dda300d832688e77
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:53:14 2009 +0000

    replace gen_server:cast with gen_server2:cast in rabbit_limiter
    The limiter is co-located with channels but interacts with queues
    which may be on different nodes. It is therefore subject to the
    message reordering problem of cross-node gen_server:cast - see bug
    19749.
    
    For consistency I replaced gen_server:call as well, though I left the
    gen_server:start_link alone in order to avoid the (admittedly small)
    penalty introduced by gen_server2's modified main loop.

commit 88a364ae3a9976e760be28637de7f039348ffad4
Merge: 90282f049 dc91c8f18
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:36:17 2009 +0000

    merge bug19749 into bug20097
    and replace a few new instances of gen_server calls/cast in
    rabbit_amqqueue with gen_server2.

commit dc91c8f18a97bdfcca6430d7af889732574a10a5
Merge: 44390de96 457d791ec
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:14:20 2009 +0000

    merge bug19759 into bug19749
    The former was the wrong bug number.

commit 90282f049d1b09c27df3278115b0a6ba02b82165
Merge: 44390de96 8d89b27be
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:10:10 2009 +0000

    merge bug18557 into bug20097

commit 457d791ec894c9de2e1de18dade53ef48a1332eb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 22:04:25 2009 +0000

    replace all cross-node gen_server:casts with gen_server2:casts
    The latter is order-preserving, whereas the former isn't.
    
    Rather than just replacing the casts, I replaced all uses of
    gen_server with gen_server2 in the affected modules. That way we don't
    mix modules when talking to a given process.

commit 1b526ab9e46697538d3cab1d05171343c3060872
Merge: 44390de96 055817000
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 20:40:37 2009 +0000

    merge bug20088 into bug19749

commit 70280d7470faea66f547276e9c575e3fbc0c9c38
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 15:45:04 2009 +0000

    turn queue processes into custom gen_servers
    to avoid long message queues that impact the performance of selective receive

commit 7ff81916b7bbab9b5b291ef1a753a14eaab2cc23
Merge: 44390de96 055817000
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 15:39:00 2009 +0000

    merge bug20088 into bug20071

commit 0558170003bb864319e0a820cba424d9fc22cf64
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 15:09:01 2009 +0000

    gen_server2.beam is needed at compile time
    ...so the compiler can check that any uses of the behaviour implement
    all the callbacks

commit 44390de962d29ececdfcf8a03430676b467c7789
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Jan 8 14:48:36 2009 +0000

    cosmetic: use multi-line strings

commit 0c5f17140c1c3d1b0d5e0e446bfdd033141fcbbe
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 8 13:36:11 2009 +0000

    Cosmetic

commit f84c74f3b1f59b14513b6aaead2c7609dbcb97fc
Merge: ca8df8165 1eb9dd178
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 8 13:32:14 2009 +0000

    Merged 20020 into v1_5_1

commit 640c28b12abb8cfb6f51238e3b6ecd1828682f8b
Merge: 2849cbb74 1eb9dd178
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jan 8 13:29:49 2009 +0000

    Merged 20020 into default

commit 2849cbb74c399d8eb141b7060cb9a1e519282b4c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 7 19:31:41 2009 +0000

    minor refactoring
    export {start,stop}_applications from rabbit_misc, so that other code,
    notably the Erlang client, can call them.

commit 25865591a2ced2379a4acd605d3c7455334d8bd9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 7 16:41:08 2009 +0000

    order-preserving cast

commit 15524e75a4582713b61f77d21295f1f223525ebd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Jan 7 13:39:36 2009 +0000

    reduce impact of long message queues on selective receives

commit b9cb55f22cb41adb9a6c029985620477c279fd15
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 6 20:01:45 2009 +0000

    initial version of gen_server2
    This is the same as the R11B-5 version, except for the introductory
    comment and change in module name

commit ca8df81659b47237ebb2833dd53ab8fa663c4257
Merge: 7e6ba78fe 79c57985c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 19:57:53 2009 +0100

    Merge bug20067 into v1_5_1

commit 79c57985c8ebf084b34f298b4de5a0a64818c9dd
Merge: d1f8072d3 7e6ba78fe
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 19:55:10 2009 +0100

    Merge v1_5_1 into bug20067

commit d1f8072d3d0606addade36c16cc0294e9860b5b7
Merge: c686e7ef6 7ce4ccd0b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 19:51:06 2009 +0100

    Merge bug20082 into bug20067

commit c686e7ef61e82638521577667b0fe8acfefb591b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 18:27:42 2009 +0100

    Typo

commit 1eb9dd178daee2f7e292e9a7da46aa447d4261e3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Jan 6 17:23:59 2009 +0000

    enable memory alarms by default on linux

commit 7e6ba78fe8f8f700c5a86d76bdbb33f654459bbc
Merge: c4d8c273f 0217ecc0b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 18:22:42 2009 +0100

    Merge bug20033 into v1_5_1

commit 0217ecc0bcd5bfdbcff664bf6fe9e5342b77e9a4
Merge: ce0964268 c4d8c273f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 18:19:54 2009 +0100

    Merge v1_5_1 into bug20033

commit c4d8c273f16cc573f44ba80c239399baac71d177
Merge: 024f3ea56 7ce4ccd0b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 18:11:15 2009 +0100

    Merge bug20082 into v1_5_1

commit 7ce4ccd0bb45f877874376739036e3da43ad49e5
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 17:48:02 2009 +0100

    Removed arch conditional on sed.

commit 58b13cf50fbef8c17f8ba091251695e5e7156443
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 17:11:17 2009 +0100

    Generalize the rpm spec so that some values are substituted by 'sed' in the makefile. Default rpm release is for fedora. The only difference between suse and fedora are the dependencies (used files instead of packages in the former), location of init.d and final rpm name.

commit 59190c29640ac9e11c975039b93045a1182fbea7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 14:42:08 2009 +0100

    Use default macros in sed instead of using hardcoded path.

commit ce0964268e74bd584d0aa7c607c6707f46bdcfce
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 13:33:04 2009 +0100

    Fix spaces

commit 52e5215f0935540238037d02239d0afb4e713af7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 13:28:03 2009 +0100

    Define standard libdir macro in the makefile instead of overwriting it directly in the spec file for RPMS. This is to fix the wrong libdir macro under debian for x86_64 architectures.

commit 2c9850b3436991aeb2d3931dfe3ab10a3c22d8b7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jan 6 12:34:17 2009 +0100

    RPM %files section only lists files that are not under /usr/lib/erlang/lib/rabbitmq-server-$VERSION$, /usr/lib/rabbitmq and /etc. The first two are handled by only listing the directories and rpms checks them recursively.

commit 024f3ea569c94a2b967644d5d51a0f2acf99d4d5
Merge: 41360d785 69957f6f2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Jan 4 11:26:57 2009 +0000

    merge default into v1_5_1
    All the changes made on 'default' so far should go into v1_5_1. Which
    is lucky since we don't have to cherry pick.

commit 41360d7851b52b5fc51765792408afbe3467ef50
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Jan 4 11:17:10 2009 +0000

    create branch for patch release

commit 7e91f8c112de27823475f5c51d25cfc12ff861f0
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Dec 29 11:14:12 2008 +0100

    Doesn't _really_ make sense to send {inet_reply...} on error.

commit cd054d71626519e587d6181309063742579fd19f
Merge: 2955e19df 69957f6f2
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Dec 28 23:57:02 2008 +0100

    Merge with upstream

commit 2955e19dfa2950d165e046ba3fea79ab4c3bd608
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Dec 28 23:54:04 2008 +0100

    Make rabbit_net:port_command mimick erlang:port_command more closely

commit 7071f433724aefa5525c9d7f27a4f54492a512a8
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sun Dec 28 23:19:53 2008 +0100

    Remove the hardcoded ssl options, and read them in from the app env

commit 69957f6f24f98fb0ad264599b47ca6c71ebb38b8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Dec 27 11:16:52 2008 +0000

    simplification: use alternative 'try' form

commit 6b467635d99035d5d2aedb14d3b97b38099905e2
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 27 09:04:40 2008 +0100

    Cleanup ssl_connection_upgrade a bit.
    
    Use rabbit_log module inplace of error_logger.
    Use SSL/TLS consistently in message logging, instead of SSL vs SSL/TLS
    Log the Reason when logging an ssl connection upgrade failure

commit 065b2bcca3822c2e843c5cbd852cb06433b4a7f3
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 27 08:50:11 2008 +0100

    Closing the ssl socket already closes the tcp socket as well

commit 7917919d0832956e32a94ecb7e44b1f2f2a64b02
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 27 08:41:03 2008 +0100

    Reverse the encapsulation of infinity timeout in rabbit_net:async_recv/3
    We now call it externally with the atom 'infinity' and internally,
    send -1 to prim_inet:async_recv/3

commit cebde781e6cf6907c3d4f40abb777ee9e2d6f102
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 27 08:09:41 2008 +0100

    Rewrite rabbit_net:async_recv according to Matt's suggestion.
    Interesting way of shortening the entire story. I like it...!

commit dd70adcf1c7415c46d06025576ff6cc16e9e6d55
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 27 07:53:03 2008 +0100

    crypto also needs to be started only if ssl_listeners are up

commit 8efbbc562da10f38759d0c382432b79e5699fea8
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Dec 26 13:13:25 2008 +0100

    Change the way that ssl_listeners option is specified.
    
    I have added an empty list of ssl_listners into the application
    environment by default, which will now need to be overriden by
    config options, perfarably in /etc/default/rabbitmq
    
    Also, make ssl app to be started ONLY when there are valid ssl
    listeners configured

commit a077f8415e7be19bf290e7e87da100e247b6abab
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Dec 26 11:26:17 2008 +0100

    Rename rabbit_ssl_socket to ssl_socket.
    No other records are namespaced

commit 50518fa914afe614de488f887d86a8b8f433022b
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Dec 26 11:21:31 2008 +0100

    Add rabbit_net to the .app file

commit a625e7695d9af4083a137821e52bd3afa09c85c2
Merge: 9e4fdee06 4be225797
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Fri Dec 26 10:29:00 2008 +0100

    Merge in upstream changes

commit 8d89b27beb0efdd8b1a29e23180c7b3b318128e5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 26 09:09:25 2008 +0000

    tidying up, refactoring and some cosmetic changes

commit 8ec3e7741435e923a7d0fb605130cf2d6e6ca3d2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 25 20:10:34 2008 +0000

    cosmetic: rename 'in_use' to 'volume'

commit 83cde40a8aec358d398ca3a4b6b5addd46dece03
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 25 19:46:49 2008 +0000

    optimisation: only notify queues that have had can_send requests rejected

commit 0dce1d0a71b9add835f722e38419760428b69d92
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 24 14:57:47 2008 +0000

    destroy limiter when a channel becomes unlimited
    which results in far more efficient handling of subsequent deliveries

commit d9dcfb42bd6763bd066d53fb2f1effc675eb14c6
Merge: b6fc89376 1a613c1bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 24 00:26:39 2008 +0000

    merge branch heads

commit b6fc89376c8787657c5cf08bf7a45fa60f4b6d25
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 21:54:26 2008 +0000

    don't leave the limiter behind when the channel terminates

commit 8d9b79633d0a4dae7f1975a31ccbc52dc059c7de
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 21:44:52 2008 +0000

    add type spec for start_link

commit e519cbe847cf449cf7d491bf2022d8c63a7f7b00
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 21:39:11 2008 +0000

    handle the "no limiter" case more obviously
    This is no semantic change since gen_server:cast(undefined, ...)
    returns 'ok'. However, it only does so because it catches the 'badarg'
    error thrown by erlang:send. It is probably more efficient to not
    attempt the send in the first place. Plus for documentation purposes,
    and to keep dialyzer happy, it is useful to state explicitly which
    functions are expected to be called on an 'undefined' limiter.

commit 4be2257979970f5b697d1e4402ca0bd6bd3ae691
Merge: 48abf8ddb 42360d6d9
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Dec 23 21:15:00 2008 +0000

    Merged 20061 into default

commit d3cf883b712e6f5f815aaa8dbcbf993a5ed57ef1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 21:14:46 2008 +0000

    cosmetic

commit 699abf69df84406d5a56f6851353d9a608b8d860
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 20:47:16 2008 +0000

    deal with limiting after consumer subscription

commit 42360d6d969d641262f157896ce95017e4bc0e83
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 17:36:11 2008 +0000

    deal with race condition
    queues may get deleted between the route calculation and the queue lookup

commit fa2c6bbd15c90722180b82e92685bdb31f9e089e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 16:28:22 2008 +0000

    create limiter lazily
    This makes an 'unlimited' channel as efficient as it used to be

commit b231622c007710b6bed38804b08d7c19aa1c7e62
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 16:00:34 2008 +0000

    make limiter keep track of all queues with subscriptions
    This is more efficient since it avoids the repeated (de)monitoring and
    updates to the limiter state.

commit afefa63889d5f4d21eb8d7bc737cce9dcc786f76
Merge: 4302ec587 48abf8ddb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 15:02:32 2008 +0000

    merge default into bug18557

commit 4302ec587bd3dcc42fbd99bad6ad8c45374b6163
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 15:02:07 2008 +0000

    cosmetic

commit 3aff0636faece63d64adacac69dfc2a072dbbbb8
Merge: 683e77b06 201c9d1cc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 14:45:22 2008 +0000

    merge default into bug18557

commit 48abf8ddb13bf6cfd7907dc63073b345549d568f
Merge: 201c9d1cc e637be8f3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Dec 23 14:42:38 2008 +0000

    Merged 2nd fix of 20047 into default

commit e637be8f39a19e626064880a48d9c2285e3491f0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 14:26:25 2008 +0000

    correct handling of normal termination
    this caused quite a few tests to fail

commit 683e77b06c313bec5eaa236a277951801aab77c3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 23 10:26:23 2008 +0000

    ensure fairness

commit 201c9d1ccfe9f97baed87f6eca80a0983d3c504d
Merge: b5987fc4f 22ba885e4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Dec 22 15:39:19 2008 +0000

    Merged 20046 into default

commit b5987fc4f5faf7a96e8394ff2559945cbc76977d
Merge: 3d763c6ed b21c2dafb
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Dec 22 15:28:38 2008 +0000

    Merged 20047 into default

commit 22ba885e4b68103baebb88ede8bcb0621e23420f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Dec 21 19:40:59 2008 +0000

    work around OTP-7025 in a second place

commit b21c2dafbc4e35fe5c5963ead0f7b9b1419b886e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Dec 20 23:17:03 2008 +0000

    include stack trace in errors caught by channel
    and catch throws too, which previously were not caught

commit 9e4fdee06474001eecfd58cce1ceea7e49fde9b3
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Sat Dec 20 22:41:12 2008 +0100

    Improve compatibility in the rabbit_net abstraction layer
    
    - async_recv on rabbit_ssl_socket now sees a timeout of -1 as
    infinity in the underlying ssl recv calls.
    
    - port_command on rabbit_ssl_socket now properly returns the atom
    'true' on success to maintain compatibility with erlang:port_command.
    It throws an exception on an error
    
    - Make close on rabbit_ssl_socket to close both the ssl and tcp sockets.

commit 3d763c6edd1f41de98e94c57daa3b0e24eff7348
Merge: ce6be20c7 b9e8a5ef2
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Sat Dec 20 11:21:47 2008 +1300

    merged bug20045 into default

commit b9e8a5ef2ad7e7a042424f938296e35330baf05f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 19 22:08:01 2008 +0000

    undo accidental change

commit 2456e07559553e4e6cfc7750b3a122f1e99e0769
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 19 21:54:44 2008 +0000

    fix typo that prevented correct handling of RABBITMQ_SERVER_ERL_ARGS

commit 7782a2074de06a6024373f86c505e61aebc4d08e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 19 16:53:51 2008 +0000

    saner state transition handling
    and assorted bug fixes

commit 5cd49e65fd1ab3a67810364d08bf734a9748f445
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 19 01:36:00 2008 +0000

    fix bug: make sure consumers blocked due to limit are dropped from State

commit 5495e588fd69977a74d89ec2ea8c78b88f0ee308
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 19 00:10:31 2008 +0000

    handle transactional acks
    also:
    - simplify and optimise non-basic-get ack counting
    - don't talk to the limiter when there is nothing to tell, i.e. the
      non-basic-get ack count is zero

commit 8c78a34101e83fd1f4e7997c6bb227de43dbb486
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 21:43:36 2008 +0000

    minor simplifications

commit ddb223a2fe389788682385251a6b3a73bb16f136
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 21:34:13 2008 +0000

    oops

commit e83062c4a946ab1de13cfb6459d07595eb122ed3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 21:28:57 2008 +0000

    refactoring

commit 2c24c963e71d7f0070aa368ab97efbcfb329706f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 21:11:10 2008 +0000

    tidy some more comments

commit fe254441a23a743d8acce78a64356249fdcd4db5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 21:05:20 2008 +0000

    tidy comments

commit bedbed08168937defde1c1d6e8407c71cf4ab9a2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 20:58:51 2008 +0000

    lots of tweaks and fixes
    - remove superfluous (or wrong) comments
    - notification and demonitoring always go together
    - don't change the in_use count when limit is altered
    - fix the limit_reached condition

commit 57fe74cbbb790bd75e64846fbea63b99efdeb7ca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 20:33:31 2008 +0000

    fix typo

commit f85c67869fbfef85dd4a59e47f47eca83d1e70e0
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Dec 18 18:46:05 2008 +0000

    Added handler for monitor notifications

commit 6a31edf3560ffa9e982dab7baae8df346b2130df
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Dec 18 18:29:58 2008 +0000

    Don't double monitor anything

commit 852d93688a3c0cf31c016d72cb1502b108a9dafb
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Dec 18 18:25:26 2008 +0000

    Put some monitors in

commit dba384837ef7b6312a8264aed290d8f767c05e5b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Dec 18 17:37:45 2008 +0000

    Got rid of superfluous PD read

commit c0f9c53586bf0876e135410876b813bee5476993
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Dec 18 17:26:56 2008 +0000

    Fix for multi ack bug

commit ce6be20c7cc7ee61ead6ed4610543cec028eb5b5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 14:18:53 2008 +0000

    update rabbit.app module list

commit a9d788d7694fb39332934255372f2efc40cad62b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 14:10:10 2008 +0000

    add limiter to module list

commit 9187386298c36c771573759a11546848a2e973ba
Merge: 6266723f8 7c68f3632
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 18 14:04:59 2008 +0000

    merge default into bug18557
    and add license notice on rabbit_limiter

commit 7c68f363208aa7d7b8cb44c4e4e0d378bf046d29
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 18:25:38 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 944f16a21984

commit c00f44b52027b358996192e05fa507cc4bf404b7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 18:24:11 2008 +0000

    another attempt at adding changelog entry for 1.5.0 release

commit da5c748a0b733dea4b4ab52c8a051c4cb06cdb41
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 18:22:20 2008 +0000

    remove old tags

commit 74c857ca3adae0670e5ff16e6ced7dc0a54175bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 18:20:13 2008 +0000

    Removed tag rabbitmq_v1_5_0

commit a6d30a2b0255da014e91787bef08cd5178a924bf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 17:43:03 2008 +0000

    remove old tags

commit f9a7fa5b5cdb06e022d5ea9eb3574fe57d7a960e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 17:41:17 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 36556d9796eb

commit 8e727fc3b9b7471d1d9b9e8d1f6c9c6686ec073b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 17:40:37 2008 +0000

    Removed tag rabbitmq_v1_5_0

commit 6e5281a5154227ce5a1449da7a028d95b1ec6aa6
Merge: 22b5db027 e455d1409
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 17:39:27 2008 +0000

    merge default heads

commit e455d14094748c457938fda24380686a11a6d1bb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 17:36:42 2008 +0000

    better description for user account

commit 22b5db027b1ee0e24f5b3f58cb28b608620d367e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 16:04:08 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 1c58f25cd855

commit 4f4fd268031c4fe87a1fde210e6271b414ae4d11
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 16:03:19 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 8306356ab43c

commit 6ba298cb813eecee164e158e6b4136e079bb3339
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 16:02:59 2008 +0000

    add package changelog entries for 1.5.0 release

commit 20ef92f60cbca5dbbbb0039857d22770183bc8f1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 15:55:52 2008 +0000

    remove rabbitmq_v1_5_0 tag

commit 22e7cd4db425fe40f6cb3405bb088bfb36a853b7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 15:53:00 2008 +0000

    Removed tag rabbitmq_v1_5_0

commit 3f097e067a431b74438c9038281b608af7acbb13
Merge: 660e3b024 0f888ed08
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 12:48:50 2008 +0000

    merge bug20030 into default

commit 0f888ed08afbe3edf7d71d32155954977e422941
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Dec 17 12:39:36 2008 +0000

    Don't need to run that any more

commit cd2fcb212c3a1fbc895b0baf18b65bcca3fd33a7
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Dec 17 12:13:27 2008 +0000

    For some reason ${misc:Depends} does not infer logrotate, so add it manually.

commit a5dee917338aef80019e8e7a6f98da38739a55cd
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Dec 17 11:59:56 2008 +0000

    Removed schema check in debian packaging

commit 61aa427beadeffdc7bd0316e7824f5007b6751ad
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 11:37:53 2008 +0000

    remove more remnants of schema check

commit 90ca9d7fa6b06e928a75ae63915f0c977a37e76c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 11:13:32 2008 +0000

    remove remnants of schema check in rpm packages

commit 0be540e87358af43a90c512a29f6c5cbe73d8da9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 11:04:14 2008 +0000

    remove more traces of rabbitmq-mnesia-current

commit 7b76a34f49f969ccf91b2fa8c6539a69c3f229dd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 11:00:45 2008 +0000

    remove rabbitmq-mnesia-current
    the integrity check is now done on startup

commit be73fe32cc5496a794c2f002fe487cde4cf3399b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 17 10:59:07 2008 +0000

    deal with schema integrity check failure on startup
    by moving the db to a backup location, re-creating the schema, and
    writing a warning to the logs

commit 660e3b024410030b74c499d9067ec7fcdec01e2d
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Dec 17 09:57:32 2008 +0000

    Use PYTHON variable to allow overriding of python at compile-time

commit 8c86b5cacd0786f51aee34c262919318411a0593
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 23:16:53 2008 +0100

    Forgot Copyright notice... heh!

commit 8b3579d93a0a84d9fa483cc9ce349cafd69ae4cd
Merge: 306c0ec27 0cc77d81d
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:45:45 2008 +0100

    Merge ssl_async_recv branch into bug19356

commit 0cc77d81d21200cce22e19eaeb69f8b1d08e0dbe
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:44:45 2008 +0100

    Hook in the new #rabbit_ssl_socket{} into the whole process.
    
    - ssl_connection_upgrade now creates a rabbit_ssl_socket() and passes
    that to the normal start_client/1 and hopefully everything works fine.
    
    - updated more of the network calls to use rabbit_net in
    rabbit_networking.erl too

commit ef0bb7b1163de3025b856bdb8a974de13376b3d2
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:38:03 2008 +0100

    Use rabbit_net layer in rabbit_reader.erl

commit 980d52bdbe0a1bf655e1b2b466b846e0d80b0331
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:30:38 2008 +0100

    Use rabbit_net layer in rabbit_writer.erl

commit cd5c1e58d4426d4554a711e0a1f8d31261a2a606
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:29:16 2008 +0100

    Use rabbit_net layer in rabbit_heartbeat.erl

commit 3653237636f491b3ea37e95c132d4d4dda9517e9
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:27:43 2008 +0100

    Add first draft implementation of the rabbit_net.erl module layer
    
    This layer allows us to abstract the network calls to be made on
    the different data transports... TCP and SSL sockets.
    
    The next few commits are going to update native calls to now use this
    layer

commit d3ebf493d8f0fb7e204cf3cd225ec668b1d96b9e
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Tue Dec 16 22:24:35 2008 +0100

    Define rabbit_ssl_socket record.
    
    We'll use this for carrying both the tcp socket and ssl socket
    around, so we can make all our network calls via a virtual layer
    rabbit_net.erl which is coming next

commit 813a398d45c80bb635151719868fa9b08511a450
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 16 18:59:31 2008 +0000

    remove superfluous settings

commit 9c4933c832f80f31c90866a1cc05cc46dff4dc2b
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 16 14:45:39 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 7ed89ebb3e98

commit 87a86f7d932ff8953cfcc17bd22634602be4c03d
Merge: 6ab372e07 a4684ace7
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Dec 16 14:27:24 2008 +0000

    Merged bug 20019

commit a4684ace71798cf4eea76a0c84e6a48c911b7857
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 16 13:35:14 2008 +0000

    don't react to memory alarms when memory_alarms is false
    We still register our alarm handler in that case, since that allows
    alertees to register as usual, but the handler doesn't remember alertees
    and does nothing on memory alarms.

commit 6ab372e079748db5114be1a3b1dc5faf5fce9188
Merge: 2ba3bd9b2 ff9ebc5e3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Dec 16 13:07:53 2008 +0000

    Merge bug20002 into default

commit b69fe3fb62b9cb8950fa291e5023bc457c45d7c9
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 16 11:09:29 2008 +0000

    Make start_memsup default to false.

commit 306c0ec272bef14b454e8727adc47282cd571d5f
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Dec 15 22:37:26 2008 +0100

    Update ignore to include VIM .swp files and generic .patch files

commit 24ab8ef8cd5423d3e45d4bef111b0a8cc2ba5891
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Dec 15 22:36:35 2008 +0100

    Implement start_ssl_listener, to complete ssl acceptor implementation
    
    - Implement ssl_connection_upgrade/2 callback, to use in upgrading
    a new tcp_connection to an ssl_connection.
    - ssl_connection_upgrade then calls out to start_ssl_client to
    setup start the ampq session. Right now, this is just a dummy
    session, but when the async_recv patches are done, it will become
    a full valid session.
    - Abstract TCP options into a macro to help reuse.
    - Currently, I'm hardcoding location for cacerts, certfile and private
    key file. Before this is finalized, config parameters will be agreed,
    and used to supply this information.

commit 78de8391b44471016be58b53de13fbb85332c8fd
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Dec 15 22:15:24 2008 +0100

    Add SSL Listeners startup section to rabbit.erl startup steps.
    
    Add crypto and ssl to the list of required applications to be
    started up.
    
    The SSL Listeners section refers to the incoming start_ssl_listner
    function in rabbit_networking.erl, the next patch contains that

commit 369ab5d60df13ca7603dd54587c44c31856fc4df
Author: Essien Ita Essien <essiene@gmail.com>
Date:   Mon Dec 15 22:10:45 2008 +0100

    Add ssl_listeners support to the startup script

commit 2ba3bd9b246f5cc8cc7b4c72f036279b0e944f9a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 15 17:08:31 2008 +0000

    Added tag rabbitmq_v1_5_0 for changeset 8c3ad21da715

commit c0ce724167b5e145116379fc146ad97b9c0a1056
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 15 17:07:57 2008 +0000

    New changelog entry for RPMs

commit 2c147b6668df8a4b061f57a4fb1e5f4dd9bf9294
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 15 17:06:37 2008 +0000

    New Debian changelog entry

commit ff9ebc5e3ec1189bb066849ff1cb073ecbfe83ab
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Dec 15 15:48:05 2008 +0000

    Produce the list of rpm files on the fly

commit 4becc589bd4e998ae87e976cf04f4b916a78e27a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 16:49:34 2008 +0000

    logrotate doesn't need executable permissions,
    explictly name the man pages to keep rpmlint happy.

commit 97bc30f9b9fcb93649f7012d2d560b340ed0dd2b
Merge: d6343c3aa f47f3e1cb
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Dec 12 15:23:54 2008 +0000

    Merged bug19987

commit d6343c3aa3be5be13d64258e46193503af80b5f5
Merge: 5525bb407 cef2f693d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 12 15:05:42 2008 +0000

    merge bug19999 into default

commit cef2f693d3574184f04e79fd5e7c638d6e14386d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 15:00:47 2008 +0000

    More strict matching

commit 130eee9be8b8fc5703d8c4dd3ea348557ea5a86f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 14:43:34 2008 +0000

    Use default regex type in find

commit 228c106e438f91b668830a7882a704a8fdb1349b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 14:24:43 2008 +0000

    distclean should remove all vim, emacs temporary files

commit 5525bb4079d69aaa5d028de1eb185e512023db16
Merge: 699faac7a 5bad8f751
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 13:46:09 2008 +0000

    Merge bug19568 into default

commit 5bad8f751a1597a9c9fe6d31a390186b8ec6e622
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 13:31:47 2008 +0000

    Removed unused README.txt, if someone knows how to build
    rpms then that is (should) be already known.

commit 699faac7a8d56eb3d7b45688afedc92651a245ef
Merge: 6bcbdd7a0 89b169950
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 12 13:24:58 2008 +0000

    merge bug19993 into default

commit 6bcbdd7a0005e2f47f59b50dd5dfa92f9cc4af9b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 12 13:13:01 2008 +0000

    separate out codegen targets
    that way 'make -j' won't end up buidling the same targets twice

commit 89b1699502396168e7d9aa414e09fdd287f24ad5
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 13:11:06 2008 +0000

    Update 'po' each time we build the package.

commit 1cf53a71b7619485f736de0a1678c5a2b2c6856f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 13:05:12 2008 +0000

    Removed autogenerated file

commit 5e22be442f927ac2261618b35edbf3789d2328bd
Merge: c54c33e5f c6e4e5887
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 12 13:01:27 2008 +0000

    merge bug19994 into default

commit c54c33e5f83b4af58f295950b4e81bc9591ee340
Merge: 0c7695eeb a968a18e3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 12 12:37:41 2008 +0000

    merge bug19992 into default

commit c6e4e58870ab52f4a45c67e2cd161d5bdc0bc338
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 11:39:46 2008 +0000

    Reverted last change, debhelper using distclean target for cleaning.

commit a21af6212091e1dd683c4023456ce18f85f37646
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 10:56:01 2008 +0000

    make clean should also remove compiled amqp_codegen

commit dc766da4b8d9a0f5c7e9e0d4f2dc120ff64928a9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 10:32:14 2008 +0000

    Debconf will handle the installation of logrotate script
    using dh_installlogrotate and it will add any dependencies
    it thinks need to be added. Updated standards-version to
    keep lintian happy.

commit a968a18e3ffc2fce1c16e603cef97c4b98f6fa2d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 03:41:41 2008 +0000

    Added missing =back directive

commit e20c21acb5b5bb5e50f2114f1b0f8f07261d6b36
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 12 03:21:10 2008 +0000

    Added po-debconf support to satisfy translated debconf
    requirement. See man po-debconf for details.
    Fixed minor warnings given by lintian.

commit 0c7695eebbd98dafc0ebd2cce7dea81bd7e75abb
Merge: c79d94442 6c049e2fb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 11 19:20:33 2008 +0000

    merge bug19989 into default

commit 6c049e2fb1fd4b028ccc819c3b95d16430bef44b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 11 19:14:45 2008 +0000

    cosmetic

commit a26d54b299fbe6ab77a26ed39e47f7d252e16c04
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 11 18:29:10 2008 +0000

    Typo

commit 8e36644cd92b31abc28d54d7b50e5be669af9ebe
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 11 17:41:41 2008 +0000

    Fixed warnings reported by lintian.
    According to rule '6.5.4.2.3. Select/Multiselect'
    from Debian guide, descriptions shouldn't be questions.

commit dc37ae41ba0de762a59b9d2c2b4cef6f74086274
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 11 17:23:09 2008 +0000

    Moved configuration script from postinsall to separate
    debian config file. This seems to work *only* when we
    first load debconf/confmodule in postinst.

commit f47f3e1cbdc4f7f2e5a04b847ebf4fb8a47914a4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 11 11:59:37 2008 +0000

    provide an easy way to turn off memory alarms
    the rabbit start_memsup flag controls whether rabbit will start
    memsup. It defaults to true.

commit c79d94442ce7bbdaeb07ff1da0ff86de9a233506
Merge: de210f358 5d4d96ad0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 11 11:07:57 2008 +0000

    Merge bug19961 into default

commit de210f3580f8a895f2e9c466bcf7fbb96a00223c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 19:51:52 2008 +0000

    don't start memsup via command line flags
    we start it programmatically instead
    Somehow I missed this mistake in the qa of bug 19852

commit bc65b79a190fb96f38fda17d8dbf02c72b82a377
Merge: 2b4ed321d e2be7e651
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 19:03:19 2008 +0000

    merge bug19684 into default

commit e2be7e6518c31102141a31405411cb7c2a34974f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 19:00:04 2008 +0000

    Correct typos

commit ece581ed4971e18bd17baa6d3babfa8049daaf35
Merge: e4632be4c 2b4ed321d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 18:26:29 2008 +0000

    merge default into bug19684

commit 2b4ed321de3800572df3ecd6ac9a808e61539468
Merge: aa0f1d273 9a4aa2caf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 18:05:51 2008 +0000

    merge bug19914 into default

commit 9a4aa2cafaf172dcce8d1f01419d2101e903027b
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 16:15:03 2008 +0000

    Add an example to the /etc/default/rabbitmq manpage

commit a780bb8f1e8683258bf4c973caf73477dcc06964
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 16:12:41 2008 +0000

    Set the page name and section correctly

commit 5933e7bf81ad135ca41138c3406abb35e6848ad7
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 16:04:50 2008 +0000

    Ignore generated diff file in debian packaging directory

commit 9b704921e508eacf32f69965090098c730cbdd9a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 15:40:53 2008 +0000

    Catch all the manpages, including any future ones.

commit 3a939316b4ac447e67f7028b35b9ccef13d82539
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 10 15:40:10 2008 +0000

    Correct stupid mistake in installation target of Makefile.

commit e4632be4c4df4df30359dfdd97d7cf33249cd473
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 12:53:55 2008 +0000

    cosmetic

commit 3df3d40ea51f65870e3ce9bdbc7c7c8f5a83e789
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 12:35:10 2008 +0000

    lots of tests

commit 09fc9efccbca431976a24df328bf30ab85574dd9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 11:39:11 2008 +0000

    handle case when connection is not fully initialised yet

commit 0f4dcb03ee07334353c306d5b00f906134a677f5
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 11:29:00 2008 +0000

    prettier output in tests

commit 33084006b856d3b6144b8f2ffc5f3e4d7e6e5d8a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 11:27:32 2008 +0000

    cosmetic

commit e1f6b04b19a5ea4ee5fe045fe906e2c0a41a488e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 11:22:14 2008 +0000

    correct error handling

commit 8eaea483b202092b88cdfc44d3d91b876cff02cb
Merge: bebc6203c aa0f1d273
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 10 10:53:17 2008 +0000

    merge default into bug19684

commit aa0f1d27376674c0383138bccdd73b9ff1dfae22
Merge: db47c2b29 d890b2e56
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 18:25:28 2008 +0000

    merged bug18381 into default

commit d890b2e56d75761d80f6e83e705f22c122a6295d
Merge: c9e6ec25f db47c2b29
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 17:52:10 2008 +0000

    merged default into bug18381

commit db47c2b2979ba25a59c28045ee5abeff2f88648c
Merge: 57dd1544c 6184b7bfc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 9 16:44:34 2008 +0000

    merge bug19974 into default

commit 57dd1544c2a72717f742a0dcada8faa156907795
Merge: 2d1a01c18 824408e93
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 9 16:25:06 2008 +0000

    merge bug19975 into default

commit 824408e9359c76bfc9a595994be5096ece92d0b9
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 16:17:47 2008 +0000

    Update pods to remove copyright section and correct email address

commit 6184b7bfcbcdf2f6c74d3c12e5177863b3873d2d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 15:57:36 2008 +0000

    Update copyrights.

commit 92a010620064decf745107010b2869d8a711942f
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 12:18:09 2008 +0000

    Update rabbitmq-server.bat to use RABBITMQ_CLUSTER_CONFIG_FILE

commit cf75eab345a74cd9f9402d58e403b166b5259af1
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 12:16:02 2008 +0000

    Make RABBITMQ_MNESIA_BASE, RABBITMQ_LOG_BASE, RABBITMQ_MNESIA_DIR settable in batch files.

commit 12e34768579d1c789108207e0357042b4e9f22d1
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 12:06:48 2008 +0000

    Fix more names in the batch files

commit 41f1bb358e05ab267e5face48d796eb89c5026df
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 12:03:50 2008 +0000

    Fix a couple of Makefile variable references (important to make cleandb non-dangerous!)

commit e185a3dea814adbeb8a7d2b33b547790c232bcd2
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 11:59:30 2008 +0000

    I guess I was confused about which convention to use. Remove RABBITMQ_ prefix from defaults entries in macports.

commit 41d1dd488dd15ed4f3e88ee0d0b0c1cc8d73fed0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 11:41:52 2008 +0000

    Update Makefile for new environment variables.

commit c3271ee044b876ba792941e9e8293524ccec3b34
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 11:40:54 2008 +0000

    Correct a problem I introduced: make RABBITMQ_START_RABBIT depend on RABBITMQ_NODE_ONLY.

commit c7805bc316a0b6cd13469b9748923b4664b8141d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 9 11:40:05 2008 +0000

    Only source /etc/default/rabbitmq if it exists!

commit bebc6203ce2e31164e631d0df43251dec2ee9575
Author: Emile Joubert <emile@lshift.net>
Date:   Mon Dec 8 23:27:05 2008 +0000

    rabbitmqctl tests

commit d7386e8fc36b35d4d669c77d35e794c17ce643da
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 8 20:20:44 2008 +0000

    Add RABBITMQ_ prefix, and source /etc/default/rabbitmq. Update erlang code
    for the new environment variable names.

commit 28ba817a096361e112df9b8f653db1bba1ae0750
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 8 20:00:30 2008 +0000

    New manpage for /etc/default/rabbitmq.

commit 432189d9f79a3b2e4a30aea118ee51f0c859d003
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 8 19:44:27 2008 +0000

    Tweak to the way the makefile generates the manpages, in preparation
    for some documentation for /etc/default/rabbitmq.

commit bd040e16342c4d2b1983261188b28204d9123e33
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Dec 8 19:41:43 2008 +0000

    Remove suspect whitespace.

commit 2d1a01c18e35ec72b8a0763dfefe526d97ec7233
Merge: 97cd4bba3 6d64eb962
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 8 11:20:35 2008 +0000

    Merged bug 19962

commit 7a980de82451b0ee3d64973e510d5dcba3c0391f
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Dec 7 23:54:39 2008 +0000

    rabbitmqctl pod updates, R11B-5 safe string handling

commit 6266723f81a44b5dcd29679c0815623a4a80b276
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Dec 7 02:01:59 2008 +0000

    Shutting dialyzer up

commit da04837ed0fd68aa54a92d0e1e8e38905cb468db
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Dec 7 01:40:09 2008 +0000

    Added catch for pre-fetch size

commit 9be5280cefca99ceebcedc6bc071efd96911b292
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Dec 7 01:34:42 2008 +0000

    Added match for setting the global flag

commit 5477c63fa7ef208bab3589b5786c2868580bbf30
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Dec 7 01:26:36 2008 +0000

    Dead queue informs limiter

commit e7359063fafa53781c1c7e2ecebeabb26bc42b22
Merge: dcce15f3d 97cd4bba3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Dec 7 01:19:46 2008 +0000

    Merged default into 18557

commit 5d4d96ad08b2d81e9438eb1ebbdcf31002be064e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 18:32:48 2008 +0000

    x86_64 rpm scripts now refer to /usr/lib64 scripts
    instead of /usr/lib.
    Added hack to the makefile, to fix the macros for x86_64
    architecture under debian.

commit 97cd4bba3f557181bd11681db15a72a9d2375c10
Merge: fd1e21752 419e013d2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 18:10:04 2008 +0000

    Merge bug19929 into default

commit fd1e217527a945c036aa37aaf2d64a635d4aeae3
Merge: 3eac32c73 997584cf3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 17:23:54 2008 +0000

    Merge bug19888 into default

commit 419e013d278ae4a32889f80216fff78b139c8286
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 17:21:44 2008 +0000

    More intuitive name for the script

commit 6d64eb962e55eecf47fe387570a5c5733cf4f570
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 17:14:20 2008 +0000

    Use more reliable 'id -u' to correctly identify
    the user for the debian wrapper.

commit 997584cf3ccbfc588f78f6c3c36b224f3324689b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 17:10:31 2008 +0000

    Use 'id -u' instead of not always working UID variable
    to correctly identify the user

commit bea3835fa5f30a6cb7918280c4325771434a2f79
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 16:40:55 2008 +0000

    Typo

commit 5dc3199f377380b7b429ba99bfe4b56f4c70f940
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 16:27:52 2008 +0000

    Move the old mnesia dir to temporary unique place
    when schemas do not match.

commit 3eac32c73780c5550c12d68ae30e2dcd0a0d7c50
Merge: b5c5bd099 92a5c77d8
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 14:47:24 2008 +0000

    Merge bug19889 into default

commit 5230e50fa6f498eda84cc831456bef7d936a1a78
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Dec 5 11:45:06 2008 +0000

    Display warning when rabbitmqctl is not run as superuser

commit b5c5bd099ee7c19391e0e935c13e911a6bbb88a3
Merge: b86b36403 dafac6b5b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 5 09:32:11 2008 +0000

    merge bug19900 into default

commit dafac6b5b795d388b67cca7743e2d0d3a7d698ea
Merge: b81de62c0 b86b36403
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Dec 5 09:31:03 2008 +0000

    merge default into bug19900

commit 09aa3aefbe0a6c3386b752499731abe1fafe3238
Author: Emile Joubert <emile@lshift.net>
Date:   Thu Dec 4 23:04:47 2008 +0000

    Add vhost parameter

commit 22e526ff33edff3004dd0335b486e5719853b900
Merge: e11dc6cb9 c9e6ec25f
Author: Emile Joubert <emile@lshift.net>
Date:   Thu Dec 4 22:16:17 2008 +0000

    Merge bug18381 into bug19684

commit 92a5c77d83d553604bfae1f35a43aba6e7445063
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 4 19:31:21 2008 +0000

    Moved scripts to /usr/lib/rabbitmq/bin and few minor
    style fixes for the spec.

commit b86b36403118cb3ade913af785b2533e3e762984
Merge: 0bcc68595 6fb949efb
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 4 18:16:43 2008 +0000

    Merge bug19859 into default

commit 0bcc6859599c6e993de9613db466fd9c63038139
Merge: 6a9ecbc5f 500134c6e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Dec 4 18:01:13 2008 +0000

    merge bug19950 into default

commit 500134c6e25469d656e677a3a4c09f03ab2d02d4
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 4 17:54:18 2008 +0000

    Moving bgu19950 to bug19950, wrong name.

commit a1b33efefb42571edfba5e61e65fbe6aace5591b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 4 17:47:44 2008 +0000

    mnesia schema check script needs to identify correctly
    the nodename

commit b81de62c0f32ee685ce662a29fa53e8421eff494
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Dec 4 12:22:39 2008 +0000

    Added test for log rotation when it cannnot
    create parent dirs, more informative exceptions.

commit e11dc6cb9f01da2210c7ec0a8b2fc42716ef7253
Author: Emile Joubert <emile@lshift.net>
Date:   Wed Dec 3 23:46:54 2008 +0000

    rabbitmqctl output formatting
    %-encode queue names and exchange names
    separate columns with tab instead space characters
    anticipate vhost parameter

commit feae4b55173634015c2b82cde5f83b1a36823d99
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 3 17:19:58 2008 +0000

    Backed out changeset 6ad1a9e059d0
    committed on wrong branch

commit c9e6ec25f539ac69051adb8292d64b92d3110d72
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 3 17:18:12 2008 +0000

    qualify various list/info functions with vhost

commit 25bc6e6126ef75680829508110393e080fd24461
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Dec 3 17:09:28 2008 +0000

    qualify various list/info functions with vhost

commit 6a9ecbc5fa264cd600d94771f209bdc477e159f0
Merge: 03fe8e39e 22b241d43
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 3 14:14:37 2008 +0000

    merge bug19754 into default

commit 03fe8e39e9dc2f960820bfa349c3653f312e0487
Merge: f3f83f0a6 02eb85f50
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Dec 3 13:43:32 2008 +0000

    merged bug19758 into default

commit 9a8e171d8ee6cbe495498203c1b24a5a348f5344
Merge: c58a08a9e f3f83f0a6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 2 18:02:13 2008 +0000

    merge default into bug19684

commit f3f83f0a6c1430e8add101466179d3a2905eaece
Merge: 60b0f6703 c2ed22d2c
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Dec 2 16:43:56 2008 +0000

    merged bug19841 into default

commit 60b0f6703e409f7629ea48017dade4d1c2d9672a
Merge: 4029615d2 99f686ef9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 2 11:40:23 2008 +0000

    merge bug19871 into default

commit 99f686ef9115605c9bc9c5f19db9f61a8590d880
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 2 11:38:16 2008 +0000

    fix typo

commit 8fc58adcf7327c4984f1f4b65f668270be842379
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Dec 2 11:36:41 2008 +0000

    don't mention mnesia

commit c58a08a9e0c272cadff9a15796512f5ef9205ff4
Merge: 52e050de6 4029615d2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Dec 1 23:43:04 2008 +0000

    merge default into bug19684
    and adapt the new rabbit_control functions to use Inform

commit 4029615d25b0b6160eab6a61cd09d2e8e6c98e89
Merge: 3385d74c2 30c9d45c4
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Dec 1 23:12:44 2008 +0000

    Merge bug19910 into default

commit 30c9d45c4461c9d7f00ac2634f879d5e52dc8137
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Dec 1 22:48:03 2008 +0000

    add type spec

commit 75aa3219da71e3d72fa0dae55aea4c79abccc74a
Merge: 4ddcc6427 3385d74c2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Dec 1 22:11:04 2008 +0000

    Merge default into bug19910

commit 3385d74c2c1cbbca9e206013fead8528906fa35f
Merge: 1be524ca0 76d7202e7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Dec 1 22:03:53 2008 +0000

    Merge bug19912 into default

commit 76d7202e7a085db30987b9903c0cee15b0d7e7c7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Dec 1 22:03:05 2008 +0000

    Cosmetic

commit 5bf65aa0b9d25f80cb86fe63808aaf1a0a10e1fe
Merge: 4b5455816 1be524ca0
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 1 17:02:55 2008 +0000

    Merged default

commit 4b54558163f5ebe3c3a8df3602d96d869a2da0da
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 1 17:02:37 2008 +0000

    Run schema check as part of tests to help coverage check.

commit e955a27cf0cc58ad3e133f84971e45efe7f9fd43
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 1 15:55:28 2008 +0000

    Invert the case of all this - check that the schema is current rather
    than an update is needed.

commit dc21e5ea5ee0ad7f17388ae0b978e5ba62ad5648
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 1 10:42:25 2008 +0000

    Update the message shown on upgrade.

commit ee7cf85cd21102e0b6a33fe6b09ff58d29a3a582
Author: Simon MacMullen <simon@lshift.net>
Date:   Mon Dec 1 10:40:55 2008 +0000

    Change mnesia check target name

commit 4ddcc642783c8a9f30bc517af658a67b98472514
Merge: 11b16d483 19578c6db
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 13:50:29 2008 +0000

    merge bug19912 into bug19910

commit 19578c6db396218edcb3001c8927be7de6939858
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 13:49:45 2008 +0000

    get rid of compiler warning

commit 11b16d483f382ffbb84cebb00262aee21471ebd2
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 13:47:42 2008 +0000

    write script errors to stderr

commit 5a88aafcf093f34bb65b734182c47eea340d4528
Merge: 1be524ca0 37c731c3e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 13:40:05 2008 +0000

    merge bug19912 into bug19910

commit 37c731c3e620a41a2da8ff4bcc2f57cf6cf9a3b1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 12:22:26 2008 +0000

    remove 'error' tags in exceptions
    since we don't use that tag elsewhere

commit c6e5e53ff82638ea3b840beff1b8ac1050275c20
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 12:14:33 2008 +0000

    consistent display of errors in rabbit_multi
    There is some duplication of code in rabbit_control here, but imho
    it's too little to justify refactoring

commit 38b8409c19a5e28c02b4988f1d201637e9915196
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 11:49:10 2008 +0000

    simplify informational display
    and ensuring consistency
    also slight tweak to completion message

commit be20e10699c6254b0cd1be48754419e50bf24af4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Nov 30 11:35:14 2008 +0000

    improve error output
    - consistently display errors as "Error: ..."
    - display command and args properly formatted when encountering an
      invalid command

commit 1be524ca099a8a2890321a42e5da2284995078bc
Merge: 9fbcbe490 73903466a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 28 21:51:16 2008 +0000

    merge bug19852 into default

commit 73903466a36cd21ba8a4d19515fe5dee09efd10f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 28 21:44:38 2008 +0000

    some more tidying up

commit d2241cb8fac67bcafc19072079b85466d072d620
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 28 21:33:38 2008 +0000

    cosmetic changes and a tiny bit of refactoring

commit 9fbcbe4909fbce24c9375a16faa81712c18fdb29
Merge: 3a586bbdf 318293d31
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 28 21:09:34 2008 +0000

    merge bug19899 into default

commit efdfb43525365eefe5f65df20841c1d3e5984d1e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 28 20:33:51 2008 +0000

    rename ensure_directory_exists to ensure_parent_dirs_exist
    since that is a better descript of what actually happens.
    Similarly, change the exception tag

commit 3a586bbdf0a79aa5402dd861236c6131e38732a4
Merge: ad82764bd 5eecbe8ac
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 28 15:15:47 2008 +0000

    Merge bug19860 into default

commit ad82764bd61c348731d9e99629ab12d1e0882693
Merge: 15b7fc9d5 1b1a4291a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 28 13:38:29 2008 +0000

    Merge bug19331 into default

commit 9e0a191ca6bc81b4b9a046d55dab06d26cb7c145
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 28 13:01:04 2008 +0000

    Simplify mode calculation

commit b1dab3afd0b26c35dbdea409719a88b116b245c5
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 28 12:57:03 2008 +0000

    Logging handlers attempt to create the directory
    to the log file if it doesn't exist yet.
    Added new test to include the case when no write
    permissions are set for the directory.

commit a4c764da90e0bceaf73300bab594146482a85bfa
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Nov 28 11:00:04 2008 +0000

    Remove use of list append, making it O(n) rather than O(n^2).
    
    Of course in this case n = 1.

commit 5eecbe8ac98596f43cea00fcc1f0dcb0d5e3fbea
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Nov 28 10:46:38 2008 +0000

    Consistency around trailing slashes.

commit a33d7f9fb3b91c5822de9aa9f592848ebc0427e5
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Nov 28 10:45:40 2008 +0000

    According to Hubert it *does* make sense to ship these man pages.

commit 1b1a4291ae483f8dd64707932247ce715ae4e88a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 23:30:38 2008 +0000

    Various cosmetic changes to the rabbitmq service

commit 318293d3176e537304f091ba1e683d19e0c348dd
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 22:48:33 2008 +0000

    Cosmetic

commit 15b7fc9d54934863baba663b5aacbf84660c3c0b
Merge: fb71f50fc aa77e79ba
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 22:42:09 2008 +0000

    Merge bug19713 into default

commit 6fc919cd12a4a764801069abbc668284f5d4663f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 22:29:10 2008 +0000

    Added missing function message/4 which was
    previously removed

commit fb71f50fce0637d662597595fe1524fd7f61ec03
Merge: 60d55dbec 3b489dce1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 18:24:20 2008 +0000

    Merge bug19792 into default

commit b634e8dc8853094cd2f5ab1e351084aaea56c9a5
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 18:16:48 2008 +0000

    Add some debconf questions so that an upgrade stands a chance of not
    breaking. Note that although the documentation suggests this should go
    in a separate "config" file if we do that then it tries to bring up the
    server first THEN configure the package...

commit b88d3800b3feed256b721c6864019f0a0d4d4009
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 17:47:30 2008 +0000

    Install the script. Note that shell uses "0" for true and "1" for
    false.

commit abd1a2f05e2bc7c2aa6cacc4355dfd054e93965a
Merge: e5a65accb 15eb5789b
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 16:53:18 2008 +0000

    Merge bug19860

commit e5a65accb4c54c6a2671dae7eeb15a00c3a988d5
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 16:35:44 2008 +0000

    It's nicer if update_needed is just a function, not something that
    halts!

commit bd00b2c6aa5839d739c8ee3871c8bd3f3d1d4137
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 16:26:29 2008 +0000

    Create rabbitmq-mnesia-update-needed script

commit 60d55dbeccc7c035ca6d168b6c7f1049996fd6b4
Merge: 9c12041d5 3d6600f4a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 16:03:03 2008 +0000

    Merge bug19743 into default

commit 926a90b233a5804677f88472b7490fdbd6ab413d
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 15:06:05 2008 +0000

    Add specs.

commit 4ff33915112d77f5356f7ed82002f4a85e599216
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 15:05:54 2008 +0000

    Ahem, we need to return a result...

commit 3d6600f4a3362de8d915197eb385870e523ccf36
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 14:29:38 2008 +0000

    Moved license files and documentation to appropriate directory

commit fdab4fc061cda060fd23760e00cab439ad503568
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 14:24:14 2008 +0000

    Close the file after reading it.

commit 133fd99caf7450a5bab5c8b36dcacf28adc408dd
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 14:09:59 2008 +0000

    Support get / set_check_interval and simplify starting.

commit 9c12041d5cc3f3c63b36f72f630e7333e51f3f5a
Merge: ce149ff9a 50635ca6e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 27 10:56:12 2008 +0000

    Merge bug19801 into default

commit 11d1d832c8acd53f50a9ff5193d9b5881496450a
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 10:44:43 2008 +0000

    Rename rabbit_linux_memory to rabbit_memsup_linux

commit 15eb5789b48e5708e82032c98185f4747fb0e885
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Nov 27 10:40:22 2008 +0000

    Change SBIN_DIR rather than move the scripts

commit e967f875703c51e2b267a6f79d497567583fadac
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 26 22:56:39 2008 +0000

    minor simplification

commit 8007e34406f766270158e5697115c1220db13a0b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 26 22:55:56 2008 +0000

    (mostly) re-indenting
    also some tweaks:
    - make update message tag match the function name
    - simplify line parsing

commit 6873cc7a18705621ee46e77fb0ab5bb0317db99a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 26 22:52:54 2008 +0000

    fix our memsup registration
    The name must match that of the standard memsup, otherwise the os_mon
    functions won't find it, and neither will our existence check in
    rabbit_alarm.

commit 7a5645b006d3dac01eb21b94a9eb8275777cdcc6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 26 22:49:27 2008 +0000

    re-indentation + minor refactoring
    extract & share memsup startup code

commit e0b1254678da42f547deaa45bc70fdb2416b396a
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 17:28:08 2008 +0000

    Rearrange the startup so we only start rabbit_linux_memory if there is no memsup registered already, export some similar API to memsup so that we can configure stuff at runtime.

commit d3a787deadd0c1c1cb5fec74757dac939d3ce494
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 16:39:05 2008 +0000

    Matthias has pointed out the existence of whereis/1.

commit 86f383ff74b57023214317060f494779d04270c1
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 16:08:00 2008 +0000

    Only start memsup if it is not already running.

commit f958d65fce76fc4cca030b9fa93f4a2810ac4db3
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 15:24:56 2008 +0000

    Use timer:apply_interval/4 rather than timeout chaining.

commit c55b1378c9f892fb27c0e2e3476f36c084c67ab0
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 14:02:34 2008 +0000

    Another stylistic change

commit b8911dda1825fb91f536ca73522aa2fdebc9cae6
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 13:03:29 2008 +0000

    Remove the 1M buffer.

commit 5b8ce05ddaac8984c8df1733dd72b7033b7d022a
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 12:55:09 2008 +0000

    QA points 5, 6, 7, 9, 10 (the smaller stylistic ones).

commit df3fb67746c08bb659501beb699fcf54873bf7f7
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 12:53:56 2008 +0000

    Actually having a comment here breaks things

commit f6f662bd7ac3024943405f789bb960e7ac7f01ad
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 12:33:48 2008 +0000

    Fix batch file

commit 29621dbbb1f87786a5cfa790c75b8432176daf0f
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 11:50:55 2008 +0000

    Remove man pages for anything other than rabbitmqctl.

commit 6fb949efbfedf9199d6e6bde8607529ac5cae931
Author: Simon MacMullen <simon@lshift.net>
Date:   Wed Nov 26 11:33:39 2008 +0000

    If the user is not root, just invoke rabbitmqctl without any args. They
    should always get the help message, and always get the "run as root"
    message.

commit ce149ff9a892d160cc666426ba769b718c3a9f16
Merge: 86c9f9247 9d415eb07
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 26 10:19:35 2008 +0000

    merge bug19826 into default

commit 9d415eb074ea6773ac6f8b20190d741f1d452dab
Author: Emile Joubert <emile@lshift.net>
Date:   Wed Nov 26 09:59:50 2008 +0000

    Fix rabbitmqctl output formatting

commit da544ab66fe45080942d41504630308641ebd633
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 17:08:11 2008 +0000

    Only su to rabbitmq if the user is actually root (otherwise they will be prompted for a password which is incomprehensible). If they are not root, allow them to see help but otherwise fail (since if they run the real rabbitmqctl as a normal user it will talk to the wrong rabbit and again confusion will ensue.

commit 67ccedff5439aa9805fe6d779283218d0c40877b
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 16:38:06 2008 +0000

    Merge default (effectively undoing bug19790...)

commit 3701bc0c4a5c2a5fb30e709da89c39ac97ede2a6
Merge: b29f01db6 86c9f9247
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 16:36:08 2008 +0000

    Make comments a bit clearer

commit 80be88ed32a57ee5ae2cb783ac8ac562b35060c6
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 16:28:00 2008 +0000

    Move the generioc unix scripts into /usr/lib/rabbitmq/bin to discourage
    people from using them (since they're not very comprehensible to the
    layman in the Debian packaging)

commit 9acab08da3731cb11ba1cc0574d65c2715eaaa61
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 16:26:44 2008 +0000

    Fix a bashism that causes FAIL on Ubuntu.

commit 86c9f9247b03cb680b3cb3859efd4dff05fdcb0a
Merge: 925727425 85eb53ca7
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Nov 25 16:20:44 2008 +0000

    merge bug19790 into default

commit b29f01db686f64f0e17b808c658a42312b92fb29
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 15:33:18 2008 +0000

    Start memsup programmatically rather than starting as standard and then
    killing it if we don't want it => doesn't mess up the banner on startup

commit 4221321beb122aa1e89bb49ad2ea65b02d666a00
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 13:39:52 2008 +0000

    Remove the MEMORY_CHECK_FRACTION define.

commit 06c9858ef175b328a033f61967f33f277d3924d3
Author: Simon MacMullen <simon@lshift.net>
Date:   Tue Nov 25 13:28:03 2008 +0000

    First pass at a simple memory supervisor for Linux.

commit 99bda129604c5662c2c3b968e1caf6fe6d5f743c
Author: Emile Joubert <emile@lshift.net>
Date:   Tue Nov 25 10:45:37 2008 +0000

    Update tests, now using rabbit_control:action/4

commit 22b241d435d0a5967d48068121e98adc489b39e8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Nov 24 22:48:48 2008 +0000

    remove cruft from rabbitmqctl

commit aa77e79ba01f16743f928bb82962859c6f050af3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Nov 24 21:26:56 2008 +0000

    work around missing sasl_report_file_h:code_change/3

commit 5e8faf4ac118f25327022a389591a96ea4ad32e2
Author: Emile Joubert <emile@lshift.net>
Date:   Mon Nov 24 20:40:25 2008 +0000

    Tidy usage docs and parameter parsing

commit 52e050de64fd366f3a306169a70d92288a15a065
Merge: 1699d89ae 7c50f0f93
Author: Emile Joubert <emile@lshift.net>
Date:   Mon Nov 24 20:28:22 2008 +0000

    Merge bug18381 into bug19684, tidying

commit 7c50f0f937f93ad763f2621786d5dffdf9d36dff
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Nov 24 11:02:31 2008 +0000

    add some socket stats to info

commit 925727425d73730150978cf63017f7d2c315ea71
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Nov 24 10:30:58 2008 +0000

    use inet:getstat instead of prim_inet:getstat
    The former is slightly more public, though still undocumented

commit dcce15f3debfa3d2cf71f1e113b7c82fbf5ac624
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Nov 24 01:14:38 2008 +0000

    Differentiate between acks for basic.get and basic.consume

commit 3f3c7c842875a3865e2b6344590764558b57babb
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Nov 24 00:52:28 2008 +0000

    Now the channel sends the ack directly to the limiter instead of via the queue

commit 1699d89aeb2bd0134ee18f671e69fbf3eef0380b
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 23 23:59:25 2008 +0000

    List bindings and connections

commit fa96b400c2160a4fdb4f3213e35de79e753d9231
Merge: 2c6fd2c8c caede44da
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 23 20:41:50 2008 +0000

    Merged bug18381 into bug19684

commit 2c6fd2c8c5fdc105f4dfb257be10ab06416910da
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 23 20:23:06 2008 +0000

    Guarantee order of rabbitctl result columns
    Added default arguments for list_queues and list_exchanges

commit 38dd4d3538b9a22f043de6cfbeff64983d79c686
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 23 18:33:30 2008 +0000

    Add rabbitmqctl "quiet" mode

commit 399d191cce3e43c01a1e863f2421dcd461dfcf0e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Nov 21 18:14:12 2008 +0000

    Minor fixes

commit b246f4d6180301064fa34041b55f21eabcdcb8de
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Nov 21 17:40:25 2008 +0000

    Changed prefetch from call to cast

commit abbadaa58c9a9025a7881d482017bfb429c79d92
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Nov 21 17:34:01 2008 +0000

    Got rid o the per-queue in-use capacity

commit eaac22a45dc5fa2c64ed54c80e3fc6e5eaade901
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Nov 21 16:44:00 2008 +0000

    Made set_prefetch_count into a proper gen_server call

commit 6c6d8477623f543cb461a045f008a9fcbc320629
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Nov 21 14:08:11 2008 +0000

    Fixed bug in limiter

commit 3b489dce14ab65e0704e19bed3510fad40c2fedd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 21 09:53:52 2008 +0000

    rename node() type to erlang_node()
    because the r12b-5 compiler issues a "Warning: type node() is a new
    builtin type; its (re)definition  is allowed only until the next
    release" otherwise

commit 18a9a98d7a139ed810979218af2afe5baf57a0fb
Merge: 8f7d8312f 381495661
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 21 09:28:25 2008 +0000

    merge bug19615 into default

commit 938723ed9c83324f9ad44b4509db3e0edca2545a
Merge: 72f685964 6cf3d7d3e
Author: Emile Joubert <emile@lshift.net>
Date:   Thu Nov 20 20:29:26 2008 +0000

    Merged bug18381 into bug19684

commit 381495661a461f04c12f1ec19aff8dd5410a45cb
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 20 17:27:40 2008 +0000

    Use exec when starting erl

commit 86db69511aa3026a1f6391f98a7a11da6604cbde
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 20 17:15:52 2008 +0000

    Refactored the internal structure of the limiter

commit 50635ca6e1b4008f1343f884d6df61aca2dd8f0f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 20 15:06:51 2008 +0000

    Produce architecture dependent rpm binary packages

commit 657c359e24ec8c300e2fd89a4bfc8201e6b4c3b4
Merge: f8b2adc26 8f7d8312f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 20 14:31:54 2008 +0000

    Merged default into 18557

commit f8b2adc26c76082254d9a78a7ded2eaf61dc5d99
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Nov 20 14:29:11 2008 +0000

    First cut with some actual load balancing working

commit 02eb85f50553ee6d1fc02d7c2b1fdc7c1565f366
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 20 13:45:39 2008 +0000

    keep dialyzer happy
    my trick of preventing "function ... unused" warnings fooled the
    compiler but not dialyzer

commit c2ed22d2ca95b856f6f1bb7ee9109a8a4468fb6b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 20 13:34:37 2008 +0000

    Moved from python-json to python-simplejson.
    Fixed 'unicode' problem for auto-generated code.

commit 644ba5b92961ce48fb227783b4b544690ab411b7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 20 13:14:39 2008 +0000

    disable cross-node routing optimisation
    until we figure out how to make it work w/o breaking the effect
    visibility guarantee

commit 8f7d8312f0e2aaf786a72325fdf42202325207b1
Merge: d7fce2536 15b0f9336
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Nov 20 10:26:01 2008 +0000

    Merge bug19522 into default

commit caede44da77c98cfad317aa3918bc8621e7dc3a1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 19 16:45:30 2008 +0000

    refactoring

commit 9b2a5b83144774f5f154000d2c8a0430bd62b947
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Nov 19 16:31:51 2008 +0000

    Savepoint

commit 604fe1f99b60ae97c14edd3bb425c8a274ac749b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 19 16:31:13 2008 +0000

    add connection_info functions

commit 15b0f9336087f8340cbd14183df2f6d4fb6b1a5d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 19 15:12:46 2008 +0000

    work around OTP-7025
    also simplify the match slightly

commit 6cf3d7d3e4a71a3a1422eca7d1ed703005b6fff0
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 19 15:02:20 2008 +0000

    add function to get hold of all connections (i.e. reader pids)

commit 5f727ed6bbbbaa2c31f45b0f1f5a6d72b7497127
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Nov 19 11:33:35 2008 +0000

    Moved limiter out of the queue state into the process dict

commit d7fce2536718e7d235297a8f7c81edc88902eea5
Merge: 308124544 2c0f7c9ca
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 19 11:21:45 2008 +0000

    merge bug19573 into default

commit 6ac77a9ec2f53357d84386c2266927c5e3b4174a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 18 21:19:35 2008 +0000

    add rabbit_exchange:list_bindings/0

commit b9e461fc6d762c99a7a87e1f0d95c446aad03405
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Nov 18 19:40:02 2008 +0000

    First stab at basic.qos

commit 72f685964d44d3823a39959394f590ab63bee72b
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 16 12:24:53 2008 +0000

    Added rabbitmqctl interface for listing exchanges

commit 4311e8f589cd127fe99e4408f7d0b8f6d073b52e
Author: Emile Joubert <emile@lshift.net>
Date:   Sat Nov 15 10:03:52 2008 +0000

    Unmerge bug19331 from bug19684

commit 3081245448bc6935438fde4620b5ce0f7a1d8c34
Merge: 01251d6d9 ad39f4dd5
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 14 15:00:13 2008 +0000

    Merge bug19788 into default

commit 2c0f7c9caff1ebcd874821fc21481a67076e406c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 14 10:31:27 2008 +0000

    Added erlang as build dependency, remvoed python since
    it is a dependency of python-json.

commit ad39f4dd5cc051a76e124a9d1e0f5cda5dc419bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 14 09:41:55 2008 +0000

    don't use gen_server hibernate feature
    it was only introduced in R12 and we want to stay compatible with R11B-5.

commit 3e75d42a0d5d3df6f4a68d65af6c3adfe9379c10
Merge: baa5e4804 6a613d127
Author: Emile Joubert <emile@lshift.net>
Date:   Fri Nov 14 00:03:39 2008 +0000

    Merged bug18381 into bug19684

commit 85eb53ca7ec4ca74585765c50117d1d9d710774c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 13 15:47:12 2008 +0000

    react to memory threshold breaches present at startup

commit 6a613d1278ddb85272c2ba647ed822c1cad10af9
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 12 23:33:31 2008 +0000

    cosmetic rename
    for consistency with code in rabbit_exchange

commit 855ab46dc58197e6f3f0da0406c9280ac06f6deb
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 12 23:28:26 2008 +0000

    add exchange list and info functions

commit 62f021010858ec2c4a3e5f555968b0dc68305ebc
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Nov 12 23:27:12 2008 +0000

    move info types into common header file
    so we can re-use them

commit 17f996b9df7c8b9661b5edc8f2f90b6ca919099a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 11 22:57:49 2008 +0000

    simplify info and info_all API, and extend info item list
    - no overloading
    - info_all now returns a list of kvlists rather than a list of
    queuname-kvlist pairs
    - new info items for all the bits of the amqqueue structure

commit baa5e4804a527a54ef4be26a1b86394c43245af4
Author: Emile Joubert <emile@lshift.net>
Date:   Tue Nov 11 21:18:12 2008 +0000

    Removed memory queries, only report on selected queue details

commit 01251d6d91d60f48c57048c0bb975460f4b48cf8
Merge: f907f4902 6a64d36c9
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Nov 10 11:25:39 2008 +0000

    merge bug19730 into default

commit bba6ec51b373650ce89038379a6fcb159b4f0723
Merge: ca3b1520a 252620e5a
Author: Emile Joubert <emile@lshift.net>
Date:   Sun Nov 9 23:32:13 2008 +0000

    Merged bug18381 into bug19684

commit ca3b1520af6f2d7a0502d550bb174493b0f7ccf9
Merge: bb98450a0 f907f4902
Author: Emile Joubert <emile@lshift.net>
Date:   Sat Nov 8 14:55:03 2008 +0000

    Merged default into bug19331, QA feedback

commit f907f49027688482c118569b4c6aa8956ccdfef8
Merge: c83165eca 146d4a1ec
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 7 17:45:07 2008 +0000

    merge bug19250 into default

commit 6a64d36c9defbcbd83843a75e9e5b238f037463f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 7 17:42:54 2008 +0000

    Cleaned the Makefile. Goodbye generic_stage!

commit 146d4a1eca488e82606e287d3906071a6ed6d6f8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Nov 7 17:18:58 2008 +0000

    Revert to 0-9 definition.

commit f821572634cecadf3f7c73c17d132e7d9c3d42fd
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Nov 7 16:26:59 2008 +0000

    Do not include source files in the binary packages

commit c83165eca1af82dc079085c09dc7fd7be997e317
Merge: d367479bb 96af7bf70
Author: Simon MacMullen <simon@lshift.net>
Date:   Fri Nov 7 11:25:23 2008 +0000

    Verified

commit 252620e5a067cdae5984757b6b395bad66e747b7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Nov 7 10:36:41 2008 +0000

    info_all
    this is resilient to disappearing queues

commit 74eaf36721d6082bef307572e1ff3e95e1c8f31b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Nov 6 23:07:39 2008 +0000

    beginnings of queue info API

commit d367479bba372ceccb47f5e5ec6fc2be482ef50d
Merge: a7cd1578c 6a6665ccd
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Nov 6 17:51:07 2008 +0000

    merge bug18776 into default

commit a7cd1578cda19991cb60da6cfc73cc097b62e3ca
Merge: fb15adb9e 6e887e5ac
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Nov 5 12:02:54 2008 +0000

    Merge version 2 of 19468 back into default

commit 6e887e5ac1096c94ca2d29f42fe24698abe0053a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Nov 4 20:53:32 2008 +0000

    fix signature
    mfa() is predefined as {atom(), atom(), byte()}

commit fb15adb9e433568908344d126c45c9e48e5813de
Merge: 0861a3a96 16c1b59c4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Nov 4 16:51:09 2008 +0000

    Merged 19623 into default

commit 0861a3a9651319717af4786e656f528bd9914f8d
Merge: 18f495420 bffa8f6d0
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Nov 4 15:08:11 2008 +0000

    Merged 19587 into default

commit 6a6665ccd563db3f3caef952d281a0ba799a488f
Merge: e4f2aeaeb 18f495420
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Nov 3 15:37:23 2008 +0000

    Merged default into 18776

commit 18f495420f0063b08789bf7dfdebc175989abc8a
Merge: a39933ca4 282b25837
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Nov 3 14:58:58 2008 +0000

    Merged 19468 into default

commit 282b25837870c6addab1dc1867fd7cedd6d56b55
Merge: 7700cc6e4 a39933ca4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Nov 3 12:11:34 2008 +0000

    Merge default into 19468

commit 771097544ac3dc9e8491a948db0e20a7794910a0
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Oct 31 11:36:49 2008 +0000

    Alter signatures to the latest 0-91 draft XML, and support nowait

commit 692f208182134783e02a98bd2c80b5d1191e500c
Merge: 6a5a9f667 a39933ca4
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Fri Oct 31 11:07:57 2008 +0000

    merge default into bug19250

commit a39933ca41b4fa3f48fc7c19506e7b64be8b2ad3
Merge: eae657af8 44295f44d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 30 17:04:20 2008 +0000

    Merge two default branches into single one

commit eae657af80af5bb98bacb118346c3a68b6aa8e0c
Merge: 31cb538ba f3e957903
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 30 17:00:08 2008 +0000

    Merge two default branches into one

commit 44295f44d75ea1fabfb9cbd1693d9ebb598f9866
Merge: 50a0752fb 6a5a9f667
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Oct 30 14:10:55 2008 +0000

    merge bug19250 into default

commit 6a5a9f667bb30b98c3b834c2882e8d9c51c0260e
Merge: c1374a89f 50a0752fb
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Oct 30 13:53:54 2008 +0000

    merged default into bug19250

commit 16c1b59c40d6b684578adf4c7b3929088751f673
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Oct 25 23:44:52 2008 +0100

    don't complain on shutdown
    when sending notify_down et al to queues

commit bffa8f6d0dab0987e07650638e961cec28865fa4
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Oct 25 22:09:41 2008 +0100

    log *actual* listening IP & port
    This caters for o/s-assigned listening ports, i.e. when the given port
    is 0.

commit 50a0752fb10922db34b17d3d1f499ca80c95329b
Merge: 57dee61bf 3e0231767
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sat Oct 25 13:26:50 2008 +0100

    Merge bug18732 into default

commit 31cb538ba3c0a70921e727ab425ef39f0498349d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sat Oct 25 13:05:55 2008 +0100

    Added new line to logrotate scripts, debian packaging no longer throws warning

commit f3e95790370f29912381edce524449bf8a33415d
Merge: 051da30ab 153837a2c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Oct 25 11:33:45 2008 +0100

    merge bug19572 into default

commit 153837a2ca3643cc09426e44ad95e740f1731682
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sat Oct 25 11:09:24 2008 +0100

    Removed packages that are already set as dependencies of the others

commit 7700cc6e4bf0251b3d7b4fc354200a496a46efd3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Oct 25 06:13:06 2008 +0100

    hibernate writers
    With this in place I am finally unable to make rabbit grind to a halt
    due to garbage being held by idle processes.

commit 4b2330d4c519c81b77cf92f13aab6226d9623f27
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Oct 24 18:32:55 2008 +0100

    Minimal version of build dependencies on debian

commit d7343c5d7fd97dad9d1ef75548714f9114ddbe42
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Oct 24 17:46:50 2008 +0100

    hibernate buffering_proxies
    My tests got stuck after about an hour, and the cause was
    buffering_proxies holding on to memory

commit 051da30ab845e7be239b2bb9d9cb18f31493e912
Merge: feb1e47a9 4df43062a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Oct 24 11:06:10 2008 +0100

    Merge bug19552 into default

commit feb1e47a9c72d590334337fbb2f186ddb20b7942
Merge: 24558d7f6 1aceb2cc3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Oct 24 10:49:15 2008 +0100

    Merge bug19552 into default

commit 24558d7f6885b2f1283e3b42596c8a1607ef242c
Merge: 57dee61bf 4c56b7bf2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 23 16:11:32 2008 +0100

    Merge bug19382 into default

commit b19e4bb8004d35efc9bbc43bdb9c20c111e6a3e2
Merge: d2f22dbbf 25a63c3e3
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 22 07:51:58 2008 +0100

    merge bug19468_channels into bug19468

commit 25a63c3e348582e1b407f7961288690553bad166
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Oct 21 15:59:41 2008 +0100

    hibernate some processes to conserve memory
    In my experiments I encountered situations where rabbit would not
    recover from a high memory alert even though all messages had been
    drained from it. By inspecting the running processes I determined that
    queue and channel processes sometimes hung on to garbage. Erlang's gc
    is per-process and triggered by process reduction counts, which means
    an idle process will never perform a gc. This explains the behaviour -
    the publisher channel goes idle when channel flow control is activated
    and the queue process goes idle once all messages have been drained
    from it.
    
    Hibernating idle processes forces a gc, as well as generally reducing
    memory consumption. Currently only channel and queue processes are
    hibernating, since these are the only two that seemed to be causing
    problems in my tests. We may want to extend hibernation to other
    processes in the future.

commit bcd4affd32ff8dfc4351c1574420d6a615984ada
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Oct 21 15:46:05 2008 +0100

    raise memory alarm threshold
    The default 80% is just too low for many systems - I have less than
    that on tanto most of the time.
    It remains to be seen whether the new figure works ok for most users.

commit 96af7bf70232ddfa060f0e9767fa63cec20ae390
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sun Oct 19 22:52:00 2008 +0100

    Removed check_tools script since Build-Depends
    will handle it itself.

commit 5b995a2b87c8bbdb09c9ecbcc3e81d3d39f56ad8
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sun Oct 19 02:19:38 2008 +0100

    Forgot about perl

commit 743944c0e7d3004f514d7ad3aa09fbf9060bfba9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sun Oct 19 02:13:47 2008 +0100

    Added missing build dependencies for debian

commit 3e0231767bfec390a10961d53ef8366bdf90e397
Merge: 7279a32f7 57dee61bf
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Oct 17 17:21:02 2008 +0100

    merge default into bug18732

commit 57dee61bf77b4175cf0f26c89f0359c335dfbf45
Merge: 362251281 4f2846ca1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Oct 17 16:18:21 2008 +0100

    Merge bug19489 into default

commit 362251281647a143574fcee36f4a00af47db7763
Merge: 07f212e29 7f06e8736
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Oct 17 13:22:04 2008 +0100

    Merge bug19329 into default

commit bb98450a0e738b677fdf07dbc2693ebd7e86f135
Author: Emile Joubert <emile@lshift.net>
Date:   Fri Oct 17 00:13:57 2008 +0100

    Fixed typo

commit 4c56b7bf2119b00a75d8176147fedb06ef20377f
Merge: cb732f4b1 07f212e29
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 16 18:47:19 2008 +0100

    Merge default into bug19382

commit cb732f4b1746f7768e990ea177403c8fafc32f13
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 16 18:42:00 2008 +0100

    Removed unused variables in the Makefile

commit 635e10a074676236ca9a8a62d7f1f913e8702589
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Oct 16 18:33:44 2008 +0100

    Spec no longer requires non-standard macros,
    include rpm-specifc files as sources instead of patch

commit c1374a89f7bd37478b80e2ec558288d458c28563
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Oct 16 14:02:06 2008 +0100

    Fixed QA remarks

commit dbf935be377e50cad62a4cea2c68123e3eb566aa
Merge: 86e2cc75e 07f212e29
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Oct 16 13:03:49 2008 +0100

    Merged default into bug19250

commit e138ddcf83314bfb5a97608bb88753c9f3cb0ec9
Merge: 9d11200cc 4df43062a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 06:51:33 2008 +0100

    merge bug19552 into bug19468_channels
    The former triggered errors in the latter

commit 4df43062a0039d47e0f8b5044539652d5457b6dd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 06:11:33 2008 +0100

    fix 'duplicate_next' error when sending messages directly to proxied process
    The buffering_proxy:mainloop was unconditionally requesting new
    messages from the proxy. It should only do that when it has just
    finished handling the messages given to it by the proxy in response to
    a previous request, and not after handling a direct message.

commit 9d11200ccbdfb0743c475b54aa7f4d4698263877
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 05:46:04 2008 +0100

    some explanation

commit 9eb25deee4ab897f6be8af3b0e338a59d67283e7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 05:45:08 2008 +0100

    wire up channels to rabbit_alarm
    We propagate changes in the high memory alarm status as channel.flow
    messages to the client. The channel.flow_ok replies are simply
    accepted.

commit d2f22dbbfa3f592f7f6d1fb706506b3f2de322c7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 05:36:51 2008 +0100

    make rabbit_alarm usable
    This now supports the registration of alertee processes with callback
    MFAs. We monitor the alertee process to keep the alertee list current,
    and notify alertees of initial high memory conditions, and any
    changes.

commit abce126e2eb0f188bf62a656a27062db3c6e8a97
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 04:00:11 2008 +0100

    cosmetic

commit 3a178fdb53ea33d652391ef16cb02f7d2b8b644c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Oct 16 03:56:41 2008 +0100

    branch off for effect-less alarm handling
    so we can later experiment with different effects

commit e4f2aeaebe206dacccec940284870983cb74bbff
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 22:51:23 2008 +0100

    Added function for Rabbiter

commit 12e28a7f2262c2ff86024ced62bfb01d858d56ac
Merge: 3ea54704a 7c77eb202
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 22:37:17 2008 +0100

    Got into a loop, I blame hg

commit 1aceb2cc3047498c77fae80afa37d0b07ef5fc5b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 13 21:56:26 2008 +0100

    produce a nicer error message for common queue disappearance case

commit 45090533fe5f06aa6f5f8134a0658e186cf19f1c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 13 21:37:02 2008 +0100

    exit with a proper protocol error when commit/rollback fail

commit 3ea54704a7400aecbe0a1bc20c1b89c6775af253
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 21:27:33 2008 +0100

    Set is the default

commit 69305918ca6f0047d813f59d5991defb5cd1fc89
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 21:09:53 2008 +0100

    Changed index from ordered_set to set for durable routes

commit 4f2846ca1f24469792ca57a4971793954ecff366
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Oct 13 21:05:02 2008 +0100

    don't log errors during delivery
    If the target queue died normally we don't care, and if it died
    abnormally the reason is logged by the queue supervisor. In both cases
    we treat the message as unrouted.

commit 7c77eb20250ea9a9264e3c409f40e2894ef67e11
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 19:18:12 2008 +0100

    Nuked a space

commit a81de67ef1f8c924e36bc488efbebf169674bccb
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 19:12:16 2008 +0100

    Used record wildcard match feature

commit b35534595c69c422041301ec90b5d61e8fef6009
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 18:58:20 2008 +0100

    Added wilcards to every argument field in binding record

commit de5b4fe2d42c8ca803c0e86be76b501066723555
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 13 18:26:55 2008 +0100

    Added arguments field to binding

commit 908357efbd78adc3b31351eecb38730b52682453
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 23:43:16 2008 +0100

    maybe_auto_delete should always return ok

commit 07f212e2942af3f5eb50543e0e36ccda026ac383
Merge: 5e6c6e50c 309cb71c7
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 17:36:14 2008 +0100

    merge bug19332 into default

commit 75fba37dd35e689ea0d2a6a171b22b6818a1d7af
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 16:03:42 2008 +0100

    cosmetic

commit 6c6dbef97f5343e0de1a605e0652253c2a605c69
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 11:59:28 2008 +0100

    some minor formatting fixes

commit 979415ea8bea18f071895dbd8312f1e290f95c55
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 11:51:01 2008 +0100

    refactoring: never construct reverse routes/bindings directly

commit b865db3a6d3981342d1bc475b17174ebd47eef6d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 11:44:58 2008 +0100

    fix indentation and comments

commit 8512cde5b3fe33cccaae823b5c31c512cd927b5b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 11:35:34 2008 +0100

    inline delete_bindings/1
    and also refactor indexed_delete to use a list comprehension instead
    of lists:foreach and return 'ok'.

commit e3a6cb0571cf402cac69bfc0576a7445c622c7bd
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Oct 12 11:24:45 2008 +0100

    rejig call_with_exchange
    We don't really need two flavours of call_with_exchange.
    
    In delete_bindings/1 we can assume the exchange exists - this code is
    called as part of queue deletion and we don't care about exchanges
    that have gone missing.
    
    Also, it is sufficient to use an ordinary read rather than wread.

commit 4c33ba097244d9fef9353a6613e4c95ce9953b7f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Oct 11 11:50:25 2008 +0100

    Removed superfluous comment

commit 92b89eb0a92617203746c27b627c9478083f5465
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Oct 11 11:49:41 2008 +0100

    Don't hassle the HOF

commit 74f7df23ae8d0f6e503e5bfae18d0bfeaa78fe26
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Oct 10 23:09:25 2008 +0100

    Reinstated list_exchange_bindings/1

commit e71f140b9fc48399bfd089e9eedd05c97da95c6d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Oct 10 21:59:06 2008 +0100

    Changed select for has_bindings into a continuation

commit 252aaf6657d88d9a68b5cad3fbfa6348eae5cc5a
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Oct 10 21:51:39 2008 +0100

    Refactored all of the exchange delete functions

commit e7ec382c25710f3c47573b8c4513bdbda6f58f76
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Oct 10 16:18:06 2008 +0100

    Default binding should be restored in exchange module

commit 71fa0a4227a92e07124ed8f2bb071255a41fb4c2
Author: Emile Joubert <emile@lshift.net>
Date:   Fri Oct 10 09:11:22 2008 +0100

    Moved and modified documentation

commit f83fd938706802dc63acfdecc3b26979f7f5608a
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Oct 8 14:07:36 2008 +0100

    Simplified has_bindings because it only needs to do simple select and count

commit 6e6830164138c024bb6db3d3a76b1e6d16c79c39
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Oct 7 12:08:31 2008 +0100

    Brought forwards delete function into loop to avoid delete_object wildcard issue when it is fixed in OTP

commit 764f0241e77c4d5a92cd743726c390d296aa755d
Author: Emile <emile@lshift.net>
Date:   Tue Oct 7 10:02:52 2008 +0100

    Run broker as windows service

commit 0ba0739aa3517924326840190a0806af68f9694e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 18:43:34 2008 +0100

    Fixes for dialyzer

commit 6fba52a764bbb2b705ae759a2b47b1cba3b319ac
Merge: b8530a54f 5e6c6e50c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 17:59:31 2008 +0100

    Merged default into 18776

commit b8530a54f96d0302b5ef45f6a6113b91a89ffb76
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 17:42:58 2008 +0100

    Lock demotion

commit ca5b562728fcf5c3558fdfb4d073bc61d7e51f01
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 17:29:23 2008 +0100

    Further refactorings

commit 6d8e269e8721848c678a3d9ba013306a59a1f20c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 15:10:22 2008 +0100

    Refactored call_with_exchange

commit 0f7b2f2b518602371a1f8fe8343d7548e5eab357
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 14:58:19 2008 +0100

    Factored out route deletion with reverse lookup

commit a72844f0a3ab9447a3ba4f2e1956c74d52ef0f26
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 11:48:22 2008 +0100

    Factored out re-entry condition

commit 982fface28c233e33316ca2a1238e58ef3a442f3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Oct 6 10:53:45 2008 +0100

    Fixed full table scan when deleting forwards routes

commit 9de5dbe9a92f8a1cf7243c8e73f3f489452b509a
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Oct 5 20:12:51 2008 +0100

    Refactored deleting forwards bindings

commit 96e8235eeae6dce5ce000ba59171084592501fbe
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Oct 5 19:57:56 2008 +0100

    Makes better use out of the reverse routes when deleting

commit 5e24c7bd6b764858213bbc2dfb1e303b801b5fd3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Oct 5 18:53:41 2008 +0100

    Minor refactoring of the continuation

commit b003c245d5f4c67325cf5d5b46eef81cb412b02b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Oct 5 18:36:17 2008 +0100

    Fixes for auto-delete exchanges

commit 5e6c6e50c0d8491a45dc20a806acd5ecb67c7110
Merge: 952e773c7 721e72d16
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Sun Oct 5 16:58:53 2008 +0100

    merge bug19485 into default

commit 952e773c7055f0faac5cb630849605574b16890b
Merge: 2a0374c97 f34405dce
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Oct 4 16:39:22 2008 +0100

    Merged bug19219 into default

commit f3e3f768d20b302c5cf0dc186b2d603bfadb5787
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Oct 4 16:20:09 2008 +0100

    beginnings of reacting to low memory conditions
    configure memsup and hook in our own alarm handler

commit 86e2cc75e5f3e282f70b3a30cf319b63e0361057
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Oct 4 15:35:37 2008 +0100

    Implemented queue.unbind

commit 721e72d1653b56baa68642d5f27a2d09b3af6a7f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Oct 3 13:47:01 2008 +0100

    propagate channel/connection errors when in closing state

commit 2a0374c97aad540dbf3800a3bdf1329253f9b992
Merge: c2cdd9d49 d0700a23d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 1 19:46:17 2008 +0100

    merge bug18784

commit f34405dcec0b1be852d9f1b991e0258cc1680e8c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Oct 1 12:39:26 2008 +0100

    cosmetic refactoring

commit 9ce6c93cb94f4b20c4c3e3e644f9b0e3e96bdbf4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Sep 30 22:54:47 2008 +0100

    Fix for not cleaning up durable auto_delete exchanges properly

commit 0587bccf2d6c4231a7dee59bd077f310a12ccf79
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 30 14:35:46 2008 +0100

    oops

commit 52e2ee3f136ce3ec839e88dc342397f19ab3d565
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 30 14:14:01 2008 +0100

    modulate gen_server:call timeout when doing work in parallel
    When we fire off lots of gen_server:calls in parallel, we may create
    enough work for the VM to cause the calls to time out - since the
    amount of work that can actually be done in parallel is finite.
    
    The fix is to adjust the timeout based on the total workload.
    
    Alternatively we could not have any timeout at all, but
    that is bad Erlang style since a small error somewhere could result in
    stuck processes.
    
    I moved the parallelisation - and hence timeout modulation - from the
    channel into the amqqueue module, changing the API in the process -
    commit, rollback and notify_down now all operate on lists of
    QPids (and I've renamed the functions to make that clear). The
    alternative would have been to add Timeout params to these
    three functions, but I reckon the API is cleaner this way,
    particularly considering that rollback doesn't actually do a call - it
    does a cast and hence doesn't require a timeout - so in the
    alternative API we'd either have to expose that fact indirectly by not
    having a Timeout param, or have a bogus Timeout param, neither of
    which is particularly appealing.
    
    I considered making the functions take sets instead of lists,  since
    that's what the channel code produces, plus sets have a more efficient
    length operation. However, API-wise I reckon lists are nicer, plus it
    means I can give a more precise type to dialyzer - sets would be
    opaque and non-polymorphic.

commit 8f08a5b5476394d42e96ec66dbfbf857cdc3a679
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Sep 30 01:11:39 2008 +0100

    Simplications

commit ee89d942a635695c5d7a1eae8836afb5308307a1
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Sep 30 00:54:00 2008 +0100

    Made better use of pattern matching in mnesia:delete_object/1

commit 346a791c038bd08a8b6aa12d6cda076faa2d1c5f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Sep 30 00:14:41 2008 +0100

    Fix for auto_delete exchanges

commit 63e6b878a7c10170112f2ea7515395700af21570
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Sep 29 21:31:21 2008 +0100

    Reverse routes and durable routes now get deleted

commit f64385428372fc230421b559c201e2d69b0f7f9e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Sep 28 22:19:29 2008 +0100

    cosmetic changes and some minor refactoring

commit c2cdd9d49d9173e6e7cd718dc9485e2352cc821e
Merge: 54032ca82 fa3ce836a
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 28 15:09:47 2008 +0100

    Merged 19455 into default

commit fa3ce836aede5ac9eb9dc3ca7fc08eca272e9640
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sun Sep 28 11:37:28 2008 +0100

    disable Nagle

commit 358f4d29e0355c366b93790282cef6e041dc910f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:55:38 2008 +0100

    Binned resource() type

commit c24ce8446f5ca496bc9acaf23911dba8b75fb124
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:51:23 2008 +0100

    Removed e_m_t/2

commit 53a9e8798b9e98c296327cf30548eee829f04c73
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:41:50 2008 +0100

    rabbit_exchange:{add,delete}_binding/1 should not be exported

commit 8036f65792065768907c8c4cc5b18063183c7128
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:35:11 2008 +0100

    Truncated lines in this patch to 78

commit bc3468dd98eacf4dd0dddbf45969d225dba589bd
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:22:06 2008 +0100

    Swapped position of exchange and queue in binding APIs

commit 437401df9f09b65a9ce13b72f80bb0f7c1a33ab6
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:13:23 2008 +0100

    Cosmetic fix

commit 87396f8ddb979038e0173bd8fb10977558a7e476
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 21:11:02 2008 +0100

    Dialyzer fixes

commit 9bd58e8226bd00ab6b5ac774ba88fbe3d3ab53b5
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 17:01:41 2008 +0100

    Make function match a bit tighter

commit 947fc5d49ef97266128aca44b9fbb811ca5c929b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 27 16:56:46 2008 +0100

    Fixed bug with fanout routing

commit 5f36cce3cc7715fed3d6073e56367fbda0ca75a1
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 26 20:53:11 2008 +0100

    more simplifications

commit 61d7ddfec0915c22a502a8eba27ac71071ca958d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 26 20:44:01 2008 +0100

    some simplifications

commit fcf48b3d9a271fcbee9701825b433e5292c205b6
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Sep 26 20:17:03 2008 +0100

    simplify select

commit c250b7b89c70a0618457325c86c3102b85b079b9
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 19:46:26 2008 +0100

    Fixed type signature

commit 76ddf664cb1dbe98846444240e4c8dd0747f710f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 19:35:56 2008 +0100

    Got rid of no spaces after commas

commit c7e97fab2b72b0d15138a35381ed86579e9a7f7d
Merge: 50bc4b1d1 54032ca82
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 19:30:58 2008 +0100

    Merged default into 18776

commit 50bc4b1d1b174eb3ad6719c80ec4adae395a68cd
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 19:12:31 2008 +0100

    Added type signature for execute_mnesia_transaction/2

commit b0add05c7c761e929fb915e41442cb20e402e788
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 19:10:40 2008 +0100

    Removed code duplication

commit 3a945091491db2a9bb2d99acfb02ec8e9a008982
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 18:24:43 2008 +0100

    Removed errornous comment

commit 90b32a410f24c3b2ab101df5cc461984be348518
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 18:22:24 2008 +0100

    Modified list concatination

commit 63a3c7641f4eb6ada58b5eaf28f65299400e2bea
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 18:17:55 2008 +0100

    Added a comment about the complexity of the mnesia:select usage

commit 941d8a3740bd0a45e70b9211c2eb6b9561c9cf67
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 18:09:56 2008 +0100

    Revised full table scan comment

commit 969ff33484038be5836330e046bcc911e3b035d7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 18:07:19 2008 +0100

    Deleted route_internal functions

commit 7c81aaa3c0b99f2bc255ed82ad36c0e8f8e3f1e7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 17:32:24 2008 +0100

    delete_bindings should take a queue_name() rather than an amqqueue()

commit 9f55ecc6934d340e53b557a9769f623f8f441992
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 14:18:21 2008 +0100

    Replaced mnesia:delete/1 with mnesia:delete_object/3

commit bca6c36217ae8a356f23ec603f221ae904187b9e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 21 09:57:25 2008 +0100

    Respellt the word synchronize, incorporated some QA notes

commit 468a3335e3934b80792a368567d1deb040e405bd
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 20 21:07:17 2008 +0100

    Implemented durable routes

commit f998dffa1cb86355d2439fc7da4d6134cc36773f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 20 20:16:00 2008 +0100

    Supressed compiler warnings

commit 8af0b8a0eb353b231112c0c9b9fd284393503878
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 20 20:11:32 2008 +0100

    Backed out changeset 031a255683ee

commit 188f79a168ffe43860b61da941af62d9e60f2c32
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Sep 15 12:55:07 2008 +0100

    Apply rpm-specific files as a patch,
    instead of directly changing the source tarball

commit 309cb71c78d84d09d970a5f0081b6f13891a1b59
Merge: 5c400123d 54032ca82
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Sep 15 10:37:53 2008 +0100

    merge default into bug19332

commit 5f6ed561bb876fbf10fad0207696f93dd05af9e9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Sep 15 10:23:53 2008 +0100

    Cleaned up the Makefile

commit 5c400123df5ca4c472fb80a5e739ba525a23e6c7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Sep 15 09:55:28 2008 +0100

    Fixed checking build dependencies in rpms
    while building on Debian systems. Unfortunately
    .spec doesn't have 'not' logic.

commit 5ceca89ef32a4c6c755a99106af81496717242de
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 22:07:42 2008 +0100

    Deleted Arguments parameter in add_binding because we dont do anything with the args yet

commit cb5752e87469c85d0fdb930cf9f6cfa6adcb3282
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 22:00:03 2008 +0100

    Moved {add,delete} binding to exchange module

commit 4c7bc09a16e736bdb40347f11a62b8b088366a58
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 21:46:51 2008 +0100

    Merged delete_temp into delete_queue

commit bcc989a3100416ae76e6b40cfcd93d46736f80c1
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 21:38:47 2008 +0100

    Default binding should bind to the default exchange in the queue's vhost

commit 16c5b611e6c6e9e0f3123babc7e9359d6651dba9
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 21:33:23 2008 +0100

    Changed key type into binding_key and moved it to rabbit_framing_spec header file

commit d6960cf5af9ef65d0212643cae25e40ce2b49951
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Sep 14 21:16:15 2008 +0100

    Fixed alignment of the comment about the constant field

commit 18111f393e3a41e52194b7d1975685d3c86edab6
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Sep 12 12:24:22 2008 +0100

    Append rpm-specific files to the source tarball.
    Cleaned up the rpm Makefile.

commit 54032ca82e19b0c27b5f4257fb5cfd3b44636510
Merge: 131d39c9c a129a035a
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 11 18:00:29 2008 +0100

    merge bug19164 into default

commit a129a035ab0161c5c06243b20889388a58e6f55f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Sep 11 17:52:22 2008 +0100

    cosmetic

commit fc9c81a68a2e677368f60b55839ebc8b5d8cdaad
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 11 17:52:23 2008 +0100

    cosmetic

commit 86644f75bbec05e6810dc1e8de87dd884a4719c5
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 11 17:33:43 2008 +0100

    Use parse_status to correctly determine
    the status of the node. No need to print node's apps.

commit 8f209a026e329308c855313a6957e4830bc846b0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 11 14:10:14 2008 +0100

    Added status command to rabbit_mutli, init.d scripts
    now use that command.
    Used status command in init.d scripts to check
    if the server is running before stopping it.
    Fixed various indentation problems in init.d scripts.
    Synchronized the init.d in Debian and RPM to behave
    in a similar way.

commit 131d39c9cb519a4fb90cca04bdc71721a47a4679
Merge: 89dea8975 ad944a79c
Author: Matthias Radestock <matthias@lshift.net>
Date:   Wed Sep 10 13:37:32 2008 +0100

    merge bug19193 into default

commit ad944a79cd610d219248eb4586e30080a0ecf6ba
Merge: d848d59f8 89dea8975
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Sep 10 12:39:27 2008 +0100

    merge default into bug19193

commit d848d59f8ed468bee91bbc90ddaba992392a240b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Sep 10 11:39:19 2008 +0100

    Refactoring of call_all_nodes/1

commit df440897a77b4350cc5bc73e38aaeacc910fb0cf
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Sep 10 10:53:55 2008 +0100

    Use lists:foreach instead of tail recursion
    in rotate_logs command. Updated usage function()
    Reverted change in rabbitmq-server.spec that
    didn't belong to this bug.

commit 89dea897540cbdfb3250153ddb07eff9fa95bf7c
Merge: e9f681e00 e54821ad8
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 9 17:36:33 2008 +0100

    merge bug19166 into default

commit 36e824bf5148ef1121a58de2408da8c8751501c7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 17:05:01 2008 +0100

    Continue rotate_logs command even when
    the command on specific node returns an error.
    Display the error message in that case only.

commit e54821ad8c442cf5b4bee7dd35d4ea9b6b75f230
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 16:45:04 2008 +0100

    Start the RabbitMQ server after adding
    it to chkconfig.

commit 7088e40de2a37f011f5a131dfd0a33c8c406426f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 16:15:09 2008 +0100

    Fixed various QA remarks.
    Renamed rotate_logs_all to rotate_logs.
    logrotate will fail silently to logrotate
    if calling rotate_logs on any of the logs
    failed.

commit 99ccc207256b47a7ff786614cc9162b2adbf8cb4
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 13:33:00 2008 +0100

    Return value of the RETVAL variable in init.d

commit e9f681e00829b0475165b8098286eb68964283f6
Merge: 453584601 0df364f1b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 9 13:16:14 2008 +0100

    merge bug19144 into default

commit 0c47954f9f6ef166d74f306953d9d5e035e9e0d1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 12:48:35 2008 +0100

    Renamed startup.log, .err to startup_log, _err
    to avoid logrotation problems. This also removes
    the problem when the node is called startup.
    Same situation for shutdown logs.

commit 0df364f1b21ccd0fb574475e11b1c77774dd9e3e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 9 11:45:26 2008 +0100

    Updated the license to reflect the current state.
    Debian packaging has the same license as the
    broker itself.

commit 453584601c3d7652eb8a08d6e63cf273caf43521
Merge: e5bf57a32 5587def78
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 8 16:19:01 2008 +0100

    merge bug19200 into default

commit 8b32014455159718524fba0ebcde08bf998596d5
Merge: 5830f2819 e5bf57a32
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 17:42:57 2008 +0100

    Merged default into 18776

commit 5830f2819d939d65bfbb16ca4de620ab1c8a1ea9
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 17:33:22 2008 +0100

    Fixed dialyzer error

commit 708434f16023c11471d5c53a8d4e49c2c2fa71d4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 16:34:17 2008 +0100

    Removed a lot of commented out code

commit 1c0b11e81f71d81623c220ee1f25f6a0f9e9254d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 15:20:36 2008 +0100

    Added tag Aman-06-09-08_2 for changeset feb4ba878635

commit 78c13f5a5e1d70370b980a27fbd59d3b36a477d5
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 15:18:40 2008 +0100

    Fixed compilation error

commit 55fa34ad2f8bf670bfe872c048d23de32cd562c7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 15:06:56 2008 +0100

    Added tag Aman-06-09-08 for changeset f91997069bdb

commit 341f95b735b5b47964fe3644b9229e7079357c98
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sat Sep 6 15:06:20 2008 +0100

    All of the functional tests now pass, need to compare performace against default

commit 8b53831af332e7dc3b97ed007b9bf43f295a6205
Merge: 1c2d08d65 5587def78
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Sep 5 17:02:01 2008 +0100

    Merge bug19200 into bug19193

commit 5587def78e0cf978a492af3a91796e479331d9a9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Sep 5 16:41:42 2008 +0100

    Removed catch in append_file/2 since there
    is nothing to catch.

commit 7f06e87368d27293e37bfb49e089098f628c5749
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Sep 5 12:34:07 2008 +0100

    Create non-native debian packages

commit b8afe9d476ab2daae81627b7489f60882b81a5b2
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Sep 5 00:14:09 2008 +0100

    Just a little bit of cleanup

commit 4391947d60600f8a7428e2d49ca493be49a04c79
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Sep 4 22:32:32 2008 +0100

    Split out direct and topic routing

commit 88732f2a056f1df6b024d4e1078b51c8e2808b68
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 17:30:04 2008 +0100

    Added python-json as a dependency to the debian/rpm packages

commit e5bf57a323e4727ce005b0d0e6f883921a9c21c6
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 16:55:34 2008 +0100

    Removed dot

commit b5999aed9b6fd46a086d537eeeefe4e3b3eebaa9
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 15:20:04 2008 +0100

    Only debian/rules file needs to have exec permission

commit 569c0858d663dc0b542393a0fa10753576dea31a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 15:05:21 2008 +0100

    Reverted changes that accidentally got committed

commit 49ca29cb23ac970f2e0792a0402a05c613022966
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 15:00:03 2008 +0100

    Added tests to cover the changes made in last commit

commit c71470026d31a9bc5c60c3e00dcd88635d790370
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 14:02:11 2008 +0100

    Perform standard handler installation when original
    handler was not installed correcly or terminated
    with an error.

commit f584600a7cd0c3f48c43aa8d907e2e3883f0e588
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Sep 4 11:12:11 2008 +0100

    Moved log configuration to start/0,
    throw more informative errors

commit 10c0fc56adb744e59155fb7342d5238703ca4f89
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Sep 4 01:47:05 2008 +0100

    This is 10-fold improvement on the last version, still not right yet

commit 4cd83964b6b4d7a68e233621a5830a1d9a3af9ab
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Sep 3 15:44:56 2008 +0100

    Renamed logs_location/1 function to log_location/1.
    Added more test cases to cover problems with logging during startup.

commit cd40ac8b6c902fce74d423c1a04f369b16874ce3
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Sep 3 13:43:47 2008 +0100

    Simplified the way we get logs locations,
    Proper checking for the right handlers.
    Added test case for log rotation when
    logging is turned off.

commit 920f6d976607de11dc8045c0a3236df77842cce0
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 2 17:33:29 2008 +0100

    Added more test cases

commit 736e4666b6e8e955f738c090aea8b1cb42a73282
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Sep 2 14:47:03 2008 +0100

    some minor tweaks
    - list comprehension instead of lists:map
    - make clean_logs check the return of file:delete, and return ok itself
    - rename non_writable_files to make_files_nonwritable for clarity

commit 9831301f8e1d4a7c24731cd8aa6f5101945f61be
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 2 14:30:05 2008 +0100

    Removed unused include

commit 1fc2c35b5850f70c2ab1a68b57785a45c5a90a18
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 2 13:01:19 2008 +0100

    Better naming for types

commit 727f14072784dd8223503f1500623147ebafa499
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 2 12:14:47 2008 +0100

    Refactoring of the log tests

commit e0055b94793630dddd99a7dac88a385ee6dc4064
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Sep 2 11:46:52 2008 +0100

    Added test suite for log rotation.
    Initialise log rotation in its own phase.

commit fb9a469f65be1f10af4b9d1efcb610ca935856ee
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 1 09:51:56 2008 +0100

    cosmetic

commit 6e80d80be512dd8c885b83e3e8964d3d3f0d8752
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 1 09:46:22 2008 +0100

    cosmetic

commit d5f55cc7c73e2962c9334b18bccca5759e464d64
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Sep 1 09:42:45 2008 +0100

    always log an error when append fails
    and don't log the error to the console

commit a897c30e00b9fa614f4675590983f06a3332809b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 29 17:32:40 2008 +0100

    Use rabbit_log instead of error_logger

commit dba87cf64053d1537d7e3b93714dba5567da8bad
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 29 16:56:39 2008 +0100

    Typo

commit 39b1656ff9925b957441e71943f11e876079b4c2
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 29 16:35:08 2008 +0100

    More info about the behaviour of rotate_logs command

commit 5a70e0dcf1e18815b512bdd6d519b23f77f4a303
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Aug 29 16:11:24 2008 +0100

    tabs -> spaces

commit eca2d86ac28a34bd434ea6327c1bfc97aeb24e3e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 29 15:57:25 2008 +0100

    When appending the old log file fails always try
    to create the handler. This can happen when the
    file we append to is not writable.
    Fixed missing case clause.

commit b5f6bc33ffedffd1d99cd5b069e07af744e7474c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Aug 29 00:04:17 2008 +0100

    Took route deletion out of the amqqueue module, put it in the exchange module

commit 20c3155be74d88f4762539150b64583ed3b8da98
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Aug 28 21:47:12 2008 +0100

    Now this is deleting the reverse route as well

commit eeb028fb865d5c8f67de01ef998922e277c68988
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Aug 28 13:48:05 2008 +0100

    Adding note to myself

commit c183714de261b9ea977a191ace5adad3f8fd7f89
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 28 11:26:42 2008 +0100

    Create suffix file even when the original
    one is empty or doesn't exist.

commit da73cb0d0444fda0d3a70f196f68a51a75707c1c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 16:24:18 2008 +0100

    Added few missing articles

commit b3319d4afe0b7b37a2119a65c1f9177ff5314b73
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 27 16:07:45 2008 +0100

    Added unique constraint to prevent double routing

commit 654ab15a9c6e91edf03514a896484e03917c671c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 14:49:16 2008 +0100

    Fixed spec definition. Renamed name() to
    binary_name() because of the conflict with
    definition in kernel/include/file.hrl

commit 1c2d08d656db7289e185b5d7a38bdefc63c5f0d1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 13:39:22 2008 +0100

    Logrotate script calls init.d script instead
    of calling rabbitmq-multi directly

commit 7bd0e2c18c3bb99c1b9d891ce7031ae90469b101
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 12:55:07 2008 +0100

    Update man pages with rotate_logs_all command

commit 0174c25ea4c986f7db95ba093f7241612278fdf1
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 12:51:47 2008 +0100

    Added rotate_logs_all command to rabbitmq_multi.
    logrotate uses this command to correctly swap
    handlers on all nodes.

commit ba9602eff1d7900a64557902e444c2015a79d677
Merge: f68deec16 194348564
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 11:18:53 2008 +0100

    Merged bug19200 into bug19193

commit 1943485645746a580239ca6a2ec80218ecca5646
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 11:11:26 2008 +0100

    Reverted BACKUP_EXTENSION variable.
    This change belongs to bug 19193

commit 3ad36e6f3f2a6a294ecccdfeec8181998326254c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 27 11:00:20 2008 +0100

    Minor style changes

commit 93ccb6488147ea9a0e2ecb5330624caea8387bd7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 27 01:32:17 2008 +0100

    Saw some handlers so I deleted them

commit 52dcde4a695652f9593d5a7915ffbb7d7c98e2b7
Merge: 04cac0a92 ad39f61f5
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 27 01:26:41 2008 +0100

    Merged default into 18776

commit 04cac0a920ed6d722ec4782e6077c38e0d533e1c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 27 00:52:02 2008 +0100

    All of Qpid's tests now pass

commit ad39f61f591d6dc3cc630e57895bfda2148521a4
Merge: a3eda0459 793bb869d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Aug 26 20:50:23 2008 +0100

    merge bug17070 into default

commit 793bb869d223dbdabd3d69ca9094ace9521fdcae
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Aug 26 20:29:02 2008 +0100

    support default empty AMQP tables

commit 76a64d4afd23127d94e284d07da2364bc8dc2eaa
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 26 18:26:04 2008 +0100

    Moved append operation inside init/1
    in handlers' wrappers. Added comments,
    fixed various small things.

commit 7d62d02e18f6ee9238515c486a3a5fb38def0252
Author: Karol Skocik <karol@lshift.net>
Date:   Tue Aug 26 15:25:16 2008 +0100

    fixed bug in emitting erlang binary string

commit 6dc907780cd799ca04bdae6f0b2cdfd9d1c2b963
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 26 13:25:55 2008 +0100

    Added wrappers around standard error_logger_file_h
    and sasl_report_file_h modules, because they were
    not expecting proper arguments in init/1 when
    swapping handlers. Renamed reopen_logs to
    rotate_logs.

commit 6c1af42f9eebd553c74ae9a006c68d543ade00fa
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Aug 25 18:06:35 2008 +0100

    Savepoint

commit 1e2a4aa8615d70ade53d6f517feeecca01601a2d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Aug 25 17:26:37 2008 +0100

    Cleanup rabbit_exchange a bit

commit f68deec1639ff31ee8ceac62bcb0093f99b276a6
Merge: ad27fd926 d6a2ba61a
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 19 15:26:11 2008 +0100

    Merge bug19200 into bug19193

commit d6a2ba61a838b604fad47286afa097d136095635
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 19 14:48:03 2008 +0100

    Used swap_handler mechanism provided in
    error_logger to correctly reopen_logs.
    This creates another copy of the handler
    which has to be manually removed. Apparently
    the first one in the list is the old one.
    Updated man pages.

commit 18c7a16507cde719f143213ed80663964a6e6c61
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Aug 18 12:11:58 2008 +0100

    Added optional argument that specifies the suffix
    of the old log file. Using add_handler and
    delete_handler because swap_handlers doesn't behave
    as expected.

commit c90b2a416bd677b41766559b37893af5d4547569
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 15 12:29:04 2008 +0100

    Forgot to remove semicolon

commit b045ecb738e5d30e6ca254cab8083bc5c15c59c7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 15 12:24:24 2008 +0100

    Fixed qa remarks

commit a3eda0459aec1a0ae411ce7be3ae9dd7e1031cfc
Merge: 1dd2f6ec7 5b99aeb23
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 14 18:46:06 2008 +0100

    merge bug19089 into default

commit ad27fd9268b0efb0674e71b2d99cbc12cbcb162f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 17:58:19 2008 +0100

    Use postrotate script to reopen logs and
    sharedscripts option in logrotate.
    Removed .bak mechanism from linux/unix distros.

commit 231d51ccab233eadf102ee2b2d2bc3ff2118b351
Merge: 18bb034b9 47fec9c66
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 14:35:20 2008 +0100

    Merge bug19200 into bug19193

commit 47fec9c6638ff20b1239ae2c2cea65e78d5a2c10
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 14:26:44 2008 +0100

    Added reopen_logs command to man pages

commit 26e17f2c24d1b8eaba92aeb030510464ac1aca90
Merge: 1ac6911c3 1dd2f6ec7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 14:23:01 2008 +0100

    Merge default into bug19200

commit 1dd2f6ec7f8d7c480a27ddce2165c02454a3bf80
Merge: 3de001434 1b1936135
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Aug 14 14:02:39 2008 +0100

    Merge the defaults

commit 3de0014340c9fece0e6e7a248e43b9c1722f9549
Merge: 8ae84f28d c4fc5e5df
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Aug 14 14:00:16 2008 +0100

    Merge bug17940

commit 5b99aeb23312d0f7f5977b4ce35d24d9e422b81c
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 13:43:40 2008 +0100

    SCRIPT_HOME variable in windows points to the
    directory of the rabbitmq-multi.bat script

commit 1b1936135855fbba9f586bf34ce818f5bfa27b46
Merge: 4d423951f 281bb2b30
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 14 13:31:19 2008 +0100

    merge bug18994 into default

commit 8ae84f28db8fd43e61dacaa364330904fa8004b7
Merge: 4d423951f 604a6ecd6
Author: Simon MacMullen <simon@lshift.net>
Date:   Thu Aug 14 13:13:51 2008 +0100

    Merge bug 19139

commit 1ac6911c3e8d2efd9b4d90ff7bf11a0ba166f8bb
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 14 11:30:20 2008 +0100

    Added reopen_logs command to rabbit_control

commit 281bb2b30eb1180e38f84cc80149be6b54850b29
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 14 08:23:56 2008 +0100

    more restrictive signature for rabbit_misc:r/3

commit ed6d934713e3deb9aa0e8db91216fa6438af2b3d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 14 08:18:52 2008 +0100

    cosmetic changes

commit e931ae25e6a454db39cee1b7360043cba3a92149
Merge: f3f6da09a 4d423951f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Thu Aug 14 07:07:52 2008 +0100

    merge default into bug18994

commit 18bb034b9dba40efe5b741a7f8f9bc192e1bd39e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Wed Aug 13 11:44:00 2008 +0100

    Added logrotate script to debian and rpm packages

commit b4abb90113172872d1d4a20d1b78badfe254f2d6
Merge: 2620b0394 c4fc5e5df
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 12 17:04:47 2008 +0100

    Merge bug17940 into bug19166

commit c4fc5e5dffd7b623b6b0db6c9150d13e6035f21f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 12 16:58:20 2008 +0100

    Remove man source files from windows package

commit 00397b3fa880b4eb69accdac8e1d93d38c6e3d0e
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 12 16:46:40 2008 +0100

    Rename rabbitmqctl_real.pod to rabbitmqctl.pod

commit 7b12f7ca6886deac17f5769b922e115cff11896f
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 12 16:38:46 2008 +0100

    Remove man page for wrapper and use the same
    page as for rabbitmqctl_real.
    Update debina and rpm packaging to reflect
    this change.

commit f3f6da09acaaca354037dd1ff3af8b1ec43b385b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Aug 11 18:49:54 2008 +0100

    Incorporated QA comments

commit 4d423951f7e934e64f9f17c6c5545358c104b38c
Merge: c956fffef 0059be775
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Aug 11 18:18:10 2008 +0100

    merge bug18793 into default

commit 2620b0394f93d2dff2d2911e7cec45d58f2e8c30
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Fri Aug 8 18:25:11 2008 +0100

    Added required commands to the init.d script
    for rpm packages. Fixed various things in the
    spec file for rpm and made it more consistent
    with approved packaging guidelines.

commit 3977f113790eb941acd9ec3ae042bc463c246852
Author: Karol Skocik <karol@lshift.net>
Date:   Fri Aug 8 15:40:35 2008 +0100

    added mapping which decides how to convert Python value to Erlang default value

commit c956fffef47046a7197164c99c414c8df29b60d4
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 7 14:47:58 2008 +0100

    Updated rpm notes on building packages

commit 50f02b4840542c96971dd3d48fc0ae16cc6503d7
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 7 14:22:07 2008 +0100

    Renamed the pod pages slightly.

commit 976246e1d8c87c7417ba0f4c0816f4862ffd2b37
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Thu Aug 7 13:16:21 2008 +0100

    Added 4 basic man pages.
    Rabbitmqctl_real does not contain info
    about realms and permissions since those
    are to be removed either way.
    Included pages in debian and rpm packages.

commit ede5967b5651189cc1615e3e153f4ace8483760d
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 17:57:44 2008 +0100

    Deleted obsolete code

commit a4613ecf2938d148cec90cd9b033e54e7a599552
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 17:32:34 2008 +0100

    All of the Erlang client tests now pass

commit 23831a0ecbe779d015f1d5923ab05cd460db3b89
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 16:06:52 2008 +0100

    Some more fixes for QA comments

commit 6328bcfc00f4a0cc21fc88a9e7b5b79e20e0d1dc
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 15:55:33 2008 +0100

    Reverting unecessary changes in rabbit_amqqueue

commit d32428bf51201f2318a603ca020032ae858a3a8b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 15:47:45 2008 +0100

    folded default user into default host

commit 2bf27f8cf7adc9aabd10f8249e76830b077a757e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 15:23:36 2008 +0100

    Fixing some QA remarks

commit 1a613c1bd7d791b8c76bd3790b29641f2ce7cd7f
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Aug 6 12:00:21 2008 +0100

    Remove unnecessary method name from protocol_error

commit 4208a6752aa5bb0b596fd8bd85fdeddae24a25d6
Author: Tony Garnock-Jones <tonyg@kcbbs.gen.nz>
Date:   Wed Aug 6 10:16:03 2008 +0100

    Special-case global=true: we don't implement it

commit 0b4780cd0fa0ca1f8db21e1481c754616a2d469c
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 01:25:29 2008 +0100

    Lifecycle unit test in erlang client now works

commit 1fd702693822ff7f754ac257c90a6a80b1453b4b
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 00:41:30 2008 +0100

    queue.bind now works

commit 0c64f4a46e5a008831771ba8385727079c950548
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Wed Aug 6 00:16:43 2008 +0100

    First cut with queue declare

commit 848a8b10e7548849427483d30a32df0e73fc32c7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 17:29:08 2008 +0100

    Renamed the routing fields to keep the naming conventions consistent

commit 37513d69c29d0c413ab87b20073c7cf9520f5aa2
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 17:19:05 2008 +0100

    Deleted spec reference to permission type

commit 697f9994e3219657954033395c449e83090669c4
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 16:37:29 2008 +0100

    Most recently declared queue was returning the entire resource

commit e57c133b1b6fd4735596a3b7fcff4b3d913adf40
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 16:05:01 2008 +0100

    Fixed another error in the specs

commit 604a6ecd614e28d7188a8c0660bbeb8e47ffcc04
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Aug 5 14:20:33 2008 +0100

    Linda is obselete now,
    Homepage is now regular field.

commit 9c9ac0a0bc5fb1414490896f675704ec11410eb8
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 13:55:31 2008 +0100

    Put some spaces between the commas, left stuff that didnt get changed on this branch

commit 6e13eab7c50fd0d2b5536961424e909ff3f57e46
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 13:07:26 2008 +0100

    Fixed specification for declare

commit b6496b33584ead4477ace12558b6f19176e1e999
Merge: 076202047 f47df9fad
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 12:49:59 2008 +0100

    Merged default into 18994

commit f47df9fad6ae9dd0713b59871942e378116f956e
Merge: 646fc3d93 8f1af645e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 12:33:18 2008 +0100

    Merged 19135 into default

commit 8f1af645e0dce67113b8898251077bce550d1a99
Author: Matthias Radestock <matthias@lshift.net>
Date:   Tue Aug 5 11:56:57 2008 +0100

    drop incremental dialysis
    it never worked particularly well and the dialyzer command line has
    changed in R12B-3 to break it completely.

commit 8834453890e058115bdd53671029e34ffc0b0a08
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 01:15:19 2008 +0100

    Added vhost to binding spec

commit dcfe7ed8ca7abcfa980b73a78e2f31d263d4e6de
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Aug 5 00:10:32 2008 +0100

    Saving my work, IRC interrupts :-(

commit 0059be775d1d633965c2790672a259ef2558e24b
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Aug 4 18:24:45 2008 +0100

    Changed url for server's build page.

commit bbdcefef2a9df58c6b806f6458665c87bae23d34
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Mon Aug 4 18:18:13 2008 +0100

    Create build file only with server build
    instructions.

commit 0762020478b6b4e196d61b2e9bc03abe33cd02a5
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Aug 4 16:04:10 2008 +0100

    Removed some references to realms

commit 0a1d35c5306efbf4e27b298f1a6299b94a8be207
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Thu Jul 31 00:44:02 2008 +0100

    Savepoint for changing the routing structure

commit 646fc3d93f43ca823b8456d0dcb357c7086d60c6
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 29 17:13:07 2008 +0100

    Added tag rabbitmq_v1_4_0 for changeset b0b80123a480

commit 09302bfc429f06181ba97cdf3f0eda89cd06ec10
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 29 17:12:42 2008 +0100

    Propagate GNUPG_PATH properly; remove tag

commit b126d150c036f127c0e5f37b4d649d9b3fc3384d
Author: Hubert Plociniczak <hubert@lshift.net>
Date:   Tue Jul 29 16:26:55 2008 +0100

    Use %~dp0 to find the ebin directory under windows

commit 3bf32b48ff62ebd3aacee8339c4adafaf4ef02a2
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 29 16:23:51 2008 +0100

    Added tag rabbitmq_v1_4_0 for changeset b6d60e85e6e9

commit 872b6320b90f91e167f1b42a13d4e7ed2c83b4ee
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 29 15:33:44 2008 +0100

    Use dirname $0 consistently to find the ebin dir.

commit 13befdbd5d0ed940a4b5640bbdff3ffff8922230
Merge: d1417acf6 4690fed45
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jul 28 10:49:26 2008 +0100

    merge bug19069 into default

commit 4690fed45284c889258e19aaaa186a6a32143a0a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Jul 28 10:01:54 2008 +0100

    Move schema integrity check into the top of wait_for_tables.

commit fbab5e9e4950211cbe30365a303687b2935a3eb6
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jul 25 11:59:45 2008 +0100

    Bug fix for basic-get, exposed by running qpid test suite

commit d1417acf6ae4253c8656ae417d9ca0fdcd8fbcec
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 24 13:23:06 2008 +0100

    Freshen packaging changelogs

commit 71b79688ec5de53721d978c2e2d7fc01cac44f24
Merge: 0d9d88f38 2f76073a7
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Jul 22 20:57:55 2008 +0100

    Merged default into bug18994

commit 0d9d88f384a5bdce8ab843052975b3d2f68cadd9
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Jul 22 15:02:39 2008 +0100

    Removed some unused fields

commit 2f7b2c9dae6726b65d5e1436fdb37b47aeba1c11
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Jul 22 10:50:34 2008 +0100

    Deleted a lot of stuff to do with permissions

commit 0b8916a1b7f354d1936a75115b5cdc4b7b0cc817
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Jul 22 10:25:51 2008 +0100

    Put the default bindings back in

commit 834f77f3ce997d846ee4710940e5508566f2b0a6
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Tue Jul 22 09:06:22 2008 +0100

    Converted some tabs to spaces

commit d9b8cf315ac294dbf937bfaec172c0f426752542
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jul 21 19:44:56 2008 +0100

    Deleted superfluous qlc statement

commit 6c3c8aba51c6d56845a1f2b2f373ec959a9d486e
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jul 21 19:43:23 2008 +0100

    Re-keyed exchange and queue persistence on the vhost

commit 2f76073a7976385c1b6b3deb9ed93eaa5dfc8331
Merge: 0cf76f887 13340f0d6
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Mon Jul 14 15:36:53 2008 +0100

    Merger

commit 13340f0d67088fb75b136a038561585f2db9d681
Merge: bb63114ae 59af33d7f
Author: Matthias Radestock <matthias@lshift.net>
Date:   Mon Jul 14 11:16:07 2008 +0100

    merge bug18752 into default

commit 59af33d7f86fa9903ec859e9fc7739eab95a032f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Mon Jul 14 11:14:43 2008 +0100

    Reverted sync transaction to its previous state (QA note from Matthias)

commit c6210473559eed2ee8d959d30fc08dd60e09a425
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 13 19:56:31 2008 +0100

    Removed reference to rabbit_ticket module

commit 4f0d663610209e1ec7527a69e81b78a5beda5cef
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 13 19:41:57 2008 +0100

    Network test suite now passes completely

commit ec4276159237469a09902e29a5bf83d41667eb46
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 13 19:34:00 2008 +0100

    Savepoint for lifecycle test that now works without realms or tickets

commit 8764bf5a85b5281a372889b9e0780405de47662b
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Jul 12 11:06:07 2008 +0100

    proper use of #realm_resource{}

commit 2538ff288eb028235049b47c524fff53747a1a6e
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Jul 12 10:36:48 2008 +0100

    minor refactoring of preen_realm

commit 30e6d7a967673e7ca4ca5cf6b07f099521bf3c49
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Jul 12 10:24:41 2008 +0100

    rabbit_realm:check/2 is run outside tx

commit 59b0187504a41ea31a7dee3f4442f0a76bf31c50
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Jul 12 10:20:36 2008 +0100

    cosmetic

commit 37b37bec445c3af76c8ea9815ffe152e8d4bb6df
Author: Matthias Radestock <matthias@lshift.net>
Date:   Sat Jul 12 10:00:15 2008 +0100

    cosmetic changes

commit c3a84592c8547eb306fca94c363c308e49d0c98d
Author: Matthias Radestock <matthias@lshift.net>
Date:   Fri Jul 11 16:38:19 2008 +0100

    Backed out changeset a764527adf12

commit ac559c126eef34dda5d209b0f88ee7b906fe7e39
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Fri Jul 11 16:22:59 2008 +0100

    Rolling back misunderstanding about how preening works

commit 0cf76f887a34afa6ec9f04a33fb254fea580b6b5
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Wed Jul 9 14:39:07 2008 +0100

    New changelog entries for 1.4.0

commit bb63114ae61e50aec7ce8f888ad5b2b673016b9d
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 8 12:16:59 2008 +0100

    More .hgignore entries from umbrella

commit 25a636b431c74fd2c60afcdd1bb7090f5ad14d0a
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 8 12:13:14 2008 +0100

    Migrate .hgignore entries from umbrella.

commit f07b581df9e25cc5ba1960286a646efcb0461bad
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Tue Jul 8 12:12:42 2008 +0100

    Avoid copying the codegen directory's .hg dir when building a source dist.

commit b985a1832ba273eb7589bac5a3c44da130067d43
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 6 22:12:38 2008 +0100

    Tightened up the code in rabbit_realm a little bit

commit ccdf9a6065af6fb7523b25b694ea8e62c27a776f
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 6 18:30:05 2008 +0100

    Fixed some of the QA notes

commit 4dcea129a99d7523a3173358833818a32f0061b3
Author: Ben Hood <0x6e6562@gmail.com>
Date:   Sun Jul 6 00:39:50 2008 +0100

    Migrated branch bug18752

commit d0700a23d3ce0b787c0e5333e6f39e99ec663fc8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 3 13:59:36 2008 +0100

    Migrate branch bug18784

commit 7279a32f7a905a94283834bd8df4c357e0e900b7
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 3 13:58:10 2008 +0100

    Migrate branch bug18732

commit a67888aae70064de7f3ec8f9ede640f2ffa1f9c8
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 3 13:46:09 2008 +0100

    Migrate branch bug17070

commit 675869a27714307bce377638dfe8f6a5f069e757
Author: Tony Garnock-Jones <tonyg@lshift.net>
Date:   Thu Jul 3 13:35:11 2008 +0100

    Initial commit, from repo-rebase-20080703121916_default (e96543d904a2)
